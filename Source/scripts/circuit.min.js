/**
 *  Copyright 2017 Unify Software and Solutions GmbH & Co.KG.
 *
 *  Licensed under the Apache License, Version 2.0 (the "License");
 *  you may not use this file except in compliance with the License.
 *  You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 *  Unless required by applicable law or agreed to in writing, software
 *  distributed under the License is distributed on an "AS IS" BASIS,
 *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 *  See the License for the specific language governing permissions and
 *  limitations under the License.
 *
 *  @version: 1.2.1402
 */

var Circuit = {}; Object.defineProperty(Circuit, 'version', { value: '1.2.1402'});

var window=window||{},navigator=navigator||{},document=document,Circuit=function(a){"use strict";var b={name:"unknown"};return"undefined"!=typeof process?process.versions&&process.versions.node?b={name:"node",version:process.versions.node,hostname:require("os").hostname()}:process.argv&&process.argv[0]&&(b={name:process.argv[0]}):b={name:"browser"},window.setTimeout=window.setTimeout||setTimeout,window.clearTimeout=window.clearTimeout||clearTimeout,window.setInterval=window.setInterval||setInterval,window.clearInterval=window.clearInterval||clearInterval,window.location||(window.location={host:b.hostname}),navigator.platform||(navigator.platform=b.name),navigator.userAgent||(navigator.userAgent="Mozilla/5.0 (Macintosh; Intel Mac OS X 10_10_1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/40.0.2125.122 Safari/537.36"),window.navigator||(window.navigator=navigator),window.btoa||(window.btoa=function(a){return new Buffer(a).toString("base64")}),a._runtime=b,a.DefaultAvatars={},a}(Circuit||{}),Circuit=function(a){"use strict";var b=Object.freeze({Debug:1,Info:2,Warning:3,Error:4,Off:5}),c=b.Warning,d={setLevel:function(a){c=a},getLevel:function(){return c},debug:function(){c<=b.Debug&&console.log.apply(console,Array.prototype.slice.apply(arguments))},info:function(){c<=b.Info&&console.info.apply(console,Array.prototype.slice.apply(arguments))},warning:function(){c<=b.Warning&&console.warn.apply(console,Array.prototype.slice.apply(arguments))},warn:function(){c<=b.Warning&&console.warn.apply(console,Array.prototype.slice.apply(arguments))},error:function(a,d){c<=b.Error&&(a=a&&a.stack||a,d=d&&d.stack||d,d?console.error(a,d):console.error(a))},msgSend:function(){c<=b.Debug&&console.log.apply(console,Array.prototype.slice.apply(arguments))},msgRcvd:function(){c<=b.Debug&&console.log.apply(console,Array.prototype.slice.apply(arguments))},logMsg:function(a,b,c){switch(a.name){case"DEBUG":this.debug(b,c);break;case"INFO":this.info(b,c);break;case"WARN":case"WARNING":this.info(b,c);break;case"ERROR":this.info(b,c);break;default:this.debug(b,c)}},setExtensionVersion:function(a){console.log("ExtensionVersion = "+a)}};return a.logger=d,a.Enums=a.Enums||{},a.Enums.LogLevel=b,a}(Circuit||{}),Circuit=function(a){"use strict";return a.Error=function(a,b){this.code=a||"UNEXPECTED_ERROR","string"==typeof b?this.message=b:"object"==typeof b&&(this.errObj=b,b.info&&!b.message&&(b.message=b.info)),this.stack=Error().stack},a.Error.prototype=Object.create(Error.prototype),a.Error.prototype.name="Error",a}(Circuit||{}),Circuit=function(a){"use strict";function b(a,b){try{return d?d[a].apply(d,b):null}catch(a){return null}}var c,d=null;"undefined"!=typeof chrome&&(c=chrome.storage&&chrome.storage.local);try{d=c||window.localStorage||d}catch(a){d=window.sessionStorage||d}var e={getItem:function(a){return b("getItem",[a])},setItem:function(a,c){return b("setItem",[a,c])},removeItem:function(a){return b("removeItem",[a])}};return a.storeManager=e,a}(Circuit||{}),Circuit=function(a){"use strict";var b={};return b.SIGNATURE="ansibleChromeExtensionSignature",b.DOMEvent=Object.freeze({TO_EXTENSION:"toExtension",FROM_EXTENSION:"fromExtension"}),b.BgMsgType=Object.freeze({REQUEST:"request",RESPONSE:"response",EVENT:"event"}),b.BgTarget=Object.freeze({INTERNAL:"internal",LOG:"log",SCREEN_SHARE:"screenShare",EXCHANGE_CONNECTOR:"exchange_connector",HEADSET_APP:"headsetAppManager"}),b.ResponseError=Object.freeze({UNREGISTERED:"unregistered",TIMEOUT:"timeout",UNSUPPORTED_REQUEST:"unsupportedRequest",INTERNAL_ERROR:"internalError"}),b.BgLogMsgType=Object.freeze({LOG:"log"}),b.BgInternalMsgType=Object.freeze({INIT_MSG:"initMsg",INIT_MSG_ACK:"initMsgAck",INJECT_SIGNATURE:"injectChromeAppSignature",IS_ALIVE:"isAlive",GET_WINDOW_SIZE:"getWindowSize",EXTENSION_DISCONNECTED:"extensionDisconnected",BRING_TO_FRONT:"bringToFront"}),b.BgScreenShareMsgType=Object.freeze({CHOOSE_DESKTOP_MEDIA:"cdm",CHOOSE_DESKTOP_MEDIA_DONE:"cdmDone",CHOOSE_DESKTOP_MEDIA_CANCELLED:"cdmCancelled"}),b.BgExchangeMsgType=Object.freeze({CONNECT:"connect",DISCONNECT:"disconnect",SEARCH_CONTACTS:"searchContacts",GET_CONNECTION_STATUS:"getConnectionStatus",GET_CAPABILITIES:"getCapabilities",GET_CONTACT:"getContact",STORE_EXCH_CREDENTIALS:"storeCredentials",CONNECTION_STATUS:"connectionStatus",GET_ALL_PERSONAL_CONTACTS:"getAllPersonalContacts",CONTACT_FOLDERS_SYNC_STATE:"contactFoldersSyncState",SYNC_ALL_PERSONAL_CONTACTS:"syncAllPersonalContacts",GET_APPOINTMENTS:"getAppointments",GET_STORED_CREDENTIALS:"getStoredCredentials",GET_RENEWED_TOKEN:"getRenewedToken",ON_RENEWED_TOKEN:"onRenewedToken"}),b.BgHeadsetAppMsgType=Object.freeze({GET_HEADSET_APP_STATUS:"getHeadsetAppStatus",LAUNCH_HEADSET_APP:"launchHeadsetApp",HEADSET_APP_LAUNCHED:"headsetAppLaunched",HEADSET_APP_UNINSTALLED:"headsetAppUninstalled"}),b.ExchangeConnResponse=Object.freeze({OK:"ok",NO_RESULT:"noResult",FAILED:"failed",COULD_NOT_CONNECT:"couldNotConnect",UNAUTHORIZED:"unauthorized",UNSUPPORTED_METHOD:"unsupportedMethod",TIMED_OUT:"timedOut"}),b.HeadsetAppStatus=Object.freeze({NO_MANAGEMENT_PERMISSION:"noManagementPermission",NOT_INSTALLED:"notInstalled",INSTALLED:"installed",DISABLED:"disabled",UNKNOWN:"unknown"}),b.Exchange=Object.freeze({CONFIGURED_PASSWORD_MASKED:"$$$$"}),b.PortMsg=Object.freeze({CONNECT:"connect",DISCONNECT:"disconnect",MSG:"msg"}),a.ChromeExtension=b,"undefined"!=typeof module&&module.exports&&(module.exports=b),a}(Circuit||{}),Circuit=function(a){"use strict";function b(a,b){var c=l.EMOTICON_MAPPING[b];return c?String.fromCodePoint(c):""}function c(a){var b=a.replace(/[&#;]/g,"");if(!/^[0-9]+$/.test(b)||b>=55296&&b<=57343||b>1114111)return a;var c="";return b>65535&&(b-=65536,c+=String.fromCharCode(b>>>10&1023|55296),b=56320|1023&b),c+=String.fromCharCode(b)}function d(a){if(!a)return"";var b=document.createElement("div"),c=document.createElement("div");a=a.replace(/\$/gm,"$$$$");var d=0;return a=a.replace(/(<span.*?>)|(<\/span>)/gi,function(a,b,c){return b?b.match(/class="mention"/i)?a.replace(/.*abbr="(.*?)".*?>/gi,'<span class="mention" abbr="$1"><a href="#/profile/$1">'):(d++,b):c?d?(d--,c):"</a></span>":void 0}),a=k.convertEmojis(a),b.innerHTML=a,g(b,c).innerHTML.replace(/&nbsp;/gi," ")}function e(){return a.isElectron?"https://"+h.getCurrentWindow()._domain:window.location&&window.location.origin}function f(a){a=a.replace(/\xA0|&#160;|\x0A|\x0D/gim," ");for(var b=String.fromCharCode(17),c=String.fromCharCode(18),d=String.fromCharCode(19),f=function(a){var f="",g="",h=e(),i=l.isCircuitLink(h,a);return i||(i=a,/^(?:http|https|ftp):\/\//.exec(a)||(i="http://"+i),f=" target="+d+"_blank"+d,g=" rel="+d+"noopener noreferrer"+d),b+"a href="+d+i+d+f+g+c+a+b+"/a"+c},g=a.split(l.URL_SEPARATORS_PATTERN),h=0;h<g.length;h++){var i=g[h],j=l.stripParenthesis(i),k=j;k.search(/http|ftp|https/gim)>=0&&k.search(l.URL_PATTERN)>=0?k=k.replace(l.URL_PATTERN,f):k.search(/www\./gim)>=0&&k.search(l.PSEUDO_URL_PATTERN)>=0?k=k.replace(l.PSEUDO_URL_PATTERN,f):k.search(/\S@\S/gim)>=0&&k.search(l.EMAIL_ADDRESS_INCLUDED_PATTERN)>=0&&(k=k.replace(l.EMAIL_ADDRESS_INCLUDED_PATTERN,b+"a href="+d+"mailto:$&"+d+" target="+d+"_blank"+d+" rel="+d+"noopener noreferrer"+d+c+"$&"+b+"/a"+c)),i=i.replace(j,k),g[h]=i}return a=g.join(""),l.textToHtmlEscaped(a).replace(/\x11/gi,"<").replace(/\x12/gi,">").replace(/\x13/gi,"'")}function g(b,c){if(!b||!b.childNodes||!b.childNodes.length)return b;for(var d,e=0,i=b.childNodes.length;e<i;e++)switch(d=b.childNodes[e],d.nodeType){case 1:if("A"===d.nodeName){var j=a.isElectron?h.getCurrentWindow()._domain:window.location&&window.location.origin;l.isCircuitLink(j,d.href)||(d.target="_blank",d.rel="noopener noreferrer")}g(d,c);break;case 3:for(c.innerHTML=f(d.textContent),e+=c.childNodes.length-1;c.childNodes.length;)b.insertBefore(c.childNodes[0],d);b.removeChild(d),i=b.childNodes.length}return b}a.__server="",a.__domain="",a.isElectron=!("undefined"==typeof process||!process.versions||!process.versions.electron);var h,i=a.logger,j=a.Emoticons,k=a.Emoji;a.isElectron&&(h=require("electron").remote,a.__server=h.getCurrentWindow()._domain),"undefined"!=typeof Skype&&(a.SkypeSDK=Skype,Skype=null);var l=a.Utils||{};l.EMOTICON_MAPPING={":)":128515,":D":128516,":(":128542,":heart":128525,";)":128521,":awesome":128516,":angry":128544,":zzz":128554,":O":128562,";(":128546};var m=/<(img[^>|<]*(?:shortcut|abbr)="(\S*)"[^\/?>]*\/?)>/gi,n="https://embed-proxy.circuitsandbox.net/?target=";l.standardizeEmoticon=function(a){return a?a.replace(m,b):""},l.isPromise=function(a){return!(!a||"function"!=typeof a.then)},l.convertVersionToNumber=function(a){if("string"!=typeof a)return 0;var b=a.split("."),c=parseInt(b[0],10)||0,d=parseInt(b[1],10)||0;d=Math.min(d,99);var e=parseInt(b[2],10)||0;return e=Math.min(e,9999),e+1e4*d+1e6*c},l.trimTextWithEmoticonsBeforeMatch=function(a,b,c){for(var d="...",e=a.indexOf(b),f=a.slice(e),g=a.slice(0,e),h=String.fromCharCode(17),i=String.fromCharCode(18),j=g.replace(m,function(a,b){return h+b+i}),k=!0,l=j.length-1,n=j.length-1,o=n;g.length-1-l<=c&&n>=0;)18===j.charCodeAt(n)?(j=j.replaceAt(n,">"),k=!1):17===j.charCodeAt(n)&&(j=j.replaceAt(n,"<"),k=!0),o=n,n--,k&&l--;return g=o>0?d+j.slice(o):j,g+f},l.enhanceEncodeURI=function(a){var b={"!":"%21","(":"%28",")":"%29","#":"%23","{":"%7B","}":"%7D"};return encodeURIComponent(a).replace(/[!\(\)#\{\}]/gi,function(a){return b[a]})},l.normalizeDn=function(a){return a?a.replace("+",""):""},l.cleanPhoneNumber=function(a){return a?a.replace(/[^\*\#\d\+]/g,""):""},l.isMSDoc=function(a){return a.search(/<\S*?WordDocument>/i)>=0||a.search(/<[^>]*?style=[^>]*?mso-[^<]+?>/i)>=0||a.search(/<meta[^>]*?Microsoft/i)>=0},l.isXCodeDoc=function(a){return a.search(/<[^>]*?content=[^>]*?Cocoa[^<]+?>/)>=0},l.sanitizer=null,l.sanitize=function(a){if(!a||!l.sanitizer)return a;try{a=a.replace(/^[\s\S]*<!--StartFragment-->/gi,""),a=a.replace(/<!--EndFragment-->[\s\S]*$/gi,""),a=a.replace(/style="background-color: rgb\(212, 239, 181\);"/gi,'class="rich-text-highlight"'),a=a.replace(/<[^>]+background-color: rgb\(212, 239, 181\);.*?>/gi,function(a){return a.indexOf("class=")>0?a.replace(/class=".*?"/gi,function(a){return a.indexOf("rich-text-highlight")>0?a:a.replace(/[^=]\s*(.*)/gi,function(a){return a.slice(0,-1)+" rich-text-highlight"})}):a.replace(">",function(a){return' class="rich-text-highlight" '+a})}),a=a.replace(/<img(?![^>]*class="(emoticon-icon|emojione-icon))[^>]*>/gi,""),a=a.replace(/<title[^>]*>([\s\S]*?)<\/title>/gi,""),a=j.normalizeEmoticonHtml(a),a=a.replace(/<font[^>]*>|<\/font>/gi,""),a=a.replace(/(<\s*hr\s*><\s*\/hr\s*>|<\s*hr\s*>)/gi,"<hr/>"),a=a.replace(/(\r|\n)+(?=[^<]*?>)/gi," "),a=a.replace(/\r\n|\r|\n/g,"<br>"),"function"==typeof l.sanitizer&&(a=l.sanitizer(a));var b=a.split(/<\/?div.*?>|<\/?p.*?>/g).filter(function(a){return!!a}),c=b.length,d="";if(c>1)for(var e,f,g=new RegExp("<br>(?![\\s\\S]*<br>)(?=(<[^/][^>]*></[^>]*>)*$|(</[^>]*>)*$|$)","i"),h=0;h<c;h++)e=b[h].replace(/((<span( class="[\S]*")*>)|(<b( class="[\S]*")*>)|(<i( class="[\S]*")*>))*(<br>|<br\/>)(<\/span>|<\/b>|<\/i>)*/g,"<br>"),!f||f.endsWith("</ul>")||f.endsWith("</ol>")||g.test(f)||(d+="<br>"),d+=e,f=e;else d=b[0];a=d}catch(b){return i.error("[Utils]: Error sanitizing content. ",b),i.error("[Utils]: Unexpected content: ",a),""}return a},l.sanitizeSymbols=function(a){return l.isMobile()&&"undefined"!=typeof he?a&&he.encode(a,{allowUnsafeSymbols:!0,decimal:!0}):a},l.convertSymbolCodes=function(a){return l.isMobile()?a&&a.replace(k.HTML_ENTITY_REGEX,function(a){return c(a)}):a},l.toPlainText=function(a,b){if(a&&(!b||"RICH"===b)){a=a.replace(j.HTML_REGEX,function(a,b){return j.isEmoticonContent(a)?b:a});var c=document.createElement("div");return c.innerHTML=a.replace(/<(br[\/]?|\/li|hr[\/]?)>/gi,"&nbsp;"),c.textContent}return a},l.toPlainTextWithEmoticonHtml=function(a,b){if(a&&(!b||"RICH"===b)){var c=String.fromCharCode(17),d=String.fromCharCode(18);a=a.replace(j.HTML_REGEX,function(a,b){return j.isEmoticonContent(a)?c+b+d:a}),a=k.convertEmojis(a);var e=String.fromCharCode(19),f=String.fromCharCode(20);a=a.replace(k.HTML_REGEX,function(a,b){return k.isEmojiContent(a)?e+b+f:a});var g=document.createElement("div");g.innerHTML=a.replace(/<(br[\/]?|\/li|hr[\/]?)>/gi,"&nbsp;");var h=l.textToHtmlEscaped(g.textContent,!0);return h=h.replace(/\x11([^\x11\x12]*)\x12/gim,function(a,b){return j.getHtmlFromShortcut(b,!1,!0,!0)}),h.replace(/\x13([^\x13\x14]*)\x14/gim,function(a,b){return k.convertEmojis(b.replace(/&amp;/g,"&"))})}return a},l.truncateFileName=function(a){return!a||a.length<=22?a:a.substring(0,10)+" ..."+a.substring(a.length-8,a.length)},l.convertItemText=function(a,b,c){return a?c?l.toPlainTextWithEmoticonHtml(a,b):l.toPlainText(a,b):""},l.DEFAULT_HELP_URL="https://www.circuit.com/support",l.SEPARATORS_PATTERN="!-/:-@[-^{-~\\s",l.ALPHANUMERIC_PATTERN="^[a-zA-Z0-9_]*$",l.URL_SEPARATORS_PATTERN=/(?=[.,;!?]?\s+|[.,;!?]$)/,l.URL_PATTERN=/(http|ftp|https):\/\/[\w-]+?((\.|:)[\w-]+?)+?([\w.,@?'^=$%&amp;:\/~+#!\(\)\{\}\[\]-]*[\w@?'^=$%&amp;\/~+#!\(\)\{\}-])?/gim,l.EXACT_URL_PATTERN=new RegExp("^"+l.URL_PATTERN.source+"$","i"),l.PSEUDO_URL_PATTERN=/www\.+[\w-]+?(\.[\w-]+?)+?([\w.,@?\'^=$%&amp;:\/~+#!\(\)\{\}\[\]-]*[\w@?\'^=$%&amp;\/~+#!\(\)\{\}-])?/gim,l.TABBABLE_ELEMENTS_PATTERN="a[href], area[href], input:not([disabled]):not([tabindex='-1']), button:not([disabled]):not([tabindex='-1']),select:not([disabled]):not([tabindex='-1']), textarea:not([disabled]):not([tabindex='-1']), iframe, object, embed, *[tabindex]:not([tabindex='-1']), *[contenteditable=true]",l.RICH_TEXT_LINK_CLASS="text-linkDarkGreen",l.EMAIL_ADDRESS_INCLUDED_PATTERN=/[\w\*\+\-\$\?\^\{!#%&'\/=`|}~]+?(?:\.[\w\*\+\-\$\?\^\{!#%&'\/=`|}~]+?)*?@[a-z\d-]+?(?:\.[a-z\d-]{2,})+/gim,l.EMAIL_ADDRESS_PATTERN=new RegExp("^"+l.EMAIL_ADDRESS_INCLUDED_PATTERN.source+"$","i"),a.isElectron&&h&&(l.SSO_EMAIL_DOMAINS_MAPPING=h.getGlobal("constants").SSO_EMAIL_DOMAINS_MAPPING,l.SSO_PATTERN="[_a-z0-9-]+?@(("+l.SSO_EMAIL_DOMAINS_MAPPING.join(")|(")+"))",l.SSO_EMAIL_ADDRESS_PATTERN=new RegExp(l.SSO_PATTERN,"i")),l.CIRCUIT_CONVERSATION_HASH_PATTERN=/\#\/(conversation|open|muted)\/[0-9\-a-z]+?(\?((user=(\d)+?)|(item=([0-9\-a-z])+?(\&user=(\d)+?)?)))?$/gim,l.CIRCUIT_LINKS_HASH_PATTERN=/\#\/(profile|phone|user)\/[0-9\-a-z]+?$/gim,l.CIRCUIT_EMAIL_HASH_PATTERN=new RegExp("#/email/"+l.EMAIL_ADDRESS_INCLUDED_PATTERN.source+"$","gim"),l.PHONE_PATTERN=/^(\+\s*)?\d+(\s*\(\s*\d+\s*\)\s*\d+)?((\s*-?\s*\d+)*|(\s*\.\s*\d+)*)$/,l.GNF_PHONE_PATTERN=/^((\+)|(\+\s*\d+(\s*\(\s*\d+\s*\)\s*\d+)?((\s*-?\s*\d+)*|(\s*\.\s*\d+)*)))$/,l.PHONE_PAC=/^([#\*]+[#\*\(\)\-\s\+\d]*)$/,l.PHONE_DIAL_PATTERN=/^([#\*\(\)\\\/\-\.\s\+\d]*)$/,l.PHONE_WITH_EXTENSION_PATTERN=/^([#\*\(\)\\\/\-\.\s\+\d]*)(\s*(x|X|ext\.)\s*\d+)$/,l.matchPhonePattern=function(a){return a&&"string"==typeof a?a.match(l.PHONE_PATTERN):null},l.matchUrlPattern=function(a){return a&&"string"==typeof a?a.match(l.URL_PATTERN)||a.match(l.PSEUDO_URL_PATTERN):null},l.matchEmailPattern=function(a){return a&&"string"==typeof a?a.match(l.EMAIL_ADDRESS_INCLUDED_PATTERN):null},l.matchNames=function(a,b,c){if(!a||"string"!=typeof a||!b)return!1;var d=new RegExp("^"+RegExp.escape(b),c||"i");return d.test(a)||a.split(" ").some(function(a){return d.test(a)})},l.compareStrings=function(a,b){if("string"!=typeof a||"string"!=typeof b)return!1;var c=new RegExp("^"+RegExp.escape(a)+"$","i");return c.test(b)},l.rstring=function(){return Math.floor(1e9*Math.random()).toString()},l.randomNumber=function(a,b){return Math.floor(Math.random()*(b-a+1))+a},l.randomBoolean=function(){return.5>Math.random()},l.generateCallId=function(){return"WRTC-"+l.rstring()+"-"+l.rstring()},l.createTransactionId=function(){for(var a=[],b="0123456789abcdef",c=0;c<36;c++)a[c]=b.substr(Math.floor(16*Math.random()),1);a[14]="4",a[19]=b.substr(a[19]&&3||8,1),a[8]=a[13]=a[18]=a[23]="-";var d=a.join("");return d},l.getLegalRegion=function(a){switch(a){case"europe":var b=(navigator.language||navigator.browserLanguage).split("-"),c=b.last();return"de"===c.toLowerCase()?"de":"uk";case"americas":case"apac":return"us";default:return"us"}},l.getBrowserInfo=function(){if("iOS"===window.navigator.platform)return{ios:!0,type:"ios"};if("Android"===window.navigator.platform)return{android:!0,type:"android"};if("node"===window.navigator.platform)return{node:!0,type:"node"};if(Circuit.isElectron)return{chrome:!0,type:"chrome"};if("dotnet"===window.navigator.platform)return{dotnet:!0,type:"dotnet"};var a={},b=navigator.userAgent.toLowerCase(),c=/(msie|trident)(?: |.*rv:)([\d.]+)/.exec(b)||/(opera|opr)(?:.*version|)\/([\d.]+)/.exec(b)||/(firefox)\/([\d.]+)/.exec(b)||/(edge)\/([\d.]+)/.exec(b)||/(chrome)\/([\d.]+)/.exec(b)||/version\/([\d.]+).*(safari)/.exec(b)||/(phantomjs)\/([\d.]+)/.exec(b)||[],d=c[1]||"",e=c[2]||0;return"safari"===e?(d=c[2],e=c[1]):"trident"===d?d="msie":"opr"===d?d="opera":"phantomjs"===d&&(d="phantomjs"),a[d]=!0,a.type=d,a.version=e,a};var o=[{s:"Windows 10",r:/(Windows.* 10|Windows 10.0|Windows[ _]NT.* 10.0)/},{s:"Windows 8.1",r:/(Windows.* 8.1|Windows[ _]NT.* 6.3)/},{s:"Windows 8",r:/(Windows.* 8|Windows[ _]NT.* 6.2)/},{s:"Windows 7",r:/(Windows.* 7|Windows[ _]NT.* 6.1)/},{s:"Windows Vista",r:/(Windows.* Vista|Windows[ _]NT.* 6.0)/},{s:"Windows Server 2003",r:/(Windows Server 2003|Windows[ _]NT.* 5.2)/},{s:"Windows XP",r:/(Windows[ _]NT.* 5.1|Windows XP)/},{s:"Windows 2000",r:/(Windows[ _]NT.* 5.0|Windows 2000)/},{s:"Windows ME",r:/(Win 9x 4.90|Windows ME)/},{s:"Windows 98",r:/(Windows 98|Win98)/},{s:"Windows 95",r:/(Windows 95|Win95|Windows_95)/},{s:"Windows NT 4.0",r:/(Windows NT 4.0|WinNT4.0|WinNT|Windows NT)/},{s:"Windows CE",r:/Windows CE/},{s:"Windows 3.11",r:/Windows 3.11|Win16/},{s:"Android",r:/Android/},{s:"Open BSD",r:/Open BSD|OpenBSD/},{s:"Sun OS",r:/Sun OS|SunOS/},{s:"Linux",r:/(Linux|X11)/},{s:"iOS",r:/(iOS|iPhone|iPad|iPod)/},{s:"Mac OS X",r:/Mac OS X/},{s:"Mac OS",r:/(Mac OS|MacPPC|MacIntel|Mac_PowerPC|Macintosh|Darwin)/},{s:"QNX",r:/QNX/},{s:"UNIX",r:/UNIX/},{s:"BeOS",r:/BeOS/},{s:"OS/2",r:/OS\/2/},{s:"Search Bot",r:/(Search Bot|nuhk|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask Jeeves\/Teoma|ia_archiver)/}];l.getOSInfo=function(a){if(!a)return{type:"",version:"",info:""};var b=a,c="",d="",e=o.some(function(c){if(c.r.test(a))return b=c.s,!0});if(e&&/Windows/.test(b))d=/Windows (.*)/.exec(b)[1],c="Windows";else{c=b;try{switch(b){case"Mac OS X":d=/Mac OS X (10[\.\_\d]+)/.exec(a)[1];break;case"Android":d=/Android ([\.\_\d]+)/.exec(a)[1]}}catch(b){i.debug("[Utils]: osVersion does not contain version on it. ",a)}}return{type:c,version:d,info:b}},l.checkUserDomain=function(b){return a.isElectron?require("electron").remote.getCurrentWindow()._domain.split(":")[0].endsWith(b):window.location.hostname.endsWith(b)},l.getChannelInfo=function(a){var b=a.stat("googLocalAddress")+":";b+=a.stat("googRemoteAddress");var c=b.split(":"),d=function(a){switch(a){case"local":return"host";case"stun":return"srflx";default:return a}};return{ipl:c[0],ptl:c[1],ipr:c[2],ptr:c[3],lct:d(a.stat("googLocalCandidateType")),rct:d(a.stat("googRemoteCandidateType")),tt:a.stat("googTransportType")}},l.getIceCandidateInfo=function(b,c,d,e){var f={};if(!(b&&c&&d&&e))return f;var g=b.stat("candidateType");switch(g){case"relayed":case"relay":var h="string"==typeof c?a.sdpParser.parse(c):c;f.parsedSdp=h,h.m.some(function(b){if(b.media===d)return b.a.some(function(b){if("candidate"===b.field&&b.value&&b.value.indexOf(e)>=0){var c=new a.IceCandidate;if(c.parse(b.value),String(c.port)===e)return f.addr=c.raddr,f.tt=c.getRelayClientTransportType(),!0}}),!0});break;default:f.addr=b.stat("ipAddress")}return f},l.CALL_STATS={bytesReceived:"or",bytesSent:"os",googAvailableSendBandwidth:"abw",googFrameHeightReceived:"fhr",googFrameHeightSent:"fhs",googFrameWidthReceived:"fwr",googFrameWidthSent:"fws",googFrameRateDecoded:"frd",googFrameRateSent:"frs",googJitterReceived:"jr",googRtt:"rtt",googTransmitBitrate:"tbr",packetsLost:"pl",packetsReceived:"pr",packetsSent:"ps"},l.formatStatsForClientDiagnostics=function(a,b,c,d,e){if(!b||!c)return null;var f,g,h={startTime:a,pcType:d,audio:{},video:{}},i=b.result?b.result():b;if(!Array.isArray(i))return null;if(i.forEach(function(a){if(a){var b=null;if("googCandidatePair"===a.type&&"true"===a.stat("googActiveConnection"))"Channel-audio-1"===a.stat("googChannelId")?(h.audio.rtt=parseInt(a.stat("googRtt"),10),e&&(f=a.stat("localCandidateId"),h.audio.channelInfo=l.getChannelInfo(a))):(h.video.rtt=parseInt(a.stat("googRtt"),10),e&&(g=a.stat("localCandidateId"),h.video.channelInfo=l.getChannelInfo(a,a.stat("localCandidateId"))));else if("ssrc"===a.type){var c={id:a.id,ssrc:a.stat("ssrc"),timestamp:a.timestamp};a.stat("audioInputLevel")?(h.audio.transmit||(h.audio.transmit=c),b=h.audio.transmit):a.stat("audioOutputLevel")?(h.audio.receive||(h.audio.receive=c),b=h.audio.receive):a.stat("googFrameHeightSent")?(h.video.transmit||(h.video.transmit=c),b=h.video.transmit):a.stat("googFrameHeightReceived")&&(h.video.receive||(h.video.receive=c),b=h.video.receive)}else"VideoBwe"===a.type&&(h.video.bw||(h.video.bw={id:a.id}),b=h.video.bw);if(a.names&&b){var d=a.names()||[];d.forEach(function(c){l.CALL_STATS[c]&&(b[l.CALL_STATS[c]]=parseInt(a.stat(c),10))})}e&&b&&a.stat&&(b.en=a.stat("googCodecName"))}}),e){var j=h.audio.channelInfo?1:0;h.video.channelInfo&&j++;var k;i.some(function(a){if(a&&"localcandidate"===a.type){if(f===a.id&&h.audio.channelInfo){h.audio.channelInfo.ni=a.stat("networkType");var b=k||c.localDescription&&c.localDescription.sdp;return h.audio.channelInfo.candidate=l.getIceCandidateInfo(a,b,"audio",a.stat("portNumber")),k=h.audio.channelInfo.candidate.parsedSdp,--j<=0}if(g===a.id&&h.video.channelInfo){h.video.channelInfo.ni=a.stat("networkType");var b=k||c.localDescription&&c.localDescription.sdp;return h.video.channelInfo.candidate=l.getIceCandidateInfo(a,b,"video",a.stat("portNumber")),k=h.video.channelInfo.candidate.parsedSdp,--j<=0}}})}return h},l.getRTPStatsForClientDiagnostics=function(a,b,c,d,e){b&&b.getStats?b.getStats(function(f){f?e&&e(null,l.formatStatsForClientDiagnostics(a,f,b,c,d)):e&&e("getStats did not return a response")},e):e&&e("getStats or pc not available")},l.isEmptyObject=function(a){return 0===Object.keys(a).length},l.getBaseObject=function(a,b){if(!a||"object"!=typeof a)return null;if(a instanceof Array)return a;var c=Object.getPrototypeOf(a);return l.isEmptyObject(c)?a:(b!==!1&&Object.getOwnPropertyNames(c).forEach(function(b){"function"!=typeof c[b]&&a.hasOwnProperty(b)&&(c[b]=a[b])}),c)},l.syncBaseObject=function(a){var b=l.getBaseObject(a,!0);b&&b!==a&&Object.getOwnPropertyNames(b).forEach(function(b){a.hasOwnProperty(b)&&delete a[b]})},l.flattenObj=function(a){if(!a||"object"!=typeof a)return a;var b=Object.getPrototypeOf(a);if(l.isEmptyObject(b))return a;var c={};for(var d in a)"function"!=typeof a[d]&&(c[d]=a[d]);return c},l.getNormalizedFileExtension=function(a){var b=a&&(a.fileName||a.name);if(!b)return null;if(/audio/i.test(a.mimeType))return"audio";if(/video/i.test(a.mimeType))return"video";var c=b.split(".").pop();if(c)switch(c.toLowerCase()){case"doc":case"docx":return"doc";case"ppt":case"pptx":return"ppt";case"pdf":return"pdf";case"xls":case"xlsx":return"xls";case"gz":case"zip":return"zip";case"html":return"html";case"csv":return"csv";case"png":return"png";case"jpg":case"jpeg":return"jpg";case"log":return"log";case"flv":case"mp4":case"ogv":case"webm":return"video";case"wav":case"mp3":case"ogg":return"audio"}return"def"},l.getImageFileExtension=function(a){if(a.type)switch(a.type.toLowerCase()){case"image/png":return"png";case"image/jpeg":return"jpg";case"image/gif":return"gif";case"image/bmp":return"bmp";case"image/svg+xml":return"svg"}return null},l.getMimeTypes=function(a){if(!a)return null;var b=a.split(".").pop();if(b)switch(b.toLowerCase()){case"xlsx":return"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet";case"xltx":return"application/vnd.openxmlformats-officedocument.spreadsheetml.template";case"potx":return"application/vnd.openxmlformats-officedocument.presentationml.template";case"ppsx":return"application/vnd.openxmlformats-officedocument.presentationml.slideshow";case"pptx":return"application/vnd.openxmlformats-officedocument.presentationml.presentation";case"sldx":return"application/vnd.openxmlformats-officedocument.presentationml.slide";case"docx":return"application/vnd.openxmlformats-officedocument.wordprocessingml.document";case"dotx":return"application/vnd.openxmlformats-officedocument.wordprocessingml.template";case"xlam":return"application/vnd.ms-excel.addin.macroEnabled.12";case"xlsb":return"application/vnd.ms-excel.sheet.binary.macroEnabled.12"}return"application/octet-stream"},l.textToHtmlEscaped=function(a,b){if(!a)return"";var c=b?"&nbsp;":"<br>";return a.replace(/&/g,"&amp;").replace(/"/g,"&#34;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\r\n|\r|\n/gm,c)},l.escapedHtmlToText=function(a){return a?a.replace(/&amp;/g,"&").replace(/&#34;/g,'"').replace(/&#39;/g,"'").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&nbsp;/g," ").replace(/<br\/?>/g,"\r\n"):""},l.stripParenthesis=function(a){a=a.trim();for(var b=a.match(/\(/g)||[],c=a.match(/\)/g)||[],d=0;"("===a[d];)d++;return a.slice(d,a.length-Math.abs(b.length-d-c.length))},l.linkifyContent=function(a,b){if(l.isMobile())return"";switch(a=j.addEmoticonsAltAttr(a),b){case"RICH":return d(a);case"PLAIN":return f(a)}return a},l.invalidFileTypes=["ade","adp","app","asp","bas","bat","cer","chm","cmd","cnt","com","cpl","crt","csh","der","exe","fxp","gadget","hlp","hpj","hta","inf","ins","isp","its","js","jse","ksh","lnk","mad","maf","mag","mam","maq","mar","mas","mat","mau","mav","maw","mda","mdb","mde","mdt","mdw","mdz","msc","msh","msh1","msh1xml","msh2","msh2xml","mshxml","msi","msp","mst","ops","osd","pcd","pif","plg","prf","prg","ps1","ps1xml","ps2","ps2xml","psc1","psc2","pst","reg","scf","scr","sct","shb","shs","tmp","url","vb","vbe","vbp","vbs","vsmacros","vsw","ws","wsc","wsf","wsh","xnk"],l.hasScrollbar=function(a){if(a&&a.length>0){var b=a[0];return!!b&&b.scrollHeight>b.clientHeight}return!1},l.isDescendantOrEqual=function(a,b){if(a===b)return!0;for(var c=a;c;)if(c=c.parentElement,c===b)return!0;return!1},l.isSupportedImage=function(a){var b=/^image\/(jpeg|gif|bmp|png|svg\+xml)$/i;return b.test(a)},l.isVideoSupportedByBrowser=function(a){var b=/^video\/(quicktime|mp4|webm)$/i;return b.test(a)},l.shallowCopy=function(a){if(!a||"object"!=typeof a)return a;if(Array.isArray(a))return a.slice();var b=l.flattenObj(a),c={};for(var d in b)b.hasOwnProperty(d)&&(c[d]=b[d]);return c},l.extend=function(a,b){a&&b&&"object"==typeof a&&"object"==typeof b&&Object.keys(b).forEach(function(c){a[c]=b[c]})},l.normalizeLocaleProto=function(a){var b;return a&&a.length>=5&&(b=a.replace(/-/g,"_").toUpperCase()),b},l.normalizeLocale=function(a){var b;return a&&a.length>=5&&(b=a.substr(0,2).toLowerCase()+a.substr(2,a.length-2).replace(/_/g,"-")),b},l.getLocalTime=function(a){var b=new Date;return null===a||void 0===a?b.getTime():(b.setTime(b.getTime()+60*(b.getTimezoneOffset()-a)*1e3),b.getTime())},l.delayOrTimestamp=function(a,b){return a>0?Date.now()+a:b},l.buildAttachmentMetaData=function(a){var b=function(a){return{fileId:a.fileId,fileName:a.fileName,itemId:a.itemId,mimeType:a.mimeType,size:a.size}},c=[],d=[];return a&&a.forEach(function(a){if(a.isThirdParty){var e=b(a);return void d.push({type:a.provider,attachment:e,downloadLocation:a.url,previewLocation:a.url,shareLinkToken:a.shareLinkToken})}c.push(b(a)),a.thumbnail&&c.push(b(a.thumbnail))}),{attachments:c,externalAttachments:d}},l.inherit=function(a,b){function c(){}c.prototype=b.prototype,a.prototype=new c,a.prototype.constructor=a,a.parent=b.prototype},l.isOlderThan=function(a,b){if(!a)return!0;var c=864e5;return b=b||1,Date.now()-a>b*c},l.bytesToSize=function(a,b){if(a=parseInt(a,10),!a)return"0 Bytes";var c=1024,d=["Bytes","KB","MB","GB","TB","PB"],e=Math.floor(Math.log(a)/Math.log(c));return Number((a/Math.pow(c,e)).toPrecision(b||3))+" "+d[e]},l.isMacOs=!(!window.navigator||!window.navigator.userAgent)&&(window.navigator.userAgent.indexOf("Mac")!==-1||window.navigator.userAgent.indexOf("Darwin")!==-1),l.isWindowsOs=!(!window.navigator||!window.navigator.platform)&&"win"===window.navigator.platform.substring(0,3).toLowerCase(),l.daysBetween=function(a,b){if(a instanceof Date&&b instanceof Date){var c=864e5;return Math.floor(Math.abs(b.getTime()-a.getTime())/c)}},l.isMobile=function(){return"iOS"===window.navigator.platform||"Android"===window.navigator.platform},l.formatPIN=function(a,b,c){if(!b)return"";if(c)return(a||"")+b+"#";for(var d,e=4,f=3,g=2,h=[],i=a?f:e,j=0;j<b.length;j+=i)j>0&&(i=f),d=b.substr(j,i),d.length>=g||0===h.length?h.push(d):h[h.length-1]+=d;return a&&h.unshift(a),h.push("#"),h.join(" ")},l.CountriesArray=[{name:"res_countryName_Andorra",code:"AD"},{name:"res_countryName_United_Arab_Emirates",code:"AE"},{name:"res_countryName_Afghanistan",code:"AF"},{name:"res_countryName_Antigua_and_Barbuda",code:"AG"},{name:"res_countryName_Anguilla",code:"AI"},{name:"res_countryName_Albania",code:"AL"},{name:"res_countryName_Armenia",code:"AM"},{name:"res_countryName_Netherland_Antilles",code:"AN"},{name:"res_countryName_Angola",code:"AO"},{name:"res_countryName_Antarctic",code:"AQ"},{name:"res_countryName_Argentina",code:"AR"},{name:"res_countryName_American_Samoa",code:"AS"},{name:"res_countryName_Austria",code:"AT"},{name:"res_countryName_Australia",code:"AU"},{name:"res_countryName_Aruba",code:"AW"},{name:"res_countryName_Azerbaijan",code:"AZ"},{name:"res_countryName_Bosnia_and_Herzegovina",code:"BA"},{name:"res_countryName_Barbados",code:"BB"},{name:"res_countryName_Bangladesh",code:"BD"},{name:"res_countryName_Belgium",code:"BE"},{name:"res_countryName_Burkina_Faso",code:"BF"},{name:"res_countryName_Bulgaria",code:"BG"},{name:"res_countryName_Bahrain",code:"BH"},{name:"res_countryName_Burundi",code:"BI"},{name:"res_countryName_Benin",code:"BJ"},{name:"res_countryName_Bermuda",code:"BM"},{name:"res_countryName_Brunei_Darussalam",code:"BN"},{name:"res_countryName_Bolivia",code:"BO"},{name:"res_countryName_Brazil",code:"BR"},{name:"res_countryName_Bahamas",code:"BS"},{name:"res_countryName_Bhutan",code:"BT"},{name:"res_countryName_Botswana",code:"BW"},{name:"res_countryName_Belarus",code:"BY"},{name:"res_countryName_Belize",code:"BZ"},{name:"res_countryName_Canada",code:"CA"},{name:"res_countryName_Dem_Republic_Congo",code:"CD"},{name:"res_countryName_Central_African_Republik",code:"CF"},{name:"res_countryName_Congo",code:"CG"},{name:"res_countryName_Switzerland",code:"CH"},{name:"res_countryName_Cote_d_Ivoire",code:"CI"},{name:"res_countryName_Chile",code:"CL"},{name:"res_countryName_Cameroon",code:"CM"},{name:"res_countryName_China_Peoples_Republic",code:"CN"},{name:"res_countryName_Colombia",code:"CO"},{name:"res_countryName_Costa_Rica",code:"CR"},{name:"res_countryName_Cuba",code:"CU"},{name:"res_countryName_Cap_Verde",code:"CV"},{name:"res_countryName_Cyprus",code:"CY"},{name:"res_countryName_Czech_Republik",code:"CZ"},{name:"res_countryName_Germany",code:"DE"},{name:"res_countryName_Djibouti",code:"DJ"},{name:"res_countryName_Denmark",code:"DK"},{name:"res_countryName_Dominica",code:"DM"},{name:"res_countryName_Dominican_Republik",code:"DO"},{name:"res_countryName_Algeria",code:"DZ"},{name:"res_countryName_Ecuador",code:"EC"},{name:"res_countryName_Estonia",code:"EE"},{name:"res_countryName_Egypt",code:"EG"},{name:"res_countryName_Westsahara",code:"EH"},{name:"res_countryName_Eritrea",code:"ER"},{name:"res_countryName_Spain",code:"ES"},{name:"res_countryName_Ethiopia",code:"ET"},{name:"res_countryName_Finland",code:"FI"},{name:"res_countryName_Fiji",code:"FJ"},{name:"res_countryName_Falkland_Islands",code:"FK"},{name:"res_countryName_Micronesia_Fed_States",code:"FM"},{name:"res_countryName_Faroer",code:"FO"},{name:"res_countryName_France",code:"FR"},{name:"res_countryName_Gaboon",code:"GA"},{
name:"res_countryName_United_Kingdom",code:"GB"},{name:"res_countryName_United_Kingdom",code:"UK"},{name:"res_countryName_Grenada",code:"GD"},{name:"res_countryName_Georgia",code:"GE"},{name:"res_countryName_French_Guayana",code:"GF"},{name:"res_countryName_Ghana",code:"GH"},{name:"res_countryName_Gibraltar",code:"GI"},{name:"res_countryName_Greenland",code:"GL"},{name:"res_countryName_Gambia",code:"GM"},{name:"res_countryName_Guinea",code:"GN"},{name:"res_countryName_Guadeloupe",code:"GP"},{name:"res_countryName_Equatorial_Guinea",code:"GQ"},{name:"res_countryName_Greece",code:"GR"},{name:"res_countryName_South_Georgia_South_Sandwichisland",code:"GS"},{name:"res_countryName_Guatemala",code:"GT"},{name:"res_countryName_Guam",code:"GU"},{name:"res_countryName_Guinea_Bissau",code:"GW"},{name:"res_countryName_Guyana",code:"GY"},{name:"res_countryName_Hong_Kong",code:"HK"},{name:"res_countryName_Honduras",code:"HN"},{name:"res_countryName_Croatia",code:"HR"},{name:"res_countryName_Haiti",code:"HT"},{name:"res_countryName_Hungary",code:"HU"},{name:"res_countryName_Canary_Island",code:"IC"},{name:"res_countryName_Indonesia",code:"ID"},{name:"res_countryName_Ireland",code:"IE"},{name:"res_countryName_Israel",code:"IL"},{name:"res_countryName_India",code:"IN"},{name:"res_countryName_British_Indian_Ocean_Territory",code:"IO"},{name:"res_countryName_Iraq",code:"IQ"},{name:"res_countryName_Iran_Islamic_Republic",code:"IR"},{name:"res_countryName_Iceland",code:"IS"},{name:"res_countryName_Italy",code:"IT"},{name:"res_countryName_Jamaica",code:"JM"},{name:"res_countryName_Jordan",code:"JO"},{name:"res_countryName_Japan",code:"JP"},{name:"res_countryName_Kenya",code:"KE"},{name:"res_countryName_Kyrgyzstan",code:"KG"},{name:"res_countryName_Cambodia",code:"KH"},{name:"res_countryName_Kiribati",code:"KI"},{name:"res_countryName_Comoros",code:"KM"},{name:"res_countryName_St_Kitts_and_Nevis",code:"KN"},{name:"res_countryName_Korea_Dem_Peoples_Rep_North_Korea",code:"KP"},{name:"res_countryName_Korea_South",code:"KR"},{name:"res_countryName_Kuwait",code:"KW"},{name:"res_countryName_Cayman_Islands",code:"KY"},{name:"res_countryName_Kazakhstan",code:"KZ"},{name:"res_countryName_Laos_Democratic_Peoples_Republic",code:"LA"},{name:"res_countryName_Lebanon",code:"LB"},{name:"res_countryName_Saint_Lucia",code:"LC"},{name:"res_countryName_Liechtenstein",code:"LI"},{name:"res_countryName_Sri_Lanka",code:"LK"},{name:"res_countryName_Liberia",code:"LR"},{name:"res_countryName_Lesotho",code:"LS"},{name:"res_countryName_Lithuania",code:"LT"},{name:"res_countryName_Luxembourg",code:"LU"},{name:"res_countryName_Latvia",code:"LV"},{name:"res_countryName_Libya_Libyan_Arabian_Dschamahirija",code:"LY"},{name:"res_countryName_Morocco",code:"MA"},{name:"res_countryName_Monaco",code:"MC"},{name:"res_countryName_Moldova_Republic",code:"MD"},{name:"res_countryName_Montenegro",code:"ME"},{name:"res_countryName_Madagascar",code:"MG"},{name:"res_countryName_Marshall_Islands",code:"MH"},{name:"res_countryName_Mazedonia_former_Rep_of_Yugoslavia",code:"MK"},{name:"res_countryName_Mali",code:"ML"},{name:"res_countryName_Myanmar_Burma",code:"MM"},{name:"res_countryName_Mongolia",code:"MN"},{name:"res_countryName_Macau",code:"MO"},{name:"res_countryName_Northern_Marians",code:"MP"},{name:"res_countryName_Martinique",code:"MQ"},{name:"res_countryName_Mauretania",code:"MR"},{name:"res_countryName_Montserrat",code:"MS"},{name:"res_countryName_Malta",code:"MT"},{name:"res_countryName_Mauritius",code:"MU"},{name:"res_countryName_Maledives",code:"MV"},{name:"res_countryName_Malawi",code:"MW"},{name:"res_countryName_Mexico",code:"MX"},{name:"res_countryName_Malaysia",code:"MY"},{name:"res_countryName_Mozambique",code:"MZ"},{name:"res_countryName_Namibia",code:"NA"},{name:"res_countryName_New_Caledonia",code:"NC"},{name:"res_countryName_Niger",code:"NE"},{name:"res_countryName_Norfolk_Islands",code:"NF"},{name:"res_countryName_Nigeria",code:"NG"},{name:"res_countryName_Nicaragua",code:"NI"},{name:"res_countryName_Netherlands",code:"NL"},{name:"res_countryName_Norway",code:"NO"},{name:"res_countryName_Nepal",code:"NP"},{name:"res_countryName_Nauru",code:"NR"},{name:"res_countryName_New_Zealand",code:"NZ"},{name:"res_countryName_Oman",code:"OM"},{name:"res_countryName_Panama",code:"PA"},{name:"res_countryName_Peru",code:"PE"},{name:"res_countryName_French_Polynesia",code:"PF"},{name:"res_countryName_Papua_New_Guinea",code:"PG"},{name:"res_countryName_Philippines",code:"PH"},{name:"res_countryName_Pakistan",code:"PK"},{name:"res_countryName_Poland",code:"PL"},{name:"res_countryName_Saint_Pierre_and_Miquelon",code:"PM"},{name:"res_countryName_Pitcairn_Island",code:"PN"},{name:"res_countryName_Puerto_Rico",code:"PR"},{name:"res_countryName_Palestine_regions_occupied",code:"PS"},{name:"res_countryName_Portugal",code:"PT"},{name:"res_countryName_Palau",code:"PW"},{name:"res_countryName_Paraguay",code:"PY"},{name:"res_countryName_Quatar",code:"QA"},{name:"res_countryName_Reunion",code:"RE"},{name:"res_countryName_Romania",code:"RO"},{name:"res_countryName_Russian_Federation",code:"RU"},{name:"res_countryName_Rwanda",code:"RW"},{name:"res_countryName_Saudi_Arabia",code:"SA"},{name:"res_countryName_Solomonen",code:"SB"},{name:"res_countryName_Seychelles",code:"SC"},{name:"res_countryName_Sudan",code:"SD"},{name:"res_countryName_Sweden",code:"SE"},{name:"res_countryName_Singapore",code:"SG"},{name:"res_countryName_Saint_Helena",code:"SH"},{name:"res_countryName_Slovenia",code:"SI"},{name:"res_countryName_Spitzbergen",code:"SJ"},{name:"res_countryName_Slovakia",code:"SK"},{name:"res_countryName_Sierra_Leone",code:"SL"},{name:"res_countryName_San_Marino",code:"SM"},{name:"res_countryName_Senegal",code:"SN"},{name:"res_countryName_Somalia",code:"SO"},{name:"res_countryName_Suriname",code:"SR"},{name:"res_countryName_South_Sudan_Republic_of",code:"SS"},{name:"res_countryName_Sao_Tome_and_Principe",code:"ST"},{name:"res_countryName_El_Salvador",code:"SV"},{name:"res_countryName_Syria_Arabian_Republic",code:"SY"},{name:"res_countryName_Swaziland",code:"SZ"},{name:"res_countryName_Turks_and_Caicos_Islands",code:"TC"},{name:"res_countryName_Chad",code:"TD"},{name:"res_countryName_Togo",code:"TG"},{name:"res_countryName_Thailand",code:"TH"},{name:"res_countryName_Tajikstan",code:"TJ"},{name:"res_countryName_Tokelau",code:"TK"},{name:"res_countryName_Timor_Leste",code:"TL"},{name:"res_countryName_Turkmenistan",code:"TM"},{name:"res_countryName_Tunisia",code:"TN"},{name:"res_countryName_Tonga",code:"TO"},{name:"res_countryName_Turkey",code:"TR"},{name:"res_countryName_Trinidad_and_Tobago",code:"TT"},{name:"res_countryName_Tuvalu",code:"TV"},{name:"res_countryName_Taiwan",code:"TW"},{name:"res_countryName_Tanzania_United_Republic",code:"TZ"},{name:"res_countryName_Ukraine",code:"UA"},{name:"res_countryName_Uganda",code:"UG"},{name:"res_countryName_Minor_American_Oversea_Islands",code:"UM"},{name:"res_countryName_United_States_of_America",code:"US"},{name:"res_countryName_Uruguay",code:"UY"},{name:"res_countryName_Uzbekistan",code:"UZ"},{name:"res_countryName_Vatican_City",code:"VA"},{name:"res_countryName_Saint_Vincent_and_Grenadines",code:"VC"},{name:"res_countryName_Venezuela",code:"VE"},{name:"res_countryName_British_Virgin_Islands",code:"VG"},{name:"res_countryName_American_Virgin_Islands",code:"VI"},{name:"res_countryName_Vietnam",code:"VN"},{name:"res_countryName_Vanuatu",code:"VU"},{name:"res_countryName_Wallis_and_Futuna",code:"WF"},{name:"res_countryName_Samoa",code:"WS"},{name:"res_countryName_Kosovo",code:"XK"},{name:"res_countryName_Serbia",code:"XS"},{name:"res_countryName_Yemen",code:"YE"},{name:"res_countryName_Mayotte",code:"YT"},{name:"res_countryName_South_Africa",code:"ZA"},{name:"res_countryName_Zambia",code:"ZM"},{name:"res_countryName_Zimbabwe",code:"ZW"}],l.CountryCodeToCountryNameResourceMap={},l.CountriesArray.forEach(function(a){l.CountryCodeToCountryNameResourceMap[a.code]=a.name}),l.isCircuitLink=function(b,c){if(b&&c){if(a.isElectron&&0===c.search(/^file:\/\/\S+?\.html#\/\S+?$/i))return!0;if(c.startsWith("#/"))return!0;var d=/^(?:http|https|ftp):\/\//;if(d.exec(b)||(b="https://"+b),b.endsWith("/")||(b+="/"),d.exec(c)||(c="https://"+c),c.length>b.length&&c.startsWith(b)){var e=c.slice(b.length),f=e.match(l.CIRCUIT_CONVERSATION_HASH_PATTERN);return f?f[0].replace(/\/(muted|open)/gim,"/conversation"):(f=e.match(l.CIRCUIT_LINKS_HASH_PATTERN)||e.match(l.CIRCUIT_EMAIL_HASH_PATTERN),f&&f[0])}return!1}},l.throttle=function(a,b,c){var d,e,f,g=null,h=0;c=c||{};var i=function(){h=c.leading===!1?0:Date.now(),g=null,f=a.apply(d,e),d=e=null};return function(){var j=Date.now();h||c.leading!==!1||(h=j);var k=b-(j-h);return d=this,e=arguments,k<=0?(g&&(window.clearTimeout(g),g=null),h=j,f=a.apply(d,e),d=e=null):g||c.trailing===!1||(g=window.setTimeout(i,k)),f}},l.hasEmptyPrototype=function(a){return!(!a||"object"!=typeof a)&&l.isEmptyObject(Object.getPrototypeOf(a))},l.compareElements=function(a,b){if(a===b)return!0;if(!a||!b)return!1;if("object"!=typeof a||"object"!=typeof b)return!1;if(a instanceof Array&&b instanceof Array)return function(a,b){var c=a.length,d=[];if(a===b)return!0;if(a.length!==b.length)return!1;for(var e=0;e<c;++e)for(var f=0;f<c;++f)if(d.indexOf(b[f])===-1&&l.compareElements(a[e],b[f])){d.push(b[f]);break}return d.length===c}(a,b);if(!l.hasEmptyPrototype(a)||!l.hasEmptyPrototype(b))return!1;for(var c in a)if(a.hasOwnProperty(c)&&0!==c.indexOf("$$")&&!l.compareElements(a[c],b[c]))return!1;return!0},l.copyToClipboard=function(a,b,c){var d,e,f,g,h;if(a)try{e=document.createRange(),d=window.getSelection(),g=document.body.style.overflow,h=this.getBrowserInfo().msie,f=document.createElement("div"),a=a.replace(/\r\n/gi,"<br>"),f.style.backgroundColor="#fff",f.style.font="normal normal 15px Calibri, sans-serif",f.style["white-space"]="pre-wrap",c?f.innerText=a:f.innerHTML=a,document.body.appendChild(f),e.selectNode(f),d.removeAllRanges(),d.addRange(e),h&&(document.body.style.overflow="hidden");var j=document.execCommand("copy");j?b&&b():b&&b("Failed to copy")}catch(a){i.error("[Utils]: Copy to clipboard failed"),b&&b("Internal error")}finally{d&&("function"==typeof d.removeRange?d.removeRange(e):d.removeAllRanges()),h&&(document.body.style.overflow=g),f&&document.body.removeChild(f)}},l.openNewWindow=function(a){var b=window.open(a);window.setTimeout(function(){b.close()},100)},l.sslProxify=function(a){return a&&a.startsWith("http:")?n+encodeURIComponent(a):a},l.appIsFocused=function(){if(a.isElectron){var b=h.getCurrentWindow();return b.isFocused()&&b.isVisible()&&!b.isMinimized()}return document.hidden!==!0},l.validatePreviewProtocol=function(a){return a?a.match(/https:/)?a:a.replace('src="//','src="https://'):""},l.TabSelector=function(a){function b(){Object.keys(d).forEach(function(a){d[a]=!1})}if(Array.isArray(a)&&0!==a.length){var c=this,d={},e="";a.forEach(function(a,f){0===f?(d[a]=!0,e=a):d[a]=!1,Object.defineProperty(c,a,{get:function(){return d[a]},set:function(c){c&&(b(),d[a]=!0,e=a)},enumerable:!0,configurable:!1})}),Object.defineProperty(this,"selected",{get:function(){return e},enumerable:!0,configurable:!1}),Object.defineProperty(this,"selectedIdx",{get:function(){return a.indexOf(e)},enumerable:!0,configurable:!1})}},l.getOrigin=e,l.parseQS=function(a){var b={};a=a.substring(1);for(var c=/([^&=]+)=([^&]*)/g,d=c.exec(a);d;)b[decodeURIComponent(d[1])]=decodeURIComponent(d[2]),d=c.exec(a);return b},l.toQS=function(a){var b=[];for(var c in a)a.hasOwnProperty(c)&&void 0!==a[c]&&b.push(encodeURIComponent(c)+"="+encodeURIComponent(a[c]));return b.join("&")},l.extractConfigurableText=function(a,b,c){var d=a&&a.find(function(a){return a.type===b});if(d&&d.texts){var e,f=function(a){return d.texts.find(function(b){return b.language===a})};return c&&(e=f(c),e||(c=c.split("-",1)[0],e=f(c))),e||(e=f("default")),e&&e.translation}},l.selectMediaDevice=function(a,b,c){if(a&&b){var d;return b.some(function(b){return d="undefined"==typeof b.id?b:a.find(function(a){return b.id===a.id}),!!d}),!d&&c&&b.some(function(b){return d=a.find(function(a){return b.label===a.label}),!!d}),d}},Object.values||(Object.values=function(a){return Object.keys(a).map(function(b){return a[b]})}),String.prototype.format=function(){var a=arguments;return this.replace(/{(\d+)}/g,function(b,c){return a[c]||b})},String.prototype.startsWith||(String.prototype.startsWith=function(a,b){return null!==a&&void 0!==a&&(a=a.toString(),b=Math.floor(b)||0,this.substr(b,a.length)===a)}),String.prototype.endsWith||(String.prototype.endsWith=function(a,b){return null!==a&&void 0!==a&&(b=void 0===b?this.length:Math.min(Math.floor(b)||0,this.length),a=a.toString(),b-=a.length,!(b<0)&&this.substr(b,a.length)===a)}),String.prototype.replaceAt=function(a,b){return this.substr(0,a)+b+this.substr(a+b.length)},String.prototype.randomCharacter=function(){return this[Math.floor(this.length*Math.random())]},Array.prototype.isEmpty||(Array.prototype.isEmpty=function(){return 0===this.length}),Array.prototype.last||(Array.prototype.last=function(){if(this.length>0)return this[this.length-1]}),Array.prototype.shuffle=function(){for(var a=this.length,b=0;b<a;b++){var c=Math.floor(Math.random()*a),d=this[c];this[c]=this[b],this[b]=d}return this},Array.prototype.randomCopy=function(a){var b=this.slice(0);return b.shuffle(),b.splice(0,a)},Array.prototype.move=function(a,b){if(void 0!==a&&void 0!==b){if(b>=this.length)for(var c=b-this.length;c--+1;)this.push(void 0);this.splice(b,0,this.splice(a,1)[0])}},Array.prototype.remove=function(a){if("undefined"!=typeof a&&a){var b=this.indexOf(a);b>-1&&this.splice(b,1)}},Array.prototype.includes||(Array.prototype.includes=function(a){return this.indexOf(a)!==-1}),Array.prototype.contains=function(a){return this.indexOf(a)!==-1},Array.prototype.binaryInsert=function(a,b){if("function"!=typeof b)return!1;for(var c,d,e=0,f=this.length-1,g=!1;e<=f;)if(c=Math.floor((e+f)/2),d=this[c],b(d,a)<0)e=c+1;else{if(!(b(d,a)>0)){g=!0;break}f=c-1}var h=g?c+1:e;return h>=0&&(this.splice(h,0,a),!0)},Array.prototype.empty||(Array.prototype.empty=function(){for(;this.length>0;)this.pop()}),Array.prototype.copy||(Array.prototype.copy=function(a){this.empty(),this.push.apply(this,a)}),Array.prototype.diff||(Array.prototype.diff=function(a){return this.filter(function(b){return!a.contains(b)})}),Array.prototype.findAndRemove=function(a){if("function"==typeof a)for(var b=0;b<this.length;b++)if(a(this[b]))return this.splice(b,1)},Array.prototype.find||(Array.prototype.find=function(a){if(null===this||void 0===this)throw new TypeError("Array.prototype.find called on null or undefined");if("function"!=typeof a)throw new TypeError("predicate must be a function");for(var b,c=Object(this),d=c.length>>>0,e=arguments[1],f=0;f<d;f++)if(b=c[f],a.call(e,b,f,c))return b}),Array.prototype.findIndex||(Array.prototype.findIndex=function(a){if(null===this||void 0===this)throw new TypeError("Array.prototype.findIndex called on null or undefined");if("function"!=typeof a)throw new TypeError("predicate must be a function");for(var b,c=Object(this),d=c.length>>>0,e=arguments[1],f=0;f<d;f++)if(b=c[f],a.call(e,b,f,c))return f;return-1}),RegExp.escape=function(a){if(!a)return"";var b=a.replace(/[.*+?|()\[\]{}\\$^]/g,"\\$&");return b},Date.prototype.moveToEndOfDay=function(){return this.set({hour:23,minute:59,second:59})},Date.prototype.moveToFirstDayOfYear=function(){return this.set({day:1,month:0})},Date.prototype.moveToLastDayOfYear=function(){return this.set({month:11}).moveToLastDayOfMonth()};var p={};return p.format=function(a){if("undefined"!=typeof PhoneNumberUtil&&a&&"+"===a.charAt(0))try{var b=PhoneNumberUtil.parseAndKeepRawInput(a,null);a=PhoneNumberUtil.formatInternational(b)}catch(a){}return a},a.Utils=l,a.PhoneNumberFormatter=p,a}(Circuit||{}),Circuit=function(a){"use strict";var b=a.logger,c=a.Utils,d=Object.freeze({WSMessageType:{REQUEST:"REQUEST",RESPONSE:"RESPONSE",EVENT:"EVENT"},ContentType:{SYSTEM:"SYSTEM",NONE:"NONE",EXTENSION:"EXTENSION",CONVERSATION:"CONVERSATION",USER:"USER",RTC_SESSION:"RTC_SESSION",RTC_CALL:"RTC_CALL",SEARCH:"SEARCH",KEEPALIVE:"KEEPALIVE",INSTRUMENTATION:"INSTRUMENTATION",GUEST:"GUEST",ADMINISTRATION:"ADMINISTRATION",THIRDPARTYCONNECTORS:"THIRDPARTYCONNECTORS",USER_TO_USER:"USER_TO_USER",VERSION:"VERSION",ACCOUNT:"ACCOUNT",ACTIVITYSTREAM:"ACTIVITYSTREAM",CONVERSATION_USER_DATA:"CONVERSATION_USER_DATA",USER_DATA:"USER_DATA"},ReturnCode:{OK:"OK",AUTHORIZATION_FAILED:"AUTHORIZATION_FAILED",AUTHORIZATION_REQUIRED:"AUTHORIZATION_REQUIRED",SERVICE_EXCEPTION:"SERVICE_EXCEPTION",PROTOBUF_CONVERSION_EXCEPTION:"PROTOBUF_CONVERSION_EXCEPTION",CONVERSION_EXCEPTION:"CONVERSION_EXCEPTION",NO_MESSAGE_HANDLER:"NO_MESSAGE_HANDLER",INVALID_CLIENT:"INVALID_CLIENT",NO_RESULT:"NO_RESULT",OPERATION_NOT_SUPPORTED:"OPERATION_NOT_SUPPORTED",ENTITY_ALREADY_EXISTS:"ENTITY_ALREADY_EXISTS",FRAME_SIZE_TO_LONG:"FRAME_SIZE_TO_LONG",BACKEND_UNAVAILABLE:"BACKEND_UNAVAILABLE",OVERLOADED:"OVERLOADED",OLD_VERSION:"OLD_VERSION",STORAGE_OVERLOADED:"STORAGE_OVERLOADED",USER_NOT_FOUND:"USER_NOT_FOUND",SERVICE_UNAVAILABLE:"SERVICE_UNAVAILABLE",REQUEST_TIMEOUT:"REQUEST_TIMEOUT",DISCONNECTED:"DISCONNECTED",INVALID_MESSAGE:"INVALID_MESSAGE",FAILED_TO_SEND:"FAILED_TO_SEND",UNEXPECTED_RESPONSE:"UNEXPECTED_RESPONSE",MISSING_REQUIRED_PARAMETER:"MISSING_REQUIRED_PARAMETER",CHOOSE_DESKTOP_MEDIA_CANCELLED:"CHOOSE_DESKTOP_MEDIA_CANCELLED",SDK_ERROR:"SDK_ERROR"},ErrorCode:{UNEXPECTED_ERROR:"UNEXPECTED_ERROR",CONSTRAINT_VIOLATION:"CONSTRAINT_VIOLATION",MAX_NUM_CONV_PARTICIPANTS:"MAX_NUM_CONV_PARTICIPANTS",THIRDPARTY_ERROR:"THIRDPARTY_ERROR",AUTHORIZATION_FAILED:"AUTHORIZATION_FAILED",PERMISSION_DENIED:"PERMISSION_DENIED",RTC_NO_MEDIA_NODES_AVAILABLE:"RTC_NO_MEDIA_NODES_AVAILABLE",RTC_CONCURRENT_INCOMING_CALL:"RTC_CONCURRENT_INCOMING_CALL",DUPLICATED_ENTITY_ERROR:"DUPLICATED_ENTITY_ERROR",RTC_MEDIA_NODE_UNREACHABLE:"RTC_MEDIA_NODE_UNREACHABLE"},ThirdPartyError:{UNSUPPORTED_PROVIDER:"UNSUPPORTED_PROVIDER",BAD_REQUEST:"BAD_REQUEST",GENERAL_ERROR:"GENERAL_ERROR",INSUFFICIENT_PERMISSION:"INSUFFICIENT_PERMISSION",NOT_AUTHORIZED:"NOT_AUTHORIZED",RESOURCE_NOT_FOUND:"RESOURCE_NOT_FOUND",SERVER_DOWN:"SERVER_DOWN",SESSION_EXPIRED:"SESSION_EXPIRED",UNSUPPORTED_FILE_TYPE:"UNSUPPORTED_FILE_TYPE",WRONG_SERVER:"WRONG_SERVER",EMPTY_SETTINGS:"EMPTY_SETTINGS",EMPTY_USERNAME:"EMPTY_USERNAME",EMPTY_PASSWORD:"EMPTY_PASSWORD",EMPTY_SERVER_ADDRESS:"EMPTY_SERVER_ADDRESS",INVALID_SERVER_ADDRESS:"INVALID_SERVER_ADDRESS",NOT_CONNECTED:"NOT_CONNECTED",INVALID_ITEMIDS:"INVALID_ITEMIDS"},ConversationActionType:{CREATE:"CREATE",UPDATE:"UPDATE",DELETE:"DELETE",ADD_PARTICIPANT:"ADD_PARTICIPANT",REMOVE_PARTICIPANT:"REMOVE_PARTICIPANT",ADD_TEXT_ITEM:"ADD_TEXT_ITEM",UPDATE_TEXT_ITEM:"UPDATE_TEXT_ITEM",DELETE_TEXT_ITEM:"DELETE_TEXT_ITEM",GET_CONVERSATION_BY_ID:"GET_CONVERSATION_BY_ID",GET_CONVERSATIONS:"GET_CONVERSATIONS",GET_ITEM_BY_ID:"GET_ITEM_BY_ID",GET_ITEMS_BY_CONVERSATION:"GET_ITEMS_BY_CONVERSATION",GET_ITEMS_BY_CONVERSATION_ITEM_ID:"GET_ITEMS_BY_CONVERSATION_ITEM_ID",SET_READ_POINTER:"SET_READ_POINTER",SUBSCRIBE:"SUBSCRIBE",UNSUBSCRIBE:"UNSUBSCRIBE",TYPING:"TYPING",GET_CONVERSATION_USER_DATA:"GET_CONVERSATION_USER_DATA",SET_FLAG_ITEM:"SET_FLAG_ITEM",CLEAR_FLAG_ITEM:"CLEAR_FLAG_ITEM",GET_FLAGGED_ITEMS:"GET_FLAGGED_ITEMS",GET_JOIN_DETAILS:"GET_JOIN_DETAILS",GET_SUPPORT_CONVERSATION_ID:"GET_SUPPORT_CONVERSATION_ID",GET_SUPPORT_CONVERSATION:"GET_SUPPORT_CONVERSATION",GET_OPEN_CONVERSATIONS:"GET_OPEN_CONVERSATIONS",JOIN_OPEN_CONVERSATION:"JOIN_OPEN_CONVERSATION",MARK_CONVERSATION:"MARK_CONVERSATION",UNMARK_CONVERSATION:"UNMARK_CONVERSATION",GET_MARKED_CONVERSATIONS_LIST:"GET_MARKED_CONVERSATIONS_LIST",SET_CONVERSATION_AVATAR:"SET_CONVERSATION_AVATAR",GET_TELEPHONY_CONVERSATION_ID:"GET_TELEPHONY_CONVERSATION_ID",GET_ATTACHMENTS:"GET_ATTACHMENTS",GET_CONVERSATION_BY_USER:"GET_CONVERSATION_BY_USER",GET_CONVERSATION_SUMMARY:"GET_CONVERSATION_SUMMARY",LIKE_TEXT_ITEM:"LIKE_TEXT_ITEM",UNLIKE_TEXT_ITEM:"UNLIKE_TEXT_ITEM",DELETE_RECORDING:"DELETE_RECORDING",MODERATE_CONVERSATION:"MODERATE_CONVERSATION",UNMODERATE_CONVERSATION:"UNMODERATE_CONVERSATION",ADD_SCHEDULE_ITEM:"ADD_SCHEDULE_ITEM",UPDATE_SCHEDULE_ITEM:"UPDATE_SCHEDULE_ITEM",DELETE_SCHEDULE_ITEM:"DELETE_SCHEDULE_ITEM",GET_ALL_USER_SCHEDULE_ITEMS:"GET_ALL_USER_SCHEDULE_ITEMS",GRANT_MODERATOR_RIGHTS:"GRANT_MODERATOR_RIGHTS",DROP_MODERATOR_RIGHTS:"DROP_MODERATOR_RIGHTS",GET_CONVERSATION_THREADS:"GET_CONVERSATION_THREADS",GET_THREAD_COMMENTS:"GET_THREAD_COMMENTS",GET_THREADS_BY_IDS:"GET_THREADS_BY_IDS",ADD_JOURNAL_ENTRY:"ADD_JOURNAL_ENTRY",GET_THREADS_BY_ITEM_IDS:"GET_THREADS_BY_ITEM_IDS",DELETE_ATTACHMENTS:"DELETE_ATTACHMENTS",UPDATE_GUEST_ACCESS:"UPDATE_GUEST_ACCESS",GET_CONVERSATION_PARTICIPANTS:"GET_CONVERSATION_PARTICIPANTS",GET_CONVERSATION_FEED:"GET_CONVERSATION_FEED",SET_FAVORITE_POSITION:"SET_FAVORITE_POSITION",ADD_LABELS:"ADD_LABELS",ASSIGN_LABELS:"ASSIGN_LABELS",UNASSIGN_LABELS:"UNASSIGN_LABELS",GET_LABELS:"GET_LABELS",GET_LABEL_PAGE:"GET_LABEL_PAGE",REMOVE_LABELS:"REMOVE_LABELS",EDIT_LABEL:"EDIT_LABEL",UPDATE_RTC_ITEM_ATTACHMENTS:"UPDATE_RTC_ITEM_ATTACHMENTS",GET_CONVERSATIONS_BY_FILTER:"GET_CONVERSATIONS_BY_FILTER",ADD_FILTER:"ADD_FILTER",REMOVE_FILTERS:"REMOVE_FILTERS",GET_FILTERS:"GET_FILTERS",EDIT_FILTER:"EDIT_FILTER",GET_FAVORITE_CONVERSATION_IDS:"GET_FAVORITE_CONVERSATION_IDS",GET_CONVERSATIONS_BY_IDS:"GET_CONVERSATIONS_BY_IDS"},ConversationEventType:{CREATE:"CREATE",UPDATE:"UPDATE",DELETE:"DELETE",ADD_ITEM:"ADD_ITEM",UPDATE_ITEM:"UPDATE_ITEM",READ_ITEMS:"READ_ITEMS",TYPING:"TYPING",DRAFT_MESSAGE_SAVED:"DRAFT_MESSAGE_SAVED",DRAFT_MESSAGE_DISCARDED:"DRAFT_MESSAGE_DISCARDED",DRAFT_MESSAGE_PUBLISHED:"DRAFT_MESSAGE_PUBLISHED",FLAG_ITEM:"FLAG_ITEM",CLEAR_FLAGGED_ITEM:"CLEAR_FLAGGED_ITEM",CONVERSATION_MARKED:"CONVERSATION_MARKED",CONVERSATION_UNMARKED:"CONVERSATION_UNMARKED",FAVORITE_POSITION_CHANGED:"FAVORITE_POSITION_CHANGED",USER_DATA_CHANGED:"USER_DATA_CHANGED"},SearchDirection:{AFTER:"AFTER",BEFORE:"BEFORE",BOTH:"BOTH"},TimestampFilter:{MODIFICATION:"MODIFICATION",CREATION:"CREATION"},OrderBy:{TIMESTAMP_ASC:"TIMESTAMP_ASC",TIMESTAMP_DESC:"TIMESTAMP_DESC"},OrderType:{MODIFICATION:"MODIFICATION",CREATION:"CREATION"},ConversationType:{DIRECT:"DIRECT",GROUP:"GROUP",OPEN:"OPEN",LARGE:"LARGE"},ConversationItemType:{TEXT:"TEXT",RTC:"RTC",SYSTEM:"SYSTEM"},ConversationFilter:{ALL:"ALL",OPEN_MEMBER:"OPEN_MEMBER",MARKED:"MARKED",ARCHIVED:"ARCHIVED",UNARCHIVED:"UNARCHIVED"},ConversationMarkFilter:{MUTE:"MUTE",FAVORITE:"FAVORITE"},GetConversationParticipantCriteria:{DISPLAY_NAME:"DISPLAY_NAME",TYPE:"TYPE"},ConversationParticipantType:{ACTIVE:"ACTIVE",REGULAR:"REGULAR",FORMER:"FORMER",MODERATOR:"MODERATOR",GUEST:"GUEST"},DataRetentionState:{UNTOUCHED:"UNTOUCHED",OUTDATED:"OUTDATED",DELETED:"DELETED"},RTCItemType:{STARTED:"STARTED",ENDED:"ENDED",MISSED:"MISSED",PARTICIPANT_JOINED:"PARTICIPANT_JOINED",PARTICIPANT_LEFT:"PARTICIPANT_LEFT",MOVED:"MOVED"},RTCItemMissed:{UNREACHABLE:"UNREACHABLE",TIMEOUT:"TIMEOUT",USER_BUSY:"USER_BUSY",DECLINED:"DECLINED",CANCELED:"CANCELED",INVALID_NUMBER:"INVALID_NUMBER",TEMPORARILY_UNAVAILABLE:"TEMPORARILY_UNAVAILABLE"},RTCItemMoved:{MOVED_FROM:"MOVED_FROM",MOVED_TO:"MOVED_TO"},ExternalUnshareProviderType:{SYNCPLICITY:"SYNCPLICITY"},SortingType:{RECENT_ACTIVITY_ASC:"RECENT_ACTIVITY_ASC",RECENT_ACTIVITY_DESC:"RECENT_ACTIVITY_DESC",ALPHABETICALLY_ASC:"ALPHABETICALLY_ASC",ALPHABETICALLY_DESC:"ALPHABETICALLY_DESC",POPULARITY_ASC:"POPULARITY_ASC",POPULARITY_DESC:"POPULARITY_DESC",TIMESTAMP_ASC:"TIMESTAMP_ASC"},TextItemContentType:{PLAIN:"PLAIN",RICH:"RICH"},TextItemState:{CREATED:"CREATED",EDITED:"EDITED",DELETED:"DELETED",CLUSTERED:"CLUSTERED"},SystemItemType:{CONVERSATION_CREATED:"CONVERSATION_CREATED",PARTICIPANT_ADDED:"PARTICIPANT_ADDED",PARTICIPANT_REMOVED:"PARTICIPANT_REMOVED",CONVERSATION_RENAMED:"CONVERSATION_RENAMED",GUEST_JOINED:"GUEST_JOINED",GUEST_INVITED:"GUEST_INVITED",CONFERENCE_DETAILS_CHANGED:"CONFERENCE_DETAILS_CHANGED",CONVERSATION_MODERATED:"CONVERSATION_MODERATED"},AttachmentOrderType:{CREATION:"CREATION",FILENAME:"FILENAME",SIZE:"SIZE",MIMETYPE:"MIMETYPE",FILEEXTENSION:"FILEEXTENSION"},AttachmentOrderDirection:{ASC:"ASC",DSC:"DSC"},BridgeLocale:{EN_US:"EN_US",EN_GB:"EN_GB",DE_DE:"DE_DE",ES_ES:"ES_ES",FR_FR:"FR_FR",IT_IT:"IT_IT",RU_RU:"RU_RU",ZH_HANS_CN:"ZH_HANS_CN"},BridgeNumberType:{TOLL:"TOLL",TOLL_FREE:"TOLL_FREE",LOCAL:"LOCAL"},FilterTarget:{CONVERSATION_TYPE:"CONVERSATION_TYPE",LABEL_ID:"LABEL_ID"},FilterTargetComparator:{EQ:"EQ",NOT:"NOT"},FilterBoolConnector:{AND:"AND",OR:"OR"},SystemLabel:{ARCHIVED:"ARCHIVED"},IncludedUserData:{LAST_READ_TS:"LASTREADTS",UNREAD_COUNT:"UNREADCOUNT",LABEL_IDS:"LABELIDS",SYSTEM_LABEL_IDS:"SYSTEMLABELIDS"},InstrumentationActionType:{SUBMIT_CLIENT_DATA:"SUBMIT_CLIENT_DATA",SUBMIT_QOS_DATA:"SUBMIT_QOS_DATA"},SubmitDataResult:{UNKNOWN:"UNKNOWN",OK:"OK",NO_USERID:"NO_USERID",NO_CLIENTID:"NO_CLIENTID",NO_DATA:"NO_DATA",PROCESSING_ERROR:"PROCESSING_ERROR"},QOSMediaType:{AUDIO:"AUDIO",VIDEO:"VIDEO",SCREEN_SHARE:"SCREEN_SHARE"},RTCCallActionType:{JOIN:"JOIN",ANSWER:"ANSWER",ICE_CANDIDATES:"ICE_CANDIDATES",LEAVE:"LEAVE",TERMINATE:"TERMINATE",CHANGE_MEDIA_TYPE:"CHANGE_MEDIA_TYPE",INVITE_REJECT:"INVITE_REJECT",CHANGE_MEDIA_ACCEPT:"CHANGE_MEDIA_ACCEPT",CHANGE_MEDIA_REJECT:"CHANGE_MEDIA_REJECT",PREPARE:"PREPARE",RENEW_TURN_CREDENTIALS:"RENEW_TURN_CREDENTIALS",SEND_PROGRESS:"SEND_PROGRESS"},RTCCallEventType:{SDP_ANSWER:"SDP_ANSWER",SDP_FAILED:"SDP_FAILED",INVITE:"INVITE",INVITE_CANCEL:"INVITE_CANCEL",INVITE_FAILED:"INVITE_FAILED",CHANGE_MEDIA_TYPE_REQUESTED:"CHANGE_MEDIA_TYPE_REQUESTED",PROGRESS:"PROGRESS",CHANGE_MEDIA_TYPE_FORCED:"CHANGE_MEDIA_TYPE_FORCED",ICE_CANDIDATES:"ICE_CANDIDATES"},SdpFailedCause:{SESSION_STARTED_FAILED:"SESSION_STARTED_FAILED",CONNECTION_LOST:"CONNECTION_LOST",SERVICE_ERROR:"SERVICE_ERROR",CHANGE_MEDIA_REJECT:"CHANGE_MEDIA_REJECT",JOIN_FORBIDDEN:"JOIN_FORBIDDEN",SESSION_TERMINATED:"SESSION_TERMINATED"},InviteCancelCause:{ACCEPT:"ACCEPT",BUSY:"BUSY",DECLINE:"DECLINE",REVOKED:"REVOKED"},InviteFailedCause:{BUSY:"BUSY",DECLINE:"DECLINE",TIMEOUT:"TIMEOUT",NOT_REACHABLE:"NOT_REACHABLE",INVALID_NUMBER:"INVALID_NUMBER",TEMPORARILY_UNAVAILABLE:"TEMPORARILY_UNAVAILABLE",REVOKED:"REVOKED"},InviteRejectCause:{BUSY:"BUSY",DECLINE:"DECLINE",TIMEOUT:"TIMEOUT"},RTCProgressType:{ALERTING:"ALERTING",PROGRESS:"PROGRESS",EARLY_CONNECT:"EARLY_CONNECT"},DisconnectCause:{HANGUP:"HANGUP",CONNECTION_LOST:"CONNECTION_LOST",NEGOTIATION_FAILED:"NEGOTIATION_FAILED",TRANSPORT_NEGOTIATION_FAILED:"TRANSPORT_NEGOTIATION_FAILED",SECURITY_NEGOTIATION_FAILED:"SECURITY_NEGOTIATION_FAILED",REMOTE_SDP_FAILED:"REMOTE_SDP_FAILED",STREAM_LOST:"STREAM_LOST",CALL_SETUP_FAILED:"CALL_SETUP_FAILED"},DisconnectReason:{PAGE_UNLOADED:"PAGE_UNLOADED",CALL_LOST:"CALL_LOST",LOGOUT:"LOGOUT"},RTCSessionActionType:{LOCK:"LOCK",MUTE_SESSION:"MUTE_SESSION",MUTE:"MUTE",ADD_PARTICIPANT:"ADD_PARTICIPANT",REMOVE_PARTICIPANT:"REMOVE_PARTICIPANT",GET_ACTIVE_SESSIONS:"GET_ACTIVE_SESSIONS",GET_SESSION:"GET_SESSION",MOVE:"MOVE",START_RECORDING:"START_RECORDING",STOP_RECORDING:"STOP_RECORDING",RAISE_QUESTION:"RAISE_QUESTION",INVITE_TO_STAGE:"INVITE_TO_STAGE",INVITE_TO_STAGE_ANSWER:"INVITE_TO_STAGE_ANSWER",UPDATE_QUESTION_STATE:"UPDATE_QUESTION_STATE",INVITE_TO_STAGE_CANCEL:"INVITE_TO_STAGE_CANCEL",REMOVE_FROM_STAGE:"REMOVE_FROM_STAGE",GET_QUESTIONS:"GET_QUESTIONS",OPEN_CURTAIN:"OPEN_CURTAIN",CLOSE_CURTAIN:"CLOSE_CURTAIN",GET_NODE_STATE:"GET_NODE_STATE",ENABLE_WHITEBOARD:"ENABLE_WHITEBOARD",DISABLE_WHITEBOARD:"DISABLE_WHITEBOARD",ADD_WHITEBOARD_ELEMENT:"ADD_WHITEBOARD_ELEMENT",REMOVE_WHITEBOARD_ELEMENT:"REMOVE_WHITEBOARD_ELEMENT",UPDATE_WHITEBOARD_ELEMENT:"UPDATE_WHITEBOARD_ELEMENT",CLEAR_WHITEBOARD:"CLEAR_WHITEBOARD",GET_WHITEBOARD:"GET_WHITEBOARD"},RTCSessionEventType:{SESSION_STARTED:"SESSION_STARTED",SESSION_TERMINATED:"SESSION_TERMINATED",SESSION_UPDATED:"SESSION_UPDATED",SESSION_MOVED:"SESSION_MOVED",PARTICIPANT_JOINED:"PARTICIPANT_JOINED",PARTICIPANT_LEFT:"PARTICIPANT_LEFT",PARTICIPANT_UPDATED:"PARTICIPANT_UPDATED",ACTIVE_SPEAKER:"ACTIVE_SPEAKER",VIDEO_ACTIVE_SPEAKER:"VIDEO_ACTIVE_SPEAKER",SESSION_RECORDING_INFO:"SESSION_RECORDING_INFO",SESSION_RECORDING_STARTED:"SESSION_RECORDING_STARTED",SESSION_RECORDING_STOPPED:"SESSION_RECORDING_STOPPED",SESSION_RECORDING_FAILED:"SESSION_RECORDING_FAILED",SESSION_TERMINATION_TIMER_STARTED:"SESSION_TERMINATION_TIMER_STARTED",SESSION_TERMINATION_TIMER_CANCELLED:"SESSION_TERMINATION_TIMER_CANCELLED",SESSION_ATTRIBUTES_CHANGED_EVENT:"SESSION_ATTRIBUTES_CHANGED_EVENT",QUESTION_EVENT:"QUESTION_EVENT",INVITE_TO_STAGE_EVENT:"INVITE_TO_STAGE_EVENT",INVITE_TO_STAGE_CANCEL_EVENT:"INVITE_TO_STAGE_CANCEL_EVENT",CURTAIN_EVENT:"CURTAIN_EVENT",WHITEBOARD_ENABLED:"WHITEBOARD_ENABLED",WHITEBOARD_DISABLED:"WHITEBOARD_DISABLED",WHITEBOARD_ELEMENT_ADDED:"WHITEBOARD_ELEMENT_ADDED",WHITEBOARD_ELEMENT_REMOVED:"WHITEBOARD_ELEMENT_REMOVED",WHITEBOARD_ELEMENT_UPDATED:"WHITEBOARD_ELEMENT_UPDATED",WHITEBOARD_CLEARED:"WHITEBOARD_CLEARED"},RTCSessionTerminatedCause:{FORCED:"FORCED",NO_USERS_LEFT:"NO_USERS_LEFT",CONDITIONAL:"CONDITIONAL"},RTCSessionParticipantLeftCause:{LEFT:"LEFT",CONNECTION_LOST:"CONNECTION_LOST",REMOVED:"REMOVED",CONDITIONAL_TERMINATE:"CONDITIONAL_TERMINATE",FORCED_TERMINATE:"FORCED_TERMINATE",MAX_PARTICIPANTS_REACHED:"MAX_PARTICIPANTS_REACHED",USER_LEFT_STAGE:"USER_LEFT_STAGE",NEGOTIATION_FAILED:"NEGOTIATION_FAILED",OFFER_NOT_ACCEPTED:"OFFER_NOT_ACCEPTED",STREAM_LOST:"STREAM_LOST",TRANSPORT_NEGOTIATION_FAILED:"TRANSPORT_NEGOTIATION_FAILED",SECURITY_NEGOTIATION_FAILED:"SECURITY_NEGOTIATION_FAILED",CALL_SETUP_FAILED:"CALL_SETUP_FAILED",REMOTE_SDP_FAILED:"REMOTE_SDP_FAILED"},RealtimeMediaType:{AUDIO:"AUDIO",VIDEO:"VIDEO",DESKTOP_SHARING:"DESKTOP_SHARING"},RTCParticipantType:{USER:"USER",EXTERNAL:"EXTERNAL",TELEPHONY:"TELEPHONY",SESSION_GUEST:"SESSION_GUEST",MEETING_POINT:"MEETING_POINT"},QuestionState:{RAISED:"RAISED",ANSWERED:"ANSWERED",DISCARDED:"DISCARDED",ANSWER_LATER:"ANSWER_LATER"},StageState:{INITIAL:"INITIAL",INVITED:"INVITED",REJECTED:"REJECTED",ACCEPTED:"ACCEPTED",WAS_ON_STAGE:"WAS_ON_STAGE",TIMEOUT:"TIMEOUT",LEFT_CONFERENCE:"LEFT_CONFERENCE"},QuestionEventType:{CREATED:"CREATED",UPDATED:"UPDATED",REVOKED:"REVOKED"},StageAction:{USER_ENTERED_STAGE:"USER_ENTERED_STAGE",USER_LEFT_STAGE:"USER_LEFT_STAGE"},CurtainState:{OPEN:"OPEN",INITIAL:"INITIAL",FINAL:"FINAL",PAUSED:"PAUSED"},NodeType:{MEDIA_ACCESS:"MEDIA_ACCESS",APPLICATION:"APPLICATION",STORAGE:"STORAGE",ACCESS:"ACCESS",LOAD_BALANCER:"LOAD_BALANCER",ZOOKEEPER:"ZOOKEEPER",MANAGEMENT:"MANAGEMENT",OPERATIONS:"OPERATIONS"},NodeState:{UP:"UP",DOWN:"DOWN",OVERLOAD:"OVERLOAD",MAINTENANCE:"MAINTENANCE"},RecordingInfoState:{INITIAL:"INITIAL",START_PENDING:"START_PENDING",STARTED:"STARTED",STOPPED:"STOPPED",FINISHED:"FINISHED"},RecordingInfoReason:{NONE:"NONE",STOPPED_MANUALLY:"STOPPED_MANUALLY",STOPPED_AUTOMATICALLY:"STOPPED_AUTOMATICALLY",NO_INPUT_TIMEOUT:"NO_INPUT_TIMEOUT",MAX_INPUT_TIMEOUT:"MAX_INPUT_TIMEOUT",NO_STREAMING_DATA:"NO_STREAMING_DATA",LENGTH_LIMIT_REACHED:"LENGTH_LIMIT_REACHED",NO_MORE_DISK_SPACE_LEFT:"NO_MORE_DISK_SPACE_LEFT",UNKNOWN_ERROR:"UNKNOWN_ERROR"},RecordingTriggerReason:{USER:"USER",CURTAIN:"CURTAIN"},SearchActionType:{START_BASIC_SEARCH:"START_BASIC_SEARCH",START_DETAIL_SEARCH:"START_DETAIL_SEARCH",START_USER_SEARCH:"START_USER_SEARCH",CANCEL_SEARCH:"CANCEL_SEARCH",ADD_RECENT_SEARCH:"ADD_RECENT_SEARCH",GET_RECENT_SEARCHES:"GET_RECENT_SEARCHES",SEARCH_CONVERSATION_PARTICIPANTS:"SEARCH_CONVERSATION_PARTICIPANTS"},SearchEventType:{BASIC_SEARCH_RESULT:"BASIC_SEARCH_RESULT",DETAILED_SEARCH_RESULT:"DETAILED_SEARCH_RESULT",SEARCH_STATUS:"SEARCH_STATUS",RECENT_SEARCH_ADDED:"RECENT_SEARCH_ADDED"},SystemActionType:{GET_GLOBAL_PROPERTY:"GET_GLOBAL_PROPERTY",GET_GLOBAL_PROPERTIES:"GET_GLOBAL_PROPERTIES"},SystemEventType:{MAINTENANCE:"MAINTENANCE",CLIENT_UPDATE:"CLIENT_UPDATE"},GlobalPropertyName:{ATTACHMENT_UPLOAD_MAX_SIZE:"ATTACHMENT_UPLOAD_MAX_SIZE",CONV_PARTICIPANTS_MAX_SIZE:"CONV_PARTICIPANTS_MAX_SIZE",
CONV_PARTICIPANTS_ADD_LIMIT:"CONV_PARTICIPANTS_ADD_LIMIT",XMPP_FEDERATION_ENABLED:"XMPP_FEDERATION_ENABLED"},SearchTypes:{CONVERSATION:"CONVERSATION",USER:"USER"},SearchStatusCode:{ERROR:"ERROR",CANCELED:"CANCELED",FINISHED:"FINISHED",TIMEOUT:"TIMEOUT",NO_RESULT:"NO_RESULT",MORE_RESULT:"MORE_RESULT"},SearchResultType:{TOPIC_MATCH:"TOPIC_MATCH",USER_MATCH:"USER_MATCH",ATTACHMENT_MATCH:"ATTACHMENT_MATCH",ITEM_MATCH:"ITEM_MATCH"},SearchScope:{ALL:"ALL",PEOPLE:"PEOPLE",MEMBERS:"MEMBERS",MESSAGES:"MESSAGES",CONVERSATIONS:"CONVERSATIONS",FILES:"FILES",SENT_BY:"SENT_BY",DATE:"DATE",LABEL:"LABEL",FILTER:"FILTER"},UserActionType:{WAKE_UP:"WAKE_UP",GO_TO_SLEEP:"GO_TO_SLEEP",LOGON:"LOGON",LOGOUT:"LOGOUT",RENEW_TOKEN:"RENEW_TOKEN",GET_USER_BY_ID:"GET_USER_BY_ID",UPDATE:"UPDATE",GET_LOGGED_ON:"GET_LOGGED_ON",GET_STUFF:"GET_STUFF",SET_PRESENCE:"SET_PRESENCE",GET_PRESENCE:"GET_PRESENCE",SUBSCRIBE_PRESENCE:"SUBSCRIBE_PRESENCE",UNSUBSCRIBE_PRESENCE:"UNSUBSCRIBE_PRESENCE",CHANGE_PASSWORD:"CHANGE_PASSWORD",GET_USERS_BY_IDS:"GET_USERS_BY_IDS",GET_DEVICES:"GET_DEVICES",GET_USER_SETTINGS:"GET_USER_SETTINGS",SET_USER_SETTINGS:"SET_USER_SETTINGS",GET_USER_BY_MAIL:"GET_USER_BY_MAIL",GET_USERS_BY_MAILS:"GET_USERS_BY_MAILS",EMAIL_UPDATE:"EMAIL_UPDATE",GENERATE_EMAIL_UPDATE_TOKEN:"GENERATE_EMAIL_UPDATE_TOKEN",GET_TELEPHONY_DATA:"GET_TELEPHONY_DATA",GET_USER_EXTENSIONS:"GET_USER_EXTENSIONS",SET_USER_EXTENSION_STATE:"SET_USER_EXTENSION_STATE",GET_LDAP_TECHNICAL_USER_PRESENCE:"GET_LDAP_TECHNICAL_USER_PRESENCE",GET_ATTACHMENTS:"GET_ATTACHMENTS",SET_PASSWORD:"SET_PASSWORD",SUBSCRIBE_DEVICES:"SUBSCRIBE_DEVICES",UNSUBSCRIBE_DEVICES:"UNSUBSCRIBE_DEVICES",OAUTH_GET_GRANTED_ACCESS_TOKENS:"OAUTH_GET_GRANTED_ACCESS_TOKENS",OAUTH_REVOKE_ACCESS_TOKEN:"OAUTH_REVOKE_ACCESS_TOKEN",REVOKE_MANAGED_DEVICES:"REVOKE_MANAGED_DEVICES",GET_SECURITY_TOKEN_INFO:"GET_SECURITY_TOKEN_INFO",REVOKE_SECURITY_TOKEN:"REVOKE_SECURITY_TOKEN"},UserEventType:{ATC_REFRESH_FAILED:"ATC_REFRESH_FAILED",USER_PRESENCE_CHANGE:"USER_PRESENCE_CHANGE",USER_UPDATED:"USER_UPDATED",SESSION_EXPIRES:"SESSION_EXPIRES",SESSION_EXPIRING:"SESSION_EXPIRING",SESSION_CLOSED:"SESSION_CLOSED",PASSWORD_CHANGED:"PASSWORD_CHANGED",USER_SETTING_UPDATED:"USER_SETTING_UPDATED",TELEPHONY_DATA:"TELEPHONY_DATA",DEVICE_LIST_CHANGED:"DEVICE_LIST_CHANGED",NOTIFICATION_SUBSCRIPTION_CHANGE:"NOTIFICATION_SUBSCRIPTION_CHANGE"},GetStuffType:{USER:"USER",ACCOUNTS:"ACCOUNTS",FIRST_WEB_LOGIN:"FIRST_WEB_LOGIN",PRESENCE_STATE:"PRESENCE_STATE",RECENT_SEARCHES:"RECENT_SEARCHES",SETTINGS:"SETTINGS",TENANT_DATA:"TENANT_DATA",SUPPORT_CONVERSATION_ID:"SUPPORT_CONVERSATION_ID",TELEPHONY_CONVERSATION_ID:"TELEPHONY_CONVERSATION_ID",GLOBAL_PROPERTIES:"GLOBAL_PROPERTIES",TENANT:"TENANT",NOTIFICATION_SUBSCRIPTIONS:"NOTIFICATION_SUBSCRIPTIONS"},NotificationSubscriptionType:{ONLINE_STATUS:"ONLINE_STATUS"},NotificationSubscriptionAction:{SUBSCRIBE:"SUBSCRIBE",UNSUBSCRIBE:"UNSUBSCRIBE"},DeviceType:{PHONE:"PHONE",WEB:"WEB",APPLICATION:"APPLICATION",MOBILE:"MOBILE",SDK:"SDK"},PresenceState:{AVAILABLE:"AVAILABLE",OFFLINE:"OFFLINE",AWAY:"AWAY",BUSY:"BUSY",DND:"DND"},ChangePasswordResult:{OK:"OK",NEW_INVALID:"NEW_INVALID",OLD_INVALID:"OLD_INVALID",ALREADY_CHANGED:"ALREADY_CHANGED",OPERATION_ERROR:"OPERATION_ERROR"},SetPasswordResult:{OK:"OK",NOT_OK:"NOT_OK"},SessionClosedReason:{NEW_CONNECTION_DETECTED:"NEW_CONNECTION_DETECTED",UPGRADE_REQUIRED:"UPGRADE_REQUIRED",SUSPENDED:"SUSPENDED",DELETED:"DELETED",TENANT_DELETED:"TENANT_DELETED",TENANT_SUSPENDED:"TENANT_SUSPENDED"},RecordingStoppedReason:{LENGTH_LIMIT_REACHED:"LENGTH_LIMIT_REACHED",NO_INPUT:"NO_INPUT"},RecordingUploadState:{IN_PROGRESS:"IN_PROGRESS",RETRYING:"RETRYING",FINISHED:"FINISHED",FAILED:"FAILED",DELETED:"DELETED"},UserRole:{GUEST:"GUEST",USER:"USER",TENANT_ADMIN:"TENANT_ADMIN",SUPPORT:"SUPPORT",SYSTEM_ADMIN:"SYSTEM_ADMIN",TELEPHONY_CONNECTOR:"TELEPHONY_CONNECTOR",VIRTUAL_TELEPHONY_CONNECTOR:"VIRTUAL_TELEPHONY_CONNECTOR",SESSION_GUEST:"SESSION_GUEST",MEETING_POINT:"MEETING_POINT",BOT:"BOT"},UserType:{REGULAR:"REGULAR",GUEST:"GUEST",SUPPORT:"SUPPORT",TELEPHONY:"TELEPHONY",SESSION_GUEST:"SESSION_GUEST",MEETING_POINT:"MEETING_POINT",TECHNICAL:"TECHNICAL",BOT:"BOT",XMPP:"XMPP"},UserState:{INACTIVE:"INACTIVE",ACTIVE:"ACTIVE",SUSPENDED:"SUSPENDED",DELETED:"DELETED",PURGED:"PURGED"},Locale:{EN_US:"EN_US",DE_DE:"DE_DE",ES_ES:"ES_ES",FR_FR:"FR_FR",IT_IT:"IT_IT",RU_RU:"RU_RU",ZH_HANS_CN:"ZH_HANS_CN"},PhoneNumberType:{WORK:"WORK",MOBILE:"MOBILE",HOME:"HOME",FAX:"FAX",OTHER:"OTHER"},EmailAddressType:{WORK:"WORK",HOME:"HOME",OTHER:"OTHER"},UserSettingArea:{ALL:"ALL",EMAIL:"EMAIL",DESKTOP:"DESKTOP",PRIVACY:"PRIVACY",CLIENT:"CLIENT"},UserSettingDataType:{BOOLEAN:"BOOLEAN",NUMBER:"NUMBER",STRING:"STRING",TIMESTAMP:"TIMESTAMP"},UserSettingKey:{EMAIL_INVITES:"EMAIL_INVITES",EMAIL_MISSED_RTC:"EMAIL_MISSED_RTC",EMAIL_SUMMARY:"EMAIL_SUMMARY",EMAIL_UPDATE:"EMAIL_UPDATE",DESKTOP_RTC:"DESKTOP_RTC",DESKTOP_MISSED_MESSAGE:"DESKTOP_MISSED_MESSAGE",DESKTOP_CONVERSATION_CHANGE:"DESKTOP_CONVERSATION_CHANGE",DESKTOP_SYSINFO:"DESKTOP_SYSINFO",SHARE_LOCATION:"SHARE_LOCATION",RELEASE_NOTES_WEB_VERSION:"RELEASE_NOTES_WEB_VERSION",RELEASE_NOTES_MOBILE_VERSION:"RELEASE_NOTES_MOBILE_VERSION",TM_WEB_START_CONV_WITH:"TM_WEB_START_CONV_WITH",TM_WEB_ENTER_NAME:"TM_WEB_ENTER_NAME",TM_WEB_CALL_ACTION_BUTTONS:"TM_WEB_CALL_ACTION_BUTTONS",TM_WEB_SUPPORT_FEEDBACK:"TM_WEB_SUPPORT_FEEDBACK",TM_WEB_SUPPORT_ISSUE:"TM_WEB_SUPPORT_ISSUE",TM_WEB_SCREEN_SHARING_ENABLED:"TM_WEB_SCREEN_SHARING_ENABLED",TM_WEB_SEARCH_FILTER:"TM_WEB_SEARCH_FILTER",AUDIO_WEB_SOUNDS:"AUDIO_WEB_SOUNDS",TM_WEB_OPEN_CONVERSATION:"TM_WEB_OPEN_CONVERSATION",TM_WEB_ADD_CONVERSATION_TITLE:"TM_WEB_ADD_CONVERSATION_TITLE",TM_WEB_RICH_TEXT_EDITING:"TM_WEB_RICH_TEXT_EDITING",TM_WEB_MUTE_CONVERSATION:"TM_WEB_MUTE_CONVERSATION",TM_WEB_VIEW_MUTED_CONVERSATIONS:"TM_WEB_VIEW_MUTED_CONVERSATIONS",TM_WEB_LEAVING_CONVERSATION:"TM_WEB_LEAVING_CONVERSATION",TM_WEB_FOCUS_MODE:"TM_WEB_FOCUS_MODE",TM_WEB_CONFERENCE_DIAL_IN:"TM_WEB_CONFERENCE_DIAL_IN",TM_WEB_REMOVING_PARTICIPANTS:"TM_WEB_REMOVING_PARTICIPANTS",TM_WEB_FULL_SCREEN_MODES:"TM_WEB_FULL_SCREEN_MODES",TM_WEB_ADD_MULTIPLE_USERS:"TM_WEB_ADD_MULTIPLE_USERS",TM_WEB_THIRD_COLUMN:"TM_WEB_THIRD_COLUMN",TM_WEB_RESERVE_1:"TM_WEB_RESERVE_1",TM_WEB_RESERVE_2:"TM_WEB_RESERVE_2",TM_IOS_SEARCH:"TM_IOS_SEARCH",MOBILE_ENABLE_VIDEO_WIFI_ONLY:"MOBILE_ENABLE_VIDEO_WIFI_ONLY",TM_WEB_ADMIN_TELEPHONY_ENABLED:"TM_WEB_ADMIN_TELEPHONY_ENABLED",TM_WEB_TELPHONY_NUMBER_ASSIGNED:"TM_WEB_TELPHONY_NUMBER_ASSIGNED",TM_WEB_ACTIVE_SPEAKER_VIDEO:"TM_WEB_ACTIVE_SPEAKER_VIDEO",TM_WEB_FIRST_DIRECT_CONVERSATION:"TM_WEB_FIRST_DIRECT_CONVERSATION",TM_WEB_FIRST_GROUP_CONVERSATION:"TM_WEB_FIRST_GROUP_CONVERSATION",TM_WEB_FIRST_CONV_ADD_PARTCPNTS:"TM_WEB_FIRST_CONV_ADD_PARTCPNTS",TM_WEB_FIRST_CONV_SET_NAME:"TM_WEB_FIRST_CONV_SET_NAME",TM_WEB_FIRST_CONV_START_CONV:"TM_WEB_FIRST_CONV_START_CONV",TM_WEB_INVITE_USERS:"TM_WEB_INVITE_USERS",TM_WEB_EMERGENCY_CALL_DISCLAIMER:"TM_WEB_EMERGENCY_CALL_DISCLAIMER",TM_WEB_FIRST_DIRECT_PRIVATE_CONV:"TM_WEB_FIRST_DIRECT_PRIVATE_CONV",TM_WEB_FIRST_DIRECT_CONV_SAY_HI:"TM_WEB_FIRST_DIRECT_CONV_SAY_HI",TM_WEB_FIRST_DIRECT_CONV_ADD:"TM_WEB_FIRST_DIRECT_CONV_ADD",TM_WEB_GUEST_ACCESS:"TM_WEB_GUEST_ACCESS",TM_WEB_SHARE_CONFERENCE_DETAILS:"TM_WEB_SHARE_CONFERENCE_DETAILS",TM_WEB_START_RECORDING:"TM_WEB_START_RECORDING",TM_WEB_STOP_RECORDING_INIT:"TM_WEB_STOP_RECORDING_INIT",TM_WEB_STOP_RECORDING_PART:"TM_WEB_STOP_RECORDING_PART",TM_WEB_FIRST_CONF_RING_ALL:"TM_WEB_FIRST_CONF_RING_ALL",TM_WEB_FIRST_CALL_ACTIONS:"TM_WEB_FIRST_CALL_ACTIONS",TM_WEB_FIRST_CALL_GO_TO_FEED:"TM_WEB_FIRST_CALL_GO_TO_FEED",TM_WEB_FIRST_CALL_FULLSCREEN:"TM_WEB_FIRST_CALL_FULLSCREEN",FIRST_WEB_LOGIN_TIMESTAMP:"FIRST_WEB_LOGIN_TIMESTAMP",VOICEMAIL_ENABLED:"VOICEMAIL_ENABLED",VOICEMAIL_TIMEOUT:"VOICEMAIL_TIMEOUT",STATUS_MESSAGE_TEXT:"STATUS_MESSAGE_TEXT",OPT_OUT_PRESENCE:"OPT_OUT_PRESENCE",SECOND_TELEPHONY_CALL_ROUTING:"SECOND_TELEPHONY_CALL_ROUTING",ATC_ROUTING:"ATC_ROUTING",VOICEMAIL_CUSTOMGREETING_ENABLED:"VOICEMAIL_CUSTOMGREETING_ENABLED",VOICEMAIL_CUSTOMGREETING_URI:"VOICEMAIL_CUSTOMGREETING_URI"},OAuthScope:{ALL:"ALL",CALLS:"CALLS",READ_CONVERSATIONS:"READ_CONVERSATIONS",READ_USER:"READ_USER",READ_USER_PROFILE:"READ_USER_PROFILE",WRITE_CONVERSATIONS:"WRITE_CONVERSATIONS",WRITE_USER_PROFILE:"WRITE_USER_PROFILE"},AdministrationActionType:{INVITE_USER:"INVITE_USER",ADD_USER:"ADD_USER",INVITE_MULTIPLE_USERS:"INVITE_MULTIPLE_USERS",DELETE_USER:"DELETE_USER",VALIDATE_USER_INVITATION_TOKEN:"VALIDATE_USER_INVITATION_TOKEN",ACTIVATE_INVITED_USER:"ACTIVATE_INVITED_USER",RESEND_USER_INVITATION:"RESEND_USER_INVITATION",CHECK_INVALID_TENANTS:"CHECK_INVALID_TENANTS",GET_TENANT:"GET_TENANT",GET_SHARED_KEY:"GET_SHARED_KEY",EXPORT_TENANT:"EXPORT_TENANT",GET_ALL_TENANT_LOGIN_PROVIDERS:"GET_ALL_TENANT_LOGIN_PROVIDERS",UPLOAD_EXTENSION_CONFIGURATION:"UPLOAD_EXTENSION_CONFIGURATION",GET_TENANT_EXTENSIONS:"GET_TENANT_EXTENSIONS",SET_EXTENSION_STATE:"SET_EXTENSION_STATE",DELETE_EXTENSION:"DELETE_EXTENSION",REGENERATE_API_KEY:"REGENERATE_API_KEY",SET_TELEPHONY_TRUNK_DATA:"SET_TELEPHONY_TRUNK_DATA",GET_TELEPHONY_TRUNK_STATUS:"GET_TELEPHONY_TRUNK_STATUS",GET_TENANT_BRIDGE_NUMBERS:"GET_TENANT_BRIDGE_NUMBERS",SET_TENANT_BRIDGE_NUMBERS:"SET_TENANT_BRIDGE_NUMBERS",ADD_TRUNK:"ADD_TRUNK",GET_TENANT_TELEPHONY_CONFIGURATION:"GET_TENANT_TELEPHONY_CONFIGURATION",ADD_TRUNK_WITHOUT_PARAMETERS:"ADD_TRUNK_WITHOUT_PARAMETERS",SET_TRUNK_PASSWORD:"SET_TRUNK_PASSWORD",GET_TELEPHONY_ROUTING_RULES:"GET_TELEPHONY_ROUTING_RULES",ADD_TELEPHONY_ROUTING_RULE:"ADD_TELEPHONY_ROUTING_RULE",UPDATE_TELEPHONY_ROUTING_RULE:"UPDATE_TELEPHONY_ROUTING_RULE",REMOVE_TELEPHONY_ROUTING_RULE:"REMOVE_TELEPHONY_ROUTING_RULE",TEST_TELEPHONY_ROUTING_RULES:"TEST_TELEPHONY_ROUTING_RULES",UPDATE_TENANT_TELEPHONY_CONFIGURATION:"UPDATE_TENANT_TELEPHONY_CONFIGURATION",SUSPEND_USER:"SUSPEND_USER",UNSUSPEND_USER:"UNSUSPEND_USER",ASSIGN_PHONE_NUMBER:"ASSIGN_PHONE_NUMBER",INVITE_MULTIPLE_PARTNER_USERS:"INVITE_MULTIPLE_PARTNER_USERS",ADD_MEETING_POINT:"ADD_MEETING_POINT",ADD_MEETING_POINT_V2:"ADD_MEETING_POINT_V2",UPDATE_MEETING_POINT_V2:"UPDATE_MEETING_POINT_V2",SET_TENANT_SETTINGS:"SET_TENANT_SETTINGS",UPDATE_TENANT:"UPDATE_TENANT",SAVE_TENANT_LOGIN_PROVIDER:"SAVE_TENANT_LOGIN_PROVIDER",UPDATE_TENANT_LOGIN_PROVIDER:"UPDATE_TENANT_LOGIN_PROVIDER",DELETE_TENANT_LOGIN_PROVIDER:"DELETE_TENANT_LOGIN_PROVIDER",GET_OPENSCAPE_USER:"GET_OPENSCAPE_USER",CREATE_OPENSCAPE_USER:"CREATE_OPENSCAPE_USER",UPDATE_OPENSCAPE_USER:"UPDATE_OPENSCAPE_USER",DELETE_OPENSCAPE_USER:"DELETE_OPENSCAPE_USER",GET_VACANT_HOME_DIRECTORY_NUMBERS:"GET_VACANT_HOME_DIRECTORY_NUMBERS",GET_OPENSCAPE_TENANT:"GET_OPENSCAPE_TENANT"},InvitationResponseCode:{INVITATION_SEND:"INVITATION_SEND",INVITATION_NOT_SEND:"INVITATION_NOT_SEND",INVALID_USER_STATE:"INVALID_USER_STATE",EMAIL_ALREADY_EXISTS:"EMAIL_ALREADY_EXISTS",ACCOUNT_ASSIGNMENT_FAILED:"ACCOUNT_ASSIGNMENT_FAILED",ERROR:"ERROR",SYSTEM_OVERLOADED:"SYSTEM_OVERLOADED",EMAIL_ALREADY_EXISTS_ON_SAME_TENANT:"EMAIL_ALREADY_EXISTS_ON_SAME_TENANT",UNTRUSTED_PARTNER_TENANT:"UNTRUSTED_PARTNER_TENANT",XMPP_FEDERATED_USER_NOT_FOUND:"XMPP_FEDERATED_USER_NOT_FOUND",LICENSE_LIMIT_EXCEEDED:"LICENSE_LIMIT_EXCEEDED",LICENSE_ERROR:"LICENSE_ERROR"},InvitationStatusCode:{RUNNING:"RUNNING",FINISHED:"FINISHED"},GetUsersOrdering:{ASCENDING:"ASCENDING",DESCENDING:"DESCENDING"},GetUsersSorting:{USER_NAME:"USER_NAME",DATA_USAGE:"DATA_USAGE",LAST_ACCESS:"LAST_ACCESS",ROLE:"ROLE",STATUS:"STATUS",PHONE_NUMBER_ASSIGNED:"PHONE_NUMBER_ASSIGNED",EMAIL:"EMAIL"},GetUsersSearchFor:{ROLE:"ROLE",STATUS:"STATUS",NAME:"NAME",PRIMARY_EMAIL:"PRIMARY_EMAIL"},SetRoleRole:{ADMIN:"ADMIN",USER:"USER"},UploadManifestResponseCode:{UPLOAD_SUCCESS:"UPLOAD_SUCCESS",INVALID_JSON_FORMAT:"INVALID_JSON_FORMAT",CONSTRAINT_VIOLATION:"CONSTRAINT_VIOLATION"},Constraint:{NOT_BLANK:"NOT_BLANK",URL:"URL",BASE64_ICON:"BASE64_ICON"},ExportTenantFormat:{CSV:"CSV",JSON:"JSON"},AdministrationEventType:{INVITE_MULTIPLE_USERS:"INVITE_MULTIPLE_USERS",INVITE_MULTIPLE_PARTNER_USERS:"INVITE_MULTIPLE_PARTNER_USERS"},TenantSettingsType:{CREDENTIALS_LOGIN_ENABLED:"CREDENTIALS_LOGIN_ENABLED",HELP_URL:"HELP_URL",PLUGIN_SELF_MANAGED_ENABLED:"PLUGIN_SELF_MANAGED_ENABLED",EXTENSION_MICROSOFT_EXCHANGE_ENABLED:"EXTENSION_MICROSOFT_EXCHANGE_ENABLED",EXTENSION_SYNCPLICITY_ENABLED:"EXTENSION_SYNCPLICITY_ENABLED",EXTENSION_BOX_ENABLED:"EXTENSION_BOX_ENABLED",EXTENSION_GOOGLE_DRIVE_ENABLED:"EXTENSION_GOOGLE_DRIVE_ENABLED",EXTENSION_ONE_DRIVE_ENABLED:"EXTENSION_ONE_DRIVE_ENABLED",EXTENSION_JABRA_ENABLED:"EXTENSION_JABRA_ENABLED",EXTENSION_VDI_ENABLED:"EXTENSION_VDI_ENABLED",EXTENSION_PLANTRONICS_ENABLED:"EXTENSION_PLANTRONICS_ENABLED",EXTENSION_SKYPE_FOR_BUSINESS_ENABLED:"EXTENSION_SKYPE_FOR_BUSINESS_ENABLED",DT_LEGAL_INFORMATION:"DT_LEGAL_INFORMATION",SSO_REDIRECT_URL:"SSO_REDIRECT_URL",PHONE_DIALOUT_CALLER_ID_PREFIX:"PHONE_DIALOUT_CALLER_ID_PREFIX",PHONE_DIALOUT_MODE:"PHONE_DIALOUT_MODE",PHONE_DIALOUT_ENABLED:"PHONE_DIALOUT_ENABLED"},TenantConfigurableTextType:{GUEST_ACCESS_ACCEPTANCE_TEXT:"GUEST_ACCESS_ACCEPTANCE_TEXT",USER_INVITE_ACCEPTANCE_TEXT:"USER_INVITE_ACCEPTANCE_TEXT"},TrunkState:{UP:"UP",DOWN:"DOWN",NOT_REQUESTED:"NOT_REQUESTED",REQUESTED:"REQUESTED"},GtcTrunkType:{GTC_TRUNK_TYPE:"GTC_TRUNK_TYPE",ETC_TRUNK_TYPE:"ETC_TRUNK_TYPE",ATC_TRUNK_TYPE:"ATC_TRUNK_TYPE",EMBEDDED_TC_TRUNK_TYPE:"EMBEDDED_TC_TRUNK_TYPE",OSBIZ_TRUNK_TYPE:"OSBIZ_TRUNK_TYPE"},ExtensionState:{ENABLED:"ENABLED",DISABLED:"DISABLED"},TelephonyRoutingRuleCriteria:{ORIGIN:"ORIGIN",DESTINATION:"DESTINATION"},TelephonyRoutingRuleOperator:{AND:"AND",OR:"OR"},TelephonyRoutingRuleApplication:{TELEPHONY:"TELEPHONY",CONF_DIAL_OUT:"CONF_DIAL_OUT",BOTH:"BOTH"},TelephonyConfigurationDefaultRouting:{ANY:"ANY",NONE:"NONE"},TelephonyRoutingRuleResult:{NO_MATCH:"NO_MATCH",MATCH:"MATCH",SELECTED:"SELECTED"},ProviderType:{CREDENTIALS:"CREDENTIALS",SAML:"SAML",OPENID:"OPENID"},PhoneDialoutMode:{PHONE_USERS_ONLY:"PHONE_USERS_ONLY",ALL_USERS:"ALL_USERS"},ThirdPartyConnectorsActionType:{GET_SETTINGS:"GET_SETTINGS",SAVE_SETTINGS:"SAVE_SETTINGS",CONNECT:"CONNECT",DISCONNECT:"DISCONNECT",SEND_AUTH_CODE:"SEND_AUTH_CODE",GET_CONNECTION_STATUS:"GET_CONNECTION_STATUS",GET_FOLDER_ITEMS:"GET_FOLDER_ITEMS",SHARE_FOLDER_ITEMS:"SHARE_FOLDER_ITEMS",UNSHARE_FOLDER_ITEMS:"UNSHARE_FOLDER_ITEMS",GET_EDIT_URL:"GET_EDIT_URL",GET_FOLDER_ITEMS_WITH_CURSOR:"GET_FOLDER_ITEMS_WITH_CURSOR",CONNECT_STORAGE:"CONNECT_STORAGE",REFRESH_CONNECTION:"REFRESH_CONNECTION"},ThirdPartyConnectorType:{EXCHANGE_CONNECTOR:"EXCHANGE_CONNECTOR",BOX:"BOX",OPEN_XCHANGE:"OPEN_XCHANGE",GOOGLE_DRIVE:"GOOGLE_DRIVE",SYNCPLICITY:"SYNCPLICITY",ONE_DRIVE:"ONE_DRIVE"},ThirdPartyEventType:{CONNECTED_TO_THIRDPARTY:"CONNECTED_TO_THIRDPARTY",DISCONNECTED_FROM_THIRDPARTY:"DISCONNECTED_FROM_THIRDPARTY"},ThirdPartyContentType:{SKYPE4B:"SKYPE4B"},GuestActionType:{VALIDATE_SESSION_INVITE_TOKEN:"VALIDATE_SESSION_INVITE_TOKEN",REGISTER_SESSION_GUEST:"REGISTER_SESSION_GUEST"},SessionInviteInfoResult:{INVALID:"INVALID",VALID_NOSESSION:"VALID_NOSESSION",VALID_SESSION:"VALID_SESSION",VALID_NO_GUEST_ACCESS:"VALID_NO_GUEST_ACCESS"},UserRoutingMessageType:{ATC:"ATC",CMP:"CMP",CONTACT_CARD:"CONTACT_CARD",DESKTOP_APP:"DESKTOP_APP",MOBILE_BREAKOUT:"MOBILE_BREAKOUT",SDK:"SDK"},VersionActionType:{GET_VERSION:"GET_VERSION"},AccountActionType:{GET_PACKAGE_TEMPLATES:"GET_PACKAGE_TEMPLATES",GET_ASSIGNED_PACKAGES:"GET_ASSIGNED_PACKAGES",VALIDATE_ASSIGN_ACCOUNT_TEMPLATE:"VALIDATE_ASSIGN_ACCOUNT_TEMPLATE",ASSIGN_ACCOUNT_TEMPLATE:"ASSIGN_ACCOUNT_TEMPLATE",VALIDATE_MIGRATE_ACCOUNT:"VALIDATE_MIGRATE_ACCOUNT",MIGRATE_ACCOUNT:"MIGRATE_ACCOUNT",MIGRATE_MULTIPLE_USERS:"MIGRATE_MULTIPLE_USERS",GET_ACCOUNTS:"GET_ACCOUNTS",GET_SEARCH_TAGS:"GET_SEARCH_TAGS",SUSPEND_ACCOUNT:"SUSPEND_ACCOUNT",UNSUSPEND_ACCOUNT:"UNSUSPEND_ACCOUNT",ASSIGN_TELEPHONY_CONFIGURATION:"ASSIGN_TELEPHONY_CONFIGURATION",DELETE_TELEPHONY_CONFIGURATION:"DELETE_TELEPHONY_CONFIGURATION",GET_ACCOUNT_BY_ID:"GET_ACCOUNT_BY_ID",GET_ACCOUNT_BY_USER_ID:"GET_ACCOUNT_BY_USER_ID",GET_TECHNICAL_ADMIN_USER_ID:"GET_TECHNICAL_ADMIN_USER_ID"},UserDataActionType:{GET_USER_DATA:"GET_USER_DATA"},AccountEventType:{MIGRATE_MULTIPLE_USERS:"MIGRATE_MULTIPLE_USERS",TELEPHONY_CONFIGURATION_UPDATED:"TELEPHONY_CONFIGURATION_UPDATED"},AccountTemplateName:{USER:"USER",ADMIN:"ADMIN",MEETING_POINT:"MEETING_POINT",XMPP_FEDERATED_USER:"XMPP_FEDERATED_USER"},AccountStatus:{NONE:"NONE",CREATED:"CREATED",INITIAL:"INITIAL",INVITED:"INVITED",ACTIVE:"ACTIVE",SUSPENDED:"SUSPENDED",DELETED:"DELETED"},GetAccountsOrdering:{ASCENDING:"ASCENDING",DESCENDING:"DESCENDING"},GetAccountsSorting:{BY_FIRST_NAME:"BY_FIRST_NAME",BY_LAST_NAME:"BY_LAST_NAME",BY_PRIMARY_EMAIL:"BY_PRIMARY_EMAIL",BY_PHONE_NUMBER:"BY_PHONE_NUMBER",BY_LAST_LOGIN:"BY_LAST_LOGIN",BY_LOCATION:"BY_LOCATION"},GetAccountsFilterCriteria:{PRIMARY_EMAIL:"PRIMARY_EMAIL",FIRST_NAME:"FIRST_NAME",LAST_NAME:"LAST_NAME",DISPLAY_NAME:"DISPLAY_NAME",STATUS:"STATUS",TAG:"TAG"},SystemPermission:{IGNORE:"IGNORE",CLIENT_LOGON:"CLIENT_LOGON",INVITE_USER:"INVITE_USER",ROLE_TELEPHONY_CONNECTOR:"ROLE_TELEPHONY_CONNECTOR",ROLE_VIRTUAL_TELEPHONY_CONNECTOR:"ROLE_VIRTUAL_TELEPHONY_CONNECTOR",ROLE_TECHNICAL:"ROLE_TECHNICAL",ROLE_SESSION_GUEST:"ROLE_SESSION_GUEST",ROLE_USER:"ROLE_USER",ROLE_TENANT_ADMIN:"ROLE_TENANT_ADMIN",ROLE_SUPPORT:"ROLE_SUPPORT",ROLE_SYSTEM_ADMIN:"ROLE_SYSTEM_ADMIN",MANAGE_TENANT:"MANAGE_TENANT",TELEPHONY:"TELEPHONY",RECORDING:"RECORDING",MODERATION:"MODERATION",GUEST_ACCESS:"GUEST_ACCESS",MAX_PACKAGE_ACCOUNTS:"MAX_PACKAGE_ACCOUNTS",FREE_TRIAL:"FREE_TRIAL",USER_STORAGE:"USER_STORAGE",INTEGRATIONS:"INTEGRATIONS",RTC_PARTICIPANTS:"RTC_PARTICIPANTS",ACCOUNTS:"ACCOUNTS",IE_PLUGIN_SUPPORT:"IE_PLUGIN_SUPPORT",SUPPORT_CONVERSATION:"SUPPORT_CONVERSATION",SUPPORT_FORUM:"SUPPORT_FORUM",OUTLOOK_PLUGIN:"OUTLOOK_PLUGIN",TENANT_STORAGE:"TENANT_STORAGE",PSTN_DIAL_IN:"PSTN_DIAL_IN",LDAP_AGENT:"LDAP_AGENT",INVITE_PARTNER:"INVITE_PARTNER",LARGE_CONFERENCE:"LARGE_CONFERENCE",CREATE_COMMUNITY:"CREATE_COMMUNITY",CONTENT_MODERATOR:"CONTENT_MODERATOR",ANALYTICS:"ANALYTICS",VIEW_OPEN_CONVERSATION:"VIEW_OPEN_CONVERSATION",SSO:"SSO",IE_PLUGIN_SUPPORT_LIMITATION:"IE_PLUGIN_SUPPORT_LIMITATION",ROLE_MEETING_POINT:"ROLE_MEETING_POINT",MOBILE_BREAKOUT:"MOBILE_BREAKOUT",UCAAS:"UCAAS"},PermissionType:{TENANT_QUOTA:"TENANT_QUOTA",USER_QUOTA:"USER_QUOTA",FEATURE:"FEATURE",OVERALL_PACKAGE_QUOTA:"OVERALL_PACKAGE_QUOTA",OVERALL_PACKAGE_FEATURE:"OVERALL_PACKAGE_FEATURE",RESTRICTION:"RESTRICTION"},MigrateMultipleStatusCode:{RUNNING:"RUNNING",FINISHED:"FINISHED"},MigrateResponseCode:{NULL_PARAMETER:"NULL_PARAMETER",ACCOUNT_DOES_NOT_EXIST:"ACCOUNT_DOES_NOT_EXIST",TECHNICAL_ACCOUNT_NOT_ALLOWED:"TECHNICAL_ACCOUNT_NOT_ALLOWED",ACCOUNT_TEMPLATE_DOES_NOT_EXIST:"ACCOUNT_TEMPLATE_DOES_NOT_EXIST",ILLEGAL_ACCOUNT_TEMPLATE_ASSIGNMENT:"ILLEGAL_ACCOUNT_TEMPLATE_ASSIGNMENT",MAXIMUM_ACCOUNTS_REACHED:"MAXIMUM_ACCOUNTS_REACHED",ERROR:"ERROR",OK:"OK"},ActivityStreamActionType:{CREATE_MENTION:"CREATE_MENTION",GET_MENTIONS_BY_USER:"GET_MENTIONS_BY_USER",GET_ACTIVITIES_BY_USER:"GET_ACTIVITIES_BY_USER",UPDATE_ACTIVITY_READ:"UPDATE_ACTIVITY_READ",MARK_ALL_READ:"MARK_ALL_READ"},ActivityStreamEventType:{ACTIVITY_CREATED:"ACTIVITY_CREATED",ACTIVITY_MARKED_READ:"ACTIVITY_MARKED_READ",ACTIVITY_MARKED_UNREAD:"ACTIVITY_MARKED_UNREAD",ACTIVITY_DELETED:"ACTIVITY_DELETED",ACTIVITY_MARK_ALL_READ:"ACTIVITY_MARK_ALL_READ"},ConversationUserDataEventType:{LABELS_ADDED:"LABELS_ADDED",LABELS_REMOVED:"LABELS_REMOVED",LABEL_EDITED:"LABEL_EDITED",FILTERS_REMOVED:"FILTERS_REMOVED",FILTER_ADDED:"FILTER_ADDED",FILTER_EDITED:"FILTER_EDITED"},VotingType:{ACCEPT_DECLINE:"ACCEPT_DECLINE",APPROVE_REJECT:"APPROVE_REJECT",YES_NO:"YES_NO",YES_NO_MAYBE:"YES_NO_MAYBE",A_B:"A_B",ONE_TWO_THREE_FOUR:"ONE_TWO_THREE_FOUR"},LabFeatureName:{ARCHIVE:"ARCHIVE",AUTHENTICATION_SETTINGS:"AUTHENTICATION_SETTINGS",CALL_FORWARDING:"CALL_FORWARDING",COLOR_CONTRAST:"COLOR_CONTRAST",ENHANCED_SEARCH:"ENHANCED_SEARCH",EXPORT_USER_DATA:"EXPORT_USER_DATA",EXTENSIONS:"EXTENSIONS",FILTER_BY_LABEL:"FILTER_BY_LABEL",FIREBASE_PUSH_NOTIFICATIONS:"FIREBASE_PUSH_NOTIFICATIONS",INCOMING_CALL_ROUTING:"INCOMING_CALL_ROUTING",LEAK_CANARY:"LEAK_CANARY",NEW_CALL_SCREEN:"NEW_CALL_SCREEN",ONE_DRIVE:"ONE_DRIVE",OPEN_XCHANGE:"OPEN_XCHANGE",ORGANISE_CONTENT:"ORGANISE_CONTENT",PARTICIPANT_DRAWING:"PARTICIPANT_DRAWING",POPOUT_CALL_STAGE:"POPOUT_CALL_STAGE",SCOPE_SEARCHES:"SCOPE_SEARCHES",SCREENSHARE_TAP_INDICATOR:"SCREENSHARE_TAP_INDICATOR",SKYPE_FOR_BUSINESS:"SKYPE_FOR_BUSINESS",TEXT_TO_SPEECH:"TEXT_TO_SPEECH",VIDEO_PLAYER:"VIDEO_PLAYER",VOTING:"VOTING",WHITEBOARD:"WHITEBOARD"},DraftType:{PRIVATE:"PRIVATE",OPEN:"OPEN",BRIDGE:"BRIDGE",LARGE:"LARGE"},AvatarBadgeType:{COMMUNITY:"COMMUNITY",EVENT:"EVENT",SKYPE:"SKYPE"},AudioVideoDeviceCategories:{AUDIO_OUTPUT:"AUDIO_OUTPUT",RINGING_OUTPUT:"RINGING_OUTPUT",AUDIO_INPUT:"AUDIO_INPUT",VIDEO_INPUT:"VIDEO_INPUT"},AtcCapabilities:{EXTENDED_ALERTING:"EXTENDED_ALERTING",CLEAR_CONNECTION_BUSY:"CLEAR_CONNECTION_BUSY"}}),e=function(){function a(a){if(!a)return"";var b={};if(e.forEach(function(c){void 0!==a[c]&&null!==a[c]&&(b[c]=a[c])}),c.isEmptyObject(b))return"";var d=JSON.stringify(b);return d=c.textToHtmlEscaped(d),f.replace("%%1",d)}function d(a){if(a&&a.text)try{if(e.forEach(function(b){void 0===a[b]&&(a[b]=null)}),!a.text.content)return;var d=g.exec(a.text.content);if(d&&d[0]){a.text.content=a.text.content.slice(d[0].length);var f=d[1];if(f){f=c.escapedHtmlToText(f);var h=JSON.parse(f);e.forEach(function(b){void 0!==h[b]&&(a[b]=h[b])})}}}catch(a){b.error("[Proto]: Failed to retrieve private data. ",a)}}var e=["voting"],f="||::$$privateData=%%1::||",g=/^\|\|::\$\$privateData=({.*})::\|\|/;return{SUPPORTED_PRIVATE_DATA_FIELDS:e,convertPrivateDataToContent:a,retrievePrivateDataFromContent:d}}(),f={requestNr:0,Request:function(a,b){var c={msgType:d.WSMessageType.REQUEST,request:{requestId:++f.requestNr,type:a}};switch(a){case d.ContentType.CONVERSATION:c.request.conversation=b;break;case d.ContentType.USER:c.request.user=b;break;case d.ContentType.RTC_CALL:c.request.rtcCall=b;break;case d.ContentType.RTC_SESSION:c.request.rtcSession=b;break;case d.ContentType.SEARCH:c.request.search=b;break;case d.ContentType.INSTRUMENTATION:c.request.instrumentation=b;break;case d.ContentType.ADMINISTRATION:c.request.administration=b;break;case d.ContentType.SYSTEM:c.request.system=b;break;case d.ContentType.THIRDPARTYCONNECTORS:c.request.thirdpartyconnectors=b;break;case d.ContentType.GUEST:c.request.guest=b;break;case d.ContentType.USER_TO_USER:c.request.userToUser=b;break;case d.ContentType.VERSION:c.request.version=b;break;case d.ContentType.ACCOUNT:c.request.account=b;break;case d.ContentType.ACTIVITYSTREAM:c.request.activityStream=b;break;case d.ContentType.USER_DATA:c.request.userData=b}return c},ParseEvent:function(a){var b,c={};switch(a.type){case d.ContentType.CONVERSATION:switch(b="Conversation."+a.conversation.type,a.conversation.type){case d.ConversationEventType.CREATE:c=a.conversation.create;break;case d.ConversationEventType.UPDATE:c=a.conversation.update;break;case d.ConversationEventType.ADD_ITEM:c=a.conversation.addItem;break;case d.ConversationEventType.ADD_PARTICIPANT:c=a.conversation.addParticipant;break;case d.ConversationEventType.UPDATE_ITEM:c=a.conversation.updateItem;break;case d.ConversationEventType.READ_ITEMS:c=a.conversation.readItems;break;case d.ConversationEventType.TYPING:c=a.conversation.typing;break;case d.ConversationEventType.DRAFT_MESSAGE_SAVED:c=a.conversation.draftMessage;break;case d.ConversationEventType.DRAFT_MESSAGE_DISCARDED:c=a.conversation.draftMessage;break;case d.ConversationEventType.DRAFT_MESSAGE_PUBLISHED:c=a.conversation.draftMessage;break;case d.ConversationEventType.FLAG_ITEM:c=a.conversation.setFlagItem;break;case d.ConversationEventType.CLEAR_FLAGGED_ITEM:c=a.conversation.clearFlaggedItem;break;case d.ConversationEventType.CONVERSATION_MARKED:c=a.conversation.conversationMarked;break;case d.ConversationEventType.CONVERSATION_UNMARKED:c=a.conversation.conversationUnmarked;break;case d.ConversationEventType.FAVORITE_POSITION_CHANGED:c=a.conversation.favoritePositionChangedEvent;break;case d.ConversationEventType.USER_DATA_CHANGED:c=a.conversation.userDataChangedEvent}c.convId=a.conversation.convId;break;case d.ContentType.USER:switch(b="User."+a.user.type,a.user.type){case d.UserEventType.USER_PRESENCE_CHANGE:c=a.user.presenceChanged;break;case d.UserEventType.USER_UPDATED:c=a.user.userUpdated;break;case d.UserEventType.SESSION_CLOSED:c=a.user.sessionClosed;break;case d.UserEventType.PASSWORD_CHANGED:c=a.user.passwordChanged;break;case d.UserEventType.USER_SETTING_UPDATED:c=a.user.userSettingUpdated;break;case d.UserEventType.TELEPHONY_DATA:c=a.user.telephonyData;break;case d.UserEventType.DEVICE_LIST_CHANGED:c=a.user.deviceListChangedEvent;break;case d.UserEventType.NOTIFICATION_SUBSCRIPTION_CHANGE:c=a.user.notificationSubscriptionChange}c.userId=a.user.userId;break;case d.ContentType.RTC_CALL:switch(b="RTCCall."+a.rtcCall.type,a.rtcCall.type){case d.RTCCallEventType.SDP_ANSWER:c=a.rtcCall.sdpAnswer;break;case d.RTCCallEventType.SDP_FAILED:c=a.rtcCall.sdpFailed;break;case d.RTCCallEventType.INVITE:c=a.rtcCall.invite;break;case d.RTCCallEventType.INVITE_CANCEL:c=a.rtcCall.inviteCancel;break;case d.RTCCallEventType.INVITE_FAILED:c=a.rtcCall.inviteFailed;break;case d.RTCCallEventType.CHANGE_MEDIA_TYPE_REQUESTED:c=a.rtcCall.changeMediaRequested;break;case d.RTCCallEventType.PROGRESS:c=a.rtcCall.participantProgress;break;case d.RTCCallEventType.CHANGE_MEDIA_TYPE_FORCED:c=a.rtcCall.changeMediaTypeForcedEvent;break;case d.RTCCallEventType.ICE_CANDIDATES:c=a.rtcCall.iceCandidates}c.sessionId=a.rtcCall.sessionId,c.instanceId=a.rtcCall.instanceId;break;case d.ContentType.RTC_SESSION:switch(b="RTCSession."+a.rtcSession.type,a.rtcSession.type){case d.RTCSessionEventType.SESSION_STARTED:c=a.rtcSession.sessionStarted;break;case d.RTCSessionEventType.SESSION_TERMINATED:c=a.rtcSession.sessionTerminated;break;case d.RTCSessionEventType.SESSION_UPDATED:c=a.rtcSession.sessionUpdated,void 0!==c.session.whiteBoardEnabled&&(c.session.whiteboardEnabled=c.session.whiteBoardEnabled,delete c.session.whiteBoardEnabled);break;case d.RTCSessionEventType.SESSION_MOVED:c=a.rtcSession.sessionMoved;break;case d.RTCSessionEventType.PARTICIPANT_JOINED:c=a.rtcSession.participantJoined;break;case d.RTCSessionEventType.PARTICIPANT_LEFT:c=a.rtcSession.participantLeft;break;case d.RTCSessionEventType.PARTICIPANT_UPDATED:c=a.rtcSession.participantUpdated;break;case d.RTCSessionEventType.ACTIVE_SPEAKER:c=a.rtcSession.speaker;break;case d.RTCSessionEventType.VIDEO_ACTIVE_SPEAKER:c=a.rtcSession.videoSpeaker;break;case d.RTCSessionEventType.SESSION_RECORDING_INFO:c=a.rtcSession.sessionRecordingInfo;break;case d.RTCSessionEventType.SESSION_RECORDING_STARTED:c=a.rtcSession.sessionRecordingStarted;break;case d.RTCSessionEventType.SESSION_RECORDING_STOPPED:c=a.rtcSession.sessionRecordingStopped;break;case d.RTCSessionEventType.SESSION_RECORDING_FAILED:c=a.rtcSession.sessionRecordingFailed;break;case d.RTCSessionEventType.SESSION_TERMINATION_TIMER_STARTED:c=a.rtcSession.sessionTerminationTimerStarted;break;case d.RTCSessionEventType.SESSION_TERMINATION_TIMER_CANCELLED:c=a.rtcSession.sessionTerminationTimerCancelled;break;case d.RTCSessionEventType.SESSION_ATTRIBUTES_CHANGED_EVENT:c=a.rtcSession.sessionAttributesChangedEvent;break;case d.RTCSessionEventType.QUESTION_EVENT:c=a.rtcSession.questionEvent;break;case d.RTCSessionEventType.INVITE_TO_STAGE_EVENT:c=a.rtcSession.inviteToStageEvent;break;case d.RTCSessionEventType.INVITE_TO_STAGE_CANCEL_EVENT:c=a.rtcSession.inviteToStageCancelEvent;break;case d.RTCSessionEventType.CURTAIN_EVENT:c=a.rtcSession.curtainEvent;break;case d.RTCSessionEventType.WHITEBOARD_ENABLED:c=a.rtcSession.whiteboardEnabled;break;case d.RTCSessionEventType.WHITEBOARD_DISABLED:c={};break;case d.RTCSessionEventType.WHITEBOARD_ELEMENT_ADDED:c=a.rtcSession.whiteboardElementAdded;break;case d.RTCSessionEventType.WHITEBOARD_ELEMENT_REMOVED:c=a.rtcSession.whiteboardElementRemoved;break;case d.RTCSessionEventType.WHITEBOARD_ELEMENT_UPDATED:c=a.rtcSession.whiteboardElementUpdated;break;case d.RTCSessionEventType.WHITEBOARD_CLEARED:c=a.rtcSession.whiteboardCleared}c.sessionId=a.rtcSession.sessionId;break;case d.ContentType.SEARCH:switch(b="Search."+a.search.type,a.search.type){case d.SearchEventType.BASIC_SEARCH_RESULT:c=a.search.basicSearchResult;break;case d.SearchEventType.DETAILED_SEARCH_RESULT:c=a.search.detailSearchResult;break;case d.SearchEventType.SEARCH_STATUS:c=a.search.searchStatus;break;case d.SearchEventType.RECENT_SEARCH_ADDED:c=a.search.recentSearchAdded}c.searchId=a.search.searchId;break;case d.ContentType.SYSTEM:switch(b="System."+a.system.type,a.system.type){case d.SystemEventType.MAINTENANCE:c=a.system.maintenance;break;case d.SystemEventType.CLIENT_UPDATE:c=a.system.update}break;case d.ContentType.ADMINISTRATION:switch(b="Administration."+a.administration.type,a.administration.type){case d.AdministrationEventType.INVITE_MULTIPLE_USERS:c=a.administration.inviteMultipleUsers;break;case d.AdministrationEventType.INVITE_MULTIPLE_PARTNER_USERS:c=a.administration.inviteMultiplePartnerUsers}break;case d.ContentType.THIRDPARTYCONNECTORS:switch(b="ThirdParty."+a.thirdParty.type,a.thirdParty.type){case d.ThirdPartyEventType.CONNECTED_TO_THIRDPARTY:c=a.thirdParty;break;case d.ThirdPartyEventType.DISCONNECTED_FROM_THIRDPARTY:c=a.thirdParty.provider}break;case d.ContentType.USER_TO_USER:b="UserToUser."+a.userToUser.userToUser.type,c=a.userToUser.userToUser,c.routing=a.userToUser.routing;break;case d.ContentType.ACTIVITYSTREAM:switch(b="ActivityStream."+a.activity.type,a.activity.type){case d.ActivityStreamEventType.ACTIVITY_CREATED:c=a.activity.create.item;break;case d.ActivityStreamEventType.ACTIVITY_DELETED:c=a.activity.delete.item;break;case d.ActivityStreamEventType.ACTIVITY_MARKED_READ:c=a.activity.markRead.itemId;break;case d.ActivityStreamEventType.ACTIVITY_MARKED_UNREAD:c=a.activity.markUnread.itemId;break;case d.ActivityStreamEventType.ACTIVITY_MARK_ALL_READ:c=a.activity.markAllRead.status}break;case d.ContentType.ACCOUNT:switch(b="Account."+a.account.type,a.account.type){case d.AccountEventType.MIGRATE_MULTIPLE_USERS:c=a.account.migrateMultipleUsers;break;case d.AccountEventType.TELEPHONY_CONFIGURATION_UPDATED:c=a.account.telephonyConfigurationUpdated}break;case d.ContentType.CONVERSATION_USER_DATA:switch(b="ConversationUserData."+a.conversationUserData.type,a.conversationUserData.type){case d.ConversationUserDataEventType.LABELS_ADDED:c=a.conversationUserData.labelsAdded;break;case d.ConversationUserDataEventType.LABELS_REMOVED:c=a.conversationUserData.labelsRemoved;break;case d.ConversationUserDataEventType.LABEL_EDITED:c=a.conversationUserData.labelEdited;break;case d.ConversationUserDataEventType.FILTERS_REMOVED:c=a.conversationUserData.filtersRemoved;break;case d.ConversationUserDataEventType.FILTER_ADDED:c=a.conversationUserData.filterAdded;break;case d.ConversationUserDataEventType.FILTER_EDITED:c=a.conversationUserData.filterEdited}break;default:return null}return{name:b,data:c}},getMediaType:function(a){if(!a)return{audio:!1,video:!1,desktop:!1};var b={audio:!1,video:!1,desktop:!1};return a.forEach(function(a){switch(a){case d.RealtimeMediaType.AUDIO:b.audio=!0;break;case d.RealtimeMediaType.VIDEO:b.video=!0;break;case d.RealtimeMediaType.DESKTOP_SHARING:b.desktop=!0}}),b}};return a.Constants=d,a.PrivateData=e,a.Proto=f,a}(Circuit),Circuit=function(a){"use strict";function b(a,b,c){this.foundation=1,this.componentId=a?1:2,this.transport="udp",this.priority=1,this.address=b||"0.0.0.0",this.port=c||1,this.typ="host",this.generation=0,this.optional=[]}var c=Object.freeze({TLS:{name:"tls",start:0,end:11e6},TCP:{name:"tcp",start:12e6,end:31e6},UDP:{name:"udp",start:35e6,end:6e7}});b.prototype.isRtp=function(){return 1===this.componentId},b.prototype.isRtcp=function(){return 2===this.componentId},b.prototype.isTcpTlsRelay=function(){
return"relay"===this.typ&&this.priority<=c.TCP.end},b.prototype.getRelayClientTransportType=function(){var a="";if("relay"===this.typ){var b=this.priority;[c.TLS,c.TCP,c.UDP].some(function(c){if(b>=c.start&&b<=c.end)return a=c.name,!0})}return a},b.prototype.parse=function(a){a=a.replace(/(a=)*candidate:([^\r]+)(\r\n)*/i,"$2");var b=a.split(" ");if(b.length<7)throw new Error("Invalid candidate: "+a);this.foundation=parseInt(b[0],10),this.componentId=parseInt(b[1],10),this.transport=b[2].toLowerCase(),this.priority=parseInt(b[3],10),this.address=b[4],this.port=parseInt(b[5],10),this.typ=b[7];for(var c=8;c<b.length;c+=2)this.optional.push(b[c]),this[b[c]]=b[c+1]},b.prototype.getValue=function(){for(var a=this.foundation+" "+this.componentId+" "+this.transport+" "+this.priority+" "+this.address+" "+this.port+" typ "+this.typ,b=0;b<this.optional.length;b++){var c=this.optional[b];a+=" "+c+" "+this[c]}return a},b.prototype.getParsedAttribute=function(){return{field:"candidate",value:this.getValue()}},b.prototype.toString=function(){var a="candidate:"+this.getValue();return a};var d=function(){function a(a){var b=a.split(/\s+/);return{username:b[0],id:b[1],version:b[2],nettype:b[3],addrtype:b[4],address:b[5]}}function c(a){var b=a.split(/\s+/);return{nettype:b[0],addrtype:b[1],address:b[2]}}function d(a){var b=/^([^:]+)(?::(.*))?/.exec(a);return{field:b[1],value:b[2]}}function e(a){var b=q.exec(a);return{media:b[1],port:+b[2],portnum:+(b[3]||1),proto:b[4],fmt:b[5]?b[5].split(/\s+/).map(function(a){return+a}):[]}}function f(a,b,c){switch(b){case"v":case"o":case"s":case"i":case"u":case"e":case"p":case"c":a[b]=c;break;default:a[b]?a[b].push(c):a[b]=[c]}}function g(a,b,c){if(void 0!==a[b]){var d=function(a){return b+"="+(r[b]&&r[b](a)||a)+"\r\n"};return Array.isArray(a[b])?a[b].map(d).join(""):d(a[b])}return c?b+"="+c+"\r\n":""}function h(a){return a.filter(function(a){switch(a.field){case"inactive":case"recvonly":case"sendonly":case"sendrecv":return!1}return!0})}function i(b){for(var g,h=b.split(/\r\n/),i={},j=0;j<h.length&&(g=/^(\w)=(.*)/.exec(h[j]),"m"!==g[1]);++j)"a"===g[1]&&g[2]?f(i,g[1],d(g[2])):f(i,g[1],g[2]);i.m=[];for(var k=null;j<h.length&&(g=/(\w)=(.*)/.exec(h[j]),g);++j)"m"===g[1]?(k=e(g[2]),i.m.push(k)):"a"===g[1]&&g[2]?f(k,g[1],d(g[2])):f(k,g[1],g[2]);return i.s&&""!==i.s.trim()||(i.s="-"),i.o&&(i.o=a(i.o)),i.c&&(i.c=c(i.c)),i.m.forEach(function(a){a.c&&(a.c=c(a.c))}),i}function j(a){var b="string"==typeof a?i(a):a,c=[];return b.m&&b.m.forEach(function(a){"video"===a.media&&a.a.some(function(a){switch(a.field){case"sendrecv":case"sendonly":case"recvonly":case"inactive":return c.push(a.field),!0}})}),c}function k(a,b){var c="string"==typeof a?i(a):a;b=b||{};var d="sendrecv";return void 0!==b.mLineIndex?(c.m[b.mLineIndex].a.forEach(function(a){switch(a.field){case"sendrecv":case"sendonly":case"recvonly":case"inactive":d=a.field}}),d):(b.mediaType&&"both"!==b.mediaType||(b.mediaType="audio"),c.a&&c.a.forEach(function(a){switch(a.field){case"sendonly":case"recvonly":case"inactive":d=a.field}}),c.m&&c.m.forEach(function(a){a.media===b.mediaType&&a.a.forEach(function(a){switch(a.field){case"sendrecv":case"sendonly":case"recvonly":case"inactive":d=a.field}})}),d)}function l(a){return!!Array.isArray(a)&&a.some(function(a){return a.indexOf("AS:")!==-1})}function m(a){return!!Array.isArray(a)&&a.some(function(a){return a.indexOf("TIAS:")!==-1})}function n(a,c,d,e){if(0===a.port)return!0;var f=0,g=!1,h=null,i=null,j=a.a.filter(function(c){if("candidate"!==c.field)return!0;var e=new b;if(e.parse(c.value),"udp"!==e.transport)return!1;if(d&&"video"===a.media){if("relay"!==e.typ)return g=!0,!1;if(!e.isTcpTlsRelay())return p.debug("[SdpParser]: Removed UDP relay candidate: ",c.value),g=!0,!1;!h&&e.isRtp()&&(h=e),!i&&e.isRtcp()&&(i=e)}return f++,!0});return h||!g||e?!(0===f&&!e)&&(a.a=j,i&&a.a.some(function(a){if("rtcp"===a.field)return a.value=i.port+" IN IP4 "+i.address,!0}),h&&(a.port=h.port,a.c&&(a.c.address=h.address)),!0):(p.info("[SdpParser]: Media description does not have TCP/TLS relay candidates. Do not filter UDP candidates!"),n(a,c,!1))}function o(a,b){var c=-1;return a.m.some(function(a,d){if(a.a.some(function(a){return"mid"===a.field&&a.value===b}))return c=d,!0}),c}var p=Circuit.logger,q=/^(\w+) +(\d+)(?:\/(\d))? +(\S+)(?: (\d+( +\d+)*))?/,r={o:function(a){return[a.username||"-",a.id,a.version,a.nettype||"IN",a.addrtype||"IP4",a.address].join(" ")},c:function(a){return[a.nettype||"IN",a.addrtype||"IP4",a.address].join(" ")},m:function(a){return[a.media||"audio",a.port||"0",a.proto||"RTP/AVP",a.fmt.join(" ")].join(" ")},a:function(a){return a.value?[a.field,a.value].join(":"):a.field}};return{parse:i,stringify:function(a){var b="";return b+=g(a,"v",0),b+=g(a,"o"),b+=g(a,"s","-"),b+=g(a,"i"),b+=g(a,"u"),b+=g(a,"e"),b+=g(a,"p"),b+=g(a,"c"),b+=g(a,"b"),b+=g(a,"t","0 0"),b+=g(a,"r"),b+=g(a,"z"),b+=g(a,"k"),b+=g(a,"a"),a.m.forEach(function(a){b+=g({m:a},"m"),b+=g(a,"i"),b+=g(a,"c"),b+=g(a,"b"),b+=g(a,"k"),b+=g(a,"a")}),b},getConnectionMode:k,getVideoConnectionModes:j,setConnectionMode:function(a,b,c){var d="string"==typeof a?i(a):a,e=b&&"both"!==b?[b]:["audio","video"];return"both"===b&&d.a&&(d.a=h(d.a),d.a.push({field:c})),d.m&&d.m.forEach(function(a){e.indexOf(a.media)!==-1&&(a.a=h(a.a),a.a.push({field:c}))}),d},isHold:function(a){var b=k(a);return"inactive"===b||"sendonly"===b},disableMultiplex:function(a){var b="string"==typeof a?i(a):a;return b.a&&(b.a=b.a.filter(function(a){return"group"!==a.field})),b},hasVideo:function(a){var b="string"==typeof a?i(a):a;return!!b.m&&b.m.some(function(a,c){return"video"===a.media&&0!==a.port&&0!==a.fmt.length&&("inactive"!==k(b,{mLineIndex:c})&&a.a.some(function(a){return"rtpmap"===a.field&&a.value.indexOf("VP8")!==-1}))})},addEmptyVideoLine:function(a){var b="string"==typeof a?i(a):a,c={media:"video",port:0,proto:"RTP/SAVPF",fmt:[100],c:{nettype:"IN",addrtype:"IP4",address:"0.0.0.0"},a:[{field:"inactive"}]};return b.m.push(c),b},removeVideo:function(a){var b="string"==typeof a?i(a):a;return b.m&&b.m.forEach(function(a){"video"===a.media&&(a.port=0,a.c={nettype:"IN",addrtype:"IP4",address:"0.0.0.0"},a.a=a.a.filter(function(a){return"mid"===a.field}),a.a.push({field:"inactive"}))}),b},setVideoBandwidth:function(a,b,c){var d="string"==typeof a?i(a):a;return d.m&&d.m.forEach(function(a){"video"===a.media&&(c?b&&b.valueOf()>0?a.b=["AS:"+b,"TIAS:"+1e3*b]:(l(a.b)||m(a.b))&&delete a.b:(l(a.b)||f(a,"b","AS:"+b),m(a.b)||f(a,"b","TIAS:"+1e3*b)))}),d},setXGoogle:function(a,b){var c="string"==typeof a?i(a):a;return c.m&&b&&c.m.forEach(function(a){if("video"===a.media&&a.a){var c,d=-1;if(a.a=a.a.filter(function(a,b){return"rtpmap"===a.field&&a.value.indexOf("VP8")!==-1&&(c=a.value.split(" ")[0],d=b),("fmtp"!==a.field||a.value&&a.value.indexOf("x-google")===-1)&&"x-google-buffer-latency"!==a.field}),d!==-1){var e=[];b.minBitRate&&b.minBitRate.valueOf()>0&&e.push("x-google-min-bitrate="+b.minBitRate),b.maxBitRate&&b.maxBitRate.valueOf()>0&&e.push("x-google-max-bitrate="+b.maxBitRate),b.startBitRate&&b.startBitRate.valueOf()>0&&e.push("x-google-start-bitrate="+b.startBitRate),b.maxQuantization&&b.maxQuantization.valueOf()>0&&e.push("x-google-max-quantization="+b.maxQuantization),e.length>0&&(e=c+" "+e.join("; "),a.a.splice(d+1,0,{field:"fmtp",value:e}))}}}),c},removeVideoBandwidth:function(a){var b="string"==typeof a?i(a):a;return b.m&&b.m.forEach(function(a){"video"===a.media&&(a.b=a.b&&a.b.filter(function(a){return!a.startsWith("AS:")&&!a.startsWith("TIAS:")}))}),b},removeAudioLevelAttr:function(a){var b="string"==typeof a?i(a):a;return b.m&&b.m.forEach(function(a){"audio"===a.media&&(a.a=a.a&&a.a.filter(function(a){return"extmap"!==a.field||!a.value||a.value.indexOf("ssrc-audio-level")===-1}))}),b},isTrickleIceOption:function(a){var b="string"==typeof a?i(a):a;b.a=b.a||[];var c=b.a.some(function(a){return"ice-options"===a.field&&(a.value=a.value||"",a.value.indexOf("trickle")!==-1)});return c},fixTrickleIceOption:function(a,b){var c="string"==typeof a?i(a):a;c.a=c.a||[];var d=c.a.some(function(a,d){if("ice-options"===a.field)return a.value=a.value||"",b?a.value.indexOf("trickle")===-1&&(a.value+=" trickle"):(a.value=a.value.replace(/trickle\s*/gi,"").trim(),a.value||c.a.splice(d,1)),!0});return b&&!d&&c.a.push({field:"ice-options",value:"trickle"}),c},addEndOfCandidatesLine:function(a){var b="string"==typeof a?i(a):a;return b.m&&b.m.forEach(function(a){a.a=a.a||[];var b=a.a.some(function(a){return"end-of-candidates"===a.field});b||a.a.push({field:"end-of-candidates"})}),b},removeEndOfCandidatesLine:function(a){var b="string"==typeof a?i(a):a;return b.m&&b.m.forEach(function(a){a.a&&a.a.some(function(b,c){if("end-of-candidates"===b.field)return a.a.splice(c,1),!0})}),b},removeEmptyAttributeLines:function(a,b){var c="string"==typeof a?i(a):a;if(c.m){var d={};Array.isArray(b)?b.forEach(function(a){d[a]=!0}):d[b]=!0,c.m.forEach(function(a){a.a=a.a&&a.a.filter(function(a){return a.value||!d[a.field]})})}return c},validateIceCandidates:function(a,b,c){var d="string"==typeof a?i(a):a;return!d.m.some(function(a,d){if(!n(a,d,b,c))return!0})},isNoOfferSdp:function(a){return!!a&&""===a.sdp&&"nooffer"===a.type},iceTotalCandidatesCount:function(a){var b=0,c="string"==typeof a?i(a):a;return c.m.forEach(function(a){a.a.forEach(function(a){"candidate"===a.field&&b++})}),b},removeNotNeededSsrc:function(a){var b="string"==typeof a?i(a):a;return b.m.forEach(function(a){a.a.some(function(a){return"recvonly"===a.field})&&(a.a=a.a.filter(function(a){return"ssrc"!==a.field}))}),b},removeAudioMediaProtocols:function(a,b){var c="string"==typeof a?i(a):a;return b&&b.length?(c.m.some(function(a){if("audio"===a.media&&a.proto){var c=a.proto.split("/");return c=c.filter(function(a){return b.indexOf(a)===-1}),a.proto=c.join("/"),!0}}),c):c},verifyFingerprintInMLines:function(a){var b="string"==typeof a?i(a):a;return b.m&&b.m.forEach(function(a,c){a.a.some(function(a){return"fingerprint"===a.field})||b.a.some(function(b){if("fingerprint"===b.field)return a.a.push(b),!0})||p.debug("[SdpParser]: verifyFingerprintInMLines(): No session fingerprint found for video m-line #:",c)}),b},findMediaLineIndex:function(a,b){if(b){var c="string"==typeof a?i(a):a;return o(c,b)}},setMediaIdAttribute:function(a,b,c,d){var e="string"==typeof a?i(a):a,f=e.m[b];f&&(f.a.some(function(a){if("mid"===a.field)return d&&(a.value=c),!0})||f.a.push({field:"mid",value:c}))},getOrigin:function(a){if("string"==typeof a){var b=/(o=[^\r]+)\r\n/i.exec(a);return b&&b[1]||""}return g(a,"o")}}}();return a.IceCandidate=b,a.sdpParser=d,a}(Circuit||{}),Circuit=function(a){"use strict";function b(b){function e(a,b){if("function"==typeof a)try{a(b)}catch(a){z.error(a)}}function f(a,b){e(K.onStateChange,{newState:a,oldState:b})}function g(){e(K.onReconnectFailed)}function h(a){e(K.onMessage,a)}function i(){L&&(L.onopen=null,L.onclose=null,L.onmessage=null,L.onerror=null,L=null)}function j(a){if(a!==O){z.debug("[CONN]: Changed connection state from "+O+" to "+a),z.debug("[CONN]: Raising connectionStateChange event");var b=O;O=a,window.setTimeout(function(){f(a,b)},0)}}function k(a){try{M&&M(a)}catch(a){z.error("[CONN]: Exception on errorCallback. ",a)}finally{M=null,N=null}}function l(){try{z.debug("[CONN]: Registered Successfully"),N&&N()}catch(a){z.error("[CONN]: Exception on successCallback. ",a)}finally{M=null,N=null}}function m(){Y&&(window.clearTimeout(Y),Y=null),X=[],W=[]}function n(a){if(R&&(window.clearTimeout(R),R=null),S&&(window.clearTimeout(S),S=null),m(),L){z.debug("[CONN]: Disconnecting from server");var b=L;i(),b.close()}a||j(d.Disconnected)}function o(a){a===L&&(z.info("[CONN]: WebSocket is opened"),P=A+c.randomNumber(0,B),Q=0,O!==d.Disconnected&&(j(d.Connected),l()))}function p(a,b){if(a===L)switch(m(),b=b||{},z.info("[CONN]: WebSocket is closed. Code: "+b.code+". Reason:",b.reason),O){case d.Connected:case d.Reconnecting:if(O===d.Reconnecting&&g(),j(d.Reconnecting),c.isMobile())return void z.warning("[CONN]: Mobile Client - Do not attempt to reconnect from JS");if(E>0&&Q>=E)return z.warning("[CONN]: Reached max number of attempts reconnecting to WebSocket"),void n();z.info("[CONN]: Retry to open socket in "+Math.floor(P/1e3)+" seconds"),R=window.setTimeout(function(){R=null,s()},P),P=++Q>C?2*P:B,P=Math.min(P,D);break;case d.Connecting:n(),z.error("[CONN]: Failed to open WebSocket connection"),k("Failed to open WebSocket connection")}}function q(a,b){if(a===L)try{if(!b.data||"PING"===b.data)return;var c=b.data;if(!T.doNotParseMessages)try{c=JSON.parse(c)}catch(a){return void z.error("[CONN]: Message discarded (Cannot Parse): ",b.data)}h(c)}catch(a){z.error(a)}}function r(a,b){a===L&&(m(),O!==d.Reconnecting&&O!==d.Connected?(z.error("[CONN]: WebSocket Connection Error"),j(d.Disconnected),i(),k("Failed to open WebSocket connection")):"node"!==window.navigator.platform&&"iOS"!==window.navigator.platform&&"Android"!==window.navigator.platform||(z.error("[CONN]: WebSocket connection error. Force _socket.onclose. ",b),L.onclose()))}function s(){if(O===d.Connecting||O===d.Reconnecting){z.info("[CONN]: Opening WebSocket to ",V);try{switch(window.navigator.platform){case"iOS":L=WebSocket.createWebSocket(U);break;case"node":L=new WebSocket(U,T.cookie);break;default:L=new WebSocket(U)}}catch(a){return z.error("[CONN]: Failed to connect WebSocket. ",a),void k(a)}L.onopen=o.bind(null,L),L.onclose=p.bind(null,L),L.onmessage=q.bind(null,L),L.onerror=r.bind(null,L)}}function t(){var a=Date.now(),b=W.length-1;W.some(function(c,d){return a-c<G?(W.splice(0,d),!0):void(d===b&&(W=[]))})}function u(){return!Y&&(W.length>=F&&t(),W.length<F)}function v(){if(!Y){var a=H;W.length>=F&&(a+=G-(Date.now()-W[0])),z.info("[CONN]: Start throttle timeout with delay = ",a),Y=window.setTimeout(function(){Y=null,x()},a)}}function w(a){try{var b=a.request&&a.request.requestId||"N/A";L.send(JSON.stringify(a)),W.push(Date.now()),z.debug("[CONN]: Sent message with requestId:",b)}catch(a){z.error("[CONN]: Failed to send message. ",a)}}function x(){z.info("[CONN]: Dequeue throttled messages. Number of queued messages = ",X.length),t();for(var a=0;X.length>0&&W.length<F&&a<J;)w(X.shift()),a++;X.length>0?(z.warn("[CONN]: Number of remaining queued messages = ",X.length),v()):z.info("[CONN]: Dequeued all throttled messages")}function y(a){z.warn("[CONN]: Throttling limit exceeded. Queue the message."),X.length>=I?z.error("[CONN]: Throttling queue is full. Drop the message."):(X.push(a),z.info("[CONN]: Queued message #",X.length))}var z=a.logger;b=b||{};var A,B,C,D,E;c.isMobile()?(A=0,B=0,D=0,E=0,C=0):(A=1e3,B=8e3,D=64e3,E=1350,C=1);var F=20,G=2e3,H=200,I=200,J=5,K=this,L=null,M=null,N=null,O=d.Disconnected,P=null,Q=0,R=null,S=null,T=b||{},U=null,V=null,W=[],X=[],Y=null;this.onStateChange=null,this.onReconnectFailed=null,this.onMessage=null,this.getState=function(){return O},this.isConnected=function(){return O===d.Connected},this.setTarget=function(a){U=a,V=U.split("?")[0]},this.connect=function(a,b,c){z.debug("[CONN]: Connect WebSocket to ",a),O!==d.Disconnected&&n(!0),K.setTarget(a),N=b||function(){},M=c||function(){},j(d.Connecting),window.setTimeout(s,0)},this.disconnect=function(){z.debug("[CONN]: Disconnect WebSocket from ",V),n()},this.reconnect=function(a,b){z.debug("[CONN]: Reconnect WebSocket to ",V),n(!0),a&&K.setTarget(a),j(d.Reconnecting),S=window.setTimeout(function(){S=null,s()},b||50)},this.sendMessage=function(a,b){return O!==d.Connected?(z.warn("[CONN]: WebSocket is not connected. Cannot send message. ",a),!1):a?(b||z.msgSend("[CONN]: ",a),"string"==typeof a?"PING"===a&&c.isMobile()?L.ping():L.send(a):(delete a.keysToOmitFromLogging,u()?w(a):(y(a),v())),!0):(z.error("[CONN]: Data is missing. Cannot send message."),!1)}}var c=a.Utils,d=Object.freeze({Disconnected:"Disconnected",Connecting:"Connecting",Reconnecting:"Reconnecting",Connected:"Connected"});return a.ConnectionController=b,a.Enums=a.Enums||{},a.Enums.ConnectionState=d,a}(Circuit),Circuit=function(a){"use strict";var b=a.logger,c=a.TemasysAdapter,d=a.Utils.getBrowserInfo();try{var e=function(a){if(a)try{a.oninactive=null;var c=a.getAudioTracks().concat(a.getVideoTracks());c.length&&c[0].stop?c.forEach(function(a){a.stop()}):a.stop&&a.stop(),b.info("[WebRTCAdapter]: Media stream has been stopped")}catch(a){b.error("[WebRTCAdapter]: Failed to stop media stream. ",a)}},f=function(a){if(a)try{var c=a.getVideoTracks();c?c.forEach(function(a){a.stop&&"video"===a.kind&&!a.remote&&a.stop()}):b.info("[WebRTCAdapter]: No video tracks to be changed")}catch(a){b.error("[WebRTCAdapter]: Failed to disable local video tracks. ",a)}},g=function(a){try{a.close(),b.debug("[WebRTCAdapter]: RTCPeerConnection has been closed")}catch(a){b.error(a)}},h=function(a,b){if(b){var c=[],d=[];a&&a.forEach(function(a){"audio"===a.kind?c.push(a):"video"===a.kind&&d.push(a)}),b(c,d,null)}},i=function(){return!!navigator.mediaDevices&&"function"==typeof navigator.mediaDevices.enumerateDevices&&"undefined"!=typeof HTMLMediaElement&&"function"==typeof HTMLMediaElement.prototype.setSinkId},j=function(a){if(a){if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices){var c=[{kind:"audio",id:"default",label:"",facing:""}],d=[{kind:"video",id:"default",label:"",facing:""}];return void window.setTimeout(function(){a(c,d,null)},0)}navigator.mediaDevices.enumerateDevices().then(function(b){var c=[],d=[],e=[];b&&b.forEach(function(a){var b={id:a.deviceId,groupId:a.groupId,kind:a.kind,label:a.label};switch(Circuit.isElectron&&("default"!==b.id||b.label||(b.label="res_DefaultDeviceLabel")),b.kind){case"audioinput":c.push(b);break;case"audiooutput":d.push(b);break;case"videoinput":e.push(b)}}),0!==d.length&&i()||(d=null),a(c,e,d)}).catch(function(c){b.error("[WebRTCAdapter]: Failed to enumerate devices. ",c),a()})}},k=function(a){if(!a||!a.iceServers)return a;var b=[];return a.iceServers.forEach(function(a){a.url?b.push(a):a.urls&&a.urls.forEach(function(c){b.push({url:c,credential:a.credential,username:a.username})})}),{iceServers:b}},l=function(a){a=a||{};var b={optional:[{googEchoCancellation:!0},{googEchoCancellation2:!0},{googAutoGainControl:!!a.enableAudioAGC},{googAutoGainControl2:!!a.enableAudioAGC},{googNoiseSuppression:!0},{googNoiseSuppression2:!0},{googHighpassFilter:!0},{googDucking:!1},{chromeRenderToAssociatedSink:!0}]};return b},m=function(a){return a&&a.hdVideo?{mandatory:{minAspectRatio:1.76,maxAspectRatio:1.78,maxWidth:1920,minWidth:1280,maxHeight:1080,minHeight:720,minFrameRate:30},optional:[{googNoiseReduction:!0}]}:{mandatory:{minAspectRatio:1.32,maxAspectRatio:1.34},optional:[{googNoiseReduction:!0}]}},n=function(a,b){var c=a&&a.getAudioTracks();return!(!c||!c[0])&&(c[0].enabled=!!b,!0)},o=function(c,d,e){return e=e||function(){},c&&d&&d.length?c.muted?(b.debug("[WebRTCAdapter]: Do not attach sinkId to muted element"),void e("Audio element muted")):void("undefined"!=typeof c.sinkId&&a.WebRTCAdapter?a.WebRTCAdapter.getMediaSources(function(f,g,h){var i=a.Utils.selectMediaDevice(h,d),j=i&&i.id||"";return c.sinkId===j?void e():(j||b.warn("[WebRTCAdapter]: A previously selected output device could not be found. Fallback to browser's default. Device not found: ",c.sinkId),void c.setSinkId(j).then(function(){b.debug("[WebRTCAdapter]: Success, audio output device attached: ",j||"<default>"),e()}).catch(function(a){var c=a.message;"SecurityError"===a.name&&(c="You need to use HTTPS for selecting audio output device."),b.error("[WebRTCAdapter]: Failed to attach output device. Device Id:"+j+" - ",c),e(c)}))}):e("setSinkId not available")):void e("Invalid parameters")},p=function(a){var b={offerToReceiveAudio:1,offerToReceiveVideo:1};return a&&(a.mandatory&&(a.mandatory.hasOwnProperty("OfferToReceiveAudio")&&(b.offerToReceiveAudio=a.mandatory.OfferToReceiveAudio?1:0),a.mandatory.hasOwnProperty("OfferToReceiveVideo")&&(b.offerToReceiveVideo=a.mandatory.OfferToReceiveVideo?1:0)),a.optional&&a.optional.some(function(a){if(a.hasOwnProperty("VoiceActivityDetection"))return b.voiceActivityDetection=!!a.VoiceActivityDetection,!0})),b};if(d.chrome)return b.info("Setting WebRTC APIs for Chrome"),RTCSessionDescription.prototype.toJSON=function(){return{type:this.type,sdp:this.sdp}},RTCIceCandidate.prototype.toJSON=function(){return{sdpMLineIndex:this.sdpMLineIndex,sdpMid:this.sdpMid,candidate:this.candidate}},a.WebRTCAdapter={enabled:!0,browser:"chrome",MediaStream:webkitMediaStream,PeerConnection:function(a,b){var c=new webkitRTCPeerConnection(a,b);return c.origCreateOffer=c.createOffer,c.createOffer=function(a,b,d){var e=p(d);c.origCreateOffer(e).then(function(b){a&&a(b)}).catch(function(a){b&&b(a)})},c.origCreateAnswer=c.createAnswer,c.createAnswer=function(a,b,d){var e=p(d);c.origCreateAnswer(e).then(function(b){a&&a(b)}).catch(function(a){b&&b(a)})},c},SessionDescription:RTCSessionDescription,IceCandidate:RTCIceCandidate,getUserMedia:navigator.webkitGetUserMedia.bind(navigator),createObjectURL:URL.createObjectURL.bind(URL),getAudioStreamTrackId:function(a){var b=a&&a.getAudioTracks()[0];return b?a.id+" "+b.id:""},getVideoStreamTrackId:function(a){var b=a&&a.getVideoTracks()[0];return b?a.id+" "+b.id:""},getAudioTrackId:function(a){var b=a&&a.getAudioTracks()[0];return b?b.id:""},getVideoTrackId:function(a){var b=a&&a.getVideoTracks()[0];return b?b.id:""},hasDeviceNameOnTrackLabel:!0,getAudioTrackLabel:function(a){var b=a&&a.getAudioTracks()[0];return b?b.label:""},getVideoTrackLabel:function(a){var b=a&&a.getVideoTracks()[0];return b?b.label:""},stopMediaStream:e,stopLocalVideoTrack:f,closePc:g,getMediaSources:function(a){return navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices?void j(a):void MediaStreamTrack.getSources(function(b){b=b&&b.map(function(a){return{id:a.id,kind:a.kind,label:a.label,facing:a.facing}}),h(b,a)})},getAudioOptions:function(a){var b=l(a);return a&&a.sourceId&&b.optional.push({sourceId:a.sourceId}),b},getVideoOptions:function(a){var b=m(a);return a&&a.sourceId&&b.optional.push({sourceId:a.sourceId}),b},getDesktopOptions:function(a,b){b=b||{};var c=b.frameRate||{};return{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:a,maxWidth:2560,maxHeight:1600},optional:[{googNoiseReduction:!0},{maxFrameRate:c.max||10},{minFrameRate:c.min||5}]}},audioOutputSelectionSupported:i(),groupPeerConnectionsSupported:!0,getMediaSourcesSupported:!0,attachSinkIdToAudioElement:o,toggleAudio:n},a;if(d.firefox){b.info("Setting WebRTC APIs for Firefox");var q=function(a){var b=[];return a.forEach(function(a){b.push(new r(a))}),b},r=function(a){switch(this.stats=a,this.id=a.id,a.type){case"inboundrtp":case"inbound-rtp":a.isRemote||(this.type="ssrc","audio"===a.mediaType?(this.stats.audioOutputLevel=!0,this.stats.googJitterReceived=a.jitter):this.stats.googFrameHeightReceived=!0);break;case"outboundrtp":case"outbound-rtp":a.isRemote||(this.type="ssrc","audio"===a.mediaType?this.stats.audioInputLevel=!0:this.stats.googFrameHeightSent=!0);break;case"candidatepair":case"candidate-pair":this.type="googCandidatePair","boolean"==typeof a.selected&&(this.googActiveConnection=a.selected?"true":"false");break;default:this.type=a.type}};r.prototype.names=function(){return Object.keys(this.stats)},r.prototype.stat=function(a){return this.stats[a]};var s="undefined"==typeof RTCPeerConnection?mozRTCPeerConnection:RTCPeerConnection,t="undefined"==typeof RTCSessionDescription?mozRTCSessionDescription:RTCSessionDescription,u="undefined"==typeof RTCIceCandidate?mozRTCIceCandidate:RTCIceCandidate;return a.WebRTCAdapter={enabled:!0,browser:"firefox",MediaStream:MediaStream,PeerConnection:function(a){var b=new s(a);return b.origCreateOffer=b.createOffer,b.createOffer=function(a,c,d){var e=p(d);b.origCreateOffer(e).then(function(b){a&&a(b)}).catch(function(a){c&&c(a)})},b.origCreateAnswer=b.createAnswer,b.createAnswer=function(a,c,d){var e=p(d);b.origCreateAnswer(e).then(function(b){a&&a(b)}).catch(function(a){c&&c(a)})},b.origGetStats=b.getStats,b.getStats=function(a,c){"function"==typeof a&&b.origGetStats().then(function(b){a(q(b))},c)},b.removeStream=function(){},b.createDTMFSender=function(a){if("function"!=typeof b.getSenders)return null;var c=b.getSenders().find(function(b){return b.track===a}),d=c&&c.dtmf;return d?(d.canInsertDTMF=!0,d):null},parseInt(d.version,10)>=46&&Object.defineProperty(b,"onaddstream",{enumerable:!0,get:function(){return b.onaddstreamCb},set:function(a){b.onaddstreamCb=a,a?b.ontrack=function(b){a({stream:b&&b.streams&&b.streams[0]})}:b.ontrack=null}.bind(b)}),b},SessionDescription:t,IceCandidate:u,getUserMedia:function(a,b,c){function d(a){b&&b(a),b=null,c=null}function e(a){c&&c(a),b=null,c=null}function f(){return g=null,i===h?void e("Timeout"):(++i,navigator.mediaDevices.getUserMedia(a).then(d).catch(e).then(function(){g&&window.clearTimeout(g),g=null}),void(g=window.setTimeout(f,1e4)))}var g=null,h=3,i=0;f()},createObjectURL:function(a){return URL.createObjectURL(a)},getAudioStreamTrackId:function(a){var b=a&&a.getAudioTracks()[0];return b?a.id+" "+b.id:""},getVideoStreamTrackId:function(a){var b=a&&a.getVideoTracks()[0];return b?a.id+" "+b.id:""},getAudioTrackId:function(a){var b=a&&a.getAudioTracks()[0];return b?b.id:""},getVideoTrackId:function(a){var b=a&&a.getVideoTracks()[0];return b?b.id:""},hasDeviceNameOnTrackLabel:!1,getAudioTrackLabel:function(a){var b=a&&a.getAudioTracks()[0];return b?b.label:""},getVideoTrackLabel:function(a){var b=a&&a.getVideoTracks()[0];return b?b.label:""},stopMediaStream:e,stopLocalVideoTrack:f,closePc:function(a){window.setTimeout(function(){g(a)},500)},getMediaSources:function(a){a&&j(a)},getAudioOptions:function(a){var b=l(a);return a&&a.sourceId&&(b.deviceId=a.sourceId),b},getVideoOptions:function(a){var b=m(a);return a&&a.sourceId&&(b.deviceId=a.sourceId),b},getDesktopOptions:function(a,b){b=b||{};var c=b.frameRate||{};return c.min=c.min||5,c.max=c.max||10,{mozMediaSource:b.mediaSource||"screen",mediaSource:b.mediaSource||"screen",width:{max:2560},height:{max:1600},advanced:[{frameRate:c}]}},audioOutputSelectionSupported:i(),groupPeerConnectionsSupported:!0,getMediaSourcesSupported:!0,attachSinkIdToAudioElement:o,iceTimeoutSafetyFactor:.5,toggleAudio:n},a}if(d.ios){b.info("Setting WebRTC APIs for iOS client");var v=function(a){this.id=a.id,this.type=a.type,this.timestamp=new Date(a.timestamp);var b={};Object.getOwnPropertyNames(a.values).forEach(function(c){b[c]=a.values[c]}),this.names=function(){return Object.getOwnPropertyNames(b)},this.stat=function(a){return b[a]},a=null},w=function(a){var b=a.map(function(a){return new v(a)});this.result=function(){return b},a=null};return a.WebRTCAdapter={enabled:!0,browser:"ios",PeerConnection:function(a,b){a=k(a);var c=RTCPeerConnection.createRTCPeerConnection(a,b);return c.origGetStats=c.getStats,c.getStats=function(a){"function"==typeof a&&c.origGetStats(function(b){a(new w(b))})},c.addIceCandidate=c.addIceCandidateJS,Object.defineProperties(c,{localDescription:{get:function(){return c.getLocalDescriptionJS()},enumerable:!0,configurable:!1},remoteDescription:{get:function(){return c.getRemoteDescriptionJS()},enumerable:!0,configurable:!1},signalingState:{get:function(){return c.getSignalingStateJS()},enumerable:!0,configurable:!1},iceConnectionState:{get:function(){return c.getIceConnectionStateJS()},enumerable:!0,configurable:!1},iceGatheringState:{get:function(){return c.getIceGatheringStateJS()},enumerable:!0,configurable:!1}}),c},SessionDescription:function(a){var b=RTCSessionDescription.createRTCSessionDescription(a);return b},IceCandidate:function(a){return{sdpMLineIndex:a.sdpMLineIndex,sdpMid:a.sdpMid,candidate:a.candidate}},getUserMedia:navigator.getUserMedia.bind(navigator),createObjectURL:URL.createObjectURL.bind(URL),getAudioStreamTrackId:function(a){var b=a&&a.getAudioTracks()[0];return b?a.streamId+" "+b.trackId:""},getVideoStreamTrackId:function(a){var b=a&&a.getVideoTracks()[0];return b?a.streamId+" "+b.trackId:""},getAudioTrackId:function(a){var b=a&&a.getAudioTracks()[0];return b?b.trackId:""},getVideoTrackId:function(a){var b=a&&a.getVideoTracks()[0];return b?b.trackId:""},hasDeviceNameOnTrackLabel:!1,getAudioTrackLabel:function(a){var b=a&&a.getAudioTracks()[0];return b?b.label:""},getVideoTrackLabel:function(a){var b=a&&a.getVideoTracks()[0];return b?b.label:""},stopMediaStream:e,stopLocalVideoTrack:f,closePc:g,getMediaSources:function(a){a&&a([],[])},getAudioOptions:l,getVideoOptions:m,getDesktopOptions:function(){return{mandatory:{iOSMediaSource:"desktop"}}},audioOutputSelectionSupported:!1,groupPeerConnectionsSupported:!1,getMediaSourcesSupported:!1,attachSinkIdToAudioElement:o,toggleAudio:n},a}if(d.android){b.info("Setting WebRTC APIs for Android client");var x=function(a){this.id=a.id,this.type=a.type,this.timestamp=new Date(a.timestamp);var b={};Object.getOwnPropertyNames(a.values).forEach(function(c){var d=a.values[c];d.name&&(b[d.name]=d.value)}),this.names=function(){return Object.getOwnPropertyNames(b)},this.stat=function(a){return b[a]},a=null},y=function(a){var b=a.map(function(a){return new x(a)});this.result=function(){return b},a=null},z=RTCPeerConnection.bind(RTCPeerConnection);return a.WebRTCAdapter={enabled:!0,browser:"android",PeerConnection:function(a,b){a=k(a);var c=z(a,b);return c.getStats=function(a){"function"==typeof a&&c.origGetStats(function(b){a(new y(b.data))})},c},SessionDescription:function(a){return{type:a.type,sdp:a.sdp}},IceCandidate:function(a){return{sdpMLineIndex:a.sdpMLineIndex,sdpMid:a.sdpMid,candidate:a.candidate}},getUserMedia:navigator.getUserMedia.bind(navigator),createObjectURL:function(){return"dummy"},getAudioStreamTrackId:function(a){var b=a&&a.getAudioTracks()[0];return b?a.id+" "+b.id:""},getVideoStreamTrackId:function(a){var b=a&&a.getVideoTracks()[0];return b?a.id+" "+b.id:""},getAudioTrackId:function(a){var b=a&&a.getAudioTracks()[0];return b?b.id:""},getVideoTrackId:function(a){var b=a&&a.getVideoTracks()[0];return b?b.id:""},hasDeviceNameOnTrackLabel:!1,getAudioTrackLabel:function(a){var b=a&&a.getAudioTracks()[0];return b?b.label:""},getVideoTrackLabel:function(a){var b=a&&a.getVideoTracks()[0];return b?b.label:""},stopMediaStream:e,stopLocalVideoTrack:f,closePc:g,getMediaSources:function(a){a&&a([],[])},getAudioOptions:l,getVideoOptions:m,getDesktopOptions:function(){return!1},audioOutputSelectionSupported:!1,groupPeerConnectionsSupported:!1,getMediaSourcesSupported:!1,attachSinkIdToAudioElement:o,toggleAudio:n},a}if(d.dotnet)return b.info("Setting WebRTC APIs for .NET client"),a.WebRTCAdapter={enabled:!0,browser:"dotnet",PeerConnection:function(a,b){a=k(a);var c=new RTCPeerConnection(a,b);return c.origGetStats=c.getStats,c.getStats=function(a){"function"==typeof a&&a()},Object.defineProperties(c,{localDescription:{get:function(){return c.getLocalDescription()},enumerable:!0,configurable:!1},remoteDescription:{get:function(){return c.getRemoteDescription()},enumerable:!0,configurable:!1},signalingState:{get:function(){return c.getSignalingState()},enumerable:!0,configurable:!1},iceConnectionState:{get:function(){return c.getIceConnectionState()},enumerable:!0,configurable:!1},iceGatheringState:{get:function(){return c.getIceGatheringState()},enumerable:!0,configurable:!1}}),c},SessionDescription:function(a){return{type:a.type,sdp:a.sdp}},IceCandidate:function(a){return{sdpMLineIndex:a.sdpMLineIndex,sdpMid:a.sdpMid,candidate:a.candidate}},getUserMedia:function(a,b,c){var d={audioEnabled:!(!a||!a.audio),videoEnabled:!(!a||!a.video)};return navigator.getUserMedia(d,b,c)},createObjectURL:function(a){return a.id},getAudioStreamTrackId:function(a){var b=a&&a.getAudioTracks()[0];return b?a.id+" "+b.id:""},getVideoStreamTrackId:function(a){var b=a&&a.getVideoTracks()[0];return b?a.id+" "+b.id:""},getAudioTrackId:function(a){var b=a&&a.getAudioTracks()[0];return b?b.id:""},getVideoTrackId:function(a){var b=a&&a.getVideoTracks()[0];return b?b.id:""},hasDeviceNameOnTrackLabel:!0,getAudioTrackLabel:function(a){var b=a&&a.getAudioTracks()[0];
return b?b.label:""},getVideoTrackLabel:function(a){var b=a&&a.getVideoTracks()[0];return b?b.label:""},stopMediaStream:e,stopLocalVideoTrack:f,closePc:g,getMediaSources:function(a){a&&a([],[])},getAudioOptions:function(a){var b=l(a);return a&&a.sourceId&&b.optional.push({sourceId:a.sourceId}),b},getVideoOptions:function(a){var b=m(a);return a&&a.sourceId&&b.optional.push({sourceId:a.sourceId}),b},getDesktopOptions:function(a,b){b=b||{};var c=b.frameRate||{};return{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:a,maxWidth:2560,maxHeight:1600},optional:[{googNoiseReduction:!0},{maxFrameRate:c.max||10},{minFrameRate:c.min||5}]}},audioOutputSelectionSupported:i(),groupPeerConnectionsSupported:!1,getMediaSourcesSupported:!1,attachSinkIdToAudioElement:o,toggleAudio:n},a;if(c)return b.info("Setting WebRTC APIs for IE with Temasys plugin"),a.WebRTCAdapter={enabled:!0,browser:"msie",PeerConnection:function(a,b){return a=k(a),c.PeerConnection(a,b)},SessionDescription:c.SessionDescription,IceCandidate:c.IceCandidate,getUserMedia:c.getUserMedia,createObjectURL:function(a,b,d){return c.createObjectURL(a,d)},attachMediaStream:c.attachMediaStream,getAudioStreamTrackId:function(a){var b=a&&a.getAudioTracks()[0];return b?a.label+" "+b.id:""},getVideoStreamTrackId:function(a){var b=a&&a.getVideoTracks()[0];return b?a.label+" "+b.id:""},getAudioTrackId:function(a){var b=a&&a.getAudioTracks()[0];return b?b.id:""},getVideoTrackId:function(a){var b=a&&a.getVideoTracks()[0];return b?b.id:""},hasDeviceNameOnTrackLabel:!1,getAudioTrackLabel:function(a){var b=a&&a.getAudioTracks()[0];return b?b.label:""},getVideoTrackLabel:function(a){var b=a&&a.getVideoTracks()[0];return b?b.label:""},stopMediaStream:e,stopLocalVideoTrack:f,closePc:g,getMediaSources:function(a){c.getMediaSources(function(b){h(b,a)})},getAudioOptions:function(a){return!a||!a.sourceId||{optional:[{sourceId:a.sourceId}]}},getVideoOptions:function(a){return!a||!a.sourceId||{optional:[{sourceId:a.sourceId}]}},getDesktopOptions:function(){return{optional:[{sourceId:c.screensharingKey()}]}},audioOutputSelectionSupported:!1,groupPeerConnectionsSupported:!0,getMediaSourcesSupported:!1,attachSinkIdToAudioElement:o,toggleAudio:n},a;b.info("WebRTC is not supported")}catch(a){b.error("Failed to initialize WebRTCAdapter. ",a)}return a.WebRTCAdapter={enabled:!1,browser:"",PeerConnection:function(){},SessionDescription:function(){},IceCandidate:function(){},getUserMedia:function(a,b,c){c&&c("Not supported")},createObjectURL:function(){return""},getAudioStreamTrackId:function(){return""},getVideoStreamTrackId:function(){return""},getAudioTrackId:function(){return""},getVideoTrackId:function(){return""},hasDeviceNameOnTrackLabel:!1,getAudioTrackLabel:function(){return""},getVideoTrackLabel:function(){return""},stopMediaStream:function(){},stopLocalVideoTrack:function(){},closePc:function(){},getMediaSources:function(a){a&&a([],[])},getAudioOptions:function(){return!1},getVideoOptions:function(){return!1},getDesktopOptions:function(){return!1},audioOutputSelectionSupported:!1,groupPeerConnectionsSupported:!1,getMediaSourcesSupported:!1,attachSinkIdToAudioElement:function(a,b,c){c&&c()},toggleAudio:function(){return!1}},a}(Circuit),Circuit=function(a){"use strict";function b(a,g,h){function i(){for(var a=0;a<K;a++)try{H.iceCandidatePoolSize=1;var b=new f.PeerConnection(H,I);L.push(b),k(b),c.debug("[RTCPeerConnections]: Created aux video PeerConnection")}catch(a){c.error("[RTCPeerConnections]:  Failed to create aux video PeerConnection.",a)}}function j(){H.iceCandidatePoolSize=2,J=new f.PeerConnection(H,I),k(J),c.debug("[RTCPeerConnections]: Created main audio/video RTCPeerConnection"),f.groupPeerConnectionsSupported&&i()}function k(a){a.onnegotiationneeded=n.bind(null,a),a.onicecandidate=o.bind(null,a),a.onsignalingstatechange=p.bind(null,a),a.onaddstream=q.bind(null,a),a.onremovestream=r.bind(null,a),a.oniceconnectionstatechange=s.bind(null,a)}function l(a){a.onnegotiationneeded=null,a.onicecandidate=null,a.onsignalingstatechange=null,a.onaddstream=null,a.onremovestream=null,a.oniceconnectionstatechange=null}function m(a){if(a===J)return!0;var b=L.some(function(b){if(a===b)return!0});return b}function n(a,b){return c.debug("[RTCPeerConnections]: onnegotiationneeded"),m(a)?void A(b):void c.debug("[RTCPeerConnections]:  Event is from Old Peer Connection")}function o(a,b){if(c.debug("[RTCPeerConnections]: onicecandidate: iceGatheringState =",a.iceGatheringState),!m(a))return void c.debug("[RTCPeerConnections]:  Event is from Old Peer Connection");if(b.candidate){if(a!==J){var d=L.indexOf(a);if(d>=0){var e=new f.IceCandidate({sdpMLineIndex:b.candidate.sdpMLineIndex+d+2,sdpMid:b.candidate.sdpMid,candidate:b.candidate.candidate});b={candidate:e}}}}else{if(N++,N<L.length+1)return;c.debug("[RTCPeerConnections]:  End of candidates - all peer connections"),N=0}B(b)}function p(a,b){return c.debug("[RTCPeerConnections]: onsignalingstatechange: signalingState =",a.signalingState),m(a)?void C(b):void c.debug("[RTCPeerConnections]:  Event is from Old Peer Connection")}function q(a,b){return c.debug("[RTCPeerConnections]: onaddstream"),m(a)?(c.debug("[RTCPeerConnections]:  Added Remote Stream: ",b.stream),void D(b)):void c.debug("[RTCPeerConnections]:  Event is from Old Peer Connection")}function r(a,b){return c.debug("[RTCPeerConnections]: onremovestream"),m(a)?(c.warning("[RTCPeerConnections]:  Removed Remote Stream: ",b.stream),void E(b)):void c.debug("[RTCPeerConnections]:  Event is from Old Peer Connection")}function s(a,b){var d=K>0?" - "+(a===J?1:L.indexOf(a)+2):"",e=a.iceConnectionState;if(c.debug("[RTCPeerConnections]: oniceconnectionstatechange"+d+": iceConnectionState =",e),!m(a))return void c.debug("[RTCPeerConnections]: Event is from Old Peer Connection.");if(O!==e){if(K>0){var f;switch(e){case"connected":f=(J.iceConnectionState===e||"completed"===J.iceConnectionState)&&L.every(function(a){return a.iceConnectionState===e||"completed"===a.iceConnectionState});break;case"completed":case"closed":f=J.iceConnectionState===e&&L.every(function(a){return a.iceConnectionState===e});break;case"checking":f="new"===O;break;default:f=!0}if(!f)return}O=e,F(b)}}function t(a,c){b.maxVideoBandwidth>0&&d.setVideoBandwidth(a,b.maxVideoBandwidth,c)}function u(a){if(0===K)return J[a];var b=d.parse(J[a].sdp);1===b.m.length&&"audio"===b.m[0].media&&"remoteDescription"!==a&&d.addEmptyVideoLine(b),L.every(function(c){if(!c[a])return!1;var e=d.parse(c[a].sdp);e=d.verifyFingerprintInMLines(e);var f=e.m.some(function(a){if("video"===a.media)return b.m.push(a),!0});return!!f});var c=new f.SessionDescription({type:J[a].type,sdp:d.stringify(b)});return c}function v(){J.createdLocalSdp=void 0,L.forEach(function(a){a.createdLocalSdp=void 0})}function w(a,b){var c=d.parse(a.sdp);t(c,!0),K&&c.m.forEach(function(a){if("video"===a.media)for(var c=0,d=a.a.length;c<d;c++)if("mid"===a.a[c].field){a.a[c].value="video_"+(b-1);break}});var e=new f.SessionDescription({type:a.type,sdp:d.stringify(c)});return e}function x(a,b){var e=d.parse(a.sdp),g=d.hasVideo(e);if(!g)return a;var h=d.getConnectionMode(e,{mediaType:"video"});c.info("[RTCPeerConnections]: Local description has video with a="+h),"sendonly"!==h||b.video?t(e,!0):(e=d.setConnectionMode(e,"video","inactive"),c.warning("[RTCPeerConnections]:  Set video connection mode to inactive"));var i=new f.SessionDescription({type:a.type,sdp:d.stringify(e)});return i}function y(a){return"pranswer"===a.type&&(a.type="answer"),a}function z(a,b){if("function"==typeof a)try{a(b)}catch(a){c.error(a)}}function A(a){z(G.onnegotiationneeded,a)}function B(a){z(G.onicecandidate,a)}function C(a){z(G.onsignalingstatechange,a)}function D(a){z(G.onaddstream,a)}function E(a){z(G.onremovestream,a)}function F(a){z(G.oniceconnectionstatechange,a)}var G=this,H=e.shallowCopy(a),I=g,J=null,K=h&&h.extraVideoChannels||0,L=[],M={mandatory:{OfferToReceiveAudio:!1,OfferToReceiveVideo:!0}},N=0,O="new";this.onnegotiationneeded=null,this.onicecandidate=null,this.onsignalingstatechange=null,this.onaddstream=null,this.onremovestream=null,this.oniceconnectionstatechange=null,this.createOffer=function(a,b,d){function e(d,e){if(g++,c.debug("[RTCPeerConnections]: createOffer, count: ",g),d.createdLocalSdp=w(e,g),g>=L.length+1){if(h)b(h);else{var f=u("createdLocalSdp");a(f)}v()}}function f(a){g++,h||(h=a),g>=L.length+1&&b(h)}var g=0,h=null;J.createOffer(e.bind(null,J),f,d),L.forEach(function(a){a.createOffer(e.bind(null,a),f,M)})},this.createAnswer=function(a,b,d,e){function f(d,f){if(h++,c.debug("[RTCPeerConnections]: createAnswer, count: ",h),d===J?d.createdLocalSdp=x(f,e):d.createdLocalSdp=x(f,{video:!1}),h>=L.length+1){if(i)b(i);else{var g=u("createdLocalSdp");a(g)}v()}}function g(a){h++,i||(i=a),h>=L.length+1&&b(i)}var h=0,i=null;J.createAnswer(f.bind(null,J),g),L.forEach(function(a){return a.remoteDescription?void a.createAnswer(f.bind(null,a),g,d):void h++})},this.setLocalDescription=function(a,b,e){function g(){i++,c.debug("[RTCPeerConnections]: setLocalDescription onLocalSdpApplied, count: ",i),i>=L.length+1&&(j?e(j):b())}function h(a){i++,c.error("[RTCPeerConnections]: setLocalDescription error, count: "+i+"\n",a),j||(j=a),i>=L.length+1&&e(j)}var i=0,j=null,k=d.parse(a.sdp),l=k.m;if(k.m=l.slice(0,2),"answer"===a.type){var m=d.parse(J.remoteDescription.sdp);1===m.m.length&&(c.info("[RTCPeerConnections]: only 1 mline in remote sdp offer"),k.m=k.m.slice(0,1))}var n=new f.SessionDescription({type:a.type,sdp:d.stringify(k)});J.setLocalDescription(n,g,h),L.forEach(function(b,e){return l[e+2]?(k.m=[l[e+2]],n=new f.SessionDescription({type:a.type,sdp:d.stringify(k)}),void b.setLocalDescription(n,g,h)):(i++,void c.warning("[RTCPeerConnections]: missing sdp mline for peer connection: "+i))})},this.setRemoteDescription=function(a,b,e){function g(){i++,c.debug("[RTCPeerConnections]: setRemoteDescription onRemoteSdpApplied, count: ",i),i>=L.length+1&&(j?e(j):b())}function h(a){i++,j||(j=a),i>=L.length+1&&e(j)}var i=0,j=null,k=d.parse(a.sdp),l=k.m;k.m=l.slice(0,2);var m=new f.SessionDescription({type:a.type,sdp:d.stringify(k)});m=y(m),J.setRemoteDescription(m,g.bind(null,J),h),L.forEach(function(b,e){return l[e+2]?(k.m=[l[e+2]],m=new f.SessionDescription({type:a.type,sdp:d.stringify(k)}),m=y(m),void b.setRemoteDescription(m,g.bind(null,b),h)):(i++,void c.warning("[RTCPeerConnections]: missing sdp mline for peer connection: "+i))})},this.removeStream=function(a){return J.removeStream(a)},this.addStream=function(a){return J.addStream(a)},this.getLocalStreams=function(){return J.getLocalStreams()},this.getRemoteStreams=function(){var a=J.getRemoteStreams().slice(0);return L.forEach(function(b){a.push.apply(a,b.getRemoteStreams())}),a},this.addIceCandidate=function(a){if(!a)return J.addIceCandidate(),void L.forEach(function(a){a.addIceCandidate()});if(a.sdpMLineIndex<=1)return void J.addIceCandidate(new f.IceCandidate(a));var b=a.sdpMLineIndex-2;L[b]&&(a.sdpMLineIndex=0,L[b].addIceCandidate(new f.IceCandidate(a)))},this.close=function(){J.close(),l(J),L.forEach(function(a){a.close(),l(a)})},this.createDTMFSender=function(a){return J.createDTMFSender(a)},Object.defineProperties(this,{localDescription:{get:function(){return u("localDescription")},enumerable:!0,configurable:!1}}),Object.defineProperties(this,{remoteDescription:{get:function(){return u("remoteDescription")},enumerable:!0,configurable:!1}}),Object.defineProperties(this,{signalingState:{get:function(){return J.signalingState},enumerable:!0,configurable:!1},iceConnectionState:{get:function(){return K>0?O:J.iceConnectionState},enumerable:!0,configurable:!1}}),Object.defineProperties(this,{mainPeerConnection:{get:function(){return J},enumerable:!1,configurable:!1},groupPeerConnections:{get:function(){return L},enumerable:!0,configurable:!1}}),j()}var c=a.logger,d=a.sdpParser,e=a.Utils,f=a.WebRTCAdapter;return b.maxVideoBandwidth=512,a.RtcPeerConnections=b,a}(Circuit||{}),Circuit=function(a){"use strict";var b=a.Constants,c={Active:{name:"Active",ui:"",established:!0,css:"active-call"},Busy:{name:"Busy",ui:"res_ParticipantState_busy",established:!1,css:"busy"},Calling:{name:"Calling",ui:"",established:!1,css:"calling"},Connecting:{name:"Connecting",ui:"",established:!1,css:"connecting"},ConnectionLost:{name:"ConnectionLost",ui:"res_ParticipantState_connectionLost",established:!1,css:"connection-lost"},Declined:{name:"Declined",ui:"res_ParticipantState_declined",established:!1,css:"declined"},Delivered:{name:"Delivered",ui:"",established:!1,css:"outgoing"},Idle:{name:"Idle",ui:"",established:!1,css:"idle"},Inactive:{name:"Inactive",ui:"",established:!1,css:"inactive"},Initiated:{name:"Initiated",ui:"",established:!1,css:"outgoing"},Joined:{name:"Joined",ui:"res_ParticipantState_joined",established:!0,css:"joined-call"},Muted:{name:"Muted",ui:"res_ParticipantState_muted",established:!0,css:"muted"},Offline:{name:"Offline",ui:"res_ParticipantState_offline",established:!1,css:"offline"},OffStage:{name:"OffStage",ui:"res_ParticipantState_leftStage",established:!1,css:"declined"},OnStage:{name:"OnStage",ui:"res_ParticipantState_enteredStage",established:!0,css:"joined-call"},Removed:{name:"Removed",ui:"res_ParticipantState_removed",established:!1,css:"declined"},Ringing:{name:"Ringing",ui:"",established:!1,css:"incoming"},Terminated:{name:"Terminated",ui:"res_ParticipantState_left",established:!1,css:"declined"},Timeout:{name:"Timeout",ui:"res_ParticipantState_missed",established:!1,css:"busy"}},d={Drop:{name:"Drop",type:"hangup",icon:"",localize:"res_Hangup"},Mute:{name:"Mute",type:"microphone",icon:"unmuted",localize:"res_Mute"},Unmute:{name:"Unmute",type:"microphone",icon:"muted",localize:"res_Unmute"},StartVideo:{name:"StartVideo",type:"video",icon:"inactive",localize:"res_StartVideo"},StopVideo:{name:"StopVideo",type:"video",icon:"active",localize:"res_StopVideo"},ToggleVideoInProgress:{name:"ToggleVideoInProgress",type:"video",icon:"progress-icon",localize:""},RemoveFromStage:{name:"DropFromStage",type:"hangup",icon:"drop-from-stage",localize:""}},e={};return e.createFromUser=function(a,b){if(!a)return null;var d=Object.create(a);return d.pcState=b||c.Idle,d.streamId=null,d.screenStreamId=null,d.videoUrl="",d.mediaType={audio:!1,video:!1,desktop:!1},d.muted=!1,d.activeSpeaker=!1,d.isExternal=!!a.isExternal,d.isActive=e.isActive.bind(null,d),d.actions=[],d.screenSharePointerSupported=!1,d.hasSameMediaType=e.hasSameMediaType.bind(null,d),d.hasVideoStream=e.hasVideoStream.bind(null,d),d.setActions=e.setActions.bind(null,d),d.toJSON=function(){return this},d.userId=a.userId,d.firstName=a.firstName,d.lastName=a.lastName,d},e.isActive=function(a){switch(a.pcState){case c.Active:case c.Joined:case c.Muted:case c.OnStage:return!0}return!1},e.hasSameMediaType=function(a,b){return!!(a&&b&&a.mediaType&&b.mediaType&&a.mediaType.audio===b.mediaType.audio&&a.mediaType.video===b.mediaType.video&&a.mediaType.desktop===b.mediaType.desktop)},e.hasVideoStream=function(a){return!(!a.videoUrl||!a.streamId&&!a.screenStreamId||!a.mediaType.video&&!a.mediaType.desktop)},e.setActions=function(a,e,f){if(a.actions=[],!e||!e.isTemporary){if(!a.pcState.established)return void(a.pcState===c.Initiated&&a.actions.push(d.Drop));if(a.isMeetingPointInvitee)a.toggleVideoInProgress?a.actions.push(d.ToggleVideoInProgress):a.actions.push(a.mediaType.video?d.StopVideo:d.StartVideo),a.actions.push(a.muted?d.Unmute:d.Mute),a.actions.push(d.Drop);else{var g=!e||e.isModerated,h=e&&e.userIsModerator(f),i=e&&e.userIsModerator(a);a.muted||g&&i&&!h||a.actions.push(d.Mute),g&&!h||(e.type===b.ConversationType.LARGE&&a.isSessionGuest&&h?a.actions.push(d.RemoveFromStage):a.actions.push(d.Drop))}}},a.RtcParticipant=e,a.Enums=a.Enums||{},a.Enums.ParticipantState=c,a.Enums.ParticipantAction=d,a}(Circuit||{}),Circuit=function(a){"use strict";function b(){var a=null;this.cstaConn=null,this.cstaState=f.Idle,this.position=e.Other,this.servicesPermitted={},this.peerFQN="",this.peerDn="",this.peerName=null,this.missedReason="",this.ignoreCall=!1,this.originalPartnerDisplay={},this.handoverInProgress=!1,this.holdInProgress=!1,this.retrieveInProgress=!1,this.redirectingUser={},this.setPeerName=function(a){this.peerName=a||""},this.setPartnerDisplay=function(a){a&&(this.peerFQN=a.fqn||"",this.peerDn=a.dn||a.fqn||"",this.peerName=a.name||this.peerDn,!this.peerFQN&&this.peerDn.startsWith("+")&&(this.peerFQN=this.peerDn))},this.setOriginalPartnerDisplay=function(a){a&&d.isEmptyObject(this.originalPartnerDisplay)&&(this.originalPartnerDisplay=a)},this.setCstaConnection=function(a){this.cstaConn=a,this.isRemote&&(this.callId=a.cID)},this.getCstaConnection=function(){return this.cstaConn},this.getCstaCallId=function(){return this.cstaConn&&this.cstaConn.cID},this.getCstaDeviceId=function(){return this.cstaConn&&this.cstaConn.dID},this.setServicesPermitted=function(a){return!a||d.isEmptyObject(a)?void c.info("[AtcCallInfo]: Empty services permitted, keeping last values"):(a.rSP&&void 0!==a.rSP.cCSs&&(this.servicesPermitted.rSP=a.rSP),void 0!==a.eSP&&(this.servicesPermitted.eSP=a.eSP),void c.info("[AtcCallInfo]: Updated services permitted: ",this.servicesPermitted))},this.clearServicesPermitted=function(){this.servicesPermitted={}},this.getServicesPermitted=function(){return this.servicesPermitted},this.isHandoverAllowed=function(){return(this.isSilentHandoverAllowed()||this.isSeamlessHandoverAllowed())&&!this.isHandoverInProgress()},this.isSeamlessHandoverAllowed=function(){return!(!this.servicesPermitted.eSP||!this.servicesPermitted.eSP.zseHo)},this.isSilentHandoverAllowed=function(){return!(!this.servicesPermitted.eSP||!this.servicesPermitted.eSP.zsiHo)},this.isTransferAllowed=function(){return!(!this.servicesPermitted.rSP||!this.servicesPermitted.rSP.cCSs.sST||this.isHandoverInProgress())},this.isAlternateAllowed=function(){return!(!this.servicesPermitted.rSP||!this.servicesPermitted.rSP.cCSs.alC)},this.isAnswerAllowed=function(){return this.servicesPermitted.rSP?!!this.servicesPermitted.rSP.cCSs.anC:this.cstaState===f.Ringing},this.isCallBackAllowed=function(){return!(!this.servicesPermitted.rSP||!this.servicesPermitted.rSP.cCSs.cB)},this.isConsultAllowed=function(){return!(!this.servicesPermitted.rSP||!this.servicesPermitted.rSP.cCSs.csC)},this.isDeflectAllowed=function(){return this.cstaState===f.Parked||this.cstaState===f.Ringing||!(!this.servicesPermitted.rSP||!this.servicesPermitted.rSP.cCSs.dCl)},this.isGenerateDigitsAllowed=function(){return!(!this.servicesPermitted.rSP||!this.servicesPermitted.rSP.cAS.gD)},this.isHoldAllowed=function(){if(this.isHandoverInProgress())return!1;if(this.servicesPermitted.rSP)return this.servicesPermitted.rSP.cCSs.hCl;switch(this.cstaState){case f.Active:case f.Conference:case f.Held:return!0;default:return!1}},this.isConferenceCall=function(){return this.cstaState===f.Conference||this.cstaState===f.ConferenceHolding},this.isMakeCallAllowed=function(){return!(!this.servicesPermitted.rSP||!this.servicesPermitted.rSP.cCSs.mCl)},this.isReconnectAllowed=function(){return!(!this.servicesPermitted.rSP||!this.servicesPermitted.rSP.cCSs.rC)},this.isRetrieveAllowed=function(){if(this.isHandoverInProgress())return!1;if(this.servicesPermitted.rSP)return this.servicesPermitted.rSP.cCSs.reC;switch(this.cstaState){case f.ConferenceHolding:case f.Holding:case f.HoldOnHold:return!0;default:return!1}},this.isTransferCallAllowed=function(){return!(!this.servicesPermitted.rSP||!this.servicesPermitted.rSP.cCSs.tCl||this.isHandoverInProgress())},this.isConferenceCallAllowed=function(){return!(!this.servicesPermitted.rSP||!this.servicesPermitted.rSP.cCSs.coC)},this.getPosition=function(){return this.position},this.setPosition=function(a){a&&a!==this.position&&(this.position=a,c.debug("[AtcCallInfo]: Set call position to ",a.name))},this.getMissedReason=function(){return this.missedReason},this.setMissedReason=function(a){a&&a!==this.missedReason&&(this.missedReason=a,c.debug("[AtcCallInfo]: Set missedReason to ",a))},this.getIgnoreCall=function(){return this.ignoreCall||this.cstaState===f.Offered},this.setIgnoreCall=function(a){this.ignoreCall=a},this.isHandoverInProgress=function(){return this.handoverInProgress},this.setHandoverInProgress=function(){this.handoverInProgress=!0},this.clearHandoverInProgress=function(){this.handoverInProgress=!1},this.isHoldInProgress=function(){return this.holdInProgress},this.setHoldInProgress=function(){this.holdInProgress=!0},this.clearHoldInProgress=function(){this.holdInProgress=!1},this.isRetrieveInProgress=function(){return this.retrieveInProgress},this.setRetrieveInProgress=function(){this.retrieveInProgress=!0},this.clearRetrieveInProgress=function(){this.retrieveInProgress=!1},this.setTransferCallFailedCause=function(b){if(this.cstaState===f.TransferFailed)switch(b){case"busy":a=k.Busy;break;case"doNotDisturb":a=k.DND;break;default:a=k.Unreachable}},this.getTransferCallFailedCause=function(){return this.cstaState===f.TransferFailed?a||k.Unreachable:null},this.setRedirectingUser=function(a,b,c,d,e){e=e||this.redirectingUser.redirectionType,this.redirectingUser&&this.redirectingUser.fqNumber&&this.redirectingUser.fqNumber!==b||(this.redirectingUser={userId:d||"",displayName:c,phoneNumber:a,fqNumber:b,redirectionType:e})},this.getRedirectingUser=function(){return this.redirectingUser},this.setRedirectionType=function(a){this.redirectingUser.redirectionType=a},this.getRedirectionType=function(){return this.redirectingUser&&this.redirectingUser.redirectionType},this.isForwarded=function(){return this.redirectingUser&&this.redirectingUser.redirectionType===l.CallForward}}var c=a.logger,d=a.Utils,e={WebRTC:{name:"WebRTC",ui:"res_CircuitClient",css:"circuit"},Cell:{name:"Cell",ui:"res_BackupNumber",css:"mobile"},Desk:{name:"Desk",ui:"res_Deskphone",css:"desk"},VM:{name:"VM",ui:"res_Voicemail",css:"vm"},Other:{name:"Other",ui:"res_CallAtOther",css:""}},f=Object.freeze({Idle:{name:"Idle",ui:"",established:!1},Initiated:{name:"Initiated",established:!1},Connecting:{name:"Connecting",established:!1},Delivered:{name:"Delivered",established:!1},Busy:{name:"Busy",established:!1},Offered:{name:"Offered",established:!1},Failed:{name:"Failed",established:!1},TransferFailed:{name:"TransferFailed",established:!1},Ringing:{name:"Ringing",established:!1},ExtendedRinging:{name:"ExtendedRinging",established:!1},Active:{name:"Active",established:!0},Held:{name:"Held",established:!0},Holding:{name:"Holding",established:!0},HoldOnHold:{name:"HoldOnHold",established:!0},Parked:{name:"Parked",established:!0},Conference:{name:"Conference",established:!0},ConferenceHolding:{name:"ConferenceHolding",established:!0},Terminated:{name:"Terminated",established:!1}}),g=Object.freeze({DefaultRouting:{name:"DefaultRouting",ui:"res_BusyHandling_DefaultRouting"},BusySignal:{name:"BusySignal",ui:"res_BusyHandling_BusySignal"},SendToAlternativeNumber:{name:"SendToAlternativeNumber",ui:"res_BusyHandling_AlternativeNumber"},SendToVM:{name:"SendToVM",ui:"res_BusyHandling_Voicemail"}}),h=Object.freeze({DefaultRouting:{name:"DefaultRouting",ui:"res_BusyHandling_DefaultRouting",desc:"res_DefaultRoutingDescription"},DeskPhone:{name:"DeskPhone",ui:"res_Deskphone",desc:"res_DeskphoneRoutingDescription"},AlternativeNumber:{name:"AlternativeNumber",ui:"res_BusyHandling_AlternativeNumber",desc:"res_AlternativeNumberRoutingDescription"},VM:{name:"VoiceMail",ui:"res_Voicemail",desc:"res_VoicemailRoutingDescription"},Other:{name:"Other",ui:"res_Other",desc:""}}),i=Object.freeze({REGULAR:"REGULAR",MISSED:"MISSED"}),j=Object.freeze({DEFAULT:"DEFAULT",DEST_OUT_OF_ORDER:"DEST_OUT_OF_ORDER",REORDER_TONE:"REORDER_TONE",BUSY:"BUSY",CANCELLED:"CANCELLED",DECLINED:"DECLINED",TRANSFERRED:"TRANSFERRED"}),k=Object.freeze({Busy:{name:"Busy",ui:"res_TransferCallFailedCauseBusy"},Unreachable:{name:"Unreachable",ui:"res_TransferCallFailedCauseUnreachable"},DND:{name:"Dnd",ui:"res_TransferCallFailedCauseDND"}}),l=Object.freeze({CallForward:{name:"callForward",ui:"res_ForwardedFrom"}});return a.AtcCallInfo=b,a.Enums=a.Enums||{},a.Enums.CstaCallState=f,a.Enums.Targets=e,a.Enums.JournalEntryTypes=i,a.Enums.MissedReasonTypes=j,a.BusyHandlingOptions=g,a.RoutingOptions=h,a.Enums.TransferCallFailedCauses=k,a.Enums.RedirectionTypes=l,a}(Circuit||{}),Circuit=function(a){"use strict";function b(a,b){function d(a){g=a.rtcSessionId,m=a.convId,n=a.type,o=a.topic||a.participantFirstNames,p=a.topicEscaped||a.participantFirstNamesEscaped,q=a.creatorId,s=a.type===c.ConversationType.DIRECT,t=a.type===c.ConversationType.LARGE,u=a.isTelephonyConv,v=a.testCall,s?e.peerUser=a.peerUser:delete e.peerUser,e.peerUsers=a.peerUsers,e.numConvParticipants=a.participants.length,e.avatar=a.avatar,e.isGuestInvite=!!a.isTemporary}if(!a)throw new Error("Cannot create BaseCall object without a conversation");b=!!b;var e=this,g=null,h=null,m=null,n=null,o=null,p=null,q=null,r=null,s=!1,t=!1,u=!1,v=!1,w=l.Idle,x=null;Object.defineProperties(this,{isRemote:{value:b,writable:!1,enumerable:!0,configurable:!1},callId:{get:function(){return g},enumerable:!0,configurable:!1},instanceId:{get:function(){return h},enumerable:!0,configurable:!1},transactionId:{get:function(){return r},enumerable:!0,configurable:!1},state:{get:function(){return w},enumerable:!0,configurable:!1},convId:{get:function(){return m},enumerable:!0,configurable:!1},convType:{get:function(){return n},enumerable:!0,configurable:!1},convTitle:{get:function(){return o||s&&this.peerUser.displayName},enumerable:!0,configurable:!1},convTitleEscaped:{get:function(){return p||s&&this.peerUser.displayNameEscaped},enumerable:!0,configurable:!1},containsExternals:{get:function(){return this.participants.some(function(a){return a.participantType===c.RTCParticipantType.SESSION_GUEST||a.participantType===c.RTCParticipantType.EXTERNAL})},enumerable:!1,configurable:!1},ownerId:{get:function(){return q},enumerable:!0,configurable:!1},isDirect:{get:function(){return s},enumerable:!0,configurable:!1},isLarge:{get:function(){return t},enumerable:!0,configurable:!1},conferenceCall:{get:function(){return!s},enumerable:!0,configurable:!1},isGroupCallStarted:{get:function(){return!(this.isDirect||this.state!==l.Started)},enumerable:!0,configurable:!1},isGroupCallInitiated:{get:function(){return!(this.isDirect||this.state!==l.Initiated)},enumerable:!0,configurable:!1},isGroupCallActive:{get:function(){return!(this.isDirect||this.state!==l.Active)},enumerable:!0,configurable:!1},isTelephonyCall:{get:function(){return u},enumerable:!0,configurable:!1},isTestCall:{get:function(){return v},enumerable:!0,configurable:!1},conversationFeedView:{get:function(){return!0},enumerable:!0,configurable:!0},isPullAllowed:{value:!1,enumerable:!0,configurable:!0},isHandoverAllowed:{get:function(){return!!this.atcCallInfo&&this.atcCallInfo.isHandoverAllowed()},enumerable:!0,configurable:!0},isHandoverInProgress:{get:function(){return!!this.atcCallInfo&&this.atcCallInfo.isHandoverInProgress()},enumerable:!0,configurable:!0},redirectingUser:{get:function(){return this.getRedirectingUser()},enumerable:!0,configurable:!0},forwarded:{get:function(){return this.isForwarded()},enumerable:!0,configurable:!0},disconnectCause:{get:function(){return x},set:function(a){x=a},enumerable:!0,configurable:!1}}),this.localMediaType={audio:!1,video:!1,desktop:!1},this.mediaType={audio:!1,video:!1,desktop:!1},this.direction=k.NONE,this.secureCall=!1,this.establishedTime=0,this.creationTime=Date.now(),this.peerUsers=null,this.peerUser=null,this.numConvParticipants=0,this.avatar=null,this.activeNotification=null,this.activeRTPStatsWarning=null,this.savedRTPStats=null,this.participants=[],this.participantsHashTable={},this.attendeeCount=0,this.remotelyMuted=!1,this.sessionMuted=!1,this.sessionLocked=!1,this.whiteboardEnabled=!1,this.recording={state:c.RecordingInfoState.INITIAL,notifyByCurtain:!1,notifyByUser:!1,duration:0,starter:{userId:""},reason:c.RecordingInfoReason.NONE,resumeTime:0,wasStarted:function(){return this.state!==c.RecordingInfoState.INITIAL},isActive:function(){return this.state===c.RecordingInfoState.STARTED||this.state===c.RecordingInfoState.START_PENDING},isPaused:function(){return this.state===c.RecordingInfoState.START_PENDING},isFailed:function(){return this.reason!==c.RecordingInfoReason.NONE&&(this.state===c.RecordingInfoState.INITIAL||this.state===c.RecordingInfoState.STOPPED)}},this.setState=function(a,b){if(a&&a!==w){if(w===l.Terminated)return void f.error("[BaseCall]: The call has already been terminated. Cannot set state to ",a.name);f.debug("[BaseCall]: Changing call state from "+w.name+" to "+a.name),!this.establishedTime&&a.established&&(this.establishedTime=Date.now()),w=a,w!==l.Terminated||b||this.terminate()}},this.checkState=function(a){return Array.isArray(a)?a.some(function(a){return a===w}):a===w},this.updateCall=function(a){return!!a&&(d(a),!0)},this.setPeerUser=function(a,b,c){(this.peerUser.hasTelephonyRole||!this.peerUser.userId||c&&c!==this.peerUser.userId||j.cleanPhoneNumber(a)!==j.cleanPhoneNumber(this.peerUser.phoneNumber))&&(this.peerUser={userId:c||"",firstName:null,lastName:null,displayName:b,phoneNumber:a},i&&i.extend&&(this.peerUser=i.extend(this.peerUser)),o=b||a,p=j.textToHtmlEscaped(o))},this.setTransactionId=function(a){r=a||j.createTransactionId()},this.setInstanceId=function(a){h=a},this.setCallIdForTelephony=function(a){e.isTelephonyCall&&a&&a!==g&&(f.debug("[BaseCall]: Changing callId from "+g+" to "+a),g=a)},d(a),a=null}var c=a.Constants,d=a.Enums.CstaCallState,e=a.DefaultAvatars,f=a.logger,g=a.Enums.ParticipantState,h=a.RtcParticipant,i=a.UserProfile,j=a.Utils,k=Object.freeze({INCOMING:"incoming",OUTGOING:"outgoing",NONE:""}),l=Object.freeze({Idle:{name:"Idle",ui:"",established:!1},Initiated:{name:"Initiated",ui:"res_Calling",established:!1,css:"outgoing"},Connecting:{name:"Connecting",ui:"",established:!1,css:"connecting"},Delivered:{name:"Delivered",ui:"res_Calling",established:!1,css:"outgoing"},Busy:{name:"Busy",ui:"res_BusyCall",established:!1,css:"busy"},Failed:{name:"Failed",ui:"res_FailedCall",established:!1,css:"failed"},Missed:{name:"Missed",ui:"res_MissedCall",established:!1,css:"missed"},Declined:{name:"Declined",ui:"res_CallDeclined",established:!1,css:"declined"},NotAnswered:{name:"NotAnswered",ui:"res_CallNotAnswered",established:!1,css:"not-answered"},Ringing:{name:"Ringing",ui:"res_IncomingCall",established:!1,css:"incoming"},Answering:{name:"Answering",ui:"res_IncomingCall",established:!1,css:"answering"},Active:{name:"Active",ui:"",established:!0,css:"active-call"},Held:{name:"Held",ui:"res_OnHold",established:!0,css:"active-call"},Holding:{name:"Holding",ui:"res_Holding",established:!0,css:"holding-call"},HoldOnHold:{name:"HoldOnHold",ui:"res_Holding",established:!0,css:"holding-call"},Waiting:{name:"Waiting",ui:"res_Waiting",established:!0,css:"waiting"},Started:{name:"Started",ui:"res_InProgress",established:!1,css:"started"},ActiveRemote:{name:"ActiveRemote",ui:"res_RemoteCall",established:!0,css:"active-call-remote"},Terminated:{name:"Terminated",ui:"res_Terminated",established:!1,css:"declined"}});return b.prototype.sameAs=function(a){return!!a&&this.callId===a.callId&&this.isRemote===a.isRemote},b.prototype.terminate=function(){f.debug("[BaseCall]: Terminating call with callId = ",this.callId),this.mediaType={audio:!1,video:!1,desktop:!1},this.setState(l.Terminated,!0)},b.prototype.isEstablished=function(){return this.state.established},b.prototype.isOutgoingState=function(){return this.state===l.Initiated||this.state===l.Connecting||this.state===l.Delivered||this.state===l.Busy},b.prototype.isPresent=function(){return this.state!==l.Idle&&this.state!==l.Terminated},b.prototype.isHeld=function(){return!1},b.prototype.hasRemoteMedia=function(){return!1},b.prototype.isCallingOut=function(){return this.state===l.Waiting&&this.participants.length>0&&this.participants.every(function(a){return a.pcState===g.Initiated})},b.prototype.hasVideo=function(){return!(!this.mediaType.video&&!this.mediaType.desktop);
},b.prototype.updateSecurityStatus=function(a){a!==!0&&a!==!1||(this.secureCall=a)},b.prototype.canToggleVideo=function(){return!this.isRemote&&this.checkState([l.Active,l.Waiting])},b.prototype.hasRemoteVideo=function(){return!1},b.prototype.hasLocalVideo=function(){return this.localMediaType.video||this.localMediaType.desktop},b.prototype.hasLocalScreenShare=function(){return this.localMediaType.desktop},b.prototype.hasRemoteScreenShare=function(){return this.mediaType.desktop&&!this.localMediaType.desktop},b.prototype.isMuted=function(){return!1},b.prototype.mute=function(){return f.warning("[BaseCall]: Mute is not implemented in base object"),!1},b.prototype.unmute=function(){return f.warning("[BaseCall]: Unmute is not implemented in base object"),!1},b.prototype.toggleMute=function(){return f.warning("[BaseCall]: toggleMute is not implemented in base object"),!1},b.prototype.outgoingFailed=function(){return!this.isRemote&&this.direction===k.OUTGOING&&this.checkState([l.Declined,l.Busy,l.NotAnswered,l.Failed])},b.prototype.setPeerUsersAsParticipants=function(){if(this.direction===k.OUTGOING&&this.peerUsers){this.participants=this.peerUsers.map(function(a){return h.createFromUser(a,g.Initiated)});for(var a=0;a<this.participants.length;a++)this.participantsHashTable[this.participants[a].userId]=this.participants[a];f.debug("[BaseCall]: Initialized participants: ",this.participants)}},b.prototype.hasParticipant=function(a){return this.participants.some(function(b){return b.userId===a})},b.prototype.getParticipant=function(a){for(var b=0;b<this.participants.length;b++)if(this.participants[b].userId===a)return this.participants[b];return null},b.prototype.addParticipant=function(a,b,c){return a&&a.userId?(f.debug("[BaseCall]: Add participant with userId =",a.userId),this.hasParticipant(a.userId)?c?this.updateParticipant(a,b):(f.warning("[BaseCall]: addParticipant called with existing participant. userId =",a.userId),null):(b&&(a.pcState=b),this.participants.push(a),this.participantsHashTable[a.userId]=a,f.debug("[BaseCall]: Added participant to call: ",a.userId),a)):(f.warning("[BaseCall]: addParticipant called with invalid participant"),null)},b.prototype.updateParticipant=function(a,b){if(!a||!a.userId)return f.warning("[BaseCall]: updateParticipant called with invalid participant"),null;f.debug("[BaseCall]: Update participant with userId =",a.userId);var c=this.getParticipant(a.userId);return c?(c.pcState=b||a.pcState,c.streamId=a.streamId,c.screenStreamId=a.screenStreamId,c.muted=a.muted,c.mediaType=a.mediaType,c.screenSharePointerSupported=a.screenSharePointerSupported,f.debug("[BaseCall]: Updated participant data for ",c.userId),c):(f.warning("[BaseCall]: The given participant is not part of the call"),null)},b.prototype.removeParticipant=function(a){delete this.participantsHashTable[a];for(var b=0;b<this.participants.length;b++)if(this.participants[b].userId===a){var c=this.participants.splice(b,1)[0];return c.videoUrl="",c.mediaType={audio:!1,video:!1,desktop:!1},f.debug("[BaseCall]: Removed participant from call: ",c.userId),c}return null},b.prototype.setParticipantState=function(a,b){b&&this.participants.some(function(c){if(c.userId===a)return c.pcState=b,f.debug("[BaseCall]: Set participant state to "+b.name+", userId =",c.userId),!0})},b.prototype.hasOtherParticipants=function(){return this.participants.length>0||this.attendeeCount>0},b.prototype.updateMediaType=function(){var a={audio:this.localMediaType.audio,video:this.localMediaType.video,desktop:this.localMediaType.desktop};this.participants.forEach(function(b){b.mediaType&&(b.mediaType.audio&&(a.audio=!0),b.mediaType.video&&(a.video=!0),b.mediaType.desktop&&(a.desktop=!0))}),f.debug("[BaseCall]: Updating call media type to ",a),this.mediaType=a},b.prototype.callTypeCss=function(){if(this.isDirect)return this.hasVideo()?"webrtc-video":"webrtc-audio";if(this.isRemote)return"remote";switch(this.state.css){case"outgoing":return"ongoing";case"incoming":return"incoming";case"answering":return"answering";case"active-call":return"active";default:return""}},b.prototype.callHeaderType=function(){return this.isDirect?"Direct":this.isGuestInvite?"Guest":this.isLarge?"Large":"Group"},b.prototype.toString=function(){return JSON.stringify(this,null,3)},b.prototype.getCstaState=function(){return this.atcCallInfo?this.atcCallInfo.cstaState:null},b.prototype.setCstaState=function(a){this.atcCallInfo&&(this.atcCallInfo.cstaState=a,this.avatar=this.isHolding()?e.TELEPHONY_HOLD:e.TELEPHONY,this.consultation=this.consultation&&!this.isHolding())},b.prototype.checkCstaState=function(a){if(!this.atcCallInfo)return!1;if(!Array.isArray(a))return a===this.atcCallInfo.cstaState;var b=this;return a.some(function(a){return a===b.atcCallInfo.cstaState})},b.prototype.isHolding=function(){return!!this.atcCallInfo&&this.checkCstaState([d.Holding,d.HoldOnHold,d.ConferenceHolding])},b.prototype.isHoldAllowed=function(){return!!this.atcCallInfo&&this.atcCallInfo.isHoldAllowed()},b.prototype.isConsultAllowed=function(){return!!this.atcCallInfo&&this.atcCallInfo.isConsultAllowed()},b.prototype.isConferenceCallAllowed=function(){return!!this.atcCallInfo&&this.atcCallInfo.isConferenceCallAllowed()},b.prototype.isRetrieveAllowed=function(){return!!this.atcCallInfo&&this.atcCallInfo.isRetrieveAllowed()},b.prototype.isTransferCallAllowed=function(){return!!this.atcCallInfo&&this.atcCallInfo.isTransferCallAllowed()},b.prototype.isTransferAllowed=function(){return!!this.atcCallInfo&&this.atcCallInfo.isTransferAllowed()},b.prototype.getPosition=function(){return this.atcCallInfo?this.atcCallInfo.getPosition():null},b.prototype.setAtcHandoverInProgress=function(){this.atcCallInfo&&this.atcCallInfo.setHandoverInProgress()},b.prototype.clearAtcHandoverInProgress=function(){this.atcCallInfo&&this.atcCallInfo.clearHandoverInProgress()},b.prototype.isHoldInProgress=function(){return!!this.atcCallInfo&&this.atcCallInfo.isHoldInProgress()},b.prototype.setHoldInProgress=function(){this.atcCallInfo&&this.atcCallInfo.setHoldInProgress()},b.prototype.clearHoldInProgress=function(){this.atcCallInfo&&this.atcCallInfo.clearHoldInProgress()},b.prototype.isRetrieveInProgress=function(){return!!this.atcCallInfo&&this.atcCallInfo.isRetrieveInProgress()},b.prototype.setRetrieveInProgress=function(){this.atcCallInfo&&this.atcCallInfo.setRetrieveInProgress()},b.prototype.clearRetrieveInProgress=function(){this.atcCallInfo&&this.atcCallInfo.clearRetrieveInProgress()},b.prototype.isDtmfAllowed=function(){return!1},b.prototype.getTransferCallFailedCause=function(){return this.atcCallInfo?this.atcCallInfo.getTransferCallFailedCause():null},b.prototype.isAtcConferenceCall=function(){return!!this.atcCallInfo&&this.atcCallInfo.isConferenceCall()},b.prototype.setRedirectingUser=function(a,b,c,d,e){this.atcCallInfo&&this.atcCallInfo.setRedirectingUser(a,b,c,d,e)},b.prototype.getRedirectingUser=function(){return this.atcCallInfo?this.atcCallInfo.getRedirectingUser():null},b.prototype.setRedirectionType=function(a){if(this.atcCallInfo)return this.atcCallInfo.setRedirectionType(a)},b.prototype.getRedirectionType=function(){return this.atcCallInfo?this.atcCallInfo.getRedirectionType():null},b.prototype.isForwarded=function(){return!!this.atcCallInfo&&this.atcCallInfo.isForwarded()},b.prototype.setDisconnectCause=function(a,b){this._disconnectCause||(this.disconnectCause={cause:a,reason:b})},a.BaseCall=b,a.Enums=a.Enums||{},a.Enums.CallDirection=k,a.Enums.CallState=l,a}(Circuit||{}),Circuit=function(a){"use strict";function b(a){var c=Circuit.logger;if(!a||!a.rtcSessionId)throw new Error("Cannot create RemoteCall object without a valid conversation");b.parent.constructor.call(this,a,!0),Object.defineProperties(this,{isPullAllowed:{get:function(){return!this.pullNotAllowed&&this.state===d.ActiveRemote},enumerable:!0,configurable:!1}}),this.activeClient=null,a=null,c.info("[RemoteCall]: Created new remote call with callID = ",this.callId)}var c=a.BaseCall,d=a.Enums.CallState,e=a.Proto,f=a.Utils;return f.inherit(b,c),b.prototype.setActiveClient=function(a){a&&(a.userId?(this.activeClient={clientId:a.clientId,clientDisplayName:a.clientDisplayName,mediaType:e.getMediaType(a.mediaTypes)},this.pullNotAllowed=a.pullCall===!1):this.activeClient=a)},a.RemoteCall=b,a}(Circuit||{}),Circuit=function(a){"use strict";var b=Object.freeze({Disconnected:"Disconnected",Unregistered:"Unregistered",Registering:"Registering",Registered:"Registered"});return a.Enums=a.Enums||{},a.Enums.AtcRegistrationState=b,a}(Circuit||{}),Circuit=function(a){"use strict";function b(c,e){function g(){s||(s=new q({callId:r.callId,isDirectCall:r.isDirect,isTelephonyCall:r.isTelephonyCall,isLargeConference:r.isLarge,isAtcPullCall:e.isAtcPullCall,reuseDesktopStreamFrom:e.reuseDesktopStreamFrom}),s.onMediaUpdate=l,s.onLocalVideoURL=m,s.onRemoteObjectURL=o,s.onScreenSharePointerStatus=n,r.isDirect||s.setExtraVideoChannelsForParticipants(r.numConvParticipants))}function k(){s&&(s.onMediaUpdate=null,s.onLocalVideoURL=null,s.onRemoteObjectURL=null,s.onScreenSharePointerStatus=null)}function l(){d.debug("[LocalCall]: RtcSessionController - onMediaUpdate: callId =",r.callId),r.activeMediaType=s.getActiveMediaType(),d.debug("[LocalCall]: Set active media type to ",r.activeMediaType),r.localMediaType=s.getMediaConstraints(),d.debug("[LocalCall]: Set local media type to ",r.localMediaType),r.updateMediaType(),r.updateCallState()}function m(a){d.debug("[LocalCall]: RtcSessionController - onLocalVideoURL: callId =",r.callId),r.localVideoUrl=a.url,d.debug("[LocalCall]: Set local video URL to",a.url||"<empty>")}function n(a){d.debug("[LocalCall]: RtcSessionController - onScreenSharePointerStatus",a),r.pointer={isSupported:a.isSupported,isEnabled:a.isEnabled}}function o(a){d.debug("[LocalCall]: RtcSessionController - onRemoteObjectURL: callId =",r.callId),r.remoteAudioUrl=a.audioUrl&&a.audioUrl.url||"",d.debug("[LocalCall]: Set remote audio URL to",r.remoteAudioUrl||"<empty>"),r.remoteVideoUrlStreams=a.videoUrl||[],d.debug("[LocalCall]: Set remote video URL streams to",a.videoUrl||"<empty>"),r.participants.forEach(function(a){r.setParticipantRemoteVideoURL(a)}),r.checkForActiveRemoteVideo()}function p(a){a&&a.curtainState&&(B&&(a.lastCurtainState=B.curtainState),B=a,B.curtainClosed=a.curtainState!==i.CurtainState.OPEN)}e=e||{};var q=a.RtcSessionController;if(!c||!c.rtcSessionId)throw new Error("Cannot create LocalCall object without a valid conversation");b.parent.constructor.call(this,c,!1);var r=this,s=null,t=!1,u=null,v=!1,w=!1,x=!1,y=!1,z=!1,A=!1,B=null,C=null,D=null,E=null,F=!1,G=!1,H=15e3,I=9;Object.defineProperties(this,{sessionCtrl:{get:function(){return s},enumerable:!0,configurable:!1},isVdi:{get:function(){return!!s.isRemoteController},enumerable:!0,configurable:!1},locallyMuted:{get:function(){return s.isMuted()},enumerable:!0,configurable:!1},remoteVideoDisabled:{get:function(){return w},enumerable:!0,configurable:!1},remoteAudioDisabled:{get:function(){return x},enumerable:!0,configurable:!1},isMocked:{get:function(){return z},enumerable:!0,configurable:!1},isMeetingPointInvited:{get:function(){return A},enumerable:!0,configurable:!1},ringAllAllowed:{get:function(){return!!(this.peerUsers&&this.peerUsers.length>0&&this.peerUsers.length<=I)},enumerable:!0,configurable:!1},ringAllMaxNumber:{get:function(){return I},enumerable:!0,configurable:!1},conversationFeedView:{get:function(){return G||this.state===f.Ringing},set:function(a){G=a},enumerable:!0,configurable:!1},curtain:{get:function(){return B||{}},set:function(a){p(a)},enumerable:!0,configurable:!1},playbackDevice:{get:function(){return C},enumerable:!0,configurable:!1},recordingDevice:{get:function(){return D},enumerable:!0,configurable:!1},videoDevice:{get:function(){return E},enumerable:!0,configurable:!1},atcAdvancing:{get:function(){return F},set:function(a){F=!!a},enumerable:!0,configurable:!1}}),this.localVideoUrl="",this.remoteAudioUrl="",this.remoteVideoUrlStreams=[],this.activeMediaType={audio:!1,video:!1,desktop:!1},this.ringingTimeout=H,this.pointer={isSupported:!1,isEnabled:!1},this.terminate=function(){t||(d.debug("[LocalCall]: Terminating call with callId =",this.callId),k(),s.terminate(),this.localVideoUrl="",this.remoteAudioUrl="",this.remoteVideoUrlStreams=[],b.prototype.terminate.call(this),this.stopRingingTimer(),t=!0)},this.setMockedCall=function(){d.debug("[LocalCall]: Setting call as mocked"),z=!0,s.setMockedCall();var a=0===s.getNumberOfExtraVideoChannels();if(a){var b;this.participants.forEach(function(a){a.streamId="",(a.mediaType.desktop||!b&&a.mediaType.video)&&(b=a)}),b&&(b.streamId="mock")}else this.participants.forEach(function(a){a.streamId=a.mediaType.video||a.mediaType.desktop?"mock":""});window.setTimeout(function(){this.state!==f.Terminated&&(d.debug("[LocalCall]: Initialize remote mocked streams"),o({audioUrl:"",videoUrl:[{streamId:"mock",url:"content/images/mock/trailer.mp4"}]}),s.onRemoteObjectURL=null)},100)},this.startRingingTimer=function(a){"function"==typeof a&&(d.info("[LocalCall]: Starting ringing timer for callId =",r.callId),u=window.setTimeout(function(){d.info("[LocalCall]: Ringing timeout for callId =",r.callId),u=null,a()},this.ringingTimeout))},this.stopRingingTimer=function(){u&&(d.info("[LocalCall]: Cancelling ringing timer for callId =",r.callId),window.clearTimeout(u),u=null)},this.hasRemoteVideo=function(){return v},this.checkForActiveRemoteVideo=function(){v=!w&&this.participants.some(function(a){return!!a.videoUrl}),d.debug("[LocalCall]: Set hasActiveRemoteVideo to ",v)},this.enableRemoteVideo=function(){w&&(w=!1,this.checkForActiveRemoteVideo(),this.sessionCtrl.enableRemoteVideo(),d.debug("[LocalCall]: Enabled remote video"))},this.disableRemoteVideo=function(){w||(w=!0,v=!1,this.participants.forEach(function(a){a.videoUrl="",r.isDirect&&(a.streamId="")}),this.sessionCtrl.disableRemoteVideo(),d.debug("[LocalCall]: Disabled remote video"))},this.enableRemoteAudio=function(){x&&(x=!1,d.debug("[LocalCall]: Enabled remote audio."))},this.disableRemoteAudio=function(){x||(x=!0,d.debug("[LocalCall]: Disabled remote audio."))},this.setMeetingPointInviteState=function(a){A=!!a,d.debug("[LocalCall]: Set Circuit Meeting Point state to ",a)},this.setHasUnmutedParticipants=function(){y=this.participants.some(function(a){return!a.muted})},this.hasUnmutedParticipants=function(){return y},this.getUnmutedParticipantIds=function(){var a=[];return this.participants.forEach(function(b){b.muted||a.push(b.userId)}),a},this.getMediaNode=function(){return this.isTestCall?q.mediaNode:null},this.updateMediaDevices=function(){j.getMediaSources(function(a,b,c){if(j.getMediaSourcesSupported){var e=h.selectMediaDevice(c,q.playbackDevices);C=e&&e.label,e=h.selectMediaDevice(a,q.recordingDevices),D=e&&e.label,e=h.selectMediaDevice(b,q.videoDevices),E=e&&e.label}else C=Audio.getPlaybackDevice&&Audio.getPlaybackDevice(),D=Audio.getRecordingDevice&&Audio.getRecordingDevice(),E=Audio.getVideoDevice&&Audio.getVideoDevice();d.debug("[LocalCall]: Updated media devices: recording="+D+" playback="+C+" video="+E+" callId="+r.callId)})},g(),c=null,r.updateMediaDevices(),d.info("[LocalCall]: Created new WebRTC call with callID = ",this.callId)}function c(a,b){if(!b.mediaType.video&&!b.mediaType.desktop)return void(b.streamId="");var c=0===a.sessionCtrl.getNumberOfExtraVideoChannels();if(c){var d;a.participants.some(function(a){if(a.streamId)return d=a,!0}),b.streamId=d&&d.userId!==b.userId?"":"mock"}else b.streamId="mock"}var d=a.logger,e=a.BaseCall,f=a.Enums.CallState,g=a.Enums.ParticipantState,h=a.Utils,i=a.Constants,j=a.WebRTCAdapter,k="SERVER_ENDED:",l=Object.freeze({SERVER_ENDED_PRFX:k}),m="CLIENT_ENDED:",n=Object.freeze({ANOTHER_CLIENT_ANSWERED:m+"ANOTHER_CLIENT_ANSWERED",ANOTHER_CLIENT_REJECTED:m+"ANOTHER_CLIENT_REJECTED",ANOTHER_CLIENT_PULLED_CALL:m+"ANOTHER_CLIENT_PULLED_CALL",CALL_MOVED_TO_ANOTHER_CONV:m+"CALL_MOVED_TO_ANOTHER_CONV",CALLER_LEFT_CONFERENCE:m+"CALLER_LEFT_CONFERENCE",CLIENT_ENDED_PRFX:m,ENDED_BY_ANOTHER_USER:m+"ENDED_BY_ANOTHER_USER",LOST_WEBSOCKET_CONNECTION:m+"LOST_WEBSOCKET_CONNECTION",NO_USERS_LEFT:m+"NO_USERS_LEFT",REQUEST_TO_SERVER_FAILED:m+"REQUEST_TO_SERVER_FAILED",RTC_SESSION_START_FAILED:m+"RTC_SESSION_START_FAILED",SET_REMOTE_SDP_FAILED:m+"SET_REMOTE_SDP_FAILED",USER_ENDED:m+"USER_ENDED",LOST_MEDIA_STREAM:m+"LOST_MEDIA_STREAM",USER_LOGGED_OUT:m+"USER_LOGGED_OUT",PAGE_UNLOADED:m+"PAGE_UNLOADED"});return h.inherit(b,e),b.prototype.hasRemoteMedia=function(){return!(!this.remoteAudioUrl&&!this.remoteVideoUrlStreams.length)},b.prototype.hasRemoteScreenShare=function(){return this.mediaType.desktop&&!this.remoteVideoDisabled&&(!this.localMediaType.desktop||this.isDirect&&this.participants[0].mediaType.desktop)},b.prototype.addParticipant=function(a){this.isMocked&&a&&a.mediaType&&c(this,a);var d=b.parent.addParticipant.apply(this,arguments);return d&&(this.setParticipantRemoteVideoURL(d),this.checkForActiveRemoteVideo(),this.setHasUnmutedParticipants()),d},b.prototype.updateParticipant=function(a){this.isMocked&&a&&a.mediaType&&c(this,a);var d=b.parent.updateParticipant.apply(this,arguments);return d&&(this.setParticipantRemoteVideoURL(d),this.checkForActiveRemoteVideo(),this.setHasUnmutedParticipants()),d},b.prototype.removeParticipant=function(){var a=b.parent.removeParticipant.apply(this,arguments);return a&&this.setHasUnmutedParticipants(),a},b.prototype.setParticipantRemoteVideoURL=function(a){if(a.videoUrl="",this.isDirect&&(a.streamId=""),!this.remoteVideoDisabled){if(a.mediaType&&!a.mediaType.video&&!a.mediaType.desktop)return void d.debug("[LocalCall]: The participant does not have video or screen-share. Do not set video URL. userId = ",a.userId);if(this.isDirect){if(this.remoteVideoUrlStreams&&this.remoteVideoUrlStreams.length){var b=this.remoteVideoUrlStreams[this.remoteVideoUrlStreams.length-1];a.streamId=b.streamId,a.videoUrl=b.url,a.pcState=a.muted?g.Muted:g.Active}}else{if(!a.streamId&&!a.screenStreamId)return void d.info("[LocalCall]: The participant does not have a video streamId. userId = ",a.userId);this.remoteVideoUrlStreams&&this.remoteVideoUrlStreams.length&&this.remoteVideoUrlStreams.some(function(b){if(b.streamId===a.streamId||b.streamId===a.screenStreamId)return a.videoUrl=b.url,a.pcState=a.muted?g.Muted:g.Active,d.debug("[LocalCall]: Set remote video URL for participant: ",a),!0})}a.videoUrl||d.debug("[LocalCall]: We still do not have a video URL for the participant. ",a)}},b.prototype.hasLocalScreenShare=function(){return this.sessionCtrl.hasScreenShare()},b.prototype.isMuted=function(){return this.remotelyMuted||this.locallyMuted},b.prototype.mute=function(a){return this.checkState(f.Terminated)?(d.error("[LocalCall]: Cannot mute a call that has already been terminated"),!1):(d.debug("[LocalCall]: Mute call with callId =",this.callId),this.sessionCtrl.mute(a))},b.prototype.unmute=function(a){return this.checkState(f.Terminated)?(d.error("[LocalCall]: Cannot mute a call that has already been terminated"),!1):(d.debug("[LocalCall]: Unmute call with callId =",this.callId),this.sessionCtrl.unmute(a))},b.prototype.isLocalMuteAllowed=function(){return this.sessionCtrl.isLocalMuteAllowed()},b.prototype.toggleMute=function(){return this.sessionCtrl.isMuted()?this.unmute():this.mute()},b.prototype.setActiveSpeakers=function(a){if(!a)return!1;a instanceof Array||(a=[a]);var b=!1;return this.participants.forEach(function(c){var d=a.indexOf(c.userId)!==-1;c.activeSpeaker!==d&&(c.activeSpeaker=d,b=!0)}),b},b.prototype.updateCallState=function(){if(this.state.established){var a;a=this.sessionCtrl.isHolding()?f.Holding:this.sessionCtrl.isHeld()?f.Held:this.sessionCtrl.isConnected()&&(this.isDirect||this.hasOtherParticipants())?f.Active:f.Waiting,this.setState(a)}},b.prototype.isDtmfAllowed=function(){return!!this.checkState([f.Active,f.Delivered])&&(!!this.sessionCtrl.canSendDTMFDigits()||!!this.checkState(f.Active)&&!!this.atcCallInfo)},a.LocalCall=b,a.Enums.CallServerTerminatedReason=l,a.Enums.CallClientTerminatedReason=n,a}(Circuit||{}),Circuit=function(a){"use strict";var b=a.AppMessagingHandlerSingleton,c=a.ChromeExtension,d=a.Constants,e=a.logger,f=a.Utils,g=a.TemasysAdapter,h=function(){var h=b?b.getInstance():null,i={getScreen:function(a,b){b&&b("NOT_SUPPORTED")},unregEvtHandlers:function(){},isScreensharingAvailable:function(){return!1},installExtension:function(){},injectExtensionSvc:function(){},injectTemasysSvc:function(){}};if(f.isMobile())return i;var j,k=f.getBrowserInfo();if(a.isElectron)i.getScreen=function(a,b,c){var f=require("electron").ipcRenderer;f.once("screenshare-chooser",function(f,g,h){"share"===g?(e.info("[ScreenSharingController]: Got screen share stream. Stream id: ",h.streamId),c(a,b,h.streamId,null,h.pointer)):"cancel"===g&&(e.info("[ScreenSharingController]: User canceled screen share"),b&&b(d.ReturnCode.CHOOSE_DESKTOP_MEDIA_CANCELLED))}),e.info("[ScreenSharingController]: Request screen in Electron"),f.send("screenshare-chooser","open")},i.isScreensharingAvailable=function(){return!0};else if(a.isVdiApp)i.getScreen=function(a,b,c){h.sendInternalMessage({method:"showwindow"}),window.setTimeout(function(){chrome.desktopCapture.chooseDesktopMedia(["screen"],null,function(d){h.sendInternalMessage({method:"minimizewindow"}),c(a,b,d)})},0)},i.isScreensharingAvailable=function(){return!0};else if(k.chrome||k.phantomjs){var l,m,n,o=function(a,b,f){var g=f.data;switch(f.suppressLog||e.info("[ScreenSharingController]: Received screenshare event from extension - ",g.type),g.type){case c.BgScreenShareMsgType.CHOOSE_DESKTOP_MEDIA_DONE:e.info("[ScreenSharingController]: CHOOSE_DESKTOP_MEDIA done. Stream Id:",g.streamId),q(m),j&&j(a,b,g.streamId);break;case c.BgScreenShareMsgType.CHOOSE_DESKTOP_MEDIA_CANCELLED:e.info("[ScreenSharingController]: CHOOSE_DESKTOP_MEDIA cancelled"),q(m),b(d.ReturnCode.CHOOSE_DESKTOP_MEDIA_CANCELLED)}},p=function(a,b){if(l)return q(m),m=o.bind(null,a,b),l.addEventListener(c.BgTarget.SCREEN_SHARE,m),m},q=function(a){a&&a===m&&l&&m&&(l.removeEventListener(c.BgTarget.SCREEN_SHARE,m),m=null)};i.getScreen=function(a,b,c){var d=null;return n&&n.isExtensionRunning()?(j=c,d=p(a,b),l.getScreenShareUserMedia(function(a){a&&(e.warn("[ScreenSharingController]: Error starting screen share using chrome extension: ",a),q(d),b("res_AccessToExtensionFailed"))})):b("res_AccessToExtensionFailed"),d},i.isScreensharingAvailable=function(){return!!n&&n.isExtensionRunning()},i.installExtension=function(){n&&(e.debug("[ScreenSharingController]: Install Chrome extension"),n.installExtension(!0).then(function(){e.info("[ScreenSharingController]: Chrome extension was successfully installed")}).catch(function(a){e.warn("[ScreenSharingController]: Failed to install Chrome extension. ",a)}))},i.injectExtensionSvc=function(a,b){n=a,l=b},i.unregEvtHandlers=q}else if(k.msie){var r;i.getScreen=function(a,b,c){g&&g.isScreensharingAvailable()?c(a,b):b("NOT_AVAILABLE")},i.isScreensharingAvailable=function(){return!!g&&g.isScreensharingAvailable()},i.installExtension=function(){r&&r.showPopup()},i.injectTemasysSvc=function(a){r=a}}else if(k.firefox){var s=33;i.getScreen=function(a,b,c,d){c(a,b,null,d)},i.isScreensharingAvailable=function(){return parseInt(k.version,10)>=s}}return i}();return a.ScreenSharingController=h,a}(Circuit||{}),Circuit=function(a){"use strict";function b(n){function q(a,b){var c=b&&!fb?kb:jb,d=c?c.getLocalStreams():[];d.indexOf(a)>=0&&(f.warning("[RtcSessionController]: Local "+(b?"Desktop":"Audio/Video")+" Media Stream has ended unexpectedly"),V(b))}function r(a,b,c){if(c&&c.mediaStream){var d=c.mediaStream;d.oninactive=q.bind(null,d,!0),oa(d,ab),a()}else Zb=g.getScreen(a,b,u,c)}function s(a,b,c){f.debug("[RtcSessionController]: Get User Media for ",Hb),Hb.audio||Hb.video?t(function(){Hb.desktop&&!i.isMobile()&&"dotnet"!==window.navigator.platform?ib[ab]?(c=c||{},c.mediaStream=ib[ab],r(a,b,c)):ob&&Ib.desktop&&!qb?(oa(sb[ab],ab),a()):(r(a,b,c),qb=!1):(oa(null,ab),a())},b):Hb.desktop?(oa(null,ab),r(a,b,c)):window.setTimeout(a,0)}function t(a,c){var d=function(){var a=!pb||"msie"===j.browser||"firefox"===j.browser&&!Hb.desktop&&Ib.desktop;return ob&&a&&"android"!==j.browser&&Hb.audio===Ib.audio&&Hb.video===Ib.video&&Hb.hdVideo===Ib.hdVideo};f.debug("[RtcSessionController]: getUserMediaAudioVideo()");var e=null;try{var g={audio:!1,video:!1};j.getMediaSources(function(h,k,l){if(Hb.audio){var m=i.selectMediaDevice(h,b.recordingDevices),n=i.selectMediaDevice(l,b.playbackDevices);g.audio=j.getAudioOptions({enableAudioAGC:b.enableAudioAGC,sourceId:m&&m.id,playbackDeviceId:n&&n.id})}if(Hb.video){var o=i.selectMediaDevice(k,b.videoDevices);g.video=j.getVideoOptions({sourceId:o&&o.id,hdVideo:Hb.hdVideo})}else Hb.desktop&&i.isMobile()&&(g.video=j.getDesktopOptions());f.info("[RtcSessionController]: Calling getUserMedia - constraints = ",g),d()?(oa(sb[_a],_a),a()):(e=window.setTimeout(function(){e=null,f.warning("[RtcSessionController]: Failed to access local media: device unresponsive"),c("res_MediaInputDevicesUnresponsive")},Wa),ob&&Hb.video&&Ib.video&&Hb.hdVideo!==Ib.hdVideo&&j.stopLocalVideoTrack(sb[_a]),j.getUserMedia(g,function(b){if(f.info("[RtcSessionController]: User has granted access to local media"),f.debug("[RtcSessionController]: Local MediaStream: ",b.id),!e)return f.info("[RtcSessionController]: GUM time out already fired"),void la(b);if(window.clearTimeout(e),e=null,Yb)return f.info("[RtcSessionController]: Session already terminated. Stop audio/video MediaStream: ",b.id),void la(b);if(b.oninactive=q.bind(null,b,!1),Hb.video&&!b.getVideoTracks().length){if(ob&&!Ib.video)return void c("res_CameraAccessRestricted");Hb.video=!1,f.info("[RtcSessionController]: Failed to get access to video stream. Fallback to audio-only."),R("res_AddVideoFailed"),f.info("[RtcSessionController]: New getUserMedia - constraints = ",Hb)}oa(b,_a),a()},function(a){var b=a&&a.name||"Unspecified";f.warning("[RtcSessionController]: Failed to access local media: ",b),e&&(window.clearTimeout(e),e=null);var d;d=b.indexOf("PermissionDeniedError")!==-1?Hb.video?"res_AccessToMediaInputDevicesFailedPermissionDenied":"res_AccessToAudioInputDeviceFailedPermissionDenied":Hb.video?"res_AccessToMediaInputDevicesFailed":"res_AccessToAudioInputDeviceFailed",c(d)}),f.debug("[RtcSessionController]: Requested access to Local Media"))})}catch(a){f.error("[RtcSessionController]: Exception while handling getUserMedia: ",a),e&&(window.clearTimeout(e),e=null),c(Hb.video?"res_AccessToMediaInputDevicesFailed":"res_AccessToAudioInputDeviceFailed")}}function u(a,c,e,g,h){f.debug("[RtcSessionController]: getUserMediaDesktop()");try{var k={audio:!1},l={mediaSource:g,frameRate:{min:b.sdpParameters.screenShare.minFrameRate,max:b.sdpParameters.screenShare.maxFrameRate}};k.video=j.getDesktopOptions(e,l),f.info("[RtcSessionController]: Calling getUserMedia - constraints = ",k),j.getUserMedia(k,function(b){return f.info("[RtcSessionController]: User has granted access for screen capture. Stream Id:",b.id),Yb?(f.info("[RtcSessionController]: Session already terminated. Stop desktop MediaStream: ",b.id),void la(b)):(W(h),b.oninactive=q.bind(null,b,!0),oa(b,ab),void a())},function(a){var b=a&&a.name||"Unspecified";f.warning("[RtcSessionController]: Failed to access local media: ",b);var e=i.getBrowserInfo();c(e.msie&&"PermissionDeniedError"===b||e.firefox&&("SecurityError"===b||"NotAllowedError"===b)?d.ReturnCode.CHOOSE_DESKTOP_MEDIA_CANCELLED:"res_AccessToDesktopFailed")}),f.debug("[RtcSessionController]: Requested access for screen capture")}catch(a){f.error("[RtcSessionController]: Exception while handling getUserMedia: ",a),c("res_AccessToDesktopFailed")}}function v(){if(jb)return!0;var c={rtcpMuxPolicy:b.sdpParameters.rtcpMuxPolicy};mb.length&&!Ub?("firefox"===j.browser&&(mb=mb.filter(function(a){return!/turns:\d{1,3}(\.\d{1,3}){3}/.test(a)})),c.iceServers=[{urls:mb,credential:nb.password,username:nb.username}],b.allowOnlyRelayCandidates&&(c.iceTransportPolicy="relay")):c.iceServers=[],Ub=!1,f.debug("[RtcSessionController]: Creating RtcPeerConnections. config: ",c);var d={optional:[{DtlsSrtpKeyAgreement:!0},{googImprovedWifiBwe:!0},{googHighBitrate:!0},{googVeryHighBitrate:!0},{googIPv6:!1},{googDscp:!0}]};f.debug("[RtcSessionController]: Creating peer connections. constraints:",d);var e={extraVideoChannels:Rb?0:hb};f.debug("[RtcSessionController]: Creating peer connections. options:",e);try{Sb=[],jb=new a.RtcPeerConnections(c,d,e),jb.startTime=Date.now(),f.debug("[RtcSessionController]: Created audio/video peer connections"),b.disableDesktopPc||i.isMobile()||"dotnet"===window.navigator.platform||fb||(c.iceCandidatePoolSize=1,kb=new j.PeerConnection(c,d),f.debug("[RtcSessionController]: Created screenshare peer connection"))}catch(a){return jb=null,kb=null,f.error("[RtcSessionController]: Failed to create peer connections.",a),!1}return w(jb),w(kb),!0}function w(a){a&&(a.onicecandidate=y.bind(null,a),a.oniceconnectionstatechange=z.bind(null,a),a.onaddstream=A.bind(null,a),a.onremovestream=B.bind(null,a))}function x(a){a&&(a.onicecandidate=null,a.oniceconnectionstatechange=null,a.onaddstream=null,a.onremovestream=null)}function y(a,b){if(a!==jb&&a!==kb)return void Z("Received icecandidate event for old PC");var c;if(b.candidate){if(Y("New ICE candidate: ",b.candidate),aa()){if(c=a.localDescription,!aa(c.type))return;var d={candidate:b.candidate.candidate,sdpMid:b.candidate.sdpMid,sdpMLineIndex:b.candidate.sdpMLineIndex};ga(d)&&(zb!==k.None&&zb!==k.OfferPending&&zb!==k.AnswerPending?fa(d):Y("Ignore ICE candidate in state ",zb))}}else if(Y("End of candidates. Audio/video PC:",a===jb),a.endOfCandidates=!0,da()){if(c=a.localDescription,!c)return void $("End of candidates, but cannot access pc.localDescription");aa(c.type)&&zb!==k.None&&zb!==k.OfferPending&&zb!==k.AnswerPending?F():G(c)}Lb&&aa()&&(zb===k.OfferPending||zb===k.AnswerPending)&&(c=a.localDescription,G(c))}function z(a){if(a!==jb&&a!==kb)return void Z("Received iceconnectionstatechange event for old PC");var b=a===jb?"audio/video":"desktop";if(Y("Connection state change ("+b+"): ",a.iceConnectionState),zb===k.Connected)switch(a.iceConnectionState){case"failed":Aa(k.Disconnected),Xb||(Y("RtcSessionController - Media disconnected: Waiting for signaling events"),Xb=window.setTimeout(function(){ya("res_CallMediaDisconnected")},o))}else if(zb===k.AnswerReceived||zb===k.PrAnswerReceived||zb===k.AnswerApplied||zb===k.AnswerSent)switch(a.iceConnectionState){case"connected":case"completed":a.connected=!0,ca()&&(Mb&&(window.clearTimeout(Mb),Mb=null),Aa(k.Connected));break;case"failed":Mb&&(window.clearTimeout(Mb),Mb=null),ya("res_CallMediaFailed")}}function A(a,b){return Y("Added Remote Stream"),ob?void Y("Renegotiation is in progress. Ignore AddStream event."):(ra([b.stream]),void L())}function B(a,b){Z("Removed Remote Stream"),sa(b.stream),L()}function C(a,b){Y("RTCDTMFSender - ontonechange: tone =",b.tone),M(b.tone)}function D(a,b){if("function"==typeof a)try{a(b||{})}catch(a){f.error(a)}}function E(a){if(a){var b=ea();f.debug("[RtcSessionController]: Send IceCandidate event"),D(db.onIceCandidate,{origin:b,candidates:a}),ha()}}function F(){var a=jb||kb,b=[];a.pendingCandidates&&(f.info("[RtcSessionController]: Send all pending candidates."),b=a.pendingCandidates,delete a.pendingCandidates),a.collectCandidatesTimeout&&(window.clearTimeout(a.collectCandidatesTimeout),delete a.collectCandidatesTimeout),a.queuedCandidates&&(f.info("[RtcSessionController]: There was no relay candidate for TURN over TCP/TLS. Send all queued candidates."),Array.prototype.push.apply(b,a.queuedCandidates),delete a.queuedCandidates),a.relayRtpCandidateTimeout&&(window.clearTimeout(a.relayRtpCandidateTimeout),delete a.relayRtpCandidateTimeout),b.push({candidate:"a=end-of-candidates\r\n"}),E(b)}function G(a){Lb&&(window.clearTimeout(Lb),Lb=null),"offer"===a.type?zb===k.OfferPending&&H(k.OfferSent):zb===k.AnswerPending&&H(k.AnswerSent);
}function H(a){var b=Sa();"iOS"===window.navigator.platform&&b&&(f.debug("[RtcSessionController]: For iOS we need to convert the SDP to an actual JSON object"),b={type:b.type,parsedSdp:b.parsedSdp});var c=aa(b.type),d=b.parsedSdp;if(d=h.removeAudioLevelAttr(d),d=h.fixTrickleIceOption(d,c),c?da()&&(d=h.addEndOfCandidatesLine(d)):d=h.removeEndOfCandidatesLine(d),d=h.removeEmptyAttributeLines(d,["ice-ufrag","ice-pwd","ice-options"]),d=h.removeNotNeededSsrc(d),0!==h.iceTotalCandidatesCount(d)||$b)if(h.validateIceCandidates(d)||c&&!da()||$b){var e={type:b.type,sdp:h.stringify(d)};kb&&(e.screen=bb,jb&&ib[_a]&&(e.video=Ra(_a))),f.debug("[RtcSessionController]: send SessionDescription event"),$b=!1,D(db.onSessionDescription,{sdp:e}),Aa(a)}else f.error("[RtcSessionController]: Failure: SDP contains at least one m line without IceCandidates"),ya();else if(c){var g=Da();f.debug("[RtcSessionController]: No ICE candidates collected yet. Waiting "+g+" more milliseconds."),Lb=window.setTimeout(ya.bind(null,"res_RestartBrowser"),g)}else ya("res_RestartBrowser")}function I(){f.debug("[RtcSessionController]: send SdpConnected event"),D(db.onSdpConnected,{})}function J(){f.debug("[RtcSessionController]: send RemoteVideoAdded event"),D(db.onRemoteVideoAdded,{})}function K(){f.debug("[RtcSessionController]: send RemoteVideoRemoved event"),D(db.onRemoteVideoRemoved,{})}function L(){f.debug("[RtcSessionController]: send RemoteStreamUpdated event"),D(db.onRemoteStreamUpdated,{})}function M(a){f.debug("[RtcSessionController]: send DTMFToneChanged event"),D(db.onDTMFToneChange,{tone:a})}function N(){f.debug("[RtcSessionController]: send Closed event"),D(db.onClosed,{})}function O(a){f.debug("[RtcSessionController]: send Error event"),D(db.onRtcError,{error:a})}function P(a){"function"==typeof db.onRtcError&&window.setTimeout(function(){O(a)},0)}function Q(a){f.debug("[RtcSessionController]: send Warning event"),D(db.onRtcWarning,{warning:a})}function R(a){"function"==typeof db.onRtcWarning&&window.setTimeout(function(){Q(a)},0)}function S(){f.debug("[RtcSessionController]: send MediaUpdate event"),D(db.onMediaUpdate,{})}function T(){f.debug("[RtcSessionController]: send LocalVideoURL event"),D(db.onLocalVideoURL,{url:wb||vb}),S()}function U(){f.debug("[RtcSessionController]: send RemoteObjectURL event"),D(db.onRemoteObjectURL,{audioUrl:yb,videoUrl:xb})}function V(a){f.debug("[RtcSessionController]: send LocalStreamEnded event"),D(db.onLocalStreamEnded,{isDesktop:a})}function W(a){f.debug("[RtcSessionController]: send ScreenSharePointerStatus event"),D(db.onScreenSharePointerStatus,{isSupported:!(!a||!a.isSupported),isEnabled:!(!a||!a.isEnabled)})}function X(a){f.debug("[RtcSessionController]: send QosAvailable event"),D(db.onQosAvailable,{qos:a})}function Y(a,b){f.debug("[RtcSessionController]["+eb+"]: "+a,b)}function Z(a,b){f.warning("[RtcSessionController]["+eb+"]: "+a,b)}function $(a,b){f.error("[RtcSessionController]["+eb+"]: "+a,b)}function _(a){return a?{audio:!!a.audio,video:!!a.video,hdVideo:!!a.hdVideo,desktop:!!a.desktop}:{audio:!0,video:!1,hdVideo:!1,desktop:!1}}function aa(a){return a?"offer"===a&&Jb||"answer"===a&&Kb:Jb||Kb}function ba(a,b){if(!fb)return!0;var c=b&&h.isTrickleIceOption(b);return c&&f.debug("[RtcSessionController]: SDP "+a+" indicates support for Trickle-ICE."),!!c}function ca(){return(!jb||jb.connected)&&(!kb||kb.connected)}function da(){return(!jb||jb.endOfCandidates)&&(!kb||kb.endOfCandidates)}function ea(){var a=jb||kb;return a?(a.sdpOrigin||(a.sdpOrigin=h.getOrigin(a.localDescription.sdp)),a.sdpOrigin):""}function fa(a){var b=jb||kb,c=new e;c.parse(a.candidate),"udp"===c.transport&&(b.pendingCandidates||(b.pendingCandidates=[],f.debug("[RtcSessionController]: Start timer to collect candidates before send."),b.collectCandidatesTimeout=window.setTimeout(function(){f.debug("[RtcSessionController]: Timer expired. Send all pending candidates."),delete b.collectCandidatesTimeout,b.pendingCandidates&&(E(b.pendingCandidates),delete b.pendingCandidates)},m)),b.pendingCandidates.push(a))}function ga(a){var c=jb||kb;if(b.allowAllIceCandidatesScreenShare||a.sdpMid!==bb||c.hasRelayRtpCandidate||c.sendAllCandidates)return!0;var d=new e;return d.parse(a.candidate),d.isTcpTlsRelay()?(d.isRtp()&&(f.info("[RtcSessionController]: Found local relay candidate for TURN over TCP/TLS. Remove queued candidates."),c.hasRelayRtpCandidate=!0,delete c.queuedCandidates,c.relayRtpCandidateTimeout&&(window.clearTimeout(c.relayRtpCandidateTimeout),delete c.relayRtpCandidateTimeout)),!0):("udp"===d.transport&&(c.queuedCandidates||(c.queuedCandidates=[],f.debug("[RtcSessionController]: Start timer to wait for relay candidate for TURN over TCP/TLS."),c.relayRtpCandidateTimeout=window.setTimeout(function(){f.info("[RtcSessionController]: Timer expired. Stop waiting for relay candidate for TURN over TCP/TLS and send all pending candidates."),delete c.relayRtpCandidateTimeout,c.queuedCandidates&&(E(c.queuedCandidates),delete c.queuedCandidates),c.sendAllCandidates=!0},p)),c.queuedCandidates.push(a),f.debug("[RtcSessionController]: Queue candidate in case there is no TURN over TCP/TLS relay candidate")),!1)}function ha(){if(Mb&&(window.clearTimeout(Mb),Mb=null),ca())return void Aa(k.Connected);var a=Qb?Ya:Xa;Mb=window.setTimeout(function(){Mb=null,zb!==k.AnswerSent&&zb!==k.AnswerReceived&&zb!==k.AnswerApplied||ca()||(Qb?Aa(k.Connected):(f.warning("[RtcSessionController]: Timed out waiting for connected state."),ya("res_CallMediaFailed")))},a)}function ia(a){a&&(x(a),j.closePc(a))}function ja(){f.debug("[RtcSessionController]: Add local streams to existing peer connection");try{var a=jb?jb.getLocalStreams():[];a.isEmpty()&&(ib[_a]&&jb.addStream(ib[_a]),f.debug("[RtcSessionController]: Added local audio/video stream"),!kb&&ib[ab]&&(jb.addStream(ib[ab]),f.debug("[RtcSessionController]: Added local screenshare stream"))),kb&&(a=kb.getLocalStreams(),a.isEmpty()&&ib[ab]&&(kb.addStream(ib[ab]),f.debug("[RtcSessionController]: Added local screenshare stream")))}catch(a){return f.error("[RtcSessionController]: Failed to add Local Streams ",a),!1}return!0}function ka(){f.debug("[RtcSessionController]: Remove local streams from existing PeerConnections");try{var a=[jb,kb];a.forEach(function(a){a&&a.getLocalStreams().forEach(function(b,c){b&&(a.removeStream(b),f.debug("[RtcSessionController]: Removed PeerConnection Stream  #",c))})})}catch(a){return f.error("[RtcSessionController]: Failed to remove Local Streams ",a),!1}return!0}function la(a){a&&(a.oninactive=null,j.stopMediaStream(a))}function ma(a){var b=a===sb?ib:sb;a&&a.forEach(function(a){b&&b.indexOf(a)!==-1||la(a)})}function na(a){var b=["",""];a&&a.forEach(function(a,c){a&&a.getVideoTracks().length>0&&(b[c]=j.createObjectURL(a))}),vb===b[0]&&wb===b[1]||(vb=b[0],f.debug("[RtcSessionController]: Set local video URL to ",vb||"<empty>"),wb=b[1],f.debug("[RtcSessionController]: Set local desktop URL to ",wb||"<empty>"),T())}function oa(a,b){return b!==_a&&b!==ab?void f.error("[RtcSessionController]: setLocalStream invoked with invalid index:",b):void(ib[b]!==a&&(ib[b]&&la(ib[b]),ib[b]=a,na(ib)))}function pa(){(yb||xb.length)&&(yb=null,xb=[],U())}function qa(a){var b=!1;if(!a)return!1;if(a.getVideoTracks().length>0){var c=j.createObjectURL(a,void 0,!0),d=j.getVideoStreamTrackId(a),e=xb.some(function(a){if(a.streamId===d)return a.url!==c&&(a.url=c,b=!0),!0});e||(xb.push({url:c,streamId:d}),b=!0),b&&f.debug("[RtcSessionController]: Updated Remote Video URLs:",xb)}if(a.getAudioTracks().length>0){var g=j.createObjectURL(a),h=j.getAudioStreamTrackId(a);yb&&yb.streamId===h?yb!==g&&(yb.url=g,b=!0):(yb={url:g,streamId:h},b=!0),b&&f.debug("[RtcSessionController]: Updated Remote Audio URL:",yb)}return b}function ra(a,b){if(a){a instanceof Array||(a=[a]);var c=!1;b&&(yb||xb.length)&&(c=!0,yb=null,xb=[]),a.forEach(function(a){Sb.push(a),qa(a)&&(c=!0)}),c&&U()}}function sa(a){if(a){var b=!1,c=j.getVideoStreamTrackId(a);c&&xb.some(function(a,d){if(a.streamId===c)return xb.splice(d,1),b=!0,!0});var d=j.getAudioStreamTrackId(a);yb&&yb.streamId===d&&(yb=null,b=!0),b&&U()}}function ta(a){var b=!1;ib[_a]&&(b=j.toggleAudio(ib[_a],a)),Gb=!b||!a,sb&&sb[_a]&&j.toggleAudio(sb[_a],a)}function ua(a,b){ob&&(f.debug("[RtcSessionController]: There's a renegotiation in progress, fail or succeed it based on current SdpStatus:",zb),zb===k.AnswerReceived||zb===k.AnswerApplied||zb===k.AnswerSent?wa():xa()),ob=!0,pb=!!a,rb=b||null,tb=jb,ub=kb,x(tb),x(ub),jb=null,kb=null,sb=ib,ib=[null,null],Ib=i.shallowCopy(Hb),Bb=i.shallowCopy(Ab),zb=k.None,Vb=null,Wb=null}function va(a){if(rb){try{rb(a)}catch(a){f.error(a)}rb=null}}function wa(){f.info("[RtcSessionController]: The media renegotiation was successful"),f.info("[RtcSessionController]: Closing the old RTCPeerConnection"),Ua(tb,ub),ia(tb),ia(ub),tb=null,ub=null,f.info("[RtcSessionController]: Stopping the old MediaStream"),Eb?Db=!0:Fb&&(Db=!1),Db||Cb||ja(),ma(sb),sb=null,Ib=null,Bb=null,f.debug("[RtcSessionController]: Local main PC Streams after Renegotiation: ",jb.getLocalStreams()),f.debug("[RtcSessionController]: Remote main PC Streams after Renegotiation: ",jb.getRemoteStreams()),kb&&(f.debug("[RtcSessionController]: Local screenshare PC Streams after Renegotiation: ",kb.getLocalStreams()),f.debug("[RtcSessionController]: Remote screenshare PC Streams after Renegotiation: ",kb.getRemoteStreams())),na(ib);var a=jb.getRemoteStreams();kb&&(a=a.concat(kb.getRemoteStreams())),ra(a,!0),ta(!Gb),Eb=!1,Fb=!1,ob=!1,Nb=null,S(),va()}function xa(a){f.info("[RtcSessionController]: The media renegotiation has failed: ",a),ia(jb),ia(kb),zb=k.Connected,jb=tb,kb=ub,w(tb),w(ub),tb=null,ub=null,ma(ib),ib=sb,sb=null,na(ib),Hb=i.shallowCopy(Ib),Ab=i.shallowCopy(Bb),Ib=null,Bb=null,Eb?Db=!1:Fb&&(Db=!0),Eb=!1,Fb=!1,ob=!1,S(),va(a)}function ya(a,b){return ob?void xa(a):(a===d.ReturnCode.CHOOSE_DESKTOP_MEDIA_CANCELLED?f.info("[RtcSessionController]: User cancelled the screen share request"):"res_RestartBrowser"===a?f.error("[RtcSessionController]: Failure: No ICE candidates collected. Browser needs to be restarted"):(a=a||"res_RTCError",f.warning("[RtcSessionController]: There was an internal failure. Send error event: ",a)),void(b?b(a):O(a)))}function za(){Wb?(f.info("[RtcSessionController]: Process the pending changeMedia"),Ka(Wb.mediaType,Wb.cb,Wb.screenConstraint),Wb=null):Vb&&(f.info("[RtcSessionController]: Process the pending remote description"),db.setRemoteDescription(Vb),Vb=null)}function Aa(a){if(zb===k.PrAnswerReceived&&a===k.Connected)return void f.debug("[RtcSessionController]: Cannot change SDP status to "+a+" without final SDP answer.");if(zb!==a&&(f.debug("[RtcSessionController]: Changed SDP status from "+zb+" to "+a),zb=a,jb))switch(a){case k.AnswerApplied:za();break;case k.Connected:ob&&wa(),I(),za();break;case k.AnswerSent:ha()}}function Ba(a,c){f.debug("[RtcSessionController]: updateLocalDescription with mediaConstraints=",Hb);var d=!1,e=h.parse(c.sdp);h.disableMultiplex(e),gb&&h.removeAudioMediaProtocols(e,["UDP","TLS"]),Db?(h.setConnectionMode(e,"both","inactive"),f.info("[RtcSessionController]: updateLocalDescription with Connection Mode Inactive")):Hb.video||Hb.desktop?d=h.hasVideo(e):"answer"===c.type&&(d=h.hasVideo(e),d&&Rb&&(h.removeVideo(e),d=!1)),a===kb?(h.setMediaIdAttribute(e,0,bb,!0),h.setXGoogle(e,b.xGoogle.screenShare)):d&&h.setXGoogle(e,Hb.desktop&&!kb?b.xGoogle.screenShare:b.xGoogle.video),"answer"!==c.type&&(Ab={audio:!0,video:d});var g=new j.SessionDescription({type:c.type,sdp:h.stringify(e)});return f.debug("[RtcSessionController]: Modified local SDP: ",g),g}function Ca(a,c,d){f.debug("[RtcSessionController]: updateRemoteDescription with mediaConstraints=",Hb);var e=!1,g=h.hasVideo(c);if(g){var i=h.getVideoConnectionModes(c);f.info("[RtcSessionController]: Remote description has video modes set to ",i),e=i.every(function(a){return"recvonly"===a}),g=!e;var j=b.sdpParameters.video.maxBw,l=b.xGoogle.video;a===jb?Hb.desktop&&!kb&&(j=b.sdpParameters.screenShare.maxBw,l=b.xGoogle.screenShare):(j=b.sdpParameters.screenShare.maxBw,l=b.xGoogle.screenShare),c=h.setVideoBandwidth(c,j,!0),h.setXGoogle(c,l),fb&&"offer"===d&&e&&!Hb.video&&!Hb.desktop&&(c=h.removeVideo(c))}var m=Cb;return Cb=!!h.isHold(c)&&("offer"===d||!Db&&Hb.audio),m!==Cb&&(Cb?f.info("[RtcSessionController]: The client has been held"):f.info("[RtcSessionController]: The client has been retrieved")),"offer"!==d||zb!==k.Connected||Db||Cb||(xb.length&&!g?K():!xb.length&&g&&J()),Db||"answer"===d&&e||(Ab={audio:!0,video:g}),c}function Da(){var a=b.candidatesTimeout||l;return hb>0&&(a+=a*(j.iceTimeoutSafetyFactor||0)),a}function Ea(a){if(a&&fb)return Da();var c=b.trickleIceTimeout||m;return c}function Fa(a,b){f.debug("[RtcSessionController]: Successfully created local audio/video description:",a),b&&f.debug("[RtcSessionController]: Successfully created local screenshare description:",b),ob&&ka(),Lb&&(window.clearTimeout(Lb),Lb=null);var c,d=a&&a.type||b&&b.type,e=2,g=!1,h=function(a,b){if(e--,b?(f.error("[RtcSessionController]: Failed to apply Local "+a+" description:",b.message||b),g||(g=!0,ya())):f.debug("[RtcSessionController]: Local description was successfully applied. PC=",a),!g&&e<=0){if($b)return H(k.Connected),jb&&(jb.connectionBypassed=!0,x(jb)),void(kb&&(kb.connectionBypassed=!0,x(kb)));ob||S(),"offer"===d?(Aa(k.OfferPending),Jb&&(c=Ea(!0),c>0?(f.debug("[RtcSessionController]: Trickle ICE is enabled. Start a short timer before sending SDP Offer."),window.setTimeout(function(){zb===k.OfferPending&&(f.debug("[RtcSessionController]: Trickle ICE timer expired. Send SDP Offer."),H(k.OfferSent))},c)):(f.debug("[RtcSessionController]: Trickle ICE is enabled. Send the SDP Offer."),H(k.OfferSent)))):(Aa(k.AnswerPending),Kb&&(c=Ea(!1),c>0?(f.debug("[RtcSessionController]: Trickle ICE is enabled. Start a short timer before sending SDP Answer."),window.setTimeout(function(){zb===k.AnswerPending&&(f.debug("[RtcSessionController]: Trickle ICE timer expired. Send SDP Answer."),H(k.AnswerSent))},c)):(f.debug("[RtcSessionController]: Trickle ICE is enabled. Send the SDP Answer."),H(k.AnswerSent)))),(zb===k.OfferPending&&!Jb||zb===k.AnswerPending&&!Kb)&&(c=Da(),Lb=window.setTimeout(function(){return Lb=null,f.warning("[RtcSessionController]: Timed out waiting for candidates. Send session description."),jb?void("offer"===d?zb===k.OfferPending&&H(k.OfferSent):zb===k.AnswerPending&&H(k.AnswerSent)):void f.warning("[RtcSessionController]: RTCPeerConnection instance no longer exists.")},c))}};try{if(jb&&a){var i=h.bind(null,"audio/video");a=Ba(jb,a),jb.setLocalDescription(a,i,i)}else e--;if(kb&&b){var j=h.bind(null,"screenshare");b=Ba(kb,b),kb.setLocalDescription(b,j,j)}else e--}catch(a){h("unknown",a||"error")}}function Ga(){Eb||Db&&!Fb?(jb.oniceconnectionstatechange=null,f.debug("[RtcSessionController]: Call is already held or is being put on hold. Stop monitoring iceConnectionState changes"),Aa(k.Connected)):zb===k.AnswerReceived&&Aa(k.AnswerApplied)}function Ha(a){return(!Rb||!(!a||!a.video))&&(i.isMobile()||!Tb)}function Ia(a){f.debug("[RtcSessionController]: setRemoteDescription()");try{if(!v())return void ya();var c,d=jb.getLocalStreams(),e=h.parse(a.sdp);if(a.screen){var g=h.findMediaLineIndex(e,a.screen);g!==-1&&(c=e.m[g],e.m.splice(g,1))}switch(a.type){case"offer":Kb=ba(a.type,e)&&!b.disableTrickleIce,Kb&&f.info("[RtcSessionController]: Enabled Trickle-ICE for answer.");break;case"pranswer":Aa(k.PrAnswerReceived),Jb=ba(a.type,e),Jb||f.info("[RtcSessionController]: Disabled Trickle-ICE for offer.");break;case"answer":Aa(k.AnswerReceived),Jb=ba(a.type,e),Jb||f.info("[RtcSessionController]: Disabled Trickle-ICE for offer.")}var i=2,l=!1,m=function(b,e){if(i--,e?(f.error("[RtcSessionController]: Failed to apply Remote "+b+" description:",e.message||e),l||(l=!0,ya())):f.debug("[RtcSessionController]: Remote description was successfully applied. PC=",b),!l&&i<=0)switch(f.debug("[RtcSessionController]: Remote Descriptions were successfully applied."),ob||S(),a.type){case"offer":Db||Cb?d.length>0?(ka(),f.debug("[RtcSessionController]: Removed Local Stream (hold)")):f.debug("[RtcSessionController]: Local Stream has not been set (hold)"):ja(),f.debug("[RtcSessionController]: Creating Local Description Answer...");var g={mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:Ha()}},h={audio:Hb.audio,video:Hb.video||Hb.desktop};jb.createAnswer(function(a){if(kb&&c){var b={mandatory:{OfferToReceiveAudio:!1,OfferToReceiveVideo:!Rb}};kb.createAnswer(function(b){Fa(a,b)},function(a){a=a||"Unspecified",f.error("[RtcSessionController]: Failed to create screenshare Local Description: ",a.message||a),ya()},b)}else Fa(a)},function(a){a=a||"Unspecified",f.error("[RtcSessionController]: Failed to create Local Description: ",a.message||a),ya()},g,h);break;case"pranswer":f.debug("[RtcSessionController]: Received pranswer, applying early media SDP"),Ga(),ha();break;case"answer":Ga(),ha();break;default:f.error("[RtcSessionController]: Invalid SDP Type = ",a.type),ya()}};if(jb){fb&&!kb&&c&&(lb=e.m[cb.video],lb.port=0,h.setConnectionMode({m:[lb]},"video","inactive"),e.m[cb.video]=c,f.debug("[RtcSessionController]: Disabled and replaced video m-line with screenshare m-line")),e=Ca(jb,e,a.type);var n=new j.SessionDescription({type:a.type,sdp:h.stringify(e)});f.debug("[RtcSessionController]: Modified remote audio/video SDP:",n);var o=m.bind(null,"audio/video");jb.setRemoteDescription(n,o,o),jb.remoteOrigin=h.getOrigin(e).trim()}else i--;if(kb&&c){e.m=[c],e=Ca(kb,e,a.type);var p=new j.SessionDescription({type:a.type,sdp:h.stringify(e)});f.debug("[RtcSessionController]: Modified remote screenshare SDP:",p);var q=m.bind(null,"screenshare");kb.setRemoteDescription(p,q,q),kb.remoteOrigin=h.getOrigin(e).trim()}else ia(kb),kb=null,i--}catch(a){f.error(a),ya()}}function Ja(){if(f.debug("[RtcSessionController]: renegotiateMedia()"),!v())return void ya();Db?f.debug("[RtcSessionController]: Local Stream has not been set (holding)"):ja(),f.debug("[RtcSessionController]: Creating Local Descriptions...");var a={mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:Ha(Hb)}};try{jb.createOffer(function(b){!kb||Rb&&!Hb.desktop?(kb&&(ia(kb),kb=null),Fa(b)):(a.mandatory.OfferToReceiveVideo=!0,a.mandatory.OfferToReceiveAudio=!1,kb.createOffer(function(a){Fa(b,a)},function(a){a=a||"Unspecified",f.error("[RtcSessionController]: Failed to create screenshare Local Description: ",a.message||a),ya()},a))},function(a){a=a||"Unspecified",f.error("[RtcSessionController]: Failed to create audio/video Local Description: ",a.message||a),ya()},a)}catch(a){f.error(a),ya()}}function Ka(a,b,c){return zb===k.AnswerReceived?(f.warning("[RtcSessionController]: Still processing the previous answer remote description. Queue the changeMedia"),void(Wb={mediaType:a,cb:b,screenConstraint:c})):Oa()?(ua(!0,b),"boolean"==typeof a.audio&&(Hb.audio=a.audio),"boolean"==typeof a.video&&(Hb.video=a.video),"boolean"==typeof a.hdVideo&&(Hb.hdVideo=a.hdVideo),"boolean"==typeof a.desktop&&(Hb.desktop=a.desktop),void s(Ja,ya,c)):void Pa(b,"Connection not stable")}function La(){f.debug("[RtcSessionController]: Closing the RTC session controller"),Aa(k.None),Ab={audio:!1,video:!1},Zb&&g.unregEvtHandlers(Zb),Lb&&(window.clearTimeout(Lb),Lb=null),Mb&&(window.clearTimeout(Mb),Mb=null),Xb&&(window.clearTimeout(Xb),Xb=null),tb&&(f.debug("[RtcSessionController]: Closing the old audio/video RTCPeerConnection"),Ua(tb,ub),ia(tb),tb=null),ub&&(f.debug("[RtcSessionController]: Closing the old screenshare RTCPeerConnection"),ia(ub),ub=null),jb&&(f.debug("[RtcSessionController]: Closing the RTCPeerConnection"),ia(jb),jb=null),kb&&(f.debug("[RtcSessionController]: Closing the Desktop peer connection"),ia(kb),kb=null),sb&&(f.debug("[RtcSessionController]: Stopping the old MediaStream"),ma(sb),sb=null),ob=!1,Eb=!1,Fb=!1,Db=!1,Cb=!1,Gb=!1,Nb=null,oa(null,_a),oa(null,ab),pa(),N(),Yb=!0}function Ma(){if(!jb)return f.error("[RtcSessionController]: PeerConnection not setup"),!1;if(Nb)return f.debug("[RtcSessionController]: DTMF Sender already enabled"),!0;var a=jb.getLocalStreams();if(!(a.length>0))return f.error("[RtcSessionController]: No Local Stream to create DTMF Sender"),!1;var b=a[_a].getAudioTracks();return b.length>0?!!(Nb=jb.createDTMFSender(b[0]))&&(Nb.ontonechange=C.bind(null,jb),f.info("[RtcSessionController]: Created DTMF Sender using remote audio track: "+b[0].label),!0):(f.error("[RtcSessionController]: No Audio Track to create DTMF Sender"),!1)}function Na(a){if(f.debug("[RtcSessionController]: startConn()"),a)Ia(a);else{ja(),f.debug("[RtcSessionController]: Creating Local Description...");var b={mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:Ha(Hb)}};jb.createOffer(function(a){if(!kb||Rb&&!Hb.desktop)Fa(a);else{var b={mandatory:{OfferToReceiveAudio:!1,OfferToReceiveVideo:!0}};kb.createOffer(function(b){Fa(a,b)},function(a){a=a||"Unspecified",f.error("[RtcSessionController]: Failed to create screenshare Local Description: ",a.message||a),ya()},b)}},function(a){a=a||"Unspecified",f.error("[RtcSessionController]: Failed to create Local Description: ",a.message||a),ya()},b)}}function Oa(){return jb?zb===k.AnswerReceived||zb===k.AnswerApplied?(f.debug("[RtcSessionController]: isConnStable: Processing remote answer SDP, the connection is considered stable"),!0):zb===k.AnswerSent?(f.debug("[RtcSessionController]: isConnStable: Answer SDP sent, the connection is considered stable"),!0):ob?(f.warning("[RtcSessionController]: isConnStable: There is a pending media renegotiation"),!1):!("stable"!==jb.signalingState&&!jb.connectionBypassed&&(f.warning("[RtcSessionController]: isConnStable: The connection is not established. signalingState =",jb.signalingState),!Qb)):(f.debug("[RtcSessionController]: isConnStable: There is no connection"),!1)}function Pa(a,b){"function"==typeof a&&window.setTimeout(function(){a(b)},0)}function Qa(a){return i.isMobile()?(f.debug("[RtcSessionController]: Number of extra video channels for mobile clients is 0 (zero)"),!1):Tb?(f.debug("[RtcSessionController]: Number of extra video channels for large conference is 0 (zero)"),!1):hb!==a&&(f.info("[RtcSessionController]: Set number of extra video channels to",a),hb=a,!0)}function Ra(a){var b,c=ib[a];if(c){var d=c.id+" ",e=c.getVideoTracks()[0];e&&(d+=e.id,b=d)}return b}function Sa(){var a,c;if(jb){var d=jb.localDescription;c=d.type,a=h.parse(d.sdp),!kb&&lb&&(a.m.splice(cb.video,0,lb),lb=null)}if(kb){var e=kb.localDescription.sdp;if(e){c||(c=kb.localDescription.type),e=h.parse(e),e=h.verifyFingerprintInMLines(e);var g=!fb&&!b.allowAllIceCandidatesScreenShare;f.info("[RtcSessionController]: Remove UDP video candidates for screenshare: ",g);var i=aa(c)&&!kb.endOfCandidates;h.validateIceCandidates(e,g,i),a?a.m=a.m.concat(e.m):a=e}}return{type:c,parsedSdp:a}}function Ta(a,b,d,e){var g=new c(function(c){i.getRTPStatsForClientDiagnostics(d,a,b,e,function(a,d){a&&f.warning("[RtcSessionController]: getStats error["+b+"]=",a),c(d)})});return g}function Ua(a,b){Va(a,b,!0,function(a,b){return a?void f.error("[RtcSessionController]: Error collecting QoS stats: ",a):void X(b)})}function Va(a,b,d,e){if(a&&a.mainPeerConnection){a.qosCollected=a.qosCollected||d;var f=[];f.push(Ta(a.mainPeerConnection,"AUDIO/VIDEO",a.startTime,d)),a.groupPeerConnections.forEach(function(b){f.push(Ta(b,"AUX_VIDEO",a.startTime,d))}),b&&f.push(Ta(b,"SCREEN_SHARE",a.startTime,d)),c.all(f).then(function(a){a?e&&e(null,a):e&&e("Could not get stats for all peer connections")})}else Pa(e,"pc not available")}n=n||{};var Wa=12e4,Xa=15e3,Ya=1e3,Za=2,$a=2,_a=0,ab=1,bb="video_screen_main",cb={audio:0,video:1,screen:2},db=this,eb=n.callId||"",fb=!!n.isDirectCall,gb=!!n.isTelephonyCall,hb=0,ib=[null,null],jb=null,kb=null,lb=null,mb=[],nb={},ob=!1,pb=!1,qb=!1,rb=null,sb=null,tb=null,ub=null,vb=null,wb=null,xb=[],yb=null,zb=k.None,Ab={audio:!1,video:!1},Bb=null,Cb=!1,Db=!1,Eb=!1,Fb=!1,Gb=!!n.isLargeConference,Hb={audio:!0,video:!1,hdVideo:!1,desktop:!1},Ib=null,Jb=!1,Kb=!1,Lb=null,Mb=null,Nb=null,Ob=!1,Pb=null,Qb=!1,Rb=!1,Sb=[],Tb=!!n.isLargeConference,Ub=!!n.isAtcPullCall,Vb=null,Wb=null,Xb=null,Yb=!1,Zb=null,$b=!1;this.onIceCandidate=null,this.onSessionDescription=null,this.onSdpConnected=null,this.onRemoteVideoAdded=null,this.onRemoteVideoRemoved=null,this.onRemoteStreamUpdated=null,this.onDTMFToneChange=null,this.onClosed=null,this.onRtcError=null,this.onRtcWarning=null,this.onLocalStreamEnded=null,this.onScreenSharePointerStatus=null,this.onQosAvailable=null,this.onMediaUpdate=null,this.onLocalVideoURL=null,this.onRemoteObjectURL=null,this.setTurnCredentials=function(a){nb=a||{}},this.setTurnUris=function(a){a&&a.length&&(mb=a)},this.setTrickleIceForAnswer=function(a){Kb=!!a},this.setTrickleIceForOffer=function(a){Jb=!!a},this.getTrickleIceForAnswer=function(){return Kb},this.getTrickleIceForOffer=function(){return Jb},this.getLocalVideoUrl=function(){return wb||vb},this.getLocalDesktopUrl=function(){return wb},this.getRemoteAudioUrl=function(){return yb},this.getRemoteVideoUrls=function(){return xb},this.getSdpStatus=function(){return zb},this.getWarmedUpSdp=function(){return Pb},this.isHolding=function(){return Db&&!Eb||Fb},this.isHoldInProgress=function(){return Eb},this.isRetrieveInProgress=function(){return Fb},this.isHeld=function(){return Cb},this.getActiveMediaType=function(){return i.shallowCopy(Ab)},this.getMediaConstraints=function(){return i.shallowCopy(Hb)},this.getLocalMediaType=function(){return{audio:Hb.audio&&Ab.audio,video:Hb.video&&Ab.video,desktop:Hb.desktop&&Ab.video}},this.hasScreenShare=function(){return!!wb},this.warmup=function(a,b,c,d,e){return c=c||function(){},d=d||function(){},Yb?(f.error("[RtcSessionController]: Warmup Connection failed: Session already terminated"),void Pa(d,"res_UnexpectedError")):(h.isNoOfferSdp(b)&&(b=null),a=_(a),f.info("[RtcSessionController]: Warming up the connection - mediaType = ",a),j.enabled?zb!==k.None?(f.error("[RtcSessionController]: The connection has already been started"),void Pa(d,"res_UnexpectedError")):(Hb=a,Hb.audio||(Gb=!0),void s(function(){b&&(Pb=b),Ob=!0,v(),c()},function(a){ya(a,d)},e)):(f.warning("[RtcSessionController]: WebRTC not supported by browser"),void Pa(d,"res_NoWebRTC")))},this.start=function(a,b){if(Yb)return f.error("[RtcSessionController]: Start Connection failed: Session already terminated"),!1;if(a=_(a),f.info("[RtcSessionController]: Start Connection - mediaType =",a),!j.enabled)return f.warning("[RtcSessionController]: WebRTC not supported by browser"),P("res_NoWebRTC"),!1;if(zb!==k.None)return f.error("[RtcSessionController]: The connection has already been started"),P("res_UnexpectedError"),!1;if(f.debug("[RtcSessionController]: Creating Peer Connection..."),Ob){if(b=Pb,Pb=null,Gb=!a.audio||Tb,!v())return P("res_RTCError"),!1;if(a.audio===Hb.audio&&a.video===Hb.video&&a.hdVideo===Hb.hdVideo&&a.desktop===Hb.desktop)return Na(b),!0}return v()?(Hb=a,s(function(){Na(b)},ya),!0):(P("res_RTCError"),!1)},this.addIceCandidates=function(a,b){f.info("[RtcSessionController]: Add remote ICE candidates");var c=jb||kb;if(c){var d=c.remoteOrigin;a&&a!==d?(f.warning("[RtcSessionController]: Ignoring remote ICE candidate - origin does not match."),f.debug("[RtcSessionController]: ICE candidate origin: ",a),f.debug("[RtcSessionController]: SDP origin: ",d)):(b.forEach(function(a){a=JSON.parse(a),a.candidate&&(a.candidate=a.candidate.replace(/(a=)*([^\r]+)(\r\n)*/i,"$2")),f.debug("[RtcSessionController]: Remote ICE candidate",a),a.candidate&&"end-of-candidates"!==a.candidate?jb.addIceCandidate(a):f.debug("[RtcSessionController]: Ignoring end-of-remote-candidates indication.")}),ha())}else f.warning("[RtcSessionController]: Ignoring remote ICE candidate - no peer connection found.")},this.setRemoteDescription=function(a,b){if(f.info("[RtcSessionController]: Set Remote Description - type: ",a.type),Pb=null,zb===k.AnswerReceived)return f.info("[RtcSessionController]: Still processing the previous answer remote description. Queue the new one"),void(Vb=a);if(zb===k.PrAnswerReceived)return"answer"===a.type&&(Aa(k.AnswerReceived),ha()),f.info("[RtcSessionController]: SDP already applied. Ignoring any later remote SDPs"),void Pa(b);if("offer"===a.type){if(!Oa())return void Pa(b,"Connection not stable");ua(!1,b),s(function(){Ia(a)},ya)}else{if("sdp"===a.sdp||"data"===a.sdp)return Aa(k.AnswerReceived),ob&&wa(),ha(),void Pa(b);Ia(a)}},this.renegotiateMedia=function(a){f.info("[RtcSessionController]: Start Media Renegotiation from client"),Oa()||Pa(a,"Connection not stable"),ua(!0,a),s(Ja,ya)},this.enableRemoteVideo=function(){Rb&&(f.info("[RtcSessionController]: Enable receiving remote video"),Rb=!1)},this.disableRemoteVideo=function(){Rb||(f.info("[RtcSessionController]: Disable receiving remote video"),Rb=!0)},this.addAudio=function(a){f.info("[RtcSessionController]: Add Audio"),Ka({audio:!0},a)},this.removeAudio=function(a){f.info("[RtcSessionController]: Remove Audio"),Ka({audio:!1},a)},this.addVideo=function(a){f.info("[RtcSessionController]: Add Video"),Ka({video:!0},a)},this.removeVideo=function(a){f.info("[RtcSessionController]: Remove Video"),Ka({video:!1},a)},this.addDesktop=function(a){f.info("[RtcSessionController]: Add Desktop (screen sharing)"),Ka({desktop:!0},a)},this.removeDesktop=function(a){f.info("[RtcSessionController]: Remove Desktop (screen sharing)"),Ka({desktop:!1},a)},this.changeMediaType=function(a,b,c,d){return f.info("[RtcSessionController]: Change media type: ",a),a?(qb=!!b,void Ka(a,c,d)):(f.warning("[RtcSessionController]: Invalid media type"),void Pa(c,"Invalid media type"))},this.holdCall=function(a){return f.info("[RtcSessionController]: Hold Call"),Oa()?Db?(f.warning("[RtcSessionController]: The call is already held"),void Pa(a)):(Db=!0,Eb=!0,ua(!0,a),void s(Ja,ya)):void Pa(a,"Connection not stable")},this.retrieveCall=function(a){return f.info("[RtcSessionController]: Retrieve Call"),Oa()?Db?(Db=!1,Fb=!0,ua(!0,a),void s(Ja,ya)):(f.warning("[RtcSessionController]: The call is not held"),void Pa(a)):void Pa(a,"Connection not stable")},this.renegotiationFailed=function(){ob&&(rb||O("res_RTCError"),xa())},this.mute=function(a){f.info("[RtcSessionController]: Mute Call"),ta(!1),Pa(a)},this.unmute=function(a){f.info("[RtcSessionController]: Unmute Call"),ta(!0),Pa(a)},this.isMuted=function(){return Gb},this.isLocalMuteAllowed=function(){return Gb||ib[_a]&&ib[_a].getAudioTracks().length},this.getRTPStatsForClientDiagnostics=function(a,b){Va(jb,kb,a,b)},this.isQosDataCollected=function(){return jb&&jb.qosCollected},this.terminate=function(){f.info("[RtcSessionController]: Terminate the RTC session controller"),La()},this.canSendDTMFDigits=function(){return!(!Nb&&!Ma())&&(Nb&&Nb.canInsertDTMF)},this.sendDTMFDigits=function(a){return f.info("[RtcSessionController]: Send DTMF Digits - digits=",a),!!Oa()&&(!(!Nb&&!Ma())&&(Nb.canInsertDTMF?(Nb.insertDTMF(a,200,50),!0):(f.error("[RtcSessionController]: DTMF Sender cannot insert DTMF digits: "+a),!1)))},this.setMockedCall=function(){Qb=!0},this.getCurrentPeerConnection=function(){return jb.mainPeerConnection},this.setExtraVideoChannelsForParticipants=function(a){var b=0;return a&&a>2&&(b=a-2,b=Math.max(b,Za),b=Math.min(b,$a)),Qa(b)},this.setExtraVideoChannels=function(a){return a=a||0,a>0&&(a=Math.max(a,Za),a=Math.min(a,$a)),Qa(a)},this.useMaxNumberOfExtraVideoChannels=function(){return Qa($a)},this.getNumberOfExtraVideoChannels=function(){return hb},this.hasMaxExtraVideoChannels=function(){return!!i.isMobile()||hb===$a},this.isConnStable=function(){return Oa()},this.isConnected=function(){return zb===k.Connected||ob},this.disableIncomingVideo=function(){Sb.forEach(function(a){a.getVideoTracks().length>0&&(a.getVideoTracks()[0].enabled=!1)})},this.enableIncomingVideo=function(){Sb.forEach(function(a){a.getVideoTracks().length>0&&(a.getVideoTracks()[0].enabled=!0)})},this.enableTrickleIce=function(){Jb=!b.disableTrickleIce,Jb&&f.info("[RtcSessionController]: Enabled Trickle-ICE for offer");
},this.getLocalStream=function(a){return ib[a]},this.setLocalStream=function(a,b){ib[a]=b},this.setIgnoreTurnOnNextPC=function(){Ub=!0},this.setIgnoreNextConnection=function(){$b=!0},f.debug("[RtcSessionController]: Created new RtcSessionController instance")}var c,d=a.Constants,e=a.IceCandidate,f=a.logger,g=a.ScreenSharingController,h=a.sdpParser,i=a.Utils,j=a.WebRTCAdapter,k=Object.freeze({None:"None",AnswerPending:"Answer-Pending",AnswerSent:"Answer-Sent",AnswerApplied:"Answer-Applied",OfferPending:"Offer-Pending",OfferSent:"Offer-Sent",OfferReceived:"Offer-Received",Connected:"Connected",PrAnswerReceived:"PrAnswer-Received",AnswerReceived:"Answer-Received",Disconnected:"Disconnected"});"undefined"!=typeof window.Promise&&(c=window.Promise);var l=2e3,m=200,n=!0,o=2e3,p=5e3,q={video:{maxBw:512},screenShare:{maxBw:300,maxFrameRate:5,minFrameRate:3},rtcpMuxPolicy:"negotiate"},r={video:{minBitRate:60},screenShare:{minBitRate:60,maxBitRate:100,startBitRate:60,maxQuantization:20}},s={AUDIO_VIDEO:0,DESKTOP:1};return b.DEFAULT_CANDIDATES_TIMEOUT=l,b.DEFAULT_TRICKLE_ICE_TIMEOUT=m,b.DEFAULT_ENABLE_AUDIO_AGC=n,b.DEFAULT_SDP_PARAMS=q,b.DEFAULT_XGOOGLE=r,b.LOCAL_STREAMS=s,b.candidatesTimeout=l,b.trickleIceTimeout=m,b.enableAudioAGC=n,b.allowAllIceCandidatesScreenShare=!0,b.disableTrickleIce=!1,b.allowOnlyRelayCandidates=!1,b.mediaNode=null,b.playbackDevices=[],b.recordingDevices=[],b.ringingDevices=[],b.videoDevices=[],b.sdpParameters=q,b.xGoogle=r,b.disableDesktopPc=!1,b.overridePromise=function(a){c=a},a.RtcSessionController=b,a.Enums=a.Enums||{},a.Enums.SdpStatus=k,a}(Circuit||{}),Circuit=function(a){"use strict";function b(a){if(!a||!a.rtcSessionId)throw new Error("Cannot create AtcRemoteCall object without a valid conversation");b.parent.constructor.call(this,a,!0),Object.defineProperties(this,{isPullAllowed:{get:function(){return this.atcCallInfo.isHandoverAllowed()&&this.atcCallInfo.cstaState!==f.Ringing},enumerable:!0,configurable:!1}}),this.isAtcRemote=!0,this.atcCallInfo=new c,a=null,g.info("[AtcRemoteCall]: Created new ATC remote call with callID = ",this.callId)}var c=a.AtcCallInfo,d=a.BaseCall,e=a.Enums.CallState,f=a.Enums.CstaCallState,g=a.logger,h=a.Utils;return h.inherit(b,d),b.prototype.isPresent=function(){return!this.checkState([e.Idle,e.Terminated])||!this.checkCstaState([f.Idle,f.Failed,f.TransferFailed,f.Terminated])},b.prototype.isDtmfAllowed=function(){return this.checkState(e.ActiveRemote)&&this.checkCstaState(f.Active)},a.AtcRemoteCall=b,a}(Circuit||{}),Circuit=function(a){"use strict";function b(a){var b,c;c=a.height,b=a.width,c/b>j/k?a.height>j&&(b=b*j/c,c=j):b>k&&(c=c*k/b,b=k);var d=document.createElement("canvas"),e=d.getContext("2d");return d.width=b,d.height=c,e.fillStyle=h,e.fillRect(0,0,d.width,d.height),e.drawImage(a,0,0,a.width,a.height,0,0,b,c),d.toDataURL("image/jpeg")}function c(a){for(var b=atob(a.split(",")[1]),c=[],d=0;d<b.length;d++)c.push(b.charCodeAt(d));return new Blob([new Uint8Array(c)],{type:"image/jpeg"})}function d(a){return new f(function(d){var e=new FileReader;e.onload=function(e){var f=new Image;f.onload=function(){var e=b(this),f=c(e);f.name=l+(a.modifiedName||a.name),f.lastModified=Math.round(Date.now()/1e3),d(f)},f.src=e.target.result},e.readAsDataURL(a)})}function e(a){function b(a){a&&a.forEach(function(a){var b=new XMLHttpRequest;b.withCredentials=!0,b.open("DELETE",a),b.send()})}function c(a,b,c,d,e){var g=function(){j[a]&&(j[a].xhr=null)};return new f(function(f,h){var i=b.modifiedName||b.name,k=new XMLHttpRequest;k.withCredentials=!0,k.open("POST",d+"/fileapi?itemid="+(c||"NULL"),!0),k.setRequestHeader("Content-Type",b.type),k.setRequestHeader("Content-Disposition",'attachment; filename="'+encodeURIComponent(i)+'"'),"function"==typeof e&&(k.upload.onprogress=function(a){a.total>0&&e(a.loaded,a.total,i)}),k.onload=function(){g(),200===k.status?f(k.response):h({filename:i,status:k.status,statusText:k.statusText,response:k.response,responseText:k.responseText})},k.onerror=function(){g(),h({filename:i,status:500,statusText:"Connection Failed"})},k.onabort=function(){g(),h({filename:i,status:0,statusText:"abort"})},j[a].xhr=k,k.send(b)})}var e=a?a.domain:null,h=1,j={};this.uploadFiles=function(a,b,k,l){if(!f)throw new Error("Promise support is required to use FileUpload");if(a.length>i)return f.reject("Exceeded maximum of 10 files per message");b=b||e;var m=b?"https://"+b:"",n=[],o=h++;j[o]={xhr:null,deleteUrls:[]};var p=[];a.forEach(function(a){g.isSupportedImage&&g.isSupportedImage(a.type)&&p.push(d(a))});var q=f.all(p).then(function(b){return Array.prototype.push.apply(a,b),k=k||null,a.reduce(function(a,b){return a.then(function(){return c(o,b,k,m,l).then(function(a){var c=JSON.parse(a)[0];k=k||c.id;var d=c.fileid[c.fileid.length-1],e=b.modifiedName||b.name,f={fileId:d,fileName:e,itemId:k,mimeType:c.mimeType||b.type,size:b.size,url:m+"/fileapi?fileid="+d+"&itemid="+k,deleteUrl:m+"/fileapi?fileid="+d+"&itemid="+k};return n.push(f),j[o].deleteUrls.push(f.deleteUrl),n})})},f.resolve())}).then(function(a){return delete j[o],f.resolve(a)},function(a){return delete j[o],f.reject(a)});return q.__uploadId=o,q},this.abort=function(a){if(a&&a.__uploadId&&j[a.__uploadId]){var c=j[a.__uploadId];delete j[a.__uploadId],c.xhr&&c.xhr.abort(),b(c.deleteUrls)}}}var f,g=a.Utils,h="#f0f0f0",i=10,j=312,k=484,l="tHuMbNaIl___";return"undefined"!=typeof Promise&&(f=Promise),e.COMPRESSED_IMG_PREFIX=l,e.overridePromise=function(a){f=a},a.FileUpload=e,a}(Circuit||{}),Circuit=function(a){"use strict";function b(a){var b={};this.dispatch=function(c){var d=c&&c.type;return d?void(b[d]?b[d].forEach(function(b){try{b(c)}catch(b){a&&a.error(b)}}):a&&a.debug("[EventTarget]: There is no listener for "+d)):void(a&&a.error("[EventTarget]: Attempted to dispatch a bad event"))},this.addEventListener=function(c,d){return c&&"function"==typeof d?(b[c]||(b[c]=[]),b[c].indexOf(d)>=0?void(a&&a.warning("[EventTarget]: Attempted to add duplicate event listener")):(b[c].push(d),void(a&&a.debug("[EventTarget]: Added event listener for "+this.name+", type = "+c+", count = "+b[c].length)))):void(a&&a.error("[EventTarget]: addEventListener invoked with invalid arguments"))},this.removeEventListener=function(c,d){if(b[c]){var e=b[c].indexOf(d);e>=0&&b[c].splice(e,1),a&&a.debug("[EventTarget]: Removed event listener for "+this.name+", type = "+c+", count = "+b[c].length)}},this.hasEventListener=function(a){return!!b[a]&&b[a].length>0},this.removeAllListeners=function(){b={}}}return b.prototype.constructor=b,b.prototype.createEvent=function(a){return{type:a}},b.prototype.dispatchEvent=function(a){var b=this.createEvent(a);this.dispatch(b)},a.BaseEventTarget=b,a}(Circuit||{}),Circuit=function(a){"use strict";function b(c){function h(){var a={};return B&&(a.accessToken=B),C&&g.extend(a,C),"wss://"+A+z+(Object.keys(a).length?"?"+g.toQS(a):"")}function i(a,b,c){if(b){var d=window.setTimeout(function(a){if(p.error("[ConnectionHandler]: Timeout waiting for response. RequestId:",a),x[a]){delete x[a],b(e.ReturnCode.REQUEST_TIMEOUT);var c=Object.keys(x).length;p.debug("[ConnectionHandler]: Remaining callbacks pending: ",c),0===c&&l(),v.pingServer()}},r,a);Array.isArray(c)||(c=null),x[a]={cb:b,timer:d,keysToOmitFromResponse:c}}}function j(a){var b;switch(a.msgType){case e.WSMessageType.RESPONSE:if(!a.response||!a.response.code)return null;if(a.response.user){var c;"GET_STUFF"===a.response.user.type?c=a.response.user.getStuff.user:"GET_LOGGED_ON"===a.response.user.type&&(c=a.response.user.getLoggedOn.user),c&&(c.clientId=a.clientId,c.apiVersion=a.apiVersion)}if(x[a.response.requestId])return b=x[a.response.requestId],delete x[a.response.requestId],b.timer&&window.clearTimeout(b.timer),b.keysToOmitFromResponse&&(a.keysToOmitFromLogging=b.keysToOmitFromResponse),{type:"ack",cb:b.cb,data:a.response};p.debug("[ConnectionHandler]: No callback for response with requestId=",a.response.requestId);break;case e.WSMessageType.EVENT:var d=f.ParseEvent(a.event);if(d&&d.name){if(w[d.name])return b=w[d.name],p.debug("[ConnectionHandler]: Parsed event: ",d.name),v.ommitKeysFromLog&&b.keysToOmitFromEvent&&(a.keysToOmitFromLogging=b.keysToOmitFromEvent),{type:"evt",cbList:b.cbList,name:d.name,data:d.data,suppressLog:b.suppressLog}}else p.error("[ConnectionHandler]: Failed to parse event: ",a.event);p.debug("[ConnectionHandler]: No registered callback for event ",d.name);break;default:p.error("[ConnectionHandler]: Unexpected message type: ",a.msgType)}return null}function k(a){p.debug("[ConnectionHandler]: Raising event",a.name),a.cbList.forEach(function(b){try{b(a.data)}catch(a){p.error("[ConnectionHandler]: Error raising event. ",a)}})}function l(){y.length>0&&(p.debug("[ConnectionHandler]: Raise all delayed events"),y.forEach(function(a){window.clearTimeout(a.timeoutId),k(a)}),y=[])}function m(a){if(p.debug("[ConnectionHandler]: WebSocket connection state changed to ",a.newState),p.debug("[ConnectionHandler]: Raising connectionStateChange event"),a.newState===d.Connected)F=0,!G&&t>0&&(G=window.setInterval(function(){v.pingServer()},t));else if(G&&(window.clearInterval(G),G=null),Object.keys(x).length){var b=x;x={},window.setTimeout(function(){Object.keys(b).forEach(function(a){var c=b[a];c.timer&&window.clearTimeout(c.timer),c.cb(e.ReturnCode.DISCONNECTED)}),l()},0)}var c=v.createEvent("connectionStateChange");c.newState=a.newState,c.oldState=a.oldState,v.dispatch(c)}function n(){p.debug("[ConnectionHandler]: WebSocket failed to reconnect. Raising reconnectFailed event");var a=v.createEvent("reconnectFailed");v.dispatch(a)}function o(a){!F&&a.apiVersion&&(F=g.convertVersionToNumber(a.apiVersion));var b=j(a);if(b)if(b.suppressLog||p.msgRcvd("[ConnectionHandler]: ",a),"evt"===b.type)Object.keys(x).length>0&&/^(?:User|Conversation|Search)\./.test(b.name)?(p.debug("[ConnectionHandler]: Delay event:",b.name),b.timeoutId=window.setTimeout(function(){k(b);var a=y.indexOf(b);a!==-1&&y.splice(a,1)},u),y.push(b)):k(b);else{var c=Object.keys(x).length;p.debug("[ConnectionHandler]: Remaining callbacks pending: ",c),b.cb(null,b.data),0===c&&l()}}var p=a.logger;c=c||{},b.parent.constructor.call(this,p);var q=2090010,r=6e4,s=2e4,t=c.disablePing||g.isMobile()?-1:3e5,u=500,v=this,w={},x={},y=[],z="/api",A=window.location.host,B=null,C=null,D=Object.keys(e.DeviceType),E={deviceType:!0,deviceSubtype:!0,manufacturer:!0,osVersion:!0,clientVersion:!0,hardwareModel:!0,capabilities:!0},F=0,G=null,H=!1,I=new a.ConnectionController(c);I.onStateChange=m,I.onReconnectFailed=n,I.onMessage=o,this.ommitKeysFromLog=!0,this.onMessage=o,this.setRelativeUrl=function(a){z=a,p.debug("[ConnectionHandler]: Set relative URL to ",z)},this.setTarget=function(a){A=a||window.location.host,p.debug("[ConnectionHandler]: Set target to ",A)},this.setClientInfo=function(a){if(a){if(!a.deviceSubtype||D.indexOf(a.deviceType)===-1)return void p.warn("[ConnectionHandler]: Attempted to set invalid clientInfo: ",a);C={},Object.keys(a).forEach(function(b){E[b]&&(C[b]=a[b])}),p.debug("[ConnectionHandler]: Set clientInfo to ",C)}else p.debug("[ConnectionHandler]: Clear clientInfo"),C=null},this.setToken=function(a){B=a},this.getUrl=h,this.getState=function(){return I.getState()},this.connect=function(a,b){p.debug("[ConnectionHandler]: Connect WebSocket to Access Server"),I.connect(h(),a,b)},this.disconnect=function(){p.debug("[ConnectionHandler]: Disconnect WebSocket from Access Server"),I.disconnect()},this.reconnect=function(a){p.debug("[ConnectionHandler]: Reconnect WebSocket to Access Server."),I.reconnect(h(),a)},this.sendMessage=function(a,b,c){return a&&a.request&&a.request.requestId?(p.debug("[ConnectionHandler]: Sending "+a.request.type+" request"),I.sendMessage(a)?(b&&i(a.request.requestId,b,c),!0):(p.error("[ConnectionHandler]: Failed to send message"),b&&window.setTimeout(function(){b(e.ReturnCode.FAILED_TO_SEND)},0),!1)):(p.error("[ConnectionHandler]: Cannot send message. Invalid message: ",a),b&&window.setTimeout(function(){b(e.ReturnCode.INVALID_MESSAGE)},0),!1)},this.pingServer=function(){if(I.isConnected()&&!H){var a,b="PING";if(F>=q&&!g.isMobile()&&(a=++f.requestNr,b+="|"+a),I.sendMessage(b),a){H=!0;var c=window.setTimeout(function(){H=!1,p.error("[ConnectionHandler]: Timed out waiting for ping response. RequestId:",a),delete x[a],I.reconnect(h())},s);x[a]={cb:function(){H=!1},timer:c}}}},this.on=function(a,b,c){if(a&&b){var d=w[a]||{cbList:[]};d.cbList.push(b),c&&(Array.isArray(c)?d.keysToOmitFromEvent=c:"*"===c&&(d.suppressLog=!0)),w[a]=d}}}var c=a.BaseEventTarget,d=a.Enums.ConnectionState,e=a.Constants,f=a.Proto,g=a.Utils;return g.inherit(b,c),b.prototype.name="ConnectionHandler",a.ConnectionHandler=b,a}(Circuit),Circuit=function(a){"use strict";function b(b){function h(a,b,c,d,e){var g=f.Request(a,b);return A?e=null:d&&(g.keysToOmitFromLogging=d),z.sendMessage(g,function(a,b){try{c(a,b)}catch(a){t.error("[ClientApiHandler]: Exception: ",a)}},e),g.request.requestId}function i(a,b){Circuit.Error&&(p=new Circuit.Error(a),b&&(p.errObj=b,p.message=b.info))}function j(a,b,c,e){if(p=null,a)return i(a),c(a),!1;if(b.code===d.ReturnCode.NO_RESULT)return e?c(null,[]):(i(d.ReturnCode.NO_RESULT),c(d.ReturnCode.NO_RESULT)),!1;var f,g=b.code;switch(b.code){case d.ReturnCode.OK:case d.ReturnCode.ENTITY_ALREADY_EXISTS:return!0;case d.ReturnCode.SERVICE_EXCEPTION:b.errorInfo&&b.errorInfo.errorCode&&(g=b.errorInfo.errorCode,g===d.ErrorCode.THIRDPARTY_ERROR&&b.errorInfo.thirdpartyError&&(g=b.errorInfo.thirdpartyError.type),f=b.errorInfo)}return g=g||d.ReturnCode.UNEXPECTED_RESPONSE,i(g,f),c(g),!1}function k(a,b,c){b&&i(b),a&&a!==y&&window.setTimeout(function(){a(b,c)},0)}function l(a){var b=[];return a?(a.audio&&b.push(d.RealtimeMediaType.AUDIO),a.video&&b.push(d.RealtimeMediaType.VIDEO),a.desktop&&b.push(d.RealtimeMediaType.DESKTOP_SHARING)):b.push(d.RealtimeMediaType.AUDIO),b}function m(a){return{convId:a.convId,rtcSessionId:a.rtcSessionId,ownerId:a.ownerId,sdp:a.sdp,mediaType:l(a.mediaType),callOut:!!a.callOut,handover:!!a.handover,sendInviteCancel:!!a.sendInviteCancel,peerUserId:a.peerUserId||void 0,replaces:a.replaces,from:a.fromDn||a.fromName?{phoneNumber:a.fromDn,displayName:a.fromName,resolvedUserId:a.fromUserId}:void 0,to:a.dialedDn?{phoneNumber:a.dialedDn,displayName:a.toName,resolvedUserId:a.toUserId}:void 0,isTelephonyConversation:!!a.isTelephonyConversation,displayName:a.displayName,transactionId:a.transactionId,screenSharePointerSupported:a.screenSharePointerSupported}}function n(a){a=a||y,t.debug("[ClientApiHandler]: getApiVersion...");var b={type:d.VersionActionType.GET_VERSION};h(d.ContentType.VERSION,b,function(b,c){if(b||c.code!==d.ReturnCode.OK)B=0;else{var e=c.version.getVersion.version;t.info("[ClientApiHandler]: Setting client API version to ",e),B=g.convertVersionToNumber(e)}a()})}function o(a,b){b=b||y,t.debug("[ClientApiHandler]: getStuff..."),a&&a.length||(a=[d.GetStuffType.USER,d.GetStuffType.ACCOUNTS,d.GetStuffType.FIRST_WEB_LOGIN,d.GetStuffType.PRESENCE_STATE,d.GetStuffType.RECENT_SEARCHES,d.GetStuffType.SETTINGS,d.GetStuffType.SUPPORT_CONVERSATION_ID,d.GetStuffType.TELEPHONY_CONVERSATION_ID,d.GetStuffType.GLOBAL_PROPERTIES,d.GetStuffType.TENANT,d.GetStuffType.NOTIFICATION_SUBSCRIPTIONS]);var c={type:d.UserActionType.GET_STUFF,getStuff:{types:a}},e=["response.user.getStuff.accounts.[].telephonyConfiguration.onsSipAuthenticationHash","response.user.getStuff.accounts.[].telephonyConfiguration.ondSipAuthenticationHash","response.user.getStuff.userPresenceState.longitude","response.user.getStuff.userPresenceState.latitude","response.user.getStuff.userPresenceState.locationText","response.user.getStuff.userPresenceState.statusMessage"];h(d.ContentType.USER,c,function(a,c){if(j(a,c,b)){var d=c.user.getStuff;d.user.userPresenceState=d.userPresenceState,d.user.accounts=d.accounts||[],B=g.convertVersionToNumber(d.user.apiVersion),q=d.user.clientId,r=d.user.userId,b(null,d)}},null,e)}var p,q,r,s,t=a.logger,u=2090010,v=2090013,w=2090016,x=2090019,y=function(){},z=new c(b),A=!1,B=0;Object.defineProperties(this,{clientId:{enumerable:!0,get:function(){return q},set:function(a){"simulatedDirect"===a&&(q=a)}},clientApiVersion:{enumerable:!0,get:function(){return B}}}),this.getLastError=function(){return p},this.connect=function(a,b,c){c&&z.setTarget(c),z.connect(a,b)},this.disconnect=z.disconnect.bind(z),this.reconnect=z.reconnect.bind(z),this.pingServer=z.pingServer.bind(z),this.setTarget=z.setTarget.bind(z),this.setClientInfo=z.setClientInfo.bind(z),this.setToken=z.setToken.bind(z),this.setRelativeUrl=z.setRelativeUrl.bind(z),this.addEventListener=z.addEventListener.bind(z),this.removeEventListener=z.removeEventListener.bind(z),this.setDevelopmentMode=function(a){A=!!a,z.ommitKeysFromLog=!a},this.on=function(a,b){var c;switch(a){case"Account.TELEPHONY_CONFIGURATION_UPDATED":c=["event.account.telephonyConfigurationUpdated.configuration.onsSipAuthenticationHash","event.account.telephonyConfigurationUpdated.configuration.ondSipAuthenticationHash"];break;case"Conversation.ADD_ITEM":c=["event.conversation.addItem.item.text","event.conversation.addItem.item.system.renamedConversation"];break;case"Conversation.UPDATE_ITEM":c=["event.conversation.updateItem.item.text"];break;case"Conversation.CREATE":c=["event.conversation.create.conversation.topic","event.conversation.create.conversation.description"];break;case"Conversation.UPDATE":c=["event.conversation.update.conversation","event.conversation.update.topic","event.conversation.update.description"];break;case"RTCSession.QUESTION_EVENT":c=["event.rtcSession.questionEvent.question.questionText"];break;case"User.USER_PRESENCE_CHANGE":c="*";break;case"Search.BASIC_SEARCH_RESULT":c=["event.search.basicSearchResult.searchResults"];break;case"ThirdParty.CONNECTED_TO_THIRDPARTY":c=["event.thirdParty.oAuthData"]}z.on(a,b,c)},this.isInviteGuestUserSupported=function(){return B>u},this.isVMCustomGreetingSupported=function(){return B>u},this.isOneDriveSupported=function(){return B>v},this.isArchiveSupported=function(){return B>x},this.isConferenceDialOutModeSupported=function(){return B>x},this.logout=function(a){a=a||y,t.debug("[ClientApiHandler]: logout...");var b={type:d.UserActionType.LOGOUT,logoff:{invalidate:!0}};h(d.ContentType.USER,b,function(b,c){j(b,c,a)&&a(null)})},this.getUser=function(a,b){b=b||y,t.debug("[ClientApiHandler]: getUser...");var c={type:d.UserActionType.GET_USER_BY_ID,getById:{userId:a}};h(d.ContentType.USER,c,function(a,c){j(a,c,b)&&b(null,c.user.getById.user)})},this.updateUser=function(a,b){b=b||y,t.debug("[ClientApiHandler]: updateUser...");var c={type:d.UserActionType.UPDATE,update:a};h(d.ContentType.USER,c,function(a,c){j(a,c,b)&&b(null,c.user.updateResult.user)})},this.getLoggedOnUser=function(a){a=a||y,t.debug("[ClientApiHandler]: getLoggedOnUser...");var b={type:d.UserActionType.GET_LOGGED_ON},c=["response.user.getLoggedOn.user.userPresenceState.longitude","response.user.getLoggedOn.user.userPresenceState.latitude","response.user.getLoggedOn.user.userPresenceState.locationText","response.user.getLoggedOn.user.userPresenceState.statusMessage","response.user.getLoggedOn.userPresenceState.longitude","response.user.getLoggedOn.userPresenceState.latitude","response.user.getLoggedOn.userPresenceState.locationText","response.user.getLoggedOn.userPresenceState.statusMessage"];h(d.ContentType.USER,b,function(b,c){var d,e;j(b,c,a)&&(e=c.user.getLoggedOn,d=e.user,e.userPresenceState=e.userPresenceState||d.userPresenceState,d.userPresenceState=e.userPresenceState,d.accounts=e.accounts||[],B=g.convertVersionToNumber(d.apiVersion),q=d.clientId,r=d.userId,a(null,e))},null,c)},this.getStuff=function(a,b){n(o.bind(this,a,b))},this.setPresence=function(a,b){b=b||y,t.debug("[ClientApiHandler]: setPresence...");var c={type:d.UserActionType.SET_PRESENCE,presence:{state:a.state,inTransit:a.inTransit,longitude:a.longitude,latitude:a.latitude,locationText:a.locationText,isAccurate:a.isAccurate,timeZoneOffset:a.timeZoneOffset,mobile:a.mobile,dndUntil:a.dndUntil,statusMessage:a.statusMessage||""}},e=["request.user.presence.longitude","request.user.presence.latitude","request.user.presence.locationText","request.user.presence.statusMessage"],f=["response.user.setPresence.state.longitude","response.user.setPresence.state.latitude","response.user.setPresence.state.locationText","response.user.setPresence.state.statusMessage"];h(d.ContentType.USER,c,function(a,c){j(a,c,b)&&b(null,c.user.setPresence.state)},e,f)},this.getPresence=function(a,b,c){c=c||y,t.debug("[ClientApiHandler]: getPresence...");var e=["response.user.getPresence.states.[].longitude","response.user.getPresence.states.[].latitude","response.user.getPresence.states.[].locationText","response.user.getPresence.states.[].statusMessage"],f={type:d.UserActionType.GET_PRESENCE,getPresence:{userIds:a,full:!!b}};h(d.ContentType.USER,f,function(a,b){j(a,b,c)&&c(null,b.user.getPresence.states)},null,e)},this.subscribePresence=function(a,b){b=b||y,t.debug("[ClientApiHandler]: subscribePresence...");var c=["response.user.subscribePresence.states.[].longitude","response.user.subscribePresence.states.[].latitude","response.user.subscribePresence.states.[].locationText","response.user.subscribePresence.states.[].statusMessage"],e={type:d.UserActionType.SUBSCRIBE_PRESENCE,subscribePresence:{userIds:a}};h(d.ContentType.USER,e,function(a,c){if(j(a,c,b)){var d=c.user&&c.user.subscribePresence&&c.user.subscribePresence.states;b(null,d)}},null,c)},this.unsubscribePresence=function(a,b){b=b||y,t.debug("[ClientApiHandler]: unsubscribePresence...");var c={type:d.UserActionType.UNSUBSCRIBE_PRESENCE,unsubscribePresence:{userIds:a}};h(d.ContentType.USER,c,function(a,c){j(a,c,b)&&b(null)})},this.updateStatusSubscription=function(a,b,c){c=c||y,t.debug("[ClientApiHandler]: updateStatusSubscription - subscribe = ",b);var e;e=b?{type:d.UserActionType.SUBSCRIBE_PRESENCE,subscribePresence:{userIds:a,notificationSubscriptionType:d.NotificationSubscriptionType.ONLINE_STATUS}}:{type:d.UserActionType.UNSUBSCRIBE_PRESENCE,unsubscribePresence:{userIds:a,notificationSubscriptionType:d.NotificationSubscriptionType.ONLINE_STATUS}},h(d.ContentType.USER,e,function(a,b){j(a,b,c)&&c(null)})},this.changePassword=function(a,b,c){c=c||y,t.debug("[ClientApiHandler]: changePassword...");var e={type:d.UserActionType.CHANGE_PASSWORD,changePassword:{oldPassword:a,newPassword:b}},f=["request.user.changePassword.oldPassword","request.user.changePassword.newPassword"];h(d.ContentType.USER,e,function(a,b){j(a,b,c)&&c(null,b.user.changePasswordResult.changeResult)},f)},this.setPassword=function(a,b){b=b||y,t.debug("[ClientApiHandler]: setPassword...");var c={type:d.UserActionType.SET_PASSWORD,setPassword:{password:a}},e=["request.user.setPassword.password"];h(d.ContentType.USER,c,function(a,c){j(a,c,b)&&b(null,c.user.setPasswordResult.resultSetPassword)},e)},this.getLdapTechnicalUserPresence=function(a){a=a||y,t.debug("[ClientApiHandler]: getLdapTechnicalUserPresence...");var b={type:d.UserActionType.GET_LDAP_TECHNICAL_USER_PRESENCE};h(d.ContentType.USER,b,function(b,c){j(b,c,a)&&a(null,c.user.getLdapTechnicalUserPresenceResult.state)})},this.subscribeDevices=function(a){a=a||y,t.debug("[ClientApiHandler]: subscribeDevices...");var b={type:d.UserActionType.SUBSCRIBE_DEVICES};h(d.ContentType.USER,b,function(b,c){if(j(b,c,a)){var d=c.user&&c.user.subscribeDevices&&c.user.subscribeDevices.devices;a(null,d)}})},this.unsubscribeDevices=function(a){a=a||y,t.debug("[ClientApiHandler]: unsubscribeDevices...");var b={type:d.UserActionType.UNSUBSCRIBE_DEVICES};h(d.ContentType.USER,b,function(b,c){j(b,c,a)&&a(null)})},this.requestEmailChange=function(a,b,c){t.debug("[ClientApiHandler]: requestEmailChange");var e={type:d.UserActionType.GENERATE_EMAIL_UPDATE_TOKEN,generateEmailUpdateToken:{userId:a,emailAddress:b}};h(d.ContentType.USER,e,function(a,b){j(a,b,c)&&c(null)})},this.getUsersByIds=function(a,b){b=b||y,t.debug("[ClientApiHandler]: getUsersByIds...");var c={type:d.UserActionType.GET_USERS_BY_IDS,usersByIds:{userIds:a,complete:!0}};h(d.ContentType.USER,c,function(a,c){j(a,c,b)&&b(null,c.user.usersByIds.user)})},this.getPartialUsersByIds=function(a,b){b=b||y,t.debug("[ClientApiHandler]: getPartialUsersByIds...");var c={type:d.UserActionType.GET_USERS_BY_IDS,usersByIds:{userIds:a,complete:!1}};h(d.ContentType.USER,c,function(a,c){j(a,c,b)&&b(null,c.user.usersByIds.user)})},this.renewToken=function(a,b){b=b||function(a){a?t.error("[ClientApiHandler]: Error renewing token. This client will be automatically logged out",a):t.debug("[ClientApiHandler]: Successfully renewed token.")},t.debug("[ClientApiHandler]: renewToken");var c={type:d.UserActionType.RENEW_TOKEN};h(d.ContentType.USER,c,function(a,c){j(a,c,b)&&b(null,c.user.renewToken)})},this.getUserSettings=function(a,b){b=b||y,a=a||d.UserSettingArea.ALL,t.debug("[ClientApiHandler]: getUserSettings...");var c={type:d.UserActionType.GET_USER_SETTINGS,getUserSettings:{areas:a}};h(d.ContentType.USER,c,function(a,c){j(a,c,b)&&b(null,c.user.getUserSettings.settings)})},this.setUserSettings=function(a,b){b=b||y,t.debug("[ClientApiHandler]: setUserSettings...");var c={type:d.UserActionType.SET_USER_SETTINGS,setUserSettings:{settings:a}};h(d.ContentType.USER,c,function(a,c){j(a,c,b)&&b(null)})},this.getUserByEmail=function(a,b){b=b||y;var c={type:d.UserActionType.GET_USER_BY_MAIL,getUserByMail:{emailAddress:a,excludeRoles:[d.UserRole.SUPPORT,d.UserRole.SYSTEM_ADMIN]}};h(d.ContentType.USER,c,function(a,c){j(a,c,b)&&b(null,c.user.getUserByMail.user)})},this.getUsersByEmails=function(a,b){b=b||y,t.debug("[ClientApiHandler]: getUsersByEmails...");var c={type:d.UserActionType.GET_USERS_BY_MAILS,getUsersByMails:{emailAddresses:a.emailAddresses,xmppLookup:!!a.xmppLookup,excludeRoles:[d.UserRole.SUPPORT,d.UserRole.SYSTEM_ADMIN]}};h(d.ContentType.USER,c,function(a,c){j(a,c,b,!0)&&b(null,c.user.getUsersByMails.users)})},this.changeUserEmail=function(a,b,c){c=c||y;var e={type:d.UserActionType.EMAIL_UPDATE,emailUpdate:{userId:a,emailAddress:b}};h(d.ContentType.USER,e,function(a,b){j(a,b,c)&&c(null,b.user.emailUpdate)})},this.goToSleep=function(a,b){b=b||y,t.debug("[ClientApiHandler]: goToSleep...");var c={type:d.UserActionType.GO_TO_SLEEP,userId:a};h(d.ContentType.USER,c,function(a,c){j(a,c,b)&&b(null)})},this.wakeUp=function(a){a=a||y,t.debug("[ClientApiHandler]: wakeUp...");var b={type:d.UserActionType.WAKE_UP};h(d.ContentType.USER,b,function(b,c){j(b,c,a)&&a(null)})},this.getDevices=function(a){a=a||y,t.debug("[ClientApiHandler]: getDevices...");var b={type:d.UserActionType.GET_DEVICES};h(d.ContentType.USER,b,function(b,c){j(b,c,a)&&a(null,c.user.getDevices.devices)})},this.getTelephonyData=function(a){a=a||y,t.debug("[ClientApiHandler]: getTelephonyData...");var b={type:d.UserActionType.GET_TELEPHONY_DATA};h(d.ContentType.USER,b,function(b,c){j(b,c,a)&&a(null,c.user.getTelephonyData.data)})},this.getUserExtensions=function(a){a=a||y,t.debug("[ClientApiHandler]: getUserExtensions...");var b={type:d.UserActionType.GET_USER_EXTENSIONS};h(d.ContentType.USER,b,function(b,c){j(b,c,a,!0)&&a(null,c.user.getUserExtensions.extensions)})},this.setUserExtensionState=function(a,b,c){c=c||y,t.debug("[ClientApiHandler]: setUserExtensionState...");var e={type:d.UserActionType.SET_USER_EXTENSION_STATE,setUserExtensionState:{extensionId:a,state:b}};h(d.ContentType.USER,e,function(a,b){j(a,b,c)&&c(null,b.user.setUserExtensionStateResult.extensionConfigurationUrl)})},this.getConnectedApps=function(a){a=a||y,t.debug("[ClientApiHandler]: getConnectedApps...");var b={type:d.UserActionType.OAUTH_GET_GRANTED_ACCESS_TOKENS};h(d.ContentType.USER,b,function(b,c){j(b,c,a,!0)&&a(null,c.user.oAuthGetGrantedAccessTokens.oAuthGrantedAccess)})},this.revokeAccessToken=function(a,b){b=b||y,t.debug("[ClientApiHandler]: revokeAccessToken...");var c={type:d.UserActionType.OAUTH_REVOKE_ACCESS_TOKEN,oAuthRevokeGrantedAccessToken:{tokenId:a}};h(d.ContentType.USER,c,function(a,c){j(a,c,b)&&b(null)})},this.revokeAllManagedDevices=function(a){a=a||y,t.debug("[ClientApiHandler]: revokeAllManagedDevices...");var b={type:d.UserActionType.REVOKE_MANAGED_DEVICES};h(d.ContentType.USER,b,function(b,c){j(b,c,a)&&a(null)})},this.getSecurityTokenInfo=function(a){a=a||y,t.debug("[ClientApiHandler]: getSecurityTokenInfo...");var b={type:d.UserActionType.GET_SECURITY_TOKEN_INFO};h(d.ContentType.USER,b,function(b,c){j(b,c,a,!0)&&a(null,c.user.getSecurityTokenInfoResult.securityTokenInfo)})},this.revokeSecurityToken=function(a,b){b=b||y,t.debug("[ClientApiHandler]: revokeSecurityToken...");var c={type:d.UserActionType.REVOKE_SECURITY_TOKEN,revokeSecurityToken:{tokenIdHash:a}};h(d.ContentType.USER,c,function(a,c){j(a,c,b)&&b(null)})},this.startBasicSearch=function(a,b,c,e){c=c||y,t.debug("[ClientApiHandler]: startBasicSearch...");var f={type:d.SearchActionType.START_BASIC_SEARCH,startBasicSearch:{searchTerm:a,priorizedConvs:b||void 0,newSearch:e||void 0}};h(d.ContentType.SEARCH,f,function(a,b){j(a,b,c)&&c(null,b.search.startSearchResult.searchId)})},this.startDetailSearch=function(a,b,c,e,f){f=f||y,t.debug("[ClientApiHandler]: startDetailSearch...");var g={type:d.SearchActionType.START_DETAIL_SEARCH,startDetailSearch:{searchTerm:a,convId:b,searchId:c||void 0,resultSetLimit:e||0}};h(d.ContentType.SEARCH,g,function(a,b){j(a,b,f)&&f(null,b.search.startSearchResult.searchId)})},this.cancelSearch=function(a,b){b=b||y,t.debug("[ClientApiHandler]: cancelSearch...");var c={type:d.SearchActionType.CANCEL_SEARCH,cancelSearch:{searchId:a}};h(d.ContentType.SEARCH,c,function(a,c){j(a,c,b)&&b(null)})},this.getRecentSearches=function(a){a=a||y;var b={type:d.SearchActionType.GET_RECENT_SEARCHES};h(d.ContentType.SEARCH,b,function(b,c){j(b,c,a,!0)&&a(null,c.search.getRecentSearch.recentSearches)})},this.addRecentSearch=function(a,b){b=b||y;var c={type:d.SearchActionType.ADD_RECENT_SEARCH,addRecentSearch:{searchTerm:a}};h(d.ContentType.SEARCH,c,function(a,c){j(a,c,b)&&b(null)})},this.startUserSearch=function(a,b){b=b||y;var c={type:d.SearchActionType.START_USER_SEARCH,startUserSearch:{query:a.query,reversePhoneNumberLookup:!!a.reversePhoneNumberLookup}};h(d.ContentType.SEARCH,c,function(a,c){j(a,c,b)&&b(null,c.search.startSearchResult.searchId)})},this.searchConversationParticipants=function(a,b,c){c=c||y;var e={type:d.SearchActionType.SEARCH_CONVERSATION_PARTICIPANTS,searchConversationParticipants:{displayName:a,convId:b}};h(d.ContentType.SEARCH,e,function(a,b){j(a,b,c,!0)&&c(null,b.search.searchConversationParticipantsResult.participants||[])})},this.createConversation=function(a,b){b=b||y,t.debug("[ClientApiHandler]: createConversation...");var c=a.type;c||(c=a.participants.length>2?d.ConversationType.GROUP:d.ConversationType.DIRECT);var e={type:d.ConversationActionType.CREATE,create:{type:c,topic:a.topic,description:a.description||void 0,participants:a.participants,invitations:a.emailAddresses,locale:a.locale}},f=["request.conversation.create.topic","request.conversation.create.description"],g=["response.conversation.create.conversation.topic","response.conversation.create.conversation.description","response.conversation.create.conversation.topLevelItem"];h(d.ContentType.CONVERSATION,e,function(a,c){j(a,c,b)&&b(null,c.conversation.create.conversation,c.code===d.ReturnCode.ENTITY_ALREADY_EXISTS)},f,g)},this.updateConversation=function(a,b){b=b||y,t.debug("[ClientApiHandler]: updateConversation...");var c={type:d.ConversationActionType.UPDATE,update:{convId:a.conversationId,topic:a.topic,description:a.description}},e=["request.conversation.update.topic","request.conversation.update.description"],f=["response.conversation.update.conversation.participants","response.conversation.update.conversation.topic","response.conversation.update.conversation.description","response.conversation.update.conversation.topLevelItem"];h(d.ContentType.CONVERSATION,c,function(a,c){j(a,c,b)&&b(null,c.conversation.update.conversation)},e,f)},this.addTextItem=function(a,b){b=b||y,
t.debug("[ClientApiHandler]: addTextItem...");var c=a.content&&g.sanitize(a.content)&&g.sanitizeSymbols(a.content)||"";c=e.convertPrivateDataToContent(a)+c;var f={type:d.ConversationActionType.ADD_TEXT_ITEM,addTextItem:{convId:a.convId,parentId:a.parentId,contentType:a.contentType,subject:a.subject,content:c,attachmentMetaData:a.attachmentMetaData,externalAttachmentMetaData:a.externalAttachmentMetaData,preview:a.preview,mentionedUsers:a.mentionedUsers}};f.addTextItem.preview&&f.addTextItem.preview.description&&(f.addTextItem.preview.description=f.addTextItem.preview.description.substr(0,255));var i=["request.conversation.addTextItem.subject","request.conversation.addTextItem.content"],k=["response.conversation.addTextItem.item.text"];h(d.ContentType.CONVERSATION,f,function(a,c){j(a,c,b)&&b(null,c.conversation.addTextItem.item)},i,k)},this.updateTextItem=function(a,b){b=b||y,t.debug("[ClientApiHandler]: updateTextItem...");var c=a.content&&g.sanitize(a.content)&&g.sanitizeSymbols(a.content)||"";c=e.convertPrivateDataToContent(a)+c;var f={itemId:a.itemId,convId:a.convId,parentId:a.parentId,contentType:d.TextItemContentType.RICH,subject:a.subject,content:c,attachmentMetaData:a.attachmentMetaData,preview:a.preview||{},clustered:a.clustered,externalAttachmentMetaData:a.externalAttachmentMetaData,mentionedUsers:a.mentionedUsers};f.preview.description&&(f.preview.description=f.preview.description.substr(0,255)),f.externalAttachmentMetaData&&0!==f.externalAttachmentMetaData.length||(f.externalAttachmentMetaData=[{type:"BOX",downloadLocation:"",previewLocation:"",attachment:{}}]),f.attachmentMetaData&&0!==f.attachmentMetaData.length||(f.attachmentMetaData=[{}]);var i={type:d.ConversationActionType.UPDATE_TEXT_ITEM,updateTextItem:f},k=["request.conversation.updateTextItem.subject","request.conversation.updateTextItem.content"],l=["response.conversation.updateTextItem.item.text"];h(d.ContentType.CONVERSATION,i,function(a,c){j(a,c,b)&&b(null,c.conversation.updateTextItem.item)},k,l)},this.deleteTextItem=function(a,b){if(b=b||y,!a||!a.itemId)return t.warn("[ClientApiHandler]: No request parameters were provided"),void k(b,d.ReturnCode.INVALID_MESSAGE);t.debug("[ClientApiHandler]: deleteTextItem...");var c={type:d.ConversationActionType.DELETE_TEXT_ITEM,deleteTextItem:{itemId:a.itemId}};h(d.ContentType.CONVERSATION,c,function(a,c){j(a,c,b)&&b(null,c.conversation.deleteTextItem.item)})},this.deleteRecording=function(a,b){b=b||y,t.debug("[ClientApiHandler]: deleteRecording...");var c={type:d.ConversationActionType.DELETE_RECORDING,deleteRecording:{itemId:a}};h(d.ContentType.CONVERSATION,c,function(a,c){j(a,c,b)&&b(null,c.conversation.deleteRecording.item)})},this.updateRtcItemAttachments=function(a,b,c){c=c||y,t.debug("[ClientApiHandler]: updateRtcItemAttachments...");var e={type:d.ConversationActionType.UPDATE_RTC_ITEM_ATTACHMENTS,updateRtcItemAttachments:{itemId:a,attachments:b}};h(d.ContentType.CONVERSATION,e,function(a,b){j(a,b,c)&&c(null,b.conversation.updateRtcItemAttachmentsResult.item)})},this.getOpenConversations=function(a,b,c){c=c||y,t.debug("[ClientApiHandler]: getOpenConversations...");var e={type:d.ConversationActionType.GET_OPEN_CONVERSATIONS,getOpenConversations:{startIndex:a,numberOfItems:b}},f=["response.conversation.getOpenConversations.conversations"];h(d.ContentType.CONVERSATION,e,function(a,b){if(j(a,b,c,!0)){var d=b.conversation.getOpenConversations;c(null,d.conversations,d.lastItemIndex)}},null,f)},this.getAllOpenConversations=function(a,b,c,e){e=e||y,t.debug("[ClientApiHandler]: getAllOpenConversations...");var f={type:d.ConversationActionType.GET_OPEN_CONVERSATIONS,getOpenConversations:{startIndex:a,numberOfItems:b,ownIncluded:!0,sorting:c}},g=["response.conversation.getOpenConversations.conversations"];h(d.ContentType.CONVERSATION,f,function(a,b){if(j(a,b,e,!0)){var c=b.conversation.getOpenConversations;e(null,c.conversations,c.lastItemIndex)}},null,g)},this.joinOpenConversation=function(a,b){b=b||y,t.debug("[ClientApiHandler]: JoinOpenConversation...");var c={type:d.ConversationActionType.JOIN_OPEN_CONVERSATION,joinOpenConversation:{convId:a}};h(d.ContentType.CONVERSATION,c,function(a,c){j(a,c,b)&&b(null,c.conversation.joinOpenConversation.conv)})},this.getConversationFeed=function(a,b,c,e,f,g,i){i=i||y,t.debug("[ClientApiHandler]: getConversationFeed...");var k={type:d.ConversationActionType.GET_CONVERSATION_FEED,getConversationFeed:{convId:a,timestamp:b||void 0,minTotalItems:c||void 0,maxTotalUnread:e||void 0,commentsPerThread:f||void 0,maxUnreadPerThread:g||void 0}},l=["response.conversation.getConversationFeedResult.conversationThreads.[].parentItem.attachments","response.conversation.getConversationFeedResult.conversationThreads.[].parentItem.externalAttachments","response.conversation.getConversationFeedResult.conversationThreads.[].parentItem.rtc","response.conversation.getConversationFeedResult.conversationThreads.[].parentItem.text","response.conversation.getConversationFeedResult.conversationThreads.[].parentItem.system","response.conversation.getConversationFeedResult.conversationThreads.[].comments.[].attachments","response.conversation.getConversationFeedResult.conversationThreads.[].comments.[].externalAttachments","response.conversation.getConversationFeedResult.conversationThreads.[].comments.[].text"];h(d.ContentType.CONVERSATION,k,function(a,b){if(j(a,b,i,!0)){var c=b.conversation.getConversationFeedResult;i(null,c.conversationThreads,c.hasOlderThreads)}},null,l)},this.getThreadComments=function(a,b,c,e,f,g,i){i=i||y,t.debug("[ClientApiHandler]: getThreadComments...");var k={type:d.ConversationActionType.GET_THREAD_COMMENTS,getThreadComments:{convId:a,threadId:b,timestamp:c||void 0,timestampFilter:e||d.TimestampFilter.CREATION,direction:f||void 0,totalComments:g||void 0}},l=["response.conversation.getThreadCommentsResult.comments.[].attachments","response.conversation.getThreadCommentsResult.comments.[].externalAttachments","response.conversation.getThreadCommentsResult.comments.[].text"];h(d.ContentType.CONVERSATION,k,function(a,b){if(j(a,b,i,!0)){var c=b.conversation.getThreadCommentsResult;i(null,c.comments,c.hasMoreComments)}},null,l)},this.getThreadsByItemIds=function(a,b){if(t.debug("[ClientApiHandler]: getThreadsByItemIds..."),b=b||y,!a)return t.warn("[ClientApiHandler]: No request parameters were provided"),void k(b,d.ReturnCode.INVALID_MESSAGE);if(!a.convId)return t.warn("[ClientApiHandler]: No conversation id was provided"),void k(b,d.ReturnCode.INVALID_MESSAGE);if(!a.threadParams)return t.warn("[ClientApiHandler]: No thread parameters were provided (item ids were not provided)"),void k(b,d.ReturnCode.INVALID_MESSAGE);var c=["response.conversation.getThreadsByItemIdsResult.conversationThreadContext.[].parentItem.attachments","response.conversation.getThreadsByItemIdsResult.conversationThreadContext.[].parentItem.externalAttachments","response.conversation.getThreadsByItemIdsResult.conversationThreadContext.[].parentItem.rtc","response.conversation.getThreadsByItemIdsResult.conversationThreadContext.[].parentItem.text","response.conversation.getThreadsByItemIdsResult.conversationThreadContext.[].parentItem.system","response.conversation.getThreadsByItemIdsResult.conversationThreadContext.[].comments.[].item.attachments","response.conversation.getThreadsByItemIdsResult.conversationThreadContext.[].comments.[].item.externalAttachments","response.conversation.getThreadsByItemIdsResult.conversationThreadContext.[].comments.[].item.text","response.conversation.getThreadsByItemIdsResult.conversationThreadContext.[].lastComments.[].attachments","response.conversation.getThreadsByItemIdsResult.conversationThreadContext.[].lastComments.[].externalAttachments","response.conversation.getThreadsByItemIdsResult.conversationThreadContext.[].lastComments.[].text"],e={type:d.ConversationActionType.GET_THREADS_BY_ITEM_IDS,getThreadsByItemIds:{convId:a.convId,threadParams:a.threadParams,timestampFilter:a.timestampFilter||void 0,orderBy:a.orderBy||void 0}};h(d.ContentType.CONVERSATION,e,function(a,c){if(j(a,c,b,!0)){var d=c.conversation.getThreadsByItemIdsResult;b(null,d&&d.conversationThreadContext)}},null,c)},this.getThreadsByIds=function(a,b){if(t.debug("[ClientApiHandler]: getThreadsByIds..."),b=b||y,!a)return t.warn("[ClientApiHandler]: No request parameters were provided"),void k(b,d.ReturnCode.INVALID_MESSAGE);if(!a.convId)return t.warn("[ClientApiHandler]: No conversation id was provided"),void k(b,d.ReturnCode.INVALID_MESSAGE);if(!(a.threadIds instanceof Array&&a.threadIds.length>0))return t.warn("[ClientApiHandler]: No thread parameters were provided (thread ids were not provided)"),void k(b,d.ReturnCode.INVALID_MESSAGE);var c=["response.conversation.getThreadsByIdsResult.conversationThreads.[].parentItem.attachments","response.conversation.getThreadsByIdsResult.conversationThreads.[].parentItem.externalAttachments","response.conversation.getThreadsByIdsResult.conversationThreads.[].parentItem.rtc","response.conversation.getThreadsByIdsResult.conversationThreads.[].parentItem.text","response.conversation.getThreadsByIdsResult.conversationThreads.[].parentItem.system","response.conversation.getThreadsByIdsResult.conversationThreads.[].comments.[].attachments","response.conversation.getThreadsByIdsResult.conversationThreads.[].comments.[].externalAttachments","response.conversation.getThreadsByIdsResult.conversationThreads.[].comments.[].text"],e={type:d.ConversationActionType.GET_THREADS_BY_IDS,getThreadsByIds:{convId:a.convId,threadIds:a.threadIds,orderBy:a.orderBy||d.SortingType.TIMESTAMP_ASC,commentsPerThread:a.commentsPerThread||void 0}};h(d.ContentType.CONVERSATION,e,function(a,c){if(j(a,c,b,!0)){var d=c.conversation.getThreadsByIdsResult;b(null,d&&d.conversationThreads)}},null,c)},this.getConversations=function(a,b,c,e,f,g){if(g=g||y,t.debug("[ClientApiHandler]: getConversations..."),f=f||d.ConversationFilter.ALL,!this.isArchiveSupported())switch(f){case d.ConversationFilter.UNARCHIVED:f=d.ConversationFilter.ALL;break;case d.ConversationFilter.ARCHIVED:f=d.ConversationFilter.MARKED}var i=c?d.SearchDirection.BEFORE:d.SearchDirection.AFTER,k={type:d.ConversationActionType.GET_CONVERSATIONS,getConversations:{userId:a,modificationDate:b||void 0,direction:i,number:e||void 0,filter:f,sortByLastItem:!!c}},l=["response.conversation.getConversations.conversations"];h(d.ContentType.CONVERSATION,k,function(a,b){j(a,b,g,!0)&&g(null,b.conversation.getConversations.conversations)},null,l)},this.getSupportConversation=function(a){a=a||y,t.debug("[ClientApiHandler]: getSupportConversation...");var b={type:d.ConversationActionType.GET_SUPPORT_CONVERSATION};h(d.ContentType.CONVERSATION,b,function(b,c){j(b,c,a)&&a(null,c.conversation.getSupportConversation.conversation)})},this.getSupportConversationId=function(a){a=a||y,t.debug("[ClientApiHandler]: getSupportConversationId...");var b={type:d.ConversationActionType.GET_SUPPORT_CONVERSATION_ID};h(d.ContentType.CONVERSATION,b,function(b,c){j(b,c,a)&&a(null,c.conversation.getSupportConversationId.conversationId)})},this.getTelephonyConversationId=function(a){a=a||y,t.debug("[ClientApiHandler]: getTelephonyConversationId...");var b={type:d.ConversationActionType.GET_TELEPHONY_CONVERSATION_ID};h(d.ContentType.CONVERSATION,b,function(b,c){j(b,c,a)&&a(null,c.conversation.getTelephonyConversationId.conversationId)})},this.getMarkedConversationsList=function(a){a=a||y,t.debug("[ClientApiHandler]: getMarkedConversationsList...");var b={type:d.ConversationActionType.GET_MARKED_CONVERSATIONS_LIST};h(d.ContentType.CONVERSATION,b,function(b,c){j(b,c,a)&&a(null,c.conversation.getMarkedConversationsList)})},this.getFavoriteConversationIds=function(a){if(a=a||y,t.debug("[ClientApiHandler]: getFavoriteConversationIds..."),!this.isArchiveSupported())return t.warn("[ClientApiHandler]: The getFavoriteConversationIds operation is not supported by the backend"),void k(a,d.ReturnCode.OPERATION_NOT_SUPPORTED);var b={type:d.ConversationActionType.GET_FAVORITE_CONVERSATION_IDS};h(d.ContentType.CONVERSATION,b,function(b,c){j(b,c,a,!0)&&a(null,c.conversation.getFavoriteConversationIdResult.favoriteConversationIds)})},this.markConversation=function(a,b){b=b||y;var c={type:d.ConversationActionType.MARK_CONVERSATION,markConversation:{convId:a.convId,filter:a.markType}};h(d.ContentType.CONVERSATION,c,function(a,c){j(a,c,b)&&b(null)})},this.unmarkConversation=function(a,b){b=b||y;var c={type:d.ConversationActionType.UNMARK_CONVERSATION,unmarkConversation:{convId:a.convId,filter:a.markType}};h(d.ContentType.CONVERSATION,c,function(a,c){j(a,c,b)&&b(null)})},this.getConversationUserData=function(a,b,c){c=c||y,t.debug("[ClientApiHandler]: getConversationUserData..."),a instanceof Array||(a=[a]);var e={type:d.ConversationActionType.GET_CONVERSATION_USER_DATA,getConversationUserData:{conversationId:a,userDataToInclude:b||void 0}};h(d.ContentType.CONVERSATION,e,function(a,b){j(a,b,c)&&c(null,b.conversation.getConversationUserData.userData)})},this.getConversationItems=function(a,b,c,e,f,g){g=g||y,t.debug("[ClientApiHandler]: getConversationItems...");var i={type:d.ConversationActionType.GET_ITEMS_BY_CONVERSATION,getItemsByConversation:{convId:a,modificationDate:b||void 0,creationDate:c||void 0,direction:e||void 0,number:f||void 0}},k=["response.conversation.getItemsByConversation.items.[].attachments","response.conversation.getItemsByConversation.items.[].externalAttachments","response.conversation.getItemsByConversation.items.[].rtc","response.conversation.getItemsByConversation.items.[].text","response.conversation.getItemsByConversation.items.[].system"];h(d.ContentType.CONVERSATION,i,function(a,b){j(a,b,g,!0)&&g(null,b.conversation.getItemsByConversation.items)},null,k)},this.getConversationAttachments=function(a,b,c){c=c||y,t.debug("[ClientApiHandler]: getConversationAttachments...");var e={type:d.ConversationActionType.GET_ATTACHMENTS,getAttachments:{conversationId:a,startPage:b.page||void 0,pageSize:b.size||void 0,orderType:b.type||void 0,orderDirection:b.direction||void 0}};h(d.ContentType.CONVERSATION,e,function(a,b){if(j(a,b,c)){var d=b.conversation.getAttachments.attachments||[],e=b.conversation.getAttachments.nextPage.hasMoreAttachments?b.conversation.getAttachments.nextPage.lastIndex:null;c(null,d,e)}})},this.getItemsByConversationItemId=function(a,b,c,e,f,g){g=g||y,t.debug("[ClientApiHandler]: getItemsByConversationItemId...");var i={type:d.ConversationActionType.GET_ITEMS_BY_CONVERSATION_ITEM_ID,getItemsByConversationItemId:{convId:a,itemId:b,direction:c||void 0,number:e||void 0,orderType:f||void 0}},k=["response.conversation.getItemsByConversationItemId.items.[].attachments","response.conversation.getItemsByConversationItemId.items.[].externalAttachments","response.conversation.getItemsByConversationItemId.items.[].rtc","response.conversation.getItemsByConversationItemId.items.[].text","response.conversation.getItemsByConversationItemId.items.[].system"];h(d.ContentType.CONVERSATION,i,function(a,b){j(a,b,g,!0)&&g(null,b.conversation.getItemsByConversationItemId.items)},null,k)},this.getConversationById=function(a,b){b=b||y,t.debug("[ClientApiHandler]: getConversationById...");var c={type:d.ConversationActionType.GET_CONVERSATION_BY_ID,getConversationById:{convId:a}},e=["response.conversation.getConversationById.conversation.participants","response.conversation.getConversationById.conversation.topic","response.conversation.getConversationById.conversation.description","response.conversation.getConversationById.conversation.topLevelItem"];h(d.ContentType.CONVERSATION,c,function(a,c){if(j(a,c,b)){var d=c.conversation.getConversationById.conversation;d&&d.participants&&t.info("[ClientApiHandler]: Retrieved conversation has "+d.participants.length+" participant(s)"),b(null,d)}},null,e)},this.getConversationsByIds=function(a,b){b=b||y,t.debug("[ClientApiHandler]: getConversationsByIds...");var c={type:d.ConversationActionType.GET_CONVERSATIONS_BY_IDS,getConversationsByIds:{conversationId:a}},e=["response.conversation.getConversationsByIdsResult.conversations"];h(d.ContentType.CONVERSATION,c,function(a,c){j(a,c,b,!0)&&b(null,c.conversation.getConversationsByIdsResult.conversations)},null,e)},this.getItemById=function(a,b){b=b||y,t.debug("[ClientApiHandler]: getItemById...");var c={type:d.ConversationActionType.GET_ITEM_BY_ID,getItemById:{itemId:a}},e=["response.conversation.getItemById.item.text"];h(d.ContentType.CONVERSATION,c,function(a,c){j(a,c,b)&&b(null,c.conversation.getItemById.item)},null,e)},this.setReadPointer=function(a,b,c){c=c||y,t.debug("[ClientApiHandler]: setReadPointer...");var e={type:d.ConversationActionType.SET_READ_POINTER,setReadPointer:{convId:a,lastReadTimestamp:b}};h(d.ContentType.CONVERSATION,e,function(a,b){j(a,b,c)&&c(null)})},this.getConversationByUser=function(a,b){b=b||y,t.debug("[ClientApiHandler]: getConversationByUser...");var c={type:d.ConversationActionType.GET_CONVERSATION_BY_USER,getConversationByUser:{userId:a}},e=["response.conversation.getConversationByUser.conversation.topic","response.conversation.getConversationByUser.conversation.description","response.conversation.getConversationByUser.conversation.topLevelItem"];h(d.ContentType.CONVERSATION,c,function(a,c){j(a,c,b)&&b(null,c.conversation.getConversationByUser.conversation)},null,e)},this.getConversationsByFilter=function(a,b){b=b||y,t.debug("[ClientApiHandler]: getConversationsByFilter...");var c={type:d.ConversationActionType.GET_CONVERSATIONS_BY_FILTER,getConversationsByFilter:{conversationsFilter:a.filterConnector,timestamp:a.timestamp||void 0,number:a.number,numberOfParticipants:a.numberOfParticipants}},e=["response.conversation.getConversationsByFilterResult.conversations"];h(d.ContentType.CONVERSATION,c,function(a,c){j(a,c,b,!0)&&b(null,c.conversation.getConversationsByFilterResult.conversations)},null,e)},this.subscribe=function(a,b){b=b||y,t.debug("[ClientApiHandler]: subscribe...");var c={type:d.ConversationActionType.SUBSCRIBE,subscribe:{conversationId:a}};h(d.ContentType.CONVERSATION,c,function(a,c){j(a,c,b)&&b(null)})},this.unsubscribe=function(a,b){b=b||y,t.debug("[ClientApiHandler]: unsubscribe...");var c={type:d.ConversationActionType.UNSUBSCRIBE,unsubscribe:{conversationId:a}};h(d.ContentType.CONVERSATION,c,function(a,c){j(a,c,b)&&b(null)})},this.typing=function(a,b,c,e){e=e||y,t.debug("[ClientApiHandler]: typing...");var f={type:d.ConversationActionType.TYPING,typing:{conversationId:a,isTyping:b,parentItemId:c}};h(d.ContentType.CONVERSATION,f,function(a,b){j(a,b,e)&&e(null)})},this.addParticipant=function(a,b){b=b||y,t.debug("[ClientApiHandler]: addParticipant...");var c={type:d.ConversationActionType.ADD_PARTICIPANT,addParticipant:{convId:a.convId,userId:a.userId,invitations:a.emailAddresses,locale:a.locale}};h(d.ContentType.CONVERSATION,c,function(a,c){j(a,c,b)&&b(null,c.conversation.addParticipant)})},this.removeParticipant=function(a,b,c){c=c||y,t.debug("[ClientApiHandler]: removeParticipant..."),!b||b instanceof Array||(b=[b]);var e={type:d.ConversationActionType.REMOVE_PARTICIPANT,removeParticipant:{convId:a,userId:b}};h(d.ContentType.CONVERSATION,e,function(a,b){j(a,b,c)&&c(null,b.conversation.removeParticipant.conversation)})},this.getConversationParticipants=function(a,b,c){c=c||y,t.debug("[ClientApiHandler]: getConversationParticipants..."),b=b||{};var e={type:d.ConversationActionType.GET_CONVERSATION_PARTICIPANTS,getConversationParticipants:{convId:a,searchCriterias:b.searchCriterias||void 0,searchPointer:b.searchPointer||void 0,pageSize:b.pageSize||25,includePresence:!!b.includePresence}};h(d.ContentType.CONVERSATION,e,function(a,b){j(a,b,c)&&c(null,b.conversation.getConversationParticipantsResult)})},this.getJoinDetails=function(a,b,c){c=c||y,t.debug("[ClientApiHandler]: getJoinDetails...");var e={type:d.ConversationActionType.GET_JOIN_DETAILS,getJoinDetails:{conversationId:a,recreate:!!b}},f=["response.conversation.getJoinDetails.tenantPIN","response.conversation.getJoinDetails.sessionPIN"];h(d.ContentType.CONVERSATION,e,function(a,b){j(a,b,c)&&c(null,b.conversation.getJoinDetails)},null,f)},this.setFlagItem=function(a,b){if(b=b||y,t.debug("[ClientApiHandler]: setFlagItem..."),!a)return t.warn("[ClientApiHandler]: No request parameters were provided"),void k(b,d.ReturnCode.INVALID_MESSAGE);var c={type:d.ConversationActionType.SET_FLAG_ITEM,setFlagItem:{conversationId:a.convId,conversationItemId:a.itemId,conversationItemCreationTime:a.creationTime,conversationParentId:a.parentId}};h(d.ContentType.CONVERSATION,c,function(a,c){j(a,c,b)&&b(null)})},this.clearFlagItem=function(a,b,c){c=c||y,t.debug("[ClientApiHandler]: clearFlagItem...");var e={type:d.ConversationActionType.CLEAR_FLAG_ITEM,clearFlagItem:{conversationId:a,conversationItemId:b}};h(d.ContentType.CONVERSATION,e,function(a,b){j(a,b,c)&&c(null)})},this.getFlaggedItems=function(a){a=a||y,t.debug("[ClientApiHandler]: getFlaggedItems...");var b={type:d.ConversationActionType.GET_FLAGGED_ITEMS};h(d.ContentType.CONVERSATION,b,function(b,c){j(b,c,a,!0)&&a(null,c.conversation.getFlaggedItem.flaggedItems)})},this.likeTextItem=function(a,b,c){c=c||y,t.debug("[ClientApiHandler]: likeTextItem...");var e={type:d.ConversationActionType.LIKE_TEXT_ITEM,likeTextItem:{conversationItemId:a,userId:b}};h(d.ContentType.CONVERSATION,e,function(a,b){j(a,b,c)&&c(null)})},this.unlikeTextItem=function(a,b,c){c=c||y,t.debug("[ClientApiHandler]: unlikeTextItem...");var e={type:d.ConversationActionType.UNLIKE_TEXT_ITEM,unlikeTextItem:{conversationItemId:a,userId:b}};h(d.ContentType.CONVERSATION,e,function(a,b){j(a,b,c)&&c(null)})},this.setConvAvatar=function(a,b,c){c=c||y,t.debug("[ClientApiHandler]: setConvAvatar...");var e={type:d.ConversationActionType.SET_CONVERSATION_AVATAR,setConversationAvatar:{convId:a,imageS:b.s,imageL:b.b}};h(d.ContentType.CONVERSATION,e,function(a,b){j(a,b,c)&&c(null,b.conversation.setConversationAvatar.conversation)})},this.deleteConvAvatar=function(a,b){b=b||y,t.debug("[ClientApiHandler]: deleteConvAvatar...");var c={type:d.ConversationActionType.SET_CONVERSATION_AVATAR,setConversationAvatar:{convId:a,imageS:"",imageL:""}};h(d.ContentType.CONVERSATION,c,function(a,c){j(a,c,b)&&b(null,c.conversation.setConversationAvatar.conversation)})},this.moderateConversation=function(a,b){b=b||y,t.debug("[ClientApiHandler]: moderateConversation...");var c={type:d.ConversationActionType.MODERATE_CONVERSATION,moderateConversation:{convId:a}};h(d.ContentType.CONVERSATION,c,function(a,c){j(a,c,b)&&b(null,c.conversation.moderateResult)})},this.unmoderateConversation=function(a,b){b=b||y,t.debug("[ClientApiHandler]: unmoderateConversation...");var c={type:d.ConversationActionType.UNMODERATE_CONVERSATION,unmoderateConversation:{convId:a}};h(d.ContentType.CONVERSATION,c,function(a,c){j(a,c,b)&&b(null,c.conversation.moderateResult)})},this.updateGuestAccess=function(a,b,c){c=c||y,t.debug("[ClientApiHandler]: updateGuestAccess...");var e={type:d.ConversationActionType.UPDATE_GUEST_ACCESS,updateGuestAccess:{convId:a,guestAccessDisabled:!!b}};h(d.ContentType.CONVERSATION,e,function(a,b){j(a,b,c)&&c(null,b.conversation.updateGuestAccessResult)})},this.getConversationSummary=function(a,b){b=b||y,t.debug("[ClientApiHandler]: getConversationSummary...");var c={type:d.ConversationActionType.GET_CONVERSATION_SUMMARY,getConversationSummary:{convId:a}};h(d.ContentType.CONVERSATION,c,function(a,c){j(a,c,b)&&b(null,c.conversation.getConversationSummary.conversationSummary)})},this.grantModeratorRights=function(a,b,c){c=c||y,b instanceof Array||(b=[b]),t.debug("[ClientApiHandler]: grantModeratorRights...");var e={type:d.ConversationActionType.GRANT_MODERATOR_RIGHTS,grantModeratorRights:{convId:a,userId:b}};h(d.ContentType.CONVERSATION,e,function(a,b){j(a,b,c)&&c(null,b.conversation.grantModeratorRightsResult)})},this.dropModeratorRights=function(a,b,c){c=c||y,b instanceof Array||(b=[b]),t.debug("[ClientApiHandler]: dropModeratorRights...");var e={type:d.ConversationActionType.DROP_MODERATOR_RIGHTS,dropModeratorRights:{convId:a,userId:b}};h(d.ContentType.CONVERSATION,e,function(a,b){j(a,b,c)&&c(null,b.conversation.dropModeratorRightsResult)})},this.addJournalEntry=function(a,b){b=b||y,t.debug("[ClientApiHandler]: addJournalEntry...");var c={type:d.ConversationActionType.ADD_JOURNAL_ENTRY,addJournalEntry:{convId:a.convId,starter:a.starter,source:a.source,destination:a.destination,startTime:a.startTime,duration:a.duration,type:a.type,participants:a.participants,missedReason:a.missedReason}};h(d.ContentType.CONVERSATION,c,function(a,c){j(a,c,b)&&b(null)})},this.setFavoritePosition=function(a,b,c){c=c||y,t.debug("[ClientApiHandler]: setFavoritePosition...");var e={type:d.ConversationActionType.SET_FAVORITE_POSITION,setFavoritePosition:{convId:a,position:b}};h(d.ContentType.CONVERSATION,e,function(a,b){j(a,b,c)&&c(null,b)})},this.addLabels=function(a,b){b=b||y,t.debug("[ClientApiHandler]: addLabels...");var c={type:d.ConversationActionType.ADD_LABELS,addLabels:{labels:a}};h(d.ContentType.CONVERSATION,c,function(a,c){j(a,c,b)&&b(null,c.conversation.addLabelsResult.labels)})},this.assignLabels=function(a,b,c){c=c||y,t.debug("[ClientApiHandler]: assignLabels...");var e={type:d.ConversationActionType.ASSIGN_LABELS,assignLabels:{convId:a,labelIds:b}};h(d.ContentType.CONVERSATION,e,function(a,b){j(a,b,c)&&c(null,b.conversation.assignLabelsResult.labelIds)})},this.unassignLabels=function(a,b,c){c=c||y,t.debug("[ClientApiHandler]: unassignLabels...");var e={type:d.ConversationActionType.UNASSIGN_LABELS,unassignLabels:{convId:a,labelIds:b}};h(d.ContentType.CONVERSATION,e,function(a,b){j(a,b,c,!0)&&c(null,b.conversation.unassignLabelsResult.labelIds)})},this.getAllLabels=function(a){a=a||y,t.debug("[ClientApiHandler]: getAllLabels...");var b={type:d.ConversationActionType.GET_LABELS};h(d.ContentType.CONVERSATION,b,function(b,c){j(b,c,a,!0)&&a(null,c.conversation.getLabelsResult.labels)})},this.removeLabels=function(a,b){b=b||y,t.debug("[ClientApiHandler]: removeLabels...");var c={type:d.ConversationActionType.REMOVE_LABELS,removeLabels:{labelIds:a}};h(d.ContentType.CONVERSATION,c,function(a,c){j(a,c,b,!0)&&b(null,c.conversation.removeLabelsResult.labelIds)})},this.editLabel=function(a,b){b=b||y,t.debug("[ClientApiHandler]: editLabel...");var c={type:d.ConversationActionType.EDIT_LABEL,editLabel:{label:a}};h(d.ContentType.CONVERSATION,c,function(a,c){j(a,c,b)&&b(null,c.conversation.editLabelResult.label)})},this.addFilter=function(a,b,c){c=c||y,t.debug("[ClientApiHandler]: addFilter...");var e={type:d.ConversationActionType.ADD_FILTER,addFilter:{filterName:a,root:b}};h(d.ContentType.CONVERSATION,e,function(a,b){j(a,b,c)&&c(null,b.conversation.addFilterResult)})},this.removeFilter=function(a,b){b=b||y,t.debug("[ClientApiHandler]: removeFilters...");var c={type:d.ConversationActionType.REMOVE_FILTERS,removeFilters:{filterIds:a}};h(d.ContentType.CONVERSATION,c,function(a,c){j(a,c,b,!0)&&b(null,c.conversation.removeFiltersResult.filterIds)})},this.getAllFilters=function(a){a=a||y,t.debug("[ClientApiHandler]: getAllFilters...");var b={type:d.ConversationActionType.GET_FILTERS,getFilters:{}};h(d.ContentType.CONVERSATION,b,function(b,c){j(b,c,a,!0)&&a(null,c.conversation.getFiltersResult.filters)})},this.editFilter=function(a,b){b=b||y,t.debug("[ClientApiHandler]: editFilter...");var c={type:d.ConversationActionType.EDIT_FILTER,editFilter:{filter:a}};h(d.ContentType.CONVERSATION,c,function(a,c){j(a,c,b)&&b(null,c.conversation.editFilterResult)})},this.joinRtcCall=function(a,b){b=b||y,t.debug("[ClientApiHandler]: joinRtcCall...");var c={type:d.RTCCallActionType.JOIN,join:m(a)};h(d.ContentType.RTC_CALL,c,function(a,c){j(a,c,b)&&b(null)})},this.answerRtcCall=function(a,b){b=b||y,t.debug("[ClientApiHandler]: answerRtcCall...");var c={type:d.RTCCallActionType.ANSWER,answer:m(a)};h(d.ContentType.RTC_CALL,c,function(a,c){j(a,c,b)&&b(null)})},this.sendIceCandidates=function(a,b){b=b||y,t.debug("[ClientApiHandler]: sendIceCandidates...");var c={type:d.RTCCallActionType.ICE_CANDIDATES,iceCandidates:{rtcSessionId:a.rtcSessionId,userId:a.userId,origin:a.origin,candidates:a.candidates}};h(d.ContentType.RTC_CALL,c,function(a,c){j(a,c,b)&&b(null)})},this.leaveRtcCall=function(a,b,c){b=b||{},c=c||y,t.debug("[ClientApiHandler]: leaveRtcCall...");var e={type:d.RTCCallActionType.LEAVE,leave:{rtcSessionId:a,disconnectCause:b.cause,disconnectReason:b.reason}};h(d.ContentType.RTC_CALL,e,function(a,b){j(a,b,c)&&c(null)})},this.terminateRtcCall=function(a,b,c){b=b||{},c=c||y,t.debug("[ClientApiHandler]: terminateRtcCall...");var e={type:d.RTCCallActionType.TERMINATE,terminate:{rtcSessionId:a,disconnectCause:b.cause,disconnectReason:b.reason}};h(d.ContentType.RTC_CALL,e,function(a,b){j(a,b,c)&&c(null)})},this.declineRtcCall=function(a,b){b=b||y,t.debug("[ClientApiHandler]: declineRtcCall...");var c={type:d.RTCCallActionType.INVITE_REJECT,inviteReject:{convId:a.convId,rtcSessionId:a.rtcSessionId,cause:a.cause,transactionId:a.transactionId}};h(d.ContentType.RTC_CALL,c,function(a,c){j(a,c,b)&&b(null)})},this.changeMediaType=function(a,b){b=b||y,t.debug("[ClientApiHandler]: changeMediaType...");var c={type:d.RTCCallActionType.CHANGE_MEDIA_TYPE,changeMediaType:{rtcSessionId:a.rtcSessionId,sdp:a.sdp,mediaTypes:l(a.mediaType),transactionId:a.transactionId,screenSharePointerSupported:a.screenSharePointerSupported}};h(d.ContentType.RTC_CALL,c,function(a,c){j(a,c,b)&&b(null)})},this.changeMediaAccept=function(a,b){b=b||y,t.debug("[ClientApiHandler]: changeMediaAccept...");var c={type:d.RTCCallActionType.CHANGE_MEDIA_ACCEPT,changeMediaAccept:{rtcSessionId:a.rtcSessionId,sdp:a.sdp,transactionId:a.transactionId}};h(d.ContentType.RTC_CALL,c,function(a,c){j(a,c,b)&&b(null)})},this.changeMediaReject=function(a,b){b=b||y,t.debug("[ClientApiHandler]: changeMediaReject...");var c={type:d.RTCCallActionType.CHANGE_MEDIA_REJECT,changeMediaReject:{rtcSessionId:a.rtcSessionId,transactionId:a.transactionId}};h(d.ContentType.RTC_CALL,c,function(a,c){j(a,c,b)&&b(null)})},this.prepareSession=function(a,b){b=b||y,t.debug("[ClientApiHandler]: prepareSession... ");var c={type:d.RTCCallActionType.PREPARE,prepare:{convId:a.convId,rtcSessionId:a.rtcSessionId,ownerId:a.ownerId,mediaNode:a.mediaNode,isTelephonyConversation:a.isTelephonyConversation,replaces:a.replaces}},e=["response.rtcCall.prepare.servers.[].password"];h(d.ContentType.RTC_CALL,c,function(a,c){j(a,c,b)&&b(null,c.rtcCall.prepare.servers,c.rtcCall.prepare.newRtcSessionId)},null,e)},this.renewTurnCredentials=function(a,b){b=b||y,t.debug("[ClientApiHandler]: renewTurnCredentials... ");var c={type:d.RTCCallActionType.RENEW_TURN_CREDENTIALS,renewTurnCredentials:{rtcSessionId:a}},e=["response.rtcCall.renewTurnCredentials.servers.[].password"];h(d.ContentType.RTC_CALL,c,function(a,c){j(a,c,b)&&b(null,c.rtcCall.renewTurnCredentials.servers)},null,e)},this.sendProgress=function(a,b,c,e){e=e||y,t.debug("[ClientApiHandler]: sendProgress... ");var f={type:d.RTCCallActionType.SEND_PROGRESS,sendProgress:{rtcSessionId:a,userId:c,invitingUser:b||"",type:d.RTCProgressType.ALERTING}};h(d.ContentType.RTC_CALL,f,function(a,b){j(a,b,e)&&e(null)})},this.lockRtcSession=function(a,b,c){c=c||y,t.debug("[ClientApiHandler]: lockRtcSession...");var e={type:d.RTCSessionActionType.LOCK,lock:{rtcSessionId:a,locked:!!b}};h(d.ContentType.RTC_SESSION,e,function(a,b){j(a,b,c)&&c(null)})},this.muteRtcSession=function(a,b){b=b||y,t.debug("[ClientApiHandler]: muteRtcSession...");var c={type:d.RTCSessionActionType.MUTE_SESSION,muteSession:{rtcSessionId:a.rtcSessionId,muted:!!a.muted,excludedUserIds:a.excludedUserIds||void 0}};h(d.ContentType.RTC_SESSION,c,function(a,c){j(a,c,b)&&b(null)})},this.muteParticipant=function(a,b){b=b||y,t.debug("[ClientApiHandler]: muteParticipant...");var c={type:d.RTCSessionActionType.MUTE,mute:{rtcSessionId:a.rtcSessionId,muted:!!a.muted,userIds:a.usersIds||void 0}};h(d.ContentType.RTC_SESSION,c,function(a,c){j(a,c,b)&&b(null);
})},this.addParticipantToRtcSession=function(a,b){b=b||y,t.debug("[ClientApiHandler]: addParticipantToRtcCall...");var c={type:d.RTCSessionActionType.ADD_PARTICIPANT,addParticipant:{rtcSessionId:a.rtcSessionId,userId:a.userId,from:a.from,to:a.to,mediaType:l(a.mediaType)}};h(d.ContentType.RTC_SESSION,c,function(a,c){j(a,c,b)&&b(null)})},this.removeSessionParticipant=function(a,b){b=b||y,t.debug("[ClientApiHandler]: removeSessionParticipant...");var c={type:d.RTCSessionActionType.REMOVE_PARTICIPANT,removeParticipant:{rtcSessionId:a.rtcSessionId,userId:a.userId}};h(d.ContentType.RTC_SESSION,c,function(a,c){j(a,c,b)&&b(null)})},this.getActiveSessions=function(a){a=a||y,t.debug("[ClientApiHandler]: getActiveSessions...");var b={type:d.RTCSessionActionType.GET_ACTIVE_SESSIONS};h(d.ContentType.RTC_SESSION,b,function(b,c){j(b,c,a,!0)&&a(null,c.rtcSession.activeSessions.session)})},this.getSession=function(a,b){b=b||y,t.debug("[ClientApiHandler]: getSession...");var c={type:d.RTCSessionActionType.GET_SESSION,getSession:{rtcSessionId:a}};h(d.ContentType.RTC_SESSION,c,function(a,c){j(a,c,b)&&b(null,c.rtcSession.getSession.session)})},this.moveRtcSession=function(a,b){b=b||y,t.debug("[ClientApiHandler]: moveRtcSession...");var c={type:d.RTCSessionActionType.MOVE,move:{oldRtcSessionId:a.sessionId,oldConversationId:a.conversationId,newConversationId:a.newConversationId,newRtcSessionId:a.newSessionId}};h(d.ContentType.RTC_SESSION,c,function(a,c){j(a,c,b)&&b(null)})},this.startRecording=function(a,b){b=b||y,t.debug("[ClientApiHandler]: startRecording...");var c={type:d.RTCSessionActionType.START_RECORDING,startRecording:{convId:a.convId,rtcSessionId:a.rtcSessionId,mediaTypes:l(a.mediaTypes)}};h(d.ContentType.RTC_SESSION,c,function(a,c){j(a,c,b)&&b(null)})},this.stopRecording=function(a,b){b=b||y,t.debug("[ClientApiHandler]: stopRecording...");var c={type:d.RTCSessionActionType.STOP_RECORDING,stopRecording:{convId:a.convId,rtcSessionId:a.rtcSessionId}};h(d.ContentType.RTC_SESSION,c,function(a,c){j(a,c,b)&&b(null)})},this.raiseQuestion=function(a,b){b=b||y,t.debug("[ClientApiHandler]: raiseQuestion...");var c={type:d.RTCSessionActionType.RAISE_QUESTION,raiseQuestion:a},e=["request.rtcSession.raiseQuestion.question"];h(d.ContentType.RTC_SESSION,c,function(a,c){j(a,c,b)&&b(null,c.rtcSession.raiseQuestion.questionNumber)},e)},this.inviteToStage=function(a,b){b=b||y,t.debug("[ClientApiHandler]: inviteToStage..."),a.allowedMediaTypes=l();var c={type:d.RTCSessionActionType.INVITE_TO_STAGE,inviteToStage:a};h(d.ContentType.RTC_SESSION,c,function(a,c){j(a,c,b)&&b(null)})},this.inviteToStageAnswer=function(a,b){b=b||y,t.debug("[ClientApiHandler]: inviteToStageAnswer...");var c={type:d.RTCSessionActionType.INVITE_TO_STAGE_ANSWER,inviteToStageAnswer:a};h(d.ContentType.RTC_SESSION,c,function(a,c){j(a,c,b)&&b(null)})},this.inviteToStageCancel=function(a,b){b=b||y,t.debug("[ClientApiHandler]: inviteToStageCancel...");var c={type:d.RTCSessionActionType.INVITE_TO_STAGE_CANCEL,inviteToStageCancel:a};h(d.ContentType.RTC_SESSION,c,function(a,c){j(a,c,b)&&b(null)})},this.removeFromStage=function(a,b){b=b||y,t.debug("[ClientApiHandler]: removeFromStage...");var c={type:d.RTCSessionActionType.REMOVE_FROM_STAGE,removeFromStage:a};h(d.ContentType.RTC_SESSION,c,function(a,c){j(a,c,b)&&b(null)})},this.getQuestions=function(a,b){b=b||y,t.debug("[ClientApiHandler]: getQuestions...");var c={type:d.RTCSessionActionType.GET_QUESTIONS,getQuestions:a};h(d.ContentType.RTC_SESSION,c,function(a,c){j(a,c,b)&&b(null,c.rtcSession.getQuestions.questions)})},this.updateQuestionState=function(a,b){b=b||y,t.debug("[ClientApiHandler]: updateQuestionState...");var c={type:d.RTCSessionActionType.UPDATE_QUESTION_STATE,updateQuestionState:a};h(d.ContentType.RTC_SESSION,c,function(a,c){j(a,c,b)&&b(null)})},this.openCurtain=function(a,b){b=b||y,t.debug("[ClientApiHandler]: openCurtain...");var c={type:d.RTCSessionActionType.OPEN_CURTAIN,openCurtain:a};h(d.ContentType.RTC_SESSION,c,function(a,c){j(a,c,b)&&b(null)})},this.closeCurtain=function(a,b){b=b||y,t.debug("[ClientApiHandler]: closeCurtain...");var c={type:d.RTCSessionActionType.CLOSE_CURTAIN,closeCurtain:a};h(d.ContentType.RTC_SESSION,c,function(a,c){j(a,c,b)&&b(null)})},this.getNodeState=function(a,b){b=b||y,t.debug("[ClientApiHandler]: getNodeState...");var c={type:d.RTCSessionActionType.GET_NODE_STATE,getNodeState:a};h(d.ContentType.RTC_SESSION,c,function(a,c){j(a,c,b,!0)&&b(null,c.rtcSession.getNodeState.nodeData)})},this.enableWhiteboard=function(a,b){b=b||y,t.debug("[ClientApiHandler]: enableWhiteboard...");var c={type:d.RTCSessionActionType.ENABLE_WHITEBOARD,enableWhiteboard:{rtcSessionId:a.rtcSessionId,viewbox:a.viewbox}};h(d.ContentType.RTC_SESSION,c,function(a,c){j(a,c,b,!0)&&b(null)})},this.disableWhiteboard=function(a,b){b=b||y,t.debug("[ClientApiHandler]: disableWhiteboard...");var c={type:d.RTCSessionActionType.DISABLE_WHITEBOARD,disableWhiteboard:a};h(d.ContentType.RTC_SESSION,c,function(a,c){j(a,c,b,!0)&&b(null)})},this.addWhiteboardElement=function(a,b){b=b||y,t.debug("[ClientApiHandler]: addWhiteboardElement...");var c={type:d.RTCSessionActionType.ADD_WHITEBOARD_ELEMENT,addWhiteboardElement:a};h(d.ContentType.RTC_SESSION,c,function(a,c){j(a,c,b,!0)&&b(null)})},this.removeWhiteboardElement=function(a,b){b=b||y,t.debug("[ClientApiHandler]: removeWhiteboardElement...");var c={type:d.RTCSessionActionType.REMOVE_WHITEBOARD_ELEMENT,removeWhiteboardElement:a};h(d.ContentType.RTC_SESSION,c,function(a,c){j(a,c,b,!0)&&b(null)})},this.updateWhiteboardElement=function(a,b){b=b||y,t.debug("[ClientApiHandler]: updateWhiteboardElement...");var c={type:d.RTCSessionActionType.UPDATE_WHITEBOARD_ELEMENT,updateWhiteboardElement:a};h(d.ContentType.RTC_SESSION,c,function(a,c){j(a,c,b,!0)&&b(null)})},this.clearWhiteboard=function(a,b){b=b||y,t.debug("[ClientApiHandler]: clearWhiteboard...");var c={type:d.RTCSessionActionType.CLEAR_WHITEBOARD,clearWhiteboard:a};h(d.ContentType.RTC_SESSION,c,function(a,c){j(a,c,b,!0)&&b(null)})},this.getWhiteboard=function(a,b){b=b||y,t.debug("[ClientApiHandler]: getWhiteboard...");var c={type:d.RTCSessionActionType.GET_WHITEBOARD,getWhiteboard:a};h(d.ContentType.RTC_SESSION,c,function(a,c){if(j(a,c,b)){var d=c.rtcSession.getWhiteboard.whiteboard;b(null,d)}})},this.submitClientData=function(a,b){b=b||y,t.debug("[ClientApiHandler]: submitClientData...");var c={type:d.InstrumentationActionType.SUBMIT_CLIENT_DATA,submitClientData:{instrumentationData:a}};h(d.ContentType.INSTRUMENTATION,c,function(a,c){if(j(a,c,b)){var e=c.instrumentation&&c.instrumentation.submitClientData&&c.instrumentation.submitClientData.submitDataResult;b(null,e||d.SubmitDataResult.OK)}})},this.submitQOSData=function(a,b){b=b||y,t.debug("[ClientApiHandler]: submitQOSData...");var c={type:d.InstrumentationActionType.SUBMIT_QOS_DATA,submitQOSData:{clientTime:Date.now(),dataSets:a}};h(d.ContentType.INSTRUMENTATION,c,function(a,c){j(a,c,b)&&b(null)})},this.getNotifications=function(a,b,c){c=c||y,t.debug("[ClientApiHandler]: getNotifications...");var e={type:d.ActivityStreamActionType.GET_ACTIVITIES_BY_USER,getActivitiesByUser:{timestamp:a,numberOfItems:b}};h(d.ContentType.ACTIVITYSTREAM,e,function(a,b){if(j(a,b,c,!0)){var d=b.activityStream.getActivitiesByUserResult;c(null,d)}})},this.toggleReadUnread=function(a,b,c){c=c||y,t.debug("[ClientApiHandler]: toggleReadUnread...");var e={type:d.ActivityStreamActionType.UPDATE_ACTIVITY_READ,updateActivityReadState:{activityId:a,read:b}};h(d.ContentType.ACTIVITYSTREAM,e,function(a,b){if(j(a,b,c)){var d=b.activityStream.updateResult;c(null,d.updatedItem)}})},this.markAllNotificationsAsRead=function(a){a=a||y,t.debug("[ClientApiHandler]: markAllNotificationsAsRead...");var b={type:d.ActivityStreamActionType.MARK_ALL_READ};h(d.ContentType.ACTIVITYSTREAM,b,function(b,c){if(j(b,c,a)){var d=c.activityStream.markAllReadResult;a(null,d)}})},this.getTenant=function(a){a=a||y,t.debug("[ClientApiHandler]: getTenant...");var b={type:d.AdministrationActionType.GET_TENANT};h(d.ContentType.ADMINISTRATION,b,function(b,c){j(b,c,a)&&a(null,c.administration.getTenant.tenant)})},this.addUser=function(a,b){b=b||y,t.debug("[ClientApiHandler]: addUser...");var c={type:d.AdministrationActionType.ADD_USER,addUser:{userAttributes:{emailAddress:a.emailAddress,lastName:a.lastName,firstName:a.firstName,locale:a.locale},password:a.password,packageId:a.packageId,accountTemplateId:a.accountTemplateId}},e=["request.administration.addUser.password"];h(d.ContentType.ADMINISTRATION,c,function(a,c){j(a,c,b)&&b(null,c.administration.addUserResult.user)},e)},this.addMeetingPointV2=function(a,b){b=b||y,t.debug("[ClientApiHandler]: addMeetingPointV2...");var c={type:d.AdministrationActionType.ADD_MEETING_POINT_V2,addMeetingPoint:{userAttributes:{emailAddress:a.emailAddress,lastName:a.lastName,firstName:a.firstName,locale:a.locale,location:a.location,registrationCodeTtl:a.timeout},packageId:a.packageId}},e=["response.administration.addMeetingPointV2Result.registrationCode"];h(d.ContentType.ADMINISTRATION,c,function(a,c){j(a,c,b)&&b(null,c.administration.addMeetingPointV2Result)},null,e)},this.updateMeetingPointV2=function(a,b){b=b||y,t.debug("[ClientApiHandler]: updateMeetingPointV2...");var c={type:d.AdministrationActionType.UPDATE_MEETING_POINT_V2,updateMeetingPoint:{userId:a.id,registrationCodeTtl:a.timeout}},e=["response.administration.updateMeetingPointV2Result.registrationCode"];h(d.ContentType.ADMINISTRATION,c,function(a,c){j(a,c,b)&&b(null,c.administration.updateMeetingPointV2Result.registrationCode)},null,e)},this.regenerateApiKey=function(a,b){b=b||y,t.debug("[ClientApiHandler]: regenerateApiKey...");var c={type:d.AdministrationActionType.REGENERATE_API_KEY,regenerateApiKey:{userId:a}},e=["response.administration.regenerateApiKey.apiKey"];h(d.ContentType.ADMINISTRATION,c,function(a,c){j(a,c,b)&&b(null,c.administration.regenerateApiKey.apiKey)},null,e)},this.deleteUser=function(a,b){b=b||y,t.debug("[ClientApiHandler]: deleteUser...");var c={type:d.AdministrationActionType.DELETE_USER,deleteUser:{userId:a}};h(d.ContentType.ADMINISTRATION,c,function(a,c){j(a,c,b)&&b(null)})},this.inviteUser=function(a,b){b=b||y,t.debug("[ClientApiHandler]: inviteUser...");var c={type:d.AdministrationActionType.INVITE_USER,inviteUser:{userAttributes:{emailAddress:a.userAttributes.emailAddress,lastName:a.userAttributes.lastName,firstName:a.userAttributes.firstName},packageId:a.packageId,accountTemplateId:a.accountTemplateId}};h(d.ContentType.ADMINISTRATION,c,function(a,c){j(a,c,b)&&b(null,c.administration.inviteUser.resultType)})},this.inviteMultipleUsers=function(a,b){b=b||y,t.debug("[ClientApiHandler]: inviteMultipleUsers...");var c={type:d.AdministrationActionType.INVITE_MULTIPLE_USERS,inviteMultipleUsers:a};h(d.ContentType.ADMINISTRATION,c,function(a,c){j(a,c,b)&&b(null)})},this.invitePartnerUsers=function(a,b){b=b||y,t.debug("[ClientApiHandler]: invitePartnerUsers...");var c={type:d.AdministrationActionType.INVITE_MULTIPLE_PARTNER_USERS,inviteMultiplePartnerUsers:{userAttributes:a}};h(d.ContentType.ADMINISTRATION,c,function(a,c){j(a,c,b)&&b(null)})},this.resendInvite=function(a,b){b=b||y,t.debug("[ClientApiHandler]: resendInvite...");var c={type:d.AdministrationActionType.RESEND_USER_INVITATION,resendUserInvitation:{userId:a}};h(d.ContentType.ADMINISTRATION,c,function(a,c){j(a,c,b)&&b(null,c.administration.resendUserInvitation.resultType)})},this.checkInvalidTenant=function(a,b){b=b||y,t.debug("[ClientApiHandler]: checkInvalidTenant...");var c={type:d.AdministrationActionType.CHECK_INVALID_TENANTS,checkInvalidTenants:{tenantIds:a}};h(d.ContentType.ADMINISTRATION,c,function(a,c){j(a,c,b)&&b(null,c.administration.checkInvalidTenants.tenantIds)})},this.setTelephonyTrunkData=function(a,b){b=b||y,t.debug("[ClientApiHandler]: setTelephonyTrunkData...");var c={type:d.AdministrationActionType.SET_TELEPHONY_TRUNK_DATA,setTelephonyTrunkData:{defaultCallerId:a}};h(d.ContentType.ADMINISTRATION,c,function(a,c){j(a,c,b)&&b()})},this.getTelephonyTrunkStatus=function(a){a=a||y,t.debug("[ClientApiHandler]: getTelephonyTrunkStatus...");var b={type:d.AdministrationActionType.GET_TELEPHONY_TRUNK_STATUS};h(d.ContentType.ADMINISTRATION,b,function(b,c){j(b,c,a)&&a(null,c.administration.getTelephonyTrunkStatus)})},this.getTenantBridgeNumbers=function(a){a=a||y,t.debug("[ClientApiHandler]: getTenantBridgeNumbers...");var b={type:d.AdministrationActionType.GET_TENANT_BRIDGE_NUMBERS};h(d.ContentType.ADMINISTRATION,b,function(b,c){if(j(b,c,a)){var d=c.administration.getTenantBridgeNumbers;a(null,d&&d.bridgeNumbers||[])}})},this.setTenantBridgeNumbers=function(a,b){b=b||y,t.debug("[ClientApiHandler]: setTenantBridgeNumbers...");var c={type:d.AdministrationActionType.SET_TENANT_BRIDGE_NUMBERS,setTenantBridgeNumbers:{bridgeNumbers:a}};h(d.ContentType.ADMINISTRATION,c,function(a,c){j(a,c,b)&&b()})},this.exportUserList=function(a,b){b=b||y,t.debug("[ClientApiHandler]: exportUserList..."),a&&!Array.isArray(a)&&(a=[a]);var c={type:d.AdministrationActionType.EXPORT_TENANT,exportTenant:{exportFormats:a}};h(d.ContentType.ADMINISTRATION,c,function(a,c){j(a,c,b)&&b(null)})},this.addAutoConfigurableTrunk=function(a){a=a||y,t.debug("[ClientApiHandler]: addAutoConfigurableTrunk...");var b={type:d.AdministrationActionType.ADD_TRUNK_WITHOUT_PARAMETERS};h(d.ContentType.ADMINISTRATION,b,function(b,c){j(b,c,a)&&a(null,c.administration.addTrunk.configuration)})},this.getTenantTelephonyConfiguration=function(a){a=a||y,t.debug("[ClientApiHandler]: getTenantTelephonyConfiguration...");var b={type:d.AdministrationActionType.GET_TENANT_TELEPHONY_CONFIGURATION};h(d.ContentType.ADMINISTRATION,b,function(b,c){j(b,c,a)&&a(null,c.administration.getTenantTelephonyConfiguration.configuration)})},this.getTelephonyRoutingRules=function(a,b){b=b||y,t.debug("[ClientApiHandler]: getTelephonyRoutingRules...");var c={type:d.AdministrationActionType.GET_TELEPHONY_ROUTING_RULES,getTelephonyRoutingRules:{pageSize:a.pageSize,pagePointer:a.pagePointer}};h(d.ContentType.ADMINISTRATION,c,function(a,c){j(a,c,b)&&b(null,c.administration.getTelephonyRoutingRulesResult)})},this.addTelephonyRoutingRule=function(a,b){b=b||y,t.debug("[ClientApiHandler]: addTelephonyRoutingRule...");var c={type:d.AdministrationActionType.ADD_TELEPHONY_ROUTING_RULE,addTelephonyRoutingRule:{telephonyRoutingRule:{routePosition:a.routePosition,condition1:a.condition1,gtcUserId:a.gtcUserId,operator:a.operator||void 0,condition2:a.condition2||void 0,application:a.application||void 0}}};h(d.ContentType.ADMINISTRATION,c,function(a,c){j(a,c,b)&&b(null)})},this.updateTelephonyRoutingRule=function(a,b){b=b||y,t.debug("[ClientApiHandler]: updateTelephonyRoutingRule...");var c={type:d.AdministrationActionType.UPDATE_TELEPHONY_ROUTING_RULE,updateTelephonyRoutingRule:{telephonyRoutingRule:{routePosition:a.routePosition,condition1:a.condition1,gtcUserId:a.gtcUserId,routeId:a.routeId||void 0,operator:a.operator||void 0,condition2:a.condition2||void 0,application:a.application||void 0}}};h(d.ContentType.ADMINISTRATION,c,function(a,c){j(a,c,b)&&b(null)})},this.removeTelephonyRoutingRule=function(a,b){b=b||y,t.debug("[ClientApiHandler]: removeTelephonyRoutingRule...");var c={type:d.AdministrationActionType.REMOVE_TELEPHONY_ROUTING_RULE,removeTelephonyRoutingRule:{telephonyRoutingRuleId:a}};h(d.ContentType.ADMINISTRATION,c,function(a,c){j(a,c,b)&&b(null)})},this.testTelephonyRoutingRules=function(a,b){b=b||y,t.debug("[ClientApiHandler]: testTelephonyRoutingRule...");var c={type:d.AdministrationActionType.TEST_TELEPHONY_ROUTING_RULES,testTelephonyRoutingRules:{destination:a.destination,origin:a.origin||void 0,application:a.application||void 0,considerTelephonyConnectorsStates:!!a.considerTelephonyConnectorsStates}};h(d.ContentType.ADMINISTRATION,c,function(a,c){j(a,c,b)&&b(null,c.administration.testTelephonyRoutingRulesResult)})},this.updateTenantTelephonyConfiguration=function(a,b){b=b||y,t.debug("[ClientApiHandler]: updateTenantTelephonyConfiguration...");var c={type:d.AdministrationActionType.UPDATE_TENANT_TELEPHONY_CONFIGURATION,updateTenantTelephonyConfiguration:{defaultRouting:a}};h(d.ContentType.ADMINISTRATION,c,function(a,c){j(a,c,b)&&b(null)})},this.setTrunkPassword=function(a,b,c){c=c||y,t.debug("[ClientApiHandler]: setTrunkPassword...");var e={type:d.AdministrationActionType.SET_TRUNK_PASSWORD,setTrunkPassword:{trunkId:a,password:b}},f=["request.administration.setTrunkPassword.password"];h(d.ContentType.ADMINISTRATION,e,function(a,b){j(a,b,c)&&c(null)},f)},this.setTenantSettings=function(a,b){b=b||y,t.debug("[ClientApiHandler]: setTenantSettings...");var c={type:d.AdministrationActionType.SET_TENANT_SETTINGS,setTenantSettings:{tenantSettings:a}};h(d.ContentType.ADMINISTRATION,c,function(a,c){j(a,c,b)&&b(null)})},this.updateTenantName=function(a,b){b=b||y,t.debug("[ClientApiHandler]: updateTenantName...");var c={type:d.AdministrationActionType.UPDATE_TENANT,updateTenant:{companyName:a}};h(d.ContentType.ADMINISTRATION,c,function(a,c){j(a,c,b)&&b(null)})},this.getTenantLoginProviders=function(a,b){b=b||y,t.debug("[ClientApiHandler]: getTenantLoginProviders...");var c={type:d.AdministrationActionType.GET_ALL_TENANT_LOGIN_PROVIDERS,getAllTenantLoginProviders:{tenantId:a}};h(d.ContentType.ADMINISTRATION,c,function(a,c){j(a,c,b,!0)&&b(null,c.administration.getAllTenantLoginProvidersResult.tenantLoginProvidersList||[])})},this.addTenantLoginProvider=function(a,b){b=b||y,t.debug("[ClientApiHandler]: addTenantLoginProvider...");var c={type:d.AdministrationActionType.SAVE_TENANT_LOGIN_PROVIDER,saveTenantLoginProvider:{loginProvider:a}};h(d.ContentType.ADMINISTRATION,c,function(a,c){j(a,c,b)&&b(null,c.administration.saveTenantLoginProviderResult.storedProvider)})},this.updateTenantLoginProvider=function(a,b){b=b||y,t.debug("[ClientApiHandler]: updateTenantLoginProvider...");var c={type:d.AdministrationActionType.UPDATE_TENANT_LOGIN_PROVIDER,updateTenantLoginProvider:{loginProvider:a}};h(d.ContentType.ADMINISTRATION,c,function(a,c){j(a,c,b)&&b(null,c.administration.updateTenantLoginProviderResult.updatedLoginProvider)})},this.deleteTenantLoginProvider=function(a,b){b=b||y,t.debug("[ClientApiHandler]: deleteTenantLoginProvider...");var c={type:d.AdministrationActionType.DELETE_TENANT_LOGIN_PROVIDER,deleteTenantLoginProvider:{providerId:a.providerId,tenantId:a.tenantId}};h(d.ContentType.ADMINISTRATION,c,function(a,c){j(a,c,b)&&b(null,c.administration.deleteTenantLoginProviderResult)})};this.getOpenScapeUser=function(a,b){if(b=b||y,t.debug("[ClientApiHandler]: getOpenScapeUser..."),!a)return t.warn("[ClientApiHandler]: No dn was provided"),void k(b,d.ReturnCode.INVALID_MESSAGE);var c={type:d.AdministrationActionType.GET_OPENSCAPE_USER,getOpenScapeUser:{directoryNumber:a}};h(d.ContentType.ADMINISTRATION,c,function(a,c){j(a,c,b)&&b(null,c.administration.getOpenScapeUserResult)})};this.getVacantHomeDirectoryNumbers=function(a){a=a||y,t.debug("[ClientApiHandler]: getVacantHomeDirectoryNumbers...");var b={type:d.AdministrationActionType.GET_VACANT_HOME_DIRECTORY_NUMBERS,getVacantHomeDirectoryNumbers:{}};h(d.ContentType.ADMINISTRATION,b,function(b,c){j(b,c,a)&&a(null,c.administration.getVacantHomeDirectoryNumbersResult.directoryNumbers)})},this.createOpenScapeUser=function(a,b){if(b=b||y,t.debug("[ClientApiHandler]: createOpenScapeUser..."),!a)return t.warn("[ClientApiHandler]: No user data were provided"),void k(b,d.ReturnCode.INVALID_MESSAGE);var c={type:d.AdministrationActionType.CREATE_OPENSCAPE_USER,createOpenScapeUser:{circuitUserId:a.circuitUserId,directoryNumber:a.directoryNumber,extension:a.extension,dialingPermission:a.dialingPermission,announcementsLanguage:a.announcementsLanguage,deviceDisplayLanguage:a.deviceDisplayLanguage,timeZone:a.timeZone}};h(d.ContentType.ADMINISTRATION,c,function(a,c){j(a,c,b)&&b(null,c.administration.createOpenScapeUserResult)})},this.updateOpenScapeUser=function(a,b){if(b=b||y,t.debug("[ClientApiHandler]: updateOpenScapeUser..."),!a)return t.warn("[ClientApiHandler]: No user data were provided"),void k(b,d.ReturnCode.INVALID_MESSAGE);var c={type:d.AdministrationActionType.UPDATE_OPENSCAPE_USER,updateOpenScapeUser:{directoryNumber:a.directoryNumber,extension:a.extension,dialingPermission:a.dialingPermission,announcementsLanguage:a.announcementsLanguage,deviceDisplayLanguage:a.deviceDisplayLanguage,timeZone:a.timeZone}};h(d.ContentType.ADMINISTRATION,c,function(a,c){j(a,c,b)&&b(null,c.administration.updateOpenScapeUserResult)})},this.deleteOpenScapeUser=function(a,b){if(b=b||y,t.debug("[ClientApiHandler]: deleteOpenScapeUser..."),!a||!a.userId||!a.dn)return t.warn("[ClientApiHandler]: User id or dn was not provided"),void k(b,d.ReturnCode.INVALID_MESSAGE);var c={type:d.AdministrationActionType.DELETE_OPENSCAPE_USER,deleteOpenScapeUser:{userId:a.userId,directoryNumber:a.dn}};h(d.ContentType.ADMINISTRATION,c,function(a,c){j(a,c,b)&&b(null,c.administration.deleteOpenScapeUserResult)})},this.getOpenScapeTenant=function(a){if(a=a||y,t.debug("[ClientApiHandler]: getOpenScapeTenant..."),B===w)return t.warn("[ClientApiHandler]: Cloud Telephony is working with an older backend"),void k(a,null,null);if(B<w)return t.warn("[ClientApiHandler]: Cloud Telephony is not supported by the backend"),void k(a,d.ThirdPartyError.UNSUPPORTED_PROVIDER);var b={type:d.AdministrationActionType.GET_OPENSCAPE_TENANT,getOpenScapeTenant:{}};h(d.ContentType.ADMINISTRATION,b,function(b,c){j(b,c,a)&&a(null,c.administration.getOpenScapeTenantResult.tenant)})},this.uploadExtensionConfiguration=function(a,b){b=b||y,t.debug("[ClientApiHandler]: uploadExtensionConfiguration...");var c={type:d.AdministrationActionType.UPLOAD_EXTENSION_CONFIGURATION,uploadExtensionConfiguration:{configuration:a}};h(d.ContentType.ADMINISTRATION,c,function(a,c){j(a,c,b)&&b(null,c.administration.uploadExtensionConfiguration)})},this.getTenantExtensions=function(a){a=a||y,t.debug("[ClientApiHandler]: getTenantExtensions...");var b={type:d.AdministrationActionType.GET_TENANT_EXTENSIONS};h(d.ContentType.ADMINISTRATION,b,function(b,c){j(b,c,a,!0)&&a(null,c.administration.getTenantExtensions.extensions)})},this.deleteExtension=function(a,b){b=b||y,t.debug("[ClientApiHandler]: deleteExtension...");var c={type:d.AdministrationActionType.DELETE_EXTENSION,deleteExtension:{extensionId:a}};h(d.ContentType.ADMINISTRATION,c,function(a,c){j(a,c,b)&&b(null,c.administration.deleteExtensionResult.extensionConfigurationUrl)})},this.setExtensionState=function(a,b,c){c=c||y,t.debug("[ClientApiHandler]: setExtensionState...");var e={type:d.AdministrationActionType.SET_EXTENSION_STATE,setExtensionState:{extensionId:a,state:b}};h(d.ContentType.ADMINISTRATION,e,function(a,b){j(a,b,c)&&c(null,b.administration.setExtensionStateResult.extensionConfigurationUrl)})},this.getExchangeSettings=function(a){a=a||y,t.debug("[ClientApiHandler]: getExchangeSettings...");var b={type:d.ThirdPartyConnectorsActionType.GET_SETTINGS,getSettings:{type:d.ThirdPartyConnectorType.EXCHANGE_CONNECTOR}},c=["response.thirdpartyconnectors.getSettings.exchange"];h(d.ContentType.THIRDPARTYCONNECTORS,b,function(b,c){j(b,c,a)&&a(null,c.thirdpartyconnectors.getSettings.exchange)},null,c)},this.saveExchangeSettings=function(a,b){b=b||y,t.debug("[ClientApiHandler]: saveExchangeSettings..."),A&&(a.encryptionKey=String(Date.now()));var c={type:d.ThirdPartyConnectorsActionType.SAVE_SETTINGS,saveSettings:{type:d.ThirdPartyConnectorType.EXCHANGE_CONNECTOR,exchange:a}},e=["request.thirdpartyconnectors.saveSettings.exchange"],f=["response.thirdpartyconnectors.saveSettings.exchange"];h(d.ContentType.THIRDPARTYCONNECTORS,c,function(a,c){j(a,c,b)&&b(null,c.thirdpartyconnectors.saveSettings.exchange)},e,f)},this.saveOpenXchangeSettings=function(a,b){b=b||y,t.debug("[ClientApiHandler]: saveOpenXchangeSettings...");var c={type:d.ThirdPartyConnectorsActionType.SAVE_SETTINGS,saveSettings:{type:d.ThirdPartyConnectorType.OPEN_XCHANGE,openXchange:a}},e=["request.thirdpartyconnectors.saveSettings.openXchange"],f=["response.thirdpartyconnectors.saveSettings.openXchange"];h(d.ContentType.THIRDPARTYCONNECTORS,c,function(a,c){j(a,c,b)&&b(null,c.thirdpartyconnectors.saveSettings.openXchange)},e,f)},this.connectToThirdParty=function(a,b){if(b=b||y,t.debug("[ClientApiHandler]: connectToThirdParty "+a+"..."),a===d.ThirdPartyConnectorType.ONE_DRIVE&&!this.isOneDriveSupported())return t.warn("[ClientApiHandler]: ONE_DRIVE is not supported by the backend"),void k(b,d.ThirdPartyError.UNSUPPORTED_PROVIDER);var c;switch(a){case d.ThirdPartyConnectorType.BOX:case d.ThirdPartyConnectorType.SYNCPLICITY:case d.ThirdPartyConnectorType.GOOGLE_DRIVE:case d.ThirdPartyConnectorType.ONE_DRIVE:c={type:d.ThirdPartyConnectorsActionType.CONNECT,connect:{type:a}};break;default:return void k(b,d.ThirdPartyError.UNSUPPORTED_PROVIDER)}var e=["response.thirdpartyconnectors.connect.authorizeUrl"];h(d.ContentType.THIRDPARTYCONNECTORS,c,function(a,c){j(a,c,b)&&(c.thirdpartyconnectors.connect?b(null,c.thirdpartyconnectors.connect.authorizeUrl):b(d.ThirdPartyError.UNSUPPORTED_PROVIDER))},null,e)},this.refreshConnectionToThirdParty=function(a,b,c){c=c||y,t.debug("[ClientApiHandler]: refreshConnectionToThirdParty "+a+"...");var e;switch(a){case d.ThirdPartyConnectorType.SYNCPLICITY:e={type:d.ThirdPartyConnectorsActionType.REFRESH_CONNECTION,refreshConnection:{type:a,refreshToken:b}};break;default:return void k(c,d.ThirdPartyError.UNSUPPORTED_PROVIDER)}var f=["request.thirdpartyconnectors.refreshConnection.refreshToken"],g=["response.thirdpartyconnectors.refreshConnection.accessToken","response.thirdpartyconnectors.refreshConnection.refreshToken"];h(d.ContentType.THIRDPARTYCONNECTORS,e,function(a,b){j(a,b,c)&&(b.thirdpartyconnectors.refreshConnectionResult?c(null,b.thirdpartyconnectors.refreshConnectionResult):c(d.ThirdPartyError.UNSUPPORTED_PROVIDER))},f,g)},this.getFolderItems=function(a,b){if(b=b||y,t.debug("[ClientApiHandler]: getFolderItems for ",a.provider),a.provider===d.ThirdPartyConnectorType.ONE_DRIVE&&!this.isOneDriveSupported())return t.warn("[ClientApiHandler]: ONE_DRIVE is not supported by the backend"),void k(b,d.ThirdPartyError.UNSUPPORTED_PROVIDER);var c;switch(a.provider){case d.ThirdPartyConnectorType.BOX:case d.ThirdPartyConnectorType.OPEN_XCHANGE:c={type:d.ThirdPartyConnectorsActionType.GET_FOLDER_ITEMS,getFolderItems:{type:a.provider,id:a.folderId,index:a.indexCursor,pageSize:a.pageSize}};break;case d.ThirdPartyConnectorType.GOOGLE_DRIVE:case d.ThirdPartyConnectorType.ONE_DRIVE:case d.ThirdPartyConnectorType.SYNCPLICITY:c={type:d.ThirdPartyConnectorsActionType.GET_FOLDER_ITEMS_WITH_CURSOR,getFolderItemsWithCursor:{type:a.provider,syncpointId:a.syncpointId||void 0,id:a.folderId,cursor:a.indexCursor,pageSize:a.pageSize,accessToken:a.accessToken||void 0}};break;default:return void k(b,d.ThirdPartyError.UNSUPPORTED_PROVIDER)}var e=["request.thirdpartyconnectors.getFolderItemsWithCursor.accessToken"];h(d.ContentType.THIRDPARTYCONNECTORS,c,function(c,d){j(c,d,b)&&b(null,{folder:a.folderId,items:d.thirdpartyconnectors.getFolderItemsResult})},e)},this.getConnectionStatus=function(a,b){b=b||y,t.debug("[ClientApiHandler]: getConnectionStatus "+a+"...");var c={type:d.ThirdPartyConnectorsActionType.GET_CONNECTION_STATUS,getConnectionStatus:{type:a}};h(d.ContentType.THIRDPARTYCONNECTORS,c,function(a,c){j(a,c,b)&&b(null,c.thirdpartyconnectors.getConnectionStatus.connected)})},this.disconnectFromThirdParty=function(a,b,c){if(c=c||y,t.debug("[ClientApiHandler]: disconnectFromThirdParty "+a+"..."),a===d.ThirdPartyConnectorType.ONE_DRIVE&&!this.isOneDriveSupported())return t.warn("[ClientApiHandler]: ONE_DRIVE is not supported by the backend"),void k(c,d.ThirdPartyError.UNSUPPORTED_PROVIDER);var e;switch(a){case d.ThirdPartyConnectorType.BOX:case d.ThirdPartyConnectorType.OPEN_XCHANGE:case d.ThirdPartyConnectorType.SYNCPLICITY:case d.ThirdPartyConnectorType.GOOGLE_DRIVE:case d.ThirdPartyConnectorType.ONE_DRIVE:e={type:d.ThirdPartyConnectorsActionType.DISCONNECT,disconnect:{type:a,accessToken:b||void 0}};break;default:return void k(c,d.ThirdPartyError.UNSUPPORTED_PROVIDER)}var f=["request.thirdpartyconnectors.disconnect.accessToken"];h(d.ContentType.THIRDPARTYCONNECTORS,e,function(a,b){j(a,b,c)&&c(null)},f)},this.shareFolderItems=function(a,b){if(b=b||y,!a)return void k(b,d.ReturnCode.MISSING_REQUIRED_PARAMETER);var c=a.provider,e=a.itemsData;if(t.debug("[ClientApiHandler]: shareFolderItems "+c+"..."),c===d.ThirdPartyConnectorType.ONE_DRIVE&&!this.isOneDriveSupported())return t.warn("[ClientApiHandler]: ONE_DRIVE is not supported by the backend"),void k(b,d.ThirdPartyError.UNSUPPORTED_PROVIDER);var f;switch(c){case d.ThirdPartyConnectorType.BOX:case d.ThirdPartyConnectorType.OPEN_XCHANGE:case d.ThirdPartyConnectorType.GOOGLE_DRIVE:case d.ThirdPartyConnectorType.ONE_DRIVE:case d.ThirdPartyConnectorType.SYNCPLICITY:f={type:d.ThirdPartyConnectorsActionType.SHARE_FOLDER_ITEMS,shareFolderItems:{type:c,shareItems:e,conversationId:a.convId,accessToken:a.accessToken||void 0}};break;default:return void k(b,d.ThirdPartyError.UNSUPPORTED_PROVIDER)}var g=["request.thirdpartyconnectors.shareFolderItems.accessToken"],i=["response.thirdpartyconnectors.shareFolderItems.items.[].shareLinkPassword","response.thirdpartyconnectors.shareFolderItems.items.[].downloadUrl","response.thirdpartyconnectors.shareFolderItems.items.[].previewUrl","response.thirdpartyconnectors.shareFolderItems.appKey","response.thirdpartyconnectors.shareFolderItems.accessToken"];h(d.ContentType.THIRDPARTYCONNECTORS,f,function(a,c){j(a,c,b)&&b(null,c.thirdpartyconnectors.shareFolderItems)},g,i)},this.unshareItems=function(a,b){b=b||y,t.debug("[ClientApiHandler]: ushareItems "+a.provider+"...");var c;switch(a.provider){case d.ThirdPartyConnectorType.OPEN_XCHANGE:case d.ThirdPartyConnectorType.SYNCPLICITY:c={type:d.ThirdPartyConnectorsActionType.UNSHARE_FOLDER_ITEMS,unshareFolderItems:{type:a.provider,fileId:a.itemIds,accessToken:a.accessToken||void 0}};break;default:return void k(b,d.ThirdPartyError.UNSUPPORTED_PROVIDER)}var e=["request.thirdpartyconnectors.unshareFolderItems.accessToken"];h(d.ContentType.THIRDPARTYCONNECTORS,c,function(a,c){j(a,c,b)&&b(null)},e)},this.getEditUrl=function(a,b){t.debug("[ClientApiHandler]: getEditUrl "+a.provider);var c;switch(a.provider){case d.ThirdPartyConnectorType.OPEN_XCHANGE:c={type:d.ThirdPartyConnectorsActionType.GET_EDIT_URL,getEditUrl:{externalAttachment:{type:a.provider,downloadLocation:a.uri,previewLocation:a.uri,attachment:{fileId:a.fileId,fileName:a.fileName,size:a.size,mimeType:a.mimeType}}}};break;default:return void k(b,d.ThirdPartyError.UNSUPPORTED_PROVIDER)}h(d.ContentType.THIRDPARTYCONNECTORS,c,function(a,c){j(a,c,b)&&b(null,c.thirdpartyconnectors.getEditUrlResult.url)})},this.getStorageAuthenticationData=function(a,b,c){if(c=c||y,t.debug("[ClientApiHandler]: getStorageAuthenticationData..."),a!==d.ThirdPartyConnectorType.SYNCPLICITY)return void k(c,d.ThirdPartyError.UNSUPPORTED_PROVIDER);var e={type:d.ThirdPartyConnectorsActionType.CONNECT_STORAGE,connectStorage:{type:d.ThirdPartyConnectorType.SYNCPLICITY,endpointUrls:b}};h(d.ContentType.THIRDPARTYCONNECTORS,e,function(a,b){j(a,b,c)&&c(null,b.thirdpartyconnectors.connectStorageResult.storageAuthenticationData)})},this.getGlobalProperty=function(a,b){b=b||y,t.debug("[ClientApiHandler]: getGlobalProperty...");var c={type:d.SystemActionType.GET_GLOBAL_PROPERTY,getGlobalProperty:{globalPropertyName:a}};h(d.ContentType.SYSTEM,c,function(a,c){j(a,c,b)&&b(null,c.system.getGlobalPropertyResult.property)})},this.getGlobalProperties=function(a,b){b=b||y,a instanceof Array||(a=[a]),t.debug("[ClientApiHandler]: getGlobalProperties...");var c={type:d.SystemActionType.GET_GLOBAL_PROPERTIES,getGlobalProperties:{globalPropertyNames:a}};h(d.ContentType.SYSTEM,c,function(a,c){j(a,c,b)&&b(null,c.system.getGlobalPropertiesResult.property)})},this.validateSessionInvite=function(a,b,c){c=c||y,t.debug("[ClientApiHandler]: validateSessionInvite...");
var e={type:d.GuestActionType.VALIDATE_SESSION_INVITE_TOKEN,validateSessionInviteToken:{token:{token:a},configurableTextsLanguage:b||void 0}},f=["response.guest.validateSessionInviteToken.convTopic"];h(d.ContentType.GUEST,e,function(a,b){j(a,b,c)&&c(null,b.guest.validateSessionInviteToken)},null,f)},this.registerSessionGuest=function(a,b){b=b||y,t.debug("[ClientApiHandler]: registerSessionGuest...");var c={type:d.GuestActionType.REGISTER_SESSION_GUEST,registerSessionGuest:{token:{token:a.token},firstName:a.firstName,lastName:a.lastName,forTestCall:a.testCall,locale:a.locale,userId:r||void 0,oldClientId:q||void 0,previousServer:s||void 0}},e=["response.guest.registerSessionGuestResult.guestContext"];h(d.ContentType.GUEST,c,function(a,c){if(j(a,c,b)){var d=c.guest.registerSessionGuestResult;B=g.convertVersionToNumber(d.apiVersion),s=d.connectedBackend,q=d.clientId,r=d.userId,b(null,d)}},null,e)},this.sendUserToUserRequest=function(a,b,c){c=c||y,t.debug("[ClientApiHandler]: sendUserToUserRequest, type: "+a+", data: ",b);var e={type:d.ContentType.USER_TO_USER,userToUser:{type:a,routing:{destUserId:b.destUserId,srcUserId:r,destClientId:b.destClientId,srcClientId:q},data:JSON.stringify(b.content)}},f=["request.userToUser.userToUser.data"];h(d.ContentType.USER_TO_USER,e,function(a,b){j(a,b,c)&&c(null,b.userToUser)},f)},this.getPackages=function(a){a=a||y,t.debug("[ClientApiHandler]: getPackages...");var b={type:d.AccountActionType.GET_ASSIGNED_PACKAGES};h(d.ContentType.ACCOUNT,b,function(b,c){j(b,c,a)&&a(null,c.account.getAssignedPackages.packages||[])})},this.getAccounts=function(a,b){b=b||y,t.debug("[ClientApiHandler]: getAccounts...");var c={type:d.AccountActionType.GET_ACCOUNTS,getAccounts:{searchCriterias:a.searchCriterias,sorting:a.sorting,ordering:a.ordering,searchPointer:a.searchPointer,pageSize:a.pageSize,excludedTags:a.excludedTags}},e=["response.administration.getAccounts.accounts"];h(d.ContentType.ACCOUNT,c,function(a,c){j(a,c,b)&&b(null,c.account.getAccounts)},null,e)},this.migrateAccount=function(a,b){b=b||y,t.debug("[ClientApiHandler]: migrateAccount...");var c={type:d.AccountActionType.MIGRATE_ACCOUNT,migrateAccount:{accountId:a.accountId,accountTemplateId:a.accountTemplateId}};h(d.ContentType.ACCOUNT,c,function(a,c){j(a,c,b)&&b(null,c.account.migrateAccount)})},this.migrateMultipleUsers=function(a,b){b=b||y,t.debug("[ClientApiHandler]: migrateMultipleUsers...");var c={type:d.AccountActionType.MIGRATE_MULTIPLE_USERS,migrateMultipleUsers:{accountIds:a.accountIds,accountTemplateId:a.accountTemplateId}};h(d.ContentType.ACCOUNT,c,function(a,c){j(a,c,b)&&b(null,c)})},this.suspendAccount=function(a,b){b=b||y,t.debug("[ClientApiHandler]: suspendAccount...");var c={type:d.AccountActionType.SUSPEND_ACCOUNT,suspendAccount:{accountId:a}};h(d.ContentType.ACCOUNT,c,function(a,c){j(a,c,b)&&b(null)})},this.unsuspendAccount=function(a,b){b=b||y,t.debug("[ClientApiHandler]: unsuspendAccount...");var c={type:d.AccountActionType.UNSUSPEND_ACCOUNT,unsuspendAccount:{accountId:a}};h(d.ContentType.ACCOUNT,c,function(a,c){j(a,c,b)&&b(null)})},this.suspendUser=function(a,b){b=b||y,t.debug("[ClientApiHandler]: suspendUser...");var c={type:d.AdministrationActionType.SUSPEND_USER,suspendUser:{userId:a}};h(d.ContentType.ADMINISTRATION,c,function(a,c){j(a,c,b)&&b(null)})},this.unsuspendUser=function(a,b){b=b||y,t.debug("[ClientApiHandler]: unsuspendUser...");var c={type:d.AdministrationActionType.UNSUSPEND_USER,unsuspendUser:{userId:a}};h(d.ContentType.ADMINISTRATION,c,function(a,c){j(a,c,b)&&b(null)})},this.assignTelephonyConfiguration=function(a,b,c){c=c||y,t.debug("[ClientApiHandler]: assignTelephonyConfiguration...");var e={type:d.AccountActionType.ASSIGN_TELEPHONY_CONFIGURATION,assignTelephonyConfiguration:{accountId:a,configuration:{phoneNumber:g.cleanPhoneNumber(b.phoneNumber),callerId:g.cleanPhoneNumber(b.callerId),reroutingPhoneNumber:g.cleanPhoneNumber(b.reroutingPhoneNumber),onsSipAuthenticationHash:b.onsSipAuthenticationHash||"",ondSipAuthenticationHash:b.ondSipAuthenticationHash||"",associatedTelephonyUserID:b.associatedTelephonyUserID||"",associatedTelephonyUserType:b.associatedTelephonyUserType||void 0}}},f=["request.account.assignTelephonyConfiguration.configuration.onsSipAuthenticationHash","request.account.assignTelephonyConfiguration.configuration.ondSipAuthenticationHash"];h(d.ContentType.ACCOUNT,e,function(a,b){j(a,b,c)&&c(null)},f)},this.getTechnicalAdminUserId=function(a){a=a||y,t.debug("[ClientApiHandler]: getTechnicalAdminUserId...");var b={type:d.AccountActionType.GET_TECHNICAL_ADMIN_USER_ID};h(d.ContentType.ACCOUNT,b,function(b,c){j(b,c,a)&&a(null,c.account.getTechnicalAdminUserIdResult.technicalAdminUserId)})},this.getUserData=function(a){a=a||y,t.debug("[ClientApiHandler]: getUserData...");var b={type:d.UserDataActionType.GET_USER_DATA};h(d.ContentType.USER_DATA,b,function(b,c){j(b,c,a)&&a(null,c.userData)})}}var c=a.ConnectionHandler,d=a.Constants,e=a.PrivateData,f=a.Proto,g=a.Utils;return b.prototype.constructor=b,b.prototype.name="ClientApiHandler",a.ClientApiHandler=b,a}(Circuit),Circuit=function(a){"use strict";return a.ClientApiHandlerSingleton=function(){var b;return{getInstance:function(){return b||(b=new a.ClientApiHandler),b}}}(),a}(Circuit),Circuit=function(a){"use strict";function b(a){function b(a,b){if(b){var c=window.setTimeout(function(a){e.error("[UserToUserHandler]: Timeout waiting for response. RequestId:",a),k[a]&&(delete k[a],b(d.ReturnCode.REQUEST_TIMEOUT),e.debug("[UserToUserHandler]: Remaining callbacks pending:",Object.keys(k).length))},j,a);k[a]={cb:b,timer:c}}}function g(a){a&&window.setTimeout(function(){a(d.ReturnCode.INVALID_MESSAGE)},0)}function h(a,c,h){return c&&c.content&&c.content.type?(e.debug("[UserToUserHandler]: Sending request "+a+"."+c.content.type),c.content.requestId=c.content.requestId||f.createTransactionId(),k[c.content.requestId]?(e.error("[UserToUserHandler]: UserToUser request has duplicate requestId"),void g(h)):void m.sendUserToUserRequest(a,c,function(f){return f?(e.error("[UserToUserHandler]: Failed to send request: ",f),void(h&&h(f))):void(a===d.UserRoutingMessageType.SDK?h&&h():b(c.content.requestId,h))})):(e.error("[UserToUserHandler]: Invalid UserToUser request data - ",c),void g(h))}function i(a,b){try{if(b.routing&&b.routing.srcClientId===m.clientId)return void e.info("[UserToUserHandler]: Ignore own UserToUser event");var c;try{c=JSON.parse(b.data)}catch(a){return void e.error("[UserToUserHandler]: Event discarded (Cannot Parse)")}if(c.requestId){var f=k[c.requestId];if(f)return f.timer&&window.clearTimeout(f.timer),delete k[c.requestId],f.cb&&f.cb(null,c),void e.debug("[UserToUserHandler]: Remaining callbacks pending:",Object.keys(k).length);var g=a+"."+c.type,h=l[g];h&&0!==h.length?(a===d.UserRoutingMessageType.SDK&&(c=c.message),h.forEach(function(a){a.cb(c,b.routing)})):e.info("[UserToUserHandler]: There is no registered event handler for ",g)}}catch(a){e.error("[UserToUserHandler]: Exception handling UserToUser event. ",a)}}var j=2e4,k={},l={},m=a||c.getInstance();m.on("UserToUser.ATC",function(a){e.debug("[UserToUserHandler]: Received UserToUser.ATC event: ",a.data),i(d.UserRoutingMessageType.ATC,a)}),m.on("UserToUser.DESKTOP_APP",function(a){e.debug("[UserToUserHandler]: Received UserToUser.DESKTOP_APP event: ",a.data),i(d.UserRoutingMessageType.DESKTOP_APP,a)}),m.on("UserToUser.CONTACT_CARD",function(a){e.debug("[UserToUserHandler]: Received UserToUser.CONTACT_CARD event: ",a.data),i(d.UserRoutingMessageType.CONTACT_CARD,a)}),m.on("UserToUser.CMP",function(a){e.debug("[UserToUserHandler]: Received UserToUser.CMP event: ",a.data),i(d.UserRoutingMessageType.CMP,a)}),m.on("UserToUser.MOBILE_BREAKOUT",function(a){e.debug("[UserToUserHandler]: Received UserToUser.MOBILE_BREAKOUT event: ",a.data),i(d.UserRoutingMessageType.MOBILE_BREAKOUT,a)}),m.on("UserToUser.SDK",function(a){e.debug("[UserToUserHandler]: Received UserToUser.SDK event: ",a.data),i(d.UserRoutingMessageType.SDK,a)}),this.cancelReqCallback=function(a){var b=k[a];b&&(b.cb=null)},this.sendAtcRequest=function(a,b){h(d.UserRoutingMessageType.ATC,a,b)},this.sendContactCardRequest=function(a,b){h(d.UserRoutingMessageType.CONTACT_CARD,a,b)},this.sendDesktopAppRequest=function(a,b){h(d.UserRoutingMessageType.DESKTOP_APP,a,b)},this.sendMeetingPointRequest=function(a,b){h(d.UserRoutingMessageType.CMP,a,b)},this.sendMobileBreakoutEvent=function(a,b){h(d.UserRoutingMessageType.MOBILE_BREAKOUT,a,b)},this.sendSdkRequest=function(a,b){a&&a.content&&delete a.content.requestId,h(d.UserRoutingMessageType.SDK,a,b)},this.on=function(a,b){if(a&&"function"==typeof b){l[a]=l[a]||[];var c=l[a].some(function(a){return a.cb===b});c||l[a].push({cb:b})}},this.off=function(a,b){if(a||b)if(b){if(a&&"function"==typeof b){var c=l[a];c&&c.some(function(a,d){if(a.cb===b)return c.splice(d,1),!0})}}else delete l[a];else l={}}}var c=a.ClientApiHandlerSingleton,d=a.Constants,e=a.logger,f=a.Utils,g=Object.freeze({CSTA:"CSTA",PRIMARYCLIENT:"PRIMARYCLIENT",INFO:"INFO"}),h=Object.freeze({GET_GTC_VERSION_REQUEST:"GET_GTC_VERSION_REQUEST",GET_GTC_VERSION_RESPONSE:"GET_GTC_VERSION_RESPONSE",SET_ROUTE_TO_DESK:"SET_ROUTE_TO_DESK"}),i=Object.freeze({CLICK_TO_CALL_REQUEST:"CLICK_TO_CALL_REQUEST",CLICK_TO_CALL_RESPONSE:"CLICK_TO_CALL_RESPONSE",MUTE_DEVICE_REQUEST:"MUTE_DEVICE_REQUEST",MUTE_DEVICE_RESPONSE:"MUTE_DEVICE_RESPONSE",JOIN_CONFERENCE_REQUEST:"JOIN_CONFERENCE_REQUEST",JOIN_CONFERENCE_RESPONSE:"JOIN_CONFERENCE_RESPONSE"}),j=Object.freeze({OK:"OK",BUSY:"BUSY",TELEPHONY_NOT_AVAILABLE:"TELEPHONY_NOT_AVAILABLE",USER_NOT_FOUND:"USER_NOT_FOUND",CONVERSATION_NOT_FOUND:"CONVERSATION_NOT_FOUND",CALL_DECLINED:"CALL_DECLINED",CALL_FAILED:"CALL_FAILED",CALL_NOT_FOUND:"CALL_NOT_FOUND",MUTE_DEVICE_FAILED:"MUTE_DEVICE_FAILED",JOIN_CONFERENCE_FAILED:"JOIN_CONFERENCE_FAILED"}),k=Object.freeze({INVITE_REQUEST:"INVITE_REQUEST",INVITE_RESPONSE:"INVITE_RESPONSE",MUTE_REQUEST:"MUTE_REQUEST",MUTE_RESPONSE:"MUTE_RESPONSE",UNMUTE_REQUEST:"UNMUTE_REQUEST",UNMUTE_RESPONSE:"UNMUTE_RESPONSE",GET_MEETINGPOINT_INVITER_REQUEST:"GET_MEETINGPOINT_INVITER_REQUEST",GET_MEETINGPOINT_INVITER_RESPONSE:"GET_MEETINGPOINT_INVITER_RESPONSE",TOGGLE_VIDEO_REQUEST:"TOGGLE_VIDEO_REQUEST",TOGGLE_VIDEO_RESPONSE:"TOGGLE_VIDEO_RESPONSE",START_HD_VIDEO_REQUEST:"START_HD_VIDEO_REQUEST",START_HD_VIDEO_RESPONSE:"START_HD_VIDEO_RESPONSE"}),l=Object.freeze({OK:"OK",FAILED:"FAILED",MISSING_REQUIRED_PARAMETER:"MISSING_REQUIRED_PARAMETER",NOT_FOUND:"NOT_FOUND",NOT_CMP_USER:"NOT_CMP_USER",NOT_SUPPORTED:"NOT_SUPPORTED",INVITE_FAILED:"INVITE_FAILED",MUTE_FAILED:"MUTE_FAILED",UNMUTE_FAILED:"UNMUTE_FAILED",INVALID_PIN:"INVALID_PIN",MEETINGPOINT_BUSY:"MEETINGPOINT_BUSY",TOGGLE_VIDEO_FAILED:"START_VIDEO_FAILED"}),m=Object.freeze({DIAL:"DIAL"});return b.prototype.constructor=b,b.prototype.name="UserToUserHandler",a.UserToUserHandler=b,a.Enums=a.Enums||{},a.Enums.AtcInfoMessage=h,a.Enums.AtcMessage=g,a.Enums.ContactCardMessage=i,a.Enums.ContactCardResponseCode=j,a.Enums.MeetingPointMessage=k,a.Enums.MeetingPointResponseCode=l,a.Enums.MobileBreakoutMessage=m,a}(Circuit),Circuit=function(a){"use strict";return a.UserToUserHandlerSingleton=function(){var b;return{getInstance:function(){return b||(b=new a.UserToUserHandler),b}}}(),a}(Circuit),Circuit=function(a){"use strict";function b(){function a(a){return{connectionId:a.cIr,localCallState:a.lCS.cCSe&&a.lCS.cCSe.lCSe}}function b(a){return{deviceOnCall:a.dOC.dIr||"",callIdentifier:a.cI,localConnectionState:a.lCI,servicesPermitted:h(a)}}function d(a){if(!a.CSTAErrorCode)return c.error("[CstaParser]: The given response is not an error code: ",a),null;var b=null,d=Object.keys(a.CSTAErrorCode)[0];switch(d){case"oprt":case"operation":b="Operation Error";break;case"scrt":case"security":b="Security Error";break;case"sIy":case"stateIncompatibility":b="State Incompatibility Error";break;case"sRAy":case"systemResourceAvailability":b="System Resource Availability Error";break;case"sRA":case"subscribedResourceAvailability":b="Subscribed Resource Availability Error";break;case"pM":case"performanceManagement":b="Performance Management Error";break;case"pDa":case"privateDataInformation":b="Private Data Information Error"}return b?{error:!0,errorCategory:b,errorValue:a.CSTAErrorCode[d]}:(c.error("[CstaParser]: Unrecognized Error Category"),{error:!0,category:"Unknown",value:"Unknown"})}function e(a){if(!a.ISEC)return c.error("[CstaParser]: The given response is not an internal service error code: ",a),null;var b=null,d=Object.keys(a.ISEC)[0];switch(d){case"code":b="Code"}return b?{error:!0,errorCategory:b,errorValue:a.ISEC[d]}:(c.error("[CstaParser]: Unrecognized Internal Service Error Category"),{error:!0,category:"Unknown",value:"Unknown"})}function f(a){var b=null;return a&&a.extn&&a.extn.pDa&&a.extn.pDa.prvt&&(b=a.extn.pDa.prvt.zEpid),b}function g(a){a&&Object.keys(a).forEach(function(b){a[b]=""===a[b]||"true"===a[b]})}function h(a){if(!a)return{};var b={};return a.sP&&(b.rSP=a.sP,g(b.rSP.cCSs)),a.extn&&a.extn.pDa&&a.extn.pDa.prvt&&void 0!==a.extn.pDa.prvt.zxSP&&(b.eSP=a.extn.pDa.prvt.zxSP,g(b.eSP)),b}function i(a){return c.debug("[CstaParser]: Received CSTA Alternate Call response: ",a),a.ACRe}function j(a){return c.debug("[CstaParser]: Received CSTA Answer Call response: ",a),a.AnCR}function k(a){return c.debug("[CstaParser]: Received CSTA Accept Call response: ",a),a.ACR}function l(a){return c.debug("[CstaParser]: Received CSTA Clear Connection response: ",a),a.ClCR}function m(a){return c.debug("[CstaParser]: Received CSTA Deflect Call response: ",a),a.DCRe}function n(a){return c.debug("[CstaParser]: Received CSTA Generate Digits response: ",a),a.GDR}function o(a){c.debug("[CstaParser]: Received CSTA Get Do Not Disturb response: ",a);var b=a.GDNDe,d={doNotDisturbOn:"true"===b.dNDO};return d}function p(a){return{forwardingType:a.fTe,forwardStatus:"true"===a.fS,forwardDN:a.fDNN}}function q(a){if(c.debug("[CstaParser]: Received CSTA Get Forwarding response: ",a),a.GetForwardingResponse)return r(a.GetForwardingResponse);var b=a.GFR,d={forwardList:[]};return b.fL.fLI.fS?d.forwardList.push(p(b.fL.fLI)):b.fL.fLI.forEach(function(a){d.forwardList.push(p(a))}),b.extn&&b.extn.pDa&&b.extn.pDa.prvt&&(d.staticOndDN=b.extn.pDa.prvt.zsOD,d.staticOndActive="true"===b.extn.pDa.prvt.zsOA),d}function r(a){var b={forwardList:[]};return a.forwardingList.forwardListItem.forwardStatus?(a.forwardingList.forwardListItem.forwardStatus="true"===a.forwardingList.forwardListItem.forwardStatus,b.forwardList.push(a.forwardingList.forwardListItem)):a.forwardingList.forwardListItem.forEach(function(a){a.forwardStatus="true"===a.forwardStatus,b.forwardList.push(a)}),a.extensions&&a.extensions.privateData&&a.extensions.privateData.private&&(b.staticOndDN=a.extensions.privateData.private.staticOndDN,b.staticOndActive="true"===a.extensions.privateData.private.staticOndActive),b}function s(a){c.debug("[CstaParser]: Received CSTA Get Message Waiting response: ",a);var b=a.GMWIe,d={messageWaitingOn:"true"===b.mWO};return d}function t(a){return c.debug("[CstaParser]: Received CSTA Hold Call response: ",a),a.HCR}function u(a){return c.debug("[CstaParser]: Received CSTA Reconnect Call response: ",a),a.RCR}function v(a){return c.debug("[CstaParser]: Received CSTA Retrieve Call response: ",a),a.RCRe}function w(a){return c.debug("[CstaParser]: Received CSTA Set Do Not Disturb response: ",a),a.SDNDe}function x(a){return c.debug("[CstaParser]: Received CSTA Set Forwarding response: ",a),a.hasOwnProperty("SFR")?a.SFR:a.SetForwardingResponse}function y(a){return c.debug("[CstaParser]: Received CSTA Consultation Call response: ",a),a.CnCR}function z(a){return c.debug("[CstaParser]: Received CSTA Call Back call related response: ",a),a.CBR}function A(a){return c.debug("[CstaParser]: Received CSTA Call Back non call related response: ",a),a.CBNCe}function B(a){return c.debug("[CstaParser]: Received CSTA Cancel Call Back response: ",a),a.CCBR}function C(a){c.debug("[CstaParser]: Received CSTA Snapshot Call response: ",a);var d=a.SCR,e={endpoints:[],callingDevice:d.caD&&d.caD.dIR||"",calledDevice:d.cDe&&d.cDe.dIR||"",servicesPermitted:{}};return d.cRID.sDa.sCRIo&&(d.cRID.sDa.sCRIo.dOC?e.endpoints.push(b(d.cRID.sDa.sCRIo)):d.cRID.sDa.sCRIo.forEach(function(a){e.endpoints.push(b(a))})),e.servicesPermitted=h(d),e.epid=f(d),e}function D(b){c.debug("[CstaParser]: Received CSTA Snapshot Device response: ",b);var d=b.SnDR,e={activeCalls:[]};return d.cRID.sDa.sDRI&&(d.cRID.sDa.sDRI.cIr?e.activeCalls.push(a(d.cRID.sDa.sDRI)):d.cRID.sDa.sDRI.forEach(function(b){e.activeCalls.push(a(b))})),e}function E(a){c.debug("[CstaParser]: Received CSTA SST Call response: ",a);var b=a.SSTCe,d={transferredCall:b.trC};return b.extn&&b.extn.pDa&&b.extn.pDa.prvt&&(d.seamlessHandover="true"===b.extn.pDa.prvt.zseHo),d}function F(a){c.debug("[CstaParser]: Received CSTA Conference Call response: ",a);var b=a.CoCR,d={conferenceCall:b.coC};return d}function G(a){c.debug("[CstaParser]: Received CSTA TransferCall response: ",a);var b=a.TCR,d={transferredCall:b.trC};return d}function H(a){c.debug("[CstaParser]: Received CSTA SetMicrophoneMute response",a);var b=a.SMMR,d={mute:"true"===b.mML.mMI.mMO};return d}function I(a){c.debug("[CstaParser]: Received CSTA GetMicrophoneMute response",a);var b=a.GMMR,d={mute:"true"===b.mML.mMI.mMO};return d}function J(a){return c.debug("[CstaParser]: Received CSTA MakeCall response",a),a.MCR}function K(a){return c.debug("[CstaParser]: Received CSTA Call Log Snap Shot response: ",a),a.CLSR}function L(a){var b=a.CIE,c={category:"CallAssociatedFeature",name:"CallInformationEvent",connection:b.cnncn,device:b.dvc.dIr||"",callingDevice:b.caD&&b.caD.dIr||"",servicesPermitted:{}};return c.servicesPermitted=h(b),c.epid=f(b),c}function M(a){var b=a.CoE,c={category:"CallControl",name:"ConferencedEvent",primaryOldCall:b.pOC,secondaryOldCall:b.sOC,conferencingDevice:b.coD.dIr||"",addedParty:b.aPy.dIr||"",conferenceConnections:[],localConnectionInfo:b.lCI,cause:b.cs,servicesPermitted:{}};return b.cnC.cLI.forEach(function(a){var b={connection:a.nCn,endpoint:a.endp&&(a.endp.dID||a.endp.endp)};c.conferenceConnections.push(b)}),c.servicesPermitted=h(b),c.epid=f(b),c}function N(a){var b=a.CCEt,c={category:"CallControl",name:"ConnectionClearedEvent",droppedConnection:b.drC,releasingDevice:b.rD.dIr||"",localConnectionInfo:b.lCI,cause:b.cs,servicesPermitted:{}};return c.servicesPermitted=h(b),c.epid=f(b),c}function O(a){var b=a.DE,c={category:"CallControl",name:"DeliveredEvent",connection:b.cnncn,alertingDevice:b.aDe.dIr||"",callingDevice:b.caD.dIr||"",calledDevice:b.cDe.dIr||"",localConnectionInfo:b.lCI,cause:b.cs};return c.servicesPermitted=h(b),c.epid=f(b),c}function P(a){var b=a.DGE,c={category:"CallAssociatedFeature",name:"DigitsGeneratedEvent",connection:b.cnncn,digitGeneratedList:b.dGL};return c}function Q(a){var b=a.DEt,c={category:"CallControl",name:"DivertedEvent",connection:b.cnncn,divertingDevice:b.dvD.dIr||"",newDestination:b.nD.dIr||"",localConnectionInfo:b.lCI,cause:b.cs};return c.servicesPermitted=h(b),c.epid=f(b),c}function R(a){var b=a.DNDE,c={category:"LogicalDeviceFeature",name:"DoNotDisturbEvent",device:b.dvc.dIr||"",doNotDisturbOn:"true"===b.dNDO};return c}function S(a){var b=a.EEt,c={category:"CallControl",name:"EstablishedEvent",establishedConnection:b.eCn,answeringDevice:b.anD.dIr||"",callingDevice:b.caD.dIr||"",calledDevice:b.cDe.dIr||"",localConnectionInfo:b.lCI,cause:b.cs,servicesPermitted:{}};return c.servicesPermitted=h(b),c.epid=f(b),c}function T(a){var b=a.FE,c={category:"CallControl",name:"FailedEvent",failedConnection:b.fC,failingDevice:b.fD.dIr||"",callingDevice:b.caD.dIr||"",localConnectionInfo:b.lCI,calledDevice:b.cDe.dIr,cause:b.cs,servicesPermitted:{}};return c.servicesPermitted=h(b),c.epid=f(b),c}function U(a){var b=a.FEt,c={category:"LogicalDeviceFeature",name:"ForwardingEvent",device:b.dvc.dIr||"",forwardingType:b.fTe,forwardStatus:"true"===b.fS,forwardTo:b.fTo};return b.extn&&b.extn.pDa&&b.extn.pDa.prvt&&b.extn.pDa.prvt.zsOA&&(c.staticOndDN=b.extn.pDa.prvt.zsOD,c.staticOndActive="true"===b.extn.pDa.prvt.zsOA),c}function V(a){var b=a.HE,c={category:"CallControl",name:"HeldEvent",heldConnection:b.hCn,holdingDevice:b.hD.dIr||"",localConnectionInfo:b.lCI,servicesPermitted:{}};return c.servicesPermitted=h(b),c.epid=f(b),c}function W(a){var b=a.MWE,c={category:"PhysicalDeviceFeature",name:"MessageWaitingEvent",device:b.tD.dIr||"",messageWaitingOn:"true"===b.mWO};return c}function X(a){var b=a.OE,c={category:"CallControl",name:"OfferedEvent",offeredConnection:b.oCn,offeredDevice:b.oDe.dIr||"",callingDevice:b.caD.dIr||"",calledDevice:b.cDe.dIr||"",localConnectionInfo:b.lCI,lastRedirectionDevice:b.lRD?b.lRD.nDd||"":"",cause:b.cs};return c.servicesPermitted=h(b),c.epid=f(b),c}function Y(a){var b=a.QE,c={category:"CallControl",name:"QueuedEvent",queuedConnection:b.qC,queue:b.q.dIr||"",callingDevice:b.caD.dIr||"",localConnectionInfo:b.lCI};return c.servicesPermitted=h(b),c.epid=f(b),c}function Z(a){var b=a.ReE,c={category:"CallControl",name:"RetrievedEvent",retrievedConnection:b.rCn,retrievingDevice:b.reD.dIr||"",localConnectionInfo:b.lCI,servicesPermitted:{}};return c.servicesPermitted=h(b),c.epid=f(b),c}function $(a){var b=a.SCFE,c={category:"CallAssociatedFeature",name:"ServiceCompletionFailureEvent",primaryCall:{connectionID:b.prC.cIDD,localConnectionState:b.prC.lCSe},cause:b.cs};return b.sC&&(c.secondaryCall={connectionID:b.sC.cIDD,localConnectionState:b.sC.lCSe}),c}function _(a){var b=a.SIE,c={category:"CallControl",name:"ServiceInitiatedEvent",initiatedConnection:b.iCn,initiatingDevice:b.iD.dIr||"",cause:b.cs};return c.servicesPermitted=h(b),c.epid=f(b),c}function aa(a){var b=a.CBE,c={category:"LogicalDeviceFeature",name:"CallBackEvent",originatingDevice:b.orD.dIr,targetDevice:b.tD.dIr,callBackSetCanceled:b.cBSC};return c}function ba(a){var b=a.TE,c={category:"CallControl",name:"TransferredEvent",primaryOldCall:b.pOC,secondaryOldCall:b.sOC,transferringDevice:b.tDe.dIr||"",transferredToDevice:b.tTDe.dIr||"",transferredConnections:[],localConnectionInfo:b.lCI,cause:b.cs,servicesPermitted:{}};return b.tCs.cLI.forEach(function(a){var b={connection:a.nCn,endpoint:a.endp&&(a.endp.dID||a.endp.endp)};c.transferredConnections.push(b)}),c.servicesPermitted=h(b),c.epid=f(b),c}function ca(a){return{recordId:a.rID,callID:a.cID,recordType:a.rTp,createdTime:a.cTm,result:a.res,callDuration:a.cDr,callingDevice:a.clDv||"",calledDevice:a.cldDv||"",answeringDevice:a.aDv||""}}function da(a){var b=a.CLE,c={category:"LogicalDeviceFeature",name:"CallLogEvent",callLogList:[]};return b.cLL&&b.cLL.cLE&&(b.cLL.cLE.rID?c.callLogList.push(ca(b.cLL.cLE)):b.cLL.cLE.forEach(function(a){c.callLogList.push(ca(a))})),c}function ea(a){var b=a.BISE;return{category:"DeviceMaintenance",name:"BackInServiceEvent",backInService:!0,device:b.dvc}}function fa(a){var b=a.OOSE;return{category:"DeviceMaintenance",name:"OutOfServiceEvent",outOfService:!0,device:b.dvc}}function ga(a){return{ACl:{hC:{cID:a.heldCall.cID,dID:a.heldCall.dID},atC:{cID:a.activeCall.cID,dID:a.activeCall.dID}}}}function ha(a){return{CoC:{hC:{cID:a.heldCall.cID,dID:a.heldCall.dID},atC:{cID:a.activeCall.cID,dID:a.activeCall.dID}}}}function ia(a){return{AnC:{cTBAd:{cID:a.callToBeAnswered.cID,dID:a.callToBeAnswered.dID}}}}function ja(a){return{AC:{cTBA:{cID:a.callToBeAccepted.cID,dID:a.callToBeAccepted.dID}}}}function ka(a){return{MC:{caD:a.callingDevice,cDN:a.calledDirectoryNumber,aOe:a.autoOriginate}}}function la(a){return{CCn:{coTBC:{cID:a.connectionToBeCleared.cID,dID:a.connectionToBeCleared.dID},rsn:a.reason}}}function ma(a){var b={cTBD:{cID:a.callToBeDiverted.cID,dID:a.callToBeDiverted.dID},nD:a.newDestination};return a.autoAnswer&&(b.extn={pDa:{prvt:{zdT:"Auto-Answer"}}}),{DCl:b}}function na(a){return{GD:{cTSD:{cID:a.connectionToSendDigits.cID,dID:a.connectionToSendDigits.dID},cTS:a.charactersToSend}}}function oa(a){return{GDND:{dvc:a.device}}}function pa(a){return{GF:{dvc:a.device}}}function qa(a){return{GMWI:{dvc:a.device}}}function ra(a){return{HC:{cTBH:{cID:a.callToBeHeld.cID,dID:a.callToBeHeld.dID}}}}function sa(a){return{RC:{hC:{cID:a.heldCall.cID,dID:a.heldCall.dID},atC:{cID:a.activeCall.cID,dID:a.activeCall.dID}}}}function ta(a){return{RCl:{cTBRd:{cID:a.callToBeRetrieved.cID,dID:a.callToBeRetrieved.dID}}}}function ua(a){return{SDND:{dvc:a.device,dNDO:a.doNotDisturbOn}}}function va(a){var b={SF:{dvc:a.device,aF:a.activateForward,fDNN:a.forwardDN,fTe:a.forwardingType,riC:a.ringCount}};if(a.hasOwnProperty("staticOndActive")&&void 0!==a.staticOndActive){var c={zsOA:a.staticOndActive===!0?"true":"false",zsOD:a.staticOndDN||""};b.SF.extn={pDa:{prvt:c}}}return b}function wa(a){return{SMM:{dvc:a.device,mMO:a.mute}}}function xa(a){return{GMM:{dvc:a.device}}}function ya(a){return{SC:{sO:{cID:a.snapshotObject.cID,dID:a.snapshotObject.dID}}}}function za(a){var b={sO:a.snapshotObject};return a.osmo&&(b.extn={pDa:{prvt:{zxsm:a.osmo}}}),{SDe:b}}function Aa(a){var b={atC:{cID:a.activeCall.cID,dID:a.activeCall.dID},tTo:a.transferredTo};if(a.autoAnswer||a.seamlessHandover){var c={};a.autoAnswer&&(c.ztTgt="Auto-Answer"),a.seamlessHandover&&(c.zseHo="true"),b.extn={pDa:{prvt:c}}}return{SSTC:b}}function Ba(a){return{CnC:{cnD:a.consultedDevice,eCl:{cID:a.existingCall.cID,dID:a.existingCall.dID}}}}function Ca(a){return{CB:{cC:{cID:a.callBackConnection.cID,dID:a.callBackConnection.dID}}}}function Da(a){return{CBNC:{orD:a.orD,tD:a.tD}}}function Ea(a){return{CCB:{orD:a.orD,tD:a.tD}}}function Fa(a){return{TC:{hC:{cID:a.heldCall.cID,dID:a.heldCall.dID},atC:{cID:a.activeCall.cID,dID:a.activeCall.dID}}}}function Ga(){return{zGCD:{zcCA:"Internet",zdMO:"Chrome",zdOS:"WebRTC"}}}function Ha(a){return{CLS:{sub:a.device}}}this.genCstaRequest=function(a){try{switch(a.request){case"AlternateCall":return ga(a);case"ConferenceCall":return ha(a);case"AnswerCall":return ia(a);case"CallBackCallRelated":return Ca(a);case"CallBackNonCallRelated":return Da(a);case"CancelCallBack":return Ea(a);case"ClearConnection":return la(a);case"ConsultationCall":return Ba(a);case"DeflectCall":return ma(a);case"GenerateDigits":return na(a);case"GetDoNotDisturb":return oa(a);case"GetForwarding":return pa(a);case"GetMessageWaitingIndicator":return qa(a);case"HoldCall":return ra(a);case"ReconnectCall":return sa(a);case"RetrieveCall":return ta(a);case"SetDoNotDisturb":return ua(a);case"SetForwarding":return va(a);case"SingleStepTransferCall":return Aa(a);case"SnapshotCall":return ya(a);case"SnapshotDevice":return za(a);case"TransferCall":return Fa(a);case"GenGetConfiguration":return Ga();case"SetMicrophoneMute":return wa(a);case"GetMicrophoneMute":return xa(a);case"MakeCall":return ka(a);case"CallLogSnapShot":return Ha(a);case"AcceptCall":return ja(a)}c.error("CSTA: Unsupported CSTA request: "+a.request)}catch(a){c.error(a)}return null},this.parseEvent=function(a){try{if(!a)return c.error("[CstaParser]: Invalid event"),null;var b=JSON.parse(a);if(!b||b.parsererror)return c.error("[CstaParser]: Error parsing CSTA event: ",a),b&&b.parsererror.div&&c.error("[CstaParser]: "+b.parsererror.div),null;var d=Object.keys(b)[0];switch(d){case"CBE":return aa(b);case"CIE":return L(b);case"CoE":return M(b);case"CCEt":return N(b);case"DE":return O(b);case"DGE":return P(b);case"DEt":return Q(b);case"DNDE":return R(b);case"EEt":return S(b);case"FE":return T(b);case"FEt":return U(b);case"HE":return V(b);case"MWE":return W(b);case"OE":return X(b);case"QE":return Y(b);case"ReE":return Z(b);case"SCFE":return $(b);case"SIE":return _(b);case"TE":return ba(b);case"CLE":return da(b);case"BISE":return ea(b);case"OOSE":return fa(b)}c.info("[CstaParser]: Unsupported CSTA event: ",d)}catch(a){c.error("[CstaParser]: Error parsing CSTA event: ",a)}return null},this.parseResponse=function(a,b){try{if(!a||!b)return c.error("[CstaParser]: Invalid response"),null;var f=JSON.parse(b);if(!f||f.parsererror)return c.error("[CstaParser]: Error parsing CSTA response: ",b),f&&f.parsererror.div&&c.error("[CstaParser]: "+f.parsererror.div),null;if(f.CSTA&&(f.CSTAErrorCode=f.CSTA),f.CSTAErrorCode)return c.debug("[CstaParser]: Received error response for: ",a),d(f);if(f.ISEC)return c.debug("[CstaParser]: Received internal service error response for: ",a),e(f);switch(a){case"AlternateCall":return i(f);case"ConferenceCall":return F(f);case"AnswerCall":return j(f);case"CallBackCallRelated":return z(f);case"CallBackNonCallRelated":return A(f);case"CancelCallBack":return B(f);case"ClearConnection":return l(f);case"ConsultationCall":return y(f);case"DeflectCall":return m(f);case"GenerateDigits":return n(f);case"GetDoNotDisturb":return o(f);case"GetForwarding":return q(f);case"GetMessageWaitingIndicator":return s(f);case"HoldCall":return t(f);case"ReconnectCall":return u(f);case"RetrieveCall":return v(f);case"SetDoNotDisturb":return w(f);case"SetForwarding":return x(f);case"SingleStepTransferCall":return E(f);case"SnapshotCall":return C(f);case"SnapshotDevice":return D(f);case"TransferCall":return G(f);case"SetMicrophoneMute":return H(f);case"GetMicrophoneMute":return I(f);case"MakeCall":return J(f);case"CallLogSnapShot":return K(f);case"AcceptCall":return k(f)}c.error("CSTA: Unsupported CSTA response for request: ",a)}catch(a){c.error(a)}return null}}var c=Circuit.logger;return a.CstaParser=b,a}(Circuit),Circuit=function(a){"use strict";function b(){function a(a,b){a=a||function(){};var c=++s,f=window.setTimeout(function(){r[c]&&(e.error("[ExtensionConnHandler]: Timeout waiting for response. reqId:",c),delete r[c],a(d.ResponseError.TIMEOUT))},b||m);return r[c]={cb:a,timer:f},c}function c(a){return!(!a||!r[a])&&(delete r[a],!0)}function g(a){var b;if(a.target===d.BgTarget.INTERNAL)switch(a.data.type){case d.BgInternalMsgType.INIT_MSG:e.info("[ExtensionConnHandler]: Received INIT_MSG. Send an INIT_MSG_ACK to the extension."),t=!0,i({target:d.BgTarget.INTERNAL,data:{type:d.BgInternalMsgType.INIT_MSG_ACK}}),e.info("[ExtensionConnHandler]: Dispatching event: extensionInitialized"),b=q.createEvent("extensionInitialized"),b.data=a.data,q.dispatch(b);break;case d.BgInternalMsgType.EXTENSION_DISCONNECTED:e.warning("[ExtensionConnHandler]: Received EXTENSION_DISCONNECTED from ansible-content"),k();break;default:e.warning("[ExtensionConnHandler]: Received unknown INTERNAL msg type from ansible-content:",a.data.type)}else if(a.target===d.BgTarget.HEADSET_APP)switch(a.data.type){case d.BgHeadsetAppMsgType.HEADSET_APP_LAUNCHED:e.info("[ExtensionConnHandler]: Dispatching event: headsetAppLaunched"),b=q.createEvent("headsetAppLaunched"),b.data=a.data,q.dispatch(b);break;case d.BgHeadsetAppMsgType.HEADSET_APP_UNINSTALLED:e.info("[ExtensionConnHandler]: Dispatching event: headsetAppUninstalled"),b=q.createEvent("headsetAppUninstalled"),b.data=a.data,q.dispatch(b);break;default:e.warning("[ExtensionConnHandler]: Received unknown HEADSET_APP msg type from ansible-content:",a.data.type)}else a.suppressLog||e.info("[ExtensionConnHandler]: Dispatching event:",a.target),b=q.createEvent(a.target),b.data=a.data,b.suppressLog=a.suppressLog,a.reqId&&a.type===d.BgMsgType.REQUEST&&(b.reqId=a.reqId),q.dispatch(b)}function h(a){if(r[a.reqId]){var b=r[a.reqId];b.timer&&window.clearTimeout(b.timer),delete r[a.reqId],a.data&&a.data.error?(b.cb(a.data.error),a.data.error===d.ResponseError.UNREGISTERED&&k()):b.cb(null,a.data),a.suppressLog||e.debug("[ExtensionConnHandler]: Remaining callbacks pending:",Object.keys(r).length)}else e.info("[ExtensionConnHandler]: No registered callback for reqId =",a.reqId)}function i(a,b,c,d){return a?q.isExtensionRunning()?j(a,b,c,d):(e.info("[ExtensionConnHandler]: Chrome extension is not running"),b&&window.setTimeout(function(){b("Extension not running")},0),!1):(e.error("[ExtensionConnHandler]: Cannot send message. Invalid message."),b&&window.setTimeout(function(){b("Invalid message")},0),!1)}function j(b,c,f,g){b.type===d.BgMsgType.REQUEST&&(b.reqId=a(c,f)),g||e.msgSend("[ExtensionConnHandler]: ",b),b.suppressLog=g;var h=new CustomEvent(d.DOMEvent.TO_EXTENSION,{
detail:JSON.stringify(b)});try{document&&document.dispatchEvent(h)}catch(a){return e.warning("[ExtensionConnHandler]: Error sending message: "+h,a),!1}return b.reqId}function k(){e.warning("[ExtensionConnHandler]: The content script has unregistered itself. Chrome extension is no longer running."),t=!1,e.info("[ExtensionConnHandler]: Dispatching event: extensionUnregistered");var a=q.createEvent("extensionUnregistered");q.dispatch(a)}function l(a){var b=null;try{b=JSON.parse(a.detail)}catch(a){return void e.warning("[ExtensionConnHandler]: Error parsing JSON object",a)}if(b.target===d.BgTarget.LOG)return void e.logMsg(b.data.log.level,b.data.log.messages);switch(b.suppressLog||e.msgRcvd("[ExtensionConnHandler]: ",b),b.type){case d.BgMsgType.REQUEST:case d.BgMsgType.EVENT:g(b);break;case d.BgMsgType.RESPONSE:h(b);break;default:e.msgRcvd("[ExtensionConnHandler]: Unexpected message type: ",b.type)}}b.parent.constructor.call(this,e);var m=5e3,n=65e3,o=18e4,p=18e4,q=this,r={},s=0,t=!1;this.isExtensionRunning=function(){return t},this.getScreenShareUserMedia=function(a){i({target:d.BgTarget.SCREEN_SHARE,type:d.BgMsgType.REQUEST,data:{type:d.BgScreenShareMsgType.CHOOSE_DESKTOP_MEDIA}},a)},this.exchangeConnect=function(a,b){i({target:d.BgTarget.EXCHANGE_CONNECTOR,type:d.BgMsgType.REQUEST,data:{method:d.BgExchangeMsgType.CONNECT,object:{settings:a}},keysToOmitFromLogging:["data.object.settings.exchInfo"]},b,o)},this.exchangeDisconnect=function(a){i({target:d.BgTarget.EXCHANGE_CONNECTOR,type:d.BgMsgType.REQUEST,data:{method:d.BgExchangeMsgType.DISCONNECT,object:{}}},a,n)},this.exchangeGetConnectionStatus=function(a,b){i({target:d.BgTarget.EXCHANGE_CONNECTOR,type:d.BgMsgType.REQUEST,data:{key:a,method:d.BgExchangeMsgType.GET_CONNECTION_STATUS},keysToOmitFromLogging:["data.key"]},b,n)},this.exchangeGetCapabilities=function(a){i({target:d.BgTarget.EXCHANGE_CONNECTOR,type:d.BgMsgType.REQUEST,data:{method:d.BgExchangeMsgType.GET_CAPABILITIES}},a,n)},this.exchangeCancelReqCallback=function(a){return e.debug("[ExtensionConnHandler]: Unregistering callback for reqId:",a),c(a)},this.exchangeSearchContacts=function(a,b,c,e){return i({target:d.BgTarget.EXCHANGE_CONNECTOR,type:d.BgMsgType.REQUEST,data:{key:a,method:d.BgExchangeMsgType.SEARCH_CONTACTS,object:{searchString:b,resultCount:c}},keysToOmitFromLogging:["data.key"]},e,n)},this.exchangeResolveContact=function(a,b,c){i({target:d.BgTarget.EXCHANGE_CONNECTOR,type:d.BgMsgType.REQUEST,data:{key:a,method:d.BgExchangeMsgType.RESOLVE_CONTACT,object:b},keysToOmitFromLogging:["data.key"]},c,n)},this.exchangeGetContact=function(a,b,c){i({target:d.BgTarget.EXCHANGE_CONNECTOR,type:d.BgMsgType.REQUEST,data:{key:a,method:d.BgExchangeMsgType.GET_CONTACT,object:{email:b}},keysToOmitFromLogging:["data.key"]},c,n)},this.exchangeOnRenewedToken=function(a,b,c,e){i({target:d.BgTarget.EXCHANGE_CONNECTOR,type:d.BgMsgType.RESPONSE,data:{key:a,method:d.BgExchangeMsgType.ON_RENEWED_TOKEN,object:{reqId:b,token:c}},keysToOmitFromLogging:["data.key","data.object.token"]},e,n)},this.exchangeStoreCredentials=function(a,b){i({target:d.BgTarget.EXCHANGE_CONNECTOR,type:d.BgMsgType.REQUEST,data:{method:d.BgExchangeMsgType.STORE_EXCH_CREDENTIALS,object:a},keysToOmitFromLogging:["data.object"]},b,n)},this.getAllPersonalContacts=function(a,b){i({target:d.BgTarget.EXCHANGE_CONNECTOR,type:d.BgMsgType.REQUEST,data:{key:a,method:d.BgExchangeMsgType.GET_ALL_PERSONAL_CONTACTS},keysToOmitFromLogging:["data.key"]},b,n)},this.getAppointments=function(a,b,c,e,f){i({target:d.BgTarget.EXCHANGE_CONNECTOR,type:d.BgMsgType.REQUEST,data:{key:a,method:d.BgExchangeMsgType.GET_APPOINTMENTS,startDate:b,endDate:c,resCount:e},keysToOmitFromLogging:["data.key"]},f,n)},this.syncAllPersonalContacts=function(a,b,c){i({target:d.BgTarget.EXCHANGE_CONNECTOR,type:d.BgMsgType.REQUEST,data:{key:a,method:d.BgExchangeMsgType.SYNC_ALL_PERSONAL_CONTACTS,syncState:b},keysToOmitFromLogging:["data.key","data.syncState"]},c,n)},this.getStoredCredentials=function(a,b){i({target:d.BgTarget.EXCHANGE_CONNECTOR,type:d.BgMsgType.REQUEST,data:{key:a,method:d.BgExchangeMsgType.GET_STORED_CREDENTIALS},keysToOmitFromLogging:["data.key"]},b,n)},this.getHeadsetIntegrationAppStatus=function(a,b){i({target:d.BgTarget.HEADSET_APP,type:d.BgMsgType.REQUEST,data:{type:d.BgHeadsetAppMsgType.GET_HEADSET_APP_STATUS,appId:a}},b,m)},this.launchHeadsetIntegrationApp=function(a,b,c){i({target:d.BgTarget.HEADSET_APP,type:d.BgMsgType.REQUEST,data:{type:d.BgHeadsetAppMsgType.LAUNCH_HEADSET_APP,appId:a,localizedStrings:b}},c,p)},this.bringToFront=function(a){i({target:d.BgTarget.INTERNAL,type:d.BgMsgType.REQUEST,data:{type:d.BgInternalMsgType.BRING_TO_FRONT}},a)},f.getBrowserInfo().chrome&&document&&document.addEventListener(d.DOMEvent.FROM_EXTENSION,l)}var c=a.BaseEventTarget,d=a.ChromeExtension,e=a.logger,f=a.Utils;return f.inherit(b,c),b.prototype.name="ExtensionConnHandler",a.ExtensionConnHandler=b,a}(Circuit),Circuit=function(a){"use strict";return a.ExtensionConnHandlerSingleton=function(){var b;return{getInstance:function(){return b||(b=new a.ExtensionConnHandler),b}}}(),a}(Circuit),Circuit=function(a){"use strict";return a.Enums.CallStateName={},Object.getOwnPropertyNames(a.Enums.CallState).forEach(function(b){a.Enums.CallStateName[b]=b}),a.Enums.ConversationItemType=a.Constants.ConversationItemType,a.Enums.ConversationType={DIRECT:"DIRECT",GROUP:"GROUP",LARGE:"LARGE",COMMUNITY:"COMMUNITY"},a.Enums.PresenceState=a.Constants.PresenceState,a.Enums.RTCItemType=a.Constants.RTCItemType,a.Enums.RTCParticipantType=a.Constants.RTCParticipantType,a.Enums.SystemItemType=a.Constants.SystemItemType,a.Enums.TextItemContentType=a.Constants.TextItemContentType,a.Enums.UserType=a.Constants.UserType,a.Enums.UserState=a.Constants.UserState,a.Enums.SearchDirection=a.Constants.SearchDirection,a.Enums.ParticipantCriteria=a.Constants.GetConversationParticipantCriteria,a.Enums.ConversationParticipantType=a.Constants.ConversationParticipantType,a}(Circuit||{}),Circuit=function(a){"use strict";function b(b,d,e,f){function g(){return null}function h(){if(!b.localUser||!b.localUser.accounts||!b.localUser.accounts[0])return!1;var a=b.localUser,c=b.localUser.accounts[0],d=a.callerId;return c.telephonyConfiguration?(a.phoneNumber=c.telephonyConfiguration.phoneNumber||null,c.telephonyConfiguration.associatedTelephonyUserType===l.GtcTrunkType.ATC_TRUNK_TYPE?(a.callerId=c.telephonyConfiguration.phoneNumber,a.cstaNumber=o.cleanPhoneNumber(c.telephonyConfiguration.phoneNumber)):(a.callerId=c.telephonyConfiguration.callerId||a.phoneNumber||r,a.cstaNumber=null)):(a.phoneNumber=null,a.callerId=r,a.cstaNumber=null),d!==a.callerId}function i(){return new Promise(function(a,b){t.getTelephonyData(function(c,d){c?b(c):(s=d,r=s.defaultCallerId||null,a(d))})})}function j(){return new Promise(function(a,b){t.getTelephonyConversationId(function(c,d){c||!d?b("Telephony conversation not found"):p.getConversationById(d,null,function(c,d){c||!d?b(c||"Error retrieving telephony conversation"):(k=d,d.isTelephonyConv=!0,a(d))})})})}var k,l=a.Constants,m=a.Conversation,n=a.UserProfile,o=a.Utils,p=this,q={},r=null,s={},t=a.ClientApiHandlerSingleton.getInstance();return f.subscribe("/telephony/data",function(a){var c=!1;r!==a.defaultCallerId&&(r=a.defaultCallerId,o.updateTelephonyNumbers(b.localUser,a.defaultCallerId)&&(c=!0)),b.localUser.telephonyAvailable!==a.telephonyAvailableForUser&&(b.localUser.telephonyAvailable=a.telephonyAvailableForUser,c=!0),c&&f.publish("/localUser/update",[b.localUser])}),t.on("Account.TELEPHONY_CONFIGURATION_UPDATED",function(a){if(a.configuration&&b.localUser){var c=b.localUser.accounts&&b.localUser.accounts[0];c&&(c.telephonyConfiguration=a.configuration,p.telephonyConfigChanged(),f.publish("/localUser/update",[b.localUser]))}}),this.addConversationToCache=function(a){a&&a.convId&&(q[a.convId]=m.extend(a))},this.setLocalUser=function(a){a&&(b.localUser=a,h(),n.syncTelephonyConfig(a))},this.telephonyConfigChanged=function(){h(),n.syncTelephonyConfig(b.localUser)},this.getConversationPromise=function(a){return new Promise(function(b,c){if(!a)return void c();var d=q[a];d?b(d):p.getConversationById(a,null,function(a,d){a||!d?c("Conversation not found"):b(d)})})},this.getConversationById=function(a,b,c){"function"==typeof c&&t.getConversationById(a,function(a,b){var d=m.extend(b);d&&(q[b.convId]=d),c(a,d)})},this.getConversationByRtcSession=function(a){e.debug("[SdkHelperSvc]: getConversationByRtcSession - rtcSessionId = ",a);for(var b in q)if(q.hasOwnProperty(b)&&q[b].rtcSessionId===a)return q[b];return null},this.getConversationFromCache=function(a){return e.debug("[SdkHelperSvc]: getConversationFromCache - convId = ",a),q[a]||null},this.getConversationAsGuestById=function(){return null},this.getTelephonyConversation=function(a){if("function"==typeof a){if(k)return void window.setTimeout(function(){a(null,k)});i().then(h).then(j).then(function(b){a(null,b)}).catch(a)}},this.getTelephonyData=i,this.getTelephonyConversationPromise=function(){return k?Promise.resolve(k):j()},this.isConversationsLoadComplete=function(){return!!b.localUser},this.updateLastCallTime=function(){},this.sendQOSData=function(a,b,c){e.debug("[SdkHelperSvc]: sendQOSData - call stats: ",c)},this.getSetting=function(){return null},this.getUserIdleState=function(){return c.Active},this.isAutoSnoozeOn=!1,this.setPresenceWithLocation=function(){},this.cancelAutoSnooze=function(){},this.getUserFromCache=g,this.getUser=g,this.getUserById=function(a,b){b&&b(l.ReturnCode.NO_RESULT)},this.addUsersToCache=function(){},this.startReverseLookUp=function(a,b){b&&b(null)},this}var c=Object.freeze({Idle:"Idle",Active:"Active"});return a.Enums=a.Enums||{},a.Enums.IdleState=c,a.SdkHelperSvcImpl=b,a}(Circuit),Circuit=function(a){"use strict";function b(a,b,d){return d.debug("New Service: UtilSvc"),this.promisify=function(a,c){return function(){var d=Array.prototype.slice.call(arguments);return new b(function(b,e){d.push(function(a){if(a)return e(a);var c=Array.prototype.slice.call(arguments);switch(c.shift(),c.length){case 0:b();break;case 1:b(c[0]);break;default:b(c)}}),a.apply(c,d)})}},this.getFaqUrl=function(b){if(a.localUser&&a.localUser.helpUrl&&c.DEFAULT_HELP_URL!==a.localUser.helpUrl)return a.localUser.helpUrl;var d="https://www.circuit.com/unifyportalfaqdetail"+(b?"?articleId="+b:"");return d},this}var c=a.Utils,d={AGC:"89415",DEVICE_ACCESS:"48742",JABRA:"112718",LOGIN:"37428",MODERATION:"93154",PLANTRONICS:"115017",TELEPHONY:"103733"};return a.UtilSvcImpl=b,a.Enums=a.Enums||{},a.Enums.FaqArticle=d,a}(Circuit),Circuit=function(a){"use strict";function b(a){function b(b,c){try{c=c instanceof Array?c:[c],b.apply(null,c||[])}catch(b){a.error(b)}}function c(a,c,d){a[c]&&a[c].slice(0).forEach(function(a){b(a,d)})}function d(a,c){c=c?Array.prototype.slice.call(c):[],c.unshift(a),k.slice(0).forEach(function(a){b(a,c)})}function e(a,b,c){a[b]||(a[b]=[]),a[b].indexOf(c)===-1&&a[b].push(c)}function f(a,b,c){if(a[b]){var d=a[b].indexOf(c);d>=0&&a[b].splice(d,1)}}function g(a){k.indexOf(a)===-1&&k.push(a)}function h(a){var b=k.indexOf(a);b>=0&&k.splice(b,1)}a.debug("New Service: PubSubSvc");var i={},j={},k=[];return this.publish=function(b,e){(i[b]||j[b])&&(a.debug("[PubSubSvc]: Publishing "+b+" event"),c(i,b,e),c(j,b,e),d(b,e),delete j[b])},this.subscribe=function(a,b){e(i,a,b)},this.unsubscribe=function(a,b){f(i,a,b)},this.subscribeOnce=function(a,b){e(j,a,b)},this.unsubscribeOnce=function(a,b){f(j,a,b)},this.subscribeAll=function(a){g(a)},this.unsubscribeAll=function(a){h(a)},this.resetSubscriptions=function(){i={},j={},k=[]},this}return a.PubSubSvcImpl=b,a}(Circuit),Circuit=function(a){"use strict";function b(b,f,g,h,i,j,k){function l(){if(b.browser&&b.browser.chrome){if(D="https://chrome.google.com/webstore/detail/",b.siemensAGUser)return E=!1,D+="siemens-circuit-by-unify/mnkbplodbhpkiphfeldjmaoickanlanc",void i.info("[ExtensionSvc]: Set URL to Siemens AG Circuit extension webstore link");E=!0;var a=g.location.hostname;switch(a){case r:D+="jafbhekoolndfieffjkikfbmekjppnec",i.info("[ExtensionSvc]: Set URL to Beta-Circuit extension. ",D);break;case q:D+="ogdfpjnhdggplglemglldmioiblhkadm",i.info("[ExtensionSvc]: Set URL to Sandbox-Circuit extension. ",D);break;case t:D+="gdgfgnopapmocggkadgfkjekdlcohmdl",i.info("[ExtensionSvc]: Set URL to T&I-Circuit extension. ",D);break;case s:D+="mdgbjijndgkkllljdaoohenhhaenilam",i.info("[ExtensionSvc]: Set URL to T-Systems extension. ",D);break;case u:return E=!1,D+="universit%C3%A4t-heidelberg-ci/nnlgegdgijgicheaipembfeaggifmalb",void i.info("[ExtensionSvc]: Set URL to Heidelberg Univerity extension webstore link ",D);default:D+="mhkbaognlahkdimlfcfhbeihldmjofgg",i.info("[ExtensionSvc]: Set URL to Circuit extension. ",D)}}}function m(){b.isChromeExtRunning=z.isExtensionRunning(),l()}function n(a,c,d){return i.debug("[ExtensionSvc]: Invoke ExtensionConnHandler API: ",a),A?A.isExtensionRunning()?(d&&(c=c||[],c.push(function(a,c){b.$apply(function(){d(a,c)})})),A[a].apply(A,c)):(i.debug("[ExtensionSvc]: Chrome extension is not running"),void(d&&f(function(){d("Extension not running")},0))):(i.debug("[ExtensionSvc]: ExtensionConnHandler is not loaded"),void(d&&f(function(){d("No ExtensionConnHandler")},0)))}function o(){i.info("[ExtensionSvc]: Validate the installed extension version: ",B),B!==x&&(C=e.convertVersionToNumber(B)>=w,C||i.warn("[ExtensionSvc]: The installed extension version ("+B+") is not supported. Minimum version is "+v))}function p(a){return b.browser&&b.browser.chrome?F||G?(i.warn("[ExtensionSvc]: The first extension installation attempt failed. Redirect the user to web store page. Url: ",D),a&&k.error({message:"res_ExtensionCannotBeInstalled",messageParams:[D]}),F?y.INSTALL_ALREADY_IN_PROGRESS:y.INSTALL_FAILED):C?null:(i.warn("[ExtensionSvc]: We are running an outdated extension:",B),a&&k.error({message:"res_UnsupportedExtensionVersion"}),y.UNSUPPORTED_EXT_VERSION):y.UNSUPPORTED_BROWSER}i.debug("New Service: ExtensionSvc");var q="circuitsandbox.net",r="beta.circuit.com",s="de.circuit.com",t="tandi.circuitsandbox.net",u="circuit.uni-heidelberg.de",v="1.1.6500",w=e.convertVersionToNumber(v),x="electron",y=Object.freeze({UNSUPPORTED_BROWSER:"UNSUPPORTED_BROWSER",INSTALL_ALREADY_IN_PROGRESS:"INSTALL_ALREADY_IN_PROGRESS",UNSUPPORTED_EXT_VERSION:"UNSUPPORTED_EXT_VERSION",USER_CANCELLED_INSTALL:"USER_CANCELLED_INSTALL",INSTALL_FAILED:"INSTALL_FAILED",INTERNAL_ERROR:"INTERNAL_ERROR"}),z=this,A="object"==typeof c?c.getInstance():null,B="",C=!0,D="",E=!1,F=!1,G=!1;return d.injectExtensionSvc(this,A),A&&A.addEventListener("extensionInitialized",function(a){b.$apply(function(){B=a.data.version,o(),C&&(F=!1,b.isChromeExtRunning=!0,i.setExtensionVersion(B),i.debug("[ExtensionSvc]: Publish /chromeExt/initialized event"),j.publish("/chromeExt/initialized"))})}),A&&A.addEventListener("extensionUnregistered",function(){b.$apply(function(){b.isChromeExtRunning=!1,i.debug("[ExtensionSvc]: Publish /chromeExt/unregistered event"),j.publish("/chromeExt/unregistered")})}),A&&A.addEventListener("headsetAppLaunched",function(a){b.$apply(function(){var b=a.data&&a.data.data;i.debug("[ExtensionSvc]: Publish /chromeExt/headsetAppLaunched event: ",b),j.publish("/chromeExt/headsetAppLaunched",[b])})}),A&&A.addEventListener("headsetAppUninstalled",function(a){b.$apply(function(){var b=a.data&&a.data.data;i.debug("[ExtensionSvc]: Publish /chromeExt/headsetAppUninstalled event: ",b),j.publish("/chromeExt/headsetAppUninstalled",[b])})}),this.isExtensionRunning=function(){return A&&A.isExtensionRunning()&&C},this.getExtensionVersion=function(){return B},this.isExtensionVersionSupported=function(){return C},this.installExtension=function(a){return new h(function(b,c){if(z.isExtensionRunning())return void b();if(!k)return i.error("[ExtensionSvc]: installExtension API requires PopupSvc"),void c(y.INTERNAL_ERROR);var d=p(a);if(d)return void c(d);var e={message:"res_ActionInstallExtensionText",controller:"ChromeExtensionInstallDialogCtrl",title:"res_ActionInstallExtensionTitle",yesLabel:"res_ActionInstall",noLabel:"res_Close",backdrop:!0};k.confirm(e).result.then(b).catch(function(b){a&&b===y.INSTALL_FAILED&&(i.warn("[ExtensionSvc]: The extension installation failed. Redirect the user to web store page. Url: ",D),k.error({message:"res_ExtensionCannotBeInstalled",messageParams:[D]})),c(b||y.USER_CANCELLED_INSTALL)})})},this.inlineInstallation=function(a){return new h(function(c,d){try{var e=p(a);if(e)return void d(e);if(i.debug("[ExtensionSvc]: Extension URL = ",D),!E)return i.debug("[ExtensionSvc]: Extension does not support inline installation. Open store link."),g.open(D),void c();chrome.webstore.install(D,function(){b.$apply(function(){i.debug("[ExtensionSvc]: Circuit extension was successfully installed"),F=!0,c()})},function(c){i.error("[ExtensionSvc]: There was an error installing the Circuit extension. ",c),b.$apply(function(){"User cancelled install"!==c?(G=!0,a&&(i.warn("[ExtensionSvc]: The extension installation failed. Redirect the user to web store page. Url: ",D),k.error({message:"res_ExtensionCannotBeInstalled",messageParams:[D]})),d(y.INSTALL_FAILED)):d(y.USER_CANCELLED_INSTALL)})})}catch(a){i.error("[ExtensionSvc]: There was an exception installing the Circuit extension. ",a),G=!0,d(y.INSTALL_FAILED)}})},this.addEventListener=function(a,b){A&&A.addEventListener(a,b)},this.exchangeGetConnectionStatus=function(a,b){return n("exchangeGetConnectionStatus",[a],b)},this.exchangeConnect=function(a,b){return n("exchangeConnect",[a],b)},this.exchangeSearchContacts=function(a,b,c,d){return n("exchangeSearchContacts",[a,b,c],d)},this.exchangeGetCapabilities=function(a){return n("exchangeGetCapabilities",[],a)},this.exchangeResolveContact=function(a,b,c){return n("exchangeResolveContact",[a,b],c)},this.exchangeGetContact=function(a,b,c){return n("exchangeGetContact",[a,b],c)},this.exchangeDisconnect=function(a){return n("exchangeDisconnect",[],a)},this.exchangeOnRenewedToken=function(a,b,c,d){return n("exchangeOnRenewedToken",[a,b,c],d)},this.storeExchCredentials=function(a,b){return n("exchangeStoreCredentials",[a],b)},this.getStoredCredentials=function(a,b){return n("getStoredCredentials",[a],b)},this.getAllPersonalContacts=function(a,b){return n("getAllPersonalContacts",[a],b)},this.syncAllPersonalContacts=function(a,b,c){return n("syncAllPersonalContacts",[a,b],c)},this.exchangeCancelReqCallback=function(a){return n("exchangeCancelReqCallback",[a])},this.getAppointments=function(a,b,c,d,e){return n("getAppointments",[a,b,c,d],e)},this.supportsGetAppointments=function(){return z.isExtensionRunning()?B===x||e.convertVersionToNumber(B)>=1017800:!(!b.browser||!b.browser.chrome)},this.supportsExchangeAutodiscover=function(){return!!z.isExtensionRunning()&&(B===x||e.convertVersionToNumber(B)>=1017903)},this.supportsExchangeAutodiscoverSvc=function(){return!!z.isExtensionRunning()&&(B===x||e.convertVersionToNumber(B)>=1019e3)},this.launchHeadsetIntegrationApp=function(a,b,c){return n("launchHeadsetIntegrationApp",[a,b],c)},this.getHeadsetIntegrationAppStatus=function(a,b){return n("getHeadsetIntegrationAppStatus",[a],b)},this.bringToFront=function(b){if(!a.isElectron)return n("bringToFront",[],b);var c=require("electron").remote.getCurrentWindow();c.minimize(),c.show(),c.focus()},m(),this}var c=a.ExtensionConnHandlerSingleton,d=a.ScreenSharingController,e=a.Utils;return a.ExtensionSvcImpl=b,a}(Circuit),Circuit=function(a){"use strict";function b(b,m,n,o,p){function q(a){a!==G&&(G=a,n.info("[AtcRegistrationSvc]: Publish /atcRegistration/state event. State =",a),o.publish("/atcRegistration/state",[a]),b.localUser.isATC&&a!==e.Registering&&y(L))}function r(a){return a.state!==g.TrunkState.DOWN&&I!==g.TrunkState.DOWN}function s(){var a=!!b.localUser.telephonyAvailable,c=!!b.localUser.callerId||!!b.localUser.phoneNumber;return a!==c}function t(a){a!==g.ReturnCode.FAILED_TO_SEND&&a!==g.ReturnCode.REQUEST_TIMEOUT&&503!==a.code&&408!==a.code||(K=m(function(){K=null,u()},C)),q(e.Unregistered)}function u(){var a={content:{type:"REGISTER",phoneNumber:b.localUser.cstaNumber,reroutingPhoneNumber:l.cleanPhoneNumber(b.localUser.reroutingPhoneNumber),onsHash:b.localUser.onsSipAuthenticationHash||void 0,ondHash:b.localUser.ondSipAuthenticationHash||void 0,routeToDesk:b.localUser.selectedRoutingOption===j.DeskPhone.name,deviceType:P},destUserId:b.localUser.associatedTelephonyUserID,keysToOmitFromLogging:["content.onsHash","content.ondHash"]};m.cancel(K),K=null,F.phoneNumber=b.localUser.cstaNumber,F.associatedTelephonyUserID=b.localUser.associatedTelephonyUserID,F.reroutingPhoneNumber=l.cleanPhoneNumber(b.localUser.reroutingPhoneNumber),F.onsSipAuthenticationHash=b.localUser.onsSipAuthenticationHash,F.ondSipAuthenticationHash=b.localUser.ondSipAuthenticationHash,O=b.localUser.selectedRoutingOption,q(e.Registering),n.info("[AtcRegistrationSvc]: Registering with ATC, phoneNumber: "+F.phoneNumber+", associatedTelephonyUserID: "+F.associatedTelephonyUserID),E.sendAtcRequest(a,function(a,c){b.$apply(function(){return H&&!M.call?(n.info("[AtcRegistrationSvc]: There was a configuration update while registering. Need to register again"),H=!1,void(a||!c||c.err?u():(N=!0,v()))):a||c&&c.err?(a=a||c.err,n.error("[AtcRegistrationSvc]: Register with ATC failed with error: ",a),void t(a)):void(c&&c.configurationData?(n.info("[AtcRegistrationSvc]: Received ATC configuration data: ",c.configurationData),F.configurationData=c.configurationData,F.reroutingPhoneNumber=c.configurationData.cell,F.capabilities=c.capabilities,b.localUser.reroutingPhoneNumber=i.format(c.configurationData.cell),b.localUser.vmNumber=c.configurationData.vm,b.localUser.isOSV=c.configurationData.pbx&&"OSV"===c.configurationData.pbx,q(e.Registered),n.debug("[AtcRegistrationSvc]: Registration refresh will be handled by access server")):q(e.Unregistered))})})}function v(){if(n.info("[AtcRegistrationSvc]: Unregister with ATC"),G===e.Unregistered||G===e.Disconnected)return void n.debug("[AtcRegistrationSvc]: The client is not registered with ATC");var a={content:{type:"UNREGISTER",phoneNumber:F.phoneNumber},destUserId:F.associatedTelephonyUserID};q(e.Unregistered),F.associatedTelephonyUserID="",E.sendAtcRequest(a,function(a){b.$apply(function(){a?n.error("[AtcRegistrationSvc]: Unregister with ATC failed with: ",a):n.info("[AtcRegistrationSvc]: Unregistered successfully with ATC"),N&&(u(),N=!1)})})}function w(a){a!==I&&b.$apply(function(){I=a,n.debug("[AtcRegistrationSvc]: Set trunk state to ",I);var b=l.shallowCopy(L);b.state=a,x(b)})}function x(a){if(a){if(b.localUser.isATC)if(a.state===g.TrunkState.DOWN)v();else if(L.state===g.TrunkState.DOWN&&a.state===g.TrunkState.UP)return L=a,G===e.Registering?(n.debug("[AtcRegistrationSvc]: Client is registering and configuration has changed. Wait..."),void(H=!0)):void u();y(a)}}function y(a){a&&(L=a,b.localUser.isATC?(L.state=G===e.Registered?g.TrunkState.UP:g.TrunkState.DOWN,L.defaultCallerId=null,L.isGTCEnabled=!0):L.defaultCallerId=L.defaultCallerId||null,L.telephonyAvailableForTenant=!!a.isGTCEnabled,L.telephonyAvailableForUser=!(!a.isGTCEnabled||!b.localUser.callerId&&!L.defaultCallerId),L.conferenceDialOutAvailable=L.telephonyAvailableForTenant&&r(L),L.phoneCallsAvailable=L.telephonyAvailableForUser&&r(L),n.info("[AtcRegistrationSvc]: Publish /telephony/data event. data = ",L),o.publish("/telephony/data",[L]),L.state!==g.TrunkState.DOWN&&L.state!==g.TrunkState.UP||p.getTelephonyConversationPromise().then(function(a){a&&(r(L)?a.avatar=h.TELEPHONY:a.avatar=h.TELEPHONY_DISABLED,M=a)}).catch(function(){n.debug("[AtcRegistrationSvc]: No telephony conversation found")}))}function z(a){n.info("[AtcRegistrationSvc]: Getting telephony data"),b.telephonyEnabled?D.getTelephonyData(function(c,d){b.$apply(function(){c?c!==g.ReturnCode.NO_RESULT&&(n.error("[AtcRegistrationSvc]: Error getting telephony data: ",c),a&&a(c)):(x(d),a&&a(null,L))})}):(y({state:g.TrunkState.DOWN}),a&&a(null,L))}function A(a){if(J&&J!==b.localUser.associatedTelephonyUserID&&(D.unsubscribePresence(J),J=null),b.localUser.associatedTelephonyUserID&&J!==b.localUser.associatedTelephonyUserID&&D.subscribePresence([b.localUser.associatedTelephonyUserID],function(a,c){if(a)return void n.error("[AtcRegistrationSvc]: Unable to subscribe to TC presences");if(J=b.localUser.associatedTelephonyUserID,c&&c.length>0&&!b.localUser.isATC){var d=c[0].state===g.PresenceState.AVAILABLE?g.TrunkState.UP:g.TrunkState.DOWN;w(d)}}),!b.localUser.isATC||!b.localUser.cstaNumber)return G===e.Registered?(n.debug("[AtcRegistrationSvc]: Cannot register without an associated ATC or assigned phoneNumber"),v(),z()):(a||s())&&z(),void q(e.Disconnected);if(b.localUser.associatedTelephonyUserID===F.associatedTelephonyUserID&&b.localUser.cstaNumber===F.phoneNumber&&l.cleanPhoneNumber(b.localUser.reroutingPhoneNumber)===F.reroutingPhoneNumber&&b.localUser.onsSipAuthenticationHash===F.onsSipAuthenticationHash&&b.localUser.ondSipAuthenticationHash===F.ondSipAuthenticationHash&&(G===e.Registered||G===e.Registering))return void n.debug("[AtcRegistrationSvc]: Client is already registered or registering with ATC and the associatedTelephonyUserID is the same");if(G===e.Registering)return n.debug("[AtcRegistrationSvc]: Client is registering and configuration has changed. Wait..."),void(H=!0);if(G===e.Registered){if(n.debug("[AtcRegistrationSvc]: Client is already registered and configuration has changed."),M.call)return n.debug("[AtcRegistrationSvc]: There is an active telephony call, wait..."),void(H=!0);N=!0,v()}if(!N){if(!M)return n.debug("[AtcRegistrationSvc]: Get telephony conversation before proceeding with ATC register"),p.getTelephonyConversationPromise().then(function(a){M=a,n.debug("[AtcRegistrationSvc]: Got telephony conversation. Proceed with ATC register."),A()}),void(!a&&s()&&z());u()}}function B(){if(G===e.Registered){var a=b.localUser.selectedRoutingOption===j.DeskPhone.name;n.debug("[AtcRegistrationSvc]: Send SET_ROUTE_TO_DESK event to ATC. status = ");var f={content:{type:d.INFO,phoneNumber:b.localUser.cstaNumber,info:{type:c.SET_ROUTE_TO_DESK,status:a}},destUserId:b.localUser.associatedTelephonyUserID};E.sendAtcRequest(f)}}n.debug("New Service: AtcRegistrationSvc");var C=1e4,D=f.getInstance(),E=k.getInstance(),F={},G=e.Disconnected,H=!1,I=null,J=null,K=null,L={state:g.TrunkState.DOWN},M=null,N=!1,O=null,P=l.isMobile()?g.DeviceType.MOBILE:a.isElectron?g.DeviceType.APPLICATION:g.DeviceType.WEB;return o.subscribe("/localUser/update",function(){p.isConversationsLoadComplete()&&(n.debug("[AtcRegistrationSvc]: Received /localUser/update event"),A())}),o.subscribe("/conversations/loadComplete",function(){n.debug("[AtcRegistrationSvc]: Received /conversations/loadComplete event"),A(!0)}),o.subscribe("/registration/state",function(a){p.isConversationsLoadComplete()&&(n.debug("[AtcRegistrationSvc]: Received /registration/state event"),a!==RegistrationState.LoggingOut&&a!==RegistrationState.Reconnecting&&a!==RegistrationState.Disconnected||m(b.localUser.isATC?v:function(){L.state=g.TrunkState.DOWN,J=null,y(L)}))}),o.subscribe("/conversation/update",function(a){if(n.debug("[AtcRegistrationSvc]: Received /conversation/update event"),a.isTelephonyConv){if(M=a,!H)return;a.call?n.debug("[AtcRegistrationSvc]: There is still an active telephony call, wait..."):G!==e.Registering&&(H=!1,N=!0,v())}}),o.subscribe("/user/settings/update",function(){p.isConversationsLoadComplete()&&(n.debug("[AtcRegistrationSvc]: Received /user/settings/update event"),O!==b.localUser.selectedRoutingOption&&(O=b.localUser.selectedRoutingOption,B()))}),D.on("User.TELEPHONY_DATA",function(a){b.$apply(function(){try{n.debug("[AtcRegistrationSvc]: Received User.TELEPHONY_DATA with data: ",a.data),a.data&&(a.data.isGTCEnabled=!0,x(a.data))}catch(a){n.error("[AtcRegistrationSvc]: Exception handling User.TELEPHONY_DATA event.",a)}})}),D.on("User.USER_PRESENCE_CHANGE",function(a){if(b.localUser&&a.userId===b.localUser.associatedTelephonyUserID){n.debug("[AtcRegistrationSvc]: Received User.USER_PRESENCE_CHANGE with data: ",a);var c=a.newState.state===g.PresenceState.AVAILABLE?g.TrunkState.UP:g.TrunkState.DOWN;w(c)}}),D.on("User.ATC_REFRESH_FAILED",function(){n.error("[AtcRegistrationSvc]: Received User.ATC_REFRESH_FAILED event."),G===e.Registered?M.call&&!M.call.isRemote?n.info("[AtcRegistrationSvc]: There is an active telephony call, ignoring ATC re-register for now. If error persists on server another event will come later."):b.$apply(function(){n.info("[AtcRegistrationSvc]: New registration must be triggered."),N=!0,v()}):n.info("[AtcRegistrationSvc]: Client is not registered, ignoring failed refresh on server.")}),this.initAtcForSdk=function(){n.debug("[AtcRegistrationSvc]: initAtcForSdk"),P=g.DeviceType.SDK,A(!0)},this.atcState=function(){return G},this.getAtcRegistrationData=function(){return F.configurationData},this.atcUnregister=v,this.getTelephonyData=function(a){return a=a||function(){},G===e.Registering?void a("ATC Registering"):l.isEmptyObject(L)?void z(a):void a(null,L)},this.isExtendedAlertingSupported=function(){return!(!F||!F.capabilities)&&F.capabilities.includes(g.AtcCapabilities.EXTENDED_ALERTING)},this.isClearConnectionBusySupported=function(){if(F&&F.capabilities)return F.capabilities.includes(g.AtcCapabilities.CLEAR_CONNECTION_BUSY)},this}var c=a.Enums.AtcInfoMessage,d=a.Enums.AtcMessage,e=a.Enums.AtcRegistrationState,f=a.ClientApiHandlerSingleton,g=a.Constants,h=a.DefaultAvatars,i=a.PhoneNumberFormatter,j=a.RoutingOptions,k=a.UserToUserHandlerSingleton,l=a.Utils;return a.AtcRegistrationSvcImpl=b,a}(Circuit),Circuit=function(a){"use strict";function b(b,q,r,s,t,u,v,w,x,y,z){function A(a){return x.getConversationAsGuestById(a)||x.getConversationFromCache(a)}function B(){if(Rb){var a=1e3*(Rb.ttl||0);a=Math.max(a-ub,0),Rb.expirationTimestamp=Date.now()+a}}function C(a){return new t(function(c){var d=Rb&&Rb.expirationTimestamp||0;if(Date.now()<d){var e=new Date(d);return u.debug("[CircuitCallControlSvc]: Existing credentials are still valid. Expiration: "+e),void c(Rb)}u.debug("[CircuitCallControlSvc]: Get new TURN credentials"),yb.renewTurnCredentials(a,function(a,d){b.$apply(function(){a?u.warn("[CircuitCallControlSvc]: Error renewing TURN credentials. Reusing old credentials."):d&&d.length&&(d=d[0],u.info("[CircuitCallControlSvc]: Received new TURN credentials=",d.turnServer),Rb=d,B()),c(Rb)})})})}function D(a,c,e){return new t(function(f,g){var h={convId:a.convId,rtcSessionId:c?c.callId:a.rtcSessionId,ownerId:a.creatorId,mediaNode:c.getMediaNode(),isTelephonyConversation:a.isTelephonyConv,replaces:e.replaces&&e.replaces.callId};yb.prepareSession(h,function(a,e,h){b.$apply(function(){if(a){if(a===d.ErrorCode.RTC_CONCURRENT_INCOMING_CALL)return u.debug("[CircuitCallControlSvc]: Concurrent incoming call, aborting own attempt."),void g(a);if(a===d.ErrorCode.RTC_NO_MEDIA_NODES_AVAILABLE)return u.warn("[CircuitCallControlSvc]: No media nodes available, call not possible."),void g(a);if(a===d.ErrorCode.RTC_MEDIA_NODE_UNREACHABLE)return u.warn("[CircuitCallControlSvc]: Specified media node is not reachable, call not possible."),void g(a);u.warn("[CircuitCallControlSvc]: Error retrieving start session data. Reusing old credentials.")}else e&&e.length&&(u.info("[CircuitCallControlSvc]: Received new TURN credentials"),e=e[0],Rb=e,B());c&&h&&c.setCallIdForTelephony(h),f(Rb)})})})}function E(a){if(a){if(a.startsWith("res_"))return a;if(a===d.ErrorCode.PERMISSION_DENIED)return"res_JoinRTCSessionFailedPermission";if(a===d.SdpFailedCause.JOIN_FORBIDDEN)return"res_JoinRTCSessionFailedForbidden";if(a===d.ErrorCode.RTC_NO_MEDIA_NODES_AVAILABLE)return"res_JoinRTCSessionFailedMissingResources";if(a===d.ReturnCode.CHOOSE_DESKTOP_MEDIA_CANCELLED)return a;if(a===d.ReturnCode.DISCONNECTED||a===d.ReturnCode.FAILED_TO_SEND)return"res_JoinRTCSessionFailedNotConnected"}return"res_JoinRTCSessionFailed"}function F(){if(m.randomBoolean()){var a=Bb.participants.filter(function(a){
return a.pcState===e.ParticipantState.Active});if(!(a.length<2)){a.push(b.localUser);var c={sessionId:Bb.callId},d=["first","second","third"],f=m.randomNumber(0,3),g=a.randomCopy(f);g.indexOf(a[0])===-1&&m.randomBoolean()&&(g.unshift(a[0]),f<3&&f++);for(var h=0;h<f;h++)c[d[h]]=g[h].userId;if(u.debug("[CircuitCallControlSvc]: Firing mocked ACTIVE_SPEAKER event: ",c),Qa(c),!(Bb.sessionCtrl.getNumberOfExtraVideoChannels()>0||Bb.hasRemoteScreenShare())){var i=g[0];i&&i.userId!==b.localUser.userId&&i.mediaType.video&&!i.streamId&&Ra({sessionId:Bb.callId,userId:i.userId,videoStreamId:"mock"})}}}}function G(){return Bb&&Bb.isMocked&&!Bb.isDirect&&Bb.participants.length>1}function H(){!Jb&&G()&&(Jb=r(function(){u.debug("[CircuitCallControlSvc]: Active speaker simulation interval has fired"),G()?Bb.isEstablished()&&F():(u.debug("[CircuitCallControlSvc]: Active speaker simulation is no longer needed. Stop interval."),r.cancel(Jb),Jb=null)},2e3,0,!1))}function I(a,b){if(!a.checkState(e.CallState.Ringing)||(Ib.push(a),!b)){for(var c=0;c<Ab.length;c++)if(a.sameAs(Ab[c]))return u.debug("[CircuitCallControlSvc]: Updating call with callId = "+a.callId),void(Ab[c]=a);Ab.push(a),a===Bb&&H(),Eb=null}}function J(a){var b;for(b=0;b<Ab.length;b++)if(a.sameAs(Ab[b])){Ab.splice(b,1);break}for(b=0;b<Ib.length;b++)if(a.sameAs(Ib[b])&&!a.isHandoverInProgress){Ib.splice(b,1);break}for(b=0;b<Db.length;b++)if(a.sameAs(Db[b])){Db.splice(b,1);break}a.isRemote?Eb=null:(Eb=a,Fb=a.sessionCtrl&&a.sessionCtrl.isMuted())}function K(a){a&&a.state!==e.CallState.Terminated&&(u.debug("[CircuitCallControlSvc]: Publish /call/state event. state = ",a.state.name),v.publish("/call/state",[a]))}function L(a){if(Bb&&Bb.sameAs(a)){var b=xb.getIncomingCall();return!!(b&&b.replaces&&b.replaces.sameAs(a))}return!!(Bb&&Bb.replaces&&Bb.replaces.sameAs(a))}function M(a,c,d){u.info("[CircuitCallControlSvc]: Terminating call...");var e=L(a);cb(a),a.isRemote||(c&&(a.terminateReason=c),ra(a,!0)),Fa(a),J(a),a.terminate(),b.closePopoutCallStage&&b.closePopoutCallStage(a),Bb&&Bb.sameAs(a)?(q.cancel(Bb.terminateTimer),Bb=Cb,Cb=null):Cb&&Cb.sameAs(a)&&(q.cancel(Cb.terminateTimer),Cb=null);var f=A(a.convId);if(f&&f.call&&f.call.sameAs(a)&&!a.isHandoverInProgress){if(a.isTelephonyCall){var g=Q()||R();f.call=g||null}else f.call=null;x.updateLastCallTime(f),u.debug("[CircuitCallControlSvc]: Publish /conversation/update event"),v.publish("/conversation/update",[f])}Jb&&!Bb&&(r.cancel(Jb),Jb=null),d||(u.debug("[CircuitCallControlSvc]: Publish /call/ended event. Replaced=",e),v.publish("/call/ended",[a,e]))}function N(a){return Bb&&Bb.callId===a?Bb:Cb&&Cb.callId===a?Cb:null}function O(a){for(var b=0;b<Ab.length;b++)if(Ab[b].callId===a)return Ab[b];for(b=0;b<Ib.length;b++)if(Ib[b].callId===a)return Ib[b];var c=x.getConversationByRtcSession(a);return c&&c.call&&!c.call.isAtcRemote&&c.call.state.established&&c.call.callId===a?(Ab.push(c.call),c.call):N(a)}function P(a,b){if(a.participantType===d.RTCParticipantType.TELEPHONY&&a.phoneNumber){var c=Bb.getParticipant(a.userId);if(c&&c.phoneNumber&&c.phoneNumber===a.phoneNumber)return;w.startReverseLookUp(a.phoneNumber,function(c){if(b.isPresent()&&c){var d=Bb.getParticipant(a.userId);d&&(d.firstName=c.firstName,d.lastName=c.lastName,d.resolvedUserId=c.userId,Aa(b,d))}})}}function Q(a){return Ab.find(function(b){return b.isTelephonyCall&&b.state.established&&!b.isHolding()&&(!a||!b.isRemote)})||null}function R(a){return Ab.find(function(b){return b.isTelephonyCall&&b.state.established&&b.isHolding()&&(!a||!b.isRemote)})||null}function S(){return!b.localUser.selectedBusyHandlingOption||b.localUser.selectedBusyHandlingOption===o.DefaultRouting.name}function T(a,b,c,d,e,f){if(f=f||function(){K(a)},c=c||b,a.setPeerUser(b,d,e),!e){var g=q(function(){g=null,a.isPresent()&&(f(),f=null)},wb,!1);w.startReverseLookUp(c,function(c){q.cancel(g),a.isPresent()&&(c?(a.setPeerUser(b,c.displayName,c.userId),f?f():K(a)):f&&f())})}}function U(a,c){var f,h=!(a.participantType&&a.participantType!==d.RTCParticipantType.USER&&a.participantType!==d.RTCParticipantType.MEETING_POINT||a.userId==="echo_"+b.localUser.userId||a.isExternal);if(a.userId===b.localUser.userId?f=b.localUser:h&&(f=w.getUserFromCache(a.userId)),!f){a.userDisplayName=a.userDisplayName||a.phoneNumber||b.i18n.map.res_Unknown;var j=a.userDisplayName.split(" ");a.participantType===d.RTCParticipantType.MEETING_POINT?(a.lastName=j[0],a.location=j.splice(1).join(" ").trim().slice(1,-1)):(a.firstName=j[0],a.lastName=j.splice(1).join(" ")),h?(f=lb.extend({userId:a.userId,firstName:a.firstName,lastName:a.lastName,displayName:a.displayName,location:a.location,userType:a.participantType===d.RTCParticipantType.MEETING_POINT?d.UserType.MEETING_POINT:d.UserType.REGULAR}),f.noData=!0,w.addUsersToCache(f,!0,!1)):(a.participantType===d.RTCParticipantType.SESSION_GUEST&&(a.userType=d.UserType.SESSION_GUEST),f=lb.extend(a),f.isSessionGuest&&(f.initials=((f.firstName[0]||"")+(f.lastName[0]||"")).toUpperCase()))}var k=i.createFromUser(f,e.ParticipantState.Active);return k.streamId=a.videoStreamId||"",k.screenStreamId=a.screenStreamId||"",k.mediaType=g.getMediaType(a.mediaTypes||c),k.muted=a.muted||!k.mediaType.audio,k.participantType=a.participantType,k.screenSharePointerSupported=!!a.screenSharePointerSupported,k}function V(a,b){if(b&&b.length){var c=Hb[a];c?c.turnServers=b:Hb[a]={turnServers:b}}}function W(a){var b=Hb[a];return b&&b.turnServers&&b.turnServers.length?b.turnServers:null}function X(a,c,g,h){if(g.callOut=!!g.callOut,g.handover=!!g.handover,!a)return u.warn("[CircuitCallControlSvc]: joinSession invoked without a valid conversation"),void h("Missing conversation");if(jb(a,g.replaces,h)){if(a.isTelephonyConv){if(!g.handover&&(g.dialedDn=g.dialedDn?g.dialedDn.trim():null,!g.dialedDn))return void h("Missing Dialed DN");if(!b.localUser.callerId)return void h("Missing Caller ID")}u.debug("[CircuitCallControlSvc]: joinSession - rtcSessionId=",g.callId||a.rtcSessionId);var i;g.replaces&&c.desktop&&(i={reuseDesktopStreamFrom:g.replaces.sessionCtrl});var j=new f(a,i);if(Bb&&(Cb=Bb),Bb=j,Bb.setCallIdForTelephony(g.callId),Bb.setTransactionId(),Bb.sessionCtrl.enableTrickleIce(),(b.isSessionGuest||b.localUser.isCMP||a.isTemporary)&&!a.testCall&&Bb.sessionCtrl.useMaxNumberOfExtraVideoChannels(),(Gb||a.isTelephonyConv)&&(u.info("[CircuitCallControlSvc] Disabling remote video for outgoing call"),Bb.disableRemoteVideo()),Bb.setState(e.CallState.Initiated),Bb.direction=e.CallDirection.OUTGOING,Bb.mediaType=c,g.replaces){Bb.replaces=g.replaces;var k=g.replaces.sessionCtrl.getLocalStream(p.LOCAL_STREAMS.DESKTOP);k&&(u.debug("[CircuitCallControlSvc] Reusing desktop stream from call ID=",g.replaces.callId),Bb.sessionCtrl.setLocalStream(p.LOCAL_STREAMS.DESKTOP,k),g.replaces.sessionCtrl.setLocalStream(p.LOCAL_STREAMS.DESKTOP,null))}if(g.joiningGroupCall&&(Bb.isJoiningGroupCall=!0),g.callOut&&(Bb.setPeerUsersAsParticipants(),Bb.isCallOut=!0),Bb.isTelephonyCall)if(g.handover){var l=ta(Bb.callId);l&&!l.isAtcConferenceCall()&&(Bb.atcCallInfo=l.atcCallInfo,T(Bb,l.peerUser.phoneNumber,null,l.peerUser.displayName)),Bb.handover=!0}else T(Bb,g.dialedDn,null,g.toName,g.userId);var n,o=Bb.sessionCtrl,q=function(c){o.onSessionDescription=null,Bb.mediaType=o.getMediaConstraints();var d={convId:a.convId,rtcSessionId:Bb.callId||a.rtcSessionId,ownerId:a.creatorId,sdp:c.sdp,mediaType:Bb.mediaType,callOut:g.callOut,handover:g.handover,sendInviteCancel:!g.callOut,replaces:g.replaces&&g.replaces.callId,isTelephonyConversation:Bb.isTelephonyCall,displayName:b.localUser.displayName,transactionId:Bb.transactionId,screenSharePointerSupported:!(!Bb.pointer||!Bb.pointer.isEnabled)};Bb.isTelephonyCall&&(d.fromDn=m.cleanPhoneNumber(b.localUser.callerId),d.fromName=b.localUser.displayName,d.fromUserId=b.localUser.userId,d.dialedDn=m.cleanPhoneNumber(g.dialedDn),d.toName=g.toName,d.toUserId=g.userId),b.localUser.hasTelephonyRole&&(d.fromName="Gru",d.fromDn="+19998455246"),yb.joinRtcCall(d,function(c){b.$apply(function(){if(c){var b=Bb.replaces;M(Bb,e.CallClientTerminatedReason.REQUEST_TO_SERVER_FAILED),b&&(Bb=b),h(E(c))}else{if(u.debug("[CircuitCallControlSvc]: Join RTC session call was successful"),a.call!==Bb){var d=a.call;d&&d.isRemote&&!d.isAtcRemote&&(u.debug("[CircuitCallControlSvc]: Terminate the remote call and add the new local call to the conversation"),g.handover&&(Bb.activeClient=d.activeClient,d.isTelephonyCall&&(Bb.activeClient=d.activeClient,Bb.atcCallInfo=d.atcCallInfo,T(Bb,d.peerUser.phoneNumber,null,d.peerUser.displayName),Bb.participants=d.participants)),M(d)),I(Bb),a.call=Bb,u.debug("[CircuitCallControlSvc]: Publish /conversation/update event"),v.publish("/conversation/update",[a]),K(Bb),Bb.conferenceCall&&(u.debug("[CircuitCallControlSvc]: Publish /conference/participant/joining event"),v.publish("/conference/participant/joining",[Bb]))}h(null,g.warning,Bb)}})})},r=function(a){if(a=E(a),u.warn("[CircuitCallControlSvc]: Failed to initiate call. ",a),Bb===j){if(!g.handover){var b=Bb.isDirect?"terminateRtcCall":"leaveRtcCall";Bb.setDisconnectCause(d.DisconnectCause.CALL_SETUP_FAILED,a),yb[b](Bb.callId,Bb.disconnectCause,function(a){a&&u.warn("[CircuitCallControlSvc]: Error terminating RTC call. ",a)})}Bb.terminate(),Bb=null}h(a)};n=!a.call||a.call!==Bb&&!g.handover?D(a,Bb,g):C(Bb.callId),n.then(function(d){d&&(V(a.rtcSessionId,d.turnServer),o.setTurnUris(d.turnServer),o.setTurnCredentials(d)),o.warmup(c,null,function(){return Bb?void b.$apply(function(){u.debug("[CircuitCallControlSvc]: The connection warmup was successful. Start the call."),a.call&&(a.call.isRemote||g.handover)||(I(Bb),a.call=Bb,u.debug("[CircuitCallControlSvc]: Publish /conversation/update event"),v.publish("/conversation/update",[a]),Bb.conferenceCall||(u.debug("[CircuitCallControlSvc]: Publish /call/outgoing event"),v.publish("/call/outgoing",[Bb])),K(Bb)),o.onSessionDescription=q,Ea(Bb),o.start(c,null)}):void u.debug("[CircuitCallControlSvc]: Call has already been terminated")},function(a){b.$apply(r.bind(null,a))},g.screenConstraint)},r)}}function Y(a,c,d,e,f,g,h){var i=O(a);if(!i)return u.warn("[CircuitCallControlSvc]: changeMediaType - There is no local call"),void g("No active call");if(a!==i.callId)return u.info("[CircuitCallControlSvc]: changeMediaType - The given call ID does not match the local call"),void g("Invalid callId");if(!i.isEstablished())return u.info("[CircuitCallControlSvc]: changeMediaType - The local call is not established"),void g("Call not established");var j=i.sessionCtrl;if(!j.isConnStable())return void g("Connection not stable");var k=function(a){j.onSessionDescription=null,i.setTransactionId(c);var e={rtcSessionId:i.callId,sdp:a.sdp,mediaType:d,transactionId:i.transactionId,screenSharePointerSupported:!(!i.pointer||!i.pointer.isEnabled)};yb.changeMediaType(e,function(a){b.$apply(function(){a?(j.renegotiationFailed(),g(a)):u.debug("[CircuitCallControlSvc]: changeMediaType was successful. Wait for SDP_ANSWER event")})})},l=i.localMediaType.desktop;C(i.callId).then(function(a){if(j.setTurnCredentials(a),j.enableTrickleIce(),j.onSessionDescription=k,"boolean"==typeof f){var c=f?j.holdCall:j.retrieveCall;c(function(a){a?(u.error("[CircuitCallControlSvc]: Error in hold/retrieve media"),j.onSessionDescription=null,j.renegotiationFailed(),g("Error in hold/retrieve media")):g()})}else j.changeMediaType(d,e,function(a){a?b.$apply(function(){u.warn("[CircuitCallControlSvc]: changeMediaType failed - reason: ",a),j.onSessionDescription=null,j.renegotiationFailed(),g(a||"Error changing media")}):(l&&!i.localMediaType.desktop&&(u.debug("[CircuitCallControlSvc]: Publish /screenshare/ended event"),v.publish("/screenshare/ended"),i.pointer.isSupported=i.pointer.isEnabled=!1),i.updateMediaDevices(),g())},h)})}function Z(a,c,d,f){var g=Bb.sessionCtrl;d=d||{};var h=function(h){function i(a){b.$apply(function(){a?(M(Bb,e.CallClientTerminatedReason.REQUEST_TO_SERVER_FAILED),f(E(a))):(u.debug("[CircuitCallControlSvc]: Join/Answer RTC session was successful."),f(null,d.warning))})}g.onSessionDescription=null;var j={convId:a.convId,rtcSessionId:Bb.callId||a.rtcSessionId,ownerId:a.creatorId,sdp:h.sdp,mediaType:c,callOut:!1,handover:!1,sendInviteCancel:!0,isTelephonyConversation:a.isTelephonyConv,displayName:b.localUser.displayName,transactionId:Bb.transactionId};j.sdp&&"offer"===j.sdp.type?yb.joinRtcCall(j,i):yb.answerRtcCall(j,i)};g.onSessionDescription=h,g.start(c,null)||(M(Bb,e.CallClientTerminatedReason.RTC_SESSION_START_FAILED),f(E()))}function $(a,b,c,d){if(!a)return null;if(a.isTemporary&&!b)return u.debug("[CircuitCallControlSvc]: Publish /conversation/temporary/ended event"),v.publish("/conversation/temporary/ended",[a]),null;var f=new h(a);return f.setState(b?e.CallState.ActiveRemote:e.CallState.Started),I(f),b&&(f.setActiveClient(b),va(f),c&&(1===c.participants.length&&c.callOut&&(f.pullNotAllowed=!0),f.mediaType=g.getMediaType(c.mediaTypes))),"function"==typeof d&&d(f),a.call=f,u.debug("[CircuitCallControlSvc]: Publish /conversation/update event"),v.publish("/conversation/update",[a]),K(f),f}function _(a){if(a.isGuestInvite){J(a);var b=A(a.convId);b&&b.isTemporary&&(u.debug("[CircuitCallControlSvc]: Publish /conversation/temporary/ended event"),v.publish("/conversation/temporary/ended",[b]))}else a.setState(e.CallState.Started),a.activeClient=null,K(a),Db.findAndRemove(function(b){return b.callId===a.callId})}function aa(a){yb.declineRtcCall({convId:a.convId,rtcSessionId:a.sessionId,cause:d.InviteRejectCause.BUSY,transactionId:a.transactionId})}function ba(a,b,c){var d=new f(a,b.sessionId);d.setInstanceId(b.instanceId),d.setTransactionId(b.transactionId),d.setState(e.CallState.Ringing),b.from&&T(d,b.from.phoneNumber,b.from.fullyQualifiedNumber,b.from.displayName,null,function(){u.debug("atccall/firstcall"),v.publish(c?"/atccall/firstcall":"/atccall/secondcall",[d])})}function ca(a,c,d,f){if(f=f||function(){},a=a||Bb,J(a),!a||a.state!==e.CallState.Ringing&&a.state!==e.CallState.Answering)return u.debug("[CircuitCallControlSvc]: call invalid to be declined"),void f("Call Invalid");u.debug("[CircuitCallControlSvc]: decline - rtcSessionId: ",a.callId);var g={convId:a.convId,rtcSessionId:a.callId,cause:c.type,transactionId:a.transactionId},h=[a];if(c.err&&h.push(c.err),yb.declineRtcCall(g,function(a){b.$apply(function(){a?(u.warn("[CircuitCallControlSvc]: Error declining the RTC call. ",a),f(a)):f()})}),!a.isDirect){var i=A(a.convId);$(i)}u.debug("[CircuitCallControlSvc]: Publish /call/declining event"),v.publish("/call/declining",h),M(a,e.CallClientTerminatedReason.CLIENT_ENDED_PRFX+c.type,d)}function da(a,c,f,g,h){if(h=h||function(){},a=a||Bb,!a)return u.debug("[CircuitCallControlSvc]: There is no local call"),void(h&&q(h));if(a.terminateTimer)return u.debug("[CircuitCallControlSvc]: Local call is already being terminated. Ignore leave request."),void(h&&q(h));if(a.checkState([e.CallState.Ringing,e.CallState.Answering]))return void ca(a,{type:c||d.InviteRejectCause.DECLINE},!1,h);u.debug("[CircuitCallControlSvc]: leaveCall - rtcSessionId=",a.callId);var i;return a.clearAtcHandoverInProgress(),a.activeClient?(i=A(a.convId),$(i,a.activeClient,null,function(a){Bb.isTelephonyCall&&(a.atcCallInfo=Bb.atcCallInfo,a.peerUser=Bb.peerUser)}),void M(a,f)):(a.isDirect?yb.terminateRtcCall(a.callId,a.disconnectCause,function(a){b.$apply(function(){a&&u.warn("[CircuitCallControlSvc]: Error terminating RTC call. ",a),h&&h(a)})}):(i=A(a.convId),$(i),yb.leaveRtcCall(a.callId,a.disconnectCause,function(a){b.$apply(function(){a&&u.warn("[CircuitCallControlSvc]: Error leaving the RTC call. ",a),h&&h(a)})})),f===e.CallClientTerminatedReason.PAGE_UNLOADED&&(a.terminateReason=f,z.sendQOSData(a,a.mediaType,a.savedRTPStats)),g||(a.directCall?(u.debug("[CircuitCallControlSvc]: Publish /call/terminating event"),v.publish("/call/terminating",[Bb])):a.conferenceCall?(u.debug("[CircuitCallControlSvc]: Publish /conference/leaving event"),v.publish("/conference/leaving",[a])):(u.debug("[CircuitCallControlSvc]: Publish /group/leaving event"),v.publish("/group/leaving",[a]))),void(a.outgoingFailed()?(a.terminateTimer=q(function(){a.terminateTimer=null,M(a,f)},sb),a.terminateReason=f):M(a,f)))}function ea(a,c){return c=c||function(){},a.isDirect?(u.debug("[CircuitCallControlSvc]: Direct call. Ignore terminate conference request."),void q(c)):(u.debug("[CircuitCallControlSvc]: terminateConference - rtcSessionId=",a.callId),yb.terminateRtcCall(a.callId,a.disconnectCause,function(d){b.$apply(function(){if(d&&(u.warn("[CircuitCallControlSvc]: Error terminating the RTC call. ",d),a===Bb)){var b=A(a.convId);b&&a.isEstablished()&&$(b)}c&&c(d)})}),void(a===Bb&&M(a,e.CallClientTerminatedReason.USER_ENDED)))}function fa(a,c){u.debug("[CircuitCallControlSvc]: endRemoteCall - rtcSessionId=",a.callId),a.isDirect?yb.terminateRtcCall(a.callId,a.disconnectCause,function(a){b.$apply(function(){a&&u.warn("[CircuitCallControlSvc]: Error terminating remote RTC call. ",a),c(a)})}):yb.leaveRtcCall(a.callId,a.disconnectCause,function(a){b.$apply(function(){a&&u.warn("[CircuitCallControlSvc]: Error leaving remote RTC call. ",a),c(a)})})}function ga(a,b,c){var d=a[b.StatText]||{};c===-1?d.reported?d.counter=++d.counter:d.counter&&(delete a[b.StatText],u.debug("[CircuitCallControlSvc]: issueCounter cleared=",b.StatText)):d.reported?(d.counter=0,d.value=c):d.counter?(d.counter=++d.counter,d.value=c):a[b.StatText]={statObj:b,counter:1,value:c}}function ha(a){var b=null,c=Object.keys(a);return c.forEach(function(c){var d=a[c];d.counter>=d.statObj.RecurrenceThreshold?d.reported?(delete a[c],u.debug("[CircuitCallControlSvc]: issueCounter cleared=",c)):(d.reported=!0,d.counter=0,b=b||{},b[c]=!0):d.reported&&(b=b||{},b[c]=!0)}),b}function ia(a,b){var c=0,d=0;return b&&(c=b.pl||0,d=b.ps||0),(a.pl-c)/(a.ps-d||-1)}function ja(a,b){var c=0,d=0;return b&&(c=b.pl||0,d=b.pr||0),(a.pl-c)/(a.pr-d+a.pl-c||-1)}function ka(a,b){var c,d="[CircuitCallControlSvc]: statsReport: audioRtt="+(a.audio&&a.audio.rtt||"n/a")+" videoRtt="+((a.video.receive||a.video.transmit)&&a.video&&a.video.rtt||"n/a");a.audio&&(c=a.audio.receive,c&&(d+="\n audioReceive:  id="+c.id+" pl="+c.pl+" pr="+c.pr+" jr="+c.jr),c=a.audio.transmit,c&&(d+="\n audioTransmit: id="+c.id+" pl="+c.pl+" ps="+c.ps+" os="+c.os)),a.video&&(c=a.video.receive,c&&(d+="\n videoReceive:  id="+c.id+" pl="+c.pl+" pr="+c.pr+" fwr="+c.fwr+" fhr="+c.fhr+" frd="+c.frd),c=a.video.transmit,c&&(d+="\n videoTransmit: id="+c.id+" pl="+c.pl+" ps="+c.ps+" frs="+c.frs+" os="+c.os+" fws="+c.fws+" fhs="+c.fhs)),u.debug(d);var e;d="[CircuitCallControlSvc]: statsReport:\n",b.forEach(function(a,b){d+=0===b?" Audio issues=":"\n Video issues=";var c=Object.keys(a);c.length?(e=!0,c.forEach(function(b){d+=" "+b+"="+a[b].value+" count="+a[b].counter})):d+=" none"}),e&&u.info(d)}function la(a){if(Bb&&0!==a.length){Bb.savedRTPStats||(Bb.savedRTPStats=[],Bb.audioIssues=[],Bb.videoIssues=[]);var b=!1;a.forEach(function(a,c){var d,e=a.audio&&a.audio.transmit,f=a.audio&&a.audio.receive,g=Bb.audioIssues[c]||{},h=Bb.videoIssues[c]||{},i=Bb.savedRTPStats[c]||{};f&&i.audio&&i.audio.receive&&!Bb.isVoicemail&&ga(g,ob.NO_PACKETS_RECV,!(f.pr>i.audio.receive.pr)||-1);var j=ob.GOOG_JITTER_RECEIVED,k=e&&e[j.StatName];ga(g,j,k&&k>=j.Threshold?k:-1),k=f&&f[j.StatName],ga(g,j,k&&k>=j.Threshold?k:-1),j=ob.PACKET_LOSS_SEND,e&&e.pl&&e.ps&&(d=ia(e,i.audio&&i.audio.transmit),ga(g,j,d>=j.Threshold?d:-1)),j=ob.PACKET_LOSS_RECV,f&&f.pl&&f.pr&&(d=ja(f,i.audio&&i.audio.receive),ga(g,j,d>=j.Threshold?d:-1)),Mb>qb.DELAY_RTT_PROCESSING&&(j=ob.GOOG_RTT,ga(g,j,a.audio&&a.audio.rtt>=j.Threshold?a.audio.rtt:-1)),e=a.video&&a.video.transmit,f=a.video&&a.video.receive,j=pb.PACKET_LOSS_SEND,e&&e.pl&&e.ps&&(d=ia(e,i.video&&i.video.transmit),ga(h,j,d>=j.Threshold?d:-1)),j=pb.PACKET_LOSS_RECV,f&&f.pl&&f.pr&&(d=ja(f,i.video&&i.video.receive),ga(h,j,d>=j.Threshold?d:-1)),(e||f)&&Mb>qb.DELAY_RTT_PROCESSING&&(j=pb.GOOG_RTT,ga(h,j,a.video&&a.video.rtt>=j.Threshold?a.video.rtt:-1)),Bb.savedRTPStats[c]=a,Bb.audioIssues[c]=g,Bb.videoIssues[c]=h;var l=ha(g),m=ha(h);(l||m)&&(b=!0,Bb.qualityIssueDetected||(l=l||"none",m=m||"none",Bb.qualityIssueDetected=!0,l.noPacketsReceived?(u.warn("[CircuitCallControlSvc]: processRTPStats - No packets received from remote peer"),Nb||v.publish("/call/rtp/noIncomingPackets",[Bb.callId])):(u.warn("[CircuitCallControlSvc]: processRTPStats - Quality issues detected",[{audio:l},{video:m}]),Nb||v.publish("/call/rtp/threshholdExceeded/detected",[Bb.callId]))))}),!b&&Bb.qualityIssueDetected&&(u.debug("[CircuitCallControlSvc]: processRTPStats - No quality issues detected. Clear threshold exceeded error."),Bb.qualityIssueDetected=!1,Nb||v.publish("/call/rtp/threshholdExceeded/cleared",[Bb.callId])),(Bb.qualityIssueDetected||Mb%tb===0)&&Bb.savedRTPStats.forEach(function(a,b){ka(a,[Bb.audioIssues[b],Bb.videoIssues[b]])}),Mb++}}function ma(a){return Bb?a&&a.length?(Bb.savedRTPStatsNQ||(Bb.savedRTPStatsNQ=[],Bb.savedCurrentQualityLevel=rb.RTP_QUALITY_HIGH,Bb.savedQualityEstimation={noPacketsSeq:0,qualityLevelSeq:0},Bb.didReceiveLowQualityLevel=!1),void a.forEach(function(a,b){var c=0,d=0,e=a.audio&&a.audio.transmit,f=a.audio&&a.audio.receive,g=!0,h=!0,i=Bb.savedRTPStatsNQ[b]||{};!e||isNaN(e.pl)||isNaN(e.ps)||(c=ia(e,i.audio&&i.audio.transmit)||0,c>0&&u.debug("[CircuitCallControlSvc]: processNetworkIndication - current send pl=",c),i.audio&&i.audio.transmit&&i.audio.transmit.ps&&(g=e.ps!==i.audio.transmit.ps),g||u.warn("[CircuitCallControlSvc]: processNetworkIndication - No packets sent to remote peer")),!f||isNaN(f.pl)||isNaN(f.pr)||(d=ja(f,i.audio&&i.audio.receive)||0,d>0&&u.debug("[CircuitCallControlSvc]: processNetworkIndication - current recv pl=",d),i.audio&&i.audio.receive&&i.audio.receive.pr&&(h=f.pr!==i.audio.receive.pr),h||u.warn("[CircuitCallControlSvc]: processNetworkIndication - No packets received from remote peer"));var j={currentPlSend:c,currentPlReceive:d};g&&h?(Bb.savedQualityEstimation.noPacketsSeq=0,j.qualityLevel=rb.getLevel(Math.max(c,d))):(Bb.savedQualityEstimation.noPacketsSeq++,Bb.savedQualityEstimation.noPacketsSeq>1?(j.qualityLevel=rb.RTP_QUALITY_LOW,v.publish("/call/rtp/noIncomingPackets",[Bb.callId])):j.qualityLevel=rb.RTP_QUALITY_HIGH),na(j),Bb.savedRTPStatsNQ[b]=a})):void u.debug("[CircuitCallControlSvc]: processNetworkIndication - No stats for network indication."):void u.debug("[CircuitCallControlSvc]: processNetworkIndication - No primary call for network indication.")}function na(a){var b=Bb.savedQualityEstimation;b.qualityLevel=a.qualityLevel,b.currentPlSend=a.currentPlSend,b.currentPlReceive=a.currentPlReceive;var c=Bb.savedCurrentQualityLevel;if(c!==b.qualityLevel.value&&u.debug("[CircuitCallControlSvc]: setQualityEstimation - estimation="+b.qualityLevel+" seq="+b.qualityLevelSeq+" current="+c),c<b.qualityLevel.value?(b.qualityLevelSeq++,b.qualityLevelSeq>1&&(Bb.savedCurrentQualityLevel=b.qualityLevel.value,b.qualityLevelSeq=0)):(Bb.savedCurrentQualityLevel=b.qualityLevel.value,b.qualityLevelSeq=0),c!==Bb.savedCurrentQualityLevel){var d=1===c&&!Bb.didReceiveLowQualityLevel;d&&(b.firstTimeLowQuality=d,Bb.didReceiveLowQualityLevel=d),oa(b)}}function oa(a){var c={userId:b.localUser.userId,audio:{qualityLevel:a.qualityLevel.value,currentPlSend:a.currentPlSend,currentPlReceive:a.currentPlReceive,firstTimeLowQuality:a.firstTimeLowQuality}};u.debug("[CircuitCallControlSvc]: Publish /call/network/quality event for quality=",c.audio.qualityLevel),v.publish("/call/network/quality",[c])}function pa(){Bb&&Bb.sessionCtrl?Bb.sessionCtrl.getSdpStatus()===e.SdpStatus.Connected&&Bb.sessionCtrl.getRTPStatsForClientDiagnostics(!1,function(a,b){a?u.error("[CircuitCallControlSvc]: getStats error= ",a):(la(b),ma(b))}):u.error("[CircuitCallControlSvc]:getFormattedRTPStats sessionCtrl error")}function qa(){null===Kb&&null===Lb?(u.debug("[CircuitCallControlSvc]: waiting to start collecting RTPstats"),Kb=q(function(){u.debug("[CircuitCallControlSvc]: start Collecting RTPStats"),Kb=null,Mb=0,pa(),Lb=s.setInterval(function(){pa()},qb.COLLECTION_INTERVAL)},qb.DELAY_UPON_ANSWER)):(u.debug("[CircuitCallControlSvc]: Restart collecting RTPStats"),Bb&&(Bb.savedQualityEstimation=null,Bb.savedCurrentQualityLevel=null,Bb.savedRTPStatsNQ=null,Bb.didReceiveLowQualityLevel=!1))}function ra(a,b){var c=a.mediaType;if(a)if(a.sessionCtrl){if(!Kb&&!Lb&&!a.terminateReason)return void u.info("[CircuitCallControlSvc]: Non established local call terminated. No QoS report generated because no disconnect reason was specified. CallId =",a.callId);a.sessionCtrl.isQosDataCollected()||a.sessionCtrl.getRTPStatsForClientDiagnostics(!0,function(b,d){b?u.warn("[CircuitCallControlSvc]: getStats for QoS error= ",b):z.sendQOSData(a,c,d)})}else u.warn("[CircuitCallControlSvc]:getFormattedRTPStats no sessionCtrl error");Kb?(u.debug("[CircuitCallControlSvc]: cancel collecting RTPStats "),q.cancel(Kb),Kb=null):Lb&&(u.debug("[CircuitCallControlSvc]: stop collecting RTPStats"),s.clearInterval(Lb),Lb=null,Bb&&(b&&(Bb.savedQualityEstimation=null,Bb.savedCurrentQualityLevel=null,Bb.savedRTPStatsNQ=null,Bb.didReceiveLowQualityLevel=!1),Bb.savedRTPStats&&u.debug("[CircuitCallControlSvc]: savedRTPStats =",Bb.savedRTPStats),Nb||v.publish("/call/rtp/threshholdExceeded/cleared",[Bb.callId]),Bb.qualityIssueDetected=!1,Bb.savedRTPStats=null))}function sa(a){if(!Bb.isDirect){if(Bb.sessionCtrl.hasMaxExtraVideoChannels())return void u.debug("[CircuitCallControlSvc]: We already have max number of extra video channels");var b=a&&a.participants.length;b||(b=Bb.sessionCtrl.getNumberOfExtraVideoChannels()+2);var c=Math.max(Bb.participants.length+1,b),d=Bb.sessionCtrl.setExtraVideoChannelsForParticipants(c);d&&Bb.isEstablished()&&(u.debug("[CircuitCallControlSvc]: The number of extra channels has increased. Trigger a media renegotiation."),Y(Bb.callId,null,Bb.localMediaType,!1,null,function(a){a&&u.warn("[CircuitCallControlSvc]: Failed to renegotiate the media. Error: ",a)}))}}function ta(a){var b=null;return Db.some(function(c){if(c.callId===a)return b=c,!0}),b}function ua(a){var b=Ib.find(function(b){return b.callId===a});return b||null}function va(a){var b=Db.some(function(b,c){return b===a||b.callId===a.callId&&(Db[c]=a,!0)});b||Db.push(a)}function wa(a,c){if(c=c||function(){},Bb){var d=Bb.getParticipant(a);if(d)if(d.actions.includes(e.ParticipantAction.Drop)){var f={rtcSessionId:Bb.callId,userId:a};yb.removeSessionParticipant(f,function(a){b.$apply(function(){a?(u.warn("[CircuitCallControlSvc]: Failed to remove participant"),c("res_RemoveParticipantFailed")):c()})})}else u.warn("[CircuitCallControlSvc]: remove call participant, unsupported pcState: ",d.pcState.name),c("Participant not active");else u.error("[CircuitCallControlSvc]: call participant not found: ",a),c("Participant not found")}else c("No active call")}function xa(a,b){if(b.streamId){var c=0===a.sessionCtrl.getNumberOfExtraVideoChannels();a.isMocked&&!c||a.participants.forEach(function(c){c.streamId===b.streamId&&c.userId!==b.userId&&(c.streamId="",u.debug("[CircuitCallControlSvc]: The video stream has been re-assigned. Clear the streamId for previous participant. [userId, streamId] = ",[c.userId,b.streamId]),Bb.setParticipantRemoteVideoURL(c),u.debug("[CircuitCallControlSvc]: Publish /call/participant/updated event. userId =",c.userId),v.publish("/call/participant/updated",[a.callId,c]))})}}function ya(a,c){var d=A(a.convId);b.isSessionGuest||(c.setActions(d,b.localUser),u.debug("[CircuitCallControlSvc]: Set participant actions. userId: "+c.userId+", actions: ",c.actions))}function za(a,b,c,d){var e=a.addParticipant(b,c,d);return e&&(xa(a,e),ya(a,e),b.noData&&!b.reqPending&&(u.debug("[CircuitCallControlSvc]: Get user data for added participant. userId: ",b.userId),w.getUserById(b.userId,function(c,d){d&&(u.debug("[CircuitCallControlSvc]: Successfully retrieved participant data. userId: ",b.userId),a.isPresent()&&a.hasParticipant(b.userId)&&(b.firstName=d.firstName,b.lastName=d.lastName,u.debug("[CircuitCallControlSvc]: Publish /call/participant/updated event. userId =",b.userId),v.publish("/call/participant/updated",[a.callId,b])))}))),e}function Aa(a,b,c){var d=a.updateParticipant(b,c);return d&&(xa(a,d),ya(a,d)),d}function Ba(a,b,c){var f=e.ParticipantState.Terminated;switch(c){case d.RTCSessionParticipantLeftCause.CONNECTION_LOST:case d.RTCSessionParticipantLeftCause.STREAM_LOST:f=e.ParticipantState.ConnectionLost;break;case d.RTCSessionParticipantLeftCause.REMOVED:f=e.ParticipantState.Removed;break;case d.RTCSessionParticipantLeftCause.USER_LEFT_STAGE:f=e.ParticipantState.OffStage}a.setParticipantState(b,f);var g=a.removeParticipant(b);if(!a.hasOtherParticipants()){if(!a.conferenceCall)return u.debug("[CircuitCallControlSvc]: Publish /group/terminated event"),v.publish("/group/terminated",[a]),void da(a,null,e.CallClientTerminatedReason.NO_USERS_LEFT,!0);a.setState(e.CallState.Waiting)}if(g){a.updateMediaType(),!a.isRemote&&g.isCMP&&g.isMeetingPointInvitee&&(a.setMeetingPointInviteState(!1),xb.enableRemoteAudio(a.callId)),a.conferenceCall&&(u.debug("[CircuitCallControlSvc]: Publish /conference/participant/left event"),v.publish("/conference/participant/left",[a,c]));var h=c?{leftCause:c}:null;u.debug("[CircuitCallControlSvc]: Publish /call/participant/removed event"),v.publish("/call/participant/removed",[a.callId,g,h])}K(a)}function Ca(a,c){if(!a||!c||!c.state)return null;var e=a.recording;return e.state!==c.state?(e.notifyByCurtain=c.state===d.RecordingInfoState.START_PENDING||c.state===d.RecordingInfoState.STARTED&&e.state===d.RecordingInfoState.START_PENDING,e.notifyByUser=!e.notifyByCurtain||c.state===d.RecordingInfoState.START_PENDING&&e.state!==d.RecordingInfoState.STARTED):(e.notifyByCurtain=!1,e.notifyByUser=!1),e.state=c.state,e.duration=c.duration||e.duration,e.reason=c.reason,c.state===d.RecordingInfoState.STARTED&&(e.resumeTime=Date.now()),c.starter&&c.starter.userId&&c.starter.userId!==e.starter.userId&&(e.starter=c.starter,e.starter.userId===b.localUser.userId?e.starter.res="res_StartedRecording_You":(e.starter.name=e.starter.firstName||e.starter.displayName,e.starter.res=e.starter.name?"res_StartedRecording_Other":"res_StartedRecording")),e}function Da(a){Bb&&void 0!==a&&Bb.attendeeCount!==a&&(Bb.attendeeCount=a,Bb.updateCallState(),u.debug("[CircuitCallControlSvc]: Publish /call/attendeeCountChanged"),v.publish("/call/attendeeCountChanged",[Bb.callId,Bb.attendeeCount]))}function Ea(a){var b=a&&a.sessionCtrl;return b?(b.onIceCandidate=Ga.bind(null,a),b.onSdpConnected=Ha.bind(null,a),b.onRemoteVideoAdded=Ia.bind(null,a),b.onRemoteVideoRemoved=Ja.bind(null,a),b.onRemoteStreamUpdated=Ka.bind(null,a),b.onDTMFToneChange=La.bind(null,a),b.onRtcError=Ma.bind(null,a),b.onRtcWarning=Na.bind(null,a),b.onLocalStreamEnded=Oa.bind(null,a),void(b.onQosAvailable=Pa.bind(null,a))):void u.error("[CircuitCallControlSvc]: Failed to get RtcSessionController for given call. ",a)}function Fa(a){var b=a&&a.sessionCtrl;b&&(b.onIceCandidate=null,b.onSessionDescription=null,b.onSdpConnected=null,b.onRemoteVideoAdded=null,b.onRemoteVideoRemoved=null,b.onRemoteStreamUpdated=null,b.onDTMFToneChange=null,b.onRtcError=null,b.onRtcWarning=null,b.onLocalStreamEnded=null,b.onQosAvailable=null)}function Ga(a,c){u.debug("[CircuitCallControlSvc]: RtcSessionController - onIceCandidate");var d={rtcSessionId:a.callId,userId:b.localUser.userId,origin:c.origin,candidates:c.candidates.map(JSON.stringify.bind(JSON))};yb.sendIceCandidates(d,function(a){a&&u.warn("Failed to sent ICE candidate: ",a)})}function Ha(a){u.debug("[CircuitCallControlSvc]: RtcSessionController - onSdpConnected"),b.$apply(function(){u.debug("[CircuitCallControlSvc]: Publish /call/sdpConnected event"),v.publish("/call/sdpConnected",[a]);var b=a.state;a.isTelephonyCall?a.checkState([e.CallState.Holding,e.CallState.HoldOnHold,e.CallState.Held])||a.setState(e.CallState.Active):a.setState(a.isDirect||a.hasOtherParticipants()?e.CallState.Active:e.CallState.Waiting),
a.checkState(b)||K(a),qa()})}function Ia(){u.debug("[CircuitCallControlSvc]: RtcSessionController - onRemoteVideoAdded")}function Ja(){u.debug("[CircuitCallControlSvc]: RtcSessionController - onRemoteVideoRemoved")}function Ka(a){u.debug("[CircuitCallControlSvc]: RtcSessionController - onRemoteStreamUpdated"),b.$apply(function(){u.debug("[CircuitCallControlSvc]: Publish /call/remoteStreamUpdated event"),v.publish("/call/remoteStreamUpdated",[a])})}function La(a,b){u.debug("[CircuitCallControlSvc]: RtcSessionController - onDTMFToneChange"),b.tone?(u.debug("[CircuitCallControlSvc]: Sent DTMF Digit: "+b.tone),v.publish("/call/singleDigitSent",[a,b.tone])):""===b.tone&&(u.info("[CircuitCallControlSvc]: Digits played completely"),v.publish("/call/digitsSent",[a]))}function Ma(a,b){return u.debug("[CircuitCallControlSvc]: RtcSessionController - onRtcError"),v.publish("/call/rtcError",[a,b.error]),a.checkState([e.CallState.Ringing,e.CallState.Answering])?void ca(a,{type:d.InviteRejectCause.BUSY}):void(a.sameAs(Bb)&&("res_CallMediaFailed"===b.error?(a.setDisconnectCause(d.DisconnectCause.NEGOTIATION_FAILED),xb.endCallWithCauseCode(a.callId,d.InviteRejectCause.TIMEOUT)):"res_CallMediaDisconnected"===b.error?(a.setDisconnectCause(d.DisconnectCause.STREAM_LOST),xb.endCallWithCauseCode(a.callId,e.CallClientTerminatedReason.LOST_MEDIA_STREAM),yb.pingServer()):a.isEstablished()||xb.endCall(a.callId)))}function Na(a,b){u.debug("[CircuitCallControlSvc]: RtcSessionController - onRtcWarning"),v.publish("/call/rtcWarning",[a,b.warning])}function Oa(a,b){u.debug("[CircuitCallControlSvc]: RtcSessionController - onStreamEnded"),b.isDesktop&&Bb.hasLocalScreenShare()?(u.debug("[CircuitCallControlSvc]: Screenshare stream ended, remove screenshare or terminate the call"),Bb.isEstablished()?xb.removeScreenShare(Bb.callId):xb.endCall(Bb.callId)):xb.renegotiateMedia(a.callId,function(b){b&&(u.debug("[CircuitCallControlSvc]: Publish /call/localStreamEnded event"),v.publish("/call/localStreamEnded",[a]))})}function Pa(a,b){u.debug("[CircuitCallControlSvc]: RtcSessionController - onQosAvailable"),z.sendQOSData(a,a.mediaType,b.qos)}function Qa(a){try{u.debug("[CircuitCallControlSvc]: Received RTCSession.ACTIVE_SPEAKER");var b=N(a.sessionId);if(!b)return void u.warn("[CircuitCallControlSvc]: Unexpected event. There is no local call");if(b.isDirect||b.participants.length<2)return void u.debug("[CircuitCallControlSvc]: Ignore RTC.ACTIVE_SPEAKER event for 1-2-1 calls");var c=[];a.first&&c.push(a.first),a.second&&c.push(a.second),a.third&&c.push(a.third);var d=b.setActiveSpeakers(c);if(!d)return;u.debug("[CircuitCallControlSvc]: Publish /call/participant/activeSpeakers event"),v.publish("/call/participants/activeSpeakers",[b.callId,c])}catch(a){u.error("[CircuitCallControlSvc]: Exception handling RTC.ACTIVE_SPEAKER event. ",a)}}function Ra(a){try{u.debug("[CircuitCallControlSvc]: Received RTCSession.VIDEO_ACTIVE_SPEAKER");var c=N(a.sessionId);if(!c)return void u.warn("[CircuitCallControlSvc]: Unexpected event. There is no local call");var d=c.getParticipant(a.userId);if(!d)return void u.debug("[CircuitCallControlSvc]: Participant info not available. Ignoring VIDEO_ACTIVE_SPEAKER. userId=",a.userId);if(d.streamId===a.videoStreamId)return void u.debug("[CircuitCallControlSvc]: Participant is already assigned to the received videoStreamId. Ignoring VIDEO_ACTIVE_SPEAKER");b.$apply(function(){d.streamId=a.videoStreamId,xa(c,d),c.setParticipantRemoteVideoURL(d),c.checkForActiveRemoteVideo(),u.debug("[CircuitCallControlSvc]: Publish /call/participant/updated event. userId =",d.userId),v.publish("/call/participant/updated",[c.callId,d])})}catch(a){u.error("[CircuitCallControlSvc]: Exception handling RTCSession.VIDEO_ACTIVE_SPEAKER event.",a)}}function Sa(a){if(u.debug("[CircuitCallControlSvc]: Processing active session for convId = ",a.convId),!a.participants||0===a.participants.length)return void u.warn("[CircuitCallControlSvc]: The active session does not have participants. rtcSessionId = ",a.rtcSessionId);var c=x.getConversationByRtcSession(a.rtcSessionId);if(c&&(c.hasJoined||c.isTemporary)){if(c.call)return void u.debug("[CircuitCallControlSvc]: Conversation already has an associated call");if(a.turnServers&&V(a.rtcSessionId,a.turnServers),!ua(a.rtcSessionId)){var e,f=!1;if(a.participants.some(function(a){if(a.userId===b.localUser.userId)return e=a,a.clientId===yb.clientId&&(f=!0),!0}),c.type!==d.ConversationType.DIRECT||e){if(f){var g=function(b){b&&u.warn("[CircuitCallControlSvc] Lost session could not be terminated. Session Id=",a.rtcSessionId)},h={disconnectCause:d.DisconnectCause.CONNECTION_LOST,disconnectReason:d.DisconnectReason.CALL_LOST};if(c.type===d.ConversationType.DIRECT)return void yb.terminateRtcCall(a.rtcSessionId,h,g);yb.leaveRtcCall(a.rtcSessionId,h,g)}$(c,e,a,function(b){b.setCallIdForTelephony(a.rtcSessionId),e&&Ta(b,a)})}}}}function Ta(a,b){a&&a.isTelephonyCall&&b&&b.participants&&b.participants.length<=2&&b.participants.some(function(b){if(b.participantType===d.RTCParticipantType.TELEPHONY)return T(a,b.phoneNumber,null,b.userDisplayName),!0})}function Ua(a){var c=!1,d=N(a.rtcSessionId);return d&&a.participants&&(c=a.participants.some(function(a){return a.userId===b.localUser.userId&&a.clientId===yb.clientId})),c}function Va(){return new t(function(a,c){return Ob||b.isSessionGuest?(u.debug("[CircuitCallControlSvc]: Initialize active RTC sessions"),void yb.getActiveSessions(function(c,d){b.$apply(function(){c&&u.error("[CircuitCallControlSvc]: Error getting active sessions: ",c),d=d||[];for(var f=Ab.length-1;f>=0;f--)Ab[f].isRemote&&M(Ab[f]);Db.empty();var g=null,h=!1,i=!1,j=[];d.forEach(function(a){var c=N(a.rtcSessionId);if(c){if(Ua(a))return h=h||c===Bb,i=i||c===Cb,u.info("[CircuitCallControlSvc]: Found localCall in active sessions. Trigger media renegotiation."),void xb.renegotiateMedia(c.callId);M(c,e.CallClientTerminatedReason.LOST_WEBSOCKET_CONNECTION)}return g=x.getConversationByRtcSession(a.rtcSessionId),g&&g.hasJoined?void Sa(a):void(a.invitedGuests&&a.invitedGuests.contains(b.localUser.userId)?(u.info("[CircuitCallControlSvc]: Local user is invited as guest to this session"),j.push(x.createConversationAsGuestFromSummary(a.convId))):g||(u.info("[CircuitCallControlSvc]: Conversation associated with session is not cached. Need to get it."),j.push(x.getConversationPromise(a.convId))))}),v.publish("/activeSessions/received"),Cb&&!i&&M(Cb,e.CallClientTerminatedReason.LOST_WEBSOCKET_CONNECTION),Bb&&!h&&M(Bb,e.CallClientTerminatedReason.LOST_WEBSOCKET_CONNECTION),j.length>0?(u.info("[CircuitCallControlSvc]: Wait for get conversation promises to be resolved."),t.all(j).then(function(c){var d=c.map(function(a){return a.convId});u.debug("[CircuitCallControlSvc]: Retrieved the missing conversation(s): ",d),u.debug("[CircuitCallControlSvc]: Now that we have all the conversations, check if they still have active RTC sessions."),yb.getActiveSessions(function(c,e){b.$apply(function(){c&&(u.error("[CircuitCallControlSvc]: Error getting active sessions: ",c),e=[]),e.forEach(function(a){d.indexOf(a.convId)!==-1&&(Ua(a)||Sa(a))}),a()})})}).catch(function(a){u.error("[CircuitCallControlSvc]: Failed to retrieve the conversation(s). ",a)})):a()})})):void c("Not ready to initialize active sessions")})}function Wa(a,b,c){var d;d=c.isRemote?new h(b):new f(b),b.call=d,d.terminate(),u.debug("[CircuitCallControlSvc]: Publish /call/ended event"),v.publish("/call/ended",[d,!0]),b.call=null,u.debug("[CircuitCallControlSvc]: Publish /conversation/update event"),v.publish("/conversation/update",[b]),c.updateCall(a),a.call=c,u.debug("[CircuitCallControlSvc]: Publish /conversation/update event"),v.publish("/conversation/update",[a]),K(c),u.debug("[CircuitCallControlSvc]: Publish /call/moved event"),v.publish("/call/moved",[d.callId,c.callId])}function Xa(a,b){var c={rtcSessionId:a,transactionId:b};yb.changeMediaReject(c,function(a){a?u.error("[CircuitCallControlSvc]: changeMediaReject sending error"):u.debug("[CircuitCallControlSvc]: changeMediaReject sent")})}function Ya(a,b){if(u.debug("[CircuitCallControlSvc]: Publish /call/incoming event"),v.publish("/call/incoming",[a.call]),!a.muted&&y){var c=a.call.isGuestInvite?e.NotificationType.INCOMING_INVITATION_AS_GUEST:a.call.mediaType.video?e.NotificationType.INCOMING_VIDEO_CALL:e.NotificationType.INCOMING_VOICE_CALL,f={type:c,userId:b,extras:{conversation:a,call:a.call}};a.isTelephonyConv&&(f.user=a.call.peerUser),y.show(f)}a.call.startRingingTimer(function(){ca(a.call,{type:d.InviteRejectCause.TIMEOUT},!1)})}function Za(a,c){if(!a||!c)return void u.error("[CircuitCallControlSvc]: processInvite called without evt or conversation");var d=null,h=!1,i=!1,k=!1;if(a.replaces&&ta(a.replaces))h=!0;else if(Bb)if(Bb.callId===a.replaces)i=Bb.sessionCtrl&&Bb.sessionCtrl.isMuted(),d=Bb;else if(Bb.terminateTimer){if(Bb.callId===a.sessionId)return u.debug("[CircuitCallControlSvc]: Reject incoming call. Current call still not terminated"),void aa(a);M(Bb)}else{if(Bb.callId===a.sessionId)return void(Bb.isDirect?(u.debug("[CircuitCallControlSvc]: INVITE for same local call. Reject it"),aa(a)):u.warn("[CircuitCallControlSvc]: INVITE for same conversation as local call. Ignore it."));if(!Bb.isEstablished()&&(!c.isTelephonyConv||S()))return u.debug("[CircuitCallControlSvc]: Reject incoming call. Current call still not established"),void aa(a)}c.isTelephonyConv?a.to&&a.to.displayName&&a.to.displayName.startsWith("handover-from")&&(u.debug("[CircuitCallControlSvc]: Received handover call"),Qb?(k=!0,q.cancel(Qb),Qb=null):(u.warn("[CircuitCallControlSvc]: INVITE for handover call from another client. Ignore it."),h=!0)):Eb&&Eb.callId===a.replaces&&(i=Fb,d=Eb);var l=ua(a.sessionId);if(l)return void u.warn("[CircuitCallControlSvc]: INVITE for existing ringing call. Ignore it.");if(!h&&!d&&Ib.length>=1&&!k&&(!c.isTelephonyConv||S()))return u.debug("[CircuitCallControlSvc]: Reject second incoming call."),void aa(a);if(c.isTelephonyConv&&!k&&!h){if(b.localUser.selectedRoutingOption===j.DeskPhone.name)return void ba(c,a,!0);if(b.localUser.selectedBusyHandlingOption&&b.localUser.selectedBusyHandlingOption!==o.DefaultRouting.name){if(Bb||Ib.length>=1||!Db.isEmpty()||c.call&&c.call.isAtcRemote)return void ba(c,a)}else if(Bb&&Bb.isPresent()&&Cb&&Cb.isPresent())return u.debug("[CircuitCallControlSvc]: Reject incoming call. We cannot handle more than 2 local phone calls"),void aa(a)}var m={isAtcPullCall:c.isTelephonyConv&&k&&"offer"===a.sdp.type};d&&d.localMediaType.desktop&&(m.reuseDesktopStreamFrom=d.sessionCtrl);var r=new f(c,m);if(r.setCallIdForTelephony(a.sessionId),r.setInstanceId(a.instanceId),r.setTransactionId(a.transactionId),r.sessionCtrl.enableTrickleIce(),d){r.replaces=d;var s=d.sessionCtrl.getLocalStream(p.LOCAL_STREAMS.DESKTOP);s&&(u.debug("[CircuitCallControlSvc] Reusing desktop stream from call ID=",d.callId),r.sessionCtrl.setLocalStream(p.LOCAL_STREAMS.DESKTOP,s),d.sessionCtrl.setLocalStream(p.LOCAL_STREAMS.DESKTOP,null))}Gb&&(u.info("[CircuitCallControlSvc] Disabling remote video for incoming call"),r.disableRemoteVideo()),r.setState(e.CallState.Ringing),r.direction=e.CallDirection.INCOMING;var t=a.mediaType||["AUDIO"];za(r,U({userId:a.userId},t),e.ParticipantState.Calling),r.ringingTimeout=a.ringingTimeout||r.ringingTimeout;var w=g.getMediaType(t);if(r.mediaType=w,w.desktop&&u.debug("[CircuitCallControlSvc]: INVITE for a Screen Share"),h)return void I(r,!0);var x=function(){b.$apply(function(){if(r.state===e.CallState.Terminated)return void u.debug("[CircuitCallControlSvc]: New alerting call has been terminated already");Ea(r),u.debug("[CircuitCallControlSvc]: New alerting call: ",r.callId),c.call&&!c.isTelephonyConv&&(u.debug("[CircuitCallControlSvc]: Terminate the remote call and add the new local call to the conversation"),M(c.call));var f=null;return c.call&&c.call.isAtcRemote&&(f=c.call.callId),c.call=r,c.isTelephonyConv&&k?(u.debug("[CircuitCallControlSvc]: Publish /atccall/replace event"),v.publish("/atccall/replace",[r,f])):(u.debug("[CircuitCallControlSvc]: Publish /conversation/update event"),v.publish("/conversation/update",[c])),d?void xb.answerCall(r.callId,d.localMediaType,function(a){a||i&&Bb.sessionCtrl&&Bb.sessionCtrl.mute()}):(b.localUser.isCMP&&(k=!0,w.video=!0,w.desktop=!1),k?(r.isTelephonyCall&&a.from&&T(r,a.from.phoneNumber,null,a.from.displayName),void xb.answerCall(r.callId,w)):(yb.sendProgress(r.callId,a.userId,b.localUser.userId,function(a){a&&u.error("[CircuitCallControlSvc]: sendProgress error",a)}),r.isTelephonyCall&&a.from?void T(r,a.from.phoneNumber,null,a.from.displayName,null,function(){c.call===r&&Ya(c,a.userId)}):void Ya(c,a.userId)))})},y=r.sessionCtrl,z=W(c.rtcSessionId);b.localUser.isCMP&&y.useMaxNumberOfExtraVideoChannels(),I(r),C(r.callId).then(function(b){z?(u.debug("[CircuitCallControlSvc]: Using TURN servers associated with session: ",z),y.setTurnUris(z)):(u.debug("[CircuitCallControlSvc]: Using retrieved TURN servers"),y.setTurnUris(b.turnServer)),y.setTurnCredentials(b),u.debug("[CircuitCallControlSvc]: Set TURN credentials");var c;if(r.replaces)c=r.replaces.localMediaType;else{var d="firefox"===n.browser,e="android"===n.browser;c={audio:!d&&!e,video:!1}}bb(c,function(b){y.warmup(b,a.sdp,x,function(a){u.warn("[CircuitCallControlSvc]: Warmup failed. Ignore the incoming call, ",a),v.publish("/call/warmupFailed",[a,r])})})})}function $a(a,c){if(a&&c)return a.hasJoined||a.isTemporary?void c.some(function(c){if(a.rtcSessionId===c.rtcSessionId){if(u.debug("[CircuitCallControlSvc]: Processing active session for convId = ",a.convId),!c.participants||0===c.participants.length)return u.warn("[CircuitCallControlSvc]: The active session does not have participants. rtcSessionId = ",c.rtcSessionId),!0;var e;return c.participants.some(function(a){if(a.userId===b.localUser.userId)return e=a,!0}),a.type===d.ConversationType.DIRECT&&!e||(a.call?(u.debug("[CircuitCallControlSvc]: Conversation already has an associated call"),!0):($(a,e,c,function(a){e?Ta(a,c):a.conferenceCall&&(u.debug("[CircuitCallControlSvc]: Publish /conference/started event"),v.publish("/conference/started",[a]))}),!0))}}):void u.debug("[CircuitCallControlSvc]: User is not a conversation participant. Ignore active session.")}function _a(a,b,c){var d=N(a);return d?(u.info("[CircuitCallControlSvc]: Sending DTMF Digits=",b),void(d.sessionCtrl.sendDTMFDigits(b)||(u.error("[CircuitCallControlSvc]: Cannot send DTMF digits"),c("res_CannotSendDTMF")))):(u.info("[CircuitCallControlSvc]: sendDTMFDigits - The given call ID does not match the local call"),void c("Invalid callId"))}function ab(a,c,e,f){a.type===d.ConversationType.LARGE&&b.isSessionGuest&&(c.audio=!1,u.debug("[CircuitCallControlSvc]: Set media type for large conference participant to ",c)),bb(c,function(b,c){e.warning=c,X(a,b,e,f)})}function bb(a,c){if(u.debug("[CircuitCallControlSvc]: Check media sources for mediaType = ",a),b.browser.msie&&!b.isSessionGuest&&!b.localUser.hasPermission(d.SystemPermission.IE_PLUGIN_SUPPORT))return u.debug("[CircuitCallControlSvc]: User does not have permission to use IE plugin. Publish /ieplugin/permissionDenied event."),void v.publish("/iePlugin/permissionDenied");var e;return a=a||{audio:!0,video:!1},mb||nb||!a.audio&&!a.video?(u.debug("[CircuitCallControlSvc]: Normalized mediaType = ",a),void c(a)):(u.debug("[CircuitCallControlSvc]: Get audio and video media sources"),void n.getMediaSources(function(b,d){a.video&&(!d||d.length<1)&&(a.video=!1,e="res_AnswerWarnNoCamera"),a.audio&&(!b||b.length<1)&&(a.audio=!1,e="res_AnswerWarnNoCamera"===e?"res_AccessToMediaInputDevicesFailed":"res_AccessToAudioInputDeviceFailed"),u.debug("[CircuitCallControlSvc]: Normalized mediaType = ",a),c(a,e)}))}function cb(a){a&&a.activeNotification&&!a.isHandoverInProgress&&(y&&y.dismiss(a.activeNotification),a.activeNotification=null)}function db(a,c,d){var e={content:{type:"PARTICIPANT_POINTER",x:c,y:d,userId:b.localUser.userId},destUserId:a};zb.sendDesktopAppRequest(e,function(a){a?u.error("[CircuitCallControlSvc]: Error sending participant pointer coordinates: ",a):u.info("[CircuitCallControlSvc]: Successfully sent participant pointer coordinates.")})}function eb(a,c,d){var e={content:{type:"PARTICIPANT_DRAWING",points:c,options:d||{},userId:b.localUser.userId},destUserId:a};zb.sendDesktopAppRequest(e,function(a){a?u.error("[CircuitCallControlSvc]: Error sending participant drawing coordinates: ",a):u.info("[CircuitCallControlSvc]: Successfully sent participant drawing coordinates.")})}function fb(a,c){if(a&&a.hasLocalScreenShare()&&a.checkState([e.CallState.Active,e.CallState.Waiting])){var d=c&&a.getParticipant(c),f=d&&d.displayName;u.debug("[CircuitCallControlSvc]: Publish /screenshare/forceStop/started event"),v.publish("/screenshare/forceStop/started",[c]),xb.removeScreenShare(a.callId,function(a){u.debug("[CircuitCallControlSvc]: Publish /screenshare/forceStop/ended event"),v.publish("/screenshare/forceStop/ended",[a])}),y&&y.show({type:e.NotificationType.HIGH_PRIORITY,user:b.localUser,extras:{title:b.i18n.map.res_ScreenShareRemotelyDisabledTitle,text:f?b.i18n.localize("res_ScreenShareRemotelyDisabledByUser",[f]):b.i18n.map.res_ScreenShareRemotelyDisabled}})}}function gb(a){xb.mute(a),xb.disableRemoteAudio(a)}function hb(a,c,f){if(f=f||function(){},!a||!c)return u.error("[CircuitCallControlSvc]: addParticipant - Invalid arguments"),void f("Invalid arguments");var g=c.dialOutPhoneNumber,h=g?{userId:"gtc-callout-"+g.replace(/[+ ]+/g,""),phoneNumber:m.cleanPhoneNumber(g),displayName:c.displayName,resolvedUserId:c.userId,isExternal:!0,participantType:d.RTCParticipantType.TELEPHONY,pstnDialIn:!1}:c;if(!h.userId)return u.warn("[CircuitCallControlSvc]: addParticipant - Participant missing userId"),void f("Missing userId");if(a.hasParticipant(h.userId)||h.resolvedUserId&&a.hasParticipant(h.resolvedUserId))return u.info("[CircuitCallControlSvc]: addParticipantTo - Participant is already in the call"),void f("Participant exists");u.debug("[CircuitCallControlSvc]: Adding participant to existing RTC session. userId =",h.userId);var i=m.shallowCopy(a.mediaType);i.audio=!0;var j={rtcSessionId:a.callId,userId:h.userId,mediaType:i};g&&(j.from={phoneNumber:m.cleanPhoneNumber(b.localUser.callerId),displayName:b.localUser.displayName},j.to={phoneNumber:h.phoneNumber,displayName:h.displayName,resolvedUserId:h.resolvedUserId}),yb.addParticipantToRtcSession(j,function(c){b.$apply(function(){if(c){if(c===d.ErrorCode.PERMISSION_DENIED)return u.info("[CircuitCallControlSvc]: Failed to add participant. Reached conference participants limit"),void f("res_MaxConversationParticipantsLimit");u.warn("[CircuitCallControlSvc]: Failed to add participant"),f("res_AddParticipantToRtcSessionFailed")}else{if(u.debug("[CircuitCallControlSvc]: Add participant request was successful"),a.direction=e.CallDirection.OUTGOING,!a.isRemote){var b=U(h,["AUDIO"]),g=e.ParticipantState.Initiated,i=za(a,b,g);i&&(i.isCMP&&(i.isMeetingPointInvitee=!0,a.setMeetingPointInviteState(!0),gb(a.callId)),u.debug("[CircuitCallControlSvc]: Publish /call/participant/added event"),v.publish("/call/participant/added",[a.callId,i]))}f()}})})}function ib(a){u.debug("[CircuitCallControlSvc]: Publish /call/localUser/muted event"),v.publish("/call/localUser/muted",[a.callId,a.remotelyMuted,a.locallyMuted])}function jb(a,c,d){if(d=d||function(){},Ib.length>=1)return d("res_CannotJoinMultipleSessions"),!1;var e=Bb&&Bb.isPresent();if(e)if(Bb.isTelephonyCall){if(!a.isTelephonyConv||!b.localUser.isATC)return d("res_CannotJoinMultipleSessions"),!1;if(Cb)return d("res_CannotInitiateThirdPhoneCall"),!1}else if(!c)return d("res_CannotJoinMultipleSessions"),!1;for(var f=0;f<Ab.length;f++)if(!Ab[f].state.established&&Ab[f].isTelephonyCall)return u.error("[CircuitCallControlSvc]: Cannot initiate second phone call if existing call is not established"),d("res_JoinRTCSessionFailed"),!1;return!0}var kb=a.Conversation,lb=a.UserProfile;u.debug("New Service: CircuitCallControlSvc (NEW)");var mb=m.isMobile(),nb="dotnet"===s.navigator.platform,ob=Object.freeze({GOOG_JITTER_RECEIVED:{StatName:"jr",StatText:"googJitterReceived",Threshold:50,RecurrenceThreshold:mb?2:3},GOOG_RTT:{StatName:"rtt",StatText:"googRtt",Threshold:300,RecurrenceThreshold:mb?2:3},PACKET_LOSS_RECV:{StatName:"",StatText:"packetLossRecv",Threshold:.05,RecurrenceThreshold:mb?2:3},PACKET_LOSS_SEND:{StatName:"",StatText:"packetLossSend",Threshold:.05,RecurrenceThreshold:mb?0:3},NO_PACKETS_RECV:{StatName:"",StatText:"noPacketsReceived",Threshold:0,RecurrenceThreshold:mb?2:3}}),pb=Object.freeze({GOOG_RTT:{StatName:"rtt",StatText:"googRtt",Threshold:300,RecurrenceThreshold:mb?2:3},PACKET_LOSS_RECV:{StatName:"",StatText:"packetLossRecv",Threshold:.05,RecurrenceThreshold:mb?2:3},PACKET_LOSS_SEND:{StatName:"",StatText:"packetLossSend",Threshold:.05,RecurrenceThreshold:mb?0:3}}),qb=Object.freeze({COLLECTION_INTERVAL:5e3,DELAY_UPON_ANSWER:mb?0:5e3,DELAY_RTT_PROCESSING:3}),rb=Object.freeze({RTP_QUALITY_LOW:{levelName:"low",value:1,threshold:.1},RTP_QUALITY_MEDIUM:{levelName:"medium",value:2,threshold:.03},RTP_QUALITY_HIGH:{levelName:"high",value:3,threshold:0},getLevel:function(a){return a>this.RTP_QUALITY_LOW.threshold?this.RTP_QUALITY_LOW:a>this.RTP_QUALITY_MEDIUM.threshold?this.RTP_QUALITY_MEDIUM:this.RTP_QUALITY_HIGH}}),sb=3200,tb=6,ub=6e4,vb=6e3,wb=2e3,xb=this,yb=c.getInstance(),zb=l.getInstance(),Ab=[],Bb=null,Cb=null,Db=[],Eb=null,Fb=!1,Gb=!1,Hb={},Ib=[],Jb=null,Kb=null,Lb=null,Mb=0,Nb=!1,Ob=!1,Pb={},Qb=null,Rb=null;return v.subscribe("/conversation/update",function(a){var c=N(a.rtcSessionId);c&&!c.isDirect&&(u.debug("[CircuitCallControlSvc]: Received /conversation/update event. convId: ",a.convId),sa(a),c.participants.forEach(function(c){c.setActions(a,b.localUser),u.debug("[CircuitCallControlSvc]: Set participant actions. userId: "+c.userId+", actions: ",c.actions)}))}),v.subscribe("/conversation/upgrade",function(a,b){if(u.debug("[CircuitCallControlSvc]: Received /conversation/upgrade event. Old convId = "+a.convId+". New convId = ",b.convId),a.call&&b.convId!==a.convId&&a.call.checkState(e.CallState.Active))if(u.debug("[CircuitCallControlSvc]: Move Session"),a.type===d.ConversationType.DIRECT&&b.type===d.ConversationType.GROUP)X(b,a.call.localMediaType,{callOut:!0,handover:!1,replaces:a.call},function(c){c||a.call.sessionCtrl&&a.call.sessionCtrl.isMuted()&&b.call.sessionCtrl&&b.call.sessionCtrl.mute()});else{var c={sessionId:a.rtcSessionId,conversationId:a.convId,newSessionId:b.rtcSessionId,newConversationId:b.convId};yb.moveRtcSession(c,function(a){a&&u.warn("[CircuitCallControlSvc]: Error moving RTC Session. ",a)})}}),v.subscribe("/conversation/left",function(a){u.debug("[CircuitCallControlSvc]: Received /conversation/left event. convId = "+a.convId),a&&a.call&&xb.hideRemoteCall(a.call.callId)}),v.subscribe("/conversation/participants/add",function(a,b){u.debug("[CircuitCallControlSvc]: Received /conversation/participants/add event."),a&&b&&b.forEach(function(b){hb(a,b)})}),v.subscribe("/csta/handover",function(){u.debug("[CircuitCallControlSvc]: Received /csta/handover event."),Qb=q(function(){Qb=null},vb)}),v.subscribe("/atccall/moveFailed",function(){u.debug("[CircuitCallControlSvc]: Received /atccall/moveFailed event."),Qb&&(q.cancel(Qb),Qb=null)}),v.subscribe("/conversations/loadComplete",function(){u.debug("[CircuitCallControlSvc]: Received /conversations/loadComplete event"),Ob=!0,Va()}),v.subscribe("/registration/state",function(a){u.debug("[CircuitCallControlSvc]: Received /registration/state event"),a!==RegistrationState.Registered?(Bb&&Bb.isTestCall&&M(Bb,e.CallClientTerminatedReason.LOST_WEBSOCKET_CONNECTION),Ib.forEach(function(a){u.debug("[CircuitCallControlSvc]: Lost websocket connection, terminate local incoming call"),M(a,e.CallClientTerminatedReason.LOST_WEBSOCKET_CONNECTION)}),a!==RegistrationState.Disconnected&&a!==RegistrationState.Waiting||Ab.forEach(function(a){M(a,e.CallClientTerminatedReason.LOST_WEBSOCKET_CONNECTION)})):b.isSessionGuest&&Bb&&Va()}),v.subscribe("/conversation/re-added",function(a){u.debug("[CircuitCallControlSvc]: Received /conversation/re-added event. convId = ",a.convId),yb.getSession(a.rtcSessionId,function(c,d){c?u.warn("[CircuitCallControlSvc] Error retrieving session. Err: ",c):d.participants&&d.participants.length>0&&b.$apply(function(){$a(a,[d])})})}),v.subscribe("/call/meetingPointInvitee",function(a){if(u.debug("[CircuitCallControlSvc]: Received /call/meetingPointInvitee event"),a){var b=N(a);b&&(b.setMeetingPointInviteState(!0),gb(a))}}),a.isElectron&&(zb.on("DESKTOP_APP.PARTICIPANT_POINTER",function(a,b){try{u.debug("[CircuitCallControlSvc]: Received UserToUser DESKTOP_APP.PARTICIPANT_POINTER"),a.userId=b.srcUserId,w.getUserById(a.userId,function(b,c){return b?void u.error("[CircuitCallControlSvc]: User not found.",a.userId):void(Bb.hasLocalScreenShare()&&(a.name=c.displayName,require("electron").ipcRenderer.send("participant-pointer",a)))})}catch(a){u.error("[CircuitCallControlSvc]: Exception handling UserToUser DESKTOP_APP.PARTICIPANT_POINTER event.",a)}}),zb.on("DESKTOP_APP.PARTICIPANT_DRAWING",function(a,c){try{u.debug("[CircuitCallControlSvc]: Received UserToUser DESKTOP_APP.PARTICIPANT_DRAWING"),b.circuitLabs.PARTICIPANT_DRAWING&&(a.userId=c.srcUserId,w.getUserById(a.userId,function(b,c){return b?void u.error("[CircuitCallControlSvc]: User not found.",a.userId):void(Bb.hasLocalScreenShare()&&(a.name=c.displayName,require("electron").ipcRenderer.send("participant-drawing",a)))}))}catch(a){u.error("[CircuitCallControlSvc]: Exception handling UserToUser DESKTOP_APP.PARTICIPANT_POINTER event.",a)}})),zb.on("ATC.ADVANCING",function(a){try{if("ADVANCING"===a.type){u.debug("[CircuitCallControlSvc]: Received UserToUser ATC.ADVANCING");var b=ua(a.rtcSessionId);b&&(b.atcAdvancing=!0,b.sessionCtrl.setIgnoreNextConnection(!0))}}catch(a){u.error("[CircuitCallControlSvc]: Exception handling UserToUser ATC.ADVANCING event. ",a)}}),yb.on("RTCCall.SDP_ANSWER",function(a){try{u.debug("[CircuitCallControlSvc]: Received RTCCall.SDP_ANSWER");var c=N(a.sessionId);if(!c)return void u.warn("[CircuitCallControlSvc]: Unexpected event. There is no local call");if(yb.clientId!==a.clientID)return void u.debug("[CircuitCallControlSvc]: Event is not for this client: ",yb.clientId);b.$apply(function(){var b=a.sdp;b&&(b.sdp&&"sdp"!==b.sdp&&"data"!==b.sdp||(b.sdp="sdp",u.debug("[CircuitCallControlSvc]: This is a mocked call"),c.setMockedCall()),c.setInstanceId(a.instanceId),c.sessionCtrl.setRemoteDescription(b,function(a){a&&(c.setDisconnectCause(d.DisconnectCause.REMOTE_SDP_FAILED,"type="+b.type+" origin="+k.getOrigin(b.sdp)),da(c,null,e.CallClientTerminatedReason.SET_REMOTE_SDP_FAILED))}))})}catch(a){u.error("[CircuitCallControlSvc]: Exception handling RTCCall.SDP_ANSWER event. ",a)}}),yb.on("RTCCall.ICE_CANDIDATES",function(a){try{u.debug("[CircuitCallControlSvc]: Received RTCCall.ICE_CANDIDATES",a);var b=N(a.sessionId);if(!b)return void u.warn("[CircuitCallControlSvc]: Unexpected event. There is no local call");if(yb.clientId!==a.clientId)return void u.debug("[CircuitCallControlSvc]: Event is not for this client: ",yb.clientId);b.sessionCtrl.addIceCandidates(a.origin,a.candidates)}catch(a){u.error("[CircuitCallControlSvc]: Exception handling RTCCall.ICE_CANDIDATES event. ",a)}}),yb.on("RTCSession.SESSION_UPDATED",function(a){b.$apply(function(){try{u.debug("[CircuitCallControlSvc]: Received RTCSession.SESSION_UPDATED");var c;a.session.participants.some(function(a){if(a.userId===b.localUser.userId)return c=a,!0});var f,h=N(a.sessionId);if(c){var i=ta(a.sessionId);if(i)return u.debug("[CircuitCallControlSvc]: Event is for an existing active remote call"),i.mediaType=g.getMediaType(a.session.mediaTypes),i.setActiveClient(c),void K(i);var j=ua(a.sessionId);if(j)return void u.debug("[CircuitCallControlSvc]: Event is for an existing active remote call");if(!h||h.callId!==a.sessionId&&!Q(!0))return(f=x.getConversationByRtcSession(a.sessionId))?c.clientId===yb.clientId?void u.warn("[CircuitCallControlSvc]: Event is for a local call that has been terminated. Ignore event."):void $(f,c,a.session,function(b){b.setCallIdForTelephony(a.sessionId),Ta(b,a.session)}):void u.warn("[CircuitCallControlSvc]: Could not find corresponding conversation");if(c.clientId!==yb.clientId){f=A(h.convId);var k=null,l=null,m=null;h.isTelephonyCall&&(k=h.peerUser.phoneNumber,l=h.peerUser.displayName,m=h.participants);var n=h.atcCallInfo;return M(h,e.CallClientTerminatedReason.ANOTHER_CLIENT_PULLED_CALL),void $(f,c,a.session,function(b){b.setCallIdForTelephony(a.sessionId),b.atcCallInfo=n,b.isTelephonyCall&&(T(b,k,null,l),b.participants=m)})}h.remotelyMuted!==c.muted&&(h.remotelyMuted=c.muted,ib(h))}else if(!h||!h.isLarge)return void u.info("[CircuitCallControlSvc]: Not a large conference and local user is not in the participants list. Ignore event. ");h.instanceId||h.setInstanceId(a.session.instanceId),a.session.muted!==h.sessionMuted&&(h.sessionMuted=a.session.muted,u.debug("[CircuitCallControlSvc]: Publish /call/muted event"),v.publish("/call/muted",[h])),a.session.locked!==h.sessionLocked&&(h.sessionLocked=a.session.locked,u.debug("[CircuitCallControlSvc]: Publish /call/locked event"),v.publish("/call/locked",[h])),a.stageAction&&(u.debug("[CircuitCallControlSvc]: Publish /call/raiseHand/stageAction event"),v.publish("/call/raiseHand/stageAction",[a.stageAction])),a.session.curtain&&(h.curtain=a.session.curtain,u.debug("[CircuitCallControlSvc]: Publish /call/curtain event (session updated)"),v.publish("/call/curtain",[h.curtain])),h.whiteboardEnabled=!!a.session.whiteboardEnabled;var o=[],p=[],q=a.session.participants||[];b.localUser.isCMP||q.some(function(a,c){if(a.userId===b.localUser.userId)return q.splice(c,1),!0});var r;if(h.isDirect||h.isAtcConferenceCall()||(r=h.participants.filter(function(a){return a.pcState!==e.ParticipantState.Initiated}).map(function(a){return a.userId})),q.length>0||h.conferenceCall){var s=g.getMediaType(a.session.mediaTypes);if(s.audio=s.audio||h.localMediaType.audio,s.video=s.video||h.localMediaType.video,s.desktop=s.desktop||h.localMediaType.desktop,h.mediaType=s,h.activeClient=null,h.replaces){var t=O(h.replaces.callId);t&&da(t,null,e.CallClientTerminatedReason.CALL_MOVED_TO_ANOTHER_CONV),u.debug("[CircuitCallControlSvc]: Publish /call/moved event"),v.publish("/call/moved",[h.replaces.callId,h.callId]),h.replaces=null}h.isAtcConferenceCall()||q.forEach(function(a){var b=!1,c=U(a),d=c.muted?e.ParticipantState.Muted:e.ParticipantState.Active,f=h.getParticipant(a.userId);if(P(c,h),f){r&&r.remove(a.userId);var g=f.pcState,i=f.videoUrl;f.streamId===c.streamId&&f.hasSameMediaType(c)||(b=!0);var j=Aa(h,c,d);j&&(b||j.pcState!==g||j.videoUrl!==i)&&p.push(j)}else{var k=za(h,c,d);k&&o.push(k)}})}var w=h.state;if(Da(a.session.attendeeCount),(h.conferenceCall||h.checkState(e.CallState.Answering))&&(h.isEstablished()||h.setState(e.CallState.Waiting),h.updateCallState()),h.checkState(w)||K(h),f=b.isSessionGuest?null:A(h.convId),sa(f),h.conferenceCall&&!h.hasOtherParticipants()&&(u.debug("[CircuitCallControlSvc]: Publish /conference/starting event"),v.publish("/conference/starting",[h])),r&&r.length>0&&r.forEach(function(a){var b=h.removeParticipant(a);b&&(u.debug("[CircuitCallControlSvc]: Publish /call/participant/removed event. userId = ",a),v.publish("/call/participant/removed",[h.callId,b]))}),p.length>0&&(u.debug("[CircuitCallControlSvc]: Publish /call/participants/updated event"),v.publish("/call/participants/updated",[h.callId,p])),o.length>0&&(u.debug("[CircuitCallControlSvc]: Publish /call/participants/added event"),v.publish("/call/participants/added",[h.callId,o])),!h.isTestCall&&a.session.recordingInfo&&a.session.recordingInfo.state!==d.RecordingInfoState.INITIAL){var y=Ca(h,a.session.recordingInfo);y&&(u.debug("[CircuitCallControlSvc]: Publish /call/recording/info event"),v.publish("/call/recording/info",[h]))}h.isJoiningGroupCall=!1,
H()}catch(a){u.error("[CircuitCallControlSvc]: Exception handling RTCSession.SESSION_UPDATED event. ",a)}})}),yb.on("RTCSession.SESSION_STARTED",function(a){if(!Ob)return void u.info("[CircuitCallControlSvc]: Conversations are not loaded. Do not process the SESSION_STARTED event.");try{u.debug("[CircuitCallControlSvc]: Received RTCSession.SESSION_STARTED");var c=N(a.sessionId);if(c&&c.isTestCall)return void u.debug("[CircuitCallControlSvc]: Received SESSION_STARTED event for echo test call. Just ignore it.");a.session.turnServers&&V(a.sessionId,a.session.turnServers);var e=A(a.convId);if(!e){if(u.info("[CircuitCallControlSvc]: Could not find corresponding conversation"),a.callOut)return;return u.info("[CircuitCallControlSvc]: Get the conversation from the server"),void x.getConversationById(a.convId,{randomLoaded:!0},function(a,c){a?u.warn("[CircuitCallControlSvc]: Could not retrieve corresponding conversation. Delete Pending Invite"):(u.info("[CircuitCallControlSvc]: Successfully retrieved the conversation. Check if there are any active sessions."),yb.getActiveSessions(function(a,d){b.$apply(function(){a&&(u.error("[CircuitCallControlSvc]: Error getting active sessions: ",a),d=[]),$a(c,d)})}))})}if(!e.hasJoined)return void u.info("[CircuitCallControlSvc]: User is not a conversation participant. Ignore event.");b.$apply(function(){if(c)u.debug("[CircuitCallControlSvc]: Found local call for SESSION_STARTED event"),u.info("[CircuitCallControlSvc]: Ignore SESSION_STARTED. State =",c.state.name);else if(a.callOut)a.session.participants.some(function(c){if(c.userId===b.localUser.userId&&c.clientId!==yb.clientId)return $(e,c,null,function(b){b.setCallIdForTelephony(a.sessionId),b.pullNotAllowed=!0}),!0});else if(e.type===d.ConversationType.GROUP||e.type===d.ConversationType.LARGE){var f=a.session.participants.find(function(a){return a.userId===b.localUser.userId&&a.clientId!==yb.clientId});$(e,f,null,function(b){b.setCallIdForTelephony(a.sessionId),f||(u.debug("[CircuitCallControlSvc]: Publish /conference/started event"),v.publish("/conference/started",[b]))})}Da(a.session.attendeeCount)})}catch(a){u.error("[CircuitCallControlSvc]: Exception handling RTCSession.SESSION_STARTED event: ",a)}}),yb.on("RTCSession.PARTICIPANT_JOINED",function(a){try{u.debug("[CircuitCallControlSvc]: Received RTCSession.PARTICIPANT_JOINED");var c=a.participant.userId;if(b.localUser.userId===c)return void u.debug("[CircuitCallControlSvc]: Ignore JOINED event for own user");var d=ta(a.sessionId);if(d)return void b.$apply(function(){d.pullNotAllowed&&(d.pullNotAllowed=!1),d.isTelephonyCall&&!d.atcCallInfo&&T(d,a.participant.phoneNumber,null,a.participant.userDisplayName)});var f=N(a.sessionId);if(!f)return void u.info("[CircuitCallControlSvc]: Event is not for local call. Ignore it.");if(!f.isEstablished()&&f.direction===e.CallDirection.INCOMING)return void u.info("[CircuitCallControlSvc]: Ignore JOINED event for incoming alerting calls");b.$apply(function(){if(f.isVoicemail=!!a.participant.userDisplayName&&a.participant.userDisplayName.startsWith("VoiceMail of"),f.isTelephonyCall&&!f.atcCallInfo&&T(f,a.participant.phoneNumber,null,a.participant.userDisplayName),f.checkState([e.CallState.Delivered,e.CallState.Waiting])&&(f.checkState(e.CallState.Delivered)?f.setState(e.CallState.Waiting):f.conferenceCall&&f.sessionCtrl.isConnected()&&f.setState(e.CallState.Active),f.activeClient=null,f.replaces)){var b=O(f.replaces.callId);b&&da(b,null,e.CallClientTerminatedReason.CALL_MOVED_TO_ANOTHER_CONV),u.debug("[CircuitCallControlSvc]: Publish /call/moved event"),v.publish("/call/moved",[f.replaces.callId,f.callId]),f.replaces=null}var d=U(a.participant),g=d.muted?e.ParticipantState.Muted:e.ParticipantState.Active;if(P(d,f),f.hasParticipant(c)){var h=Aa(f,d,g);h&&(u.debug("[CircuitCallControlSvc]: Publish /call/participant/updated event"),v.publish("/call/participant/updated",[f.callId,h]))}else{var i=za(f,d,g);i&&(u.debug("[CircuitCallControlSvc]: Publish /call/participant/added event"),v.publish("/call/participant/added",[f.callId,i]))}var j=a.userEnteredStage?{userEnteredStage:a.userEnteredStage}:null;u.debug("[CircuitCallControlSvc]: Publish /call/participant/joined event"),v.publish("/call/participant/joined",[f,f.getParticipant(d.userId),j]),H(),f.updateMediaType(),K(f),sa()})}catch(a){u.error("[CircuitCallControlSvc]: Exception handling RTC.PARTICIPANT_JOINED event. ",a)}}),yb.on("RTCSession.SESSION_MOVED",function(a){try{if(u.debug("[CircuitCallControlSvc]: Received RTCSession.SESSION_MOVED"),Pb[a.oldRtcSessionId])return u.info("[CircuitCallControlSvc]: Event is for a pending INVITE. Ignore it."),void delete Pb[a.oldRtcSessionId];var c=O(a.oldRtcSessionId);if(!c)return void u.info("[CircuitCallControlSvc]: Event is not for local or remote call. Ignore it.");var d=A(a.oldConversationId),e=A(a.newConversationId);if(!d||!e)return void u.warn("[CircuitCallControlSvc]: Could not find corresponding conversations");b.$apply(function(){if(Wa(e,d,c),c.isRemote)return void u.debug("[CircuitCallControlSvc]: Session Moved for Remote Call");if("iOS"!==s.navigator.platform&&sa(e),e.creatorId===b.localUser.userId){var a={};d.participants.forEach(function(b){a[b.userId]=!0}),e.participants.forEach(function(b){a[b.userId]||hb(c,b)})}})}catch(a){u.error("[CircuitCallControlSvc]: Exception handling RTC.SESSION_MOVED event. ",a)}}),yb.on("RTCSession.WHITEBOARD_ENABLED",function(a){var c=O(a.sessionId);c&&b.$apply(function(){c.whiteboardEnabled=!0,v.publish("/call/whiteboard/enabled",[c,a.whiteboard]),u.debug("[CircuitCallControlSvc]: Publish /call/whiteboard/enabled event")})}),yb.on("RTCSession.WHITEBOARD_DISABLED",function(a){var c=O(a.sessionId);c&&b.$apply(function(){c.whiteboardEnabled=!1,v.publish("/call/whiteboard/disabled",[c]),u.debug("[CircuitCallControlSvc]: Publish /call/whiteboard/disabled event")})}),yb.on("RTCCall.INVITE",function(a){if(!Ob)return void u.info("[CircuitCallControlSvc]: Conversations are not loaded. Do not process the INVITE event.");if(b.localUser.isCMP){if(b.localUser.userPresenceState.state===d.PresenceState.BUSY)return u.info("[CircuitCallControlSvc]: CMP is updating its software. Reject the INVITE with cause BUSY."),void aa(a);if(!b.inviterUserId||b.inviterUserId!==a.userId)return u.info("[CircuitCallControlSvc]: Reject the INVITE with cause BUSY."),void aa(a)}try{u.debug("[CircuitCallControlSvc]: Received RTCCall.INVITE");var c=a.isGuestInvite&&!b.localUser.isCMP,e=A(a.convId);if(!e){u.info("[CircuitCallControlSvc]: Could not find corresponding conversation. Save pending INVITE and retrieve conversation.");var f=a.sessionId;return Pb[f]=a,void(c?x.createConversationAsGuestFromSummary(a.convId).then(function(a){Pb[f]&&(u.info("[CircuitCallControlSvc]: Successfully retrieved conversation. Process the pending INVITE message."),Za(Pb[f],a),delete Pb[f])}).catch(function(){u.warn("[CircuitCallControlSvc]: Could not create temporary conversation from summary."),delete Pb[f]}):x.getConversationById(a.convId,{randomLoaded:!0,sessionId:a.sessionId},function(a,c){a?u.warn("[CircuitCallControlSvc]: Could not retrieve corresponding conversation. Delete Pending Invite"):Pb[f]?(u.info("[CircuitCallControlSvc]: Successfully retrieved conversation. Process the pending INVITE message."),Za(Pb[f],c)):(u.info("[CircuitCallControlSvc]: Successfully retrieved conversation. Check if there are any active sessions."),yb.getActiveSessions(function(a,d){b.$apply(function(){a&&(u.error("[CircuitCallControlSvc]: Error getting active sessions: ",a),d=[]),$a(c,d)})})),delete Pb[f]}))}if(c&&(e=x.createConversationAsGuest(e)),!e.hasJoined&&!c)return void u.info("[CircuitCallControlSvc]: User is not a conversation participant. Ignore event.");b.$apply(function(){Za(a,e)})}catch(a){u.error("[CircuitCallControlSvc]: Exception handling RTCCall.INVITE event. ",a)}}),yb.on("RTCSession.PARTICIPANT_LEFT",function(a){b.$apply(function(){try{u.debug("[CircuitCallControlSvc]: Received RTCSession.PARTICIPANT_LEFT");var c=b.localUser.userId===a.userId,f=N(a.sessionId),g=[d.RTCSessionParticipantLeftCause.TRANSPORT_NEGOTIATION_FAILED,d.RTCSessionParticipantLeftCause.NEGOTIATION_FAILED,d.RTCSessionParticipantLeftCause.SECURITY_NEGOTIATION_FAILED];if(c){if(f&&!f.isDirect&&!f.isEstablished()&&!g.contains(a.cause))return void u.debug("[CircuitCallControlSvc]: Ignore PARTICIPANT_LEFT event for non-established group calls");u.debug("[CircuitCallControlSvc]: Publish /localUser/leftConference event"),v.publish("/localUser/leftConference",[a.sessionId])}var h=ta(a.sessionId);if(h)return u.info("[CircuitCallControlSvc]: Event is for active remote call."),void(c&&_(h));if(!f){var i=ua(a.sessionId);if(i&&!i.isDirect&&i.hasParticipant(a.userId)){u.info("[CircuitCallControlSvc]: Event is for an incoming call. Caller has left the conversation."),Ba(i,a.userId,a.cause);var j=A(i.convId);j&&($(j),M(i,e.CallClientTerminatedReason.CALLER_LEFT_CONFERENCE))}else u.info("[CircuitCallControlSvc]: Event is not for local call. Ignore it.");return}if(f.isTestCall)return void u.debug("[CircuitCallControlSvc]: Ignore PARTICIPANT_LEFT event for test calls");if(f.isDirect)return void(c||a.cause!==d.RTCSessionParticipantLeftCause.CONNECTION_LOST&&a.cause!==d.RTCSessionParticipantLeftCause.STREAM_LOST?u.debug("[CircuitCallControlSvc]: Ignore PARTICIPANT_LEFT event for direct calls"):f.setParticipantState(a.userId,e.ParticipantState.ConnectionLost));var k=a.userId,l=A(f.convId);if(c){if($(l),a.cause===d.RTCSessionParticipantLeftCause.REMOVED){var m=f.getParticipant(a.requesterId);v.publish("/call/droppedRemotely",[f,m])}else if(g.contains(a.cause))return void Ma(f,{error:"res_CallMediaFailed"});M(f,e.CallServerTerminatedReason.SERVER_ENDED_PRFX+a.cause)}else{if(a.cause===d.RTCSessionParticipantLeftCause.MAX_PARTICIPANTS_REACHED){var n=l.participants.some(function(a){return a.userId===k}),o=function(a,b){a||(u.debug("[CircuitCallControlSvc]: Publish /call/participant/rejected event"),v.publish("/call/participant/rejected",[f.callId,b]))};return void(n?w.getUserById(k,o):o())}Ba(f,k,a.cause)}}catch(a){u.error("[CircuitCallControlSvc]: Exception handling RTCSession.PARTICIPANT_LEFT event. ",a)}})}),yb.on("RTCCall.SDP_FAILED",function(a){try{u.debug("[CircuitCallControlSvc]: Received RTCCall.SDP_FAILED with cause =",a.cause);var c=N(a.sessionId);if(!c)return void u.warn("[CircuitCallControlSvc]: Unexpected event. There is no local call");if(yb.clientId!==a.clientID)return void u.debug("[CircuitCallControlSvc]: Event is not for this client");if(c.instanceId||c.setInstanceId(a.instanceId),a.cause===d.SdpFailedCause.SESSION_TERMINATED)return void u.debug("[CircuitCallControlSvc]: SDP_FAILED due to session terminated. Ignore");b.$apply(function(){c.isEstablished()?c.sessionCtrl.renegotiationFailed():c.isDirect&&c.isCallOut||da(c,null,e.CallClientTerminatedReason.REQUEST_TO_SERVER_FAILED)})}catch(a){u.error("[CircuitCallControlSvc]: Exception handling RTCCall.SDP_FAILED event. ",a)}}),yb.on("RTCSession.SESSION_TERMINATED",function(a){try{if(u.debug("[CircuitCallControlSvc]: Received RTCSession.SESSION_TERMINATED"),Hb[a.sessionId]&&delete Hb[a.sessionId],Pb[a.sessionId])return u.info("[CircuitCallControlSvc]: Event is for a pending INVITE. Ignore it."),void delete Pb[a.sessionId];var c=O(a.sessionId);if(!c)return void u.warn("[CircuitCallControlSvc]: Could not find call with rtcSessionId =",a.sessionId);if(c.terminateTimer)return void u.info("[CircuitCallControlSvc]: Call is already being terminated. Ignore event");c.isTelephonyCall&&Qb&&(u.debug("[CircuitCallControlSvc]: Call is being moved to another device, keep showing"),c.setAtcHandoverInProgress(),q.cancel(Qb),Qb=null),b.$apply(function(){var b=a.cause;u.info("[CircuitCallControlSvc]: Publish /call/terminated. cause = ",b),v.publish("/call/terminated",[c,b]),M(c,e.CallServerTerminatedReason.SERVER_ENDED_PRFX+b)})}catch(a){u.error("[CircuitCallControlSvc]: Exception handling RTCSession.SESSION_TERMINATED event. ",a)}}),yb.on("RTCCall.INVITE_CANCEL",function(a){try{if(yb.clientId===a.clientID)return void u.debug("[CircuitCallControlSvc]: Ignore own INVITE_CANCEL");if(Pb[a.sessionId])return u.info("[CircuitCallControlSvc]: Event is for a pending INVITE. Ignore it."),void delete Pb[a.sessionId];b.$apply(function(){u.debug("[CircuitCallControlSvc]: Received RTCCall.INVITE_CANCEL with cause: ",a.cause);var b=ua(a.sessionId);if(b){if(!b.isDirect||a.cause===d.InviteCancelCause.ACCEPT){var c=A(b.convId),f=a.cause===d.InviteCancelCause.ACCEPT?{clientId:a.clientID}:null;$(c,f,null,function(c){c.setCallIdForTelephony(a.sessionId),f&&c.isTelephonyCall&&T(c,b.peerUser.phoneNumber,null,b.peerUser.displayName)})}var g=e.CallClientTerminatedReason.ANOTHER_CLIENT_REJECTED;a.cause===d.InviteCancelCause.ACCEPT?g=e.CallClientTerminatedReason.ANOTHER_CLIENT_ANSWERED:a.cause===d.InviteCancelCause.REVOKED&&(g=e.CallClientTerminatedReason.ENDED_BY_ANOTHER_USER),M(b,g)}else if(u.debug("[CircuitCallControlSvc]: There is no corresponding alerting call"),a.cause===d.InviteCancelCause.ACCEPT){var h=O(a.sessionId);h&&h.isRemote&&(u.debug("[CircuitCallControlSvc]: There is a remote call, probably ringing timeout or another client called in"),h.activeClient={clientId:a.clientID},h.setState(e.CallState.ActiveRemote),va(h),K(h))}})}catch(a){u.error("[CircuitCallControlSvc]: Exception handling RTCCall.INVITE_CANCEL event. ",a)}}),yb.on("RTCCall.INVITE_FAILED",function(a){try{u.debug("[CircuitCallControlSvc]: Received RTCCall.INVITE_FAILED");var c=N(a.sessionId);if(!c)return void u.warn("[CircuitCallControlSvc]: Unexpected event. There is no local call");if(!c.isDirect){var f=c.getParticipant(a.userId);if(a.to){f.displayName=a.to.displayName;var g=Aa(c,f);g&&(u.debug("[CircuitCallControlSvc]: Publish /call/participant/updated event"),v.publish("/call/participant/updated",[c.callId,g]))}if(f&&f.isActive())return void u.debug("[CircuitCallControlSvc]: Unexpected event. participant already connected: ",a.userId)}if(a.clientID&&yb.clientId!==a.clientID)return void u.debug("[CircuitCallControlSvc]: Event is not for this client: ",yb.clientId);c.isTelephonyCall&&a.to&&T(c,a.to.phoneNumber,a.to.fullyQualifiedNumber,a.to.displayName,a.to.userId),b.$apply(function(){var b,f=c,g=a.cause,h=a.userId;switch(g){case d.InviteFailedCause.NOT_REACHABLE:b=e.ParticipantState.Offline,f.isDirect&&f.setState(e.CallState.Failed);break;case d.InviteFailedCause.BUSY:b=e.ParticipantState.Busy,f.isDirect&&f.setState(e.CallState.Busy);break;case d.InviteFailedCause.DECLINE:b=e.ParticipantState.Declined,f.isDirect&&f.setState(e.CallState.Declined);break;case d.InviteFailedCause.TIMEOUT:b=e.ParticipantState.Timeout,f.isDirect&&f.setState(e.CallState.NotAnswered);break;case d.InviteFailedCause.TEMPORARILY_UNAVAILABLE:case d.InviteFailedCause.INVALID_NUMBER:b=e.ParticipantState.Busy,f.isDirect&&f.setState(e.CallState.Failed);break;case d.InviteFailedCause.REVOKED:b=e.ParticipantState.Removed,f.isDirect&&f.setState(e.CallState.Failed);break;default:u.warn("[CircuitCallControlSvc]: Unexpected RTCCall.INVITE_FAILED cause =",a.cause),b=e.ParticipantState.Busy,f.isDirect&&f.setState(e.CallState.Failed)}if(f.isDirect)f.setParticipantState(h,b),K(f),f.hasVideo()&&f.removeParticipant(h),da(f,null,e.CallServerTerminatedReason.SERVER_ENDED_PRFX+g,!0);else{f.setParticipantState(h,b);var i=f.removeParticipant(h);i&&(u.debug("[CircuitCallControlSvc]: Publish /call/participant/removed event"),v.publish("/call/participant/removed",[f.callId,i]),f.participants.isEmpty()&&(f.conferenceCall?f.checkState(e.CallState.Waiting)||(f.setState(e.CallState.Waiting),K(f)):(f.setState(e.CallState.NotAnswered),K(f),da(null,null,e.CallServerTerminatedReason.SERVER_ENDED_PRFX+g,!0))))}})}catch(a){u.error("[CircuitCallControlSvc]: Exception handling RTC.INVITE_FAILED event. ",a)}}),yb.on("RTCSession.ACTIVE_SPEAKER",Qa),yb.on("RTCSession.VIDEO_ACTIVE_SPEAKER",Ra),yb.on("RTCCall.CHANGE_MEDIA_TYPE_REQUESTED",function(a){try{u.debug("[CircuitCallControlSvc]: Received RTCSession.CHANGE_MEDIA_TYPE_REQUESTED");var c=ua(a.sessionId);if(c)return void Xa(a.sessionId,a.transactionId);var d=N(a.sessionId);if(!d||d.isRemote)return void u.info("[CircuitCallControlSvc]: Event is not for local call. Ignore it.");if(a.clientID&&yb.clientId!==a.clientID)return void u.debug("[CircuitCallControlSvc]: Event is not for this client: ",yb.clientId);if(d.activeClient)return void u.debug("[CircuitCallControlSvc]: Pull in progress. leave it for active client to handle");if(!d.isEstablished()&&d.direction===e.CallDirection.INCOMING||!d.isDirect)return void Xa(d.callId,a.transactionId);b.$apply(function(){if(a.sdp){var c=d.sessionCtrl;if(!c.isConnStable())return void Xa(d.callId,a.transactionId);d.setTransactionId(a.transactionId),d.isTelephonyCall&&(c.getSdpStatus()===e.SdpStatus.PrAnswerReceived&&"answer"===k.getSessionInformation(a.sdp.sdp)&&c.setRemoteDescription(a.sdp,function(b){if(b)return u.error("[CircuitCallControlSvc]: Error setting remote description:",b),void Xa(d.callId,a.transactionId);a.sdp.type="answer";var c={rtcSessionId:d.callId,sdp:a.sdp,transactionId:d.transactionId};yb.changeMediaAccept(c,function(a){a?u.error("[CircuitCallControlSvc]: changeMediaAccept sdp answer sending error"):u.debug("[CircuitCallControlSvc]: changeMediaAccept sdp answer sent")})}),d.atcAdvancing&&"nooffer"!==a.sdp.type&&d.sessionCtrl.setIgnoreTurnOnNextPC());var f=function(a){c.onSessionDescription=null;var e={rtcSessionId:d.callId,sdp:a.sdp,transactionId:d.transactionId};yb.changeMediaAccept(e,function(a){b.$apply(function(){a?u.error("[CircuitCallControlSvc]: changeMediaAccept sdp answer sending error"):u.debug("[CircuitCallControlSvc]: changeMediaAccept sdp answer sent")})})};d.atcAdvancing=!1,C(d.callId).then(function(b){c.setTurnCredentials(b),c.enableTrickleIce(),k.isNoOfferSdp(a.sdp)?Y(d.callId,d.transactionId,d.localMediaType,!1,null,function(a){a&&u.warn("[CircuitCallControlSvc]: Failed to renegotiate the media")}):(c.onSessionDescription=f,c.setRemoteDescription(a.sdp,function(b){b&&(c.onSessionDescription=null,Xa(d.callId,a.transactionId))}))})}else Xa(d.callId,a.transactionId)})}catch(a){u.error("[CircuitCallControlSvc]: Exception handling RTCSession.CHANGE_MEDIA_REQUESTTED event. ",a)}}),yb.on("RTCCall.CHANGE_MEDIA_TYPE_FORCED",function(a){try{u.debug("[CircuitCallControlSvc]: Received RTCSession.CHANGE_MEDIA_TYPE_FORCED");var c=N(a.sessionId);if(!c)return void u.info("[CircuitCallControlSvc]: Event is not for local call. Ignore it.");if(c.isDirect)return void u.debug("[CircuitCallControlSvc]: Event is not applicable for direct calls. Ignore it.");if(a.clientID&&yb.clientId!==a.clientID)return void u.debug("[CircuitCallControlSvc]: Event is not for this client: ",yb.clientId);if(c.activeClient)return void u.debug("[CircuitCallControlSvc]: Pull in progress. leave it for active client to handle");a.removeMediaTypes&&(c.localMediaType.desktop&&a.removeMediaTypes.contains(d.RealtimeMediaType.DESKTOP_SHARING)&&b.$apply(function(){fb(c,a.userId)}),a.removeMediaTypes.contains(d.RealtimeMediaType.AUDIO)&&b.$apply(function(){xb.removeAudio(c.callId)}))}catch(a){u.error("[CircuitCallControlSvc]: Exception handling RTCSession.CHANGE_MEDIA_TYPE_FORCED event. ",a)}}),yb.on("RTCSession.PARTICIPANT_UPDATED",function(a){try{u.debug("[CircuitCallControlSvc]: Received RTCSession.PARTICIPANT_UPDATED");var c=N(a.sessionId),d=ta(a.sessionId)||c;if(d&&d.callId===a.sessionId&&d.isTelephonyCall&&!d.atcCallInfo&&b.localUser.userId!==a.participant.userId&&T(d,a.participant.phoneNumber,null,a.participant.userDisplayName),!c)return void u.info("[CircuitCallControlSvc]: Event is not for local call. Ignore it.");b.$apply(function(){var d=a.participant.userId,f=a.participant.muted;if(b.localUser.userId===d)return void(c.remotelyMuted!==f&&(c.remotelyMuted=f,ib(c)));if(!c.isEstablished()&&c.direction===e.CallDirection.INCOMING)return void u.debug("[CircuitCallControlSvc]: Ignore UPDATED event for incoming alerting calls");var g=c.getParticipant(a.participant.userId);if(!g)return void u.debug("[CircuitCallControlSvc]: Ignore UPDATED event, can not find participant to update for userId: ",d);var h=U(a.participant),i=h.muted?e.ParticipantState.Muted:e.ParticipantState.Active,j=g.muted!==h.muted,k=!g.hasSameMediaType(h)||g.streamId!==h.streamId,l=Aa(c,h,i);l&&(P(l,c),k&&c.updateMediaType(),(k||j)&&(u.debug("[CircuitCallControlSvc]: Publish /call/participant/updated event"),v.publish("/call/participant/updated",[c.callId,l]))),K(c)})}catch(a){u.error("[CircuitCallControlSvc]: Exception handling RTCSession.PARTICIPANT_UPDATED event. ",a)}}),yb.on("RTCSession.SESSION_RECORDING_INFO",function(a){u.debug("[CircuitCallControlSvc]: Received RTCSession.SESSION_RECORDING_INFO");var c=N(a.sessionId);return c?void b.$apply(function(){var b=Ca(c,a.recordingInfo);b&&(u.debug("[CircuitCallControlSvc]: Publish /call/recording/info event"),v.publish("/call/recording/info",[c]))}):void u.warn("[CircuitCallControlSvc]: Unexpected event. There is no local call")}),yb.on("RTCSession.SESSION_TERMINATION_TIMER_STARTED",function(a){u.debug("[CircuitCallControlSvc]: Received RTCSession.SESSION_TERMINATION_TIMER_STARTED");var c=N(a.sessionId);return c?void b.$apply(function(){u.debug("[CircuitCallControlSvc]: Publish /call/sessionTerminateTimerChanged (started)"),v.publish("/call/sessionTerminateTimerChanged",[c.callId,a.endTime])}):void u.warn("[CircuitCallControlSvc]: Unexpected event. There is no local call")}),yb.on("RTCSession.SESSION_TERMINATION_TIMER_CANCELLED",function(a){u.debug("[CircuitCallControlSvc]: Received RTCSession.SESSION_TERMINATION_TIMER_CANCELLED");var c=N(a.sessionId);return c?void b.$apply(function(){u.debug("[CircuitCallControlSvc]: Publish /call/sessionTerminateTimerChanged (cancelled)"),v.publish("/call/sessionTerminateTimerChanged",[c.callId,null])}):void u.warn("[CircuitCallControlSvc]: Unexpected event. There is no local call")}),yb.on("RTCSession.SESSION_ATTRIBUTES_CHANGED_EVENT",function(a){u.debug("[CircuitCallControlSvc]: Received RTCSession.SESSION_ATTRIBUTES_CHANGED_EVENT");var c=N(a.sessionId);return c?void 0===a.attendeeCount||c.attendeeCount===a.attendeeCount?void u.debug("[CircuitCallControlSvc]: No changes"):void b.$apply(function(){Da(a.attendeeCount)}):void u.warn("[CircuitCallControlSvc]: Unexpected event. There is no local call")}),yb.on("RTCCall.PROGRESS",function(a){u.debug("[CircuitCallControlSvc]: Received RTCCall.PROGRESS");var c=N(a.sessionId);if(!c)return void u.info("[CircuitCallControlSvc]: Event is not for local or remote call. Ignore it.");if(c.receivedAlerting=a.progressType===d.RTCProgressType.ALERTING,!c.checkState([e.CallState.Initiated,e.CallState.Delivered]))return void u.info("[CircuitCallControlSvc]: Ignore PROGRESS. Call state =",c.state.name);a.to&&c.isTelephonyCall&&T(c,a.to.phoneNumber,a.to.fullyQualifiedNumber,a.to.displayName,a.to.userId);try{b.$apply(function(){if(a.sdp&&("answer"===a.sdp.type||"pranswer"===a.sdp.type)){if(c.isTelephonyCall)if(a.progressType===d.RTCProgressType.EARLY_CONNECT)c.isEarlyConnect=!0;else{var b=k.parse(a.sdp.sdp);c.isEarlyConnect="earlyconnect"===b.i,c.isEarlyConnect&&(delete b.i,a.sdp.sdp=k.stringify(b))}a.sdp.type="pranswer",c.sessionCtrl.setRemoteDescription(a.sdp,function(b){return b?(c.setDisconnectCause(d.DisconnectCause.REMOTE_SDP_FAILED,"type="+a.sdp.type+" origin="+k.getOrigin(a.sdp.sdp)),void da(c,null,e.CallClientTerminatedReason.SET_REMOTE_SDP_FAILED)):void(c.isPranswer=!0)})}c.setState(e.CallState.Delivered),K(c)})}catch(a){u.error("[CircuitCallControlSvc]: Exception handling RTCCall.PROGRESS event.",a)}}),yb.on("RTCSession.INVITE_TO_STAGE_EVENT",function(a){return u.debug("[CircuitCallControlSvc]: Received RTCSession.INVITE_TO_STAGE_EVENT"),N(a.sessionId)?void b.$apply(function(){var b={invitedByUserId:a.invitedByUserId,allowedMediaTypes:a.allowedMediaTypes,expirationTime:m.delayOrTimestamp(a.expirationDelay,a.expirationTime)};u.debug("[CircuitCallControlSvc]: Publish /call/raiseHand/invite, questionNumber: ",a.questionNumber),v.publish("/call/raiseHand/invite",[a.questionNumber,b])}):void u.warn("[CircuitCallControlSvc]: Unexpected event. There is no local call")}),yb.on("RTCSession.INVITE_TO_STAGE_CANCEL_EVENT",function(a){return u.debug("[CircuitCallControlSvc]: Received RTCSession.INVITE_TO_STAGE_CANCEL_EVENT"),N(a.sessionId)?void b.$apply(function(){u.debug("[CircuitCallControlSvc]: Publish /call/raiseHand/invite (cancel), questionNumber: ",a.questionNumber),v.publish("/call/raiseHand/invite",[a.questionNumber,null])}):void u.warn("[CircuitCallControlSvc]: Unexpected event. There is no local call")}),yb.on("RTCSession.QUESTION_EVENT",function(a){return u.debug("[CircuitCallControlSvc]: Received RTCSession.QUESTION_EVENT"),N(a.sessionId)?void b.$apply(function(){u.debug("[CircuitCallControlSvc]: Publish /call/raiseHand/question, questionNumber: ",a.question.questionNumber),v.publish("/call/raiseHand/question",[a.question,a.subType])}):void u.warn("[CircuitCallControlSvc]: Unexpected event. There is no local call")}),yb.on("RTCSession.CURTAIN_EVENT",function(a){return u.debug("[CircuitCallControlSvc]: Received RTCSession.CURTAIN_EVENT"),N(a.sessionId)?void b.$apply(function(){Bb.curtain=a.curtain,u.debug("[CircuitCallControlSvc]: Publish /call/curtain event"),v.publish("/call/curtain",[Bb.curtain])}):void u.warn("[CircuitCallControlSvc]: Unexpected event. There is no local call")}),this.initActiveSessionsForSdk=function(){return Ob=!0,Va()},this.initForUnitTests=function(){Ob=!0},this.setDisableRemoteVideoByDefault=function(a){u.info("[CircuitCallControlSvc] Setting _disableRemoteVideoByDefault to ",!!a),Gb=!!a},this.getDisableRemoteVideoByDefault=function(){return Gb},this.setClientDiagnosticsDisabled=function(a){Nb=a},this.getCalls=function(){return Ab},this.getPhoneCalls=function(a){return Ab.filter(function(b){return b.isTelephonyCall&&(!a||!b.isRemote)})},this.getEstablishedLocalPhoneCalls=function(){return Ab.filter(function(a){return a.isTelephonyCall&&a.state.established&&!a.isRemote})},this.getActiveCall=function(a){return a?N(a):Bb&&Bb.replaces?Bb.replaces:Bb||null},this.getIncomingCall=function(){return Ib[0]||null},this.getActiveRemoteCall=function(){return Db},this.joinGroupCall=function(a,b,c){if(c=c||function(){},!a)return u.warn("[CircuitCallControlSvc]: joinGroupCall - Invalid Call Id"),void c("Missing callId");var d=O(a);if(!d||!d.isRemote||d.state.name!==e.CallState.Started.name||d.activeClient)return u.warn("[CircuitCallControlSvc]: joinGroupCall invoked without a valid call"),void c("Invalid call");var f=A(d.convId);if(!f||!f.call||f.call.callId!==d.callId)return u.warn("[CircuitCallControlSvc]: joinGroupCall - Cannot find valid conversation"),void c("Invalid conversation");var g={callOut:!1,handover:!1,joiningGroupCall:!0};ab(f,b,g,c)},this.makeCall=function(a,b,c){if(c=c||function(){},!a)return u.warn("[CircuitCallControlSvc]: makeCall - Invalid Conversation Id"),void c("Missing convId");var d=A(a);return d?void ab(d,b,{callOut:!0,handover:!1},c):(u.warn("[CircuitCallControlSvc]: makeCall - Cannot find conversation with id ",a),void c("Conversation not found"))},this.makeEchoTestCall=function(a,c,d){c=c||function(){},d=d||function(){};var e=b.isSessionGuest&&b.localUser.conversationId||"echo_"+b.localUser.clientId,f={creatorId:b.localUser.userId,convId:e,rtcSessionId:"echo_"+b.localUser.clientId,participants:[{userId:b.localUser.userId}],testCall:!0};f=kb.extend(f),c(f.rtcSessionId),q(function(){X(f,a,{callOut:!1,handover:!1},d)},200)},this.dialNumber=function(a,b,c,d){d=d||function(){},x.getTelephonyConversation(function(e,f){e||!f?d(e):ab(f,c,{callOut:!0,handover:!1,dialedDn:a,toName:b},d)})},this.dialPhoneNumber=function(a,b){b=b||function(){},a=a||{},x.getTelephonyConversation(function(c,d){if(c||!d)b(c);else{if(!jb(d,!1,b))return;if(Bb&&Bb.isTelephonyCall&&!Bb.isHolding())return void xb.holdCall(Bb.callId,function(c){c?b&&b(c):ab(d,a.mediaType,{callOut:!0,handover:!1,dialedDn:a.dialedDn,toName:a.toName,userId:a.userId},b)});ab(d,a.mediaType,{callOut:!0,handover:!1,dialedDn:a.dialedDn,toName:a.toName,userId:a.userId},b)}})},this.startConference=function(a,b,c){if(b=b||{audio:!0,video:!1},c=c||function(){},!a)return u.warn("[CircuitCallControlSvc]: startConference - Invalid Conversation Id"),void c("Missing convId");var e=A(a);return e?e.type!==d.ConversationType.GROUP&&e.type!==d.ConversationType.LARGE?(u.warn("[CircuitCallControlSvc]: startConference - Invalid conversation type"),void c("Invalid conversation type")):void ab(e,b,{callOut:!1,handover:!1},c):(u.warn("[CircuitCallControlSvc]: startConference - Cannot find conversation with id ",a),void c("Conversation not found"))},this.answerCall=function(a,c,f){function g(){Cb=Bb,Bb=i,H(),Ib.splice(h,1),cb(Bb),Bb.stopRingingTimer(),Bb.setState(e.CallState.Answering);var a=A(Bb.convId);return a&&a.call&&a.call.callId===Bb.callId?(K(Bb),void bb(c,function(b,c){Z(a,b,{warning:c},f)})):(u.warn("[CircuitCallControlSvc]: joinCall - Cannot find valid conversation"),ca(Bb,{type:d.InviteRejectCause.BUSY},!1),void f("Conversation not found"))}f=f||function(){};var h,i=null;if(Ib.some(function(b,c){if(a===b.callId)return i=b,h=c,!0}),!i)return u.warn("[CircuitCallControlSvc]: answerCall - There is no alerting call"),void f("No alerting call");if((!Bb||!Bb.isPresent()||Bb.isTelephonyCall&&i.isTelephonyCall&&!mb||i.replaces)&&b.localUser.isATC){if(Bb&&Bb.isTelephonyCall&&b.localUser.isATC&&!Bb.isHolding())return void xb.holdCall(Bb.callId,function(a){a?f&&f(a):g()})}else da(Bb,null,e.CallClientTerminatedReason.USER_ENDED),Cb&&da(Cb,null,e.CallClientTerminatedReason.USER_ENDED);g()},this.endCall=function(a,b){var c=d.InviteRejectCause.DECLINE,f=xb.getActiveCall();f&&f.callId===a&&(f.isEstablished()||f.direction===e.CallDirection.OUTGOING)&&(c=null),xb.endCallWithCauseCode(a,c,b)},this.endCallWithCauseCode=function(a,b,c){var f;f=b?"string"==typeof b&&b.startsWith(e.CallClientTerminatedReason.CLIENT_ENDED_PRFX)?b:e.CallClientTerminatedReason.CLIENT_ENDED_PRFX+b:e.CallClientTerminatedReason.USER_ENDED;var g=N(a);if(g)g.replaces&&g.checkState(e.CallState.Answering)?c("Auto answer in progress"):g.terminateTimer?(M(g,f),c&&q(c)):da(g,b,f,!1,c);else if(Bb&&Bb.replaces&&Bb.replaces.callId===a)da(Bb.replaces,b,f,!1,c);else{var h=O(a);if(h)return void(h.terminateTimer?(M(h),c&&q(c)):da(h,b,f,!1,c));var i=ua(a);if(i)ca(i,{type:b||d.InviteRejectCause.DECLINE},!1,c);else{u.warn("[CircuitCallControlSvc]: endCall - There is no local or alerting call");var j=x.getConversationByRtcSession(a);j&&j.call&&(j.call=null,u.debug("[CircuitCallControlSvc]: Publish /conversation/update event"),v.publish("/conversation/update",[j])),c&&c("Call not found")}}},this.endConference=function(a,c){var d=O(a);d?b.isSessionGuest||d.isGuestInvite?c&&c("Not allowed"):ea(d,c):c&&c("Call not found")},this.startScreenShare=function(a,b,c){if(c=c||function(){},!a)return u.warn("[CircuitCallControlSvc]: startScreenShare - Invalid Conversation Id"),void c("Invalid convId");var d=A(a);if(!d)return u.warn("[CircuitCallControlSvc]: startScreenShare - Cannot find conversation with id ",a),void c("Conversation not found");var e={audio:!0,video:!1,desktop:!0},f={callOut:!0,handover:!1,screenConstraint:b};X(d,e,f,function(a){a||(u.debug("[CircuitCallControlSvc]: Publish /screenshare/started event"),v.publish("/screenshare/started")),c(a)})},this.addScreenShare=function(a,b,c){c=c||function(){};var d=N(a);if(!d)return u.warn("[CircuitCallControlSvc]: addScreenShare - There is no local call"),void c("No active call");var e={audio:d.localMediaType.audio,video:!1,desktop:!0};Y(a,null,e,!1,null,function(a){a||(u.debug("[CircuitCallControlSvc]: Publish /screenshare/started event"),v.publish("/screenshare/started")),c(a)},b)},this.addMediaStream=function(a,b,c){c=c||function(){};var d=N(a);if(!d)return u.warn("[CircuitCallControlSvc]: addMediaStream - There is no local call"),void c("No active call");
var e={audio:d.localMediaType.audio,video:!1,desktop:!0};Y(a,null,e,!1,null,function(a){a?c("res_AddMediaStreamFailed"):c()},{mediaStream:b})},this.removeMediaStream=function(a,b){b=b||function(){};var c=N(a);if(!c)return u.warn("[CircuitCallControlSvc]: removeMediaStream - There is no local call"),void b("No active call");u.debug("[CircuitCallControlSvc]: removeMediaStream...");var d={audio:c.localMediaType.audio,video:c.localMediaType.video,desktop:!1};Y(a,null,d,!1,null,function(a){a?b("res_RemoveMediaStreamFailed"):b()})},this.selectMediaToShare=function(a,b,c){c=c||function(){};var d=N(a);if(!d)return u.warn("[CircuitCallControlSvc]: selectMediaToShare - There is no local call"),void c("No active call");u.debug("[CircuitCallControlSvc]: selectMediaToShare...");var e={audio:d.localMediaType.audio,video:!1,desktop:!0};Y(a,null,e,!0,null,c,b),v.publish("/screenshare/changed")},this.removeScreenShare=function(a,b){b=b||function(){};var c=N(a);if(!c)return u.warn("[CircuitCallControlSvc]: removeScreenShare - There is no local call"),void b("No active call");u.debug("[CircuitCallControlSvc]: removeScreenShare...");var d={audio:c.localMediaType.audio,video:c.localMediaType.video,desktop:!1};Y(a,null,d,!1,null,function(a){a?b("res_RemoveScreenShareFailed"):b()})},this.addAudio=function(a,b){b=b||function(){};var c=N(a);if(!c)return u.warn("[CircuitCallControlSvc]: addAudio - There is no local call"),void b("No active call");var d={audio:!0,video:c.localMediaType.video,desktop:c.localMediaType.desktop};Y(a,null,d,!1,null,function(a){a?(u.warn("[CircuitCallControlSvc]: addAudio -> Failed to renegotiate the media. ",a),b("Renegotiate for receive-only media failed")):(u.debug("[CircuitCallControlSvc]: addAudio -> Media renegotiation was successful"),b())})},this.removeAudio=function(a,b){b=b||function(){};var c=N(a);if(!c)return u.warn("[CircuitCallControlSvc]: removeAudio - There is no local call"),void b("No active call");u.debug("[CircuitCallControlSvc]: removeAudio...");var d={audio:!1,video:c.localMediaType.video,desktop:c.localMediaType.desktop};Y(a,null,d,!1,null,function(a){a?(u.warn("[CircuitCallControlSvc]: removeAudio -> Failed to renegotiate the media. ",a),b("Renegotiate for receive-only media failed")):(u.debug("[CircuitCallControlSvc]: removeAudio -> Media renegotiation was successful"),b())})},this.enableRemoteAudio=function(a){var b=N(a);return b?void(b.remoteAudioDisabled&&(b.enableRemoteAudio(),u.debug("[CircuitCallControlSvc]: Publish /call/remoteStreamUpdated event"),v.publish("/call/remoteStreamUpdated",[b]))):void u.warn("[CircuitCallControlSvc]: enableRemoteAudio - There is no local call")},this.disableRemoteAudio=function(a){var b=N(a);return b?void(b.remoteAudioDisabled||(b.disableRemoteAudio(),u.debug("[CircuitCallControlSvc]: Publish /call/remoteStreamUpdated event"),v.publish("/call/remoteStreamUpdated",[b]))):void u.warn("[CircuitCallControlSvc]: disableRemoteAudio - There is no local call")},this.addVideo=function(a,b){b=b||function(){};var c=N(a);if(!c)return u.warn("[CircuitCallControlSvc]: addVideo - There is no local call"),void b("No active call");var d={audio:c.localMediaType.audio,video:!0,desktop:!1};Y(a,null,d,!1,null,function(a){a?b("res_AddVideoFailed"):b()})},this.removeVideo=function(a,b){b=b||function(){};var c=N(a);if(!c)return u.warn("[CircuitCallControlSvc]: removeVideo - There is no local call"),void b("No active call");u.debug("[CircuitCallControlSvc]: removeVideo...");var d={audio:c.localMediaType.audio,video:!1,desktop:c.localMediaType.desktop};Y(a,null,d,!1,null,function(a){a?b("res_RemoveVideoFailed"):b()})},this.toggleRemoteVideo=function(a,b){b=b||function(){};var c=N(a);if(!c)return u.warn("[CircuitCallControlSvc]: toggleRemoteVideo - There is no local call"),void b("No active call");u.debug("[CircuitCallControlSvc]: toggleRemoteVideo...");var d=c.sessionCtrl;return d.isConnStable()?(c.remoteVideoDisabled?c.enableRemoteVideo():(c.disableRemoteVideo(),v.publish("/call/toggleRemoteVideo")),void Y(a,null,c.localMediaType,!1,null,function(a){a?(c.remoteVideoDisabled?c.enableRemoteVideo():c.disableRemoteVideo(),u.warn("[CircuitCallControlSvc]: Failed to renegotiate the media"),b("res_ToggleVideoFailed")):(b(),!c.remoteVideoDisabled&&v.publish("/call/toggleRemoteVideo"))})):void b("Connection not stable")},this.changeHDVideo=function(a,b,c){c=c||function(){};var d=N(a);if(!d)return u.warn("[CircuitCallControlSvc]: changeHDVideo - There is no local call"),void c("No active call");if(!d.mediaType.video)return u.warn("[CircuitCallControlSvc]: changeHDVideo - Local call has no video"),void c("No video");if(b=!!b,d.localMediaType.hdVideo===b)return void c();u.debug("[CircuitCallControlSvc]: changeHDVideo...");var e={audio:Bb.localMediaType.audio,video:!0,hdVideo:b,desktop:!1};Y(a,null,e,!1,null,function(a){a?c("Error changing media"===a?"res_ToggleVideoFailed":a):c()})},this.toggleVideo=function(a,b){b=b||function(){};var c=N(a);if(!c)return u.warn("[CircuitCallControlSvc]: toggleVideo - There is no local call"),void b("No active call");u.debug("[CircuitCallControlSvc]: toggleVideo...");var d={audio:c.localMediaType.audio,video:!c.localMediaType.video,desktop:c.localMediaType.desktop};d.video&&(d.desktop=!1),Y(a,null,d,!1,null,function(a){a?b("Error changing media"===a?"res_ToggleVideoFailed":a):b()})},this.renegotiateMedia=function(a,b){b=b||function(){};var c=N(a);return c?(c.sessionCtrl.enableTrickleIce(),u.debug("[CircuitCallControlSvc]: renegotiateMedia..."),void Y(a,null,c.localMediaType,!1,null,function(a){a?(u.warn("[CircuitCallControlSvc]: Failed to renegotiate the media"),b("Renegotiate media failed")):b()})):(u.warn("[CircuitCallControlSvc]: renegotiateMedia - There is no local call"),void b("No active call"))},this.holdCall=function(a,b){b=b||function(){};var c=N(a);return c?(u.debug("[CircuitCallControlSvc]: holdCall..."),c.setHoldInProgress(),void Y(a,null,c.localMediaType,!1,!0,function(a){c.clearHoldInProgress(),a?(u.warn("[CircuitCallControlSvc]: Failed to hold the call"),b("res_HoldCallFailed")):b()})):(u.warn("[CircuitCallControlSvc]: holdCall - There is no call"),void b("No active call"))},this.retrieveCall=function(a,b){b=b||function(){};var c=N(a);return c.isHolding()?(u.debug("[CircuitCallControlSvc]: retrieveCall..."),c.setRetrieveInProgress(),void Y(a,null,c.localMediaType,!1,!1,function(a){if(c.clearRetrieveInProgress(),a)u.warn("[CircuitCallControlSvc]: Failed to retrieve the call"),b("res_RetrieveCallFailed");else{c===Cb&&(Cb=Bb,Bb=c);var d=A(Bb.convId);d.call=Bb,u.debug("[CircuitCallControlSvc]: Publish /conversation/update event"),v.publish("/conversation/update",[d]),b()}})):(u.warn("[CircuitCallControlSvc]: retrieveCall - There is no held local call"),void b("No active call"))},this.swapCall=function(a,b){if(b=b||function(){},Cb=xb.getPhoneCalls(!0).length>1?R(!0):null,!Cb||!Bb)return u.warn("[CircuitCallControlSvc]: swapCall - There are no held and active local calls"),void b("No calls to swap");if(Cb&&Cb.callId!==a)return u.warn("[CircuitCallControlSvc]: swapCall - Wrong callId of the held call"),void b("Wrong callId");var c=Cb.callId,d=Bb.callId;xb.holdCall(d,function(a){a?b&&b(a):xb.retrieveCall(c,b)})},this.pullRemoteCall=function(a,b,c){function d(){var d=e.activeClient||{},g={audio:!0,video:!(!d.mediaType||!d.mediaType.video)};b&&(g.video=!1),ab(f,g,{callOut:!1,handover:!0,callId:a},c)}c=c||function(){};var e=ta(a);if(!e)return u.warn("[CircuitCallControlSvc]: pullRemoteCall invoked without a valid call"),void c("No active remote call");if(e.pullNotAllowed)return void c("res_PullCallNotAllowed");var f=A(e.convId);return f&&f.call.callId===a?Bb&&Bb.isTelephonyCall?void xb.holdCall(Bb.callId,function(a){a?c&&c(a):d()}):void d():(u.warn("[CircuitCallControlSvc]: pullRemoteCall - Cannot find valid conversation"),void c("Conversation not found"))},this.endRemoteCall=function(a,b){b=b||function(){};var c=ta(a);if(!c)return u.warn("[CircuitCallControlSvc]: endRemoteCall invoked without a valid call"),void b("No active remote call");var d=A(c.convId);return d&&d.call.callId===a?void fa(c,function(a){a?b("res_EndRemoteCallFailed"):(_(c),b())}):(u.warn("[CircuitCallControlSvc]: endRemoteCall - Cannot find valid conversation"),void b("Conversation not found"))},this.hideRemoteCall=function(a){var b=O(a);return b?void M(b):void u.warn("[CircuitCallControlSvc]: hideRemoteCall invoked without a valid call")},this.dropParticipant=function(a,b,c){c=c||function(){};var d=N(a);return!d||d.isDirect?(u.warn("[CircuitCallControlSvc]: dropParticipant - invalid call"),void c("Call invalid")):b&&b.userId?(b.isCMP&&b.isMeetingPointInvitee&&(d.setMeetingPointInviteState(!1),xb.enableRemoteAudio(a)),u.debug("[CircuitCallControlSvc]: Dropping participant in existing RTC session. userId =",b.userId),void wa(b.userId,c)):(u.warn("[CircuitCallControlSvc]: dropParticipant - Invalid participant"),void c("Participant invalid"))},this.addParticipantToCall=function(a,b,c){var d=N(a);d?hb(d,b,c):(u.warn("[CircuitCallControlSvc]: addParticipantToCall - There is no local call"),c&&c("Invalid callId"))},this.addParticipantToRtcSession=function(a,b,c){var d=O(a);d?hb(d,b):(u.warn("[CircuitCallControlSvc]: addParticipantToRtcSession - Call not found"),c&&c("Invalid callId"))},this.mute=function(a,c){c=c||function(){};var d=N(a);return d&&a===d.callId?void(d.locallyMuted?c("Call already muted"):(u.debug("[CircuitCallControlSvc]: Mute the local call"),d.mute(function(){b.$apply(function(){u.debug("[CircuitCallControlSvc]: Publish /call/localUser/mutedSelf event"),v.publish("/call/localUser/mutedSelf",[a,!0]),c()})}))):(u.warn("[CircuitCallControlSvc]: mute - There is no local call"),void c("Call not valid"))},this.unmuteLocally=function(a){Bb&&Bb.locallyMuted&&(u.debug("[CircuitCallControlSvc]: Unmute the local call"),Bb.unmute(function(){b.$apply(function(){u.debug("[CircuitCallControlSvc]: Publish /call/localUser/mutedSelf event"),v.publish("/call/localUser/mutedSelf",[Bb.callId,!1]),a&&a()})}))},this.unmute=function(a,c){c=c||function(){};var d=N(a);if(!d)return void u.warn("[CircuitCallControlSvc]: unmute - There is no local call");if(!d.isMuted())return void c("Call not muted");var e=d.remotelyMuted;xb.unmuteLocally(e?null:c),e&&xb.unmuteParticipant(d.callId,b.localUser,c)},this.toggleMute=function(a,b){b=b||function(){};var c=N(a);return c?c.isLocalMuteAllowed()?void(c.isMuted()?xb.unmute(c.callId,b):xb.mute(c.callId,b)):(u.warn("[CircuitCallControlSvc]: toggleMute - Local Mute is not allowed"),void b()):(u.warn("[CircuitCallControlSvc]: toggleMute - There is no local call"),void b("Call not valid"))},this.muteParticipant=function(a,c,d){d=d||function(){};var e=N(a);if(!e)return u.warn("[CircuitCallControlSvc]: muteParticipant - There is no local call"),void d("Call invalid");var f=c&&c.userId;if(!f)return u.warn("[CircuitCallControlSvc]: muteParticipant - Invalid participant ID"),void d("Participant invalid");u.debug("[CircuitCallControlSvc]: Mute participant in existing RTC session. participantId =",f);var g={rtcSessionId:e.callId,usersIds:[f],muted:!0};yb.muteParticipant(g,function(a){b.$apply(function(){a?(u.warn("[CircuitCallControlSvc]: Failed to mute participant"),d("res_MuteParticipantFailed")):d()})})},this.hasUnmutedParticipants=function(a){var b=N(a);return b&&a===b.callId?b.hasUnmutedParticipants():(u.warn("[CircuitCallControlSvc]: hasUnmutedParticipants - There is no local call"),!1)},this.muteRtcSession=function(a,c){c=c||function(){};var d=N(a);if(!d||a!==d.callId)return u.warn("[CircuitCallControlSvc]: muteRtcSession - There is no local call"),void c("Call invalid");if(d.hasUnmutedParticipants()){u.debug("[CircuitCallControlSvc]: Mute RTC session (all other participants)");var e={rtcSessionId:d.callId,muted:!0,excludedUserIds:[b.localUser.userId]};yb.muteRtcSession(e,function(a){b.$apply(function(){a?(u.warn("[CircuitCallControlSvc]: Failed to mute RTC session"),c("res_MuteAllOtherParticipantsFailed")):c()})})}},this.unmuteParticipant=function(a,c,d){d=d||function(){};var e=N(a);if(!e)return u.warn("[CircuitCallControlSvc]: unmuteParticipant - There is no local call"),void d("Call invalid");var f=c&&c.userId;if(!f)return u.warn("[CircuitCallControlSvc]: unmuteParticipant - Invalid participant ID"),void d("Participant invalid");if(f!==b.localUser.userId)return u.warn("[CircuitCallControlSvc]: Cannot unmute remote participant"),void d("Cannot unmute others");u.debug("[CircuitCallControlSvc]: Unmute participant in existing RTC session. userId =",f);var g={rtcSessionId:e.callId,usersIds:[f],muted:!1};yb.muteParticipant(g,function(a){b.$apply(function(){a?(u.warn("[CircuitCallControlSvc]: Failed to unmute participant"),d("res_UnmuteParticipantFailed")):(e.remotelyMuted=!1,ib(e),d())})})},this.toggleMuteParticipant=function(a,b,c){c=c||function(){};var d=N(a);return d?b&&b.userId?b.muted?xb.unmuteParticipant(a,b,c):xb.muteParticipant(a,b,c):(u.warn("[CircuitCallControlSvc]: unmuteParticipant - Invalid participant ID"),void c("Participant invalid")):(u.warn("[CircuitCallControlSvc]: toggleMuteParticipant - There is no local call"),void c("Call invalid"))},this.stopRingingTone=function(a){var b=ua(a);return b?(b.ringToneStopped=!0,u.debug("[CircuitCallControlSvc]: stopRingingTone for call with callId = ",a),void v.publish("/call/ringingTone/stop",[a])):void u.warn("[CircuitCallControlSvc]: stopRingingTone - incoming call not found: ",a)},this.endActiveCall=function(a){a=a||function(){},Bb?xb.endCall(Bb.callId,a):a("No active call")},this.startRecording=function(a,c){if(!Bb)return u.warn("[CircuitCallControlSvc]: startRecording - There is no local call"),void a("No active call");var d={audio:!0,video:!1,desktop:!!c},e={convId:Bb.convId,rtcSessionId:Bb.callId,mediaTypes:d};yb.startRecording(e,function(c){b.$apply(function(){a&&a(c)})})},this.stopRecording=function(a){if(!Bb)return u.warn("[CircuitCallControlSvc]: stopRecording - There is no local event call"),void a("No active call");var c={convId:Bb.convId,rtcSessionId:Bb.callId};yb.stopRecording(c,function(c){b.$apply(function(){a&&a(c)})})},this.raiseQuestion=function(a,c,d){if(!Bb||!Bb.isLarge)return u.warn("[CircuitCallControlSvc]: raiseQuestion - There is no local event call"),void d("No active event");var e={convId:Bb.convId,rtcSessionId:Bb.callId,question:a,displayName:b.localUser.displayName,isAnonymous:!!c};yb.raiseQuestion(e,function(a,c){b.$apply(function(){d&&d(a,c)})})},this.inviteToStage=function(a,c){if(!Bb||!Bb.isLarge)return u.warn("[CircuitCallControlSvc]: inviteToStage - There is no local event call"),void c("No active event");var d={convId:Bb.convId,rtcSessionId:Bb.callId,questionNumber:a};yb.inviteToStage(d,function(a){b.$apply(function(){c&&c(a)})})},this.inviteToStageAnswer=function(a,c,d){if(!Bb||!Bb.isLarge)return u.warn("[CircuitCallControlSvc]: inviteToStageAnswer - There is no local event call"),void d("No active event");var e={convId:Bb.convId,rtcSessionId:Bb.callId,questionNumber:a,isAccepted:!!c};yb.inviteToStageAnswer(e,function(a){b.$apply(function(){!a&&c?xb.addAudio(Bb.callId,function(a){a||xb.unmuteLocally(),d&&d(a)}):d&&d(a)})})},this.inviteToStageCancel=function(a,c){if(!Bb||!Bb.isLarge)return u.warn("[CircuitCallControlSvc]: inviteToStageCancel - There is no local event call"),void c("No active event");var d={convId:Bb.convId,rtcSessionId:Bb.callId,questionNumber:a};yb.inviteToStageCancel(d,function(a){b.$apply(function(){c&&c(a)})})},this.removeFromStage=function(a,c){if(!Bb||!Bb.isLarge)return u.warn("[CircuitCallControlSvc]: removeFromStage - There is no local event call"),void c("No active event");var d={convId:Bb.convId,rtcSessionId:Bb.callId,userToRemoveId:a||b.localUser.userId};yb.removeFromStage(d,function(a){b.$apply(function(){c&&c(a)})})},this.getQuestions=function(a,c,d){if(!Bb||!Bb.isLarge)return u.warn("[CircuitCallControlSvc]: getQuestions - There is no local event call"),void d("No active event");var e={convId:Bb.convId,rtcSessionId:Bb.callId,startQuestionNumber:a,numberOfQuestions:c};yb.getQuestions(e,function(a,c){b.$apply(function(){d&&d(a,c)})})},this.updateQuestionState=function(a,c,d){if(!Bb||!Bb.isLarge)return u.warn("[CircuitCallControlSvc]: updateQuestionState - There is no local event call"),void d("No active event");var e={convId:Bb.convId,rtcSessionId:Bb.callId,questionNumber:a,newQuestionState:c};yb.updateQuestionState(e,function(a,c){b.$apply(function(){d&&d(a,c)})})},this.openCurtain=function(a){if(!Bb||!Bb.isLarge)return u.warn("[CircuitCallControlSvc]: openCurtain - There is no local event call"),void a("No active event");var c={convId:Bb.convId,rtcSessionId:Bb.callId};yb.openCurtain(c,function(c){b.$apply(function(){a&&a(c)})})},this.closeCurtain=function(a,c,d,e){if(!Bb||!Bb.isLarge)return u.warn("[CircuitCallControlSvc]: closeCurtain - There is no local event call"),void e("No active event");var f={curtainState:a};c&&(f.message=c),d&&(f.pauseDuration=d);var g={convId:Bb.convId,rtcSessionId:Bb.callId,curtain:f};yb.closeCurtain(g,function(a){b.$apply(function(){e&&e(a)})})},this.getNodeState=function(a,c,d){var e={convId:"noCall",nodeType:a,tenantId:c||""};yb.getNodeState(e,function(a,c){b.$apply(function(){a&&u.error("[CircuitCallControlSvc]: Failed to get node(s). ",a),d&&d(a,c)})})},this.canSendWebRTCDigits=function(){return Bb&&Bb.sessionCtrl.canSendDTMFDigits()},this.sendDigits=function(a,b,c){c=c||function(){};var d=N(a);return d?b?/^[\d#\*,]+$/.exec(b)?void _a(a,b,c):(u.error("[CircuitCallControlSvc]: Digits cannot be sent: "+b+" (Allowed: 0-9,#,*)"),void c("res_InvalidDtmf")):void c("res_InvalidDtmf"):(u.warn("[CircuitCallControlSvc]: sendDigits - There is no local call"),void c("Call not valid"))},this.disableIncomingVideo=function(a){Bb&&Bb.sameAs(a)&&(u.debug("[CircuitCallControlSvc]: Disabling remote incoming video. Call ID=",Bb.callId),Bb.sessionCtrl.disableIncomingVideo())},this.enableIncomingVideo=function(a){Bb&&Bb.sameAs(a)&&(u.debug("[CircuitCallControlSvc]: Enabling remote incoming video. Call ID=",Bb.callId),Bb.sessionCtrl.enableIncomingVideo())},this.toggleParticipantPointer=function(a){var b=N(a);return b?b.pointer&&b.pointer.isSupported?(b.pointer.isEnabled=!b.pointer.isEnabled,void Y(b.callId,b.transactionId,b.localMediaType,!1,null,null,null)):void u.warn("[CircuitCallControlSvc]: toggleParticipantPointer - Local call does not support participant pointer"):void u.warn("[CircuitCallControlSvc]: toggleParticipantPointer - There is no local call")},this.findCall=O,this.findActivePhoneCall=Q,this.findHeldPhoneCall=R,this.sendParticipantPointer=db,this.sendParticipantDrawing=eb,this.removeCallFromList=J,this.isSecondCall=function(){return Bb||Ib.length>=1||!Db.isEmpty()},this.updateActiveCallMediaDevices=function(){Bb&&Bb.updateMediaDevices()},this.addSimulatedParticipants=function(){var a=20,b=5e4,c=2500,f=12e4,g=2500,h=xb.getActiveCall();if(h&&!h.isDirect&&h.isMocked&&!(h.participants.length>0)){var i=function(){h.isPresent()&&0!==h.participants.length&&(Ba(h,h.participants[0].userId),h.participants.length>0&&q(i,g))},j=function(g){var k={userId:(b+g).toString(),mediaTypes:[d.RealtimeMediaType.AUDIO],muted:!1,participantType:d.RTCParticipantType.SESSION_GUEST,userDisplayName:[Math.floor(g/10),g%10].join(" ")},l=U(k),m=za(h,l,e.ParticipantState.Active);v.publish("/call/participant/added",[h.callId,m]),v.publish("/call/participant/joined",[h,m]),H(),g<a-1?q(function(){h.isPresent()&&j(g+1)},c):q(i,f)};j(0),h.setState(e.CallState.Active),K(h)}},this}var c=a.ClientApiHandlerSingleton,d=a.Constants,e=a.Enums,f=a.LocalCall,g=a.Proto,h=a.RemoteCall,i=a.RtcParticipant,j=a.RoutingOptions,k=a.sdpParser,l=a.UserToUserHandlerSingleton,m=a.Utils,n=a.WebRTCAdapter,o=a.BusyHandlingOptions,p=a.RtcSessionController;return a.CircuitCallControlSvcImpl=b,a}(Circuit),Circuit=function(a){"use strict";function b(a,b,x,y,z,A,B,C){function D(a,c,d,e,f){a.setPeerUser(c,e);var g=b(function(){g=null,a.isPresent()&&(f&&f(),f=null)},Oa,!1);B.startReverseLookUp(d,function(d){b.cancel(g),a.isPresent()&&(d&&a.setPeerUser(c,d.displayName,d.userId),f&&f())})}function E(a,c,d,e,f,g){if(!a.redirectingUser||!a.redirectingUser.redirectionType){a.setRedirectingUser(c,d,e,null,f);var h=b(function(){h=null,a.isPresent()&&(g&&g(),g=null)},Oa,!1);B.startReverseLookUp(d,function(e){b.cancel(h),a.isPresent()&&(e&&a.setRedirectingUser(c,d,e.displayName,e.userId,f),g&&g())})}}function F(){if(!pb.length)return void(qb=!1);var a=pb.splice(0,1);B.startPhoneCallSearch(a[0].phoneNumber,function(){var c=B.getUserSearchList().slice(0),d=a[0].call;delete a[0].call,1===c.length?d.addParticipant({userId:c[0].userId,phoneNumber:a[0].phoneNumber,displayName:c[0].displayName,participantId:a[0].participantId}):d.addParticipant(a[0]),b(F,0)})}function G(){a.localUser.isATC&&(ab||C.getTelephonyConversationPromise().then(function(a){ab=a}).catch(function(){x.debug("[CstaSvc]: No telephony conversation found")}),u.extend(Ya,A.getAtcRegistrationData()),bb=I(),cb=J(),db=K(),fb=L(),gb.length>0&&(gb=gb.filter(function(a){return!a.checkState(i.Terminated)||(bb===a&&(bb=null),cb===a&&(cb=null),db===a&&(db=null),fb===a&&(fb=null),!1)})),bb||db||cb||fb||gb.empty())}function H(a){for(var b=0;b<gb.length;b++)if(gb[b].callId===a.callId){var c=gb[b].atcCallInfo;return a.peerUser.phoneNumber!==gb[b].peerUser.phoneNumber&&c.clearServicesPermitted(),gb[b]=a,a.atcCallInfo&&a.atcCallInfo.cstaConn||(gb[b].atcCallInfo=c),gb[b]}return null}function I(){var a=z.getActiveCall();if(a&&a.isTelephonyCall){var b=H(a);if(b)return b;var d=Object.create(a);return d.atcCallInfo=a.atcCallInfo||new c,gb.push(d),d}}function J(){var a=z.findHeldPhoneCall();if(a){var b=H(a);if(b)return b;var d=Object.create(a);return d.atcCallInfo=a.atcCallInfo||new c,gb.push(d),d}}function K(){var a=z.getIncomingCall();if(a&&a.isTelephonyCall){var b=H(a);if(b)return b;var d=Object.create(a);return d.atcCallInfo=a.atcCallInfo||new c,gb.push(d),d}}function L(){var a=z.getActiveRemoteCall()[0];if(a&&a.isTelephonyCall){var b=H(a);return b?b:(a.atcCallInfo=a.atcCallInfo||new c,gb.push(a),a)}}function M(a){if(eb[a]){x.debug("[CstaSvc]: Remove remote call with Call Id = "+a);var b=eb[a];N(b),b.setCstaState(l.Idle),x.debug("[CstaSvc]: Publish /atccall/info event"),y.publish("/atccall/info",[b]),delete eb[a]}}function N(c){if(!c)return void x.error("[CstaSvc]: No remoteCall");if(!c.atcCallInfo.getIgnoreCall()&&c.isAtcRemote){if(!ab)return void x.error("[CstaSvc]: No telephony conversation");if(!c.peerUser.phoneNumber&&c.peerUser.displayName===ab.peerUser.displayName)return void x.warn("[CstaSvc]: This call has no peer display information.");var d=c.atcCallInfo.originalPartnerDisplay&&c.atcCallInfo.originalPartnerDisplay.fqn&&c.atcCallInfo.originalPartnerDisplay.fqn!==c.atcCallInfo.peerFQN,e={phoneNumber:d?c.atcCallInfo.originalPartnerDisplay.dn:c.peerUser.phoneNumber,displayName:d?c.atcCallInfo.originalPartnerDisplay.name:c.peerUser.displayName,userId:d?ab.peerUser.userId:c.peerUser.userId||ab.peerUser.userId,resolvedUser:!!c.peerUser.userId&&!d,fqn:d?c.atcCallInfo.originalPartnerDisplay.fqn:c.atcCallInfo.peerFQN},f={convId:ab.convId,starter:c.direction===h.INCOMING?e.userId:a.localUser.userId,source:c.direction===h.INCOMING?e.fqn:a.localUser.phoneNumber,destination:c.direction===h.OUTGOING?e.fqn:a.localUser.phoneNumber,startTime:c.creationTime,duration:c.establishedTime?Date.now()-c.establishedTime:0,type:0===c.establishedTime?n.MISSED:n.REGULAR,participants:[{userId:a.localUser.userId,type:"USER",phoneNumber:a.localUser.phoneNumber,displayName:a.localUser.displayName},{userId:e.userId,type:"TELEPHONY",phoneNumber:e.phoneNumber,displayName:e.displayName,resolvedUser:e.resolvedUser}]};if(f.type===n.MISSED)switch(c.atcCallInfo.getMissedReason()){case o.DEST_OUT_OF_ORDER:f.missedReason=k.RTCItemMissed.UNREACHABLE;break;case o.REORDER_TONE:f.missedReason=k.RTCItemMissed.INVALID_NUMBER;break;case o.BUSY:f.missedReason=k.RTCItemMissed.USER_BUSY;break;case o.CANCELLED:f.missedReason=k.RTCItemMissed.CANCELED;break;case o.DECLINED:f.missedReason=k.RTCItemMissed.DECLINED;break;case o.TRANSFERRED:f.type=n.REGULAR;break;default:f.missedReason=k.RTCItemMissed.TEMPORARILY_UNAVAILABLE}if(lb)$a.addJournalEntry(f);else{var g=1e3+1e3*Math.random();b(function(){O(f)||$a.addJournalEntry(f)},g,!1)}}}function O(a){var b=a&&a.participants&&a.participants[1];return!!b&&ob.some(function(a,c){if(u.cleanPhoneNumber(a.phoneNumber)===u.cleanPhoneNumber(b.phoneNumber)&&a.displayName===b.displayName)return x.debug("[CstaSvc]: Call log entry already sent by another client"),ob.splice(c,1),!0})}function P(){for(var a in eb)eb.hasOwnProperty(a)&&M(a)}function Q(a){for(var b in eb)if(eb.hasOwnProperty(b)&&eb[b].callId===a)return eb[b];return null}function R(a){if(!ab)return null;var b=Object.create(ab);return b.rtcSessionId=a,new f(b)}function S(b){var c=b.endpoints;if(c&&!(c.length<2)){var d=null,e=c[0].callIdentifier.cID,f=c.length>2?l.Conference:l.Active;return c.forEach(function(a){if(f)if(V(a.deviceOnCall)){if(Qa.indexOf(a.localConnectionState)===-1)return void(f=null);var g=X(a.deviceOnCall,b.epid);g===s.WebRTC&&fb?(d=fb,g=s.Other):d=R(e),d.atcCallInfo.setPosition(g),d.atcCallInfo.setCstaConnection(a.callIdentifier),u.extend(b.servicesPermitted,a.servicesPermitted),"queued"===a.localConnectionState?f=l.Parked:"hold"===a.localConnectionState&&(f=c.length>2?l.ConferenceHolding:f===l.Held?l.HoldOnHold:l.Holding)}else if(2===c.length){if(Ra.indexOf(a.localConnectionState)===-1)return void(f=null);var h=Y(a.deviceOnCall);d.atcCallInfo.setPartnerDisplay(h),D(d,d.atcCallInfo.peerDn,d.atcCallInfo.peerFQN,d.atcCallInfo.peerName),"hold"===a.localConnectionState&&(f=f===l.Holding?l.HoldOnHold:l.Held)}}),b.callingDevice&&b.callingDevice.replace("+","")===a.localUser.phoneNumber.replace("+","")?d.direction=h.OUTGOING:d.direction=h.INCOMING,f?(d.atcCallInfo.setServicesPermitted(b.servicesPermitted),d.setCstaState(f),eb[e]=d,d.atcCallInfo.getPosition()===s.WebRTC?void T(d):(x.debug("[CstaSvc]: Created new Remote Call object: ",d),d)):void 0}}function T(a){x.info("[CstaSvc]: Found a hanging WebRTC call"),a.atcCallInfo.setPosition(s.Other),a.atcCallInfo.isSeamlessHandoverAllowed()?(x.info("[CstaSvc]: Attempt to recover the hanging call by initiating a Seamless Handover"),Ba(a,s[s.WebRTC.name],null,function(b){b?(x.warn("[CstaSvc]: Failed to move the hanging call. ",b),Wa.hangupRemote(a)):x.info("[CstaSvc]: Hanging call has been successfully moved")})):(x.info("[CstaSvc]: Clear the hanging call"),Wa.hangupRemote(a))}function U(a){return a.indexOf("keyId=")>0}function V(a){return!!a&&(!(a.indexOf(Ya.onsFQN)<0)&&(!(a.indexOf("uid=")>0)&&!U(a)))}function W(a){return!!a&&Y(a).dn===Ya.vm}function X(a,b){if(x.debug("[CstaSvc]: Get call position for "+a),!V(a))return x.error("[CstaSvc]: Invalid device ID ("+a+"). Cannot determine position."),s.Other;var c=s.Other,d=/ond=(\+?\d+)/.exec(a);if(d&&d[1]){var e=d[1];e===Ya.osmoFQN?c=b&&b!==Ya.epid?s.Other:s.WebRTC:e===Ya.cell?c=s.Cell:e===Ya.parkingDn&&(c=s.Queue)}else c=s.Desk;return x.debug("[CstaSvc]: Call position is:",c.name),c}function Y(a){var b={fqn:"",dn:Sa,name:""};if(a){var c=/N<([^>]*)>([^;]*)((?:[^;]*;)*(?:displayNumber=(\d*)))?(?:;.*)*/,d=c.exec(a);d?(b.fqn=d[1]||"",b.name=d[2]||"",b.dn=d[4]||d[1]||"Number not available"):(c=/N([^;]*)/,d=c.exec(a),d?(b.fqn=d[1]||"",b.dn=d[1]||"Number not available"):(b.fqn=a,b.dn=a))}return x.debug("[CstaSvc]: Retrieved partner display: ",b),b}function Z(a){G();for(var b=z.getPhoneCalls(),d=[],e=0;e<b.length;e++)if(b[e].atcCallInfo&&b[e].atcCallInfo.getCstaCallId()){if(b[e].atcCallInfo.getCstaCallId()===a)return bb=b[e]}else b[e].atcCallInfo=new c,d.push(b[e]);return db&&db.atcCallInfo.getCstaCallId()===a?db:(db&&!db.atcCallInfo.getCstaCallId()&&d.push(db),d[0])}function $(){P(),G(),Wa.snapshotDevice(function(a,b){if(a)return void(a.indexOf("deviceOutOfService")>-1&&(kb=!0,y.publish("/csta/deviceChange")));if(kb=!1,y.publish("/csta/deviceChange"),jb=!0,b.activeCalls)try{b.activeCalls.forEach(function(a){a.localCallState.length<2||(2!==a.localCallState.length||Qa.indexOf(a.localCallState[0])!==-1&&Ra.indexOf(a.localCallState[1])!==-1)&&Wa.snapshotCall(a.connectionId,function(a,b){if(!a&&b){var c=S(b);c&&(x.debug("[CstaSvc]: Publish /atccall/info event"),y.publish("/atccall/info",[c]))}})})}catch(a){x.error(a)}})}function _(a,b,c){var d=Ya.onsFQN+";ond=";switch(a){case s.WebRTC:d+=c?Ya.osmoFQN:Ya.osmoFQN+";epid="+Ya.epid;break;case s.Cell:if(!Ya.cell)return x.error("[CstaSvc]: Cell phone is not configured"),null;d+=Ya.cell;break;case s.Desk:d+=Ya.onsFQN;break;case s.VM:d=Ya.vm;break;case s.Other:b?d+=b:d=Ya.vm;break;default:return x.error("[CstaSvc]: Invalid target: "+a),null}return d}function aa(a){var b,c=(parseInt(a.substring(0,2),16)+2).toString(16).toUpperCase(),d=a.substring(2);return b=c.length<2?"0"+c+d:c+d,x.debug("[CstaSvc]: FailedCallId to be tracked: "+b),b}function ba(b){return u.extend(Ya,A.getAtcRegistrationData()),Xa={subscriber:a.localUser.cstaNumber},!(!Xa.subscriber||!Ya)||(b&&b("There is no registered user."),!1)}function ca(b,c){var f=_a.genCstaRequest(b);if(!f)return x.error("[CstaSvc]: Failed to build CSTA request: "+b.request),void(c&&c("Failed to send the request"));if(tb!==e.Registered)return void(c&&c("Client is not registered with ATC"));var g={content:{type:d.CSTA,phoneNumber:a.localUser.cstaNumber,CSTA:f},destUserId:a.localUser.associatedTelephonyUserID};Za.sendAtcRequest(g,function(d,e){a.$apply(function(){if(d)x.warn("[CstaSvc]: ",d),c&&c(d);else{var a=_a.parseResponse(b.request,e.CSTA);a||""===a?a.error?("Operation Error"===a.errorCategory&&"invalidConnectionID"===a.errorValue&&"busy"!==b.reason&&"AcceptCall"!==b.request&&"DeflectCall"!==b.request&&$(),c&&c(a.errorCategory+" - "+a.errorValue)):c&&c(null,a):c&&c("Failed to parse response from server")}})})}function da(a,c){c.transferredCall&&!c.seamlessHandover&&(ib[a]={newCallId:c.transferredCall.cID,failedCallId:aa(c.transferredCall.cID),timeout:b(function(){delete ib[a]},Ma)})}function ea(a,b){if(!a||!ba())return!1;if(b!==s.Other&&a.atcCallInfo.position===b)return!1;var c=Ia();return!!c.contains(b)||(x.error("[CstaSvc]: isTargetAllowed invoked with invalid target: "+b),!1)}function fa(){x.debug("[CstaSvc]: Synchronize the selected routing option"),Wa.updateRoutingOption(a.localUser.selectedRoutingOption)}function ga(a){var b=_a.parseEvent(a);if(b)switch(x.debug("[CstaSvc]: Parsed CSTA Event: ",b),b.category){case"CallControl":case"CallAssociatedFeature":Wa.handleCallEvent(b);break;case"LogicalDeviceFeature":Wa.handleLogicalDeviceEvent(b);break;case"PhysicalDeviceFeature":break;case"DeviceMaintenance":Wa.handleDeviceEvent(b);break;default:x.debug("[CstaSvc]: Unsupported CSTA Event category: "+b.category)}}function ha(b){a.localUser.clientId!==b?(x.debug("[CstaSvc]: This is not the Primary ATC client"),lb=!1):(x.debug("[CstaSvc]: This is the primary ATC client"),lb=!0)}function ia(a){var b=a.connection.cID,c=X(a.connection.dID,a.epid),d=c===s.WebRTC?Z(b):eb[b];if(!d)return void x.warn("[CstaSvc]: Could not find call corresponding to CallInformation Event.");if(d.atcCallInfo.setCstaConnection(a.connection),a.callingDevice&&!V(a.callingDevice)){var e=Y(a.callingDevice);d.atcCallInfo.setPartnerDisplay(e),D(d,d.atcCallInfo.peerDn,d.atcCallInfo.peerFQN,d.atcCallInfo.peerName)}a.servicesPermitted&&(d.atcCallInfo.setServicesPermitted(a.servicesPermitted),a.servicesPermitted.eSP&&a.servicesPermitted.eSP.sST&&(d.checkCstaState(l.ConferenceHolding)?d.setCstaState(l.Holding):d.checkCstaState(l.Conference)&&d.setCstaState(l.Active))),d.checkCstaState([l.Offered,l.ExtendedRinging])?x.debug("[CstaSvc]: Do not publish /atccall/info event at Offered state"):(x.debug("[CstaSvc]: Publish /atccall/info event"),y.publish("/atccall/info",[d]))}function ja(a){a.secondaryOldCall&&M(a.secondaryOldCall.cID);var b=null,c=a.primaryOldCall.cID,d=X(a.primaryOldCall.dID,a.epid);return(b=d===s.WebRTC?Z(c):eb[c])?(a.conferenceConnections.forEach(function(a){
if(a.endpoint&&V(a.endpoint)||a.connection&&V(a.connection.dID)){if(b.atcCallInfo.setCstaConnection(a.connection),b.isAtcRemote){var d=b.atcCallInfo,e=b.peerUser,f=b.participants,g=b.direction;b.setCstaState(l.Idle),x.debug("[CstaSvc]: Publish /atccall/info event"),y.publish("/atccall/info",[b]),delete eb[c],b=R(a.connection.cID),b.atcCallInfo=d,b.peerUser=e,b.participants=f,b.direction=g,eb[a.connection.cID]=b}x.info("[CstaSvc]: Updated the CSTA connection ID for the call: ",a.connection)}else{var h=a.endpoint&&Y(a.endpoint)||Y(a.connection.dID);pb.push({call:b,userId:a.connection.dID,participantId:a.connection.dID,phoneNumber:h.dn,displayName:h.name}),qb||(qb=!0,F())}}),"hold"===a.localConnectionInfo?b.setCstaState(l.ConferenceHolding):b.setCstaState(l.Conference),b.atcCallInfo.setServicesPermitted(a.servicesPermitted),x.debug("[CstaSvc]: Publish /atccall/info event"),void y.publish("/atccall/info",[b])):void x.debug("[CstaSvc]: Could not find a call with Call Id = "+c)}function ka(a){var c=a.droppedConnection.cID,d=Z(c)||eb[c];if(mb={},d){if("null"!==a.localConnectionInfo){if(x.info("[CstaSvc]: Local connection info is not null.Update services permitted."),d.atcCallInfo.setServicesPermitted(a.servicesPermitted),d.participants.length>1&&(d.participants.some(function(b){if(b.participantId===a.droppedConnection.dID)return d.removeParticipant(b.userId),!0}),1===d.participants.length&&d.isRemote||2===d.participants.length&&!d.isRemote)){var e=d.participants[d.isRemote?0:1];d.removeParticipant(e.userId),D(d,e.phoneNumber,e.phoneNumber,e.displayName),d.checkCstaState(l.Conference)?d.setCstaState(l.Active):d.checkCstaState(l.ConferenceHolding)&&d.setCstaState(l.Holding)}return d.atcCallInfo.getMissedReason()||d.establishedTime||(d.direction===h.INCOMING?d.atcCallInfo.setMissedReason(V(a.releasingDevice)?o.DECLINED:o.CANCELLED):d.atcCallInfo.setMissedReason(V(a.releasingDevice)?o.CANCELLED:o.DECLINED)),x.debug("[CstaSvc]: Publish /atccall/info event"),void y.publish("/atccall/info",[d])}if(x.info("[CstaSvc]: Local connection info is null."),d.atcCallInfo.getMissedReason()||d.establishedTime||d.atcCallInfo.setMissedReason(d.direction===h.INCOMING&&"normalClearing"===a.cause?o.DECLINED:o.CANCELLED),d.checkCstaState(l.Busy)&&d.atcCallInfo.isCallBackAllowed())return void b(function(){x.debug("[CstaSvc]: Callback presenting timer expired - terminate call"),M(d.atcCallInfo.getCstaCallId())},Na)}var f=hb[a.droppedConnection.cID]||hb[Ua];f&&(d=R(f),d.atcCallInfo.setCstaConnection(a.droppedConnection),"normalClearing"!==a.cause&&(d.setCstaState(l.TransferFailed),d.atcCallInfo.setTransferCallFailedCause(a.cause)),x.debug("[CstaSvc]: Publish /atccall/info event"),y.publish("/atccall/info",[d]),delete hb[a.droppedConnection.cID],delete hb[Ua]),M(a.droppedConnection.cID)}function la(a){var b,c,d,e,f,g=null;if(mb={},V(a.callingDevice))e=l.Delivered,c=a.alertingDevice,d=a.calledDevice,b={cID:a.connection.cID,dID:a.callingDevice},f=h.OUTGOING;else{if(!V(a.alertingDevice))return void x.error("[CstaSvc]: ONS DN is neither in callingDevice nor in alertingDevice?!?");e=l.Ringing,c=a.callingDevice,b=a.connection,f=h.INCOMING}var i=X(b.dID,a.epid),j=Y(c);if(i===s.WebRTC){if(g=Z(b.cID)){if(g.atcCallInfo.setCstaConnection(b),g.atcCallInfo.setServicesPermitted(a.servicesPermitted),g.setCstaState(l.Ringing),i=g.isRemote?s.Other:i,g.atcCallInfo.setPosition(i),j){x.debug("[CstaSvc]: Update partner display to ",j),g.atcCallInfo.setPartnerDisplay(j),D(g,g.atcCallInfo.peerDn,g.atcCallInfo.peerFQN,g.atcCallInfo.peerName);var k=Q(b.cID);k&&(k.forwarded&&E(g,k.redirectingUser.phoneNumber,k.redirectingUser.fqNumber,k.redirectingUser.displayName,k.redirectingUser.redirectionType),k.atcCallInfo.setIgnoreCall(!0),M(b.cID))}return x.debug("[CstaSvc]: Publish /atccall/info event"),void y.publish("/atccall/info",[g])}if(rb&&rb.atcCallInfo&&rb.atcCallInfo.getCstaCallId()===a.connection.cId)return void x.warn("[CstaSvc]: The Delivered event is for a local call that was just terminated. Ignore it");x.warn("[CstaSvc]: There is no local call associated with the Delivered Event")}var m=b.cID;if(g=eb[m],g||(g=R(m),eb[m]=g,x.debug("[CstaSvc]: Created new Remote Call object for callID= ",m)),g.setCstaState(e),g.atcCallInfo.setServicesPermitted(a.servicesPermitted),g.atcCallInfo.setPosition(i),g.atcCallInfo.setCstaConnection(b),g.clearAtcHandoverInProgress(),g.direction=f,g.receivedAlerting=!0,j){if(g.atcCallInfo.setPartnerDisplay(j),d){var n=Y(d);n.fqn!==j.fqn?g.atcCallInfo.setOriginalPartnerDisplay(n):g.atcCallInfo.setOriginalPartnerDisplay(j)}return void D(g,g.atcCallInfo.peerDn,g.atcCallInfo.peerFQN,g.atcCallInfo.peerName,function(){x.debug("[CstaSvc]: Publish /atccall/info event"),y.publish("/atccall/info",[g])})}x.debug("[CstaSvc]: Publish /atccall/info event"),y.publish("/atccall/info",[g])}function ma(a){var b=a.connection.cID,c=Z(b);c||(c=eb[b]),c&&V(a.connection.dID)&&(x.info("[CstaSvc]: Digits played",a.digitGeneratedList),y.publish("/call/singleDigitSent",[c]))}function na(a){var b=Z(a.connection.cID);if(b){if(b.direction===h.OUTGOING&&Va.test(a.cause)){var c=Y(a.divertingDevice);E(b,c.dn,c.fqn,c.name,q.CallForward);var d=Y(a.newDestination);b.setPeerUser(d.dn,d.name)}}else if(b=eb[a.connection.cID],b||(b=R(a.connection.cID)),"null"===a.localConnectionInfo&&V(a.divertingDevice)){if(V(a.newDestination)){if(V(a.newDestination)){if("distributed"===a.cause)return;if(b){if(b.forwarded)return;b.atcCallInfo.setIgnoreCall(!0),x.debug("[CstaSvc]: Publish /atccall/info event"),y.publish("/atccall/info",[b])}X(a.newDestination)===s.WebRTC&&(mb={cID:a.connection.cID,dID:a.newDestination})}}else(W(a.newDestination)||X(a.connection.dID)===s.WebRTC)&&b.atcCallInfo.setIgnoreCall(!0),b.setCstaState(l.Idle),b.atcCallInfo.setMissedReason(o.CANCELLED),Va.test(a.cause)&&(eb[a.connection.cID]=b),x.debug("[CstaSvc]: Publish /atccall/info event"),y.publish("/atccall/info",[b]);b&&!b.isHandoverInProgress&&M(a.connection.cID)}else if(!V(a.divertingDevice)&&b){var e=Y(a.divertingDevice);if(e&&b.atcCallInfo.setOriginalPartnerDisplay(e),b.direction===h.OUTGOING&&Va.test(a.cause)){var c=Y(a.divertingDevice);E(b,c.dn,c.fqn,c.name,q.CallForward);var d=Y(a.newDestination);return void b.setPeerUser(d.dn,d.name)}b.atcCallInfo.setMissedReason(o.CANCELLED),x.debug("[CstaSvc]: Publish /atccall/info event"),y.publish("/atccall/info",[b])}}function oa(a,b){nb&&nb.newCallId===b&&(a.direction=nb.direction,E(a,nb.redirectingUser.phoneNumber,nb.redirectingUser.fqNumber,nb.redirectingUser.displayName,nb.redirectingUser.redirectionType),nb={})}function pa(a){var b,c,d,e,f;if(mb={},V(a.callingDevice))b={cID:a.establishedConnection.cID,dID:a.callingDevice},c=a.answeringDevice,d=h.OUTGOING,f=Y(a.calledDevice);else{if(!V(a.answeringDevice))return void x.error("[CstaSvc]: ONS DN is neither in callingDevice nor in answeringDevice?!?");b=a.establishedConnection,c=a.callingDevice,d=h.INCOMING,f=Y(a.callingDevice)}x.debug("[CstaSvc]: LocalConnection: ",b),x.debug("[CstaSvc]: Partner Device ID: ",c);var g=Y(c),i=X(b.dID,a.epid);if(i===s.WebRTC){if(x.info("[CstaSvc]: The Established Event is for a local WebRTC call"),e=Z(b.cID)){e.atcCallInfo.setCstaConnection(b),x.info("[CstaSvc]: Set the CSTA connection ID for the active call: ",b),e.isRemote&&(x.warn("[CstaSvc]: There is no local call associated with the Established Event"),i=s.Other),e.atcCallInfo.setServicesPermitted(a.servicesPermitted),"hold"===a.localConnectionInfo?e.setCstaState(l.Holding):e.setCstaState(l.Active),e.atcCallInfo.setPartnerDisplay(g),e.atcCallInfo.setPosition(i),e.clearAtcHandoverInProgress(),e.receivedAlerting=!0,D(e,e.atcCallInfo.peerDn,e.atcCallInfo.peerFQN,e.atcCallInfo.peerName),oa(e,b.cID);var j=Q(b.cID);return j&&j.forwarded&&(E(e,j.redirectingUser.phoneNumber,j.redirectingUser.fqNumber,j.redirectingUser.displayName,j.redirectingUser.redirectionType),j.atcCallInfo.setIgnoreCall(!0),M(b.cID)),x.debug("[CstaSvc]: Publish /atccall/info event"),void y.publish("/atccall/info",[e])}if("recall"===a.cause)return e=z.findActivePhoneCall(),x.info("[CstaSvc]: Recalled call callId:",e.atcCallInfo.getCstaCallId()),e.atcCallInfo.setCstaConnection(b),x.debug("[CstaSvc]: Publish /atccall/info event"),void y.publish("/atccall/info",[e]);if(V(a.answeringDevice)&&!a.epid)return void x.debug("[CstaSvc]: This is a call answered by VM. Ignore it");if(rb&&rb.atcCallInfo&&rb.atcCallInfo.getCstaCallId()===b.cId)return void x.warn("[CstaSvc]: The Established event is for a local call that was just terminated. Ignore it")}var k=!1;e=eb[b.cID],e||(k=!0,e=R(b.cID),oa(e,b.cID)),e.atcCallInfo.setPosition(i),e.atcCallInfo.setPartnerDisplay(g),e.atcCallInfo.setOriginalPartnerDisplay(f),D(e,e.atcCallInfo.peerDn,e.atcCallInfo.peerFQN,e.atcCallInfo.peerName),e.atcCallInfo.setServicesPermitted(a.servicesPermitted),e.atcCallInfo.setCstaConnection(b),e.direction=d,e.clearAtcHandoverInProgress(),e.receivedAlerting=!0,"hold"===a.localConnectionInfo?e.setCstaState(l.Holding):e.setCstaState(l.Active),k&&(x.debug("[CstaSvc]: Created new Remote Call object: ",e),eb[b.cID]=e),x.debug("[CstaSvc]: Publish /atccall/info event"),y.publish("/atccall/info",[e])}function qa(a){var b=a.heldConnection.cID,c=Z(b);if(!c&&(c=eb[b],!c))return void x.warn("[CstaSvc]: Could not find call corresponding to Held Event.");if(V(a.holdingDevice)){switch(c.atcCallInfo.setCstaConnection(a.heldConnection),c.getCstaState()){case l.Held:c.setCstaState(l.HoldOnHold);break;case l.Conference:c.setCstaState(l.ConferenceHolding);break;default:c.setCstaState(l.Holding)}c.clearHoldInProgress()}else"hold"===a.localConnectionInfo?c.checkCstaState(l.ConferenceHolding)||c.setCstaState(l.HoldOnHold):c.checkCstaState(l.Conference)||c.setCstaState(l.Held);c.atcCallInfo.setServicesPermitted(a.servicesPermitted),x.debug("[CstaSvc]: Publish /atccall/info event"),y.publish("/atccall/info",[c])}function ra(b){var c,d;if(!V(b.offeredDevice))return void x.debug("[CstaSvc]: ONS DN is not the offered device. Ignore Offered event.");c=b.offeredConnection,d=b.callingDevice,x.debug("[CstaSvc]: LocalConnection: ",c),x.debug("[CstaSvc]: Partner Device ID: ",d);var e=Y(d),f=R(c.cID);if(f.atcCallInfo.setPosition(s.Desk),f.atcCallInfo.setPartnerDisplay(e),D(f,f.atcCallInfo.peerDn,f.atcCallInfo.peerFQN,f.atcCallInfo.peerName),f.atcCallInfo.setServicesPermitted(b.servicesPermitted),f.setCstaState(l.Offered),f.direction=h.INCOMING,f.atcCallInfo.setCstaConnection(c),Va.test(b.cause)){var g=Y(b.lastRedirectionDevice);E(f,g.dn,g.fqn,g.name,q.CallForward)}if(x.debug("[CstaSvc]: Created new Remote Call object: ",f),eb[c.cID]=f,mb={cID:c.cID,dID:_(s.WebRTC,null,!0)},a.localUser.selectedRoutingOption===r.DeskPhone.name)return void Ja(f);if(z.isSecondCall()||ab.call&&ab.call.isAtcRemote)Ka(f);else{var i={request:"AcceptCall",callToBeAccepted:f.atcCallInfo.getCstaConnection()};ca(i),mb={}}}function sa(a){var b,c;if(!V(a.queue))return void x.debug("[CstaSvc]: ONS DN is not the queue device. Ignore Queued event.");b=a.queuedConnection,c=a.callingDevice,x.debug("[CstaSvc]: LocalConnection: ",b),x.debug("[CstaSvc]: Partner Device ID: ",c);var d=X(b.dID,a.epid),e=Y(c),f=b.cID,g=eb[f];if(!g){if("noAvailableAgents"===a.cause)return void x.debug("[CstaSvc]: Cause=noAvailableAgents. Ignore Queued event");g=R(f),eb[f]=g,x.debug("[CstaSvc]: Created new Remote Call object for callID= ",f)}g.atcCallInfo.setPosition(d),g.atcCallInfo.setPartnerDisplay(e),D(g,g.atcCallInfo.peerDn,g.atcCallInfo.peerFQN,g.atcCallInfo.peerName),g.atcCallInfo.setServicesPermitted(a.servicesPermitted),g.setCstaState(l.Parked),g.atcCallInfo.setCstaConnection(b),x.debug("[CstaSvc]: Publish /atccall/info event"),y.publish("/atccall/info",[g])}function ta(a){var b=a.retrievedConnection.cID,c=Z(b);if(!c&&(c=eb[b],!c))return void x.warn("[CstaSvc]: Could not find call corresponding to Retrieved Event.");if(V(a.retrievingDevice))c.atcCallInfo.setCstaConnection(a.retrievedConnection),c.checkCstaState(l.HoldOnHold)?(c.setCstaState(l.Held),a.servicesPermitted.eSP&&a.servicesPermitted.eSP.zsiHo&&c.setCstaState(l.Active)):c.checkCstaState(l.ConferenceHolding)?(c.setCstaState(l.Conference),a.servicesPermitted.eSP&&a.servicesPermitted.eSP.sST&&c.setCstaState(l.Active)):c.setCstaState(l.Active),c.clearRetrieveInProgress();else if(c.checkCstaState([l.ConferenceHolding,l.Conference]))"hold"===a.localConnectionInfo?c.setCstaState(l.ConferenceHolding):c.setCstaState(l.Conference);else if("hold"===a.localConnectionInfo?c.setCstaState(l.Holding):c.setCstaState(l.Active),c.isRemote){var d=Y(a.retrievingDevice);c.atcCallInfo.setPartnerDisplay(d),D(c,c.atcCallInfo.peerDn,c.atcCallInfo.peerFQN,c.atcCallInfo.peerName)}c.atcCallInfo.setServicesPermitted(a.servicesPermitted),x.debug("[CstaSvc]: Publish /atccall/info event"),y.publish("/atccall/info",[c])}function ua(a){var b,c=X(a.initiatingDevice,a.epid);if(c===s.WebRTC&&(b=Z(a.initiatedConnection.cID)))if(b.atcCallInfo.setCstaConnection(a.initiatedConnection),b.atcCallInfo.setServicesPermitted(a.servicesPermitted),!b.isRemote&&b.checkState([i.Initiated,i.Ringing,i.Delivered]))x.info("[CstaSvc]: Set the CSTA connection ID for the call: ",a.initiatedConnection),b.setCstaState(l.Initiated),x.debug("[CstaSvc]: Publish /atccall/info event"),y.publish("/atccall/info",[b]);else{if(b.isRemote)return void x.info("[CstaSvc]: Set the CSTA connection ID for the remote call: ",a.initiatedConnection);x.error("[CstaSvc]: Call Initiated for WebRTC client has no active call or not in Initiated/Ringing state")}else b=eb[a.initiatedConnection.cID],b||(b=R(a.initiatedConnection.cID),b.setCstaState(l.Initiated)),b.atcCallInfo.setPosition(c),b.atcCallInfo.setServicesPermitted(a.servicesPermitted),b.direction=h.OUTGOING,b.atcCallInfo.setCstaConnection(a.initiatedConnection),eb[a.initiatedConnection.cID]=b,x.debug("[CstaSvc]: Created new Remote Call object: ",b)}function va(a){if("null"!==a.localConnectionInfo){var c=null,d=null,e=a.primaryOldCall.cID,f=X(a.primaryOldCall.dID,a.epid);if(c=f===s.WebRTC?Z(e):eb[e],!c)return void x.debug("[CstaSvc]: Could not find a call with Call Id = "+e);if(a.transferredConnections.forEach(function(b){if(b.endpoint&&V(b.endpoint)||b.connection&&V(b.connection.dID))c.atcCallInfo.setCstaConnection(b.connection),x.info("[CstaSvc]: Updated the CSTA connection ID for the call: ",b.connection);else{if(c.isAtcRemote){var f=c.atcCallInfo;c.setCstaState(l.Idle);var g=c.peerUser,h=c.direction,i=c.establishedTime;x.debug("[CstaSvc]: Publish /atccall/info event"),y.publish("/atccall/info",[c]),delete eb[e],c=R(b.connection.cID),c.atcCallInfo=f,D(c,g.phoneNumber,g.phoneNumber,g.displayName),c.direction=h,c.establishedTime=i;var j=Y(a.transferringDevice);c.atcCallInfo.setOriginalPartnerDisplay(j),eb[c.callId]=c}d=b.endpoint&&Y(b.endpoint)||b.connection.dID&&Y(b.connection.dID)}}),!c.isRemote&&!c.isEstablished())return x.debug("[CstaSvc]: This is a WebRTC call that has not been answered. Update the display"),void(d&&(c.atcCallInfo.setPartnerDisplay(d),D(c,c.atcCallInfo.peerDn,c.atcCallInfo.peerFQN,c.atcCallInfo.peerName,function(){x.debug("[CstaSvc]: Publish /atccall/info event"),y.publish("/atccall/info",[c])})));switch(a.localConnectionInfo){case"hold":c.setCstaState(l.Holding);break;case"connected":c.setCstaState(l.Active);break;case"alerting":c.setCstaState(l.Ringing);break;default:x.debug("[CstaSvc]: Unexpected localConnectionInfo: ",a.localConnectionInfo)}c.atcCallInfo.setServicesPermitted(a.servicesPermitted),d&&(c.atcCallInfo.setPartnerDisplay(d),D(c,c.atcCallInfo.peerDn,c.atcCallInfo.peerFQN,c.atcCallInfo.peerName)),x.debug("[CstaSvc]: Publish /atccall/info event"),y.publish("/atccall/info",[c])}else{if(a.secondaryOldCall){M(a.primaryOldCall.cID);var g=eb[a.secondaryOldCall.cID];g&&g.atcCallInfo.setMissedReason(o.TRANSFERRED),b(function(){M(a.secondaryOldCall.cID)},1e3)}else{if(V(a.transferringDevice)&&V(a.transferredToDevice)){var h=eb[a.primaryOldCall.cID];h&&h.atcCallInfo.setIgnoreCall(!0)}M(a.primaryOldCall.cID)}if("singleStepTransfer"===a.cause){var i=Wa.getTransferredCall(a.primaryOldCall.cID);i&&(Wa.clearTransferredCall(a.primaryOldCall.cID),hb[i.failedCallId]=a.primaryOldCall.cID)}else if("transfer"===a.cause){var j=R(a.secondaryOldCall.cID);x.debug("[CstaSvc]: Publish /atccall/info event"),y.publish("/atccall/info",[j])}}}function wa(b){var c,d;if("fail"===b.localConnectionInfo&&V(b.failingDevice))switch(c=eb[b.failedConnection.cID],V(b.callingDevice)&&(d=Y(b.calledDevice),d.dn!==Sa&&c&&d.fqn!==c.peerUser.phoneNumber&&(D(c,d.dn,d.fqn,d.name),c.atcCallInfo.setPartnerDisplay(d))),b.cause){case"blocked":if(hb[b.failedConnection.cID]&&x.debug("[CstaSvc]: Received Failed event for transfer, waiting for ConnectionCleared event"),!a.localUser.isOSV){var e=b.failedConnection.cID,f=X(b.failedConnection.dID);c=f===s.WebRTC?Z(e):eb[e],c&&c.isHandoverInProgress&&(x.debug("[CstaSvc]: Received Failed event from non OSV PBX while handover is in progress"),c.clearAtcHandoverInProgress(),x.debug("[CstaSvc]: Publish /atccall/moveFailed event"),y.publish("/atccall/moveFailed"))}break;case"doNotDisturb":c=eb[b.failedConnection.cID],c?(x.debug("[CstaSvc]: Publish /atccall/info event"),y.publish("/atccall/info",[c])):x.warn("[CstaSvc]: DND call does not exist. Ignore Failed event");break;case"reorderTone":c=eb[b.failedConnection.cID],c?(c.atcCallInfo.setMissedReason(o.REORDER_TONE),x.debug("[CstaSvc]: Publish /atccall/info event"),y.publish("/atccall/info",[c])):x.warn("[CstaSvc]: Outgoing call failed with reorder tone");break;case"busy":c=eb[b.failedConnection.cID],c?(c.atcCallInfo.setMissedReason(o.BUSY),c.checkCstaState(l.Offered)&&c.setCstaState(l.Failed),x.debug("[CstaSvc]: Publish /atccall/info event"),y.publish("/atccall/info",[c])):x.warn("[CstaSvc]: Busy call does not exist. Ignore Failed event")}else if("connected"===b.localConnectionInfo&&V(b.callingDevice)){var e=b.failedConnection.cID;if(c=Z(e),c&&c.atcCallInfo.getCstaCallId()===e||(c=eb[e]),!c)return void x.warn("[CstaSvc]: Could not find call corresponding to handle FailedEvent Event.");switch(c.atcCallInfo.setServicesPermitted(b.servicesPermitted),c.atcCallInfo.peerFQN||(d=Y(b.failingDevice),d&&(c.atcCallInfo.setPartnerDisplay(d),D(c,c.atcCallInfo.peerDn,c.atcCallInfo.peerFQN,c.atcCallInfo.peerName))),b.cause){case"busy":c.isRemote&&(c.setCstaState(l.Busy),c.atcCallInfo.setMissedReason(o.BUSY));break;case"reorderTone":c.atcCallInfo.setMissedReason(o.REORDER_TONE);break;case"blocked":c.atcCallInfo.setMissedReason(o.DECLINED);break;default:c.atcCallInfo.setMissedReason(o.DEFAULT)}x.debug("[CstaSvc]: Publish /atccall/info event"),y.publish("/atccall/info",[c])}}function xa(a){var b=a.primaryCall.connectionID.cID,c=X(a.primaryCall.connectionID.dID,Ya.epid),d=c===s.WebRTC?Z(b):eb[b];if(!d)return x.debug("[CstaSvc]: Could not find a call with Call Id = "+b),x.debug("[CstaSvc]: Publish /atccall/hangingcall event"),void y.publish("/atccall/hangingcall",b);if(x.debug("[CstaSvc]: Publish /atccall/moveFailed event"),y.publish("/atccall/moveFailed"),d.checkState([i.Terminated,i.Idle])){var e=d.atcCallInfo,f=d.peerUser,g=d.establishedTime,h=d.direction;delete eb[b],d=R(b),d.atcCallInfo=e,d.peerUser=f,d.establishedTime=g,d.direction=h,eb[b]=d}d.clearAtcHandoverInProgress(),x.debug("[CstaSvc]: Publish /atccall/info event"),y.publish("/atccall/info",[d])}function ya(){kb=!1,x.debug("[CstaSvc]: Publish /csta/deviceChange event"),y.publish("/csta/deviceChange")}function za(){kb=!0,x.debug("[CstaSvc]: Publish /csta/deviceChange event"),y.publish("/csta/deviceChange")}function Aa(b){if(b){var c=Ya.forwardList.some(function(a){if(a.forwardingType===b.forwardingType)return a.forwardStatus=b.forwardStatus,a.forwardDN=b.forwardTo,!0});c||Ya.forwardList.push({forwardDN:b.forwardTo,forwardStatus:b.forwardStatus,forwardType:b.forwardingType}),"forwardImmediate"===b.forwardingType&&(a.localUser.callForwardingAvailable=!0,b.forwardTo!==Ya.vm?(a.localUser.callForwardingNumber=p.format(b.forwardTo),a.localUser.callForwardingEnabled=b.forwardStatus,a.localUser.callForwardingToVMEnabled=!1):(a.localUser.callForwardingToVMEnabled=b.forwardStatus,a.localUser.callForwardingEnabled=!1)),b.hasOwnProperty("staticOndActive")&&(b.staticOndActive?(ub=b.staticOndDN,b.staticOndDN===u.cleanPhoneNumber(a.localUser.reroutingPhoneNumber)?a.localUser.selectedRoutingOption=r.AlternativeNumber.name:(a.localUser.selectedRoutingOption=r.Other.name,a.localUser.otherRoutingNumber=p.format(b.staticOndDN))):(ub="",a.localUser.selectedRoutingOption!==r.AlternativeNumber.name&&a.localUser.selectedRoutingOption!==r.Other.name||(a.localUser.selectedRoutingOption=r.DefaultRouting.name))),x.debug("[CstaSvc]: Publish /localUser/update event"),y.publish("/localUser/update",[a.localUser]),x.debug("[CstaSvc]: Publish /csta/forwardingEvent"),y.publish("/csta/forwardingEvent")}}function Ba(a,b,c,d){if(ba(d)){if(!a.atcCallInfo||!a.checkCstaState([l.Active])&&!a.atcCallInfo.isHandoverAllowed()&&!a.atcCallInfo.isDeflectAllowed())return void(d&&d("res_MoveCallFailed"));if(!ea(a,b))return void(d&&d("The selected target is not available for this call."));var e=_(b,c);if(!e)return void(d&&d("Failed to create new destination."));var f={autoAnswer:b===s.Desk||b===s.WebRTC};a.checkCstaState([l.Ringing,l.Parked])?(f.request="DeflectCall",f.callToBeDiverted=a.atcCallInfo.getCstaConnection(),f.newDestination=e,a.setAtcHandoverInProgress(),ca(f,function(c){c?(d&&d("res_MoveCallFailed"),a.clearAtcHandoverInProgress()):(x.debug("[CstaSvc]: Publish /csta/handover event"),y.publish("/csta/handover",a.atcCallInfo.getCstaCallId()),b===s.WebRTC&&a.atcCallInfo.setIgnoreCall(!0),d&&d(null))})):(f.request="SingleStepTransferCall",f.activeCall=a.atcCallInfo.getCstaConnection(),f.transferredTo=e,f.seamlessHandover=a.atcCallInfo.isSeamlessHandoverAllowed(),a.setAtcHandoverInProgress(),ca(f,function(b,c){b||!c?(d&&d("res_MoveCallFailed"),a.clearAtcHandoverInProgress()):(da(f.activeCall.cID,c),nb={primaryCallId:f.activeCall.cID,newCallId:c.transferredCall.cID,direction:a.direction,redirectingUser:a.redirectingUser},x.debug("[CstaSvc]: Publish /csta/handover event"),y.publish("/csta/handover",a.atcCallInfo.getCstaCallId()),d&&d(null))}))}}function Ca(a,b){var c=R(a);D(c,a,a),c.setCstaState(l.Delivered),c.direction=h.OUTGOING,c.atcCallInfo.setPosition(b);var d={dn:a,fqn:a,name:""};c.atcCallInfo.setPartnerDisplay(d),c.atcCallInfo.setIgnoreCall(!0),eb[a]=c,x.debug("[CstaSvc]: Publish /atccall/info event"),y.publish("/atccall/info",[c]),x.debug("[CstaSvc]: Created new Remote Call object: ",c)}function Da(a,b,c){var d=Q(b);if(d)d.atcCallInfo.setCstaConnection(a),d.setCallIdForTelephony(a.cID),d.setCstaState(l.Delivered),d.atcCallInfo.setIgnoreCall(!1),delete eb[b];else{d=R(a.cID),D(d,b,b),d.setCstaState(l.Delivered),d.direction=h.OUTGOING,d.atcCallInfo.setCstaConnection(a),d.atcCallInfo.setPosition(c);var e={dn:b,fqn:b,name:""};d.atcCallInfo.setPartnerDisplay(e)}eb[a.cID]=d,x.debug("[CstaSvc]: Publish /atccall/info event"),y.publish("/atccall/info",[d]),x.debug("[CstaSvc]: Created new Remote Call object: ",d)}function Ea(a,b,c){var d=R(u.generateCallId());if(D(d,a,a),d.direction=h.OUTGOING,d.atcCallInfo.setPosition(b),c.endsWith("invalidCalledDeviceID"))d.atcCallInfo.setMissedReason(o.REORDER_TONE);else{if(c.endsWith("requestIncompatibleWithCallingDevice")||c.endsWith("invalidDeviceID"))return;d.atcCallInfo.setMissedReason(o.DEST_OUT_OF_ORDER)}N(d)}function Fa(){var a=[];return v.enabled&&a.push(s.WebRTC),kb||a.push(s.Desk),Ya&&Ya.cell&&a.push(s.Cell),a}function Ga(){var a=[];return kb||a.push(s.Desk),Ya&&Ya.cell&&a.push(s.Cell),a}function Ha(a){var b=[];return a&&(kb||b.push(s.Desk),Ya&&Ya.cell&&a.getPosition()!==s.Cell&&b.push(s.Cell),Ya&&Ya.vm&&b.push(s.VM)),b}function Ia(){var a=Fa();return Ya&&Ya.vm&&a.push(s.VM),a.push(s.Other),a}function Ja(a){var b=a.atcCallInfo&&a.atcCallInfo.getCstaConnection()||mb;if(lb){var c={request:"DeflectCall",callToBeDiverted:b,newDestination:_(s.Desk)};ca(c)}}function Ka(b){var c=null;if(a.localUser.selectedBusyHandlingOption!==g.DefaultRouting.name){var d=b.atcCallInfo&&b.atcCallInfo.getCstaConnection()||mb;if(lb){switch(a.localUser.selectedBusyHandlingOption){case g.SendToAlternativeNumber.name:c={request:"DeflectCall",callToBeDiverted:d,newDestination:_(s.Cell)};break;case g.BusySignal.name:c={request:"ClearConnection",connectionToBeCleared:d,reason:"busy"};break;case g.SendToVM.name:c={request:"DeflectCall",callToBeDiverted:d,newDestination:_(s.VM)};break;default:return}ca(c,function(a){if(!a&&"ClearConnection"===c.request)if(b.atcCallInfo)b.atcCallInfo.setMissedReason(o.BUSY),b.checkCstaState(l.Offered)&&b.setCstaState(l.Failed);else if(A.isClearConnectionBusySupported()){var e=eb[d.cID]||R(d.cID);e.peerUser=b.peerUser,e.direction=h.INCOMING,e.creationTime=b.creationTime,e.atcCallInfo.setMissedReason(o.BUSY),eb[d.cID]=e,M(d.cID)}}),mb={}}}else b.checkCstaState(l.Offered)&&(c={request:"AcceptCall",callToBeAccepted:b.atcCallInfo.getCstaConnection()},ca(c),mb={})}function La(b,c){!b&&c&&(a.localUser.callForwardingAvailable=!a.localUser.isOSV,c.forwardList&&c.forwardList.length>0&&c.forwardList.forEach(function(b){"forwardImmediate"===b.forwardingType&&(a.localUser.callForwardingAvailable=!0,b.forwardDN!==Ya.vm?(a.localUser.callForwardingNumber=p.format(b.forwardDN),a.localUser.callForwardingEnabled=b.forwardStatus):a.localUser.callForwardingToVMEnabled=b.forwardStatus)}),x.debug("[CstaSvc]: Publish /localUser/update event"),y.publish("/localUser/update",[a.localUser]),Ya.forwardList=c.forwardList||[],x.debug("[CstaSvc]: Publish /csta/forwardingEvent"),y.publish("/csta/forwardingEvent"),fa())}x.debug("New Service: CstaSvc (NEW)");var Ma=4e3,Na=5e3,Oa=2e3,Pa=2e3,Qa=["connected","hold","queued"],Ra=["connected","hold"],Sa="Number not available",Ta="00000000000000000000000000000000",Ua="02000000000000000000000000000000",Va=/Forward/,Wa=this,Xa=null,Ya={forwardList:[]},Za=t.getInstance(),$a=j.getInstance(),_a=new m,ab=null,bb=null,cb=null,db=null,eb={},fb=null,gb=[],hb={},ib={},jb=!1,kb=!0,lb=!0,mb={},nb={},ob=[],pb=[],qb=!1,rb=null,sb=null,tb=null,ub=null,vb=!1;return Za.on("ATC.CSTA",function(b){x.info("[CstaSvc]: Received CSTA event: ",b),b.type===d.CSTA&&b.CSTA&&a.$apply(function(){ga(b.CSTA)})}),Za.on("ATC.PRIMARYCLIENT",function(a){x.info("[CstaSvc]: Received PRIMARYCLIENT event:",a),a.type===d.PRIMARYCLIENT&&a.primaryClientId&&ha(a.primaryClientId)}),y.subscribe("/atcRegistration/state",function(b){x.debug("[CstaSvc]: Received /atcRegistration/state event."),tb=b,a.localUser.isATC&&(!jb&&b===e.Registered&&vb?($(),Wa.getForwarding(La)):jb=!1)}),y.subscribe("/activeSessions/received",function(){x.debug("[CstaSvc]: Received /activeSessions/received event"),vb=!0,jb||tb===e.Registered&&($(),Wa.getForwarding(La))}),y.subscribe("/registration/state",function(a){x.debug("[CstaSvc]: Received /registration/state event"),a!==RegistrationState.Registered&&(vb=!1)}),y.subscribe("/call/incoming",function(a){a&&ab&&a.convId===ab.convId&&(x.debug("[CstaSvc]: Received /call/incoming event."),Object.keys(eb).some(function(a){var b=eb[a];if(b.checkCstaState(l.Ringing)&&b.atcCallInfo.getPosition()===s.WebRTC)return db=K(),db&&(x.debug("[CstaSvc]: Found a matching ATC remote call. Move call info to alerting call."),db.atcCallInfo=b.atcCallInfo,b.atcCallInfo=new c,b.atcCallInfo.setIgnoreCall(!0),M(a)),!0}))}),y.subscribe("/atccall/firstcall",function(a){x.debug("[CstaSvc]: Received /atccall/firstcall event"),Ja(a)}),y.subscribe("/atccall/secondcall",function(a){x.debug("[CstaSvc]: Received /atccall/secondcall event."),Ka(a)}),y.subscribe("/conversation/item/add",function(a){a&&ab&&a.convId===ab.convId&&a.rtc&&a.rtc.rtcParticipants&&2===a.rtc.rtcParticipants.length&&(ob.unshift("TELEPHONY"===a.rtc.rtcParticipants[0].type?a.rtc.rtcParticipants[0]:a.rtc.rtcParticipants[1]),ob.length>2&&ob.pop())}),y.subscribe("/call/ended",function(a){a&&a.isTelephonyCall&&!a.isRemote&&(rb=a,b.cancel(sb),sb=b(function(){rb=null,sb=null},Pa)),G()}),y.subscribe("/routing/alternativeNumber/changed",function(){x.debug("[CstaSvc]: Received /routing/alternativeNumber/changed event"),fa()}),y.subscribe("/localUser/update",function(){a.localUser.isATC&&(x.debug("[CstaSvc]: Received /localUser/update event"),fa())}),this.alternate=function(a,b,c){if(ba(c)){if(!a||!b)return void(c&&c("Invalid calls to alternate"));a.setRetrieveInProgress(),b.setHoldInProgress();var d={};d.request="AlternateCall",d.activeCall=b.atcCallInfo.getCstaConnection(),d.heldCall=a.atcCallInfo.getCstaConnection(),ca(d,function(d){d?(a.clearRetrieveInProgress(),b.clearHoldInProgress(),c&&c("res_RetrieveCallFailed")):c&&c(null)})}},this.conference=function(a,b,c){if(ba(c)){if(!a||!b)return void(c&&c("Invalid calls to conference"));var d={};d.request="ConferenceCall",d.activeCall=b.atcCallInfo.getCstaConnection(),d.heldCall=a.atcCallInfo.getCstaConnection(),ca(d,function(a,b){!a&&b||c&&c("res_MergeCallFailed")})}},this.answer=function(a,b){if(ba(b)){var c=Q(a);if(!c)return void(b&&b("There is no call to be answered"));var d={request:"AnswerCall",callToBeAnswered:c.atcCallInfo.getCstaConnection()};ca(d,b)}},this.clearTransferredCall=function(a){ib[a]&&(b.cancel(ib[a].timeout),delete ib[a])},this.consultationTransfer=function(a,b,c){if(ba(c)){var d={request:"TransferCall",heldCall:b.atcCallInfo.getCstaConnection(),activeCall:a.atcCallInfo.getCstaConnection()};ca(d,function(a,b){a||!b?c&&c(w.Unreachable.ui):c&&c(null)})}},this.deflect=function(a,b,c,d){if(ba(d)){var e=Z(a)||z.getIncomingCall()||Q(a);if(!e)return void(d&&d("There is no call to be deflected"));if(!ea(e,b))return void(d&&d("The selected target is not available for this call."));var f=_(b,c);if(!f)return void(d&&d("Failed to create new destination."));var g={request:"DeflectCall",callToBeDiverted:e.atcCallInfo.getCstaConnection(),newDestination:f,autoAnswer:b===s.Desk||b===s.WebRTC};ca(g,d),b!==s.VM&&e.setAtcHandoverInProgress()}},this.generateDigits=function(a,b,c){if(ba(c)){var d={request:"GenerateDigits",connectionToSendDigits:a.atcCallInfo.getCstaConnection(),charactersToSend:b};ca(d,c)}},this.getDoNotDisturb=function(a){if(ba(a)){var b={request:"GetDoNotDisturb",device:Ya.ons};ca(b,a)}},this.getForwarding=function(b){if(ba(b)){var c={request:"GetForwarding",device:a.localUser.isOSV?u.normalizeDn(Ya.onsFQN):Ya.onsFQN};ca(c,b)}},this.getMessageWaiting=function(a){if(ba(a)){var b={request:"GetMessageWaitingIndicator",device:Ya.ons};ca(b,a)}},this.getTransferredCall=function(a){return ib[a]},this.pullRemoteCall=function(a,b,c){var d=Q(a);d?Ba(d,s[s.WebRTC.name],null,c):(x.warn("[CstaSvc]: pullRemoteCall invoked without a valid call"),c("No active remote call"))},this.pushLocalCall=function(a,b,c){G();var d=bb&&bb.callId===a?bb:cb&&cb.callId===a?cb:null;d?Ba(d,s[b],null,c):(x.warn("[CstaSvc]: pushLocalCall invoked without a valid call"),c("No active local call"))},this.endRemoteCall=function(a,b){var c=Q(a);c?this.hangupRemote(c,b):(x.warn("[CstaSvc]: endRemoteCall invoked without a valid call"),b("No active remote call"))},this.hangupRemote=function(a,b){if(a.isRemote&&ba(b)){var c={request:"ClearConnection",connectionToBeCleared:a.atcCallInfo.getCstaConnection()};ca(c,function(c){c?b&&b(c):(a.atcCallInfo.setMissedReason(o.CANCELLED),M(a.atcCallInfo.getCstaCallId()),b&&b())})}},this.hold=function(a,b){if(ba(b)){var c={request:"HoldCall",callToBeHeld:a.atcCallInfo.getCstaConnection()};a.setHoldInProgress(),ca(c,function(c){c?(a.clearHoldInProgress(),b&&b("res_HoldCallFailed")):b&&b(null)})}},this.reconnect=function(a,b,c){if(ba(c)){var d={request:"ReconnectCall",heldCall:b.atcCallInfo.getCstaConnection(),activeCall:a.atcCallInfo.getCstaConnection()};ca(d,c)}},this.retrieve=function(a,b){if(ba(b)){var c={request:"RetrieveCall",callToBeRetrieved:a.atcCallInfo.getCstaConnection()};a.setRetrieveInProgress(),ca(c,function(c){c?(a.clearRetrieveInProgress(),b&&b("res_RetrieveCallFailed")):b&&b(null)})}},this.setDoNotDisturb=function(a,b){if(ba(b)){var c={request:"SetDoNotDisturb",
device:Ya.ons,doNotDisturbOn:a};ca(c,b)}},this.setForwarding=function(b,c){if(ba(c)){var d={request:"SetForwarding",device:a.localUser.isOSV?u.normalizeDn(Ya.onsFQN):Ya.onsFQN,activateForward:b.activateForward,forwardDN:b.forwardDN||"",forwardingType:b.forwardingType,ringCount:b.ringCount};ca(d,c)}},this.snapshotCall=function(a,b){if(ba(b)){var c={request:"SnapshotCall",snapshotObject:a};ca(c,b)}},this.snapshotDevice=function(a){if(ba(a)){var b={request:"SnapshotDevice",snapshotObject:Ya.onsFQN,osmo:Ya.osmo};ca(b,a)}},this.transfer=function(a,b,c){if(ba(c)){var d={};a.checkCstaState([l.Ringing,l.Parked])?(d.request="DeflectCall",d.callToBeDiverted=a.atcCallInfo.getCstaConnection(),d.newDestination=b,ca(d,c)):(d.request="SingleStepTransferCall",d.activeCall=a.atcCallInfo.getCstaConnection(),d.transferredTo=b,ca(d,function(a,b){if(a||!b){if(a&&a.indexOf("internalResourceBusy")!==-1)return da(d.activeCall.cID,{transferredCall:{cID:Ta}}),void(c&&c(null));c&&c(w.Unreachable.ui)}else da(d.activeCall.cID,b),c&&c(null)}))}},this.consultationCall=function(a,b,c){if(ba(c)){var d={};d.request="ConsultationCall",d.consultedDevice=b,d.existingCall=a.atcCallInfo.getCstaConnection(),Ca(b,a.atcCallInfo.getPosition()),ca(d,function(d,e){d||!e?(c&&c("res_MakeCallFailed"),M(b),Ea(b,null,d)):(Da(e.iC,b,a.atcCallInfo.getPosition()),c&&c())})}},this.makeCall=function(a,b,c){if(ba(c)){var d={};d.request="MakeCall",d.calledDirectoryNumber=b,d.callingDevice=_(a),d.autoOriginate=a===s.Desk||a===s.WebRTC?"doNotPrompt":"prompt",Ca(b,a),ca(d,function(d,e){d||!e?(c&&c("res_MakeCallFailed"),M(b),Ea(b,a,d)):(Da(e.caD,b,a),c&&c())})}},this.callBackCallRelated=function(a,b){if(ba(b)){var c={request:"CallBackCallRelated",callBackConnection:a.atcCallInfo.getCstaConnection()};ca(c,b)}},this.callBackNonCallRelated=function(a,b){if(ba(b)){var c={request:"CallBackNonCallRelated",orD:Ya.onsFQN,tD:a};ca(c,b)}},this.cancelCallBack=function(a,b){if(ba(b)){var c={request:"CancelCallBack",orD:Ya.onsFQN,td:a||void 0};ca(c,b)}},this.setMicrophoneMute=function(a,b){if(ba(b)){var c={request:"SetMicrophoneMute",device:Ya.ons,mute:a};ca(c,b)}},this.getMicrophoneMute=function(a){if(ba(a)){var b={request:"GetMicrophoneMute",device:Ya.ons};ca(b,a)}},this.callLogSnapShot=function(a){if(ba(a)){var b={request:"CallLogSnapShot",device:Ya.ons};ca(b,a)}},this.snapshot=function(){$()},this.handleCallEvent=function(a){if(a){G();try{switch(a.name){case"CallInformationEvent":ia(a);break;case"ConferencedEvent":ja(a);break;case"ConnectionClearedEvent":ka(a);break;case"DeliveredEvent":la(a);break;case"DigitsGeneratedEvent":ma(a);break;case"DivertedEvent":na(a);break;case"EstablishedEvent":pa(a);break;case"FailedEvent":wa(a);break;case"HeldEvent":qa(a);break;case"OfferedEvent":ra(a);break;case"QueuedEvent":sa(a);break;case"RetrievedEvent":ta(a);break;case"ServiceCompletionFailureEvent":xa(a);break;case"ServiceInitiatedEvent":ua(a);break;case"TransferredEvent":va(a);break;default:x.debug("[CstaSvc]: Ignore CSTA Call Event ("+a.name+")")}}catch(a){x.error(a)}}},this.handleDeviceEvent=function(a){if(a)try{switch(a.name){case"BackInServiceEvent":ya();break;case"OutOfServiceEvent":za();break;default:x.debug("[CstaSvc]: Ignore CSTA Device Event ("+a.name+")")}}catch(a){x.error(a)}},this.handleLogicalDeviceEvent=function(a){if(a)try{switch(a.name){case"ForwardingEvent":Aa(a);break;default:x.debug("[CstaSvc]: Ignore CSTA Logical Device Event ("+a.name+")")}}catch(a){x.error(a)}},this.isPrimaryClient=function(){return lb},this.getDisplayInfo=Y,this.getCallDevices=Fa,this.getPushDevices=Ga,this.getAnswerDevices=Ha,this.updateStaticOnd=function(b,c){if(ba(c)){b=!!b,x.debug("[CstaSvc]: Update static OND status to ",b);var d={staticOndActive:b};if(b&&(d.staticOndDN=u.cleanPhoneNumber(a.localUser.reroutingPhoneNumber),!d.staticOndDN))return void(c&&c("Cannot activate static OND without the static OND DN"));var e=!!ub;if(b!==e||b&&d.staticOndDN!==ub){var f={request:"SetForwarding",device:u.normalizeDn(Ya.onsFQN),staticOndActive:d.staticOndActive,staticOndDN:d.staticOndDN};ca(f,function(a){a?c&&c(a):(ub=d.staticOndDN||"",c&&c(null))})}else c&&c(null)}},this.updateRoutingOption=function(a,b){switch(a){case r.AlternativeNumber.name:Wa.updateStaticOnd(!0,function(a){a?b&&b(a):Wa.setForwardingToVM(!1,b)});break;case r.VM.name:Wa.setForwardingToVM(!0,function(a){a?b&&b(a):Wa.updateStaticOnd(!1,b)});break;default:Wa.setForwardingToVM(!1,function(a){a?b&&b(a):Wa.updateStaticOnd(!1,b)})}},this.setForwardingImmediate=function(b,c,d){c=c||a.localUser.callForwardingNumber;var e={activateForward:!!b,forwardDN:u.cleanPhoneNumber(c),forwardingType:"forwardImmediate"};Wa.setForwarding(e,d)},this.setForwardingToVM=function(a,b){if(Wa.getForwardingVMStatus()!==a){var c={activateForward:!!a,forwardDN:u.cleanPhoneNumber(Ya.vm),forwardingType:"forwardImmediate"};Wa.setForwarding(c,b)}else b&&b()},this.getForwardingData=function(){return Ya.forwardList},this.getForwardingImmediate=function(){var a=Ya.forwardList.find(function(a){return"forwardImmediate"===a.forwardingType&&a.forwardDN!==Ya.vm});return{status:!(!a||!a.forwardStatus),forwardDN:a&&a.forwardDN}},this.getForwardingVMStatus=function(){return Ya.forwardList.some(function(a){return"forwardImmediate"===a.forwardingType&&a.forwardDN===Ya.vm&&a.forwardStatus})},this}var c=a.AtcCallInfo,d=a.Enums.AtcMessage,e=a.Enums.AtcRegistrationState,f=a.AtcRemoteCall,g=a.BusyHandlingOptions,h=a.Enums.CallDirection,i=a.Enums.CallState,j=a.ClientApiHandlerSingleton,k=a.Constants,l=a.Enums.CstaCallState,m=a.CstaParser,n=a.Enums.JournalEntryTypes,o=a.Enums.MissedReasonTypes,p=Circuit.PhoneNumberFormatter,q=Circuit.Enums.RedirectionTypes,r=a.RoutingOptions,s=a.Enums.Targets,t=a.UserToUserHandlerSingleton,u=a.Utils,v=a.WebRTCAdapter,w=a.Enums.TransferCallFailedCauses;return a.CstaSvcImpl=b,a}(Circuit),Circuit=function(a){"use strict";function b(a,b,j,k,l,m,n,o,p,q,r){function s(a){for(var b=0;b<J.length;b++)if(a.sameAs(J[b]))return j.debug("[CallControlSvc]: Updating call with callId = "+a.callId),void(J[b]=a);J.push(a)}function t(a){var b;for(b=0;b<J.length;b++)if(a.sameAs(J[b])){J.splice(b,1);break}}function u(a){for(var b=0;b<J.length;b++)if(J[b].callId===a)return J[b]}function v(a){var b=null;return J.some(function(c){if(c.atcCallInfo.getPosition()===a)return b=c,!0}),b}function w(){for(var a=null,b=0;b<J.length;b++){if(J[b].state===c.ActiveRemote)return J[b];J[b].checkCstaState(d.Conference)&&(a=J[b])}return a}function x(){for(var a=0;a<J.length;a++)if(J[a].state===c.Ringing)return J[a]}function y(a){j.debug("[CallControlSvc]: Publish /call/state event. state = ",a.state.name),k.publish("/call/state",[a])}function z(a){a.terminate()}function A(a){var b=m.getConversationByRtcSession(a);if(b)return b;for(var c=0;c<J.length;c++)if(J[c].callId===a)return m.getConversationFromCache(J[c].convId);return null}function B(){for(var a=0;a<J.length;a++)if(J[a].isHandoverInProgress)return J[a];return null}function C(a){if(!a)return void j.warn("[CallControlSvc]: Invalid call object in /atccall/info event");if(!a.isAtcRemote)return void y(a);var b=m.getConversationFromCache(a.convId);if(!b||!b.isTelephonyConv)return void j.warn("[CallControlSvc]: Call in /atccall/info event is not for telephony conversation");if(!a.checkCstaState([d.Idle,d.Terminated])&&(s(a),!b.call||b.call.isHandoverInProgress&&!b.call.sameAs(a)||b.call.isAtcRemote&&b.call.isHolding())){if(b.call&&b.call.isHandoverInProgress){var f=b.call;f.clearAtcHandoverInProgress(),a.establishedTime=f.establishedTime,f.isAtcRemote?(z(f),t(f),j.debug("[CallControlSvc]: Publish /call/ended event."),k.publish("/call/ended",[f,!1])):l.removeCallFromList(f)}b.call=a}switch(a.getCstaState()){case d.Initiated:case d.Offered:case d.ExtendedRinging:a.setState(c.Started);break;case d.Delivered:a.setState(c.Delivered);break;case d.Busy:a.setState(c.Busy);break;case d.Ringing:a.checkState(c.Ringing)||(a.setState(c.Ringing),p&&p.show({type:Circuit.Enums.NotificationType.INCOMING_VOICE_CALL,user:a.peerUser,extras:{conversation:b,call:a}}));break;case d.Idle:case d.TransferFailed:case d.Failed:a.setState(c.Idle);break;case d.Terminated:a.setState(c.Terminated);break;default:a.setState(c.ActiveRemote)}a.state!==c.Idle&&a.state!==c.Terminated&&a.state!==c.Started?(j.debug("[CallControlSvc]: Publish /conversation/update event"),k.publish("/conversation/update",[b]),y(a),a.state!==c.Ringing&&r.setPresenceWithLocation(e.PresenceState.BUSY)):a.state!==c.Idle&&a.state!==c.Terminated||(z(a),t(a),j.debug("[CallControlSvc]: Publish /call/ended event"),k.publish("/call/ended",[a,!1]),a.isHandoverInProgress||b.call&&b.call.sameAs(a)&&(b.call=w(),b.call||l.getActiveCall()||r.setPresenceWithLocation(e.PresenceState.AVAILABLE)),j.debug("[CallControlSvc]: Publish /conversation/update event"),k.publish("/conversation/update",[b]))}function D(a){var b=B();if(b){var c=m.getConversationFromCache(a.convId);a.establishedTime=b.establishedTime,z(b),t(b),c&&c.call&&(c.call=a,j.debug("[CallControlSvc]: Publish /conversation/update event"),k.publish("/conversation/update",[c]))}}function E(a){m.getTelephonyConversation(function(b,c){!b&&c&&c.call&&c.call.atcCallInfo.getCstaCallId()===a&&(c.call=null,j.debug("[CallControlSvc]: Publish /conversation/update event"),k.publish("/conversation/update",[c]))})}function F(a){var b=l.getActiveCall();return!!b&&a===b.callId}function G(a){j.debug("[CallControlSvc]: Publish /call/nativeDial event"),k.publish("/call/nativeDial",[a])}function H(a){if(a&&a.phoneNumber){j.debug("[CallControlSvc]: Received MobileBreakout.DIAL event");var c={phoneNumber:a.phoneNumber,autoDial:a.autoDial,userName:a.userName},d=[];a.conversationId&&d.push(m.getConversationPromise(a.conversationId)),a.userId&&d.push(q.getUserPromise(a.userId)),d.length?b.all(d).then(function(a){a&&a.forEach(function(a){a.userId?c.user=a:c.conversation=a}),G(c)}):G(c)}}j.debug("New Service: CallControlSvc");var I,J=[],K=this,L=i.getInstance();return k.subscribe("/atccall/info",function(a){j.debug("[CallControlSvc]: Received /atccall/info event"),C(a)}),k.subscribe("/atccall/replace",function(a){j.debug("[CallControlSvc]: Received /atccall/replace event"),D(a)}),k.subscribe("/call/ended",function(a){if(j.debug("[CallControlSvc]: Received /call/ended event"),a.isAtcRemote)a.clearAtcHandoverInProgress(),t(a);else{var b=m.getConversationFromCache(a.convId);b&&b.isTelephonyConv&&!b.call&&(b.call=w()||x(),b.call&&(j.debug("[CallControlSvc]: Publish /conversation/update event"),k.publish("/conversation/update",[b]))),a.isRemote||l.getActiveCall()||(w()||r.setPresenceWithLocation(e.PresenceState.AVAILABLE),r.cancelAutoSnooze())}}),k.subscribe("/atccall/hangingcall",function(a){j.debug("[CallControlSvc]: Received /atccall/hangingcall event"),E(a)}),k.subscribe("/call/state",function(a){j.debug("[CallControlSvc]: Received /call/state event"),a&&a.state!==f.CallState.Terminated&&(a.isRemote||r.setPresenceWithLocation(e.PresenceState.BUSY))}),k.subscribe("/screenshare/started",function(){j.info("[CallControlSvc]: Received /screenshare/started event. Screenshare was started. Start Auto-Snooze."),r.startAutoSnooze()}),k.subscribe("/screenshare/ended",function(){j.info("[CallControlSvc]: Received /screenshare/ended event. Screenshare was ended. Resume from Auto-Snooze."),r.cancelAutoSnooze()}),h.isMobile()&&L.on("MOBILE_BREAKOUT.DIAL",function(b){j.info("[CallControlSvc]: Received UserToUser MOBILE_BREAKOUT.DIAL event."),a.$apply(function(){H(b)})}),this.initActiveSessionsForSdk=l.initActiveSessionsForSdk,this.setDisableRemoteVideoByDefault=l.setDisableRemoteVideoByDefault,this.getDisableRemoteVideoByDefault=l.getDisableRemoteVideoByDefault,this.setClientDiagnosticsDisabled=l.setClientDiagnosticsDisabled,this.getCalls=l.getCalls,this.getPhoneCalls=l.getPhoneCalls,this.getActiveCall=l.getActiveCall,this.getIncomingCall=l.getIncomingCall,this.getActiveRemoteCall=l.getActiveRemoteCall,this.joinGroupCall=l.joinGroupCall,this.makeCall=l.makeCall,this.makeAtcCall=function(a,b,c){b=h.cleanPhoneNumber(b);var d=v(a);d?n.consultationCall(d,b,c):n.makeCall(a,b,c)},this.makeEchoTestCall=l.makeEchoTestCall,this.dialNumber=l.dialNumber,this.dialPhoneNumber=l.dialPhoneNumber,this.dialUsingDefaultDevice=function(a,b){b=b||function(){};var c=a&&a.dialedDn;return c&&h.PHONE_DIAL_PATTERN.test(c)?(j.debug("[CallControlSvc]: Calling "+c+" with name: "+a.toName),void m.getTelephonyConversation(function(d,e){if(d||!e)return void j.debug("[CallControlSvc]: error on getTelephonyConversation ",d);if(e.call&&e.call.consultation){var f=e.call.getPosition()||I;if(f&&f!==g.WebRTC)return j.info("[CallControlSvc]: Start consultation from "+f.name+" to ",c),K.makeAtcCall(f,c,b),void(e.call.consultation=!1)}else if(I&&I!==g.WebRTC)return j.info("[CallControlSvc]: Make call from "+I.name+" to ",c),void K.makeAtcCall(I,c,b);a.mediaType=a.mediaType||{audio:!0,video:!1,desktop:!1},K.dialPhoneNumber(a,b)})):void b("Missing or wrong number")},this.setDefaultCallDevice=function(a){a&&a.name&&Object.keys(g).some(function(b){if(a.name===g[b].name)return I=g[b],j.debug("[CallControlSvc]: Set defaultCallDevice to ",I.name),!0})},this.startConference=l.startConference,this.answerCall=function(a,b,c){var d=l.getEstablishedLocalPhoneCalls();if(d.length>1)return j.warn("[CallControlSvc]: answerCall - There are already 2 local phone calls"),void(c&&c("Can not answer the call"));var f=l.findCall(a);if(f)return void l.answerCall(a,b,c);f=u(a);var g=l.getActiveCall(),h=l.getIncomingCall();f?g&&!g.isTelephonyCall?l.endActiveCall(function(){n.pullRemoteCall(a,null,c)}):h&&!h.isTelephonyCall?l.endCallWithCauseCode(h.callId,e.InviteRejectCause.BUSY,function(){n.pullRemoteCall(a,null,c)}):n.pullRemoteCall(a,null,c):(j.warn("[CallControlSvc]: answerCall - There is no alerting call"),c&&c("No alerting call"))},this.answerCallOnDevice=function(a,b,c,d){if(!c||c===g.WebRTC)return K.answerCall(a,b,d);var e=l.findCall(a);return e?void(e.isTelephonyCall?n.deflect(a,c,null,d):j.warn("[CallControlSvc]: answerCallOnDevice - The active call is not a telephony call")):(e=u(a),void(e?e.getPosition()!==c?n.deflect(a,c,null,d):n.answer(a,d):(j.warn("[CallControlSvc]: answerCallOnDevice - There is no alerting call"),d&&d("No alerting call"))))},this.endCall=function(a,b){K.endCallWithCauseCode(a,null,b)},this.endCallWithCauseCode=function(a,b,c){var d=l.findCall(a);return d?void(d.isRemote?l.endRemoteCall(a,c):b?l.endCallWithCauseCode(a,b,c):l.endCall(a,c)):(d=u(a),void(d&&J.length>1&&K.reconnectCall(a,c)||(d?n.endRemoteCall(a,c):(j.warn("[CallControlSvc]: endCall invoked without a valid call. callId = ",a),c&&c("Call not found")))))},this.endConference=l.endConference,this.startScreenShare=l.startScreenShare,this.addScreenShare=l.addScreenShare,this.selectMediaToShare=l.selectMediaToShare,this.removeScreenShare=l.removeScreenShare,this.addAudio=l.addAudio,this.removeAudio=l.removeAudio,this.enableRemoteAudio=l.enableRemoteAudio,this.disableRemoteAudio=l.disableRemoteAudio,this.addVideo=l.addVideo,this.removeVideo=l.removeVideo,this.toggleRemoteVideo=l.toggleRemoteVideo,this.toggleVideo=l.toggleVideo,this.changeHDVideo=l.changeHDVideo,this.renegotiateMedia=l.renegotiateMedia,this.addMediaStream=l.addMediaStream,this.removeMediaStream=l.removeMediaStream,this.pullRemoteCall=function(a,b,c){var d=l.findCall(a);if(d)return void l.pullRemoteCall(a,b,c);if(d=u(a)){var e=l.getActiveCall();if(e)return e.isTelephonyCall?void l.holdCall(e.callId,function(){n.pullRemoteCall(a,null,c)}):void l.endActiveCall(function(){n.pullRemoteCall(a,null,c)});n.pullRemoteCall(a,null,c)}else j.warn("[CallControlSvc]: pullRemoteCall invoked without a valid call"),c&&c("No active remote call")},this.pushLocalCall=function(a,b,c){n.pushLocalCall(a,b,c)},this.getAtcCalls=function(){return J},this.swapCall=function(a,b){var c=l.findCall(a);if(c&&c.isTelephonyCall&&!c.isRemote)return void l.swapCall(a,b);if(J.length<=1)return void j.warn("[CallControlSvc]: swapCall possible only with 2 calls");for(var e=null,f=0;f<J.length;f++)if(J[f].isHolding()&&J[f].callId===a){e=J[f];break}if(e){var g=e.atcCallInfo.getPosition();for(f=0;f<J.length;f++)if(J[f].checkCstaState([d.Active,d.Conference])&&J[f].atcCallInfo.getPosition()===g&&J[f].callId!==a){var h=J[f];return void n.alternate(e,h,b)}}},this.mergeCall=function(a,b){var c=l.getPhoneCalls(!0);if(J.length<=1&&c.length<=1)return void j.warn("[CallControlSvc]: mergeCall possible only with 2 calls");var e,f;if(c.length>1&&(e=l.findActivePhoneCall(!0),f=l.findHeldPhoneCall(!0),e&&f)){if(!f.isAtcConferenceCall())return void n.conference(f,e,b);K.swapCall(f.callId,function(a){return a?void b(a):void n.conference(e,f,b)})}for(var g=0;g<J.length;g++)if(J[g].checkCstaState([d.Active,d.Conference])&&J[g].callId===a){e=J[g];break}if(e){var h=e.atcCallInfo.getPosition();for(g=0;g<J.length;g++)if(J[g].isHolding()&&J[g].atcCallInfo.getPosition()===h&&J[g].callId!==a)return f=J[g],void n.conference(f,e,b)}},this.transferCall=function(a,b,c){var d,e=l.findCall(a),f=l.getPhoneCalls(!0);if(b=h.cleanPhoneNumber(b),e&&1===f.length){if(!e.isTelephonyCall)return j.warn("[CallControlSvc]: The active call is not a telephony call"),void(c&&c("The active call is not a telephony call"));n.transfer(e,b,c)}else if(e&&2===f.length)return e.isTelephonyCall?(d=l.findHeldPhoneCall(!0),void n.consultationTransfer(e,d,c)):(j.warn("[CallControlSvc]: The active call is not a telephony call"),void(c&&c("The active call is not a telephony call")));if(J.length<1)return j.warn("[CallControlSvc]: transferCall possible only with 1 or 2 calls"),void(c&&c("Not enough calls for the transfer"));if(1===J.length&&!J[0].isHolding())return e=J[0],void n.transfer(e,b,c);for(var g=0;g<J.length;g++)if(!J[g].isHolding()&&J[g].callId===a){e=J[g];break}if(e){var i=e.atcCallInfo.getPosition();for(g=0;g<J.length;g++)if(J[g].isHolding()&&J[g].atcCallInfo.getPosition()===i&&J[g].callId!==a)return d=J[g],void n.consultationTransfer(e,d,c)}},this.holdCall=function(a,b){var c=l.findCall(a);return c?c.isHolding()?(j.warn("[CallControlSvc]: Call is not in valid state"),void(b&&b("Call is not in valid state"))):void l.holdCall(a,b):(c=u(a))?c.isHolding()?(j.warn("[CallControlSvc]: Call is not in valid state"),void(b&&b("Call is not in valid state"))):void n.hold(c,b):(j.warn("[CallControlSvc]: holdCall invoked without a valid call"),void(b&&b("No active remote call")))},this.retrieveCall=function(a,b){var c=l.findCall(a);return c?c.isHolding()?void l.retrieveCall(a,b):(j.warn("[CallControlSvc]: Call is not in valid state"),void(b&&b("Call is not in valid state"))):(c=u(a))?c.isHolding()?void n.retrieve(c,b):(j.warn("[CallControlSvc]: Call is not in valid state"),void(b&&b("Call is not in valid state"))):(j.warn("[CallControlSvc]: retrieveCall invoked without a valid call"),void(b&&b("No active remote call")))},this.reconnectCall=function(a,b){if(J.length<=1)return j.warn("[CallControlSvc]: reconnectCall possible only with 2 calls"),!1;for(var c=null,d=0;d<J.length;d++)if(!J[d].isHolding()&&J[d].callId===a){c=J[d];break}if(c){var e=c.atcCallInfo.getPosition();for(d=0;d<J.length;d++)if(J[d].isHolding()&&J[d].atcCallInfo.getPosition()===e&&J[d].callId!==a){var f=J[d];return n.reconnect(c,f,b),!0}}return!1},this.hideRemoteCall=l.hideRemoteCall,this.dropParticipant=l.dropParticipant,this.addParticipantToCall=l.addParticipantToCall,this.addParticipantToRtcSession=l.addParticipantToRtcSession,this.mute=l.mute,this.unmuteLocally=l.unmuteLocally,this.unmute=l.unmute,this.toggleMute=l.toggleMute,this.muteParticipant=function(a,b,c){if(a&&b){if(c=c||function(){},!F(a))return j.warn("[CallControlSvc]: muteParticipant - There is no local call"),void c("Call invalid");if(b.isMeetingPointInvitee){if(!o)return j.error("[CallControlSvc]: MeetingPointSvc is not initialized"),void c("res_MuteParticipantFailed");o.muteMeetingPoint(b.userId,function(d){d?(j.warn("[CircuitCallControlSvc]: Failed to mute Meeting Point locally"),c("res_MuteParticipantFailed")):l.muteParticipant(a,b,c)})}else l.muteParticipant(a,b,c)}},this.hasUnmutedParticipants=l.hasUnmutedParticipants,this.muteRtcSession=l.muteRtcSession,this.unmuteParticipant=function(a,b,c){if(a&&b){if(c=c||function(){},!F(a))return j.warn("[CallControlSvc]: unmuteParticipant - There is no local call"),void c("Call invalid");if(b.isMeetingPointInvitee){if(!o)return j.error("[CallControlSvc]: MeetingPointSvc is not initialized"),void c("res_UnmuteParticipantFailed");o.unmuteMeetingPoint(b.userId,function(a){a?(j.warn("[CircuitCallControlSvc]: Failed to unmute Meeting Point locally"),c("res_UnmuteParticipantFailed")):c()})}else l.unmuteParticipant(a,b,c)}},this.toggleMuteParticipant=function(a,b,c){if(a&&b)return b.muted?K.unmuteParticipant(a,b,c):K.muteParticipant(a,b,c)},this.toggleVideoParticipant=function(a,b,c){if(a&&b&&b.userId){if(c=c||function(){},!F(a))return j.warn("[CallControlSvc]: toggleVideoParticipant - There is no local call"),void c("Call invalid");if(b.isMeetingPointInvitee){if(!o)return j.error("[CallControlSvc]: MeetingPointSvc is not initialized"),void c("res_StartVideoParticipantFailed");o.toggleVideoMeetingPoint(b.userId,function(a){a?(j.warn("[CallControlSvc]: Failed to toggle video MeetingPoint participant"),c("res_StartVideoParticipantFailed")):c()})}else j.warn("[CallControlSvc]: Cannot toggle video MeetingPoint participant: ",b.userId),c("res_StartVideoParticipantFailed")}},this.stopRingingTone=l.stopRingingTone,this.endActiveCall=l.endActiveCall,this.startRecording=l.startRecording,this.stopRecording=l.stopRecording,this.raiseQuestion=l.raiseQuestion,this.inviteToStage=l.inviteToStage,this.inviteToStageAnswer=l.inviteToStageAnswer,this.inviteToStageCancel=l.inviteToStageCancel,this.removeFromStage=l.removeFromStage,this.getQuestions=l.getQuestions,this.updateQuestionState=l.updateQuestionState,this.openCurtain=l.openCurtain,this.closeCurtain=l.closeCurtain,this.getNodeState=l.getNodeState,this.canSendWebRTCDigits=l.canSendWebRTCDigits,this.sendDigits=function(a,b,c){var d=l.findCall(a);return d?void(d.sessionCtrl.canSendDTMFDigits()?l.sendDigits(a,b,c):d.atcCallInfo?n.generateDigits(d,b,function(a){a?c("res_SendDtmfFailed"):c()}):c("res_SendDtmfFailed")):(d=u(a),void(d?n.generateDigits(d,b,c):(j.warn("[CallControlSvc]: SendDigits invoked without a valid call"),c("Call not found"))))},this.disableIncomingVideo=l.disableIncomingVideo,this.enableIncomingVideo=l.enableIncomingVideo,this.toggleParticipantPointer=l.toggleParticipantPointer,this.findCall=l.findCall,this.findConversationByCallId=A,this.sendParticipantPointer=l.sendParticipantPointer,this.sendParticipantDrawing=l.sendParticipantDrawing,this.getCallDevices=n.getCallDevices,this.getPushDevices=n.getPushDevices,this.getAnswerDevices=function(a){if(a&&"object"==typeof a)return n.getAnswerDevices(a);var b=l.findCall(a)||u(a);return n.getAnswerDevices(b)},this.updateActiveCallMediaDevices=l.updateActiveCallMediaDevices,this.addSimulatedParticipants=l.addSimulatedParticipants,this}var c=a.Enums.CallState,d=a.Enums.CstaCallState,e=a.Constants,f=a.Enums,g=a.Enums.Targets,h=a.Utils,i=a.UserToUserHandlerSingleton;return a.CallControlSvcImpl=b,a}(Circuit),Circuit=function(a){"use strict";function b(a,b){if(!a||!a.localUser)return g.warn("[sdk-services]: Cannot extend Conversation object without localUser"),null;if(!b||b.isExtended)return b;var c=Object.create(b);c.isExtended=!0,c.moderators=c.moderators||[];var d=b.participants.map(function(a){return"string"==typeof a?{userId:a}:a}).filter(function(b){return b.userId===a.localUser.userId&&(c.hasJoined=!0),b.userId!==a.localUser.userId});return c.peerUsers=d,b.type===f.ConversationType.DIRECT&&(c.peerUser=d[0]),c.userIsModerator=function(a){return!!a&&c.moderators.some(function(b){return b.userId===a.userId})},c}function c(a){if(!a||a.isExtended)return a;var b=Object.create(a);return b.isExtended=!0,b}function d(a){var b=a&&a.accounts&&a.accounts[0],c=b&&b.telephonyConfiguration;if(c){if(c.phoneNumber=h.format(c.phoneNumber)||"",c.callerId=h.format(c.callerId)||"",c.reroutingPhoneNumber=h.format(c.reroutingPhoneNumber)||"",a.reroutingPhoneNumber=c.reroutingPhoneNumber,a.ondSipAuthenticationHash=c.ondSipAuthenticationHash,a.onsSipAuthenticationHash=c.onsSipAuthenticationHash,a.associatedTelephonyUserID=c.associatedTelephonyUserID,a.associatedTelephonyUserType=c.associatedTelephonyUserType,a.previousAlternativeNumbers=(c.previousAlternativeDevice||[]).map(i.cleanPhoneNumber),a.reroutingPhoneNumber){var d=i.cleanPhoneNumber(a.reroutingPhoneNumber);a.previousAlternativeNumbers.contains(d)||a.previousAlternativeNumbers.unshift(d)}a.associatedTelephonyUserID&&a.associatedTelephonyUserType===f.GtcTrunkType.ATC_TRUNK_TYPE?(a.associatedGTCUserId=a.associatedTelephonyUserID,a.isATC=!0):a.isATC=!1}else delete a.associatedGTCUserId,delete a.reroutingPhoneNumber,delete a.ondSipAuthenticationHash,delete a.onsSipAuthenticationHash,delete a.associatedTelephonyUserID,delete a.associatedTelephonyUserType,delete a.isATC}function e(e,f){l=e,m=f,this.rootScope={localUser:null,clientVersion:"",browser:i.getBrowserInfo(),circuitLabs:{},$$phase:!0,$apply:function(a){a&&a()},$digest:function(){},i18n:{localize:function(a){return a},map:{res_Unknown:"Unknown"}},localize:function(a){return a}},a.Conversation={extend:b.bind(null,this.rootScope)},a.UserProfile={extend:c.bind(null),syncTelephonyConfig:d.bind(null)},this.PubSubSvc=new a.PubSubSvcImpl(g),this.ExtensionSvc=new a.ExtensionSvcImpl(this.rootScope,j,window,Promise,g,this.PubSubSvc,null),this.SdkHelperSvc=new a.SdkHelperSvcImpl(this.rootScope,Promise,g,this.PubSubSvc),this.AtcRegistrationSvc=new a.AtcRegistrationSvcImpl(this.rootScope,j,g,this.PubSubSvc,this.SdkHelperSvc),this.CircuitCallControlSvc=new a.CircuitCallControlSvcImpl(this.rootScope,j,k,window,Promise,g,this.PubSubSvc,this.SdkHelperSvc,this.SdkHelperSvc,null,this.SdkHelperSvc),this.CstaSvc=new a.CstaSvcImpl(this.rootScope,j,g,this.PubSubSvc,this.CircuitCallControlSvc,this.AtcRegistrationSvc,this.SdkHelperSvc,this.SdkHelperSvc),this.CallControlSvc=new a.CallControlSvcImpl(this.rootScope,Promise,g,this.PubSubSvc,this.CircuitCallControlSvc,this.SdkHelperSvc,this.CstaSvc,null,null,this.SdkHelperSvc,this.SdkHelperSvc),a.Conversation=null,a.UserProfile=null,l=null,m=null}var f=a.Constants,g=a.logger,h=a.PhoneNumberFormatter,i=a.Utils,j=function(a,b){return window.setTimeout(a,b)};j.cancel=function(a){a&&window.clearTimeout(a)};var k=function(a,b,c){if(void 0===c)return window.setInterval(a,b);if(c<=0)return null;var d=0,e=null,f=function(){a(),d++,d>=c&&window.clearInterval(e)};return e=window.setInterval(f,b)};k.cancel=function(a){a&&window.clearInterval(a)};var l=null;a.ClientApiHandlerSingleton.getInstance=function(){return l};var m=null;return a.UserToUserHandlerSingleton.getInstance=function(){return m},a.SdkServices=e,a}(Circuit),Circuit=function(a){"use strict";var b={};return a.Injectors=b,a}(Circuit||{}),Circuit=function(a){"use strict";function b(){if(window.frameElement&&window.parent)window.parent.document.body.removeChild(window.frameElement);else try{window.close()}catch(a){}}function c(a,c){if(a.location.hash||a.location.search){var d=Object.assign({},j.parseQS(a.location.hash),j.parseQS(a.location.search));if(d.state)try{Object.assign(d,JSON.parse(d.state))}catch(a){g.error("Could not decode state parameter")}if(d.display&&"popup"===d.display&&d.redirect_uri===a.location.origin+a.location.pathname&&a.document.addEventListener("DOMContentLoaded",function(){a.document.body.innerHTML="Redirecting, please wait..."}),d.callback){var e=d.callback;if(e in c)try{delete d.callback,c[e](d)}catch(a){}}d.display&&"popup"===d.display&&b()}}var d=a.Enums.ConnectionState,e=a.Enums.ConversationType,f=a.Constants,g=a.logger,h=a.PrivateData,i=a.Enums.Targets,j=a.Utils;c(window,window.opener||window.parent);var k=j.getBrowserInfo();return a.ExtensionConnHandlerSingleton.getInstance(),a.Client=function(b){function c(a,b,c,d){if(a===f.ReturnCode.NO_RESULT&&c)return!1;if(a){var e=Sb.getLastError();return d&&d(e),e&&delete e.errObj,b(e),!0}return!1}function k(a,b){return!!a&&(b(new Circuit.Error(f.ReturnCode.SDK_ERROR,a)),!0)}function l(){return"https://"+Gb.domain+"/"}function m(a,b,c){var d,e={};return e.width=b,e.height=c,e.left=window.screenX+(window.outerWidth-b)/2,e.top=window.screenY+(window.outerHeight-c)/2,e.scrollbars="yes",d=Object.keys(e).map(function(a){return a+"="+e[a]}).join(", "),window.open(a,e.name,d)}function n(a){return Hb.scope.split(",").indexOf(a)>=0||Hb.scope.split(",").indexOf("ALL")>=0}function o(a){a=a||{},Hb.client_id=a.client_id,Hb.client_secret=a.client_secret,Hb.redirect_uri=a.redirect_uri||window.location.origin+window.location.pathname,Hb.scope=(a.scope?a.scope.replace(/\s+/g,""):"")||"ALL",n(f.OAuthScope.READ_USER_PROFILE)||(Hb.scope=f.OAuthScope.READ_USER_PROFILE+","+a.scope),n(f.OAuthScope.ALL)&&(Hb.scope=f.OAuthScope.ALL)}function p(a){return new Promise(function(b,c){var d=Mb?new XMLHttpRequest(Hb):new XMLHttpRequest;if(d.open(a.type||a.dataType||"GET",a.url,!0),d.withCredentials=a.xhrFields&&a.xhrFields.withCredentials,!Ib||a.headers&&a.headers.Authorization||d.setRequestHeader("Authorization","Bearer "+Ib),a.headers)for(var e in a.headers)a.headers.hasOwnProperty(e)&&d.setRequestHeader(e,a.headers[e]);d.onload=function(){if(200===d.status)a.success&&a.success(d.responseText),b(d.responseText);else{var e=new Circuit.Error(d.status,d.responseText||d.statusText);a.error&&a.error(e),c(e)}},d.onerror=function(){var b=new Circuit.Error(f.ErrorCode.AUTHORIZATION_FAILED,"Network error or incorrect credentials");a.error&&a.error(b),c(b)};var g;a.data&&(g=j.toQS(a.data),d.setRequestHeader("Content-type","application/x-www-form-urlencoded")),d.send(g)})}function q(a){return new Promise(function(b,c){var d="/sdklogin";p({type:"POST",url:"https://"+Gb.domain+d,data:{token:a.token||void 0,accessToken:a.accessToken||void 0},xhrFields:{withCredentials:!0},crossDomain:!0}).then(function(){a.accessToken&&(Ib=a.accessToken),b()}).catch(c)})}function r(){return p({url:"https://"+Gb.domain+"/validateSession",xhrFields:{withCredentials:!0},crossDomain:!0})}function s(){return new Promise(function(a,b){Rb&&(window.clearInterval(Rb),Rb=null,Sb.disconnect()),Sb.setToken(Ib),Sb.connect(function(){g.info("[SDK]: Successfully connected to access server."),Rb=window.setInterval(Fb,50),a()},function(a){g.error("[SDK]: Failed to connect: ",a),Sb.disconnect(),b(new Circuit.Error(f.ReturnCode.SDK_ERROR,a))},Gb.domain)})}function t(){return new Promise(function(a,b){if(!Hb.client_id)return void b(new Circuit.Error(f.ReturnCode.SDK_ERROR,"client_id missing in client object"));if(!window.localStorage)return void a();var c=window.localStorage.getItem("oauth");try{c=JSON.parse(c)}catch(a){return window.localStorage.removeItem("oauth"),void b(new Circuit.Error(f.ReturnCode.SDK_ERROR,"Error parsing OAuth app in localStorage"))}c&&"object"==typeof c||(c={}),c[Hb.client_id]={access_token:Ib,domain:Gb.domain,expires_at:Jb},window.localStorage.setItem("oauth",JSON.stringify(c)),g.debug("[SDK]: Stored access_token for client_id: "+Hb.client_id),a()})}function u(){return new Promise(function(a,b){var c=window.localStorage.getItem("oauth");if(!c)return void b(new Circuit.Error(f.ReturnCode.SDK_ERROR,"OAuth access token not found in localStorage"));try{c=JSON.parse(c)}catch(a){return void b(new Circuit.Error(f.ReturnCode.SDK_ERROR,"Error parsing OAuth app in localStorage"))}if("object"!=typeof c)return void b(new Circuit.Error(f.ReturnCode.SDK_ERROR,"invalid data in localStorage"));var d=c[Hb.client_id];d&&d.access_token?(Ib=d.access_token,Jb=d.expires_at,g.debug("[SDK]: Retrieved access_token for client_id: "+Hb.client_id),a(Ib)):b(new Circuit.Error(f.ReturnCode.SDK_ERROR,"client_id not found in localStorage"))})}function v(a){var b="_circuit_"+parseInt(1e12*Math.random(),10).toString(36);return window[b]=function(){try{a.apply(this,arguments)&&delete window[b];
}catch(a){g.error(a)}},b}function w(){return new Promise(function(a,b){var c=null;if(!Hb.client_id)return Gb.oauthwin&&(Gb.oauthwin.close(),Gb.oauthwin=null),void b(new Circuit.Error(f.ReturnCode.SDK_ERROR,"client_id missing in client object"));Ib=void 0;var d=v(function(d){if(c&&window.clearInterval(c),!d||d.error){Ib=void 0;var e=d?d.error:"The authentication was not completed";b(new Circuit.Error(f.ReturnCode.SDK_ERROR,e))}else Ib=d.access_token,Jb=d.expires_in&&Date.now()+1e3*d.expires_in,t().catch(function(a){g.error("[SDK]: Failed to store the OAuth access token.",a)}).then(function(){a({username:d.username,accessToken:d.access_token})})}),e={client_id:Hb.client_id,redirect_uri:Hb.redirect_uri,response_type:"token",scope:Hb.scope||""};e.state=JSON.stringify({callback:d,display:"popup",redirect_uri:e.redirect_uri});var h="https://"+Hb.domain+"/oauth/authorize?"+j.toQS(e),i=Gb.oauthwin||m(h,450,500);Gb.oauthwin=null,i.location.href=h,c=window.setInterval(function(){i&&!i.closed||(c&&window.clearInterval(c),b(new Circuit.Error(f.ReturnCode.SDK_ERROR,"OAuth popup cancelled")))},500)})}function x(){return new Promise(function(a,b){var c=null,d=v(function(d){if(c&&window.clearInterval(c),!d||d.error){var e=d?d.error:"The authentication was not completed";b(new Circuit.Error(f.ReturnCode.SDK_ERROR,e))}else a({username:d.username})}),e=JSON.stringify({callback:d,display:"popup",redirect_uri:Hb.redirect_uri}),g={return_to:Hb.redirect_uri+"#state="+e},h="https://"+Hb.domain+"/oauth/login?"+j.toQS(g),i=Gb.oauthwin||m(h,450,500);Gb.oauthwin=null,i.location.href=h,c=window.setInterval(function(){i&&!i.closed||(c&&window.clearInterval(c),b(new Circuit.Error(f.ReturnCode.SDK_ERROR,"Auth popup cancelled")))},500)})}function y(a){return a=a||Ib,p({type:"GET",url:"https://"+Gb.domain+"/oauth/token/"+a,crossDomain:!0})}function z(){if(Hb.autoRenewToken&&Jb){Kb&&window.clearTimeout(Kb);var a=Jb-Date.now()-6e4;a>0&&(Kb=window.setTimeout(A,a))}}function A(){return new Promise(function(a,b){var c={type:"POST",url:"https://"+Gb.domain+"/oauth/token",data:{scope:Hb.scope,grant_type:"implicit"}};Hb.client_secret&&(c.headers={Authorization:"Basic "+window.btoa(Hb.client_id+":"+Hb.client_secret)},c.data.grant_type="client_credentials"),p(c).then(function(c){var d=JSON.parse(c);if(d&&d.access_token&&"Bearer"===d.token_type)Ib=d.access_token,Sb.setToken(Ib),Jb=d.expires_in&&Date.now()+1e3*d.expires_in,z(),Eb({type:"accessTokenRenewed"}),a(Ib);else{Ib=null,Jb=null;var e=new Circuit.Error(f.ReturnCode.SDK_ERROR,"Error renewing OAuth2 access token");Eb({type:"renewAccessTokenFailed",error:e}),b(e)}}).catch(b)})}function B(){return n(f.OAuthScope.READ_USER_PROFILE)?J():Promise.resolve()}function C(){return n(f.OAuthScope.CALLS)?Vb.CallControlSvc.initActiveSessionsForSdk():Promise.resolve()}function D(){return n(f.OAuthScope.CALLS)&&Hb.enableTelephony&&Vb.AtcRegistrationSvc.initAtcForSdk(),Promise.resolve()}function E(){return s().then(I).then(B).then(C).then(D).then(function(){return Gb.loggedOnUser})}function F(){return new Promise(function(a,b){p({type:"POST",url:"https://"+Gb.domain+"/oauth/token",headers:{Authorization:"Basic "+window.btoa(Hb.client_id+":"+Hb.client_secret)},data:{grant_type:"client_credentials",scope:Hb.scope}}).then(function(c){var d=JSON.parse(c);d&&d.access_token&&"Bearer"===d.token_type?(Ib=d.access_token,Jb=d.expires_in&&Date.now()+1e3*d.expires_in,z(),a({accessToken:Ib})):(Ib=null,Jb=null,b(new Circuit.Error(f.ReturnCode.SDK_ERROR,"Internal error with Client Credentials Grant authentication")))}).catch(b)})}function G(a){return a?new Promise(function(a){var b=function(){Ib=null,Jb=null,Sb.disconnect(),window.clearInterval(Rb),Gb.dispatch({type:"connectionStateChanged",state:d.Disconnected}),a()},c=window.setTimeout(function(){c=null,b()},2e3);Sb.logout(function(){c&&(window.clearTimeout(c),b())})}):(Ib=null,Jb=null,Sb.disconnect(),Promise.resolve())}function H(a){return new Promise(function(b,d){a=a||Ib,Ib=null,Jb=null,t(),Sb.revokeAccessToken(a,function(a){c(a,d)||b()})})}function I(){return new Promise(function(a,b){Sb.getUserData(function(d,e){if(!c(d,b)){var f=e.getUserData,g=f.clientSettings;void 0!==g.allowAllIceCandidatesScreenShare&&(Ub.allowAllIceCandidatesScreenShare=!!g.allowAllIceCandidatesScreenShare),void 0!==g.disableTrickleIce&&(Ub.disableTrickleIce=!!g.disableTrickleIce),a(f)}})})}function J(){return new Promise(function(a,b){Sb.getLoggedOnUser(function(d,e){c(d,b)||yb(e.user).then(function(b){Gb.loggedOnUser=b,Vb.SdkHelperSvc.setLocalUser(b),a(b)})})})}function K(a){return new Promise(function(b,d){a=a||{},a.pageSize=a.pageSize||25,a.sorting=a.sorting||f.GetAccountsSorting.BY_FIRST_NAME,Sb.getAccounts(a,function(a,e){c(a,d)||Promise.all(e.accounts.map(function(a){return yb(a.user)})).then(b).catch(d)})})}function L(a){return new Promise(function(b,d){a=a||{},a.numberOfConversations=a.numberOfConversations||25,a.direction=a.direction||f.SearchDirection.BEFORE,Sb.getConversations(Gb.loggedOnUser.userId,a.timestamp,a.direction,a.numberOfConversations,f.ConversationFilter.ALL,function(a,e){c(a,d)||Promise.all(e.map(Cb)).then(b).catch(d)})})}function M(){return new Promise(function(a,b){Sb.getMarkedConversationsList(function(d,e){c(d,b,!0)||a(e||[])})})}function N(a){return new Promise(function(b,d){Sb.getConversationById(a,function(a,e){c(a,d)||Cb(e).then(b).catch(d)})})}function O(a,b){return new Promise(function(d,e){b=b||{},Sb.getConversationParticipants(a,b,function(a,b){c(a,e)||Promise.all(b.participants.map(Db)).then(function(a){b.participants=a,d(b)}).catch(e)})})}function P(a){return new Promise(function(b,d){Sb.getItemById(a,function(a,e){c(a,d)||zb(e).then(b).catch(d)})})}function Q(a,b){return new Promise(function(d,e){b=b||{},b.modificationDate=b.modificationDate||void 0,b.creationDate=b.creationDate||b.creationTime||void 0,b.direction=b.direction||f.SearchDirection.BEFORE,b.numberOfItems=b.numberOfItems||25,Sb.getConversationItems(a,b.modificationDate,b.creationDate,b.direction,b.numberOfItems,function(a,b){c(a,e)||Promise.all(b.map(zb)).then(d).catch(e)})})}function R(a,b){return new Promise(function(d,e){b=b||{},Sb.getConversationFeed(a,b.timestamp,b.minTotalItems,b.maxTotalUnread,b.commentsPerThread,b.maxUnreadPerThread,function(a,b,f){c(a,e)||Promise.all(b.map(Bb)).then(function(a){d({threads:a,hasOlderThreads:f})}).catch(e)})})}function S(a,b,d){return new Promise(function(e,g){var h=d.modificationDate||d.creationDate,i=d.modificationDate?f.TimestampFilter.MODIFICATION:f.TimestampFilter.CREATION;Sb.getThreadComments(a,b,h,i,d.direction,d.number,function(a,b,d){c(a,g)||Promise.all(b.map(zb)).then(function(a){e({items:a,hasMore:d})}).catch(g)})})}function T(a){return new Promise(function(b,d){Sb.getUserByEmail(a,function(a,e){c(a,d,null,function(a){a&&a.code===f.ReturnCode.NO_RESULT&&(a.info="User does not exist")})||yb(e).then(b).catch(d)})})}function U(a){return new Promise(function(b,d){if(!a)return void d(new Circuit.Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"email is required"));if(!a.length)return b([]);var e={emailAddresses:a};Sb.getUsersByEmails(e,function(a,e){c(a,d)||Promise.all(e.map(yb)).then(b).catch(d)})})}function V(a){return new Promise(function(b,d){return a?void Sb.getUser(a,function(a,e){c(a,d)||yb(e).then(b).catch(d)}):void d(new Circuit.Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"userId is required"))})}function W(a,b){return new Promise(function(d,e){if(!a)return void e(new Circuit.Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"userIds is required"));if(!a.length)return d([]);var g=b?Sb.getPartialUsersByIds:Sb.getUsersByIds;g(a,function(a,b){c(a,e)||Promise.all(b.map(yb)).then(d).catch(e)})})}function X(){return new Promise(function(a,b){Sb.getDevices(function(d,e){c(d,b,!0)||a(e||[])})})}function Y(){return new Promise(function(a,b){Sb.getTelephonyConversationId(function(d,e){c(d,b)||a(e)})})}function Z(){return new Promise(function(a,b){Sb.getSupportConversationId(function(d,e){c(d,b)||a(e)})})}function $(a){return"string"==typeof a&&(a={userId:a,createIfNotExists:!1}),new Promise(function(b,d){return a.userId?void Sb.getConversationByUser(a.userId,function(e,g){return e?void(e===f.ReturnCode.NO_RESULT?a.createIfNotExists?ca(a.userId).then(function(a){b(a&&a.conversation)}):b():c(e,d)):void Cb(g).then(b).catch(d)}):void d(new Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"user ID is required"))})}function _(a,b){return"string"!=typeof a?Promise.reject(new Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"email or user ID is required")):a.match(j.EMAIL_ADDRESS_PATTERN)?T(a).then(function(a){return{userId:a.userId,createIfNotExists:b}}).then($):$({userId:a,createIfNotExists:b})}function aa(b,d){return new Promise(function(e,h){function i(a){Sb.addTextItem(a,function(a,b){c(a,h)||zb(b).then(e).catch(h)})}if(!b)return void h(new Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"convId is required"));if(!d)return void h(new Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"content is required"));if("string"==typeof d)i({convId:b,content:d,contentType:"RICH"});else if("object"==typeof d){var j={convId:b,parentId:d.parentId,contentType:d.contentType||f.TextItemContentType.RICH,subject:d.subject,content:d.content,externalAttachmentMetaData:d.externalAttachments};if(d.attachments&&d.attachments.length>0){var k=new a.FileUpload(Hb);k.uploadFiles(d.attachments,Gb.domain).then(function(a){j.attachmentMetaData=[],a.forEach(function(a){j.attachmentMetaData.push(a)}),i(j)}).catch(function(a){g.error("[SDK]: Fileupload error.",a),h(new Circuit.Error(f.ReturnCode.SDK_ERROR,a))})}else i(j)}else h(new Circuit.Error(f.ReturnCode.SDK_ERROR,"Invalid content"))})}function ba(b){return new Promise(function(d,e){function h(a){Sb.updateTextItem(a,function(a,b){c(a,e)||zb(b).then(d).catch(e)})}if(!b)return void e(new Circuit.Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"item is required"));if(!b.itemId)return void e(new Circuit.Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"item.itemId is required"));if("object"==typeof b)if(b.attachments&&b.attachments.length>0){var i=new a.FileUpload(Hb);i.uploadFiles(b.attachments,Gb.domain).then(function(a){b.attachmentMetaData=[],a.forEach(function(a){b.attachmentMetaData.push(a)}),h(b)}).catch(function(a){g.error("[SDK]: Fileupload error.",a),e(new Circuit.Error(f.ReturnCode.SDK_ERROR,a))})}else h(b);else e(new Circuit.Error(f.ReturnCode.SDK_ERROR,"Invalid content"))})}function ca(a){return new Promise(function(b,d){if(Gb.loggedOnUser.userId===a)return d(new Circuit.Error(f.ReturnCode.SDK_ERROR,"userId is of logged on user"));var e={type:f.ConversationType.DIRECT,participants:[{userId:a},{userId:Gb.loggedOnUser.userId}]};Sb.createConversation(e,function(a,e,f){c(a,d)||Cb(e).then(function(a){b({conversation:a,alreadyExists:f})})})})}function da(a){return a&&"string"==typeof a?a.match(j.EMAIL_ADDRESS_PATTERN)?T(a).then(function(a){return a.userId}).then(ca):ca(a):Promise.reject(new Circuit.Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"Participant email or user ID is required"))}function ea(a,b){return new Promise(function(d,e){if(!a)return void e(new Circuit.Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"Participants is required"));if(a.indexOf(Gb.loggedOnUser.userId)===-1&&a.unshift(Gb.loggedOnUser.userId),a.length<2)return void e(new Circuit.Error(f.ReturnCode.SDK_ERROR,"At least one participant (other than self) is required"));if(a.indexOf("")>-1||a.indexOf(null)>-1)return void e(new Circuit.Error(f.ReturnCode.SDK_ERROR,"Participant cannot be empty"));a=a.map(function(a){return{userId:a}});var g={type:f.ConversationType.GROUP,participants:a,topic:b};Sb.createConversation(g,function(a,b){c(a,e)||Cb(b).then(d).catch(e)})})}function fa(a){return new Promise(function(b,d){if(!a)return void d(new Circuit.Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"Topic is required"));var e={type:f.ConversationType.GROUP,participants:[{userId:Gb.loggedOnUser.userId}],topic:a};Sb.createConversation(e,function(a,e){c(a,d)||Cb(e).then(b).catch(d)})})}function ga(a,b,d){return new Promise(function(e,g){a&&a.length||(a=[Gb.loggedOnUser.userId]),a=a.map(function(a){return{userId:a}});var h={type:f.ConversationType.OPEN,participants:a,topic:b,description:d};Sb.createConversation(h,function(a,b){c(a,g)||Cb(b).then(e).catch(g)})})}function ha(a,b){return new Promise(function(d,e){var f={convId:a,userId:b};Sb.addParticipant(f,function(a){c(a,e)||d()})})}function ia(a,b){return new Promise(function(d,e){Sb.removeParticipant(a,b,function(a){c(a,e)||d()})})}function ja(){return new Promise(function(a,b){Sb.getFlaggedItems(function(d,e){c(d,b,!0)||a(e||[])})})}function ka(a,b){return new Promise(function(d,e){Sb.setFlagItem({convId:a,itemId:b},function(a){c(a,e)||d()})})}function la(a,b){return new Promise(function(d,e){Sb.clearFlagItem(a,b,function(a){c(a,e)||d()})})}function ma(a){return new Promise(function(b,d){Sb.likeTextItem(a,Gb.loggedOnUser.userId,function(a){c(a,d)||b()})})}function na(a){return new Promise(function(b,d){Sb.unlikeTextItem(a,Gb.loggedOnUser.userId,function(a){c(a,d)||b()})})}function oa(a,b){return new Promise(function(d,e){b=b||Date.now(),Sb.setReadPointer(a,b,function(a){c(a,e)||d()})})}function pa(a){return new Promise(function(b,d){return a?void Sb.moderateConversation(a,function(a,e){if(!c(a,d))return e&&"LOCK_OK"===e.moderateResult?void b():void d(e)}):void d(new Circuit.Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"item is required"))})}function qa(a){return new Promise(function(b,d){return a?void Sb.unmoderateConversation(a,function(a,e){if(!c(a,d))return e&&"UNLOCK_OK"===e.moderateResult?void b():void d(e)}):void d(new Circuit.Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"item is required"))})}function ra(a,b){return new Promise(function(d,e){return a&&b?void Sb.grantModeratorRights(a,b,function(a,b){if(!c(a,e))return b&&"GRANT_OK"===b.grantModeratorResult?void d():void e(b)}):void e(new Circuit.Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"item is required"))})}function sa(a,b){return new Promise(function(d,e){return a&&b?void Sb.dropModeratorRights(a,b,function(a,b){if(!c(a,e))return b&&"DROP_OK"===b.dropModeratorResult?void d():void e(b)}):void e(new Circuit.Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"item is required"))})}function ta(a){return new Promise(function(b,d){Sb.updateUser(a,function(a){c(a,d)||b()})})}function ua(a,b){return new Promise(function(d,e){Sb.changePassword(a,b,function(a){c(a,e)||d()})})}function va(a){var b={};return a&&a.forEach(function(a){switch(a.key){case f.UserSettingKey.OPT_OUT_PRESENCE:b.presenceOptOut=a.booleanValue;break;case f.UserSettingKey.SHARE_LOCATION:b.shareLocation=a.booleanValue}}),b}function wa(a){return new Promise(function(b,d){if(!a)return void d(new Circuit.Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"userSettings is required"));var e=[];void 0!==a.presenceOptOut&&e.push({key:f.UserSettingKey.OPT_OUT_PRESENCE,dataType:f.UserSettingDataType.BOOLEAN,booleanValue:!!a.presenceOptOut}),void 0!==a.shareLocation&&e.push({key:f.UserSettingKey.SHARE_LOCATION,dataType:f.UserSettingDataType.BOOLEAN,booleanValue:!!a.shareLocation}),Sb.setUserSettings(e,function(a){c(a,d)||b()})})}function xa(){return new Promise(function(a,b){Sb.getUserSettings([f.UserSettingArea.ALL],function(d,e){c(d,b)||a(va(e))})})}function ya(a){return new Promise(function(b,d){a.userId=Gb.loggedOnUser.userId,Sb.setPresence(a,function(a){c(a,d)||b()})})}function za(a,b){return new Promise(function(d,e){Sb.getPresence(a,b,function(a,b){c(a,e)||d(b)})})}function Aa(a){return new Promise(function(b,d){a=a||"",Sb.setUserSettings({key:f.UserSettingKey.STATUS_MESSAGE_TEXT,dataType:f.UserSettingDataType.STRING,stringValue:a},function(e){c(e,d)||za([Gb.loggedOnUser.userId]).then(function(b){return ya({state:b.length&&b[0].state,statusMessage:a})}).then(b).catch(d)})})}function Ba(){return new Promise(function(a,b){Sb.getUserSettings([f.UserSettingArea.ALL],function(d,e){if(!c(d,b)){var g="";e&&e.some(function(a){if(a.key===f.UserSettingKey.STATUS_MESSAGE_TEXT)return g=a.stringValue,!0}),a(g)}})})}function Ca(a){return new Promise(function(b,d){Sb.subscribePresence(a,function(a){c(a,d)||b()})})}function Da(a){return new Promise(function(b,d){Sb.unsubscribePresence(a,function(a){c(a,d)||b()})})}function Ea(){return new Promise(function(a,b){Sb.renewToken(Gb.loggedOnUser.userId,function(d){return c(d,b)?void Eb({type:"renewSessionTokenFailed",error:d}):(g.debug("[SDK]: Session token renewed"),Eb({type:"sessionTokenRenewed"}),void a())})})}function Fa(a){return"string"==typeof a&&(a={query:a}),new Promise(function(b,c){Sb.startUserSearch(a,function(a,d){a?c(a):b(d)})})}function Ga(a){return X().then(function(b){return b.some(function(b){return a?b.clientId===a:b.clientId!==Gb.loggedOnUser.clientId&&b.clientInfo.deviceType===f.DeviceType.WEB})})}function Ha(a){return X().then(function(b){return b.some(function(b){return b.clientId===a})})}function Ia(a,b,c,d){return new Promise(function(e,g){function h(){var c=Gb.domain.startsWith("sdk.")?Gb.domain.substr(4):Gb.domain,d="https://"+c+"/#/call?user="+a+"&media="+b,h=window.open(d,"_blank");return h?(h.focus(),void e({type:"CALL_VIA_URL",win:h})):void g(new Circuit.Error(f.ErrorCode.SDK_ERROR,"Popup blocker prevented opening Circuit in new window"))}function i(c){var d={content:{type:"CLICK_TO_CALL_REQUEST",mediaType:b,contact:{email:a}},destUserId:Gb.loggedOnUser.userId};c&&(d.destClientId=c),Tb.sendContactCardRequest(d,function(a){a?g(new Circuit.Error(f.ErrorCode.SDK_ERROR,a)):e({type:"CALL_VIA_OTHER_CLIENT"})})}b=b||"audio",c?Ha(c).then(function(a){a?i(c):g(new Circuit.Error(f.ErrorCode.SDK_ERROR,"No client found for clientId "+c))}):Ga().then(function(a){a?i():d?g(new Circuit.Error(f.ErrorCode.SDK_ERROR,"No clients found and launch parameter not set.")):h()})})}function Ja(a,b,c){return new Promise(function(d,e){return a?(c=c||{},void 0===c.mic&&(c.mic=!0),void 0===c.speaker&&(c.speaker=!0),void Ga(b).then(function(g){if(g){var h={content:{type:"MUTE_DEVICE_REQUEST",callId:a,option:c},destUserId:Gb.loggedOnUser.userId,destClientId:b};Tb.sendContactCardRequest(h,function(a,b){return a?void e(new Circuit.Error(f.ErrorCode.SDK_ERROR,a)):b&&b.response?b.response.code&&"OK"!==b.response.code?void e(new Circuit.Error(f.ErrorCode.SDK_ERROR,b.response.code)):void d():void e(new Circuit.Error(f.ErrorCode.SDK_ERROR,"Invalid response for MUTE_DEVICE_REQUEST"))})}else e(new Circuit.Error(f.ErrorCode.SDK_ERROR,"Device not found"))})):void e(new Circuit.Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))})}function Ka(a,b){return new Promise(function(c,d){if(!a)return void d(new Circuit.Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"));if(!b)return void d(new Circuit.Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"to parameter is required"));if(!b.userId&&!b.email&&!b.number)return void d(new Circuit.Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"to.userId, to.email or to.number is required"));var e={userId:b.userId||void 0,dialOutPhoneNumber:b.number||void 0,displayName:b.displayName||void 0};!b.userId&&b.email&&b.email.match(j.EMAIL_ADDRESS_PATTERN)?T(b.email).then(function(b){e.userId=b.userId,Vb.CallControlSvc.addParticipantToCall(a,e,function(a){a?d(new Circuit.Error(f.ErrorCode.SDK_ERROR,a)):c()})}).catch(d):Vb.CallControlSvc.addParticipantToCall(a,e,function(a){a?d(new Circuit.Error(f.ErrorCode.SDK_ERROR,a)):c()})})}function La(a,b){return new Promise(function(c,d){if(!a)return void d(new Circuit.Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"));if(!b)return void d(new Circuit.Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"to parameter is required"));if(!b.userId&&!b.email&&!b.number)return void d(new Circuit.Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"to.userId, to.email or to.number is required"));var e={userId:b.userId||void 0,dialOutPhoneNumber:b.number||void 0,displayName:b.displayName||void 0};!b.userId&&b.email&&b.email.match(j.EMAIL_ADDRESS_PATTERN)?T(b.email).then(function(b){e.userId=b.userId,Vb.CallControlSvc.addParticipantToRtcSession(a,e,function(a){a?d(new Circuit.Error(f.ErrorCode.SDK_ERROR,a)):c()})}).catch(d):Vb.CallControlSvc.addParticipantToRtcSession(a,e,function(a){a?d(new Circuit.Error(f.ErrorCode.SDK_ERROR,a)):c()})})}function Ma(a){var b=Vb.CallControlSvc.findCall(a);return b?b:(b=Vb.CallControlSvc.getActiveCall(a),b||null)}function Na(){return Promise.all(Vb.CallControlSvc.getCalls().map(xb))}function Oa(){return Promise.resolve(xb(Vb.CallControlSvc.getActiveCall()))}function Pa(){return Promise.all(Vb.CallControlSvc.getActiveRemoteCall().map(xb))}function Qa(){return Promise.all(Vb.CallControlSvc.getCalls().filter(function(a){return a.state.name===Circuit.Enums.CallState.Started.name}).map(xb))}function Ra(a,b){return N(a).then(function(a){return new Promise(function(c,d){return a?(Vb.SdkHelperSvc.addConversationToCache(a),void Vb.CallControlSvc.startConference(a.convId,b,function(a,b,e){k(a,d)||xb(e).then(c).catch(d)})):void d(new Circuit.Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"Conversation does not exist"))})})}function Sa(a){return a.pin=a.tenantPIN+a.sessionPIN,a.link&&(a.link="https://"+Gb.domain+a.link),delete a.tenantPIN,delete a.sessionPIN,delete a.conversationId,a}function Ta(a){return new Promise(function(b,d){Sb.getJoinDetails(a,!1,function(a,e){c(a,d)||b(Sa(e))})})}function Ua(a){return new Promise(function(b,d){Sb.getJoinDetails(a,!0,function(a,e){c(a,d)||b(Sa(e))})})}function Va(a,b,c){return new Promise(function(d,e){return a?void(c&&c!==Gb.loggedOnUser.clientId?Ha(c).then(function(g){if(g){var h={content:{type:"JOIN_CONFERENCE_REQUEST",callId:a,mediaType:b},destUserId:Gb.loggedOnUser.userId,destClientId:c};Tb.sendContactCardRequest(h,function(a,b){return a?void e(new Circuit.Error(f.ErrorCode.SDK_ERROR,a)):b&&b.response?b.response.code&&"OK"!==b.response.code?void e(new Circuit.Error(f.ErrorCode.SDK_ERROR,b.response.code)):void d():void e(new Circuit.Error(f.ErrorCode.SDK_ERROR,"Invalid response for JOIN_CONFERENCE_REQUEST"))})}else e(new Circuit.Error(f.ErrorCode.SDK_ERROR,"No client found for clientId "+c))}):Vb.CallControlSvc.joinGroupCall(a,b,function(b){k(b,e)||d(a)})):void e(new Circuit.Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))})}function Wa(a,b){return new Promise(function(c,d){return a?void Vb.CallControlSvc.pullRemoteCall(a,b,function(a){k(a,d)||c()}):void d(new Circuit.Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))})}function Xa(a,b,c){return _(a,c).then(function(a){return new Promise(function(c,d){return a?(Vb.SdkHelperSvc.addConversationToCache(a),void Vb.CallControlSvc.makeCall(a.convId,b,function(a,b,e){k(a,d)||xb(e).then(c).catch(d)})):void d(new Circuit.Error(f.ErrorCode.SDK_ERROR,"Conversation does not exist"))})})}function Ya(a,b){return new Promise(function(c,d){return j.PHONE_PATTERN.test(a||null)?void Vb.CallControlSvc.dialNumber(a,b,{audio:!0,video:!1},function(a,b,e){k(a||b,d)||xb(e).then(c).catch(d)}):void d(new Circuit.Error(f.ReturnCode.SDK_ERROR,"Invalid number"))})}function Za(a,b){return new Promise(function(c,d){return/^[\d#\*,]+$/.exec(b)?void Vb.CallControlSvc.sendDigits(a,b,function(a){k(a,d)||c()}):void d(new Circuit.Error(f.ReturnCode.SDK_ERROR,"Invalid DTMF digits (Allowed: 0-9,#,*)"))})}function $a(a,b,c){return new Promise(function(d,e){return a?void Vb.CallControlSvc.answerCallOnDevice(a,b,c&&i[c],function(a){k(a,e)||d()}):void e(new Circuit.Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))})}function _a(a){return new Promise(function(b,c){return a?void Vb.CallControlSvc.endCall(a,function(a){k(a,c)||b()}):void c(new Circuit.Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))})}function ab(a){return new Promise(function(b,c){return a?void Vb.CallControlSvc.endConference(a,function(a){k(a,c)||b()}):void c(new Circuit.Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))})}function bb(a){return new Promise(function(b,c){return a?void Vb.CallControlSvc.toggleVideo(a,function(a){k(a,c)||b()}):void c(new Circuit.Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))})}function cb(a,b){return new Promise(function(c,d){return a?(b=!!b,void Vb.CallControlSvc.changeHDVideo(a,b,function(a){k(a,d)||c()})):void d(new Circuit.Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))})}function db(a){return new Promise(function(b,c){if(!a)return void c(new Circuit.Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"));var d=Ma(a);return d?(d.remoteAudioDisabled?Vb.CallControlSvc.enableRemoteAudio(a):Vb.CallControlSvc.disableRemoteAudio(a),void b(a)):void c(new Circuit.Error(f.ReturnCode.SDK_ERROR,"No call found"))})}function eb(a){return new Promise(function(b,c){return a?void Vb.CallControlSvc.toggleRemoteVideo(a,function(a){k(a,c)||b()}):void c(new Circuit.Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))})}function fb(a){return new Promise(function(b,c){if(!a)return void c(new Circuit.Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"));var d=Ma(a);return d?void(d.hasLocalScreenShare()?Vb.CallControlSvc.removeScreenShare(a,function(a){k(a,c)||b()}):Vb.CallControlSvc.addScreenShare(a,null,function(a){k(a,c)||b()})):void c(new Circuit.Error(f.ReturnCode.SDK_ERROR,"No call found"))})}function gb(a,b){return new Promise(function(c,d){if(!a)return void d(new Circuit.Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"));var e=Ma(a);if(!e)return void d(new Circuit.Error(f.ReturnCode.SDK_ERROR,"No call found"));if(e.hasLocalScreenShare())Vb.CallControlSvc.removeMediaStream(a,function(a){k(a,d)||c()});else{if(!b)return void d(new Circuit.Error(f.ReturnCode.SDK_ERROR,"Missing MediaStream"));Vb.CallControlSvc.addMediaStream(a,b,function(a){k(a,d)||c()})}})}function hb(a,b){return new Promise(function(c,d){if(!a)return void d(new Circuit.Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"));var e=Vb.CallControlSvc.getActiveCall();return e?a!==e.callId?void d(new Circuit.Error(f.ReturnCode.SDK_ERROR,"Call ID is not for active call")):void Vb.CallControlSvc.startRecording(function(a){k(a,d)||c()},b):void d(new Circuit.Error(f.ReturnCode.SDK_ERROR,"No active call found"))})}function ib(a){return new Promise(function(b,c){if(!a)return void c(new Circuit.Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"));var d=Vb.CallControlSvc.getActiveCall();return d?a!==d.callId?void c(new Circuit.Error(f.ReturnCode.SDK_ERROR,"Call ID is not for active call")):void Vb.CallControlSvc.stopRecording(function(a){k(a,c)||b()}):void c(new Circuit.Error(f.ReturnCode.SDK_ERROR,"No active call found"))})}function jb(a){return new Promise(function(b,d){Sb.deleteRecording(a,function(a){c(a,d)||b()})})}function kb(a){return new Promise(function(b,c){return a?void Vb.CallControlSvc.mute(a,function(a){k(a,c)||b()}):void c(new Circuit.Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))})}function lb(a){return new Promise(function(b,c){return a?void Vb.CallControlSvc.unmute(a,function(a){k(a,c)||b()}):void c(new Circuit.Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))})}function mb(a,b){return new Promise(function(d,e){if(!a)return void e(new Circuit.Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"));if(!b)return void e(new Circuit.Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"viewbox is required"));var g={rtcSessionId:a,viewbox:b};Sb.enableWhiteboard(g,function(a){c(a,e)||d()})})}function nb(a){return new Promise(function(b,d){if(!a)return void d(new Circuit.Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"));var e={rtcSessionId:a};Sb.disableWhiteboard(e,function(a){c(a,d)||b()})})}function ob(a,b){return new Promise(function(d,e){if(!a)return void e(new Circuit.Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"));if(!b)return void e(new Circuit.Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"xmlElement is required"));var g={rtcSessionId:a,xmlElement:b};Sb.addWhiteboardElement(g,function(a){c(a,e)||d()})})}function pb(a,b){return new Promise(function(d,e){if(!a)return void e(new Circuit.Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"));if(!b)return void e(new Circuit.Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"xmlId is required"));var g={rtcSessionId:a,xmlId:b};Sb.removeWhiteboardElement(g,function(a){c(a,e)||d()})})}function qb(a,b,d){return new Promise(function(e,g){if(!a)return void g(new Circuit.Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"));if(!b)return void g(new Circuit.Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"xmlId is required"));if(!d)return void g(new Circuit.Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"xmlElement is required"));var h={rtcSessionId:a,xmlId:b,xmlElement:d};Sb.updateWhiteboardElement(h,function(a){c(a,g)||e()})})}function rb(a,b){return new Promise(function(d,e){if(!a)return void e(new Circuit.Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"));var g={rtcSessionId:a,userId:b||void 0};Sb.clearWhiteboard(g,function(a){c(a,e)||d()})})}function sb(a){return new Promise(function(b,d){if(!a)return void d(new Circuit.Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"));var e={rtcSessionId:a};Sb.getWhiteboard(e,function(a,e){c(a,d)||(e.callId=e.rtcSessionId,delete e.rtcSessionId,b(e))})})}function tb(a,b,c){return new Promise(function(d,e){if(!a||"string"!=typeof a)return void e(new Circuit.Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"type [string] is required"));if(!b||"string"!=typeof b)return void e(new Circuit.Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"userId [string] is required"));if(!c||"object"!=typeof c)return void e(new Circuit.Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"content [object] is required"));var g={content:{type:a,message:c},destUserId:b};Tb.sendSdkRequest(g,function(a){a?e(new Circuit.Error(f.ErrorCode.SDK_ERROR,a)):d()})})}function ub(a,b,c){return new Promise(function(d,e){if(!a||"string"!=typeof a)return void e(new Circuit.Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"type [string] is required"));if(!b||"string"!=typeof b)return void e(new Circuit.Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"destClientId [string] is required"));if(!c||"object"!=typeof c)return void e(new Circuit.Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"content [object] is required"));var g={content:{type:a,message:c},destUserId:Gb.loggedOnUser.userId,destClientId:b};Tb.sendSdkRequest(g,function(a){a?e(new Circuit.Error(f.ErrorCode.SDK_ERROR,a)):d()})})}function vb(a){var b=0;if(a)for(var c=0;c<a.length;c++)b+=a.charCodeAt(c);return $b[b%$b.length]}function wb(a,b){if("function"==typeof a)try{var c=a(b);if(c&&"object"==typeof c)return"function"==typeof c.then?c:Promise.resolve(c)}catch(a){g.error("[SDK]: Error applying injector. ",a)}return Promise.resolve(b)}function xb(a){if(!a)return Promise.resolve();var b={};return _b.forEach(function(c){b[c]=j.shallowCopy(a[c])}),b.state=a.state.name,b.isEstablished=a.state.established,wb(Circuit.Injectors.callInjector,b)}function yb(a){if(!a)return Promise.resolve();if(a.smallImageUri&&a.largeImageUri)a.avatar=l()+"fileapi/"+a.userId+"_s.jpg?fileid="+a.smallImageUri,a.avatarLarge=l()+"fileapi/"+a.userId+"_b.jpg?fileid="+a.largeImageUri,a.hasAvatar=!0;else{var b=vb(a.userId);a.avatar="https://"+Gb.domain+Wb+b+".png",a.avatarLarge="https://"+Gb.domain+Wb+b+"-XL.png"}return delete a.smallImageUri,delete a.largeImageUri,delete a.tenantId,delete a.roles,delete a.accountTemplateType,delete a.associatedGTCUserId,delete a.reroutingPhoneNumber,delete a.assignedPhoneNumbers,a.hasPermission=function(a){if(!this.accounts||!a)return!1;var b=this.accounts[0],c=b&&b.permissions;return!!c&&c.some(function(b){return b.systemPermission===a})},wb(Circuit.Injectors.userInjector,a)}function zb(a){if(!a)return Promise.resolve();switch(a.type){
case f.ConversationItemType.TEXT:a.text.state===f.TextItemState.DELETED?a.text.content="":(a.attachments=a.attachments||[],a.externalAttachments=a.externalAttachments||[],"standard"===Hb.emoticonMode&&(a.text.content=j.standardizeEmoticon(a.text.content)),h.retrievePrivateDataFromContent(a));break;case f.ConversationItemType.SYSTEM:a.system.affectedParticipants&&(a.system.affectedParticipants=a.system.affectedParticipants.map(function(a){return a.userId}))}return a.attachments&&a.attachments.forEach(function(a){a.url=l()+"fileapi/"+encodeURIComponent(a.fileName)+"?fileid="+a.fileId+"&itemid="+a.itemId}),wb(Circuit.Injectors.itemInjector,a)}function Ab(a){return new Promise(function(b){return a&&a.topLevelItem?(g.debug("[SDK]: Publicize the topLevelItem. convId = ",a.convId),void zb(a.topLevelItem).then(function(){g.debug("[SDK]: Publicized topLevelItem. convId = ",a.convId),b(a)}).catch(function(c){g.error("[SDK]: Failed to publicize topLevelItem. ",c),b(a)})):void b(a)})}function Bb(a){return new Promise(function(b){if(!a||!a.parentItem)return void b(a);g.debug("[SDK]: Publicize the thread. itemId = ",a.parentItem.intemId),a.comments=a.comments||[];var c=a.comments.slice(0);c.unshift(a.parentItem),Promise.all(c.map(zb)).then(function(){b(a)}).catch(function(c){g.error("[SDK]: Failed to publicize thread. ",c),b(a)})})}function Cb(a){if(!a)return Promise.resolve();if(g.debug("[SDK]: Publicize conversation. convId = ",a.convId),a.participants=a.participants.map(function(a){return a.userId}),a.moderators=a.moderators&&a.moderators.map(function(a){return a.userId}),a.type!==f.ConversationType.DIRECT){if(a.conversationAvatar&&a.conversationAvatar.smallPictureId&&a.conversationAvatar.largePictureId)a.avatar=l()+"avatar?convId="+a.convId+"&type=small&fileid="+a.conversationAvatar.smallPictureId,a.avatarLarge=l()+"avatar?convId="+a.convId+"&type=large&fileid="+a.conversationAvatar.largePictureId,a.hasConversationAvatar=!0;else if(a.type===f.ConversationType.OPEN){var b=a.isDraft?"-grey":vb(a.convId);a.avatar="https://"+Gb.domain+Xb+b+".png",a.avatarLarge="https://"+Gb.domain+Xb+b+"-XL.png"}else a.type===f.ConversationType.LARGE?(a.avatar="https://"+Gb.domain+Yb+".png",a.avatarLarge="https://"+Gb.domain+Yb+"-XL.png"):(a.avatar="https://"+Gb.domain+Zb+".png",a.avatarLarge="https://"+Gb.domain+Zb+"-XL.png");a.type===f.ConversationType.OPEN&&(a.type=e.COMMUNITY)}var c=wb(Circuit.Injectors.conversationInjector,a);return c.then(Ab)}function Db(a){if(!a)return Promise.resolve();if(a.smallImageUri&&a.largeImageUri)a.avatar=l()+"fileapi/"+a.userId+"_s.jpg?fileid="+a.smallImageUri,a.avatarLarge=l()+"fileapi/"+a.userId+"_b.jpg?fileid="+a.largeImageUri,a.hasAvatar=!0;else{var b=vb(a.userId);a.avatar="https://"+Gb.domain+Wb+b+".png",a.avatarLarge="https://"+Gb.domain+Wb+b+"-XL.png"}return delete a.smallImageUri,delete a.largeImageUri,wb(Circuit.Injectors.participantInjector,a)}function Eb(a){g.debug("[SDK]: Enqueue "+a.type),Pb.push(a)}function Fb(){if(!Qb&&Pb.length){Qb=!0;try{var a=Pb.shift();if(g.debug("[SDK]: Dequeue "+a.type+". Events left in the queue: "+Pb.length),!Gb.hasEventListener(a.type))return void g.debug("[SDK]: There is no listener for this event");var b=[];b.push(a.user?yb(a.user):void 0),b.push(a.item?zb(a.item):void 0),b.push(a.conversation?Cb(a.conversation):void 0),b.push(a.call?xb(a.call):void 0),Promise.all(b).then(function(b){b[0]&&(a.user=b[0]),b[1]&&(a.item=b[1]),b[2]&&(a.conversation=b[2]),b[3]&&(a.call=b[3]),g.debug("[SDK]: Dispatch ",a.type),Gb.dispatch(a)})}catch(a){g.error("[SDK]: Error processing event queue. ",a)}finally{Qb=!1}}}a.BaseEventTarget.call(this,a.logger);var Gb=this,Hb=j.shallowCopy(b)||{};Hb.domain=Hb.domain||"circuitsandbox.net",Hb.emoticonMode=Hb.emoticonMode||"standard",o(b);var Ib,Jb,Kb,Lb,Mb="node"===window.navigator.platform,Nb="dotnet"===window.navigator.platform,Ob="Win32"===window.navigator.platform,Pb=[],Qb=!1,Rb=null,Sb=new a.ClientApiHandler(Hb),Tb=new a.UserToUserHandler(Sb),Ub=a.RtcSessionController;Gb._clientApiHandler=Sb,Gb._userToUserHandler=Tb,Gb._rtcSessionController=Ub;var Vb=new a.SdkServices(Sb,Tb),Wb="/content/images/icon-general-default-avatar",Xb="/content/images/icon-general-openconvo-avatar",Yb="/content/images/icon-general-large-conference",Zb="/content/images/icon-general-emptyconvo-avatar",$b=["-blue","-green","-orange","-yellow"],_b=["activeMediaType","callId","convId","convType","direction","isMeetingPointInvited","isRemote","isTelephonyCall","isTestCall","locallyMuted","localMediaType","localVideoUrl","mediaType","participants","remoteAudioDisabled","remoteAudioUrl","remotelyMuted","remoteVideoDisabled","ringAllAllowed","ringAllMaxNumber","savedRTPStats","whiteboardEnabled"];return Object.defineProperty(Gb,"domain",{get:function(){return Hb.domain},set:function(a){Hb.domain=a},enumerable:!0,configurable:!1}),Object.defineProperty(Gb,"accessToken",{get:function(){return Ib},set:function(a){Ib=a},enumerable:!0,configurable:!0}),Object.defineProperty(Gb,"expiresAt",{get:function(){return Jb},enumerable:!0,configurable:!0}),Gb.setOauthConfig=o,Gb.logon=function(a){if(a){if("object"!=typeof a){var b="OAuth2 is the only supported authentication menthod. Basic Auth is not supported anymore.";return g.error(b),Promise.reject(new Circuit.Error(f.ErrorCode.SDK_ERROR,"Credentials mismatch. Details: "+b))}if(Hb.client_id&&Hb.client_secret){var b="Circuit.Client is created with client_id and client_secret (Client Credentials Grant), so no token should be passed to the logon API.";return g.error(b),Promise.reject(new Circuit.Error(f.ErrorCode.SDK_ERROR,"Credentials mismatch. Details: "+b))}if(Hb.client_id&&a.token){var b="Circuit.Client is created with client_id, so no API token should be passed to the logon API.";return g.error(b),Promise.reject(new Circuit.Error(f.ErrorCode.SDK_ERROR,"Credentials mismatch. Details: "+b))}if(!Hb.client_id&&!a.token){var b="Circuit.Client was not created with client_id, so API token should be passed to the logon API.";return g.error(b),Promise.reject(new Circuit.Error(f.ErrorCode.SDK_ERROR,"Credentials mismatch. Details: "+b))}}else if(!Hb.client_id){var b="Login with a session cookie has been disabled. OAuth2 or API token are the only supported authentication method.";return g.error(b),Promise.reject(new Circuit.Error(f.ErrorCode.SDK_ERROR,"Credentials mismatch. Details: "+b))}var c;return Hb.client_id&&Hb.client_secret?F().then(q).then(E):Hb.client_id&&a&&a.accessToken?Mb||Nb||Ob?q(a).then(E):(a.prompt&&(c="https://"+Hb.domain+"/dist/oauthLoading.html",Gb.oauthwin=m(c,450,500)),Ib=a.accessToken,y().then(function(){return a.prompt?r().then(function(){Gb.oauthwin.close(),Gb.oauthwin=null}).catch(x).then(E):E()}).catch(function(a){return Gb.oauthwin&&Gb.oauthwin.close(),Gb.oauthwin=null,Promise.reject(a)})):Hb.client_id?Gb.logonChecked?E():a&&a.logonChecked?u().then(y).then(r).then(E):(c="https://"+Hb.domain+"/dist/oauthLoading.html",Gb.oauthwin=m(c,450,500),u().then(y).then(r).then(function(){Gb.oauthwin.close(),Gb.oauthwin=null}).catch(w).then(E)):a&&a.token?q(a).then(E):Promise.reject(new Circuit.Error(f.ErrorCode.MISSING_REQUIRED_PARAMETER,"Missing credentials"))},Gb.logonCheck=function(){return u().then(y).then(r).then(function(){Gb.logonChecked=!0,Lb&&window.clearTimeout(Lb),Lb=window.setTimeout(function(){Lb=null,Gb.logonChecked=!1},5e3)})},Gb.logout=G,Gb.revokeToken=H,Gb.setCookie=function(a){Hb.cookie=a},Gb.getCookie=function(){return Hb.cookie},Gb.isAuthenticated=r,Gb.validateToken=y,Gb.getLoggedOnUser=J,Gb.getTelephonyConversationId=Y,Gb.getSupportConversationId=Z,Gb.getTenantUsers=K,Gb.subscribePresence=Ca,Gb.unsubscribePresence=Da,Gb.renewSessionToken=Ea,Gb.renewToken=A,Gb.getUserById=V,Gb.getUsersById=W,Gb.getUserByEmail=T,Gb.getUsersByEmail=U,Gb.updateUser=ta,Gb.changePassword=ua,Gb.getPresence=za,Gb.setPresence=ya,Gb.setStatusMessage=Aa,Gb.getStatusMessage=Ba,Gb.setUserSettings=wa,Gb.getUserSettings=xa,Gb.getDevices=X,Gb.getConversations=L,Gb.getMarkedConversations=M,Gb.getConversationById=N,Gb.getConversationParticipants=O,Gb.getItemById=P,Gb.getConversationItems=Q,Gb.getConversationFeed=R,Gb.getItemsByThread=S,Gb.addTextItem=aa,Gb.updateTextItem=ba,Gb.getDirectConversationWithUser=_,Gb.addParticipant=ha,Gb.removeParticipant=ia,Gb.getFlaggedItems=ja,Gb.flagItem=ka,Gb.unflagItem=la,Gb.likeItem=ma,Gb.unlikeItem=na,Gb.markItemsAsRead=oa,Gb.moderateConversation=pa,Gb.unmoderateConversation=qa,Gb.grantModeratorRights=ra,Gb.dropModeratorRights=sa,Gb.createDirectConversation=da,Gb.createGroupConversation=ea,Gb.createConferenceBridge=fa,Gb.createCommunity=ga,Gb.findCall=Ma,Gb.getCalls=Na,Gb.getActiveCall=Oa,Gb.getActiveRemoteCalls=Pa,Gb.getStartedCalls=Qa,Gb.startConference=Ra,Gb.getConversationDetails=Ta,Gb.changeConversationPin=Ua,Gb.joinConference=Va,Gb.pullRemoteCall=Wa,Gb.leaveConference=_a,Gb.endConference=ab,Gb.makeCall=Xa,Gb.getCallDevices=function(){return Vb.CallControlSvc.getCallDevices().map(function(a){return a.name})},Gb.getPushDevices=function(){return Vb.CallControlSvc.getPushDevices().map(function(a){return a.name})},Gb.getAnswerDevices=function(a){return Vb.CallControlSvc.getAnswerDevices(a).map(function(a){return a.name})},Gb.getAtcCalls=Vb.CallControlSvc.getAtcCalls,Gb.dialNumber=Ya,Gb.getTelephonyData=Vb.SdkHelperSvc.getTelephonyData,Gb.sendDigits=Za,Gb.sendClickToCallRequest=Ia,Gb.muteDevice=Ja,Gb.addParticipantToCall=Ka,Gb.addParticipantToRtcSession=La,Gb.answerCall=$a,Gb.endCall=_a,Gb.toggleVideo=bb,Gb.changeHDVideo=cb,Gb.toggleRemoteAudio=db,Gb.toggleRemoteVideo=eb,Gb.toggleScreenShare=fb,Gb.toggleMediaStream=gb,Gb.startRecording=hb,Gb.stopRecording=ib,Gb.deleteRecording=jb,Gb.mute=kb,Gb.unmute=lb,Gb.enableWhiteboard=mb,Gb.disableWhiteboard=nb,Gb.addWhiteboardElement=ob,Gb.removeWhiteboardElement=pb,Gb.updateWhiteboardElement=qb,Gb.clearWhiteboard=rb,Gb.getWhiteboard=sb,Gb.startUserSearch=Fa,Gb.sendAppMessageToUser=tb,Gb.sendAppMessageToClient=ub,Gb.addAppMessageListener=function(a,b){Tb.on("SDK."+a,b)},Gb.removeAppMessageListener=Tb.off,Object.defineProperty(a,"supportedEvents",{get:function(){return["connectionStateChanged","reconnectFailed","sessionTokenRenewed","renewSessionTokenFailed","accessTokenRenewed","renewAccessTokenFailed","systemMaintenance","userPresenceChanged","userUpdated","userSettingsChanged","userDeleted","basicSearchResults","conversationCreated","conversationUpdated","conversationDeleted","itemAdded","itemUpdated","callIncoming","callStatus","callEnded","whiteboardEnabled","whiteboardElement","whiteboardCleared"]},enumerable:!0,configurable:!0}),Vb.PubSubSvc.subscribe("/localUser/update",function(){Eb({type:"loggedOnUserUpdated",user:Gb.loggedOnUser})}),Sb.on("Conversation.ADD_ITEM",function(a){Eb({type:"itemAdded",item:a.item})}),Sb.on("Conversation.UPDATE_ITEM",function(a){Eb({type:"itemUpdated",item:a.item})}),Sb.on("Conversation.CREATE",function(a){Eb({type:"conversationCreated",conversation:a.conversation})}),Sb.on("Conversation.UPDATE",function(a){Eb({type:"conversationUpdated",conversation:a.conversation})}),Sb.on("User.USER_PRESENCE_CHANGE",function(a){Eb({type:"userPresenceChanged",presenceState:a.newState})}),Sb.on("User.USER_UPDATED",function(a){Eb({type:"userUpdated",user:a.user})}),Sb.addEventListener("connectionStateChange",function(a){Eb({type:"connectionStateChanged",state:a.newState})}),Sb.addEventListener("reconnectFailed",function(){Eb({type:"reconnectFailed"}),Hb.client_secret&&F().then(q).then(E)}),Sb.on("User.SESSION_EXPIRES",function(){Gb.loggedOnUser&&Ea()}),Sb.on("User.USER_SETTING_UPDATED",function(a){var b=va(a.settings);Object.keys(b).length>0&&Eb({type:"userSettingsChanged",userSettings:b})}),Sb.on("Search.BASIC_SEARCH_RESULT",function(a){Eb({type:"basicSearchResults",data:a})}),Sb.on("System.MAINTENANCE",function(a){Eb({type:"systemMaintenance",data:a})}),Sb.on("User.USER_DELETED",function(a){Eb({type:"userDeleted",data:a})}),Sb.on("Conversation.DELETE",function(a){Eb({type:"conversationDeleted",convId:a.convId})}),Sb.on("RTCSession.WHITEBOARD_ENABLED",function(a){Eb({type:"whiteboardEnabled",data:{enabled:!0,whiteboard:a.whiteboard}})}),Sb.on("RTCSession.WHITEBOARD_DISABLED",function(){Eb({type:"whiteboardEnabled",data:{enabled:!1}})}),Sb.on("RTCSession.WHITEBOARD_CLEARED",function(a){Eb({type:"whiteboardCleared",userId:a.userId})}),Sb.on("RTCSession.WHITEBOARD_ELEMENT_ADDED",function(a){Eb({type:"whiteboardElement",action:"added",element:a.element})}),Sb.on("RTCSession.WHITEBOARD_ELEMENT_REMOVED",function(a){Eb({type:"whiteboardElement",action:"removed",elementId:a.elementId})}),Sb.on("RTCSession.WHITEBOARD_ELEMENT_UPDATED",function(a){Eb({type:"whiteboardElement",action:"updated",element:a.element})}),Vb.PubSubSvc.subscribe("/call/incoming",function(a){Eb({type:"callIncoming",call:a})}),Mb&&Vb.PubSubSvc.subscribe("/call/warmupFailed",function(a,b){Eb({type:"callIncoming",call:b})}),Vb.PubSubSvc.subscribe("/call/state",function(a){Eb({type:"callStatus",call:a,reason:"callStateChanged"})}),Vb.PubSubSvc.subscribe("/call/remoteStreamUpdated",function(a){Eb({type:"callStatus",call:a,reason:"remoteStreamUpdated"})}),Vb.PubSubSvc.subscribe("/call/localStreamEnded",function(a){Eb({type:"callStatus",call:a,reason:"localStreamEnded"})}),Vb.PubSubSvc.subscribe("/call/muted",function(a){Eb({type:"callStatus",call:a,reason:"callMuted"})}),Vb.PubSubSvc.subscribe("/call/localUser/muted",function(a){var b=Ma(a);Eb({type:"callStatus",call:b,reason:"localUserMuted"})}),Vb.PubSubSvc.subscribe("/call/localUser/unmuted",function(a){var b=Ma(a);Eb({type:"callStatus",call:b,reason:"localUserUnmuted"})}),Vb.PubSubSvc.subscribe("/call/localUser/mutedSelf",function(a,b){var c=Ma(a);Eb(b?{type:"callStatus",call:c,reason:"localUserSelfMuted"}:{type:"callStatus",call:c,reason:"localUserSelfUnmuted"})}),Vb.PubSubSvc.subscribe("/call/locked",function(a){Eb({type:"callStatus",call:a,reason:"callLocked"})}),Vb.PubSubSvc.subscribe("/call/moved",function(a,b){var c=Ma(b);Eb({type:"callStatus",call:c,reason:"callMoved"})}),Vb.PubSubSvc.subscribe("/call/participant/updated",function(a,b){var c=Ma(a);Eb({type:"callStatus",call:c,participant:b,reason:"participantUpdated"})}),Vb.PubSubSvc.subscribe("/call/participants/updated",function(a,b){var c=Ma(a);Eb({type:"callStatus",call:c,participants:b,reason:"participantsUpdated"})}),Vb.PubSubSvc.subscribe("/call/participant/added",function(a,b){var c=Ma(a);Eb({type:"callStatus",call:c,participant:b,reason:"participantAdded"})}),Vb.PubSubSvc.subscribe("/call/participants/added",function(a,b){var c=Ma(a);Eb({type:"callStatus",call:c,participants:b,reason:"participantsAdded"})}),Vb.PubSubSvc.subscribe("/call/participant/joined",function(a,b){Eb({type:"callStatus",call:a,participant:b,reason:"participantJoined"})}),Vb.PubSubSvc.subscribe("/call/participant/removed",function(a){var b=Ma(a);Eb({type:"callStatus",call:b,reason:"participantRemoved"})}),Vb.PubSubSvc.subscribe("/call/recording",function(a,b){var c=Ma(a.rtcSessionId);Eb({type:"callStatus",call:c,reason:"callRecording",recordingState:b})}),Vb.PubSubSvc.subscribe("/call/droppedRemotely",function(a){Eb({type:"callStatus",call:a,reason:"droppedRemotely"})}),Vb.PubSubSvc.subscribe("/call/sdpConnected",function(a){Eb({type:"callStatus",call:a,reason:"sdpConnected"})}),Vb.PubSubSvc.subscribe("/call/network/quality",function(a){Eb({type:"callNetworkQualityChanged",data:a})}),Vb.PubSubSvc.subscribe("/call/rtp/threshholdExceeded/detected",function(a){var b=Ma(a);Eb({type:"callRtpThresholdReached",call:b})}),Vb.PubSubSvc.subscribe("/call/rtp/threshholdExceeded/cleared",function(a){var b=Ma(a);Eb({type:"callRtpThresholdCleared",call:b})}),Vb.PubSubSvc.subscribe("/call/ended",function(a){Ma(a.callId)||Eb({type:"callEnded",call:a})}),Gb},a.Client.prototype.name="Client",a.isCompatible=function(){var a=parseInt(k.version,10);return k.chrome&&a>=44||k.firefox&&a>=42||k.edge},a.supportedFeatures=function(){return a.isCompatible()?{text:!0,rtc:k.chrome||k.firefox}:{text:!1,rtc:!1}},a}(Circuit);