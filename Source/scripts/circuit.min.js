/**
 *  Copyright 2017 Unify Software and Solutions GmbH & Co.KG.
 *
 *  Licensed under the Apache License, Version 2.0 (the "License");
 *  you may not use this file except in compliance with the License.
 *  You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 *  Unless required by applicable law or agreed to in writing, software
 *  distributed under the License is distributed on an "AS IS" BASIS,
 *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 *  See the License for the specific language governing permissions and
 *  limitations under the License.
 *
 *  @version: 1.2.2200
 */

var Circuit = {}; Object.defineProperty(Circuit, 'version', { value: '1.2.2200'});

var window=window||{},navigator=navigator||{},document=document,Circuit=function(a){"use strict";a.isSDK=!0;var b={name:"unknown"};return"undefined"!=typeof process?process.versions&&process.versions.node?b={name:"node",version:process.versions.node,hostname:require("os").hostname()}:process.argv&&process.argv[0]&&(b={name:process.argv[0]}):b={name:"browser"},window.setTimeout=window.setTimeout||setTimeout,window.clearTimeout=window.clearTimeout||clearTimeout,window.setInterval=window.setInterval||setInterval,window.clearInterval=window.clearInterval||clearInterval,window.location||(window.location={host:b.hostname}),navigator.platform||(navigator.platform=b.name),navigator.userAgent||(navigator.userAgent="Mozilla/5.0 (Macintosh; Intel Mac OS X 10_10_1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/40.0.2125.122 Safari/537.36"),window.navigator||(window.navigator=navigator),window.btoa||(window.btoa=function(a){return new Buffer(a).toString("base64")}),a._runtime=b,a.DefaultAvatars={},a}(Circuit||{}),Circuit=function(a){"use strict";var b=Object.freeze({Debug:1,Info:2,Warning:3,Error:4,Off:5}),c=b.Warning,d={setLevel:function(a){c=a},getLevel:function(){return c},debug:function(){c<=b.Debug&&console.log.apply(console,Array.prototype.slice.apply(arguments))},info:function(){c<=b.Info&&console.info.apply(console,Array.prototype.slice.apply(arguments))},warning:function(){c<=b.Warning&&console.warn.apply(console,Array.prototype.slice.apply(arguments))},warn:function(){c<=b.Warning&&console.warn.apply(console,Array.prototype.slice.apply(arguments))},error:function(a,d){c<=b.Error&&(a=a&&a.stack||a,d=d&&d.stack||d,d?console.error(a,d):console.error(a))},msgSend:function(){c<=b.Debug&&console.log.apply(console,Array.prototype.slice.apply(arguments))},msgRcvd:function(){c<=b.Debug&&console.log.apply(console,Array.prototype.slice.apply(arguments))},logMsg:function(a,b,c){switch(a.name){case"DEBUG":this.debug(b,c);break;case"INFO":this.info(b,c);break;case"WARN":case"WARNING":this.info(b,c);break;case"ERROR":this.info(b,c);break;default:this.debug(b,c)}},setExtensionVersion:function(a){console.log("ExtensionVersion = "+a)}};return a.logger=d,a.Enums=a.Enums||{},a.Enums.LogLevel=b,a}(Circuit||{}),Circuit=function(a){"use strict";return a.Error=function(a,b){this.code=a||"UNEXPECTED_ERROR","string"==typeof b?this.message=b:"object"==typeof b&&(this.errObj=b,b.info&&!b.message&&(b.message=b.info)),this.stack=Error().stack},a.Error.prototype=Object.create(Error.prototype),a.Error.prototype.name="Error",a}(Circuit||{}),Circuit=function(a){"use strict";function b(a,b){try{return c?c[a].apply(c,b):null}catch(a){return null}}var c=null;try{c=window.localStorage||c}catch(a){c=window.sessionStorage||c}var d={getItem:function(a){return b("getItem",[a])},setItem:function(a,c){return b("setItem",[a,c])},removeItem:function(a){return b("removeItem",[a])}};return a.storeManager=d,a}(Circuit||{}),Circuit=function(a){"use strict";var b={};return b.SIGNATURE="ansibleChromeExtensionSignature",b.DOMEvent=Object.freeze({TO_EXTENSION:"toExtension",FROM_EXTENSION:"fromExtension"}),b.BgMsgType=Object.freeze({REQUEST:"request",RESPONSE:"response",EVENT:"event"}),b.BgTarget=Object.freeze({INTERNAL:"internal",LOG:"log",SCREEN_SHARE:"screenShare",EXCHANGE_CONNECTOR:"exchange_connector",HEADSET_APP:"headsetAppManager"}),b.ResponseError=Object.freeze({UNREGISTERED:"unregistered",TIMEOUT:"timeout",UNSUPPORTED_REQUEST:"unsupportedRequest",INTERNAL_ERROR:"internalError"}),b.BgLogMsgType=Object.freeze({LOG:"log"}),b.BgInternalMsgType=Object.freeze({INIT_MSG:"initMsg",INIT_MSG_ACK:"initMsgAck",INJECT_SIGNATURE:"injectChromeAppSignature",IS_ALIVE:"isAlive",GET_WINDOW_SIZE:"getWindowSize",EXTENSION_DISCONNECTED:"extensionDisconnected",BRING_TO_FRONT:"bringToFront"}),b.BgScreenShareMsgType=Object.freeze({CHOOSE_DESKTOP_MEDIA:"cdm",CHOOSE_DESKTOP_MEDIA_DONE:"cdmDone",CHOOSE_DESKTOP_MEDIA_CANCELLED:"cdmCancelled"}),b.BgExchangeMsgType=Object.freeze({CONNECT:"connect",DISCONNECT:"disconnect",SEARCH_CONTACTS:"searchContacts",GET_CONNECTION_STATUS:"getConnectionStatus",GET_CAPABILITIES:"getCapabilities",GET_CONTACT:"getContact",STORE_EXCH_CREDENTIALS:"storeCredentials",CONNECTION_STATUS:"connectionStatus",GET_ALL_PERSONAL_CONTACTS:"getAllPersonalContacts",CONTACT_FOLDERS_SYNC_STATE:"contactFoldersSyncState",SYNC_ALL_PERSONAL_CONTACTS:"syncAllPersonalContacts",GET_APPOINTMENTS:"getAppointments",GET_STORED_CREDENTIALS:"getStoredCredentials",GET_RENEWED_TOKEN:"getRenewedToken",ON_RENEWED_TOKEN:"onRenewedToken"}),b.BgHeadsetAppMsgType=Object.freeze({GET_HEADSET_APP_STATUS:"getHeadsetAppStatus",LAUNCH_HEADSET_APP:"launchHeadsetApp",HEADSET_APP_LAUNCHED:"headsetAppLaunched",HEADSET_APP_UNINSTALLED:"headsetAppUninstalled"}),b.ExchangeConnResponse=Object.freeze({OK:"ok",NO_RESULT:"noResult",FAILED:"failed",COULD_NOT_CONNECT:"couldNotConnect",UNAUTHORIZED:"unauthorized",UNSUPPORTED_METHOD:"unsupportedMethod",TIMED_OUT:"timedOut"}),b.HeadsetAppStatus=Object.freeze({NO_MANAGEMENT_PERMISSION:"noManagementPermission",NOT_INSTALLED:"notInstalled",INSTALLED:"installed",DISABLED:"disabled",UNKNOWN:"unknown"}),b.Exchange=Object.freeze({CONFIGURED_PASSWORD_MASKED:"$$$$"}),b.PortMsg=Object.freeze({CONNECT:"connect",DISCONNECT:"disconnect",MSG:"msg"}),a.ChromeExtension=b,"undefined"!=typeof module&&module.exports&&(module.exports=b),a}(Circuit||{}),Circuit=function(a){"use strict";function b(a){var b=a.replace(/[&#;]/g,"");if(!/^[0-9]+$/.test(b)||b>=55296&&b<=57343||b>1114111)return a;var c="";return b>65535&&(b-=65536,c+=String.fromCharCode(b>>>10&1023|55296),b=56320|1023&b),c+=String.fromCharCode(b)}function c(a){if(!a)return"";var b=document.createElement("div"),c=document.createElement("div");a=a.replace(/\$/gm,"$$$$");var d=0;return a=a.replace(/(<span.*?>)|(<\/span>)/gi,function(a,b,c){return b?b.match(/class="mention"/i)?a.replace(/.*abbr="(.*?)".*?>/gi,'<span class="mention" abbr="$1"><a href="#/profile/$1">'):(d++,b):c?d?(d--,c):"</a></span>":void 0}),a=j.convertEmojis(a),b.innerHTML=a,f(b,c).innerHTML.replace(/&nbsp;/gi," ")}function d(){return a.isElectron?"https://"+g.getCurrentWindow()._domain:window.location&&window.location.origin}function e(a){a=a.replace(/\xA0|&#160;|\x0A|\x0D/gim," ");for(var b=String.fromCharCode(17),c=String.fromCharCode(18),e=String.fromCharCode(19),f=function(a){var f="",g="",h=d(),i=m.isCircuitLink(h,a);return i||(i=a,/^(?:http|https|ftp):\/\//.exec(a)||(i="http://"+i),f=" target="+e+"_blank"+e,g=" rel="+e+"noopener noreferrer"+e),b+"a href="+e+i+e+f+g+c+a+b+"/a"+c},g=a.split(m.URL_SEPARATORS_PATTERN),h=0;h<g.length;h++){var i=g[h],j=m.stripParenthesis(i),k=j;k.search(/http|ftp|https/gim)>=0&&k.search(m.URL_PATTERN)>=0?k=k.replace(m.URL_PATTERN,f):k.search(/www\./gim)>=0&&k.search(m.PSEUDO_URL_PATTERN)>=0?k=k.replace(m.PSEUDO_URL_PATTERN,f):k.search(/\S@\S/gim)>=0&&k.search(m.EMAIL_ADDRESS_INCLUDED_PATTERN)>=0&&(k=k.replace(m.EMAIL_ADDRESS_INCLUDED_PATTERN,b+"a href="+e+"mailto:$&"+e+" target="+e+"_blank"+e+" rel="+e+"noopener noreferrer"+e+c+"$&"+b+"/a"+c)),i=i.replace(j,k),g[h]=i}return a=g.join(""),m.textToHtmlEscaped(a).replace(/\x11/gi,"<").replace(/\x12/gi,">").replace(/\x13/gi,"'")}function f(b,c){if(!b||!b.childNodes||!b.childNodes.length)return b;for(var d,h=0,i=b.childNodes.length;h<i;h++)switch(d=b.childNodes[h],d.nodeType){case 1:if("A"===d.nodeName){var j=a.isElectron?g.getCurrentWindow()._domain:window.location&&window.location.origin;m.isCircuitLink(j,d.href)||(d.target="_blank",d.rel="noopener noreferrer")}f(d,c);break;case 3:for(c.innerHTML=e(d.textContent),h+=c.childNodes.length-1;c.childNodes.length;)b.insertBefore(c.childNodes[0],d);b.removeChild(d),i=b.childNodes.length}return b}a.__server="",a.__domain="",a.isElectron=!(a.isSDK||"undefined"==typeof process||!process.versions||!process.versions.electron);var g,h=a.logger,i=a.Emoticons,j=a.Emoji;a.isElectron&&(g=require("electron").remote,a.__server=g.getCurrentWindow()._domain),"undefined"!=typeof Skype&&(a.SkypeSDK=Skype,Skype=null);var k=/<(img[^>|<]*(?:shortcut|abbr)="(\S*)"[^\/?>]*\/?)>/gi,l="https://embed-proxy.circuitsandbox.net/?target=",m=a.Utils||{},n=["items","parents","peerUsers","previousMembers"];m.trimCallForMobile=function(a){var b;return a&&(b=m.flattenObj(a)),b},m.trimConvForMobile=function(a){var b;return a&&(b=m.flattenObj(a),n.forEach(function(a){delete b[a]}),b.call=m.trimCallForMobile(a.call)),b},m.isPromise=function(a){return!(!a||"function"!=typeof a.then)},m.convertVersionToNumber=function(a){if("string"!=typeof a)return 0;var b=a.split("."),c=parseInt(b[0],10)||0,d=parseInt(b[1],10)||0;d=Math.min(d,99);var e=parseInt(b[2],10)||0;return e=Math.min(e,9999),e+1e4*d+1e6*c},m.trimTextWithEmoticonsBeforeMatch=function(a,b,c){for(var d="...",e=a.indexOf(b),f=a.slice(e),g=a.slice(0,e),h=String.fromCharCode(17),i=String.fromCharCode(18),j=g.replace(k,function(a,b){return h+b+i}),l=!0,m=j.length-1,n=j.length-1,o=n;g.length-1-m<=c&&n>=0;)18===j.charCodeAt(n)?(j=j.replaceAt(n,">"),l=!1):17===j.charCodeAt(n)&&(j=j.replaceAt(n,"<"),l=!0),o=n,n--,l&&m--;return g=o>0?d+j.slice(o):j,g+f},m.enhanceEncodeURI=function(a){var b={"!":"%21","(":"%28",")":"%29","#":"%23","{":"%7B","}":"%7D"};return encodeURIComponent(a).replace(/[!\(\)#\{\}]/gi,function(a){return b[a]})},m.normalizeDn=function(a){return a?a.replace("+",""):""},m.cleanPhoneNumber=function(a){return a?a.replace(/[^\*\#\d\+]/g,""):""},m.isMSDoc=function(a){return a.search(/<\S*?WordDocument>/i)>=0||a.search(/<[^>]*?style=[^>]*?mso-[^<]+?>/i)>=0||a.search(/<meta[^>]*?Microsoft/i)>=0},m.isXCodeDoc=function(a){return a.search(/<[^>]*?content=[^>]*?Cocoa[^<]+?>/)>=0},m.sanitizer=null,m.sanitize=function(a){if(!a||!m.sanitizer)return a;try{a=a.replace(/style="background-color: rgb\(212, 239, 181\);"/gi,'class="rich-text-highlight"'),a=a.replace(/<[^>]+background-color: rgb\(212, 239, 181\);.*?>/gi,function(a){return a.indexOf("class=")>0?a.replace(/class=".*?"/gi,function(a){return a.indexOf("rich-text-highlight")>0?a:a.replace(/[^=]\s*(.*)/gi,function(a){return a.slice(0,-1)+" rich-text-highlight"})}):a.replace(">",function(a){return' class="rich-text-highlight" '+a})}),a=a.replace(/<img(?![^>]*class="(emoticon-icon|emojione-icon))[^>]*>/gi,""),a=a.replace(/<title[^>]*>([\s\S]*?)<\/title>/gi,""),a=i.normalizeEmoticonHtml(a),a=a.replace(/<font[^>]*>|<\/font>/gi,""),a=a.replace(/(<\s*hr\s*><\s*\/hr\s*>|<\s*hr\s*>)/gi,"<hr/>"),a=a.replace(/(\r|\n)+(?=[^<]*?>)/gi," "),a=a.replace(/\r\n|\r|\n/g,"<br>"),"function"==typeof m.sanitizer&&(a=m.sanitizer(a));var b=a.split(/<\/?div.*?>|<\/?p.*?>/g).filter(function(a){return!!a}),c=b.length,d="";if(c>1)for(var e,f,g=new RegExp("<br>(?![\\s\\S]*<br>)(?=(<[^/][^>]*></[^>]*>)*$|(</[^>]*>)*$|$)","i"),j=0;j<c;j++)e=b[j].replace(/((<span( class="[\S]*")*>)|(<b( class="[\S]*")*>)|(<i( class="[\S]*")*>))*(<br>|<br\/>)(<\/span>|<\/b>|<\/i>)*/g,"<br>"),!f||f.endsWith("</ul>")||f.endsWith("</ol>")||g.test(f)||(d+="<br>"),d+=e,f=e;else d=b[0];a=d}catch(b){return h.error("[Utils]: Error sanitizing content. ",b),h.error("[Utils]: Unexpected content: ",a),""}return a},m.sanitizeSymbols=function(a){return m.isMobile()&&"undefined"!=typeof he?a&&he.encode(a,{allowUnsafeSymbols:!0,decimal:!0}):a},m.convertSymbolCodes=function(a){return m.isMobile()?a&&a.replace(j.HTML_ENTITY_REGEX,function(a){return b(a)}):a},m.toPlainText=function(a,b){if(a&&(!b||"RICH"===b)){a=a.replace(i.HTML_REGEX,function(a,b){return i.isEmoticonContent(a)?b:a});var c=document.createElement("div");return c.innerHTML=a.replace(/<(br[\/]?|\/li|hr[\/]?)>/gi,"&nbsp;"),c.textContent}return a},m.toPlainTextWithEmoticonHtml=function(a,b){if(a&&(!b||"RICH"===b)){var c=String.fromCharCode(17),d=String.fromCharCode(18);a=a.replace(i.HTML_REGEX,function(a,b){return i.isEmoticonContent(a)?c+b+d:a}),a=j.convertEmojis(a);var e=String.fromCharCode(19),f=String.fromCharCode(20);a=a.replace(j.HTML_REGEX,function(a,b){return j.isEmojiContent(a)?e+b+f:a});var g=document.createElement("div");g.innerHTML=a.replace(/<(br[\/]?|\/li|hr[\/]?)>/gi,"&nbsp;");var h=m.textToHtmlEscaped(g.textContent,!0);return h=h.replace(/\x11([^\x11\x12]*)\x12/gim,function(a,b){return i.getHtmlFromShortcut(b,!1,!0,!0)}),h.replace(/\x13([^\x13\x14]*)\x14/gim,function(a,b){return j.convertEmojis(b.replace(/&amp;/g,"&"))})}return a},m.truncateFileName=function(a){return!a||a.length<=22?a:a.substring(0,10)+" ..."+a.substring(a.length-8,a.length)},m.convertItemText=function(a,b,c){return a?c?m.toPlainTextWithEmoticonHtml(a,b):m.toPlainText(a,b):""},m.createMentionedUsersArray=function(a){for(var b=[],c=/<span.*?class=["']mention["'].*?>/g,d=/abbr=["'](.*?)["']/,e=c.exec(a);null!==e;){var f=d.exec(e[0]);f=f&&f[1],b.indexOf(f)===-1&&b.push(f),e=c.exec(a)}return b},m.DEFAULT_HELP_URL="https://www.circuit.com/support",m.SEPARATORS_PATTERN="!-/:-@[-^{-~\\s",m.NUMERIC_PATTERN="^[0-9]*$",m.ALPHANUMERIC_PATTERN="^[a-zA-Z0-9_]*$",m.URL_SEPARATORS_PATTERN=/(?=[.,;!?]?\s+|[.,;!?]$)/,m.URL_PATTERN=/(http|ftp|https):\/\/[\w-]+?((\.|:)[\w-]+?)+?([\w.,@?'^=$%&amp;:\/~+#!\(\)\{\}\[\]-]*[\w@?'^=$%&amp;\/~+#!\(\)\{\}-])?/gim,m.EXACT_URL_PATTERN=new RegExp("^"+m.URL_PATTERN.source+"$","i"),m.PSEUDO_URL_PATTERN=/www\.+[\w-]+?(\.[\w-]+?)+?([\w.,@?\'^=$%&amp;:\/~+#!\(\)\{\}\[\]-]*[\w@?\'^=$%&amp;\/~+#!\(\)\{\}-])?/gim,m.TABBABLE_ELEMENTS_PATTERN="a[href], area[href], input:not([disabled]):not([tabindex='-1']), button:not([disabled]):not([tabindex='-1']),select:not([disabled]):not([tabindex='-1']), textarea:not([disabled]):not([tabindex='-1']), iframe, object, embed, *[tabindex]:not([tabindex='-1']), *[contenteditable=true]",m.RICH_TEXT_LINK_CLASS="text-linkDarkGreen",m.EMAIL_ADDRESS_INCLUDED_PATTERN=/[\w\*\+\-\$\?\^\{!#%&'\/=`|}~]+?(?:\.[\w\*\+\-\$\?\^\{!#%&'\/=`|}~]+?)*?@[a-z\d-]+?(?:\.[a-z\d-]{2,})+/gim,m.EMAIL_ADDRESS_PATTERN=new RegExp("^"+m.EMAIL_ADDRESS_INCLUDED_PATTERN.source+"$","i"),a.isElectron&&g&&(m.SSO_EMAIL_DOMAINS_MAPPING=g.getGlobal("constants").SSO_EMAIL_DOMAINS_MAPPING||[],m.SSO_PATTERN="[_a-z0-9-]+?@(("+m.SSO_EMAIL_DOMAINS_MAPPING.join(")|(")+"))",m.SSO_EMAIL_ADDRESS_PATTERN=new RegExp(m.SSO_PATTERN,"i")),m.CIRCUIT_CONVERSATION_HASH_PATTERN=/\#\/(conversation|open|muted)\/[0-9\-a-z]+?(\?((user=(\d)+?)|(item=([0-9\-a-z])+?(\&user=(\d)+?)?)))?$/gim,m.CIRCUIT_LINKS_HASH_PATTERN=/\#\/(profile|phone|user)\/[0-9\-a-z]+?$/gim,m.CIRCUIT_EMAIL_HASH_PATTERN=new RegExp("#/email/"+m.EMAIL_ADDRESS_INCLUDED_PATTERN.source+"$","gim"),m.PHONE_PATTERN=/^(\+\s*)?\d+(\s*\(\s*\d+\s*\)\s*\d+)?((\s*-?\s*\d+)*|(\s*\.\s*\d+)*)$/,m.GNF_PHONE_PATTERN=/^((\+)|(\+\s*\d+(\s*\(\s*\d+\s*\)\s*\d+)?((\s*-?\s*\d+)*|(\s*\.\s*\d+)*)))$/,m.PHONE_PAC=/^([#\*]+[#\*\(\)\-\s\+\d]*)$/,m.PHONE_DIAL_PATTERN=/^([#\*\(\)\\\/\-\.\s\+\d]*)$/,m.PHONE_WITH_EXTENSION_PATTERN=/^([#\*\(\)\\\/\-\.\s\+\d]*)(\s*(x|X|ext\.)\s*\d+)$/,m.matchPhonePattern=function(a){return a&&"string"==typeof a?a.match(m.PHONE_PATTERN):null},m.matchUrlPattern=function(a){return a&&"string"==typeof a?a.match(m.URL_PATTERN)||a.match(m.PSEUDO_URL_PATTERN):null},m.matchEmailPattern=function(a){return a&&"string"==typeof a?a.match(m.EMAIL_ADDRESS_INCLUDED_PATTERN):null},m.matchNames=function(a,b,c){if(!a||"string"!=typeof a||!b)return!1;var d=new RegExp("^"+RegExp.escape(b),c||"i");return d.test(a)||a.split(" ").some(function(a){return d.test(a)})},m.compareStrings=function(a,b){if("string"!=typeof a||"string"!=typeof b)return!1;var c=new RegExp("^"+RegExp.escape(a)+"$","i");return c.test(b)},m.rstring=function(){return Math.floor(1e9*Math.random()).toString()},m.randomNumber=function(a,b){return Math.floor(Math.random()*(b-a+1))+a},m.randomBoolean=function(){return.5>Math.random()},m.generateCallId=function(){return"WRTC-"+m.rstring()+"-"+m.rstring()},m.createTransactionId=function(){for(var a=[],b="0123456789abcdef",c=0;c<36;c++)a[c]=b.substr(Math.floor(16*Math.random()),1);a[14]="4",a[19]=b.substr(a[19]&&3||8,1),a[8]=a[13]=a[18]=a[23]="-";var d=a.join("");return d},m.getLegalRegion=function(a){switch(a){case"europe":var b=(navigator.language||navigator.browserLanguage).split("-"),c=b.last();return"de"===c.toLowerCase()?"de":"uk";case"americas":case"apac":return"us";default:return"us"}},m.getBrowserInfo=function(){if("iOS"===window.navigator.platform)return{ios:!0,type:"ios"};if("Android"===window.navigator.platform)return{android:!0,type:"android"};if("node"===window.navigator.platform)return{node:!0,type:"node"};if(Circuit.isElectron)return{chrome:!0,type:"chrome"};if("dotnet"===window.navigator.platform)return{dotnet:!0,type:"dotnet"};var a={},b=navigator.userAgent.toLowerCase(),c=/(msie|trident)(?: |.*rv:)([\d.]+)/.exec(b)||/(opera|opr)(?:.*version|)\/([\d.]+)/.exec(b)||/(firefox)\/([\d.]+)/.exec(b)||/(edge)\/([\d.]+)/.exec(b)||/(chrome)\/([\d.]+)/.exec(b)||/version\/([\d.]+).*(safari)/.exec(b)||/(phantomjs)\/([\d.]+)/.exec(b)||[],d=c[1]||"",e=c[2]||0;return"safari"===e?(d=c[2],e=c[1]):"trident"===d?d="msie":"opr"===d?d="opera":"phantomjs"===d&&(d="phantomjs"),a[d]=!0,a.type=d,a.version=e,a};var o=[{s:"Windows 10",r:/(Windows.* 10|Windows 10.0|Windows[ _]NT.* 10.0)/},{s:"Windows 8.1",r:/(Windows.* 8.1|Windows[ _]NT.* 6.3)/},{s:"Windows 8",r:/(Windows.* 8|Windows[ _]NT.* 6.2)/},{s:"Windows 7",r:/(Windows.* 7|Windows[ _]NT.* 6.1)/},{s:"Windows Vista",r:/(Windows.* Vista|Windows[ _]NT.* 6.0)/},{s:"Windows Server 2003",r:/(Windows Server 2003|Windows[ _]NT.* 5.2)/},{s:"Windows XP",r:/(Windows[ _]NT.* 5.1|Windows XP)/},{s:"Windows 2000",r:/(Windows[ _]NT.* 5.0|Windows 2000)/},{s:"Windows ME",r:/(Win 9x 4.90|Windows ME)/},{s:"Windows 98",r:/(Windows 98|Win98)/},{s:"Windows 95",r:/(Windows 95|Win95|Windows_95)/},{s:"Windows NT 4.0",r:/(Windows NT 4.0|WinNT4.0|WinNT|Windows NT)/},{s:"Windows CE",r:/Windows CE/},{s:"Windows 3.11",r:/Windows 3.11|Win16/},{s:"Android",r:/Android/},{s:"Open BSD",r:/Open BSD|OpenBSD/},{s:"Sun OS",r:/Sun OS|SunOS/},{s:"Linux",r:/(Linux|X11)/},{s:"iOS",r:/(iOS|iPhone|iPad|iPod)/},{s:"Mac OS X",r:/Mac OS X/},{s:"Mac OS",r:/(Mac OS|MacPPC|MacIntel|Mac_PowerPC|Macintosh|Darwin)/},{s:"QNX",r:/QNX/},{s:"UNIX",r:/UNIX/},{s:"BeOS",r:/BeOS/},{s:"OS/2",r:/OS\/2/},{s:"Search Bot",r:/(Search Bot|nuhk|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask Jeeves\/Teoma|ia_archiver)/}];m.getOSInfo=function(a){if(!a)return{type:"",version:"",info:""};var b=a,c="",d="",e=o.some(function(c){if(c.r.test(a))return b=c.s,!0});if(e&&/Windows/.test(b))d=/Windows (.*)/.exec(b)[1],c="Windows";else{c=b;try{switch(b){case"Mac OS X":d=/Mac OS X (10[\.\_\d]+)/.exec(a)[1];break;case"Android":d=/Android ([\.\_\d]+)/.exec(a)[1]}}catch(b){h.debug("[Utils]: osVersion does not contain version on it. ",a)}}return{type:c,version:d,info:b}},m.checkUserDomain=function(b){return a.isElectron?require("electron").remote.getCurrentWindow()._domain.split(":")[0].endsWith(b):window.location.hostname.endsWith(b)},m.parseIpWithPort=function(a){if(!a&&"string"!=typeof a)return null;if("["===a[0]){var b=/\[(.*)\]:(\d*)/.exec(a);if(b&&3===b.length)return{ipAddress:b[1],port:b[2]}}else if(a.indexOf(":")>0){var c=a.split(":");if(2===c.length)return{ipAddress:c[0],port:c[1]}}return null},m.getChannelInfo=function(a){var b=m.parseIpWithPort(a.stat("googLocalAddress"))||{},c=m.parseIpWithPort(a.stat("googRemoteAddress"))||{},d=function(a){switch(a){case"local":return"host";case"stun":return"srflx";default:return a}};return{ipl:b.ipAddress,ptl:b.port,ipr:c.ipAddress,ptr:c.port,lct:d(a.stat("googLocalCandidateType")),rct:d(a.stat("googRemoteCandidateType")),tt:a.stat("googTransportType")}},m.getIceCandidateInfo=function(b,c,d,e){var f={};if(!(b&&c&&d&&e))return f;var g=function(b,c){var d;return c["network-id"]&&b.a.some(function(b){if("candidate"===b.field&&b.value&&b.value.indexOf("network-id")>=0){var e=new a.IceCandidate(b.value);if("host"===e.typ&&e["network-id"]===c["network-id"])return d=e.address,!0}}),d},h="string"==typeof c?a.sdpParser.parse(c):c;return h.m.some(function(c){if(c.media===d)return c.a.some(function(d){if("candidate"===d.field&&d.value&&d.value.indexOf(e)>=0){var h=new a.IceCandidate(d.value);if(String(h.port)===e){f.value=d.value;var i=b.stat("candidateType");return"host"===i?f.sAddr=f.hAddr=b.stat("ipAddress"):(f.sAddr=h.raddr,f.hAddr=g(c,h),"relayed"!==i&&"relay"!==i||(f.tt=h.getRelayClientTransportType())),!0}}}),!0}),f},m.isEmptyObject=function(a){return 0===Object.keys(a).length},m.getBaseObject=function(a,b){if(!a||"object"!=typeof a)return null;if(a instanceof Array)return a;var c=Object.getPrototypeOf(a);return m.isEmptyObject(c)?a:(b!==!1&&Object.getOwnPropertyNames(c).forEach(function(b){"function"!=typeof c[b]&&a.hasOwnProperty(b)&&(c[b]=a[b])}),c)},m.syncBaseObject=function(a){var b=m.getBaseObject(a,!0);b&&b!==a&&Object.getOwnPropertyNames(b).forEach(function(b){a.hasOwnProperty(b)&&delete a[b]})},m.flattenObj=function(a){if(!a||"object"!=typeof a)return a;var b=Object.getPrototypeOf(a);if(m.isEmptyObject(b))return a;var c={};for(var d in a)"function"!=typeof a[d]&&(c[d]=a[d]);return c},m.getNormalizedFileExtension=function(a){var b=a&&(a.fileName||a.name);if(!b)return null;if(/audio/i.test(a.mimeType))return"audio";if(/video/i.test(a.mimeType))return"video";var c=b.split(".").pop();if(c)switch(c.toLowerCase()){case"doc":case"docx":return"doc";case"ppt":case"pptx":return"ppt";case"pdf":return"pdf";case"xls":case"xlsx":return"xls";case"gz":case"zip":return"zip";case"html":return"html";case"csv":return"csv";case"png":return"png";case"jpg":case"jpeg":return"jpg";case"log":return"log";case"flv":case"mp4":case"ogv":case"webm":return"video";case"wav":case"mp3":case"ogg":return"audio"}return"def"},m.getImageFileExtension=function(a){if(a.type)switch(a.type.toLowerCase()){case"image/png":return"png";case"image/jpeg":return"jpg";case"image/gif":return"gif";case"image/bmp":return"bmp";case"image/svg+xml":return"svg"}return null},m.getMimeTypes=function(a){if(!a)return null;var b=a.split(".").pop();if(b)switch(b.toLowerCase()){case"xlsx":return"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet";case"xltx":return"application/vnd.openxmlformats-officedocument.spreadsheetml.template";case"potx":return"application/vnd.openxmlformats-officedocument.presentationml.template";case"ppsx":return"application/vnd.openxmlformats-officedocument.presentationml.slideshow";case"pptx":return"application/vnd.openxmlformats-officedocument.presentationml.presentation";case"sldx":return"application/vnd.openxmlformats-officedocument.presentationml.slide";case"docx":return"application/vnd.openxmlformats-officedocument.wordprocessingml.document";case"dotx":return"application/vnd.openxmlformats-officedocument.wordprocessingml.template";case"xlam":return"application/vnd.ms-excel.addin.macroEnabled.12";case"xlsb":return"application/vnd.ms-excel.sheet.binary.macroEnabled.12"}return"application/octet-stream"},m.textToHtmlEscaped=function(a,b){if(!a)return"";var c=b?"&nbsp;":"<br>";return a.replace(/&/g,"&amp;").replace(/"/g,"&#34;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\r\n|\r|\n/gm,c)},m.escapedHtmlToText=function(a){return a?a.replace(/&amp;/g,"&").replace(/&#34;/g,'"').replace(/&#39;/g,"'").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&nbsp;/g," ").replace(/<br\/?>/g,"\r\n"):""},m.stripParenthesis=function(a){a=a.trim();for(var b=a.match(/\(/g)||[],c=a.match(/\)/g)||[],d=0;"("===a[d];)d++;return a.slice(d,a.length-Math.abs(b.length-d-c.length))},m.linkifyContent=function(a,b){if(m.isMobile())return"";switch(a=i.addEmoticonsAltAttr(a),b){case"RICH":return c(a);case"PLAIN":return e(a)}return a},m.invalidFileTypes=["ade","adp","app","asp","bas","bat","cer","chm","cmd","cnt","com","cpl","crt","csh","der","exe","fxp","gadget","hlp","hpj","hta","inf","ins","isp","its","js","jse","ksh","lnk","mad","maf","mag","mam","maq","mar","mas","mat","mau","mav","maw","mda","mdb","mde","mdt","mdw","mdz","msc","msh","msh1","msh1xml","msh2","msh2xml","mshxml","msi","msp","mst","ops","osd","pcd","pif","plg","prf","prg","ps1","ps1xml","ps2","ps2xml","psc1","psc2","pst","reg","scf","scr","sct","shb","shs","tmp","url","vb","vbe","vbp","vbs","vsmacros","vsw","ws","wsc","wsf","wsh","xnk"],m.hasScrollbar=function(a){if(a&&a.length>0){var b=a[0];return!!b&&b.scrollHeight>b.clientHeight}return!1},m.isDescendantOrEqual=function(a,b){if(a===b)return!0;for(var c=a;c;)if(c=c.parentElement,c===b)return!0;return!1},m.isSupportedImage=function(a){var b=/^image\/(jpeg|gif|bmp|png|svg\+xml)$/i;return b.test(a)},m.isVideoSupportedByBrowser=function(a){var b=/^video\/(quicktime|mp4|webm)$/i;return b.test(a)},m.shallowCopy=function(a){if(!a||"object"!=typeof a)return a;if(Array.isArray(a))return a.slice();var b=m.flattenObj(a),c={};for(var d in b)b.hasOwnProperty(d)&&(c[d]=b[d]);return c},m.normalizeLocaleProto=function(a){var b;return a&&a.length>=5&&(b=a.replace(/-/g,"_").toUpperCase()),b},m.normalizeLocale=function(a){var b;return a&&a.length>=5&&(b=a.substr(0,2).toLowerCase()+a.substr(2,a.length-2).replace(/_/g,"-")),b},m.getLocalTime=function(a){var b=new Date;return null===a||void 0===a?b.getTime():(b.setTime(b.getTime()+60*(b.getTimezoneOffset()-a)*1e3),b.getTime())},m.delayOrTimestamp=function(a,b){return a>0?Date.now()+a:b},m.buildAttachmentMetaData=function(a){var b=function(a){return{fileId:a.fileId,fileName:a.fileName,itemId:a.itemId,mimeType:a.mimeType,size:a.size}},c=[],d=[];return a&&a.forEach(function(a){if(a.isThirdParty){var e=b(a);return void d.push({type:a.provider,attachment:e,downloadLocation:a.url,previewLocation:a.url,shareLinkToken:a.shareLinkToken})}c.push(b(a)),a.thumbnail&&c.push(b(a.thumbnail))}),{attachments:c,externalAttachments:d}},m.inherit=function(a,b){function c(){}c.prototype=b.prototype,a.prototype=new c,a.prototype.constructor=a,a.parent=b.prototype},m.isOlderThan=function(a,b){if(!a)return!0;var c=864e5;return b=b||1,Date.now()-a>b*c},m.bytesToSize=function(a,b){if(a=parseInt(a,10),!a)return"0 Bytes";var c=1024,d=["Bytes","KB","MB","GB","TB","PB"],e=Math.floor(Math.log(a)/Math.log(c));return Number((a/Math.pow(c,e)).toPrecision(b||3))+" "+d[e]},m.isMacOs=!(!window.navigator||!window.navigator.userAgent)&&(window.navigator.userAgent.indexOf("Mac")!==-1||window.navigator.userAgent.indexOf("Darwin")!==-1),m.isWindowsOs=!(!window.navigator||!window.navigator.platform)&&"win"===window.navigator.platform.substring(0,3).toLowerCase(),m.daysBetween=function(a,b){if(a instanceof Date&&b instanceof Date){var c=864e5;return Math.floor(Math.abs(b.getTime()-a.getTime())/c)}},m.isMobile=function(){return"iOS"===window.navigator.platform||"Android"===window.navigator.platform},m.formatPIN=function(a,b,c){if(!b)return"";if(c)return(a||"")+b+"#";for(var d,e=4,f=3,g=2,h=[],i=a?f:e,j=0;j<b.length;j+=i)j>0&&(i=f),d=b.substr(j,i),d.length>=g||0===h.length?h.push(d):h[h.length-1]+=d;return a&&h.unshift(a),h.push("#"),h.join(" ")},m.CountriesArray=[{name:"res_countryName_Andorra",code:"AD"},{name:"res_countryName_United_Arab_Emirates",code:"AE"},{name:"res_countryName_Afghanistan",code:"AF"},{name:"res_countryName_Antigua_and_Barbuda",code:"AG"},{name:"res_countryName_Anguilla",code:"AI"},{name:"res_countryName_Albania",code:"AL"},{name:"res_countryName_Armenia",code:"AM"},{name:"res_countryName_Netherland_Antilles",code:"AN"},{name:"res_countryName_Angola",code:"AO"},{name:"res_countryName_Antarctic",code:"AQ"},{name:"res_countryName_Argentina",code:"AR"},{name:"res_countryName_American_Samoa",code:"AS"},{name:"res_countryName_Austria",code:"AT"},{name:"res_countryName_Australia",code:"AU"},{name:"res_countryName_Aruba",code:"AW"},{name:"res_countryName_Azerbaijan",code:"AZ"},{name:"res_countryName_Bosnia_and_Herzegovina",code:"BA"},{name:"res_countryName_Barbados",code:"BB"},{name:"res_countryName_Bangladesh",code:"BD"},{name:"res_countryName_Belgium",code:"BE"},{name:"res_countryName_Burkina_Faso",code:"BF"},{name:"res_countryName_Bulgaria",code:"BG"},{name:"res_countryName_Bahrain",code:"BH"},{name:"res_countryName_Burundi",code:"BI"},{name:"res_countryName_Benin",code:"BJ"},{name:"res_countryName_Bermuda",code:"BM"},{name:"res_countryName_Brunei_Darussalam",code:"BN"},{name:"res_countryName_Bolivia",code:"BO"},{name:"res_countryName_Brazil",code:"BR"},{name:"res_countryName_Bahamas",code:"BS"},{name:"res_countryName_Bhutan",code:"BT"},{name:"res_countryName_Botswana",code:"BW"},{name:"res_countryName_Belarus",code:"BY"},{name:"res_countryName_Belize",code:"BZ"},{name:"res_countryName_Canada",code:"CA"},{name:"res_countryName_Dem_Republic_Congo",code:"CD"},{name:"res_countryName_Central_African_Republik",code:"CF"},{name:"res_countryName_Congo",code:"CG"},{name:"res_countryName_Switzerland",code:"CH"},{name:"res_countryName_Cote_d_Ivoire",code:"CI"},{name:"res_countryName_Chile",code:"CL"},{name:"res_countryName_Cameroon",code:"CM"},{name:"res_countryName_China_Peoples_Republic",code:"CN"},{name:"res_countryName_Colombia",code:"CO"},{name:"res_countryName_Costa_Rica",code:"CR"},{name:"res_countryName_Cuba",code:"CU"},{name:"res_countryName_Cap_Verde",code:"CV"},{name:"res_countryName_Cyprus",code:"CY"},{name:"res_countryName_Czech_Republik",code:"CZ"},{name:"res_countryName_Germany",code:"DE"},{name:"res_countryName_Djibouti",code:"DJ"},{name:"res_countryName_Denmark",code:"DK"},{name:"res_countryName_Dominica",code:"DM"},{name:"res_countryName_Dominican_Republik",code:"DO"},{name:"res_countryName_Algeria",code:"DZ"},{name:"res_countryName_Ecuador",code:"EC"},{name:"res_countryName_Estonia",code:"EE"},{name:"res_countryName_Egypt",code:"EG"},{name:"res_countryName_Westsahara",code:"EH"},{name:"res_countryName_Eritrea",code:"ER"},{name:"res_countryName_Spain",code:"ES"},{name:"res_countryName_Ethiopia",code:"ET"},{name:"res_countryName_Finland",code:"FI"},{name:"res_countryName_Fiji",code:"FJ"},{name:"res_countryName_Falkland_Islands",code:"FK"},{name:"res_countryName_Micronesia_Fed_States",code:"FM"},{name:"res_countryName_Faroer",code:"FO"},{name:"res_countryName_France",code:"FR"},{name:"res_countryName_Gaboon",code:"GA"},{name:"res_countryName_United_Kingdom",code:"GB"},{name:"res_countryName_United_Kingdom",code:"UK"},{name:"res_countryName_Grenada",code:"GD"},{name:"res_countryName_Georgia",code:"GE"},{name:"res_countryName_French_Guayana",code:"GF"},{name:"res_countryName_Ghana",code:"GH"},{name:"res_countryName_Gibraltar",code:"GI"},{name:"res_countryName_Greenland",code:"GL"},{name:"res_countryName_Gambia",code:"GM"},{name:"res_countryName_Guinea",code:"GN"},{name:"res_countryName_Guadeloupe",code:"GP"},{name:"res_countryName_Equatorial_Guinea",code:"GQ"},{name:"res_countryName_Greece",code:"GR"},{name:"res_countryName_South_Georgia_South_Sandwichisland",code:"GS"},{name:"res_countryName_Guatemala",code:"GT"},{name:"res_countryName_Guam",code:"GU"},{name:"res_countryName_Guinea_Bissau",code:"GW"},{name:"res_countryName_Guyana",code:"GY"},{name:"res_countryName_Hong_Kong",code:"HK"},{name:"res_countryName_Honduras",code:"HN"},{name:"res_countryName_Croatia",code:"HR"},{name:"res_countryName_Haiti",code:"HT"},{name:"res_countryName_Hungary",code:"HU"},{name:"res_countryName_Canary_Island",code:"IC"},{name:"res_countryName_Indonesia",code:"ID"},{name:"res_countryName_Ireland",code:"IE"},{name:"res_countryName_Israel",code:"IL"},{name:"res_countryName_India",code:"IN"},{name:"res_countryName_British_Indian_Ocean_Territory",code:"IO"},{name:"res_countryName_Iraq",code:"IQ"},{name:"res_countryName_Iran_Islamic_Republic",code:"IR"},{name:"res_countryName_Iceland",code:"IS"},{name:"res_countryName_Italy",code:"IT"},{name:"res_countryName_Jamaica",code:"JM"},{name:"res_countryName_Jordan",code:"JO"},{name:"res_countryName_Japan",code:"JP"},{name:"res_countryName_Kenya",code:"KE"},{name:"res_countryName_Kyrgyzstan",code:"KG"},{name:"res_countryName_Cambodia",code:"KH"},{name:"res_countryName_Kiribati",code:"KI"},{name:"res_countryName_Comoros",code:"KM"},{name:"res_countryName_St_Kitts_and_Nevis",code:"KN"},{name:"res_countryName_Korea_Dem_Peoples_Rep_North_Korea",code:"KP"},{name:"res_countryName_Korea_South",code:"KR"},{
name:"res_countryName_Kuwait",code:"KW"},{name:"res_countryName_Cayman_Islands",code:"KY"},{name:"res_countryName_Kazakhstan",code:"KZ"},{name:"res_countryName_Laos_Democratic_Peoples_Republic",code:"LA"},{name:"res_countryName_Lebanon",code:"LB"},{name:"res_countryName_Saint_Lucia",code:"LC"},{name:"res_countryName_Liechtenstein",code:"LI"},{name:"res_countryName_Sri_Lanka",code:"LK"},{name:"res_countryName_Liberia",code:"LR"},{name:"res_countryName_Lesotho",code:"LS"},{name:"res_countryName_Lithuania",code:"LT"},{name:"res_countryName_Luxembourg",code:"LU"},{name:"res_countryName_Latvia",code:"LV"},{name:"res_countryName_Libya_Libyan_Arabian_Dschamahirija",code:"LY"},{name:"res_countryName_Morocco",code:"MA"},{name:"res_countryName_Monaco",code:"MC"},{name:"res_countryName_Moldova_Republic",code:"MD"},{name:"res_countryName_Montenegro",code:"ME"},{name:"res_countryName_Madagascar",code:"MG"},{name:"res_countryName_Marshall_Islands",code:"MH"},{name:"res_countryName_Mazedonia_former_Rep_of_Yugoslavia",code:"MK"},{name:"res_countryName_Mali",code:"ML"},{name:"res_countryName_Myanmar_Burma",code:"MM"},{name:"res_countryName_Mongolia",code:"MN"},{name:"res_countryName_Macau",code:"MO"},{name:"res_countryName_Northern_Marians",code:"MP"},{name:"res_countryName_Martinique",code:"MQ"},{name:"res_countryName_Mauretania",code:"MR"},{name:"res_countryName_Montserrat",code:"MS"},{name:"res_countryName_Malta",code:"MT"},{name:"res_countryName_Mauritius",code:"MU"},{name:"res_countryName_Maledives",code:"MV"},{name:"res_countryName_Malawi",code:"MW"},{name:"res_countryName_Mexico",code:"MX"},{name:"res_countryName_Malaysia",code:"MY"},{name:"res_countryName_Mozambique",code:"MZ"},{name:"res_countryName_Namibia",code:"NA"},{name:"res_countryName_New_Caledonia",code:"NC"},{name:"res_countryName_Niger",code:"NE"},{name:"res_countryName_Norfolk_Islands",code:"NF"},{name:"res_countryName_Nigeria",code:"NG"},{name:"res_countryName_Nicaragua",code:"NI"},{name:"res_countryName_Netherlands",code:"NL"},{name:"res_countryName_Norway",code:"NO"},{name:"res_countryName_Nepal",code:"NP"},{name:"res_countryName_Nauru",code:"NR"},{name:"res_countryName_New_Zealand",code:"NZ"},{name:"res_countryName_Oman",code:"OM"},{name:"res_countryName_Panama",code:"PA"},{name:"res_countryName_Peru",code:"PE"},{name:"res_countryName_French_Polynesia",code:"PF"},{name:"res_countryName_Papua_New_Guinea",code:"PG"},{name:"res_countryName_Philippines",code:"PH"},{name:"res_countryName_Pakistan",code:"PK"},{name:"res_countryName_Poland",code:"PL"},{name:"res_countryName_Saint_Pierre_and_Miquelon",code:"PM"},{name:"res_countryName_Pitcairn_Island",code:"PN"},{name:"res_countryName_Puerto_Rico",code:"PR"},{name:"res_countryName_Palestine_regions_occupied",code:"PS"},{name:"res_countryName_Portugal",code:"PT"},{name:"res_countryName_Palau",code:"PW"},{name:"res_countryName_Paraguay",code:"PY"},{name:"res_countryName_Quatar",code:"QA"},{name:"res_countryName_Reunion",code:"RE"},{name:"res_countryName_Romania",code:"RO"},{name:"res_countryName_Russian_Federation",code:"RU"},{name:"res_countryName_Rwanda",code:"RW"},{name:"res_countryName_Saudi_Arabia",code:"SA"},{name:"res_countryName_Solomonen",code:"SB"},{name:"res_countryName_Seychelles",code:"SC"},{name:"res_countryName_Sudan",code:"SD"},{name:"res_countryName_Sweden",code:"SE"},{name:"res_countryName_Singapore",code:"SG"},{name:"res_countryName_Saint_Helena",code:"SH"},{name:"res_countryName_Slovenia",code:"SI"},{name:"res_countryName_Spitzbergen",code:"SJ"},{name:"res_countryName_Slovakia",code:"SK"},{name:"res_countryName_Sierra_Leone",code:"SL"},{name:"res_countryName_San_Marino",code:"SM"},{name:"res_countryName_Senegal",code:"SN"},{name:"res_countryName_Somalia",code:"SO"},{name:"res_countryName_Suriname",code:"SR"},{name:"res_countryName_South_Sudan_Republic_of",code:"SS"},{name:"res_countryName_Sao_Tome_and_Principe",code:"ST"},{name:"res_countryName_El_Salvador",code:"SV"},{name:"res_countryName_Syria_Arabian_Republic",code:"SY"},{name:"res_countryName_Swaziland",code:"SZ"},{name:"res_countryName_Turks_and_Caicos_Islands",code:"TC"},{name:"res_countryName_Chad",code:"TD"},{name:"res_countryName_Togo",code:"TG"},{name:"res_countryName_Thailand",code:"TH"},{name:"res_countryName_Tajikstan",code:"TJ"},{name:"res_countryName_Tokelau",code:"TK"},{name:"res_countryName_Timor_Leste",code:"TL"},{name:"res_countryName_Turkmenistan",code:"TM"},{name:"res_countryName_Tunisia",code:"TN"},{name:"res_countryName_Tonga",code:"TO"},{name:"res_countryName_Turkey",code:"TR"},{name:"res_countryName_Trinidad_and_Tobago",code:"TT"},{name:"res_countryName_Tuvalu",code:"TV"},{name:"res_countryName_Taiwan",code:"TW"},{name:"res_countryName_Tanzania_United_Republic",code:"TZ"},{name:"res_countryName_Ukraine",code:"UA"},{name:"res_countryName_Uganda",code:"UG"},{name:"res_countryName_Minor_American_Oversea_Islands",code:"UM"},{name:"res_countryName_United_States_of_America",code:"US"},{name:"res_countryName_Uruguay",code:"UY"},{name:"res_countryName_Uzbekistan",code:"UZ"},{name:"res_countryName_Vatican_City",code:"VA"},{name:"res_countryName_Saint_Vincent_and_Grenadines",code:"VC"},{name:"res_countryName_Venezuela",code:"VE"},{name:"res_countryName_British_Virgin_Islands",code:"VG"},{name:"res_countryName_American_Virgin_Islands",code:"VI"},{name:"res_countryName_Vietnam",code:"VN"},{name:"res_countryName_Vanuatu",code:"VU"},{name:"res_countryName_Wallis_and_Futuna",code:"WF"},{name:"res_countryName_Samoa",code:"WS"},{name:"res_countryName_Kosovo",code:"XK"},{name:"res_countryName_Serbia",code:"XS"},{name:"res_countryName_Yemen",code:"YE"},{name:"res_countryName_Mayotte",code:"YT"},{name:"res_countryName_South_Africa",code:"ZA"},{name:"res_countryName_Zambia",code:"ZM"},{name:"res_countryName_Zimbabwe",code:"ZW"}],m.CountryCodeToCountryNameResourceMap={},m.CountriesArray.forEach(function(a){m.CountryCodeToCountryNameResourceMap[a.code]=a.name}),m.isCircuitLink=function(b,c){if(b&&c){if(a.isElectron&&0===c.search(/^file:\/\/\S+?\.html#\/\S+?$/i))return!0;if(c.startsWith("#/"))return!0;var d=/^(?:http|https|ftp):\/\//;if(d.exec(b)||(b="https://"+b),b.endsWith("/")||(b+="/"),d.exec(c)||(c="https://"+c),c.length>b.length&&c.startsWith(b)){var e=c.slice(b.length),f=e.match(m.CIRCUIT_CONVERSATION_HASH_PATTERN);return f?f[0].replace(/\/(muted|open)/gim,"/conversation"):(f=e.match(m.CIRCUIT_LINKS_HASH_PATTERN)||e.match(m.CIRCUIT_EMAIL_HASH_PATTERN),f&&f[0])}return!1}},m.throttle=function(a,b,c){var d,e,f,g=null,h=0;c=c||{};var i=function(){h=c.leading===!1?0:Date.now(),g=null,f=a.apply(d,e),d=e=null};return function(){var j=Date.now();h||c.leading!==!1||(h=j);var k=b-(j-h);return d=this,e=arguments,k<=0?(g&&(window.clearTimeout(g),g=null),h=j,f=a.apply(d,e),d=e=null):g||c.trailing===!1||(g=window.setTimeout(i,k)),f}},m.hasEmptyPrototype=function(a){return!(!a||"object"!=typeof a)&&m.isEmptyObject(Object.getPrototypeOf(a))},m.compareElements=function(a,b){if(a===b)return!0;if(!a||!b)return!1;if("object"!=typeof a||"object"!=typeof b)return!1;if(a instanceof Array&&b instanceof Array)return function(a,b){var c=a.length,d=[];if(a===b)return!0;if(a.length!==b.length)return!1;for(var e=0;e<c;++e)for(var f=0;f<c;++f)if(d.indexOf(b[f])===-1&&m.compareElements(a[e],b[f])){d.push(b[f]);break}return d.length===c}(a,b);if(!m.hasEmptyPrototype(a)||!m.hasEmptyPrototype(b))return!1;for(var c in a)if(a.hasOwnProperty(c)&&0!==c.indexOf("$$")&&!m.compareElements(a[c],b[c]))return!1;return!0},m.copyToClipboard=function(a,b,c){var d,e,f,g,i;if(a)try{e=document.createRange(),d=window.getSelection(),g=document.body.style.overflow,i=this.getBrowserInfo().msie,f=document.createElement("div"),a=a.replace(/\r\n/gi,"<br>"),f.style.backgroundColor="#fff",f.style.font="normal normal 15px Calibri, sans-serif",f.style["white-space"]="pre-wrap",c?f.innerText=a:f.innerHTML=a,document.body.appendChild(f),e.selectNode(f),d.removeAllRanges(),d.addRange(e),i&&(document.body.style.overflow="hidden");var j=document.execCommand("copy");j?b&&b():b&&b("Failed to copy")}catch(a){h.error("[Utils]: Copy to clipboard failed"),b&&b("Internal error")}finally{d&&("function"==typeof d.removeRange?d.removeRange(e):d.removeAllRanges()),i&&(document.body.style.overflow=g),f&&document.body.removeChild(f)}},m.openNewWindow=function(a){var b=window.open(a);window.setTimeout(function(){b.close()},100)},m.sslProxify=function(a){return a&&a.startsWith("http:")?l+encodeURIComponent(a):a},m.appIsFocused=function(){if(a.isElectron){var b=g.getCurrentWindow();return b.isFocused()&&b.isVisible()&&!b.isMinimized()}return document.hidden!==!0},m.validatePreviewProtocol=function(a){return a?a.match(/https:/)?a:a.replace('src="//','src="https://'):""},m.TabSelector=function(a){function b(){Object.keys(d).forEach(function(a){d[a]=!1})}if(Array.isArray(a)&&0!==a.length){var c=this,d={},e="";a.forEach(function(a,f){0===f?(d[a]=!0,e=a):d[a]=!1,Object.defineProperty(c,a,{get:function(){return d[a]},set:function(c){c&&(b(),d[a]=!0,e=a)},enumerable:!0,configurable:!1})}),Object.defineProperty(this,"selected",{get:function(){return e},enumerable:!0,configurable:!1}),Object.defineProperty(this,"selectedIdx",{get:function(){return a.indexOf(e)},enumerable:!0,configurable:!1})}},m.getOrigin=d,m.parseQS=function(a){var b={};a=a.substring(1);for(var c=/([^&=]+)=([^&]*)/g,d=c.exec(a);d;)b[decodeURIComponent(d[1])]=decodeURIComponent(d[2]),d=c.exec(a);return b},m.toQS=function(a){var b=[];for(var c in a)a.hasOwnProperty(c)&&void 0!==a[c]&&b.push(encodeURIComponent(c)+"="+encodeURIComponent(a[c]));return b.join("&")},m.extractConfigurableText=function(a,b,c){var d=a&&a.find(function(a){return a.type===b});if(d&&d.texts){var e,f=function(a){return d.texts.find(function(b){return b.language===a})};return c&&(e=f(c),e||(c=c.split("-",1)[0],e=f(c))),e||(e=f("default")),e&&e.translation}},m.selectMediaDevice=function(a,b,c){if(a&&b){var d;return b.some(function(b){return d="undefined"==typeof b.id?b:a.find(function(a){return b.id===a.id}),!!d}),!d&&c&&b.some(function(b){return d=a.find(function(a){return b.label===a.label}),!!d}),d}},"function"!=typeof Object.values&&(Object.values=function(a){return Object.keys(a).map(function(b){return a[b]})}),"function"!=typeof Object.assign&&(Object.assign=function(a){if(null===a||void 0===a)throw new TypeError("Cannot convert undefined or null to object");for(var b=Object(a),c=1;c<arguments.length;c++){var d=arguments[c];if(d)for(var e in d)Object.prototype.hasOwnProperty.call(d,e)&&(b[e]=d[e])}return b}),String.prototype.startsWith||Object.defineProperty(String.prototype,"startsWith",{value:function(a,b){return null!==a&&void 0!==a&&(a=a.toString(),b=Math.floor(b)||0,this.substr(b,a.length)===a)}}),String.prototype.endsWith||Object.defineProperty(String.prototype,"endsWith",{value:function(a,b){return null!==a&&void 0!==a&&(b=void 0===b?this.length:Math.min(Math.floor(b)||0,this.length),a=a.toString(),b-=a.length,!(b<0)&&this.substr(b,a.length)===a)}}),String.prototype.includes||Object.defineProperty(String.prototype,"includes",{value:function(a){return this.indexOf(a)!==-1}}),Object.defineProperty(String.prototype,"format",{value:function(){var a=arguments;return this.replace(/{(\d+)}/g,function(b,c){return a[c]||b})}}),Object.defineProperty(String.prototype,"replaceAt",{value:function(a,b){return this.substr(0,a)+b+this.substr(a+b.length)}}),Object.defineProperty(String.prototype,"randomCharacter",{value:function(){return this[Math.floor(this.length*Math.random())]}}),Array.prototype.includes||Object.defineProperty(Array.prototype,"includes",{value:function(a){return this.indexOf(a)!==-1}}),Array.prototype.find||Object.defineProperty(Array.prototype,"find",{value:function(a){if(null===this||void 0===this)throw new TypeError("Array.prototype.find called on null or undefined");if("function"!=typeof a)throw new TypeError("predicate must be a function");for(var b,c=Object(this),d=c.length>>>0,e=arguments[1],f=0;f<d;f++)if(b=c[f],a.call(e,b,f,c))return b}}),Array.prototype.findIndex||Object.defineProperty(Array.prototype,"findIndex",{value:function(a){if(null===this||void 0===this)throw new TypeError("Array.prototype.findIndex called on null or undefined");if("function"!=typeof a)throw new TypeError("predicate must be a function");for(var b,c=Object(this),d=c.length>>>0,e=arguments[1],f=0;f<d;f++)if(b=c[f],a.call(e,b,f,c))return f;return-1}}),Object.defineProperty(Array.prototype,"isEmpty",{value:function(){return 0===this.length}}),Object.defineProperty(Array.prototype,"last",{value:function(){if(this.length>0)return this[this.length-1]}}),Object.defineProperty(Array.prototype,"shuffle",{value:function(){for(var a=this.length,b=0;b<a;b++){var c=Math.floor(Math.random()*a),d=this[c];this[c]=this[b],this[b]=d}return this}}),Object.defineProperty(Array.prototype,"randomCopy",{value:function(a){var b=this.slice(0);return b.shuffle(),b.splice(0,a)}}),Object.defineProperty(Array.prototype,"move",{value:function(a,b){if(void 0!==a&&void 0!==b){if(b>=this.length)for(var c=b-this.length;c--+1;)this.push(void 0);this.splice(b,0,this.splice(a,1)[0])}}}),Object.defineProperty(Array.prototype,"binaryInsert",{value:function(a,b){if("function"!=typeof b)return!1;for(var c,d,e=0,f=this.length-1,g=!1;e<=f;)if(c=Math.floor((e+f)/2),d=this[c],b(d,a)<0)e=c+1;else{if(!(b(d,a)>0)){g=!0;break}f=c-1}var h=g?c+1:e;return h>=0&&(this.splice(h,0,a),!0)}}),Array.prototype.remove||Object.defineProperty(Array.prototype,"remove",{value:function(a){if("undefined"!=typeof a&&a){var b=this.indexOf(a);b>-1&&this.splice(b,1)}}}),Array.prototype.empty||Object.defineProperty(Array.prototype,"empty",{value:function(){for(;this.length>0;)this.pop()}}),Array.prototype.copy||Object.defineProperty(Array.prototype,"copy",{value:function(a){this.empty(),Array.prototype.push.apply(this,a)}}),Array.prototype.diff||Object.defineProperty(Array.prototype,"diff",{value:function(a){return this.filter(function(b){return!a.includes(b)})}}),RegExp.escape=function(a){if(!a)return"";var b=a.replace(/[.*+?|()\[\]{}\\$^]/g,"\\$&");return b},Date.prototype.moveToEndOfDay=function(){return this.set({hour:23,minute:59,second:59})},Date.prototype.moveToFirstDayOfYear=function(){return this.set({day:1,month:0})},Date.prototype.moveToLastDayOfYear=function(){return this.set({month:11}).moveToLastDayOfMonth()};var p={};return p.format=function(a){if("undefined"!=typeof PhoneNumberUtil&&a&&"+"===a.charAt(0))try{var b=PhoneNumberUtil.parseAndKeepRawInput(a,null);a=PhoneNumberUtil.formatInternational(b)}catch(a){}return a},a.Utils=m,a.PhoneNumberFormatter=p,a}(Circuit||{}),Circuit=function(a){"use strict";function b(a,b,d){var e=c.EMOTICON_MAPPING[d];return e?String.fromCodePoint(e):""}var c=a.Utils||{};c.EMOTICON_MAPPING={":)":128515,":D":128516,":(":128542,":heart":128525,";)":128521,":awesome":128516,":angry":128544,":zzz":128554,":O":128562,";(":128546};var d=/<(img[^>|<]*(?:shortcut|abbr)="(\S*)"[^\/?>]*\/?)>/gi;return c.standardizeEmoticon=function(a){return a?a.replace(d,b):""},c.removeMentionHtml=function(a){var b=0;return a.replace(/(<span.*?>)|(<\/span>)/gi,function(a,c,d){return c?c.match(/class="mention"/i)?"":(b++,c):d?b?(b--,d):"":void 0})},a}(Circuit||{}),Circuit=function(a){"use strict";var b=a.logger,c=a.Utils,d=Object.freeze({WSMessageType:{REQUEST:"REQUEST",RESPONSE:"RESPONSE",EVENT:"EVENT"},ContentType:{SYSTEM:"SYSTEM",NONE:"NONE",EXTENSION:"EXTENSION",CONVERSATION:"CONVERSATION",USER:"USER",RTC_SESSION:"RTC_SESSION",RTC_CALL:"RTC_CALL",SEARCH:"SEARCH",KEEPALIVE:"KEEPALIVE",INSTRUMENTATION:"INSTRUMENTATION",GUEST:"GUEST",ADMINISTRATION:"ADMINISTRATION",THIRDPARTYCONNECTORS:"THIRDPARTYCONNECTORS",USER_TO_USER:"USER_TO_USER",VERSION:"VERSION",ACCOUNT:"ACCOUNT",ACTIVITYSTREAM:"ACTIVITYSTREAM",CONVERSATION_USER_DATA:"CONVERSATION_USER_DATA",USER_DATA:"USER_DATA"},ReturnCode:{OK:"OK",AUTHORIZATION_FAILED:"AUTHORIZATION_FAILED",AUTHORIZATION_REQUIRED:"AUTHORIZATION_REQUIRED",SERVICE_EXCEPTION:"SERVICE_EXCEPTION",PROTOBUF_CONVERSION_EXCEPTION:"PROTOBUF_CONVERSION_EXCEPTION",CONVERSION_EXCEPTION:"CONVERSION_EXCEPTION",NO_MESSAGE_HANDLER:"NO_MESSAGE_HANDLER",INVALID_CLIENT:"INVALID_CLIENT",NO_RESULT:"NO_RESULT",OPERATION_NOT_SUPPORTED:"OPERATION_NOT_SUPPORTED",ENTITY_ALREADY_EXISTS:"ENTITY_ALREADY_EXISTS",FRAME_SIZE_TO_LONG:"FRAME_SIZE_TO_LONG",BACKEND_UNAVAILABLE:"BACKEND_UNAVAILABLE",OVERLOADED:"OVERLOADED",OLD_VERSION:"OLD_VERSION",STORAGE_OVERLOADED:"STORAGE_OVERLOADED",USER_NOT_FOUND:"USER_NOT_FOUND",SERVICE_UNAVAILABLE:"SERVICE_UNAVAILABLE",REQUEST_TIMEOUT:"REQUEST_TIMEOUT",DISCONNECTED:"DISCONNECTED",INVALID_MESSAGE:"INVALID_MESSAGE",FAILED_TO_SEND:"FAILED_TO_SEND",UNEXPECTED_RESPONSE:"UNEXPECTED_RESPONSE",MISSING_REQUIRED_PARAMETER:"MISSING_REQUIRED_PARAMETER",CHOOSE_DESKTOP_MEDIA_CANCELLED:"CHOOSE_DESKTOP_MEDIA_CANCELLED",SDK_ERROR:"SDK_ERROR"},ErrorCode:{UNEXPECTED_ERROR:"UNEXPECTED_ERROR",CONSTRAINT_VIOLATION:"CONSTRAINT_VIOLATION",MAX_NUM_CONV_PARTICIPANTS:"MAX_NUM_CONV_PARTICIPANTS",THIRDPARTY_ERROR:"THIRDPARTY_ERROR",AUTHORIZATION_FAILED:"AUTHORIZATION_FAILED",PERMISSION_DENIED:"PERMISSION_DENIED",RTC_NO_MEDIA_NODES_AVAILABLE:"RTC_NO_MEDIA_NODES_AVAILABLE",RTC_CONCURRENT_INCOMING_CALL:"RTC_CONCURRENT_INCOMING_CALL",DUPLICATED_ENTITY_ERROR:"DUPLICATED_ENTITY_ERROR",RTC_MEDIA_NODE_UNREACHABLE:"RTC_MEDIA_NODE_UNREACHABLE"},ThirdPartyError:{UNSUPPORTED_PROVIDER:"UNSUPPORTED_PROVIDER",BAD_REQUEST:"BAD_REQUEST",GENERAL_ERROR:"GENERAL_ERROR",INSUFFICIENT_PERMISSION:"INSUFFICIENT_PERMISSION",NOT_AUTHORIZED:"NOT_AUTHORIZED",RESOURCE_NOT_FOUND:"RESOURCE_NOT_FOUND",SERVER_DOWN:"SERVER_DOWN",SESSION_EXPIRED:"SESSION_EXPIRED",UNSUPPORTED_FILE_TYPE:"UNSUPPORTED_FILE_TYPE",WRONG_SERVER:"WRONG_SERVER",EMPTY_SETTINGS:"EMPTY_SETTINGS",EMPTY_USERNAME:"EMPTY_USERNAME",EMPTY_PASSWORD:"EMPTY_PASSWORD",EMPTY_SERVER_ADDRESS:"EMPTY_SERVER_ADDRESS",INVALID_SERVER_ADDRESS:"INVALID_SERVER_ADDRESS",NOT_CONNECTED:"NOT_CONNECTED",INVALID_ITEMIDS:"INVALID_ITEMIDS"},ConversationActionType:{CREATE:"CREATE",UPDATE:"UPDATE",DELETE:"DELETE",ADD_PARTICIPANT:"ADD_PARTICIPANT",REMOVE_PARTICIPANT:"REMOVE_PARTICIPANT",ADD_TEXT_ITEM:"ADD_TEXT_ITEM",UPDATE_TEXT_ITEM:"UPDATE_TEXT_ITEM",DELETE_TEXT_ITEM:"DELETE_TEXT_ITEM",GET_CONVERSATION_BY_ID:"GET_CONVERSATION_BY_ID",GET_CONVERSATIONS:"GET_CONVERSATIONS",GET_ITEM_BY_ID:"GET_ITEM_BY_ID",GET_ITEMS_BY_CONVERSATION:"GET_ITEMS_BY_CONVERSATION",GET_ITEMS_BY_CONVERSATION_ITEM_ID:"GET_ITEMS_BY_CONVERSATION_ITEM_ID",SET_READ_POINTER:"SET_READ_POINTER",SUBSCRIBE:"SUBSCRIBE",UNSUBSCRIBE:"UNSUBSCRIBE",TYPING:"TYPING",GET_CONVERSATION_USER_DATA:"GET_CONVERSATION_USER_DATA",SET_FLAG_ITEM:"SET_FLAG_ITEM",CLEAR_FLAG_ITEM:"CLEAR_FLAG_ITEM",GET_FLAGGED_ITEMS:"GET_FLAGGED_ITEMS",GET_JOIN_DETAILS:"GET_JOIN_DETAILS",GET_SUPPORT_CONVERSATION_ID:"GET_SUPPORT_CONVERSATION_ID",GET_SUPPORT_CONVERSATION:"GET_SUPPORT_CONVERSATION",GET_OPEN_CONVERSATIONS:"GET_OPEN_CONVERSATIONS",JOIN_OPEN_CONVERSATION:"JOIN_OPEN_CONVERSATION",MARK_CONVERSATION:"MARK_CONVERSATION",UNMARK_CONVERSATION:"UNMARK_CONVERSATION",GET_MARKED_CONVERSATIONS_LIST:"GET_MARKED_CONVERSATIONS_LIST",SET_CONVERSATION_AVATAR:"SET_CONVERSATION_AVATAR",GET_TELEPHONY_CONVERSATION_ID:"GET_TELEPHONY_CONVERSATION_ID",GET_ATTACHMENTS:"GET_ATTACHMENTS",GET_CONVERSATION_BY_USER:"GET_CONVERSATION_BY_USER",GET_CONVERSATION_SUMMARY:"GET_CONVERSATION_SUMMARY",LIKE_TEXT_ITEM:"LIKE_TEXT_ITEM",UNLIKE_TEXT_ITEM:"UNLIKE_TEXT_ITEM",DELETE_RECORDING:"DELETE_RECORDING",MODERATE_CONVERSATION:"MODERATE_CONVERSATION",UNMODERATE_CONVERSATION:"UNMODERATE_CONVERSATION",ADD_SCHEDULE_ITEM:"ADD_SCHEDULE_ITEM",UPDATE_SCHEDULE_ITEM:"UPDATE_SCHEDULE_ITEM",DELETE_SCHEDULE_ITEM:"DELETE_SCHEDULE_ITEM",GET_ALL_USER_SCHEDULE_ITEMS:"GET_ALL_USER_SCHEDULE_ITEMS",GRANT_MODERATOR_RIGHTS:"GRANT_MODERATOR_RIGHTS",DROP_MODERATOR_RIGHTS:"DROP_MODERATOR_RIGHTS",GET_CONVERSATION_THREADS:"GET_CONVERSATION_THREADS",GET_THREAD_COMMENTS:"GET_THREAD_COMMENTS",GET_THREADS_BY_IDS:"GET_THREADS_BY_IDS",ADD_JOURNAL_ENTRY:"ADD_JOURNAL_ENTRY",GET_THREADS_BY_ITEM_IDS:"GET_THREADS_BY_ITEM_IDS",DELETE_ATTACHMENTS:"DELETE_ATTACHMENTS",UPDATE_GUEST_ACCESS:"UPDATE_GUEST_ACCESS",GET_CONVERSATION_PARTICIPANTS:"GET_CONVERSATION_PARTICIPANTS",GET_CONVERSATION_FEED:"GET_CONVERSATION_FEED",SET_FAVORITE_POSITION:"SET_FAVORITE_POSITION",GET_ITEMS_BY_IDS:"GET_ITEMS_BY_IDS",ADD_LABELS:"ADD_LABELS",ASSIGN_LABELS:"ASSIGN_LABELS",UNASSIGN_LABELS:"UNASSIGN_LABELS",GET_LABELS:"GET_LABELS",GET_LABEL_PAGE:"GET_LABEL_PAGE",REMOVE_LABELS:"REMOVE_LABELS",EDIT_LABEL:"EDIT_LABEL",UPDATE_RTC_ITEM_ATTACHMENTS:"UPDATE_RTC_ITEM_ATTACHMENTS",GET_CONVERSATIONS_BY_FILTER:"GET_CONVERSATIONS_BY_FILTER",ADD_FILTER:"ADD_FILTER",REMOVE_FILTERS:"REMOVE_FILTERS",GET_FILTERS:"GET_FILTERS",EDIT_FILTER:"EDIT_FILTER",GET_FAVORITE_CONVERSATION_IDS:"GET_FAVORITE_CONVERSATION_IDS",GET_CONVERSATIONS_BY_IDS:"GET_CONVERSATIONS_BY_IDS",GET_USER_DATA_SINCE:"GET_USER_DATA_SINCE",GET_CONFERENCE_INVITATION_TEXT:"GET_CONFERENCE_INVITATION_TEXT",GET_CONFERENCE_INVITATION_EXAMPLE:"GET_CONFERENCE_INVITATION_EXAMPLE"},ConversationEventType:{CREATE:"CREATE",UPDATE:"UPDATE",DELETE:"DELETE",ADD_ITEM:"ADD_ITEM",UPDATE_ITEM:"UPDATE_ITEM",READ_ITEMS:"READ_ITEMS",TYPING:"TYPING",DRAFT_MESSAGE_SAVED:"DRAFT_MESSAGE_SAVED",DRAFT_MESSAGE_DISCARDED:"DRAFT_MESSAGE_DISCARDED",DRAFT_MESSAGE_PUBLISHED:"DRAFT_MESSAGE_PUBLISHED",FLAG_ITEM:"FLAG_ITEM",CLEAR_FLAGGED_ITEM:"CLEAR_FLAGGED_ITEM",CONVERSATION_MARKED:"CONVERSATION_MARKED",CONVERSATION_UNMARKED:"CONVERSATION_UNMARKED",FAVORITE_POSITION_CHANGED:"FAVORITE_POSITION_CHANGED",USER_DATA_CHANGED:"USER_DATA_CHANGED"},SearchDirection:{AFTER:"AFTER",BEFORE:"BEFORE",BOTH:"BOTH"},TimestampFilter:{MODIFICATION:"MODIFICATION",CREATION:"CREATION"},OrderBy:{TIMESTAMP_ASC:"TIMESTAMP_ASC",TIMESTAMP_DESC:"TIMESTAMP_DESC"},OrderType:{MODIFICATION:"MODIFICATION",CREATION:"CREATION"},ConversationType:{DIRECT:"DIRECT",GROUP:"GROUP",OPEN:"OPEN",LARGE:"LARGE"},ConversationItemType:{TEXT:"TEXT",RTC:"RTC",SYSTEM:"SYSTEM"},ConversationFilter:{ALL:"ALL",OPEN_MEMBER:"OPEN_MEMBER",MARKED:"MARKED",ARCHIVED:"ARCHIVED",UNARCHIVED:"UNARCHIVED"},ConversationMarkFilter:{MUTE:"MUTE",FAVORITE:"FAVORITE"},GetConversationParticipantCriteria:{DISPLAY_NAME:"DISPLAY_NAME",TYPE:"TYPE"},ConversationParticipantType:{ACTIVE:"ACTIVE",REGULAR:"REGULAR",FORMER:"FORMER",MODERATOR:"MODERATOR",GUEST:"GUEST"},DataRetentionState:{UNTOUCHED:"UNTOUCHED",OUTDATED:"OUTDATED",DELETED:"DELETED"},RetrieveAction:{CONVERSATIONS:"CONVERSATIONS",CONVERSATION_IDS:"CONVERSATION_IDS",CONVERSATIONS_AND_IDS:"CONVERSATIONS_AND_IDS"},RTCItemType:{STARTED:"STARTED",ENDED:"ENDED",MISSED:"MISSED",PARTICIPANT_JOINED:"PARTICIPANT_JOINED",PARTICIPANT_LEFT:"PARTICIPANT_LEFT",MOVED:"MOVED"},RTCItemMissed:{UNREACHABLE:"UNREACHABLE",TIMEOUT:"TIMEOUT",USER_BUSY:"USER_BUSY",DECLINED:"DECLINED",CANCELED:"CANCELED",INVALID_NUMBER:"INVALID_NUMBER",TEMPORARILY_UNAVAILABLE:"TEMPORARILY_UNAVAILABLE"},RTCItemMoved:{MOVED_FROM:"MOVED_FROM",MOVED_TO:"MOVED_TO"},ExternalUnshareProviderType:{SYNCPLICITY:"SYNCPLICITY"},SortingType:{RECENT_ACTIVITY_ASC:"RECENT_ACTIVITY_ASC",RECENT_ACTIVITY_DESC:"RECENT_ACTIVITY_DESC",ALPHABETICALLY_ASC:"ALPHABETICALLY_ASC",ALPHABETICALLY_DESC:"ALPHABETICALLY_DESC",POPULARITY_ASC:"POPULARITY_ASC",POPULARITY_DESC:"POPULARITY_DESC",TIMESTAMP_ASC:"TIMESTAMP_ASC"},TextItemContentType:{PLAIN:"PLAIN",RICH:"RICH"},TextItemState:{CREATED:"CREATED",EDITED:"EDITED",DELETED:"DELETED",CLUSTERED:"CLUSTERED"},SystemItemType:{CONVERSATION_CREATED:"CONVERSATION_CREATED",PARTICIPANT_ADDED:"PARTICIPANT_ADDED",PARTICIPANT_REMOVED:"PARTICIPANT_REMOVED",CONVERSATION_RENAMED:"CONVERSATION_RENAMED",GUEST_JOINED:"GUEST_JOINED",GUEST_INVITED:"GUEST_INVITED",CONFERENCE_DETAILS_CHANGED:"CONFERENCE_DETAILS_CHANGED",CONVERSATION_MODERATED:"CONVERSATION_MODERATED"},AttachmentOrderType:{CREATION:"CREATION",FILENAME:"FILENAME",SIZE:"SIZE",MIMETYPE:"MIMETYPE",FILEEXTENSION:"FILEEXTENSION"},AttachmentOrderDirection:{ASC:"ASC",DSC:"DSC"},BridgeLocale:{EN_US:"EN_US",EN_GB:"EN_GB",DE_DE:"DE_DE",ES_ES:"ES_ES",FR_FR:"FR_FR",IT_IT:"IT_IT",RU_RU:"RU_RU",ZH_HANS_CN:"ZH_HANS_CN"},BridgeNumberType:{TOLL:"TOLL",TOLL_FREE:"TOLL_FREE",LOCAL:"LOCAL"},FilterTarget:{CONVERSATION_TYPE:"CONVERSATION_TYPE",LABEL_ID:"LABEL_ID"},FilterTargetComparator:{EQ:"EQ",NOT:"NOT"},FilterBoolConnector:{AND:"AND",OR:"OR"},SystemLabel:{ARCHIVED:"ARCHIVED"},IncludedUserData:{LAST_READ_TS:"LASTREADTS",UNREAD_COUNT:"UNREADCOUNT",LABEL_IDS:"LABELIDS",SYSTEM_LABEL_IDS:"SYSTEMLABELIDS"},ChangedUserData:{LAST_READ_TS:"LASTREADTS",LABEL_IDS:"LABELIDS",SYSTEM_LABEL_IDS:"SYSTEMLABELIDS"},InstrumentationActionType:{SUBMIT_CLIENT_DATA:"SUBMIT_CLIENT_DATA",SUBMIT_QOS_DATA:"SUBMIT_QOS_DATA"},SubmitDataResult:{UNKNOWN:"UNKNOWN",OK:"OK",NO_USERID:"NO_USERID",NO_CLIENTID:"NO_CLIENTID",NO_DATA:"NO_DATA",PROCESSING_ERROR:"PROCESSING_ERROR"},QOSMediaType:{AUDIO:"AUDIO",VIDEO:"VIDEO",SCREEN_SHARE:"SCREEN_SHARE"},RTCCallActionType:{JOIN:"JOIN",ANSWER:"ANSWER",ICE_CANDIDATES:"ICE_CANDIDATES",LEAVE:"LEAVE",TERMINATE:"TERMINATE",CHANGE_MEDIA_TYPE:"CHANGE_MEDIA_TYPE",INVITE_REJECT:"INVITE_REJECT",CHANGE_MEDIA_ACCEPT:"CHANGE_MEDIA_ACCEPT",CHANGE_MEDIA_REJECT:"CHANGE_MEDIA_REJECT",PREPARE:"PREPARE",RENEW_TURN_CREDENTIALS:"RENEW_TURN_CREDENTIALS",SEND_PROGRESS:"SEND_PROGRESS",SUBMIT_RTC_QUALITY_RATING:"SUBMIT_RTC_QUALITY_RATING"},RTCCallEventType:{SDP_ANSWER:"SDP_ANSWER",SDP_FAILED:"SDP_FAILED",INVITE:"INVITE",INVITE_CANCEL:"INVITE_CANCEL",INVITE_FAILED:"INVITE_FAILED",CHANGE_MEDIA_TYPE_REQUESTED:"CHANGE_MEDIA_TYPE_REQUESTED",PROGRESS:"PROGRESS",CHANGE_MEDIA_TYPE_FORCED:"CHANGE_MEDIA_TYPE_FORCED",ICE_CANDIDATES:"ICE_CANDIDATES",RTC_QUALITY_RATING_EVENT:"RTC_QUALITY_RATING_EVENT"},SdpFailedCause:{SESSION_STARTED_FAILED:"SESSION_STARTED_FAILED",CONNECTION_LOST:"CONNECTION_LOST",SERVICE_ERROR:"SERVICE_ERROR",CHANGE_MEDIA_REJECT:"CHANGE_MEDIA_REJECT",JOIN_FORBIDDEN:"JOIN_FORBIDDEN",SESSION_TERMINATED:"SESSION_TERMINATED",MAX_PARTICIPANTS_REACHED:"MAX_PARTICIPANTS_REACHED"},InviteCancelCause:{ACCEPT:"ACCEPT",BUSY:"BUSY",DECLINE:"DECLINE",REVOKED:"REVOKED"},InviteFailedCause:{BUSY:"BUSY",DECLINE:"DECLINE",TIMEOUT:"TIMEOUT",NOT_REACHABLE:"NOT_REACHABLE",INVALID_NUMBER:"INVALID_NUMBER",TEMPORARILY_UNAVAILABLE:"TEMPORARILY_UNAVAILABLE",REVOKED:"REVOKED"},InviteRejectCause:{BUSY:"BUSY",DECLINE:"DECLINE",TIMEOUT:"TIMEOUT"},RTCProgressType:{ALERTING:"ALERTING",PROGRESS:"PROGRESS",EARLY_CONNECT:"EARLY_CONNECT"},DisconnectCause:{HANGUP:"HANGUP",CONNECTION_LOST:"CONNECTION_LOST",NEGOTIATION_FAILED:"NEGOTIATION_FAILED",TRANSPORT_NEGOTIATION_FAILED:"TRANSPORT_NEGOTIATION_FAILED",SECURITY_NEGOTIATION_FAILED:"SECURITY_NEGOTIATION_FAILED",REMOTE_SDP_FAILED:"REMOTE_SDP_FAILED",STREAM_LOST:"STREAM_LOST",CALL_SETUP_FAILED:"CALL_SETUP_FAILED"},DisconnectReason:{PAGE_UNLOADED:"PAGE_UNLOADED",CALL_LOST:"CALL_LOST",LOGOUT:"LOGOUT"},RTCSessionActionType:{LOCK:"LOCK",MUTE_SESSION:"MUTE_SESSION",MUTE:"MUTE",ADD_PARTICIPANT:"ADD_PARTICIPANT",REMOVE_PARTICIPANT:"REMOVE_PARTICIPANT",GET_ACTIVE_SESSIONS:"GET_ACTIVE_SESSIONS",GET_SESSION:"GET_SESSION",MOVE:"MOVE",START_RECORDING:"START_RECORDING",STOP_RECORDING:"STOP_RECORDING",RAISE_QUESTION:"RAISE_QUESTION",INVITE_TO_STAGE:"INVITE_TO_STAGE",INVITE_TO_STAGE_ANSWER:"INVITE_TO_STAGE_ANSWER",UPDATE_QUESTION_STATE:"UPDATE_QUESTION_STATE",INVITE_TO_STAGE_CANCEL:"INVITE_TO_STAGE_CANCEL",REMOVE_FROM_STAGE:"REMOVE_FROM_STAGE",GET_QUESTIONS:"GET_QUESTIONS",OPEN_CURTAIN:"OPEN_CURTAIN",CLOSE_CURTAIN:"CLOSE_CURTAIN",GET_NODE_STATE:"GET_NODE_STATE",ENABLE_WHITEBOARD:"ENABLE_WHITEBOARD",DISABLE_WHITEBOARD:"DISABLE_WHITEBOARD",ADD_WHITEBOARD_ELEMENT:"ADD_WHITEBOARD_ELEMENT",REMOVE_WHITEBOARD_ELEMENT:"REMOVE_WHITEBOARD_ELEMENT",UPDATE_WHITEBOARD_ELEMENT:"UPDATE_WHITEBOARD_ELEMENT",CLEAR_WHITEBOARD:"CLEAR_WHITEBOARD",GET_WHITEBOARD:"GET_WHITEBOARD",SEND_CLIENT_INFO:"SEND_CLIENT_INFO"},RTCSessionEventType:{SESSION_STARTED:"SESSION_STARTED",SESSION_TERMINATED:"SESSION_TERMINATED",SESSION_UPDATED:"SESSION_UPDATED",SESSION_MOVED:"SESSION_MOVED",PARTICIPANT_JOINED:"PARTICIPANT_JOINED",PARTICIPANT_LEFT:"PARTICIPANT_LEFT",PARTICIPANT_UPDATED:"PARTICIPANT_UPDATED",ACTIVE_SPEAKER:"ACTIVE_SPEAKER",VIDEO_ACTIVE_SPEAKER:"VIDEO_ACTIVE_SPEAKER",SESSION_RECORDING_INFO:"SESSION_RECORDING_INFO",SESSION_RECORDING_STARTED:"SESSION_RECORDING_STARTED",SESSION_RECORDING_STOPPED:"SESSION_RECORDING_STOPPED",SESSION_RECORDING_FAILED:"SESSION_RECORDING_FAILED",SESSION_TERMINATION_TIMER_STARTED:"SESSION_TERMINATION_TIMER_STARTED",SESSION_TERMINATION_TIMER_CANCELLED:"SESSION_TERMINATION_TIMER_CANCELLED",SESSION_ATTRIBUTES_CHANGED_EVENT:"SESSION_ATTRIBUTES_CHANGED_EVENT",QUESTION_EVENT:"QUESTION_EVENT",INVITE_TO_STAGE_EVENT:"INVITE_TO_STAGE_EVENT",INVITE_TO_STAGE_CANCEL_EVENT:"INVITE_TO_STAGE_CANCEL_EVENT",CURTAIN_EVENT:"CURTAIN_EVENT",WHITEBOARD_ENABLED:"WHITEBOARD_ENABLED",WHITEBOARD_DISABLED:"WHITEBOARD_DISABLED",WHITEBOARD_ELEMENT_ADDED:"WHITEBOARD_ELEMENT_ADDED",WHITEBOARD_ELEMENT_REMOVED:"WHITEBOARD_ELEMENT_REMOVED",WHITEBOARD_ELEMENT_UPDATED:"WHITEBOARD_ELEMENT_UPDATED",WHITEBOARD_CLEARED:"WHITEBOARD_CLEARED"},RTCSessionTerminatedCause:{FORCED:"FORCED",NO_USERS_LEFT:"NO_USERS_LEFT",CONDITIONAL:"CONDITIONAL"},RTCSessionParticipantLeftCause:{LEFT:"LEFT",CONNECTION_LOST:"CONNECTION_LOST",REMOVED:"REMOVED",CONDITIONAL_TERMINATE:"CONDITIONAL_TERMINATE",FORCED_TERMINATE:"FORCED_TERMINATE",MAX_PARTICIPANTS_REACHED:"MAX_PARTICIPANTS_REACHED",USER_LEFT_STAGE:"USER_LEFT_STAGE",NEGOTIATION_FAILED:"NEGOTIATION_FAILED",OFFER_NOT_ACCEPTED:"OFFER_NOT_ACCEPTED",STREAM_LOST:"STREAM_LOST",TRANSPORT_NEGOTIATION_FAILED:"TRANSPORT_NEGOTIATION_FAILED",SECURITY_NEGOTIATION_FAILED:"SECURITY_NEGOTIATION_FAILED",CALL_SETUP_FAILED:"CALL_SETUP_FAILED",REMOTE_SDP_FAILED:"REMOTE_SDP_FAILED"},RealtimeMediaType:{AUDIO:"AUDIO",VIDEO:"VIDEO",DESKTOP_SHARING:"DESKTOP_SHARING"},RTCParticipantType:{USER:"USER",EXTERNAL:"EXTERNAL",TELEPHONY:"TELEPHONY",SESSION_GUEST:"SESSION_GUEST",MEETING_POINT:"MEETING_POINT"},QuestionState:{RAISED:"RAISED",ANSWERED:"ANSWERED",DISCARDED:"DISCARDED",ANSWER_LATER:"ANSWER_LATER"},StageState:{INITIAL:"INITIAL",INVITED:"INVITED",REJECTED:"REJECTED",ACCEPTED:"ACCEPTED",WAS_ON_STAGE:"WAS_ON_STAGE",TIMEOUT:"TIMEOUT",LEFT_CONFERENCE:"LEFT_CONFERENCE"},QuestionEventType:{CREATED:"CREATED",UPDATED:"UPDATED",REVOKED:"REVOKED"},StageAction:{USER_ENTERED_STAGE:"USER_ENTERED_STAGE",USER_LEFT_STAGE:"USER_LEFT_STAGE"},CurtainState:{OPEN:"OPEN",INITIAL:"INITIAL",FINAL:"FINAL",PAUSED:"PAUSED"},NodeType:{MEDIA_ACCESS:"MEDIA_ACCESS",APPLICATION:"APPLICATION",STORAGE:"STORAGE",ACCESS:"ACCESS",LOAD_BALANCER:"LOAD_BALANCER",ZOOKEEPER:"ZOOKEEPER",MANAGEMENT:"MANAGEMENT",OPERATIONS:"OPERATIONS"},NodeState:{UP:"UP",DOWN:"DOWN",OVERLOAD:"OVERLOAD",MAINTENANCE:"MAINTENANCE"},RecordingInfoState:{INITIAL:"INITIAL",START_PENDING:"START_PENDING",STARTED:"STARTED",STOPPED:"STOPPED",FINISHED:"FINISHED"},RecordingInfoReason:{NONE:"NONE",STOPPED_MANUALLY:"STOPPED_MANUALLY",STOPPED_AUTOMATICALLY:"STOPPED_AUTOMATICALLY",NO_INPUT_TIMEOUT:"NO_INPUT_TIMEOUT",MAX_INPUT_TIMEOUT:"MAX_INPUT_TIMEOUT",NO_STREAMING_DATA:"NO_STREAMING_DATA",LENGTH_LIMIT_REACHED:"LENGTH_LIMIT_REACHED",NO_MORE_DISK_SPACE_LEFT:"NO_MORE_DISK_SPACE_LEFT",UNKNOWN_ERROR:"UNKNOWN_ERROR"},RecordingTriggerReason:{USER:"USER",CURTAIN:"CURTAIN"},RtcClientInfoType:{OFFLINE_JOIN_FAILURE:"OFFLINE_JOIN_FAILURE",DEVICE_DIAGNOSTICS:"DEVICE_DIAGNOSTICS"},RtcActionInfoType:{REQUEST_RESPONSE:"REQUEST_RESPONSE",EVENT:"EVENT"},RtcDiagnosticsAction:{RENEW_TURN_CREDENTIALS:"RENEW_TURN_CREDENTIALS",PREPARE:"PREPARE",JOIN:"JOIN",ICE_CANDIDATES:"ICE_CANDIDATES",SDP_CONNECTED:"SDP_CONNECTED",SDP_ANSWER:"SDP_ANSWER",REMOTE_ICE_CANDIDATES:"REMOTE_ICE_CANDIDATES"},RtcClientInfoReason:{DISCONNECTED:"DISCONNECTED",FAILED_TO_SEND:"FAILED_TO_SEND",REQUEST_TIMEOUT:"REQUEST_TIMEOUT",JOIN_DELAY:"JOIN_DELAY"},SearchActionType:{START_BASIC_SEARCH:"START_BASIC_SEARCH",START_DETAIL_SEARCH:"START_DETAIL_SEARCH",START_USER_SEARCH:"START_USER_SEARCH",CANCEL_SEARCH:"CANCEL_SEARCH",ADD_RECENT_SEARCH:"ADD_RECENT_SEARCH",GET_RECENT_SEARCHES:"GET_RECENT_SEARCHES",
SEARCH_CONVERSATION_PARTICIPANTS:"SEARCH_CONVERSATION_PARTICIPANTS"},SearchEventType:{BASIC_SEARCH_RESULT:"BASIC_SEARCH_RESULT",DETAILED_SEARCH_RESULT:"DETAILED_SEARCH_RESULT",SEARCH_STATUS:"SEARCH_STATUS",RECENT_SEARCH_ADDED:"RECENT_SEARCH_ADDED"},SystemActionType:{GET_GLOBAL_PROPERTY:"GET_GLOBAL_PROPERTY",GET_GLOBAL_PROPERTIES:"GET_GLOBAL_PROPERTIES"},SystemEventType:{MAINTENANCE:"MAINTENANCE",CLIENT_UPDATE:"CLIENT_UPDATE"},GlobalPropertyName:{ATTACHMENT_UPLOAD_MAX_SIZE:"ATTACHMENT_UPLOAD_MAX_SIZE",CONV_PARTICIPANTS_MAX_SIZE:"CONV_PARTICIPANTS_MAX_SIZE",CONV_PARTICIPANTS_ADD_LIMIT:"CONV_PARTICIPANTS_ADD_LIMIT",XMPP_FEDERATION_ENABLED:"XMPP_FEDERATION_ENABLED",CLIENT_AUTOUPDATE_MAX_TIME:"CLIENT_AUTOUPDATE_MAX_TIME"},SearchTypes:{CONVERSATION:"CONVERSATION",USER:"USER"},SearchStatusCode:{ERROR:"ERROR",CANCELED:"CANCELED",FINISHED:"FINISHED",TIMEOUT:"TIMEOUT",NO_RESULT:"NO_RESULT",MORE_RESULT:"MORE_RESULT"},SearchResultType:{TOPIC_MATCH:"TOPIC_MATCH",USER_MATCH:"USER_MATCH",ATTACHMENT_MATCH:"ATTACHMENT_MATCH",ITEM_MATCH:"ITEM_MATCH"},SearchScope:{ALL:"ALL",PEOPLE:"PEOPLE",MEMBERS:"MEMBERS",MESSAGES:"MESSAGES",CONVERSATIONS:"CONVERSATIONS",FILES:"FILES",SENT_BY:"SENT_BY",DATE:"DATE",LABEL:"LABEL",FILTER:"FILTER"},UserActionType:{WAKE_UP:"WAKE_UP",GO_TO_SLEEP:"GO_TO_SLEEP",LOGON:"LOGON",LOGOUT:"LOGOUT",RENEW_TOKEN:"RENEW_TOKEN",GET_USER_BY_ID:"GET_USER_BY_ID",UPDATE:"UPDATE",GET_LOGGED_ON:"GET_LOGGED_ON",GET_STUFF:"GET_STUFF",SET_PRESENCE:"SET_PRESENCE",GET_PRESENCE:"GET_PRESENCE",SUBSCRIBE_PRESENCE:"SUBSCRIBE_PRESENCE",UNSUBSCRIBE_PRESENCE:"UNSUBSCRIBE_PRESENCE",CHANGE_PASSWORD:"CHANGE_PASSWORD",GET_USERS_BY_IDS:"GET_USERS_BY_IDS",GET_DEVICES:"GET_DEVICES",GET_USER_SETTINGS:"GET_USER_SETTINGS",SET_USER_SETTINGS:"SET_USER_SETTINGS",GET_USER_BY_MAIL:"GET_USER_BY_MAIL",GET_USERS_BY_MAILS:"GET_USERS_BY_MAILS",EMAIL_UPDATE:"EMAIL_UPDATE",GENERATE_EMAIL_UPDATE_TOKEN:"GENERATE_EMAIL_UPDATE_TOKEN",GET_TELEPHONY_DATA:"GET_TELEPHONY_DATA",GET_USER_EXTENSIONS:"GET_USER_EXTENSIONS",SET_USER_EXTENSION_STATE:"SET_USER_EXTENSION_STATE",GET_LDAP_TECHNICAL_USER_PRESENCE:"GET_LDAP_TECHNICAL_USER_PRESENCE",GET_ATTACHMENTS:"GET_ATTACHMENTS",SET_PASSWORD:"SET_PASSWORD",GET_TENANT_SETTINGS:"GET_TENANT_SETTINGS",SUBSCRIBE_DEVICES:"SUBSCRIBE_DEVICES",UNSUBSCRIBE_DEVICES:"UNSUBSCRIBE_DEVICES",OAUTH_GET_GRANTED_ACCESS_TOKENS:"OAUTH_GET_GRANTED_ACCESS_TOKENS",OAUTH_REVOKE_ACCESS_TOKEN:"OAUTH_REVOKE_ACCESS_TOKEN",REVOKE_MANAGED_DEVICES:"REVOKE_MANAGED_DEVICES",GET_SECURITY_TOKEN_INFO:"GET_SECURITY_TOKEN_INFO",REVOKE_SECURITY_TOKEN:"REVOKE_SECURITY_TOKEN"},UserEventType:{ATC_REFRESH_FAILED:"ATC_REFRESH_FAILED",USER_PRESENCE_CHANGE:"USER_PRESENCE_CHANGE",USER_UPDATED:"USER_UPDATED",SESSION_EXPIRES:"SESSION_EXPIRES",SESSION_EXPIRING:"SESSION_EXPIRING",SESSION_CLOSED:"SESSION_CLOSED",PASSWORD_CHANGED:"PASSWORD_CHANGED",USER_SETTING_UPDATED:"USER_SETTING_UPDATED",TELEPHONY_DATA:"TELEPHONY_DATA",DEVICE_LIST_CHANGED:"DEVICE_LIST_CHANGED",NOTIFICATION_SUBSCRIPTION_CHANGE:"NOTIFICATION_SUBSCRIPTION_CHANGE"},GetStuffType:{USER:"USER",ACCOUNTS:"ACCOUNTS",FIRST_WEB_LOGIN:"FIRST_WEB_LOGIN",PRESENCE_STATE:"PRESENCE_STATE",RECENT_SEARCHES:"RECENT_SEARCHES",SETTINGS:"SETTINGS",TENANT_DATA:"TENANT_DATA",SUPPORT_CONVERSATION_ID:"SUPPORT_CONVERSATION_ID",TELEPHONY_CONVERSATION_ID:"TELEPHONY_CONVERSATION_ID",GLOBAL_PROPERTIES:"GLOBAL_PROPERTIES",TENANT:"TENANT",NOTIFICATION_SUBSCRIPTIONS:"NOTIFICATION_SUBSCRIPTIONS"},NotificationSubscriptionType:{ONLINE_STATUS:"ONLINE_STATUS"},NotificationSubscriptionAction:{SUBSCRIBE:"SUBSCRIBE",UNSUBSCRIBE:"UNSUBSCRIBE"},DeviceType:{PHONE:"PHONE",WEB:"WEB",APPLICATION:"APPLICATION",MOBILE:"MOBILE",SDK:"SDK"},PresenceState:{AVAILABLE:"AVAILABLE",OFFLINE:"OFFLINE",AWAY:"AWAY",BUSY:"BUSY",DND:"DND"},ChangePasswordResult:{OK:"OK",NEW_INVALID:"NEW_INVALID",OLD_INVALID:"OLD_INVALID",ALREADY_CHANGED:"ALREADY_CHANGED",OPERATION_ERROR:"OPERATION_ERROR"},SetPasswordResult:{OK:"OK",NOT_OK:"NOT_OK"},SessionClosedReason:{NEW_CONNECTION_DETECTED:"NEW_CONNECTION_DETECTED",UPGRADE_REQUIRED:"UPGRADE_REQUIRED",SUSPENDED:"SUSPENDED",DELETED:"DELETED",TENANT_DELETED:"TENANT_DELETED",TENANT_SUSPENDED:"TENANT_SUSPENDED"},RecordingStoppedReason:{LENGTH_LIMIT_REACHED:"LENGTH_LIMIT_REACHED",NO_INPUT:"NO_INPUT"},RecordingUploadState:{IN_PROGRESS:"IN_PROGRESS",RETRYING:"RETRYING",FINISHED:"FINISHED",FAILED:"FAILED",DELETED:"DELETED"},UserRole:{GUEST:"GUEST",USER:"USER",TENANT_ADMIN:"TENANT_ADMIN",SUPPORT:"SUPPORT",SYSTEM_ADMIN:"SYSTEM_ADMIN",TELEPHONY_CONNECTOR:"TELEPHONY_CONNECTOR",VIRTUAL_TELEPHONY_CONNECTOR:"VIRTUAL_TELEPHONY_CONNECTOR",SESSION_GUEST:"SESSION_GUEST",MEETING_POINT:"MEETING_POINT",BOT:"BOT"},UserType:{REGULAR:"REGULAR",GUEST:"GUEST",SUPPORT:"SUPPORT",TELEPHONY:"TELEPHONY",SESSION_GUEST:"SESSION_GUEST",MEETING_POINT:"MEETING_POINT",TECHNICAL:"TECHNICAL",BOT:"BOT",XMPP:"XMPP"},UserState:{INACTIVE:"INACTIVE",ACTIVE:"ACTIVE",SUSPENDED:"SUSPENDED",DELETED:"DELETED",PURGED:"PURGED"},Locale:{EN_US:"EN_US",DE_DE:"DE_DE",ES_ES:"ES_ES",FR_FR:"FR_FR",IT_IT:"IT_IT",RU_RU:"RU_RU",ZH_HANS_CN:"ZH_HANS_CN"},PhoneNumberType:{WORK:"WORK",MOBILE:"MOBILE",HOME:"HOME",FAX:"FAX",OTHER:"OTHER",UCAAS:"UCAAS"},PhoneNumberNpi:{PUBLIC:"PUBLIC",PRIVATE:"PRIVATE"},EmailAddressType:{WORK:"WORK",HOME:"HOME",OTHER:"OTHER"},UserSettingArea:{ALL:"ALL",EMAIL:"EMAIL",DESKTOP:"DESKTOP",PRIVACY:"PRIVACY",CLIENT:"CLIENT"},UserSettingDataType:{BOOLEAN:"BOOLEAN",NUMBER:"NUMBER",STRING:"STRING",TIMESTAMP:"TIMESTAMP"},UserSettingKey:{EMAIL_INVITES:"EMAIL_INVITES",EMAIL_MISSED_RTC:"EMAIL_MISSED_RTC",EMAIL_SUMMARY:"EMAIL_SUMMARY",EMAIL_UPDATE:"EMAIL_UPDATE",DESKTOP_RTC:"DESKTOP_RTC",DESKTOP_MISSED_MESSAGE:"DESKTOP_MISSED_MESSAGE",DESKTOP_CONVERSATION_CHANGE:"DESKTOP_CONVERSATION_CHANGE",DESKTOP_SYSINFO:"DESKTOP_SYSINFO",SHARE_LOCATION:"SHARE_LOCATION",RELEASE_NOTES_WEB_VERSION:"RELEASE_NOTES_WEB_VERSION",RELEASE_NOTES_MOBILE_VERSION:"RELEASE_NOTES_MOBILE_VERSION",TM_WEB_START_CONV_WITH:"TM_WEB_START_CONV_WITH",TM_WEB_ENTER_NAME:"TM_WEB_ENTER_NAME",TM_WEB_CALL_ACTION_BUTTONS:"TM_WEB_CALL_ACTION_BUTTONS",TM_WEB_SUPPORT_FEEDBACK:"TM_WEB_SUPPORT_FEEDBACK",TM_WEB_SUPPORT_ISSUE:"TM_WEB_SUPPORT_ISSUE",TM_WEB_SCREEN_SHARING_ENABLED:"TM_WEB_SCREEN_SHARING_ENABLED",TM_WEB_SEARCH_FILTER:"TM_WEB_SEARCH_FILTER",AUDIO_WEB_SOUNDS:"AUDIO_WEB_SOUNDS",TM_WEB_OPEN_CONVERSATION:"TM_WEB_OPEN_CONVERSATION",TM_WEB_ADD_CONVERSATION_TITLE:"TM_WEB_ADD_CONVERSATION_TITLE",TM_WEB_RICH_TEXT_EDITING:"TM_WEB_RICH_TEXT_EDITING",TM_WEB_MUTE_CONVERSATION:"TM_WEB_MUTE_CONVERSATION",TM_WEB_VIEW_MUTED_CONVERSATIONS:"TM_WEB_VIEW_MUTED_CONVERSATIONS",TM_WEB_LEAVING_CONVERSATION:"TM_WEB_LEAVING_CONVERSATION",TM_WEB_FOCUS_MODE:"TM_WEB_FOCUS_MODE",TM_WEB_CONFERENCE_DIAL_IN:"TM_WEB_CONFERENCE_DIAL_IN",TM_WEB_REMOVING_PARTICIPANTS:"TM_WEB_REMOVING_PARTICIPANTS",TM_WEB_FULL_SCREEN_MODES:"TM_WEB_FULL_SCREEN_MODES",TM_WEB_ADD_MULTIPLE_USERS:"TM_WEB_ADD_MULTIPLE_USERS",TM_WEB_THIRD_COLUMN:"TM_WEB_THIRD_COLUMN",TM_WEB_RESERVE_1:"TM_WEB_RESERVE_1",TM_WEB_RESERVE_2:"TM_WEB_RESERVE_2",TM_IOS_SEARCH:"TM_IOS_SEARCH",MOBILE_ENABLE_VIDEO_WIFI_ONLY:"MOBILE_ENABLE_VIDEO_WIFI_ONLY",TM_WEB_ADMIN_TELEPHONY_ENABLED:"TM_WEB_ADMIN_TELEPHONY_ENABLED",TM_WEB_TELPHONY_NUMBER_ASSIGNED:"TM_WEB_TELPHONY_NUMBER_ASSIGNED",TM_WEB_ACTIVE_SPEAKER_VIDEO:"TM_WEB_ACTIVE_SPEAKER_VIDEO",TM_WEB_FIRST_DIRECT_CONVERSATION:"TM_WEB_FIRST_DIRECT_CONVERSATION",TM_WEB_FIRST_GROUP_CONVERSATION:"TM_WEB_FIRST_GROUP_CONVERSATION",TM_WEB_FIRST_CONV_ADD_PARTCPNTS:"TM_WEB_FIRST_CONV_ADD_PARTCPNTS",TM_WEB_FIRST_CONV_SET_NAME:"TM_WEB_FIRST_CONV_SET_NAME",TM_WEB_FIRST_CONV_START_CONV:"TM_WEB_FIRST_CONV_START_CONV",TM_WEB_INVITE_USERS:"TM_WEB_INVITE_USERS",TM_WEB_EMERGENCY_CALL_DISCLAIMER:"TM_WEB_EMERGENCY_CALL_DISCLAIMER",TM_WEB_FIRST_DIRECT_PRIVATE_CONV:"TM_WEB_FIRST_DIRECT_PRIVATE_CONV",TM_WEB_FIRST_DIRECT_CONV_SAY_HI:"TM_WEB_FIRST_DIRECT_CONV_SAY_HI",TM_WEB_FIRST_DIRECT_CONV_ADD:"TM_WEB_FIRST_DIRECT_CONV_ADD",TM_WEB_GUEST_ACCESS:"TM_WEB_GUEST_ACCESS",TM_WEB_SHARE_CONFERENCE_DETAILS:"TM_WEB_SHARE_CONFERENCE_DETAILS",TM_WEB_START_RECORDING:"TM_WEB_START_RECORDING",TM_WEB_STOP_RECORDING_INIT:"TM_WEB_STOP_RECORDING_INIT",TM_WEB_STOP_RECORDING_PART:"TM_WEB_STOP_RECORDING_PART",TM_WEB_FIRST_CONF_RING_ALL:"TM_WEB_FIRST_CONF_RING_ALL",TM_WEB_FIRST_CALL_ACTIONS:"TM_WEB_FIRST_CALL_ACTIONS",TM_WEB_FIRST_CALL_GO_TO_FEED:"TM_WEB_FIRST_CALL_GO_TO_FEED",TM_WEB_FIRST_CALL_FULLSCREEN:"TM_WEB_FIRST_CALL_FULLSCREEN",FIRST_WEB_LOGIN_TIMESTAMP:"FIRST_WEB_LOGIN_TIMESTAMP",VOICEMAIL_ENABLED:"VOICEMAIL_ENABLED",VOICEMAIL_TIMEOUT:"VOICEMAIL_TIMEOUT",STATUS_MESSAGE_TEXT:"STATUS_MESSAGE_TEXT",OPT_OUT_PRESENCE:"OPT_OUT_PRESENCE",SECOND_TELEPHONY_CALL_ROUTING:"SECOND_TELEPHONY_CALL_ROUTING",ATC_ROUTING:"ATC_ROUTING",VOICEMAIL_CUSTOMGREETING_ENABLED:"VOICEMAIL_CUSTOMGREETING_ENABLED",VOICEMAIL_CUSTOMGREETING_URI:"VOICEMAIL_CUSTOMGREETING_URI",DESKTOP_MESSAGE_NOTIFICATIONS_SETTING:"DESKTOP_MESSAGE_NOTIFICATIONS_SETTING",MOBILE_MESSAGE_NOTIFICATIONS_SETTING:"MOBILE_MESSAGE_NOTIFICATIONS_SETTING",PLAY_SOUND_MESSAGE_NOTIFICATIONS:"PLAY_SOUND_MESSAGE_NOTIFICATIONS",PLAY_SOUND_RTC:"PLAY_SOUND_RTC",PLAY_SYSTEM_SOUNDS:"PLAY_SYSTEM_SOUNDS"},OAuthScope:{ALL:"ALL",CALLS:"CALLS",READ_CONVERSATIONS:"READ_CONVERSATIONS",READ_USER:"READ_USER",READ_USER_PROFILE:"READ_USER_PROFILE",WRITE_CONVERSATIONS:"WRITE_CONVERSATIONS",WRITE_USER_PROFILE:"WRITE_USER_PROFILE"},OAuthGrantTypes:{AUTHORIZATION_CODE:"AUTHORIZATION_CODE",IMPLICIT:"IMPLICIT",CLIENT_CREDENTIALS:"CLIENT_CREDENTIALS",RESOURCE_OWNER_CREDENTIALS:"RESOURCE_OWNER_CREDENTIALS",RESOURCE_OWNER:"RESOURCE_OWNER"},MessageNotificationsSetting:{ALL:0,DIRECT_AND_MENTIONS:1,NONE:2},AdministrationActionType:{INVITE_USER:"INVITE_USER",ADD_USER:"ADD_USER",INVITE_MULTIPLE_USERS:"INVITE_MULTIPLE_USERS",DELETE_USER:"DELETE_USER",VALIDATE_USER_INVITATION_TOKEN:"VALIDATE_USER_INVITATION_TOKEN",ACTIVATE_INVITED_USER:"ACTIVATE_INVITED_USER",RESEND_USER_INVITATION:"RESEND_USER_INVITATION",CHECK_INVALID_TENANTS:"CHECK_INVALID_TENANTS",GET_TENANT:"GET_TENANT",GET_SHARED_KEY:"GET_SHARED_KEY",EXPORT_TENANT:"EXPORT_TENANT",GET_ALL_TENANT_LOGIN_PROVIDERS:"GET_ALL_TENANT_LOGIN_PROVIDERS",UPLOAD_EXTENSION_CONFIGURATION:"UPLOAD_EXTENSION_CONFIGURATION",GET_TENANT_EXTENSIONS:"GET_TENANT_EXTENSIONS",SET_EXTENSION_STATE:"SET_EXTENSION_STATE",DELETE_EXTENSION:"DELETE_EXTENSION",REGENERATE_API_KEY:"REGENERATE_API_KEY",SET_TELEPHONY_TRUNK_DATA:"SET_TELEPHONY_TRUNK_DATA",GET_TELEPHONY_TRUNK_STATUS:"GET_TELEPHONY_TRUNK_STATUS",GET_TENANT_BRIDGE_NUMBERS:"GET_TENANT_BRIDGE_NUMBERS",SET_TENANT_BRIDGE_NUMBERS:"SET_TENANT_BRIDGE_NUMBERS",ADD_TRUNK:"ADD_TRUNK",GET_TENANT_TELEPHONY_CONFIGURATION:"GET_TENANT_TELEPHONY_CONFIGURATION",ADD_TRUNK_WITHOUT_PARAMETERS:"ADD_TRUNK_WITHOUT_PARAMETERS",SET_TRUNK_PASSWORD:"SET_TRUNK_PASSWORD",GET_TELEPHONY_ROUTING_RULES:"GET_TELEPHONY_ROUTING_RULES",ADD_TELEPHONY_ROUTING_RULE:"ADD_TELEPHONY_ROUTING_RULE",UPDATE_TELEPHONY_ROUTING_RULE:"UPDATE_TELEPHONY_ROUTING_RULE",REMOVE_TELEPHONY_ROUTING_RULE:"REMOVE_TELEPHONY_ROUTING_RULE",TEST_TELEPHONY_ROUTING_RULES:"TEST_TELEPHONY_ROUTING_RULES",UPDATE_TENANT_TELEPHONY_CONFIGURATION:"UPDATE_TENANT_TELEPHONY_CONFIGURATION",GET_TELEPHONY_TRUNK_GROUPS:"GET_TELEPHONY_TRUNK_GROUPS",GET_TELEPHONY_TRUNK_GROUP:"GET_TELEPHONY_TRUNK_GROUP",ADD_TELEPHONY_TRUNK_GROUP:"ADD_TELEPHONY_TRUNK_GROUP",REMOVE_TELEPHONY_TRUNK_GROUP:"REMOVE_TELEPHONY_TRUNK_GROUP",UPDATE_TELEPHONY_TRUNK_GROUP:"UPDATE_TELEPHONY_TRUNK_GROUP",SUSPEND_USER:"SUSPEND_USER",UNSUSPEND_USER:"UNSUSPEND_USER",ASSIGN_PHONE_NUMBER:"ASSIGN_PHONE_NUMBER",INVITE_MULTIPLE_PARTNER_USERS:"INVITE_MULTIPLE_PARTNER_USERS",ADD_MEETING_POINT:"ADD_MEETING_POINT",ADD_MEETING_POINT_V2:"ADD_MEETING_POINT_V2",UPDATE_MEETING_POINT_V2:"UPDATE_MEETING_POINT_V2",SET_TENANT_SETTINGS:"SET_TENANT_SETTINGS",UPDATE_TENANT:"UPDATE_TENANT",SAVE_TENANT_LOGIN_PROVIDER:"SAVE_TENANT_LOGIN_PROVIDER",UPDATE_TENANT_LOGIN_PROVIDER:"UPDATE_TENANT_LOGIN_PROVIDER",DELETE_TENANT_LOGIN_PROVIDER:"DELETE_TENANT_LOGIN_PROVIDER",GET_VACANT_HOME_DIRECTORY_NUMBERS:"GET_VACANT_HOME_DIRECTORY_NUMBERS",CREATE_OPENSCAPE_USER:"CREATE_OPENSCAPE_USER",UPDATE_OPENSCAPE_USER:"UPDATE_OPENSCAPE_USER",DELETE_OPENSCAPE_USER:"DELETE_OPENSCAPE_USER",GET_OPENSCAPE_USER:"GET_OPENSCAPE_USER",GET_OPENSCAPE_TENANT:"GET_OPENSCAPE_TENANT",DELETE_OPENSCAPE_SITES:"DELETE_OPENSCAPE_SITES",CREATE_OPENSCAPE_SITE:"CREATE_OPENSCAPE_SITE",GET_OPENSCAPE_SITE:"GET_OPENSCAPE_SITE",UPDATE_OPENSCAPE_SITE:"UPDATE_OPENSCAPE_SITE",DELETE_PUBLIC_NUMBER_RANGE:"DELETE_PUBLIC_NUMBER_RANGE",DELETE_PRIVATE_NUMBER_RANGE:"DELETE_PRIVATE_NUMBER_RANGE",GET_AUTOMATEDATTENDANT_CONFIGURATION:"GET_AUTOMATEDATTENDANT_CONFIGURATION",SET_AUTOMATEDATTENDANT_CONFIGURATION:"SET_AUTOMATEDATTENDANT_CONFIGURATION",GET_CUSTOM_APPS:"GET_CUSTOM_APPS",ADD_CUSTOM_APP:"ADD_CUSTOM_APP"},InvitationResponseCode:{INVITATION_SEND:"INVITATION_SEND",INVITATION_NOT_SEND:"INVITATION_NOT_SEND",INVALID_USER_STATE:"INVALID_USER_STATE",EMAIL_ALREADY_EXISTS:"EMAIL_ALREADY_EXISTS",ACCOUNT_ASSIGNMENT_FAILED:"ACCOUNT_ASSIGNMENT_FAILED",ERROR:"ERROR",SYSTEM_OVERLOADED:"SYSTEM_OVERLOADED",EMAIL_ALREADY_EXISTS_ON_SAME_TENANT:"EMAIL_ALREADY_EXISTS_ON_SAME_TENANT",UNTRUSTED_PARTNER_TENANT:"UNTRUSTED_PARTNER_TENANT",XMPP_FEDERATED_USER_NOT_FOUND:"XMPP_FEDERATED_USER_NOT_FOUND",LICENSE_LIMIT_EXCEEDED:"LICENSE_LIMIT_EXCEEDED",LICENSE_ERROR:"LICENSE_ERROR"},InvitationStatusCode:{RUNNING:"RUNNING",FINISHED:"FINISHED"},GetUsersOrdering:{ASCENDING:"ASCENDING",DESCENDING:"DESCENDING"},GetUsersSorting:{USER_NAME:"USER_NAME",DATA_USAGE:"DATA_USAGE",LAST_ACCESS:"LAST_ACCESS",ROLE:"ROLE",STATUS:"STATUS",PHONE_NUMBER_ASSIGNED:"PHONE_NUMBER_ASSIGNED",EMAIL:"EMAIL"},GetUsersSearchFor:{ROLE:"ROLE",STATUS:"STATUS",NAME:"NAME",PRIMARY_EMAIL:"PRIMARY_EMAIL"},SetRoleRole:{ADMIN:"ADMIN",USER:"USER"},ExportTenantFormat:{CSV:"CSV",JSON:"JSON"},AdministrationEventType:{INVITE_MULTIPLE_USERS:"INVITE_MULTIPLE_USERS",INVITE_MULTIPLE_PARTNER_USERS:"INVITE_MULTIPLE_PARTNER_USERS"},TenantSettingsType:{CREDENTIALS_LOGIN_ENABLED:"CREDENTIALS_LOGIN_ENABLED",HELP_URL:"HELP_URL",PLUGIN_SELF_MANAGED_ENABLED:"PLUGIN_SELF_MANAGED_ENABLED",EXTENSION_MICROSOFT_EXCHANGE_ENABLED:"EXTENSION_MICROSOFT_EXCHANGE_ENABLED",EXTENSION_SYNCPLICITY_ENABLED:"EXTENSION_SYNCPLICITY_ENABLED",EXTENSION_BOX_ENABLED:"EXTENSION_BOX_ENABLED",EXTENSION_GOOGLE_DRIVE_ENABLED:"EXTENSION_GOOGLE_DRIVE_ENABLED",EXTENSION_ONE_DRIVE_ENABLED:"EXTENSION_ONE_DRIVE_ENABLED",EXTENSION_JABRA_ENABLED:"EXTENSION_JABRA_ENABLED",EXTENSION_VDI_ENABLED:"EXTENSION_VDI_ENABLED",EXTENSION_PLANTRONICS_ENABLED:"EXTENSION_PLANTRONICS_ENABLED",EXTENSION_SKYPE_FOR_BUSINESS_ENABLED:"EXTENSION_SKYPE_FOR_BUSINESS_ENABLED",DT_LEGAL_INFORMATION:"DT_LEGAL_INFORMATION",SSO_REDIRECT_URL:"SSO_REDIRECT_URL",PHONE_DIALOUT_CALLER_ID_PREFIX:"PHONE_DIALOUT_CALLER_ID_PREFIX",PHONE_DIALOUT_MODE:"PHONE_DIALOUT_MODE",PHONE_DIALOUT_ENABLED:"PHONE_DIALOUT_ENABLED",SKYPE4B_CLIENT_ID:"SKYPE4B_CLIENT_ID",SKYPE4B_ROOT_URL:"SKYPE4B_ROOT_URL",DA_AUTO_UPDATE:"DA_AUTO_UPDATE",EXTENSION_SENNHEISER_ENABLED:"EXTENSION_SENNHEISER_ENABLED"},TenantConfigurableTextType:{GUEST_ACCESS_ACCEPTANCE_TEXT:"GUEST_ACCESS_ACCEPTANCE_TEXT",USER_INVITE_ACCEPTANCE_TEXT:"USER_INVITE_ACCEPTANCE_TEXT"},TrunkState:{UP:"UP",DOWN:"DOWN",NOT_REQUESTED:"NOT_REQUESTED",REQUESTED:"REQUESTED"},GtcTrunkType:{GTC_TRUNK_TYPE:"GTC_TRUNK_TYPE",ETC_TRUNK_TYPE:"ETC_TRUNK_TYPE",ATC_TRUNK_TYPE:"ATC_TRUNK_TYPE",EMBEDDED_TC_TRUNK_TYPE:"EMBEDDED_TC_TRUNK_TYPE",OSBIZ_TRUNK_TYPE:"OSBIZ_TRUNK_TYPE"},TelephonyRoutingRuleCriteria:{ORIGIN:"ORIGIN",DESTINATION:"DESTINATION"},TelephonyRoutingRuleOperator:{AND:"AND",OR:"OR"},TelephonyRoutingRuleApplication:{TELEPHONY:"TELEPHONY",CONF_DIAL_OUT:"CONF_DIAL_OUT",BOTH:"BOTH"},TelephonyConfigurationDefaultRouting:{ANY:"ANY",NONE:"NONE"},TelephonyRoutingRuleResult:{NO_MATCH:"NO_MATCH",MATCH:"MATCH",SELECTED:"SELECTED"},ProviderType:{CREDENTIALS:"CREDENTIALS",SAML:"SAML",OPENID:"OPENID"},PhoneDialoutMode:{PHONE_USERS_ONLY:"PHONE_USERS_ONLY",ALL_USERS:"ALL_USERS"},RemoveTrunkGroupResult:{SUCCESS:"SUCCESS",REFERENCES_EXIST:"REFERENCES_EXIST",UNKNOWN_ERROR:"UNKNOWN_ERROR"},ThirdPartyConnectorsActionType:{GET_SETTINGS:"GET_SETTINGS",SAVE_SETTINGS:"SAVE_SETTINGS",CONNECT:"CONNECT",DISCONNECT:"DISCONNECT",SEND_AUTH_CODE:"SEND_AUTH_CODE",GET_CONNECTION_STATUS:"GET_CONNECTION_STATUS",GET_FOLDER_ITEMS:"GET_FOLDER_ITEMS",SHARE_FOLDER_ITEMS:"SHARE_FOLDER_ITEMS",UNSHARE_FOLDER_ITEMS:"UNSHARE_FOLDER_ITEMS",GET_EDIT_URL:"GET_EDIT_URL",GET_FOLDER_ITEMS_WITH_CURSOR:"GET_FOLDER_ITEMS_WITH_CURSOR",CONNECT_STORAGE:"CONNECT_STORAGE",REFRESH_CONNECTION:"REFRESH_CONNECTION"},ThirdPartyConnectorType:{EXCHANGE_CONNECTOR:"EXCHANGE_CONNECTOR",BOX:"BOX",OPEN_XCHANGE:"OPEN_XCHANGE",GOOGLE_DRIVE:"GOOGLE_DRIVE",SYNCPLICITY:"SYNCPLICITY",ONE_DRIVE:"ONE_DRIVE",CLIENT_THIRDPARTY:"CLIENT_THIRDPARTY"},ThirdPartyEventType:{CONNECTED_TO_THIRDPARTY:"CONNECTED_TO_THIRDPARTY",DISCONNECTED_FROM_THIRDPARTY:"DISCONNECTED_FROM_THIRDPARTY"},ThirdPartyContentType:{SKYPE4B:"SKYPE4B"},Skype4BAuthentication:{BASIC:"BASIC",AZUREAD:"AZUREAD"},GuestActionType:{VALIDATE_SESSION_INVITE_TOKEN:"VALIDATE_SESSION_INVITE_TOKEN",REGISTER_SESSION_GUEST:"REGISTER_SESSION_GUEST"},SessionInviteInfoResult:{INVALID:"INVALID",VALID_NOSESSION:"VALID_NOSESSION",VALID_SESSION:"VALID_SESSION",VALID_NO_GUEST_ACCESS:"VALID_NO_GUEST_ACCESS"},UserRoutingMessageType:{ATC:"ATC",CMP:"CMP",CONTACT_CARD:"CONTACT_CARD",DESKTOP_APP:"DESKTOP_APP",MOBILE_BREAKOUT:"MOBILE_BREAKOUT",SDK:"SDK"},VersionActionType:{GET_VERSION:"GET_VERSION"},AccountActionType:{GET_PACKAGE_TEMPLATES:"GET_PACKAGE_TEMPLATES",GET_ASSIGNED_PACKAGES:"GET_ASSIGNED_PACKAGES",VALIDATE_ASSIGN_ACCOUNT_TEMPLATE:"VALIDATE_ASSIGN_ACCOUNT_TEMPLATE",ASSIGN_ACCOUNT_TEMPLATE:"ASSIGN_ACCOUNT_TEMPLATE",VALIDATE_MIGRATE_ACCOUNT:"VALIDATE_MIGRATE_ACCOUNT",MIGRATE_ACCOUNT:"MIGRATE_ACCOUNT",MIGRATE_MULTIPLE_USERS:"MIGRATE_MULTIPLE_USERS",GET_ACCOUNTS:"GET_ACCOUNTS",GET_SEARCH_TAGS:"GET_SEARCH_TAGS",SUSPEND_ACCOUNT:"SUSPEND_ACCOUNT",UNSUSPEND_ACCOUNT:"UNSUSPEND_ACCOUNT",ASSIGN_TELEPHONY_CONFIGURATION:"ASSIGN_TELEPHONY_CONFIGURATION",DELETE_TELEPHONY_CONFIGURATION:"DELETE_TELEPHONY_CONFIGURATION",GET_ACCOUNT_BY_ID:"GET_ACCOUNT_BY_ID",GET_ACCOUNT_BY_USER_ID:"GET_ACCOUNT_BY_USER_ID",GET_TECHNICAL_ADMIN_USER_ID:"GET_TECHNICAL_ADMIN_USER_ID",RENEW_ASSOCIATED_TELEPHONY_USER:"RENEW_ASSOCIATED_TELEPHONY_USER"},UserDataActionType:{GET_USER_DATA:"GET_USER_DATA"},AccountEventType:{MIGRATE_MULTIPLE_USERS:"MIGRATE_MULTIPLE_USERS",TELEPHONY_CONFIGURATION_UPDATED:"TELEPHONY_CONFIGURATION_UPDATED"},AccountTemplateName:{USER:"USER",ADMIN:"ADMIN",MEETING_POINT:"MEETING_POINT",XMPP_FEDERATED_USER:"XMPP_FEDERATED_USER"},AccountStatus:{NONE:"NONE",CREATED:"CREATED",INITIAL:"INITIAL",INVITED:"INVITED",ACTIVE:"ACTIVE",SUSPENDED:"SUSPENDED",DELETED:"DELETED"},GetAccountsOrdering:{ASCENDING:"ASCENDING",DESCENDING:"DESCENDING"},GetAccountsSorting:{BY_FIRST_NAME:"BY_FIRST_NAME",BY_LAST_NAME:"BY_LAST_NAME",BY_NAME:"BY_NAME",BY_PRIMARY_EMAIL:"BY_PRIMARY_EMAIL",BY_PHONE_NUMBER:"BY_PHONE_NUMBER",BY_LAST_LOGIN:"BY_LAST_LOGIN",BY_LOCATION:"BY_LOCATION"},GetAccountsFilterCriteria:{PRIMARY_EMAIL:"PRIMARY_EMAIL",FIRST_NAME:"FIRST_NAME",LAST_NAME:"LAST_NAME",DISPLAY_NAME:"DISPLAY_NAME",STATUS:"STATUS",TAG:"TAG"},SystemPermission:{IGNORE:"IGNORE",CLIENT_LOGON:"CLIENT_LOGON",INVITE_USER:"INVITE_USER",ROLE_TELEPHONY_CONNECTOR:"ROLE_TELEPHONY_CONNECTOR",ROLE_VIRTUAL_TELEPHONY_CONNECTOR:"ROLE_VIRTUAL_TELEPHONY_CONNECTOR",ROLE_TECHNICAL:"ROLE_TECHNICAL",ROLE_SESSION_GUEST:"ROLE_SESSION_GUEST",ROLE_USER:"ROLE_USER",ROLE_TENANT_ADMIN:"ROLE_TENANT_ADMIN",ROLE_SUPPORT:"ROLE_SUPPORT",ROLE_SYSTEM_ADMIN:"ROLE_SYSTEM_ADMIN",MANAGE_TENANT:"MANAGE_TENANT",TELEPHONY:"TELEPHONY",RECORDING:"RECORDING",MODERATION:"MODERATION",GUEST_ACCESS:"GUEST_ACCESS",MAX_PACKAGE_ACCOUNTS:"MAX_PACKAGE_ACCOUNTS",FREE_TRIAL:"FREE_TRIAL",USER_STORAGE:"USER_STORAGE",INTEGRATIONS:"INTEGRATIONS",RTC_PARTICIPANTS:"RTC_PARTICIPANTS",ACCOUNTS:"ACCOUNTS",IE_PLUGIN_SUPPORT:"IE_PLUGIN_SUPPORT",SUPPORT_CONVERSATION:"SUPPORT_CONVERSATION",SUPPORT_FORUM:"SUPPORT_FORUM",OUTLOOK_PLUGIN:"OUTLOOK_PLUGIN",TENANT_STORAGE:"TENANT_STORAGE",PSTN_DIAL_IN:"PSTN_DIAL_IN",LDAP_AGENT:"LDAP_AGENT",INVITE_PARTNER:"INVITE_PARTNER",LARGE_CONFERENCE:"LARGE_CONFERENCE",CREATE_COMMUNITY:"CREATE_COMMUNITY",CONTENT_MODERATOR:"CONTENT_MODERATOR",ANALYTICS:"ANALYTICS",VIEW_OPEN_CONVERSATION:"VIEW_OPEN_CONVERSATION",SSO:"SSO",IE_PLUGIN_SUPPORT_LIMITATION:"IE_PLUGIN_SUPPORT_LIMITATION",ROLE_MEETING_POINT:"ROLE_MEETING_POINT",MOBILE_BREAKOUT:"MOBILE_BREAKOUT",UCAAS:"UCAAS",DEVELOPER_CONSOLE_ACCESS:"DEVELOPER_CONSOLE_ACCESS",S4B_INTEGRATION:"S4B_INTEGRATION"},PermissionType:{TENANT_QUOTA:"TENANT_QUOTA",USER_QUOTA:"USER_QUOTA",FEATURE:"FEATURE",OVERALL_PACKAGE_QUOTA:"OVERALL_PACKAGE_QUOTA",OVERALL_PACKAGE_FEATURE:"OVERALL_PACKAGE_FEATURE",RESTRICTION:"RESTRICTION"},MigrateMultipleStatusCode:{RUNNING:"RUNNING",FINISHED:"FINISHED"},MigrateResponseCode:{NULL_PARAMETER:"NULL_PARAMETER",ACCOUNT_DOES_NOT_EXIST:"ACCOUNT_DOES_NOT_EXIST",TECHNICAL_ACCOUNT_NOT_ALLOWED:"TECHNICAL_ACCOUNT_NOT_ALLOWED",ACCOUNT_TEMPLATE_DOES_NOT_EXIST:"ACCOUNT_TEMPLATE_DOES_NOT_EXIST",ILLEGAL_ACCOUNT_TEMPLATE_ASSIGNMENT:"ILLEGAL_ACCOUNT_TEMPLATE_ASSIGNMENT",MAXIMUM_ACCOUNTS_REACHED:"MAXIMUM_ACCOUNTS_REACHED",ERROR:"ERROR",OK:"OK"},ActivityStreamActionType:{CREATE_MENTION:"CREATE_MENTION",GET_MENTIONS_BY_USER:"GET_MENTIONS_BY_USER",GET_ACTIVITIES_BY_USER:"GET_ACTIVITIES_BY_USER",UPDATE_ACTIVITY_READ:"UPDATE_ACTIVITY_READ",MARK_ALL_READ:"MARK_ALL_READ"},ActivityStreamEventType:{ACTIVITY_CREATED:"ACTIVITY_CREATED",ACTIVITY_MARKED_READ:"ACTIVITY_MARKED_READ",ACTIVITY_MARKED_UNREAD:"ACTIVITY_MARKED_UNREAD",ACTIVITY_DELETED:"ACTIVITY_DELETED",ACTIVITY_MARK_ALL_READ:"ACTIVITY_MARK_ALL_READ"},ConversationUserDataEventType:{LABELS_ADDED:"LABELS_ADDED",LABELS_REMOVED:"LABELS_REMOVED",LABEL_EDITED:"LABEL_EDITED",FILTERS_REMOVED:"FILTERS_REMOVED",FILTER_ADDED:"FILTER_ADDED",FILTER_EDITED:"FILTER_EDITED"},VotingType:{ACCEPT_DECLINE:"ACCEPT_DECLINE",APPROVE_REJECT:"APPROVE_REJECT",YES_NO:"YES_NO",YES_NO_MAYBE:"YES_NO_MAYBE",A_B:"A_B",ONE_TWO_THREE_FOUR:"ONE_TWO_THREE_FOUR"},LabFeatureName:{ACTIVE_CALL_NOTIFICATION:"ACTIVE_CALL_NOTIFICATION",AUTHENTICATION_SETTINGS:"AUTHENTICATION_SETTINGS",BRIDGE_NUMBER_SELECTION:"BRIDGE_NUMBER_SELECTION",CLOUD_TELEPHONY:"CLOUD_TELEPHONY",COLOR_CONTRAST:"COLOR_CONTRAST",CONVERSATION_FILES_SECTION:"CONVERSATION_FILES_SECTION",DEVELOPER_CONSOLE:"DEVELOPER_CONSOLE",EXPORT_USER_DATA:"EXPORT_USER_DATA",FILTER_BY_LABEL:"FILTER_BY_LABEL",FIREBASE_PUSH_NOTIFICATIONS:"FIREBASE_PUSH_NOTIFICATIONS",INCOMING_CALL_ROUTING:"INCOMING_CALL_ROUTING",IMPROVED_NOTIFICATION:"IMPROVED_NOTIFICATION",IMPROVED_TOPIC_POSTING:"IMPROVED_TOPIC_POSTING",LEAK_CANARY:"LEAK_CANARY",OPEN_XCHANGE:"OPEN_XCHANGE",ORGANISE_CONTENT:"ORGANISE_CONTENT",PARTICIPANT_DRAWING:"PARTICIPANT_DRAWING",PARTNER_ADMINISTRATION:"PARTNER_ADMINISTRATION",PBX_TIMERS:"PBX_TIMERS",SCOPE_SEARCHES:"SCOPE_SEARCHES",SCREENSHARE_TAP_INDICATOR:"SCREENSHARE_TAP_INDICATOR",SECOND_TELEPHONY_CALL_SUPPORT:"SECOND_TELEPHONY_CALL_SUPPORT",SKYPE_FOR_BUSINESS:"SKYPE_FOR_BUSINESS",TEXT_TO_SPEECH:"TEXT_TO_SPEECH",VIDEO_PLAYER:"VIDEO_PLAYER",VOTING:"VOTING",WHITEBOARD:"WHITEBOARD"},DraftType:{PRIVATE:"PRIVATE",OPEN:"OPEN",BRIDGE:"BRIDGE",LARGE:"LARGE"},AvatarBadgeType:{COMMUNITY:"COMMUNITY",EVENT:"EVENT",SKYPE:"SKYPE"},AudioVideoDeviceCategories:{AUDIO_OUTPUT:"AUDIO_OUTPUT",RINGING_OUTPUT:"RINGING_OUTPUT",AUDIO_INPUT:"AUDIO_INPUT",VIDEO_INPUT:"VIDEO_INPUT"},AtcCapabilities:{EXTENDED_ALERTING:"EXTENDED_ALERTING",CLEAR_CONNECTION_BUSY:"CLEAR_CONNECTION_BUSY",PBX_CALL_LOG:"PBX_CALL_LOG"}}),e=function(){function a(a){if(!a)return"";var b={};if(e.forEach(function(c){void 0!==a[c]&&null!==a[c]&&(b[c]=a[c])}),c.isEmptyObject(b))return"";var d=JSON.stringify(b);return d=c.textToHtmlEscaped(d),f.replace("%%1",d)}function d(a){if(a&&a.text)try{if(e.forEach(function(b){void 0===a[b]&&(a[b]=null)}),!a.text.content)return;var d=g.exec(a.text.content);if(d&&d[0]){a.text.content=a.text.content.slice(d[0].length);var f=d[1];if(f){f=c.escapedHtmlToText(f);var h=JSON.parse(f);e.forEach(function(b){void 0!==h[b]&&(a[b]=h[b])})}}}catch(a){b.error("[Proto]: Failed to retrieve private data. ",a)}}var e=["voting"],f="||::$$privateData=%%1::||",g=/^\|\|::\$\$privateData=({.*})::\|\|/;return{SUPPORTED_PRIVATE_DATA_FIELDS:e,convertPrivateDataToContent:a,retrievePrivateDataFromContent:d}}(),f={requestNr:0,Request:function(a,b){var c={msgType:d.WSMessageType.REQUEST,request:{requestId:++f.requestNr,type:a}};switch(a){case d.ContentType.CONVERSATION:c.request.conversation=b;break;case d.ContentType.USER:c.request.user=b;break;case d.ContentType.RTC_CALL:c.request.rtcCall=b;break;case d.ContentType.RTC_SESSION:c.request.rtcSession=b;break;case d.ContentType.SEARCH:c.request.search=b;break;case d.ContentType.INSTRUMENTATION:c.request.instrumentation=b;break;case d.ContentType.ADMINISTRATION:c.request.administration=b;break;case d.ContentType.SYSTEM:c.request.system=b;break;case d.ContentType.THIRDPARTYCONNECTORS:c.request.thirdpartyconnectors=b;break;case d.ContentType.GUEST:c.request.guest=b;break;case d.ContentType.USER_TO_USER:c.request.userToUser=b;break;case d.ContentType.VERSION:c.request.version=b;break;case d.ContentType.ACCOUNT:c.request.account=b;break;case d.ContentType.ACTIVITYSTREAM:c.request.activityStream=b;break;case d.ContentType.USER_DATA:c.request.userData=b}return c},ParseEvent:function(a){var b,c={};switch(a.type){case d.ContentType.CONVERSATION:switch(b="Conversation."+a.conversation.type,a.conversation.type){case d.ConversationEventType.CREATE:c=a.conversation.create;break;case d.ConversationEventType.UPDATE:c=a.conversation.update;break;case d.ConversationEventType.ADD_ITEM:c=a.conversation.addItem;break;case d.ConversationEventType.ADD_PARTICIPANT:c=a.conversation.addParticipant;break;case d.ConversationEventType.UPDATE_ITEM:c=a.conversation.updateItem;break;case d.ConversationEventType.READ_ITEMS:c=a.conversation.readItems;break;case d.ConversationEventType.TYPING:c=a.conversation.typing;break;case d.ConversationEventType.DRAFT_MESSAGE_SAVED:c=a.conversation.draftMessage;break;case d.ConversationEventType.DRAFT_MESSAGE_DISCARDED:c=a.conversation.draftMessage;break;case d.ConversationEventType.DRAFT_MESSAGE_PUBLISHED:c=a.conversation.draftMessage;break;case d.ConversationEventType.FLAG_ITEM:c=a.conversation.setFlagItem;break;case d.ConversationEventType.CLEAR_FLAGGED_ITEM:c=a.conversation.clearFlaggedItem;break;case d.ConversationEventType.CONVERSATION_MARKED:c=a.conversation.conversationMarked;break;case d.ConversationEventType.CONVERSATION_UNMARKED:c=a.conversation.conversationUnmarked;break;case d.ConversationEventType.FAVORITE_POSITION_CHANGED:c=a.conversation.favoritePositionChangedEvent;break;case d.ConversationEventType.USER_DATA_CHANGED:c=a.conversation.userDataChangedEvent}c.convId=a.conversation.convId;break;case d.ContentType.USER:switch(b="User."+a.user.type,a.user.type){case d.UserEventType.USER_PRESENCE_CHANGE:c=a.user.presenceChanged;break;case d.UserEventType.USER_UPDATED:c=a.user.userUpdated;break;case d.UserEventType.SESSION_CLOSED:c=a.user.sessionClosed;break;case d.UserEventType.PASSWORD_CHANGED:c=a.user.passwordChanged;break;case d.UserEventType.USER_SETTING_UPDATED:c=a.user.userSettingUpdated;break;case d.UserEventType.TELEPHONY_DATA:c=a.user.telephonyData;break;case d.UserEventType.DEVICE_LIST_CHANGED:c=a.user.deviceListChangedEvent;break;case d.UserEventType.NOTIFICATION_SUBSCRIPTION_CHANGE:c=a.user.notificationSubscriptionChange}c.userId=a.user.userId;break;case d.ContentType.RTC_CALL:switch(b="RTCCall."+a.rtcCall.type,a.rtcCall.type){case d.RTCCallEventType.SDP_ANSWER:c=a.rtcCall.sdpAnswer;break;case d.RTCCallEventType.SDP_FAILED:c=a.rtcCall.sdpFailed;break;case d.RTCCallEventType.INVITE:c=a.rtcCall.invite;break;case d.RTCCallEventType.INVITE_CANCEL:c=a.rtcCall.inviteCancel;break;case d.RTCCallEventType.INVITE_FAILED:c=a.rtcCall.inviteFailed;break;case d.RTCCallEventType.CHANGE_MEDIA_TYPE_REQUESTED:c=a.rtcCall.changeMediaRequested;break;case d.RTCCallEventType.PROGRESS:c=a.rtcCall.participantProgress;break;case d.RTCCallEventType.CHANGE_MEDIA_TYPE_FORCED:c=a.rtcCall.changeMediaTypeForcedEvent;break;case d.RTCCallEventType.ICE_CANDIDATES:c=a.rtcCall.iceCandidates;break;case d.RTCCallEventType.RTC_QUALITY_RATING_EVENT:c=a.rtcCall.ratingEvent}c.sessionId=a.rtcCall.sessionId,c.instanceId=a.rtcCall.instanceId;break;case d.ContentType.RTC_SESSION:switch(b="RTCSession."+a.rtcSession.type,a.rtcSession.type){case d.RTCSessionEventType.SESSION_STARTED:c=a.rtcSession.sessionStarted;break;case d.RTCSessionEventType.SESSION_TERMINATED:c=a.rtcSession.sessionTerminated;break;case d.RTCSessionEventType.SESSION_UPDATED:c=a.rtcSession.sessionUpdated,void 0!==c.session.whiteBoardEnabled&&(c.session.whiteboardEnabled=c.session.whiteBoardEnabled,delete c.session.whiteBoardEnabled);break;case d.RTCSessionEventType.SESSION_MOVED:c=a.rtcSession.sessionMoved;break;case d.RTCSessionEventType.PARTICIPANT_JOINED:c=a.rtcSession.participantJoined;break;case d.RTCSessionEventType.PARTICIPANT_LEFT:c=a.rtcSession.participantLeft;break;case d.RTCSessionEventType.PARTICIPANT_UPDATED:c=a.rtcSession.participantUpdated;break;case d.RTCSessionEventType.ACTIVE_SPEAKER:c=a.rtcSession.speaker;break;case d.RTCSessionEventType.VIDEO_ACTIVE_SPEAKER:c=a.rtcSession.videoSpeaker;break;case d.RTCSessionEventType.SESSION_RECORDING_INFO:c=a.rtcSession.sessionRecordingInfo;break;case d.RTCSessionEventType.SESSION_RECORDING_STARTED:c=a.rtcSession.sessionRecordingStarted;break;case d.RTCSessionEventType.SESSION_RECORDING_STOPPED:c=a.rtcSession.sessionRecordingStopped;break;case d.RTCSessionEventType.SESSION_RECORDING_FAILED:c=a.rtcSession.sessionRecordingFailed;break;case d.RTCSessionEventType.SESSION_TERMINATION_TIMER_STARTED:c=a.rtcSession.sessionTerminationTimerStarted;break;case d.RTCSessionEventType.SESSION_TERMINATION_TIMER_CANCELLED:c=a.rtcSession.sessionTerminationTimerCancelled;break;case d.RTCSessionEventType.SESSION_ATTRIBUTES_CHANGED_EVENT:c=a.rtcSession.sessionAttributesChangedEvent;break;case d.RTCSessionEventType.QUESTION_EVENT:c=a.rtcSession.questionEvent;break;case d.RTCSessionEventType.INVITE_TO_STAGE_EVENT:c=a.rtcSession.inviteToStageEvent;break;case d.RTCSessionEventType.INVITE_TO_STAGE_CANCEL_EVENT:c=a.rtcSession.inviteToStageCancelEvent;break;case d.RTCSessionEventType.CURTAIN_EVENT:c=a.rtcSession.curtainEvent;break;case d.RTCSessionEventType.WHITEBOARD_ENABLED:c=a.rtcSession.whiteboardEnabled;break;case d.RTCSessionEventType.WHITEBOARD_DISABLED:c={};break;case d.RTCSessionEventType.WHITEBOARD_ELEMENT_ADDED:c=a.rtcSession.whiteboardElementAdded;break;case d.RTCSessionEventType.WHITEBOARD_ELEMENT_REMOVED:c=a.rtcSession.whiteboardElementRemoved;break;case d.RTCSessionEventType.WHITEBOARD_ELEMENT_UPDATED:c=a.rtcSession.whiteboardElementUpdated;break;case d.RTCSessionEventType.WHITEBOARD_CLEARED:c=a.rtcSession.whiteboardCleared}c.sessionId=a.rtcSession.sessionId;break;case d.ContentType.SEARCH:switch(b="Search."+a.search.type,a.search.type){case d.SearchEventType.BASIC_SEARCH_RESULT:c=a.search.basicSearchResult;break;case d.SearchEventType.DETAILED_SEARCH_RESULT:c=a.search.detailSearchResult;break;case d.SearchEventType.SEARCH_STATUS:c=a.search.searchStatus;break;case d.SearchEventType.RECENT_SEARCH_ADDED:c=a.search.recentSearchAdded}c.searchId=a.search.searchId;break;case d.ContentType.SYSTEM:switch(b="System."+a.system.type,a.system.type){case d.SystemEventType.MAINTENANCE:c=a.system.maintenance;break;case d.SystemEventType.CLIENT_UPDATE:c=a.system.update}break;case d.ContentType.ADMINISTRATION:switch(b="Administration."+a.administration.type,a.administration.type){case d.AdministrationEventType.INVITE_MULTIPLE_USERS:c=a.administration.inviteMultipleUsers;break;case d.AdministrationEventType.INVITE_MULTIPLE_PARTNER_USERS:c=a.administration.inviteMultiplePartnerUsers}break;case d.ContentType.THIRDPARTYCONNECTORS:switch(b="ThirdParty."+a.thirdParty.type,
a.thirdParty.type){case d.ThirdPartyEventType.CONNECTED_TO_THIRDPARTY:c=a.thirdParty;break;case d.ThirdPartyEventType.DISCONNECTED_FROM_THIRDPARTY:c=a.thirdParty.provider}break;case d.ContentType.USER_TO_USER:b="UserToUser."+a.userToUser.userToUser.type,c=a.userToUser.userToUser,c.routing=a.userToUser.routing;break;case d.ContentType.ACTIVITYSTREAM:switch(b="ActivityStream."+a.activity.type,a.activity.type){case d.ActivityStreamEventType.ACTIVITY_CREATED:c=a.activity.create.item;break;case d.ActivityStreamEventType.ACTIVITY_DELETED:c=a.activity.delete.item;break;case d.ActivityStreamEventType.ACTIVITY_MARKED_READ:c=a.activity.markRead.itemId;break;case d.ActivityStreamEventType.ACTIVITY_MARKED_UNREAD:c=a.activity.markUnread.itemId;break;case d.ActivityStreamEventType.ACTIVITY_MARK_ALL_READ:c=a.activity.markAllRead.status}break;case d.ContentType.ACCOUNT:switch(b="Account."+a.account.type,a.account.type){case d.AccountEventType.MIGRATE_MULTIPLE_USERS:c=a.account.migrateMultipleUsers;break;case d.AccountEventType.TELEPHONY_CONFIGURATION_UPDATED:c=a.account.telephonyConfigurationUpdated}break;case d.ContentType.CONVERSATION_USER_DATA:switch(b="ConversationUserData."+a.conversationUserData.type,a.conversationUserData.type){case d.ConversationUserDataEventType.LABELS_ADDED:c=a.conversationUserData.labelsAdded;break;case d.ConversationUserDataEventType.LABELS_REMOVED:c=a.conversationUserData.labelsRemoved;break;case d.ConversationUserDataEventType.LABEL_EDITED:c=a.conversationUserData.labelEdited;break;case d.ConversationUserDataEventType.FILTERS_REMOVED:c=a.conversationUserData.filtersRemoved;break;case d.ConversationUserDataEventType.FILTER_ADDED:c=a.conversationUserData.filterAdded;break;case d.ConversationUserDataEventType.FILTER_EDITED:c=a.conversationUserData.filterEdited}break;default:return null}return{name:b,data:c}},getMediaType:function(a){if(!a)return{audio:!1,video:!1,desktop:!1};var b={audio:!1,video:!1,desktop:!1};return a.forEach(function(a){switch(a){case d.RealtimeMediaType.AUDIO:b.audio=!0;break;case d.RealtimeMediaType.VIDEO:b.video=!0;break;case d.RealtimeMediaType.DESKTOP_SHARING:b.desktop=!0}}),b}};return a.Constants=d,a.PrivateData=e,a.Proto=f,a}(Circuit),Circuit=function(a){"use strict";function b(a){if(a){a=a.replace(/(a=)*candidate:([^\r]+)(\r\n)*/i,"$2");var b=a.split(" ");if(b.length<7)throw new Error("Invalid candidate: "+a);this.foundation=parseInt(b[0],10),this.componentId=parseInt(b[1],10),this.transport=b[2].toLowerCase(),this.priority=parseInt(b[3],10),this.address=b[4],this.port=parseInt(b[5],10),this.typ=b[7],this.optional=[];for(var c=8;c<b.length;c+=2)this.optional.push(b[c]),this[b[c]]=b[c+1]}else this.foundation=1,this.componentId=1,this.transport="udp",this.priority=1,this.address="0.0.0.0",this.port=1,this.typ="host",this.generation=0,this.optional=[]}var c=a.Utils,d=Object.freeze({TLS:{name:"tls",start:0,end:11e6},TCP:{name:"tcp",start:12e6,end:31e6},UDP:{name:"udp",start:35e6,end:6e7}});b.prototype.isRtp=function(){return 1===this.componentId},b.prototype.isRtcp=function(){return 2===this.componentId},b.prototype.isTcpTlsRelay=function(){return"relay"===this.typ&&this.priority<=d.TCP.end},b.prototype.getRelayClientTransportType=function(){var a="";if("relay"===this.typ){var b=this.priority;[d.TLS,d.TCP,d.UDP].some(function(c){if(b>=c.start&&b<=c.end)return a=c.name,!0})}return a},b.prototype.getValue=function(){for(var a=this.foundation+" "+this.componentId+" "+this.transport+" "+this.priority+" "+this.address+" "+this.port+" typ "+this.typ,b=0;b<this.optional.length;b++){var c=this.optional[b];a+=" "+c+" "+this[c]}return a},b.prototype.getParsedAttribute=function(){return{field:"candidate",value:this.getValue()}},b.prototype.toString=function(){var a="candidate:"+this.getValue();return a};var e=function(){function a(a){var b=a.split(/\s+/);return{username:b[0],id:b[1],version:b[2],nettype:b[3],addrtype:b[4],address:b[5]}}function d(a){var b=a.split(/\s+/);return{nettype:b[0],addrtype:b[1],address:b[2]}}function e(a){var b=/^([^:]+)(?::(.*))?/.exec(a);return{field:b[1],value:b[2]}}function f(a){var b=r.exec(a);return{media:b[1],port:+b[2],portnum:+(b[3]||1),proto:b[4],fmt:b[5]?b[5].split(/\s+/).map(function(a){return+a}):[]}}function g(a,b,c){switch(b){case"v":case"o":case"s":case"i":case"u":case"e":case"p":case"c":a[b]=c;break;default:a[b]?a[b].push(c):a[b]=[c]}}function h(a,b,c){if(void 0!==a[b]){var d=function(a){return b+"="+(s[b]&&s[b](a)||a)+"\r\n"};return Array.isArray(a[b])?a[b].map(d).join(""):d(a[b])}return c?b+"="+c+"\r\n":""}function i(a){return a.filter(function(a){switch(a.field){case"inactive":case"recvonly":case"sendonly":case"sendrecv":return!1}return!0})}function j(b){var c,h,i=b.split(/\r\n/),j={};for(c=0;c<i.length&&(h=/^(\w)=(.*)/.exec(i[c]),h&&"m"!==h[1]);++c)"a"===h[1]&&h[2]?g(j,h[1],e(h[2])):g(j,h[1],h[2]);j.m=[];for(var k=null;c<i.length&&(h=/(\w)=(.*)/.exec(i[c]),h);++c)"m"===h[1]?(k=f(h[2]),j.m.push(k)):"a"===h[1]&&h[2]?g(k,h[1],e(h[2])):g(k,h[1],h[2]);return j.s&&""!==j.s.trim()||(j.s="-"),j.o&&(j.o=a(j.o)),j.c&&(j.c=d(j.c)),j.m.forEach(function(a){a.c&&(a.c=d(a.c))}),j}function k(a){var b="string"==typeof a?j(a):a,c=[];return b.m&&b.m.forEach(function(a){"video"===a.media&&a.a.some(function(a){switch(a.field){case"sendrecv":case"sendonly":case"recvonly":case"inactive":return c.push(a.field),!0}})}),c}function l(a,b){var c="string"==typeof a?j(a):a;b=b||{};var d="sendrecv";return void 0!==b.mLineIndex?(c.m[b.mLineIndex].a.forEach(function(a){switch(a.field){case"sendrecv":case"sendonly":case"recvonly":case"inactive":d=a.field}}),d):(b.mediaType&&"both"!==b.mediaType||(b.mediaType="audio"),c.a&&c.a.forEach(function(a){switch(a.field){case"sendonly":case"recvonly":case"inactive":d=a.field}}),c.m&&c.m.forEach(function(a){a.media===b.mediaType&&a.a.forEach(function(a){switch(a.field){case"sendrecv":case"sendonly":case"recvonly":case"inactive":d=a.field}})}),d)}function m(a){return!!Array.isArray(a)&&a.some(function(a){return a.includes("AS:")})}function n(a){return!!Array.isArray(a)&&a.some(function(a){return a.includes("TIAS:")})}function o(a,c,d,e){if(0===a.port)return!0;var f=0,g=!1,h=null,i=null,j=a.a.filter(function(c){if("candidate"!==c.field)return!0;var e=new b(c.value);if("udp"!==e.transport)return!1;if(d&&"video"===a.media){if("relay"!==e.typ)return g=!0,!1;if(!e.isTcpTlsRelay())return q.debug("[SdpParser]: Removed UDP relay candidate: ",c.value),g=!0,!1;!h&&e.isRtp()&&(h=e),!i&&e.isRtcp()&&(i=e)}return f++,!0});return h||!g||e?!(0===f&&!e)&&(a.a=j,i&&a.a.some(function(a){if("rtcp"===a.field)return a.value=i.port+" IN IP4 "+i.address,!0}),h&&(a.port=h.port,a.c&&(a.c.address=h.address)),!0):(q.info("[SdpParser]: Media description does not have TCP/TLS relay candidates. Do not filter UDP candidates!"),o(a,c,!1))}function p(a,b){var c=-1;return a.m.some(function(a,d){if(a.a.some(function(a){return"mid"===a.field&&a.value===b}))return c=d,!0}),c}var q=Circuit.logger,r=/^(\w+) +(\d+)(?:\/(\d))? +(\S+)(?: (\d+( +\d+)*))?/,s={o:function(a){return[a.username||"-",a.id,a.version,a.nettype||"IN",a.addrtype||"IP4",a.address].join(" ")},c:function(a){return[a.nettype||"IN",a.addrtype||"IP4",a.address].join(" ")},m:function(a){return[a.media||"audio",a.port||"0",a.proto||"RTP/AVP",a.fmt.join(" ")].join(" ")},a:function(a){return a.value?[a.field,a.value].join(":"):a.field}};return{parse:j,stringify:function(a){var b="";return b+=h(a,"v",0),b+=h(a,"o"),b+=h(a,"s","-"),b+=h(a,"i"),b+=h(a,"u"),b+=h(a,"e"),b+=h(a,"p"),b+=h(a,"c"),b+=h(a,"b"),b+=h(a,"t","0 0"),b+=h(a,"r"),b+=h(a,"z"),b+=h(a,"k"),b+=h(a,"a"),a.m.forEach(function(a){b+=h({m:a},"m"),b+=h(a,"i"),b+=h(a,"c"),b+=h(a,"b"),b+=h(a,"k"),b+=h(a,"a")}),b},getConnectionMode:l,getVideoConnectionModes:k,setConnectionMode:function(a,b,c){var d="string"==typeof a?j(a):a,e=b&&"both"!==b?[b]:["audio","video"];return"both"===b&&d.a&&(d.a=i(d.a),d.a.push({field:c})),d.m&&d.m.forEach(function(a){e.includes(a.media)&&(a.a=i(a.a),a.a.push({field:c}))}),d},isHold:function(a){var b=l(a);return"inactive"===b||"sendonly"===b},disableMultiplex:function(a){var b="string"==typeof a?j(a):a;return b.a&&(b.a=b.a.filter(function(a){return"group"!==a.field})),b},hasVideo:function(a){var b="string"==typeof a?j(a):a;return!!b.m&&b.m.some(function(a,c){return"video"===a.media&&0!==a.port&&0!==a.fmt.length&&("inactive"!==l(b,{mLineIndex:c})&&a.a.some(function(a){return"rtpmap"===a.field&&/VP[89]/.test(a.value)}))})},addEmptyVideoLine:function(a){var b="string"==typeof a?j(a):a,c={media:"video",port:0,proto:"RTP/SAVPF",fmt:[100],c:{nettype:"IN",addrtype:"IP4",address:"0.0.0.0"},a:[{field:"inactive"}]};return b.m.push(c),b},removeVideo:function(a){var b="string"==typeof a?j(a):a;return b.m&&b.m.forEach(function(a){"video"===a.media&&(a.port=0,a.c={nettype:"IN",addrtype:"IP4",address:"0.0.0.0"},a.a=a.a.filter(function(a){return"mid"===a.field}),a.a.push({field:"inactive"}))}),b},setOpusParameters:function(a,b){var d="string"==typeof a?j(a):a;return d.m&&b?(b=c.shallowCopy(b),d.m.forEach(function(a){if("audio"===a.media&&a.a){var c;a.a.some(function(a){if("rtpmap"===a.field&&a.value.includes("opus"))return c=a.value.split(" ")[0],!0}),c&&a.a.some(function(a){if("fmtp"===a.field&&a.value.includes(c)){var d=a.value.substring(c.length+1).split(";");d.forEach(function(a){var c=a.split("="),d=c[0].trim(),e=c[1].trim();b.hasOwnProperty(d)||(b[d]=e)});var e=Object.keys(b).map(function(a){return a+"="+b[a]});return a.value=c+" "+e.join(";"),!0}})}}),d):d},setVideoBandwidth:function(a,b,c){var d="string"==typeof a?j(a):a;return d.m&&d.m.forEach(function(a){"video"===a.media&&(c?b&&b.valueOf()>0?a.b=["AS:"+b,"TIAS:"+1e3*b]:(m(a.b)||n(a.b))&&delete a.b:(m(a.b)||g(a,"b","AS:"+b),n(a.b)||g(a,"b","TIAS:"+1e3*b)))}),d},setXGoogle:function(a,b){var c="string"==typeof a?j(a):a;return c.m&&b&&c.m.forEach(function(a){if("video"===a.media&&a.a){var c=[];a.a=a.a.filter(function(a,b){return"rtpmap"===a.field&&/VP[89]/.test(a.value)&&c.push({idx:b+c.length,pt:a.value.split(" ")[0]}),("fmtp"!==a.field||a.value&&!a.value.includes("x-google"))&&"x-google-buffer-latency"!==a.field}),c.forEach(function(c){var d=[];b.minBitRate&&b.minBitRate.valueOf()>0&&d.push("x-google-min-bitrate="+b.minBitRate),b.maxBitRate&&b.maxBitRate.valueOf()>0&&d.push("x-google-max-bitrate="+b.maxBitRate),b.startBitRate&&b.startBitRate.valueOf()>0&&d.push("x-google-start-bitrate="+b.startBitRate),b.maxQuantization&&b.maxQuantization.valueOf()>0&&d.push("x-google-max-quantization="+b.maxQuantization),d.length>0&&(d=c.pt+" "+d.join("; "),a.a.splice(c.idx+1,0,{field:"fmtp",value:d}))})}}),c},preferVideoVp9:function(a){var b="string"==typeof a?j(a):a;return b.m&&b.m.forEach(function(a,b){if("video"===a.media){var c=a.a.find(function(a){return"rtpmap"===a.field&&a.value.includes("VP9")});if(c){var d=parseInt(c.value.split(" ")[0],10),e=a.fmt.indexOf(d);e>0&&(a.fmt.splice(e,1),a.fmt.unshift(d),q.debug("[SdpParser]: Prefer VP9 format for video m-line #:",b))}}}),b},removeVideoBandwidth:function(a){var b="string"==typeof a?j(a):a;return b.m&&b.m.forEach(function(a){"video"===a.media&&(a.b=a.b&&a.b.filter(function(a){return!a.startsWith("AS:")&&!a.startsWith("TIAS:")}))}),b},removeAudioLevelAttr:function(a){var b="string"==typeof a?j(a):a;return b.m&&b.m.forEach(function(a){"audio"===a.media&&(a.a=a.a&&a.a.filter(function(a){return"extmap"!==a.field||!a.value||!a.value.includes("ssrc-audio-level")}))}),b},isTrickleIceOption:function(a){var b="string"==typeof a?j(a):a;b.a=b.a||[];var c=b.a.some(function(a){return"ice-options"===a.field&&(a.value=a.value||"",a.value.includes("trickle"))});return c},fixTrickleIceOption:function(a,b){var c="string"==typeof a?j(a):a;c.a=c.a||[];var d=c.a.some(function(a,d){if("ice-options"===a.field)return a.value=a.value||"",b?a.value.includes("trickle")||(a.value+=" trickle"):(a.value=a.value.replace(/trickle\s*/gi,"").trim(),a.value||c.a.splice(d,1)),!0});return b&&!d&&c.a.push({field:"ice-options",value:"trickle"}),c},addEndOfCandidatesLine:function(a){var b="string"==typeof a?j(a):a;return b.m&&b.m.forEach(function(a){a.a=a.a||[];var b=a.a.some(function(a){return"end-of-candidates"===a.field});b||a.a.push({field:"end-of-candidates"})}),b},removeEndOfCandidatesLine:function(a){var b="string"==typeof a?j(a):a;return b.m&&b.m.forEach(function(a){a.a&&a.a.some(function(b,c){if("end-of-candidates"===b.field)return a.a.splice(c,1),!0})}),b},removeEmptyAttributeLines:function(a,b){var c="string"==typeof a?j(a):a;if(c.m){var d={};Array.isArray(b)?b.forEach(function(a){d[a]=!0}):d[b]=!0,c.m.forEach(function(a){a.a=a.a&&a.a.filter(function(a){return a.value||!d[a.field]})})}return c},validateIceCandidates:function(a,b,c){var d="string"==typeof a?j(a):a;return!d.m.some(function(a,d){if(!o(a,d,b,c))return!0})},isNoOfferSdp:function(a){return!!a&&""===a.sdp&&"nooffer"===a.type},iceTotalCandidatesCount:function(a){var b=0,c="string"==typeof a?j(a):a;return c.m.forEach(function(a){a.a.forEach(function(a){"candidate"===a.field&&b++})}),b},removeNotNeededSsrc:function(a){var b="string"==typeof a?j(a):a;return b.m.forEach(function(a){a.a.some(function(a){return"recvonly"===a.field})&&(a.a=a.a.filter(function(a){return"ssrc"!==a.field}))}),b},removeAudioMediaProtocols:function(a,b){var c="string"==typeof a?j(a):a;return b&&b.length?(c.m.some(function(a){if("audio"===a.media&&a.proto){var c=a.proto.split("/");return c=c.filter(function(a){return!b.includes(a)}),a.proto=c.join("/"),!0}}),c):c},verifyFingerprintInMLines:function(a){var b="string"==typeof a?j(a):a;return b.m&&b.m.forEach(function(a,c){a.a.some(function(a){return"fingerprint"===a.field})||b.a.some(function(b){if("fingerprint"===b.field)return a.a.push(b),!0})||q.debug("[SdpParser]: verifyFingerprintInMLines(): No session fingerprint found for video m-line #:",c)}),b},findMediaLineIndex:function(a,b){if(b){var c="string"==typeof a?j(a):a;return p(c,b)}},setMediaIdAttribute:function(a,b,c,d){var e="string"==typeof a?j(a):a,f=e.m[b];f&&(f.a.some(function(a){if("mid"===a.field)return d&&(a.value=c),!0})||f.a.push({field:"mid",value:c}))},getOrigin:function(a){if("string"==typeof a){var b=/(o=[^\r]+)\r\n/i.exec(a);return b&&b[1]||""}return h(a,"o")}}}();return a.IceCandidate=b,a.sdpParser=e,a}(Circuit||{}),Circuit=function(a){"use strict";function b(b){function e(a,b){if("function"==typeof a)try{a(b)}catch(a){C.error(a)}}function f(a,b){e(O.onStateChange,{newState:a,oldState:b})}function g(){e(O.onReconnectFailed)}function h(a){e(O.onMessage,a)}function i(){C.debug("[CONN]: online event received"),X&&(C.debug("[CONN]: Clear offline timeout"),window.clearTimeout(X),X=null),S===d.Reconnecting&&(T=E,O.reconnect(null,1e3))}function j(){C.debug("[CONN]: offline event received"),S===d.Connected&&(window.addEventListener("online",i),X||(X=window.setTimeout(function(){X=null,window.navigator.onLine||(C.debug("[CONN]: The client is offline. Change state to Reconnecting."),O.reconnect())},I)))}function k(){P&&(P.onopen=null,P.onclose=null,P.onmessage=null,P.onerror=null,P=null)}function l(a){if(a!==S){C.debug("[CONN]: Changed connection state from "+S+" to "+a),C.debug("[CONN]: Raising connectionStateChange event");var b=S;S=a,window.setTimeout(function(){f(a,b)},0)}}function m(a){try{Q&&Q(a)}catch(a){C.error("[CONN]: Exception on errorCallback. ",a)}finally{Q=null,R=null}}function n(){try{C.debug("[CONN]: Registered Successfully"),R&&R()}catch(a){C.error("[CONN]: Exception on successCallback. ",a)}finally{Q=null,R=null}}function o(){ba&&(window.clearTimeout(ba),ba=null),aa=[],_=[]}function p(a){if(V&&(window.clearTimeout(V),V=null),W&&(window.clearTimeout(W),W=null),o(),P){C.debug("[CONN]: Disconnecting from server");var b=P;k(),b.close()}a||(window.removeEventListener&&(window.removeEventListener("online",i),window.removeEventListener("offline",j)),l(d.Disconnected))}function q(){return c.isMobile()?void C.warning("[CONN]: Mobile Client - Do not attempt to reconnect from JS"):H>0&&U>=H?(C.warning("[CONN]: Reached max number of attempts reconnecting to WebSocket"),void p()):(C.info("[CONN]: Retry to open socket in "+Math.floor(T/1e3)+" seconds"),V=window.setTimeout(function(){V=null,v()},T),T=++U>F?2*T:E,void(T=Math.min(T,G)))}function r(a){a===P&&(C.info("[CONN]: WebSocket is opened"),T=D+c.randomNumber(0,E),U=0,S!==d.Disconnected&&(l(d.Connected),window.addEventListener&&(window.addEventListener("offline",j),window.removeEventListener("online",i)),n()))}function s(a,b){if(a===P)switch(o(),b=b||{},C.info("[CONN]: WebSocket is closed. Code: "+b.code+". Reason:",b.reason),S){case d.Connected:case d.Reconnecting:S===d.Reconnecting&&g(),l(d.Reconnecting),q();break;case d.Connecting:p(),C.error("[CONN]: Failed to open WebSocket connection"),m("Failed to open WebSocket connection")}}function t(a,b){if(a===P)try{if(!b.data||"PING"===b.data)return;var c=b.data;if(!Y.doNotParseMessages)try{c=JSON.parse(c)}catch(a){return void C.error("[CONN]: Message discarded (Cannot Parse): ",b.data)}h(c)}catch(a){C.error(a)}}function u(a,b){a===P&&(o(),S!==d.Reconnecting&&S!==d.Connected?(C.error("[CONN]: WebSocket Connection Error"),l(d.Disconnected),k(),m("Failed to open WebSocket connection")):"node"!==window.navigator.platform&&"iOS"!==window.navigator.platform&&"Android"!==window.navigator.platform||(C.error("[CONN]: WebSocket connection error. Force _socket.onclose. ",b),P.onclose()))}function v(){if(S===d.Connecting||S===d.Reconnecting){if(window.navigator.onLine===!1)return C.debug("[CONN]: Client is offline. Retry connection later."),void q();C.info("[CONN]: Opening WebSocket to ",$);try{switch(window.navigator.platform){case"iOS":P=WebSocket.createWebSocket(Z);break;case"node":P=new WebSocket(Z,Y.cookie);break;default:P=new WebSocket(Z)}}catch(a){return C.error("[CONN]: Failed to connect WebSocket. ",a),void m(a)}P.onopen=r.bind(null,P),P.onclose=s.bind(null,P),P.onmessage=t.bind(null,P),P.onerror=u.bind(null,P)}}function w(){var a=Date.now(),b=_.length-1;_.some(function(c,d){return a-c<K?(_.splice(0,d),!0):void(d===b&&(_=[]))})}function x(){return!ba&&(_.length>=J&&w(),_.length<J)}function y(){if(!ba){var a=L;_.length>=J&&(a+=K-(Date.now()-_[0])),C.info("[CONN]: Start throttle timeout with delay = ",a),ba=window.setTimeout(function(){ba=null,A()},a)}}function z(a){try{var b=a.request&&a.request.requestId||"N/A";P.send(JSON.stringify(a)),_.push(Date.now()),C.debug("[CONN]: Sent message with requestId:",b)}catch(a){C.error("[CONN]: Failed to send message. ",a)}}function A(){C.info("[CONN]: Dequeue throttled messages. Number of queued messages = ",aa.length),w();for(var a=0;aa.length>0&&_.length<J&&a<N;)z(aa.shift()),a++;aa.length>0?(C.warn("[CONN]: Number of remaining queued messages = ",aa.length),y()):C.info("[CONN]: Dequeued all throttled messages")}function B(a){C.warn("[CONN]: Throttling limit exceeded. Queue the message."),aa.length>=M?C.error("[CONN]: Throttling queue is full. Drop the message."):(aa.push(a),C.info("[CONN]: Queued message #",aa.length))}var C=a.logger;b=b||{};var D,E,F,G,H;c.isMobile()?(D=0,E=0,G=0,H=0,F=0):(D=1e3,E=8e3,G=64e3,H=1350,F=1);var I=4e3,J=20,K=2e3,L=200,M=200,N=5,O=this,P=null,Q=null,R=null,S=d.Disconnected,T=null,U=0,V=null,W=null,X=null,Y=b||{},Z=null,$=null,_=[],aa=[],ba=null;this.onStateChange=null,this.onReconnectFailed=null,this.onMessage=null,this.getState=function(){return S},this.isConnected=function(){return S===d.Connected},this.setTarget=function(a){Z=a,$=Z.split("?")[0]},this.connect=function(a,b,c){C.debug("[CONN]: Connect WebSocket to ",a),S!==d.Disconnected&&p(!0),O.setTarget(a),R=b||function(){},Q=c||function(){},l(d.Connecting),window.setTimeout(v,0)},this.disconnect=function(){C.debug("[CONN]: Disconnect WebSocket from ",$),p()},this.reconnect=function(a,b){C.debug("[CONN]: Reconnect WebSocket to ",$),p(!0),a&&O.setTarget(a),l(d.Reconnecting),W=window.setTimeout(function(){W=null,v()},b||50)},this.sendMessage=function(a,b){return S!==d.Connected?(C.warn("[CONN]: WebSocket is not connected. Cannot send message. ",a),!1):a?(b||C.msgSend("[CONN]: ",a),"string"==typeof a?"PING"===a&&c.isMobile()?P.ping():P.send(a):(delete a.keysToOmitFromLogging,x()?z(a):(B(a),y())),!0):(C.error("[CONN]: Data is missing. Cannot send message."),!1)}}var c=a.Utils,d=Object.freeze({Disconnected:"Disconnected",Connecting:"Connecting",Reconnecting:"Reconnecting",Connected:"Connected"});return a.ConnectionController=b,a.Enums=a.Enums||{},a.Enums.ConnectionState=d,a}(Circuit),Circuit=function(a){"use strict";var b=a.logger,c=a.TemasysAdapter,d=a.Utils.getBrowserInfo();try{var e=function(a){if(a)try{a.oninactive=null;var c=a.getAudioTracks().concat(a.getVideoTracks());c.length&&c[0].stop?c.forEach(function(a){a.stop()}):a.stop&&a.stop(),b.info("[WebRTCAdapter]: Media stream has been stopped")}catch(a){b.error("[WebRTCAdapter]: Failed to stop media stream. ",a)}},f=function(a){if(a)try{var c=a.getVideoTracks();c?c.forEach(function(a){a.stop&&"video"===a.kind&&!a.remote&&a.stop()}):b.info("[WebRTCAdapter]: No video tracks to be changed")}catch(a){b.error("[WebRTCAdapter]: Failed to disable local video tracks. ",a)}},g=function(a){try{a.close(),b.debug("[WebRTCAdapter]: RTCPeerConnection has been closed")}catch(a){b.error(a)}},h=function(a,b){if(b){var c=[],d=[];a&&a.forEach(function(a){"audio"===a.kind?c.push(a):"video"===a.kind&&d.push(a)}),b(c,d,null)}},i=function(){return!!navigator.mediaDevices&&"function"==typeof navigator.mediaDevices.enumerateDevices&&"undefined"!=typeof HTMLMediaElement&&"function"==typeof HTMLMediaElement.prototype.setSinkId},j=function(a){if(a){if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices){var c=[{kind:"audio",id:"default",label:"",facing:""}],d=[{kind:"video",id:"default",label:"",facing:""}];return void window.setTimeout(function(){a(c,d,null)},0)}navigator.mediaDevices.enumerateDevices().then(function(b){var c=[],d=[],e=[];b&&b.forEach(function(a){var b={id:a.deviceId,groupId:a.groupId,kind:a.kind,label:a.label};switch(Circuit.isElectron&&("default"!==b.id||b.label||(b.label="res_DefaultDeviceLabel")),b.kind){case"audioinput":c.push(b);break;case"audiooutput":d.push(b);break;case"videoinput":e.push(b)}}),0!==d.length&&i()||(d=null),a(c,e,d)}).catch(function(c){b.error("[WebRTCAdapter]: Failed to enumerate devices. ",c),a()})}},k=function(a){if(!a||!a.iceServers)return a;var b=[];return a.iceServers.forEach(function(a){a.url?b.push(a):a.urls&&a.urls.forEach(function(c){b.push({url:c,credential:a.credential,username:a.username})})}),{iceServers:b}},l=function(a){a=a||{};var b={optional:[{googEchoCancellation:!0},{googEchoCancellation2:!0},{googAutoGainControl:!!a.enableAudioAGC},{googAutoGainControl2:!!a.enableAudioAGC},{googNoiseSuppression:!0},{googNoiseSuppression2:!0},{googHighpassFilter:!0},{googDucking:!1},{chromeRenderToAssociatedSink:!0}]};return b},m=function(a){if(a&&a.hdVideo){var b={mandatory:{minAspectRatio:1.76,maxAspectRatio:1.78,minFrameRate:30},optional:[{googNoiseReduction:!0}]};switch(a.hdVideo){case"1080p":b.mandatory.minWidth=1920,b.mandatory.minHeight=1080;break;case"720p":b.mandatory.maxWidth=1280,b.mandatory.maxHeight=720}return b}return{mandatory:{minAspectRatio:1.32,maxAspectRatio:1.34},optional:[{googNoiseReduction:!0}]}},n=function(a,b){var c=a&&a.getAudioTracks();return!(!c||!c[0])&&(c[0].enabled=!!b,!0)},o=function(c,d,e){return e=e||function(){},b.debug("[WebRTCAdapter]: Attach sinkId to audio element"),c?d&&d.length?void("undefined"!=typeof c.sinkId&&a.WebRTCAdapter?(b.debug("[WebRTCAdapter]: Get media sources to find available device"),a.WebRTCAdapter.getMediaSources(function(f,g,h){var i=a.Utils.selectMediaDevice(h,d),j=i&&i.id||"";return b.debug("[WebRTCAdapter]: Found audio output device to attach as sinkId. deviceId = ",j||"NONE"),c.sinkId===j?(b.debug("[WebRTCAdapter]: Audio output device is already attached to element"),void e()):(j||b.warn("[WebRTCAdapter]: A previously selected output device could not be found. Fallback to browser's default. Device not found: ",c.sinkId),void c.setSinkId(j).then(function(){b.debug("[WebRTCAdapter]: Success, audio output device attached: ",j||"<default>"),e()}).catch(function(a){a=a||{};var c=a.message||"unknown error";"SecurityError"===a.name&&(c="You need to use HTTPS for selecting audio output device."),b.error("[WebRTCAdapter]: Failed to attach output device. Device Id:"+j+" - ",c),e(c)}))})):e("setSinkId not available")):(b.debug("[WebRTCAdapter]: There is no audio output device selected"),void e()):void e("Invalid parameters")},p=function(a){var b={offerToReceiveAudio:1,offerToReceiveVideo:1};return a&&(a.mandatory&&(a.mandatory.hasOwnProperty("OfferToReceiveAudio")&&(b.offerToReceiveAudio=a.mandatory.OfferToReceiveAudio?1:0),a.mandatory.hasOwnProperty("OfferToReceiveVideo")&&(b.offerToReceiveVideo=a.mandatory.OfferToReceiveVideo?1:0)),a.optional&&a.optional.some(function(a){if(a.hasOwnProperty("VoiceActivityDetection"))return b.voiceActivityDetection=!!a.VoiceActivityDetection,!0})),b},q=function(a,c,d){function f(a){b.info("[WebRTCAdapter]: Get user media succeeded"),c?c(a):e(a),c=null,d=null}function g(a){b.error("[WebRTCAdapter]: Get user media failed: ",a),d&&d(a),c=null,d=null}function h(){return b.info("[WebRTCAdapter]: Get user media attempt #:",k),i=null,k===j?void g("Timeout"):(++k,navigator.mediaDevices.getUserMedia(a).then(f).catch(g).then(function(){i&&window.clearTimeout(i),i=null}),void(i=window.setTimeout(h,1e4)))}var i=null,j=Circuit.isElectron?1:3,k=0;h()};if(d.chrome)return b.info("Setting WebRTC APIs for Chrome"),RTCSessionDescription.prototype.toJSON=function(){return{type:this.type,sdp:this.sdp}},RTCIceCandidate.prototype.toJSON=function(){return{sdpMLineIndex:this.sdpMLineIndex,sdpMid:this.sdpMid,candidate:this.candidate}},a.WebRTCAdapter={enabled:!0,browser:"chrome",MediaStream:webkitMediaStream,PeerConnection:function(a,b){var c=new webkitRTCPeerConnection(a,b);return c.origCreateOffer=c.createOffer,c.createOffer=function(a,b,d){var e=p(d);c.origCreateOffer(e).then(function(b){a&&a(b)}).catch(function(a){b&&b(a)})},c.origCreateAnswer=c.createAnswer,c.createAnswer=function(a,b,d){var e=p(d);c.origCreateAnswer(e).then(function(b){a&&a(b)}).catch(function(a){b&&b(a)})},c},SessionDescription:RTCSessionDescription,IceCandidate:RTCIceCandidate,getUserMedia:q,createObjectURL:URL.createObjectURL.bind(URL),getAudioStreamTrackId:function(a){var b=a&&a.getAudioTracks()[0];return b?a.id+" "+b.id:""},getVideoStreamTrackId:function(a){var b=a&&a.getVideoTracks()[0];return b?a.id+" "+b.id:""},getAudioTrackId:function(a){var b=a&&a.getAudioTracks()[0];return b?b.id:""},getVideoTrackId:function(a){var b=a&&a.getVideoTracks()[0];return b?b.id:""},hasDeviceNameOnTrackLabel:!0,getAudioTrackLabel:function(a){var b=a&&a.getAudioTracks()[0];return b?b.label:""},getVideoTrackLabel:function(a){var b=a&&a.getVideoTracks()[0];return b?b.label:""},stopMediaStream:e,stopLocalVideoTrack:f,closePc:g,getMediaSources:function(a){return navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices?void j(a):void MediaStreamTrack.getSources(function(b){b=b&&b.map(function(a){return{id:a.id,kind:a.kind,label:a.label,facing:a.facing}}),h(b,a)})},getAudioOptions:function(a){var b=l(a);return a&&a.sourceId&&b.optional.push({sourceId:a.sourceId}),b},getVideoOptions:function(a){var b=m(a);return a&&a.sourceId&&b.optional.push({sourceId:a.sourceId}),b},getDesktopOptions:function(a,b){b=b||{};var c=b.frameRate||{};return{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:a,maxWidth:2560,maxHeight:1600},optional:[{googNoiseReduction:!0},{maxFrameRate:c.max||10},{minFrameRate:c.min||5}]}},audioOutputSelectionSupported:i(),groupPeerConnectionsSupported:!0,getMediaSourcesSupported:!0,attachSinkIdToAudioElement:o,toggleAudio:n},a;if(d.firefox){b.info("Setting WebRTC APIs for Firefox");var r=function(a){var b=[];return a.forEach(function(a){b.push(new s(a))}),b},s=function(a){switch(this.stats=a,this.id=a.id,a.type){case"inboundrtp":case"inbound-rtp":a.isRemote||(this.type="ssrc","audio"===a.mediaType?(this.stats.audioOutputLevel=!0,this.stats.googJitterReceived=a.jitter):this.stats.googFrameHeightReceived=!0);break;case"outboundrtp":case"outbound-rtp":a.isRemote||(this.type="ssrc","audio"===a.mediaType?this.stats.audioInputLevel=!0:this.stats.googFrameHeightSent=!0);break;case"candidatepair":case"candidate-pair":this.type="googCandidatePair","boolean"==typeof a.selected&&(this.googActiveConnection=a.selected?"true":"false");break;default:this.type=a.type}};s.prototype.names=function(){return Object.keys(this.stats)},s.prototype.stat=function(a){return this.stats[a]};var t="undefined"==typeof RTCPeerConnection?mozRTCPeerConnection:RTCPeerConnection,u="undefined"==typeof RTCSessionDescription?mozRTCSessionDescription:RTCSessionDescription,v="undefined"==typeof RTCIceCandidate?mozRTCIceCandidate:RTCIceCandidate;return a.WebRTCAdapter={enabled:!0,browser:"firefox",MediaStream:MediaStream,PeerConnection:function(a){var b=new t(a);return b.origCreateOffer=b.createOffer,b.createOffer=function(a,c,d){var e=p(d);b.origCreateOffer(e).then(function(b){a&&a(b)}).catch(function(a){c&&c(a)})},b.origCreateAnswer=b.createAnswer,b.createAnswer=function(a,c,d){var e=p(d);b.origCreateAnswer(e).then(function(b){a&&a(b)}).catch(function(a){c&&c(a)})},b.origGetStats=b.getStats,b.getStats=function(a,c){"function"==typeof a&&b.origGetStats().then(function(b){a(r(b))},c)},b.removeStream=function(){},b.createDTMFSender=function(a){if("function"!=typeof b.getSenders)return null;var c=b.getSenders().find(function(b){return b.track===a}),d=c&&c.dtmf;return d?(d.canInsertDTMF=!0,d):null},parseInt(d.version,10)>=46&&Object.defineProperty(b,"onaddstream",{enumerable:!0,get:function(){return b.onaddstreamCb},set:function(a){b.onaddstreamCb=a,a?b.ontrack=function(b){a({stream:b&&b.streams&&b.streams[0]})}:b.ontrack=null}.bind(b)}),b},SessionDescription:u,IceCandidate:v,getUserMedia:q,createObjectURL:function(a){return URL.createObjectURL(a)},getAudioStreamTrackId:function(a){var b=a&&a.getAudioTracks()[0];return b?a.id+" "+b.id:""},getVideoStreamTrackId:function(a){var b=a&&a.getVideoTracks()[0];return b?a.id+" "+b.id:""},getAudioTrackId:function(a){var b=a&&a.getAudioTracks()[0];return b?b.id:""},getVideoTrackId:function(a){var b=a&&a.getVideoTracks()[0];return b?b.id:""},hasDeviceNameOnTrackLabel:!1,getAudioTrackLabel:function(a){var b=a&&a.getAudioTracks()[0];return b?b.label:""},getVideoTrackLabel:function(a){var b=a&&a.getVideoTracks()[0];return b?b.label:""},stopMediaStream:e,stopLocalVideoTrack:f,closePc:function(a){window.setTimeout(function(){g(a)},500)},getMediaSources:function(a){a&&j(a)},getAudioOptions:function(a){var b=l(a);return a&&a.sourceId&&(b.deviceId=a.sourceId),b},getVideoOptions:function(a){var b=m(a);return a&&a.sourceId&&(b.deviceId=a.sourceId),b},getDesktopOptions:function(a,b){b=b||{};var c=b.frameRate||{};return c.min=c.min||5,c.max=c.max||10,{mozMediaSource:b.mediaSource||"screen",mediaSource:b.mediaSource||"screen",width:{max:2560},height:{max:1600},advanced:[{frameRate:c}]}},audioOutputSelectionSupported:i(),groupPeerConnectionsSupported:!0,getMediaSourcesSupported:!0,attachSinkIdToAudioElement:o,iceTimeoutSafetyFactor:.5,toggleAudio:n},a}if(d.ios){b.info("Setting WebRTC APIs for iOS client");var w=function(a){this.id=a.id,this.type=a.type,this.timestamp=new Date(a.timestamp);var b={};Object.getOwnPropertyNames(a.values).forEach(function(c){b[c]=a.values[c]}),this.names=function(){return Object.getOwnPropertyNames(b)},this.stat=function(a){return b[a]},a=null},x=function(a){var b=a.map(function(a){return new w(a)});this.result=function(){return b},a=null};return a.WebRTCAdapter={enabled:!0,browser:"ios",PeerConnection:function(a,b){a=k(a);var c=RTCPeerConnection.createRTCPeerConnection(a,b);return c.origGetStats=c.getStats,c.getStats=function(a){"function"==typeof a&&c.origGetStats(function(b){a(new x(b))})},c.addIceCandidate=c.addIceCandidateJS,Object.defineProperties(c,{localDescription:{
get:function(){return c.getLocalDescriptionJS()},enumerable:!0,configurable:!1},remoteDescription:{get:function(){return c.getRemoteDescriptionJS()},enumerable:!0,configurable:!1},signalingState:{get:function(){return c.getSignalingStateJS()},enumerable:!0,configurable:!1},iceConnectionState:{get:function(){return c.getIceConnectionStateJS()},enumerable:!0,configurable:!1},iceGatheringState:{get:function(){return c.getIceGatheringStateJS()},enumerable:!0,configurable:!1}}),c},SessionDescription:function(a){var b=RTCSessionDescription.createRTCSessionDescription(a);return b},IceCandidate:function(a){return{sdpMLineIndex:a.sdpMLineIndex,sdpMid:a.sdpMid,candidate:a.candidate}},getUserMedia:navigator.getUserMedia.bind(navigator),createObjectURL:URL.createObjectURL.bind(URL),getAudioStreamTrackId:function(a){var b=a&&a.getAudioTracks()[0];return b?a.streamId+" "+b.trackId:""},getVideoStreamTrackId:function(a){var b=a&&a.getVideoTracks()[0];return b?a.streamId+" "+b.trackId:""},getAudioTrackId:function(a){var b=a&&a.getAudioTracks()[0];return b?b.trackId:""},getVideoTrackId:function(a){var b=a&&a.getVideoTracks()[0];return b?b.trackId:""},hasDeviceNameOnTrackLabel:!1,getAudioTrackLabel:function(a){var b=a&&a.getAudioTracks()[0];return b?b.label:""},getVideoTrackLabel:function(a){var b=a&&a.getVideoTracks()[0];return b?b.label:""},stopMediaStream:e,stopLocalVideoTrack:f,closePc:g,getMediaSources:function(a){a&&a([],[])},getAudioOptions:l,getVideoOptions:m,getDesktopOptions:function(){return{mandatory:{iOSMediaSource:"desktop"}}},audioOutputSelectionSupported:!1,groupPeerConnectionsSupported:!1,getMediaSourcesSupported:!1,attachSinkIdToAudioElement:o,toggleAudio:n},a}if(d.android){b.info("Setting WebRTC APIs for Android client");var y=function(a){this.id=a.id,this.type=a.type,this.timestamp=new Date(a.timestamp);var b={};Object.getOwnPropertyNames(a.values).forEach(function(c){var d=a.values[c];d.name&&(b[d.name]=d.value)}),this.names=function(){return Object.getOwnPropertyNames(b)},this.stat=function(a){return b[a]},a=null},z=function(a){var b=a.map(function(a){return new y(a)});this.result=function(){return b},a=null},A=RTCPeerConnection.bind(RTCPeerConnection);return a.WebRTCAdapter={enabled:!0,browser:"android",PeerConnection:function(a,b){a=k(a);var c=A(a,b);return c.getStats=function(a){"function"==typeof a&&c.origGetStats(function(b){a(new z(b.data))})},c},SessionDescription:function(a){return{type:a.type,sdp:a.sdp}},IceCandidate:function(a){return{sdpMLineIndex:a.sdpMLineIndex,sdpMid:a.sdpMid,candidate:a.candidate}},getUserMedia:navigator.getUserMedia.bind(navigator),createObjectURL:function(){return"dummy"},getAudioStreamTrackId:function(a){var b=a&&a.getAudioTracks()[0];return b?a.id+" "+b.id:""},getVideoStreamTrackId:function(a){var b=a&&a.getVideoTracks()[0];return b?a.id+" "+b.id:""},getAudioTrackId:function(a){var b=a&&a.getAudioTracks()[0];return b?b.id:""},getVideoTrackId:function(a){var b=a&&a.getVideoTracks()[0];return b?b.id:""},hasDeviceNameOnTrackLabel:!1,getAudioTrackLabel:function(a){var b=a&&a.getAudioTracks()[0];return b?b.label:""},getVideoTrackLabel:function(a){var b=a&&a.getVideoTracks()[0];return b?b.label:""},stopMediaStream:e,stopLocalVideoTrack:f,closePc:g,getMediaSources:function(a){a&&a([],[])},getAudioOptions:l,getVideoOptions:m,getDesktopOptions:function(){return{mandatory:{androidMediaSource:"screen"}}},audioOutputSelectionSupported:!1,groupPeerConnectionsSupported:!1,getMediaSourcesSupported:!1,attachSinkIdToAudioElement:o,toggleAudio:n},a}if(d.dotnet)return b.info("Setting WebRTC APIs for .NET client"),a.WebRTCAdapter={enabled:!0,browser:"dotnet",PeerConnection:function(a,b){a=k(a);var c=new RTCPeerConnection(a,b);return c.origGetStats=c.getStats,c.getStats=function(a){"function"==typeof a&&a()},Object.defineProperties(c,{localDescription:{get:function(){return c.getLocalDescription()},enumerable:!0,configurable:!1},remoteDescription:{get:function(){return c.getRemoteDescription()},enumerable:!0,configurable:!1},signalingState:{get:function(){return c.getSignalingState()},enumerable:!0,configurable:!1},iceConnectionState:{get:function(){return c.getIceConnectionState()},enumerable:!0,configurable:!1},iceGatheringState:{get:function(){return c.getIceGatheringState()},enumerable:!0,configurable:!1}}),c},SessionDescription:function(a){return{type:a.type,sdp:a.sdp}},IceCandidate:function(a){return{sdpMLineIndex:a.sdpMLineIndex,sdpMid:a.sdpMid,candidate:a.candidate}},getUserMedia:function(a,b,c){var d={audioEnabled:!(!a||!a.audio),videoEnabled:!(!a||!a.video)};return navigator.getUserMedia(d,b,c)},createObjectURL:function(a){return a.id},getAudioStreamTrackId:function(a){var b=a&&a.getAudioTracks()[0];return b?a.id+" "+b.id:""},getVideoStreamTrackId:function(a){var b=a&&a.getVideoTracks()[0];return b?a.id+" "+b.id:""},getAudioTrackId:function(a){var b=a&&a.getAudioTracks()[0];return b?b.id:""},getVideoTrackId:function(a){var b=a&&a.getVideoTracks()[0];return b?b.id:""},hasDeviceNameOnTrackLabel:!0,getAudioTrackLabel:function(a){var b=a&&a.getAudioTracks()[0];return b?b.label:""},getVideoTrackLabel:function(a){var b=a&&a.getVideoTracks()[0];return b?b.label:""},stopMediaStream:e,stopLocalVideoTrack:f,closePc:g,getMediaSources:function(a){a&&a([],[])},getAudioOptions:function(a){var b=l(a);return a&&a.sourceId&&b.optional.push({sourceId:a.sourceId}),b},getVideoOptions:function(a){var b=m(a);return a&&a.sourceId&&b.optional.push({sourceId:a.sourceId}),b},getDesktopOptions:function(a,b){b=b||{};var c=b.frameRate||{};return{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:a,maxWidth:2560,maxHeight:1600},optional:[{googNoiseReduction:!0},{maxFrameRate:c.max||10},{minFrameRate:c.min||5}]}},audioOutputSelectionSupported:i(),groupPeerConnectionsSupported:!1,getMediaSourcesSupported:!1,attachSinkIdToAudioElement:o,toggleAudio:n},a;if(c)return b.info("Setting WebRTC APIs for IE with Temasys plugin"),a.WebRTCAdapter={enabled:!0,browser:"msie",PeerConnection:function(a,b){return a=k(a),c.PeerConnection(a,b)},SessionDescription:c.SessionDescription,IceCandidate:c.IceCandidate,getUserMedia:c.getUserMedia,createObjectURL:function(a,b,d){return c.createObjectURL(a,d)},attachMediaStream:c.attachMediaStream,getAudioStreamTrackId:function(a){var b=a&&a.getAudioTracks()[0];return b?a.label+" "+b.id:""},getVideoStreamTrackId:function(a){var b=a&&a.getVideoTracks()[0];return b?a.label+" "+b.id:""},getAudioTrackId:function(a){var b=a&&a.getAudioTracks()[0];return b?b.id:""},getVideoTrackId:function(a){var b=a&&a.getVideoTracks()[0];return b?b.id:""},hasDeviceNameOnTrackLabel:!1,getAudioTrackLabel:function(a){var b=a&&a.getAudioTracks()[0];return b?b.label:""},getVideoTrackLabel:function(a){var b=a&&a.getVideoTracks()[0];return b?b.label:""},stopMediaStream:e,stopLocalVideoTrack:f,closePc:g,getMediaSources:function(a){c.getMediaSources(function(b){h(b,a)})},getAudioOptions:function(a){return!a||!a.sourceId||{optional:[{sourceId:a.sourceId}]}},getVideoOptions:function(a){return!a||!a.sourceId||{optional:[{sourceId:a.sourceId}]}},getDesktopOptions:function(){return{optional:[{sourceId:c.screensharingKey()}]}},audioOutputSelectionSupported:!1,groupPeerConnectionsSupported:!0,getMediaSourcesSupported:!1,attachSinkIdToAudioElement:o,toggleAudio:n},a;b.info("WebRTC is not supported")}catch(a){b.error("Failed to initialize WebRTCAdapter. ",a)}return a.WebRTCAdapter={enabled:!1,browser:"",PeerConnection:function(){},SessionDescription:function(){},IceCandidate:function(){},getUserMedia:function(a,b,c){c&&c("Not supported")},createObjectURL:function(){return""},getAudioStreamTrackId:function(){return""},getVideoStreamTrackId:function(){return""},getAudioTrackId:function(){return""},getVideoTrackId:function(){return""},hasDeviceNameOnTrackLabel:!1,getAudioTrackLabel:function(){return""},getVideoTrackLabel:function(){return""},stopMediaStream:function(){},stopLocalVideoTrack:function(){},closePc:function(){},getMediaSources:function(a){a&&a([],[])},getAudioOptions:function(){return!1},getVideoOptions:function(){return!1},getDesktopOptions:function(){return!1},audioOutputSelectionSupported:!1,groupPeerConnectionsSupported:!1,getMediaSourcesSupported:!1,attachSinkIdToAudioElement:function(a,b,c){c&&c()},toggleAudio:function(){return!1}},a}(Circuit),Circuit=function(a){"use strict";function b(a,g,h){function i(){for(var a=0;a<K;a++)try{H.iceCandidatePoolSize=1;var b=new f.PeerConnection(H,I);L.push(b),k(b),c.debug("[RTCPeerConnections]: Created aux video PeerConnection")}catch(a){c.error("[RTCPeerConnections]:  Failed to create aux video PeerConnection.",a)}}function j(){H.iceCandidatePoolSize=2,J=new f.PeerConnection(H,I),k(J),c.debug("[RTCPeerConnections]: Created main audio/video RTCPeerConnection"),f.groupPeerConnectionsSupported&&i()}function k(a){a.onnegotiationneeded=n.bind(null,a),a.onicecandidate=o.bind(null,a),a.onsignalingstatechange=p.bind(null,a),a.onaddstream=q.bind(null,a),a.onremovestream=r.bind(null,a),a.oniceconnectionstatechange=s.bind(null,a)}function l(a){a.onnegotiationneeded=null,a.onicecandidate=null,a.onsignalingstatechange=null,a.onaddstream=null,a.onremovestream=null,a.oniceconnectionstatechange=null}function m(a){if(a===J)return!0;var b=L.some(function(b){if(a===b)return!0});return b}function n(a,b){return c.debug("[RTCPeerConnections]: onnegotiationneeded"),m(a)?void A(b):void c.debug("[RTCPeerConnections]:  Event is from Old Peer Connection")}function o(a,b){if(c.debug("[RTCPeerConnections]: onicecandidate: iceGatheringState = ",a.iceGatheringState),!m(a))return void c.debug("[RTCPeerConnections]:  Event is from Old Peer Connection");if(b.candidate){if(a!==J){var d=L.indexOf(a);if(d>=0){var e=new f.IceCandidate({sdpMLineIndex:b.candidate.sdpMLineIndex+d+2,sdpMid:b.candidate.sdpMid,candidate:b.candidate.candidate});b={candidate:e}}}}else{if(N++,N<L.length+1)return;c.debug("[RTCPeerConnections]:  End of candidates - all peer connections"),N=0}B(b)}function p(a,b){return c.debug("[RTCPeerConnections]: onsignalingstatechange: signalingState = ",a.signalingState),m(a)?void C(b):void c.debug("[RTCPeerConnections]:  Event is from Old Peer Connection")}function q(a,b){return c.debug("[RTCPeerConnections]: onaddstream"),m(a)?void D(b):void c.debug("[RTCPeerConnections]:  Event is from Old Peer Connection")}function r(a,b){return c.debug("[RTCPeerConnections]: onremovestream"),m(a)?void E(b):void c.debug("[RTCPeerConnections]:  Event is from Old Peer Connection")}function s(a,b){var d=K>0?" - "+(a===J?1:L.indexOf(a)+2):"",e=a.iceConnectionState;return c.debug("[RTCPeerConnections]: oniceconnectionstatechange"+d+": iceConnectionState = ",e),m(a)?void(a===J&&O!==e&&(O=e,F(b))):void c.debug("[RTCPeerConnections]: Event is from Old Peer Connection.")}function t(a,c){b.maxVideoBandwidth>0&&d.setVideoBandwidth(a,b.maxVideoBandwidth,c)}function u(a){if(0===K)return J[a];var b=d.parse(J[a].sdp);1===b.m.length&&"audio"===b.m[0].media&&"remoteDescription"!==a&&d.addEmptyVideoLine(b),L.every(function(c){if(!c[a])return!1;var e=d.parse(c[a].sdp);e=d.verifyFingerprintInMLines(e);var f=e.m.some(function(a){if("video"===a.media)return b.m.push(a),!0});return!!f});var c=new f.SessionDescription({type:J[a].type,sdp:d.stringify(b)});return c}function v(){J.createdLocalSdp=void 0,L.forEach(function(a){a.createdLocalSdp=void 0})}function w(a,b){var c=d.parse(a.sdp);t(c,!0),K&&c.m.forEach(function(a){if("video"===a.media)for(var c=0,d=a.a.length;c<d;c++)if("mid"===a.a[c].field){a.a[c].value="video_"+(b-1);break}});var e=new f.SessionDescription({type:a.type,sdp:d.stringify(c)});return e}function x(a,b){var e=d.parse(a.sdp),g=d.hasVideo(e);if(!g)return a;var h=d.getConnectionMode(e,{mediaType:"video"});c.info("[RTCPeerConnections]: Local description has video with a="+h),"sendonly"!==h||b.video?t(e,!0):(e=d.setConnectionMode(e,"video","inactive"),c.warning("[RTCPeerConnections]:  Set video connection mode to inactive"));var i=new f.SessionDescription({type:a.type,sdp:d.stringify(e)});return i}function y(a){return"pranswer"===a.type&&(a.type="answer"),a}function z(a,b){if("function"==typeof a)try{a(b)}catch(a){c.error(a)}}function A(a){z(G.onnegotiationneeded,a)}function B(a){z(G.onicecandidate,a)}function C(a){z(G.onsignalingstatechange,a)}function D(a){z(G.onaddstream,a)}function E(a){z(G.onremovestream,a)}function F(a){z(G.oniceconnectionstatechange,a)}var G=this,H=e.shallowCopy(a),I=g,J=null,K=h&&h.extraVideoChannels||0,L=[],M={mandatory:{OfferToReceiveAudio:!1,OfferToReceiveVideo:!0}},N=0,O="new";this.onnegotiationneeded=null,this.onicecandidate=null,this.onsignalingstatechange=null,this.onaddstream=null,this.onremovestream=null,this.oniceconnectionstatechange=null,this.createOffer=function(a,b,d){function e(d,e){if(g++,c.debug("[RTCPeerConnections]: createOffer, count: ",g),d.createdLocalSdp=w(e,g),g>=L.length+1){if(h)b(h);else{var f=u("createdLocalSdp");a(f)}v()}}function f(a){g++,h||(h=a),g>=L.length+1&&b(h)}var g=0,h=null;J.createOffer(e.bind(null,J),f,d),L.forEach(function(a){a.createOffer(e.bind(null,a),f,M)})},this.createAnswer=function(a,b,d,e){function f(d,f){if(h++,c.debug("[RTCPeerConnections]: createAnswer, count: ",h),d===J?d.createdLocalSdp=x(f,e):d.createdLocalSdp=x(f,{video:!1}),h>=L.length+1){if(i)b(i);else{var g=u("createdLocalSdp");a(g)}v()}}function g(a){h++,i||(i=a),h>=L.length+1&&b(i)}var h=0,i=null;J.createAnswer(f.bind(null,J),g),L.forEach(function(a){return a.remoteDescription?void a.createAnswer(f.bind(null,a),g,d):void h++})},this.setLocalDescription=function(a,b,e){function g(){i++,c.debug("[RTCPeerConnections]: setLocalDescription onLocalSdpApplied, count: ",i),i>=L.length+1&&(j?e(j):b())}function h(a){i++,c.error("[RTCPeerConnections]: setLocalDescription error, count: "+i+"\n",a),j||(j=a),i>=L.length+1&&e(j)}var i=0,j=null,k=d.parse(a.sdp),l=k.m;if(k.m=l.slice(0,2),"answer"===a.type){var m=d.parse(J.remoteDescription.sdp);1===m.m.length&&(c.info("[RTCPeerConnections]: only 1 mline in remote sdp offer"),k.m=k.m.slice(0,1))}var n=new f.SessionDescription({type:a.type,sdp:d.stringify(k)});J.setLocalDescription(n,g,h),L.forEach(function(b,e){return l[e+2]?(k.m=[l[e+2]],n=new f.SessionDescription({type:a.type,sdp:d.stringify(k)}),void b.setLocalDescription(n,g,h)):(i++,void c.warning("[RTCPeerConnections]: missing sdp mline for peer connection: "+i))})},this.setRemoteDescription=function(a,b,e){function g(){i++,c.debug("[RTCPeerConnections]: setRemoteDescription onRemoteSdpApplied, count: ",i),i>=L.length+1&&(j?e(j):b())}function h(a){i++,j||(j=a),i>=L.length+1&&e(j)}var i=0,j=null,k=d.parse(a.sdp),l=k.m;k.m=l.slice(0,2);var m=new f.SessionDescription({type:a.type,sdp:d.stringify(k)});m=y(m),J.setRemoteDescription(m,g.bind(null,J),h),L.forEach(function(b,e){return l[e+2]?(k.m=[l[e+2]],m=new f.SessionDescription({type:a.type,sdp:d.stringify(k)}),m=y(m),void b.setRemoteDescription(m,g.bind(null,b),h)):(i++,void c.warning("[RTCPeerConnections]: missing sdp mline for peer connection: "+i))})},this.removeStream=function(a){return J.removeStream(a)},this.addStream=function(a){return J.addStream(a)},this.getLocalStreams=function(){return J.getLocalStreams()},this.getRemoteStreams=function(){var a=J.getRemoteStreams().slice(0);return L.forEach(function(b){a.push.apply(a,b.getRemoteStreams())}),a},this.addIceCandidate=function(a){if(!a)return J.addIceCandidate(),void L.forEach(function(a){a.addIceCandidate()});if(a.sdpMLineIndex<=1)return void J.addIceCandidate(new f.IceCandidate(a));var b=a.sdpMLineIndex-2;L[b]&&(a.sdpMLineIndex=0,L[b].addIceCandidate(new f.IceCandidate(a)))},this.close=function(){J.close(),l(J),L.forEach(function(a){a.close(),l(a)})},this.createDTMFSender=function(a){return J.createDTMFSender(a)},Object.defineProperties(this,{localDescription:{get:function(){return u("localDescription")},enumerable:!0,configurable:!1}}),Object.defineProperties(this,{remoteDescription:{get:function(){return u("remoteDescription")},enumerable:!0,configurable:!1}}),Object.defineProperties(this,{signalingState:{get:function(){return J.signalingState},enumerable:!0,configurable:!1},iceConnectionState:{get:function(){return K>0?O:J.iceConnectionState},enumerable:!0,configurable:!1}}),Object.defineProperties(this,{mainPeerConnection:{get:function(){return J},enumerable:!1,configurable:!1},groupPeerConnections:{get:function(){return L},enumerable:!0,configurable:!1}}),j()}var c=a.logger,d=a.sdpParser,e=a.Utils,f=a.WebRTCAdapter;return b.maxVideoBandwidth=512,a.RtcPeerConnections=b,a}(Circuit||{}),Circuit=function(a){"use strict";var b=a.Constants,c={Active:{name:"Active",ui:"",established:!0,css:"active-call"},Busy:{name:"Busy",ui:"res_ParticipantState_busy",established:!1,css:"busy"},Calling:{name:"Calling",ui:"",established:!1,css:"calling"},Connecting:{name:"Connecting",ui:"",established:!1,css:"connecting"},ConnectionLost:{name:"ConnectionLost",ui:"res_ParticipantState_connectionLost",established:!1,css:"connection-lost"},Declined:{name:"Declined",ui:"res_ParticipantState_declined",established:!1,css:"declined"},Delivered:{name:"Delivered",ui:"",established:!1,css:"outgoing"},Idle:{name:"Idle",ui:"",established:!1,css:"idle"},Inactive:{name:"Inactive",ui:"",established:!1,css:"inactive"},Initiated:{name:"Initiated",ui:"",established:!1,css:"outgoing"},Joined:{name:"Joined",ui:"res_ParticipantState_joined",established:!0,css:"joined-call"},Muted:{name:"Muted",ui:"res_ParticipantState_muted",established:!0,css:"muted"},Offline:{name:"Offline",ui:"res_ParticipantState_offline",established:!1,css:"offline"},OffStage:{name:"OffStage",ui:"res_ParticipantState_leftStage",established:!1,css:"declined"},OnStage:{name:"OnStage",ui:"res_ParticipantState_enteredStage",established:!0,css:"joined-call"},Removed:{name:"Removed",ui:"res_ParticipantState_removed",established:!1,css:"declined"},Ringing:{name:"Ringing",ui:"",established:!1,css:"incoming"},Terminated:{name:"Terminated",ui:"res_ParticipantState_left",established:!1,css:"declined"},Timeout:{name:"Timeout",ui:"res_ParticipantState_missed",established:!1,css:"busy"}},d={Drop:{name:"Drop",type:"hangup",icon:"",localize:"res_Hangup"},Mute:{name:"Mute",type:"microphone",icon:"unmuted",localize:"res_Mute"},Unmute:{name:"Unmute",type:"microphone",icon:"muted",localize:"res_Unmute"},StartVideo:{name:"StartVideo",type:"video",icon:"inactive",localize:"res_StartVideo"},StopVideo:{name:"StopVideo",type:"video",icon:"active",localize:"res_StopVideo"},ToggleVideoInProgress:{name:"ToggleVideoInProgress",type:"video",icon:"progress-icon",localize:""},RemoveFromStage:{name:"DropFromStage",type:"hangup",icon:"drop-from-stage",localize:""}},e={};return e.createFromUser=function(a,b){if(!a)return null;var d=Object.create(a);return d.pcState=b||c.Idle,d.streamId=null,d.screenStreamId=null,d.videoUrl="",d.mediaType={audio:!1,video:!1,desktop:!1},d.muted=!1,d.activeSpeaker=!1,d.isExternal=!!a.isExternal,d.isActive=e.isActive.bind(null,d),d.actions=[],d.screenSharePointerSupported=!1,d.hasSameMediaType=e.hasSameMediaType.bind(null,d),d.hasVideoStream=e.hasVideoStream.bind(null,d),d.setActions=e.setActions.bind(null,d),d.toJSON=function(){return this},d.userId=a.userId,d.firstName=a.firstName,d.lastName=a.lastName,d},e.isActive=function(a){switch(a.pcState){case c.Active:case c.Joined:case c.Muted:case c.OnStage:return!0}return!1},e.hasSameMediaType=function(a,b){return!!(a&&b&&a.mediaType&&b.mediaType&&a.mediaType.audio===b.mediaType.audio&&a.mediaType.video===b.mediaType.video&&a.mediaType.desktop===b.mediaType.desktop)},e.hasVideoStream=function(a){return!(!a.videoUrl||!a.streamId&&!a.screenStreamId||!a.mediaType.video&&!a.mediaType.desktop)},e.setActions=function(a,e,f){if(a.actions=[],!e||!e.isTemporary){if(!a.pcState.established)return void(a.pcState===c.Initiated&&a.actions.push(d.Drop));if(a.isMeetingPointInvitee)a.toggleVideoInProgress?a.actions.push(d.ToggleVideoInProgress):a.actions.push(a.mediaType.video?d.StopVideo:d.StartVideo),a.actions.push(a.muted?d.Unmute:d.Mute),a.actions.push(d.Drop);else{var g=!e||e.isModerated,h=e&&e.userIsModerator(f),i=e&&e.userIsModerator(a);a.muted||g&&i&&!h||a.actions.push(d.Mute),g&&!h||(e.type===b.ConversationType.LARGE&&a.isSessionGuest&&h?a.actions.push(d.RemoveFromStage):a.actions.push(d.Drop))}}},a.RtcParticipant=e,a.Enums=a.Enums||{},a.Enums.ParticipantState=c,a.Enums.ParticipantAction=d,a}(Circuit||{}),Circuit=function(a){"use strict";function b(){var a=null;this.cstaConn=null,this.cstaState=f.Idle,this.position=e.Other,this.servicesPermitted={},this.peerFQN="",this.peerDn="",this.peerName=null,this.missedReason="",this.ignoreCall=!1,this.originalPartnerDisplay={},this.handoverInProgress=!1,this.holdInProgress=!1,this.retrieveInProgress=!1,this.redirectingUser={},this.setPeerName=function(a){this.peerName=a||""},this.setPartnerDisplay=function(a){a&&(this.peerFQN=a.fqn||"",this.peerDn=a.dn||a.fqn||"",this.peerName=a.name||this.peerDn,!this.peerFQN&&this.peerDn.startsWith("+")&&(this.peerFQN=this.peerDn))},this.setOriginalPartnerDisplay=function(a){a&&d.isEmptyObject(this.originalPartnerDisplay)&&(this.originalPartnerDisplay=a)},this.setCstaConnection=function(a){this.cstaConn=a,this.isRemote&&(this.callId=a.cID)},this.getCstaConnection=function(){return this.cstaConn},this.getCstaCallId=function(){return this.cstaConn&&this.cstaConn.cID},this.getCstaDeviceId=function(){return this.cstaConn&&this.cstaConn.dID},this.setServicesPermitted=function(a){return!a||d.isEmptyObject(a)?void c.info("[AtcCallInfo]: Empty services permitted, keeping last values"):(a.rSP&&void 0!==a.rSP.cCSs&&(this.servicesPermitted.rSP=a.rSP),void 0!==a.eSP&&(this.servicesPermitted.eSP=a.eSP),void c.info("[AtcCallInfo]: Updated services permitted: ",this.servicesPermitted))},this.clearServicesPermitted=function(){this.servicesPermitted={}},this.getServicesPermitted=function(){return this.servicesPermitted},this.isHandoverAllowed=function(){return(this.isSilentHandoverAllowed()||this.isSeamlessHandoverAllowed())&&!this.isHandoverInProgress()},this.isSeamlessHandoverAllowed=function(){return!(!this.servicesPermitted.eSP||!this.servicesPermitted.eSP.zseHo)},this.isSilentHandoverAllowed=function(){return!(!this.servicesPermitted.eSP||!this.servicesPermitted.eSP.zsiHo)},this.isTransferAllowed=function(){return!(!this.servicesPermitted.rSP||!this.servicesPermitted.rSP.cCSs.sST||this.isHandoverInProgress())},this.isAlternateAllowed=function(){return!(!this.servicesPermitted.rSP||!this.servicesPermitted.rSP.cCSs.alC)},this.isAnswerAllowed=function(){return this.servicesPermitted.rSP?!!this.servicesPermitted.rSP.cCSs.anC:this.cstaState===f.Ringing},this.isCallBackAllowed=function(){return!(!this.servicesPermitted.rSP||!this.servicesPermitted.rSP.cCSs.cB)},this.isConsultAllowed=function(){return!(!this.servicesPermitted.rSP||!this.servicesPermitted.rSP.cCSs.csC)},this.isDeflectAllowed=function(){return this.cstaState===f.Parked||this.cstaState===f.Ringing||!(!this.servicesPermitted.rSP||!this.servicesPermitted.rSP.cCSs.dCl)},this.isGenerateDigitsAllowed=function(){return!(!this.servicesPermitted.rSP||!this.servicesPermitted.rSP.cAS.gD)},this.isHoldAllowed=function(){if(this.isHandoverInProgress())return!1;if(this.servicesPermitted.rSP)return this.servicesPermitted.rSP.cCSs.hCl;switch(this.cstaState){case f.Active:case f.Conference:case f.Held:return!0;default:return!1}},this.isConferenceCall=function(){return this.cstaState===f.Conference||this.cstaState===f.ConferenceHolding},this.isMakeCallAllowed=function(){return!(!this.servicesPermitted.rSP||!this.servicesPermitted.rSP.cCSs.mCl)},this.isReconnectAllowed=function(){return!(!this.servicesPermitted.rSP||!this.servicesPermitted.rSP.cCSs.rC)},this.isRetrieveAllowed=function(){if(this.isHandoverInProgress())return!1;if(this.servicesPermitted.rSP)return this.servicesPermitted.rSP.cCSs.reC;switch(this.cstaState){case f.ConferenceHolding:case f.Holding:case f.HoldOnHold:return!0;default:return!1}},this.isTransferCallAllowed=function(){return!(!this.servicesPermitted.rSP||!this.servicesPermitted.rSP.cCSs.tCl||this.isHandoverInProgress())},this.isConferenceCallAllowed=function(){return!(!this.servicesPermitted.rSP||!this.servicesPermitted.rSP.cCSs.coC)},this.getPosition=function(){return this.position},this.setPosition=function(a){a&&a!==this.position&&(this.position=a,c.debug("[AtcCallInfo]: Set call position to ",a.name))},this.getMissedReason=function(){return this.missedReason},this.setMissedReason=function(a){a&&a!==this.missedReason&&(this.missedReason=a,c.debug("[AtcCallInfo]: Set missedReason to ",a))},this.getIgnoreCall=function(){return this.ignoreCall||this.cstaState===f.Offered},this.setIgnoreCall=function(a){this.ignoreCall=a},this.isHandoverInProgress=function(){return this.handoverInProgress},this.setHandoverInProgress=function(){this.handoverInProgress=!0},this.clearHandoverInProgress=function(){this.handoverInProgress=!1},this.isHoldInProgress=function(){return this.holdInProgress},this.setHoldInProgress=function(){this.holdInProgress=!0},this.clearHoldInProgress=function(){this.holdInProgress=!1},this.isRetrieveInProgress=function(){return this.retrieveInProgress},this.setRetrieveInProgress=function(){this.retrieveInProgress=!0},this.clearRetrieveInProgress=function(){this.retrieveInProgress=!1},this.setTransferCallFailedCause=function(b){if(this.cstaState===f.TransferFailed)switch(b){case"busy":a=k.Busy;break;case"doNotDisturb":a=k.DND;break;default:a=k.Unreachable}},this.getTransferCallFailedCause=function(){return this.cstaState===f.TransferFailed?a||k.Unreachable:null},this.setRedirectingUser=function(a,b,c,d,e){e=e||this.redirectingUser.redirectionType,this.redirectingUser&&this.redirectingUser.fqNumber&&this.redirectingUser.fqNumber!==b||(this.redirectingUser={userId:d||"",displayName:c,phoneNumber:a,fqNumber:b,redirectionType:e})},this.getRedirectingUser=function(){return this.redirectingUser},this.setRedirectionType=function(a){this.redirectingUser.redirectionType=a},this.getRedirectionType=function(){return this.redirectingUser&&this.redirectingUser.redirectionType},this.isForwarded=function(){return this.redirectingUser&&this.redirectingUser.redirectionType===l.CallForward}}var c=a.logger,d=a.Utils,e={WebRTC:{name:"WebRTC",ui:"res_CircuitClient",css:"circuit"},Cell:{name:"Cell",ui:"res_BackupNumber",css:"mobile"},Desk:{name:"Desk",ui:"res_Deskphone",css:"desk"},VM:{name:"VM",ui:"res_Voicemail",css:"vm"},Other:{name:"Other",ui:"res_CallAtOther",css:""}},f=Object.freeze({Idle:{name:"Idle",ui:"",established:!1},Initiated:{name:"Initiated",established:!1},Connecting:{name:"Connecting",established:!1},Delivered:{name:"Delivered",established:!1},Busy:{name:"Busy",established:!1},Offered:{name:"Offered",established:!1},Failed:{name:"Failed",established:!1},TransferFailed:{name:"TransferFailed",established:!1},Ringing:{name:"Ringing",established:!1},ExtendedRinging:{name:"ExtendedRinging",established:!1},Active:{name:"Active",established:!0},Held:{name:"Held",established:!0},Holding:{name:"Holding",established:!0},HoldOnHold:{name:"HoldOnHold",established:!0},Parked:{name:"Parked",established:!0},Conference:{name:"Conference",established:!0},ConferenceHolding:{name:"ConferenceHolding",established:!0},Terminated:{name:"Terminated",established:!1}}),g=Object.freeze({DefaultRouting:{name:"DefaultRouting",ui:"res_BusyHandling_DefaultRouting"},BusySignal:{name:"BusySignal",ui:"res_BusyHandling_BusySignal"},SendToAlternativeNumber:{name:"SendToAlternativeNumber",ui:"res_BusyHandling_AlternativeNumber"},SendToVM:{name:"SendToVM",ui:"res_BusyHandling_Voicemail"}}),h=Object.freeze({DefaultRouting:{name:"DefaultRouting",ui:"res_BusyHandling_DefaultRouting",desc:"res_DefaultRoutingDescription",newDesc:"res_DefaultRoutingDescriptionTimersPBXConfigurable"},DeskPhone:{name:"DeskPhone",ui:"res_Deskphone",desc:"res_DeskphoneRoutingDescription"},AlternativeNumber:{name:"AlternativeNumber",ui:"res_BusyHandling_AlternativeNumber",desc:"res_AlternativeNumberRoutingDescription"},VM:{name:"VoiceMail",ui:"res_Voicemail",desc:"res_VoicemailRoutingDescription"},Other:{name:"Other",ui:"res_Other",desc:""}}),i=Object.freeze({REGULAR:"REGULAR",MISSED:"MISSED"}),j=Object.freeze({DEFAULT:"DEFAULT",DEST_OUT_OF_ORDER:"DEST_OUT_OF_ORDER",REORDER_TONE:"REORDER_TONE",BUSY:"BUSY",CANCELLED:"CANCELLED",DECLINED:"DECLINED",TRANSFERRED:"TRANSFERRED"}),k=Object.freeze({Busy:{name:"Busy",ui:"res_TransferCallFailedCauseBusy"},Unreachable:{name:"Unreachable",ui:"res_TransferCallFailedCauseUnreachable"},DND:{name:"Dnd",ui:"res_TransferCallFailedCauseDND"}}),l=Object.freeze({CallForward:{name:"callForward",ui:"res_ForwardedFrom"}}),m=Object.freeze({Ready:"ready",NotReady:"notReady"});return a.AtcCallInfo=b,a.Enums=a.Enums||{},a.Enums.CstaCallState=f,a.Enums.Targets=e,a.Enums.JournalEntryTypes=i,a.Enums.MissedReasonTypes=j,a.BusyHandlingOptions=g,a.RoutingOptions=h,a.Enums.TransferCallFailedCauses=k,a.Enums.RedirectionTypes=l,a.Enums.AgentState=m,a}(Circuit||{}),Circuit=function(a){"use strict";function b(a,b){function e(a){h=a.rtcSessionId,n=a.convId,o=a.type,p=a.topic||a.participantFirstNames||null,q=a.topicEscaped||a.participantFirstNamesEscaped||null,r=a.creatorId,t=a.type===c.ConversationType.DIRECT,u=a.type===c.ConversationType.LARGE,v=a.isTelephonyConv,w=a.testCall,t?g.peerUser=a.peerUser:delete g.peerUser,g.peerUsers=a.peerUsers,g.numConvParticipants=a.participants.length,g.avatar=a.avatar,g.isGuestInvite=!!a.isTemporary}if(!a)throw new Error("Cannot create BaseCall object without a conversation");b=!!b;var g=this,h=null,m=null,n=null,o=null,p=null,q=null,r=null,s=null,t=!1,u=!1,v=!1,w=!1,x=l.Idle,y=null;Object.defineProperties(this,{isRemote:{value:b,writable:!1,enumerable:!0,configurable:!1},callId:{get:function(){return h},enumerable:!0,configurable:!1},instanceId:{get:function(){return m},enumerable:!0,configurable:!1},transactionId:{get:function(){return s},enumerable:!0,configurable:!1},state:{get:function(){return x},enumerable:!0,configurable:!1},convId:{get:function(){return n},enumerable:!0,configurable:!1},convType:{get:function(){return o},enumerable:!0,configurable:!1},convTitle:{get:function(){return p||(t?this.peerUser.displayName:"")},enumerable:!0,configurable:!1},convTitleEscaped:{get:function(){return q||(t?this.peerUser.displayNameEscaped:"")},enumerable:!0,configurable:!1},containsExternals:{get:function(){return this.participants.some(function(a){return a.participantType===c.RTCParticipantType.SESSION_GUEST||a.participantType===c.RTCParticipantType.EXTERNAL})},enumerable:!1,configurable:!1},ownerId:{get:function(){return r},enumerable:!0,configurable:!1},isDirect:{get:function(){return t},enumerable:!0,configurable:!1},isLarge:{get:function(){return u},enumerable:!0,configurable:!1},conferenceCall:{get:function(){return!t},enumerable:!0,configurable:!1},isGroupCallStarted:{get:function(){return!(this.isDirect||this.state!==l.Started)},enumerable:!0,configurable:!1},isGroupCallInitiated:{get:function(){return!(this.isDirect||this.state!==l.Initiated)},enumerable:!0,configurable:!1},isGroupCallActive:{get:function(){return!(this.isDirect||this.state!==l.Active)},enumerable:!0,configurable:!1},isTelephonyCall:{get:function(){return v},enumerable:!0,configurable:!1},isTestCall:{get:function(){return w},enumerable:!0,configurable:!1},conversationFeedView:{get:function(){return!0},enumerable:!0,configurable:!0},isPullAllowed:{value:!1,enumerable:!0,configurable:!0},isHandoverAllowed:{get:function(){return!!this.atcCallInfo&&this.atcCallInfo.isHandoverAllowed()},enumerable:!0,configurable:!0},isHandoverInProgress:{get:function(){return!!this.atcCallInfo&&this.atcCallInfo.isHandoverInProgress()},enumerable:!0,configurable:!0},redirectingUser:{get:function(){return this.getRedirectingUser()},enumerable:!0,configurable:!0},forwarded:{get:function(){return this.isForwarded()},enumerable:!0,configurable:!0},disconnectCause:{get:function(){return y},set:function(a){y=a},enumerable:!0,configurable:!1
},transferCallFailedCause:{get:function(){return this.atcCallInfo?this.atcCallInfo.getTransferCallFailedCause():null},enumerable:!0,configurable:!1},isATCCall:{get:function(){return!!this.atcCallInfo},enumerable:!0,configurable:!1}}),this.localMediaType={audio:!1,video:!1,desktop:!1},this.mediaType={audio:!1,video:!1,desktop:!1},this.lastMediaType=this.mediaType,this.direction=k.NONE,this.secureCall=!1,this.establishedTime=0,this.creationTime=Date.now(),this.peerUsers=null,this.peerUser=null,this.numConvParticipants=0,this.avatar=null,this.activeNotification=null,this.activeRTPStatsWarning=null,this.participants=[],this.participantsHashTable={},this.attendeeCount=0,this.remotelyMuted=!1,this.sessionMuted=!1,this.sessionLocked=!1,this.whiteboardEnabled=!1,this.recording={state:c.RecordingInfoState.INITIAL,notifyByCurtain:!1,notifyByUser:!1,duration:0,starter:{userId:""},reason:c.RecordingInfoReason.NONE,resumeTime:0,wasStarted:function(){return this.state!==c.RecordingInfoState.INITIAL},isActive:function(){return this.state===c.RecordingInfoState.STARTED||this.state===c.RecordingInfoState.START_PENDING},isPaused:function(){return this.state===c.RecordingInfoState.START_PENDING},isFailed:function(){return this.reason!==c.RecordingInfoReason.NONE&&this.reason!==c.RecordingInfoReason.STOPPED_MANUALLY&&this.reason!==c.RecordingInfoReason.STOPPED_AUTOMATICALLY&&(this.state===c.RecordingInfoState.INITIAL||this.state===c.RecordingInfoState.STOPPED)}},this.setState=function(a,b){if(a&&a!==x){if(x===l.Terminated)return void f.error("[BaseCall]: The call has already been terminated. Cannot set state to ",a.name);f.debug("[BaseCall]: Changing call state from "+x.name+" to "+a.name),this.establishedTime||!a.established||this.isATCCall&&!this.checkCstaState(d.Active)||(this.establishedTime=Date.now()),x=a,x!==l.Terminated||b||this.terminate()}},this.checkState=function(a){return Array.isArray(a)?a.some(function(a){return a===x}):a===x},this.updateCall=function(a){return!!a&&(e(a),!0)},this.setPeerUser=function(a,b,c){(this.peerUser.hasTelephonyRole||!this.peerUser.userId||c&&c!==this.peerUser.userId||j.cleanPhoneNumber(a)!==j.cleanPhoneNumber(this.peerUser.phoneNumber))&&(this.peerUser={userId:c||"",firstName:null,lastName:null,displayName:b,phoneNumber:a},i&&i.extend&&(this.peerUser=i.extend(this.peerUser)),p=b||a||null,q=p?j.textToHtmlEscaped(p):null)},this.setTransactionId=function(a){s=a||j.createTransactionId()},this.clearTransactionId=function(){s=null},this.setInstanceId=function(a){m=a},this.setCallIdForTelephony=function(a){g.isTelephonyCall&&a&&a!==h&&(f.debug("[BaseCall]: Changing callId from "+h+" to "+a),h=a)},e(a),a=null}var c=a.Constants,d=a.Enums.CstaCallState,e=a.DefaultAvatars,f=a.logger,g=a.Enums.ParticipantState,h=a.RtcParticipant,i=a.UserProfile,j=a.Utils,k=Object.freeze({INCOMING:"incoming",OUTGOING:"outgoing",NONE:""}),l=Object.freeze({Idle:{name:"Idle",ui:"",established:!1},Initiated:{name:"Initiated",ui:"res_Calling",established:!1,css:"outgoing"},Connecting:{name:"Connecting",ui:"",established:!1,css:"connecting"},Delivered:{name:"Delivered",ui:"res_Calling",established:!1,css:"outgoing"},Busy:{name:"Busy",ui:"res_BusyCall",established:!1,css:"busy"},Failed:{name:"Failed",ui:"res_FailedCall",established:!1,css:"failed"},Missed:{name:"Missed",ui:"res_MissedCall",established:!1,css:"missed"},Declined:{name:"Declined",ui:"res_CallDeclined",established:!1,css:"declined"},NotAnswered:{name:"NotAnswered",ui:"res_CallNotAnswered",established:!1,css:"not-answered"},Ringing:{name:"Ringing",ui:"res_IncomingCall",established:!1,css:"incoming"},Answering:{name:"Answering",ui:"res_IncomingCall",established:!1,css:"answering"},Active:{name:"Active",ui:"",established:!0,css:"active-call"},Held:{name:"Held",ui:"res_OnHold",established:!0,css:"active-call"},Holding:{name:"Holding",ui:"res_Holding",established:!0,css:"holding-call"},HoldOnHold:{name:"HoldOnHold",ui:"res_Holding",established:!0,css:"holding-call"},Waiting:{name:"Waiting",ui:"res_Waiting",established:!0,css:"waiting"},Started:{name:"Started",ui:"res_InProgress",established:!1,css:"started"},ActiveRemote:{name:"ActiveRemote",ui:"res_RemoteCall",established:!0,css:"active-call-remote"},Terminated:{name:"Terminated",ui:"res_Terminated",established:!1,css:"declined"}});return b.prototype.sameAs=function(a){return!!a&&this.callId===a.callId&&this.isRemote===a.isRemote},b.prototype.terminate=function(){f.debug("[BaseCall]: Terminating call with callId = ",this.callId),this.lastMediaType=this.mediaType,this.mediaType={audio:!1,video:!1,desktop:!1},this.setState(l.Terminated,!0)},b.prototype.isEstablished=function(){return this.state.established},b.prototype.isOutgoingState=function(){return this.state===l.Initiated||this.state===l.Connecting||this.state===l.Delivered||this.state===l.Busy},b.prototype.isPresent=function(){return this.state!==l.Idle&&this.state!==l.Terminated},b.prototype.isHeld=function(){return!1},b.prototype.hasRemoteMedia=function(){return!1},b.prototype.isCallingOut=function(){return this.state===l.Waiting&&this.participants.length>0&&this.participants.every(function(a){return a.pcState===g.Initiated})},b.prototype.hasVideo=function(){return!(!this.mediaType.video&&!this.mediaType.desktop)},b.prototype.updateSecurityStatus=function(a){a!==!0&&a!==!1||(this.secureCall=a)},b.prototype.canToggleVideo=function(){return!this.isRemote&&this.checkState([l.Active,l.Waiting])},b.prototype.hasRemoteVideo=function(){return!1},b.prototype.hasLocalVideo=function(){return this.localMediaType.video||this.localMediaType.desktop},b.prototype.hasLocalScreenShare=function(){return this.localMediaType.desktop},b.prototype.hasRemoteScreenShare=function(){return this.mediaType.desktop&&!this.localMediaType.desktop},b.prototype.isMuted=function(){return!1},b.prototype.mute=function(){return f.warning("[BaseCall]: Mute is not implemented in base object"),!1},b.prototype.unmute=function(){return f.warning("[BaseCall]: Unmute is not implemented in base object"),!1},b.prototype.toggleMute=function(){return f.warning("[BaseCall]: toggleMute is not implemented in base object"),!1},b.prototype.outgoingFailed=function(){return!this.isRemote&&this.direction===k.OUTGOING&&this.checkState([l.Declined,l.Busy,l.NotAnswered,l.Failed])},b.prototype.setPeerUsersAsParticipants=function(){if(this.direction===k.OUTGOING&&this.peerUsers){this.participants=this.peerUsers.map(function(a){return h.createFromUser(a,g.Initiated)});for(var a=0;a<this.participants.length;a++)this.participantsHashTable[this.participants[a].userId]=this.participants[a];f.debug("[BaseCall]: Initialized participants: ",this.participants)}},b.prototype.hasParticipant=function(a){return this.participants.some(function(b){return b.userId===a})},b.prototype.getParticipant=function(a){for(var b=0;b<this.participants.length;b++)if(this.participants[b].userId===a)return this.participants[b];return null},b.prototype.addParticipant=function(a,b,c){return a&&a.userId?(f.debug("[BaseCall]: Add participant with userId =",a.userId),this.hasParticipant(a.userId)?c?this.updateParticipant(a,b):(f.warning("[BaseCall]: addParticipant called with existing participant. userId =",a.userId),null):(b&&(a.pcState=b),this.participants.push(a),this.participantsHashTable[a.userId]=a,f.debug("[BaseCall]: Added participant to call: ",a.userId),a)):(f.warning("[BaseCall]: addParticipant called with invalid participant"),null)},b.prototype.updateParticipant=function(a,b){if(!a||!a.userId)return f.warning("[BaseCall]: updateParticipant called with invalid participant"),null;f.debug("[BaseCall]: Update participant with userId =",a.userId);var c=this.getParticipant(a.userId);return c?(c.pcState=b||a.pcState,c.streamId=a.streamId,c.screenStreamId=a.screenStreamId,c.muted=a.muted,c.mediaType=a.mediaType,c.screenSharePointerSupported=a.screenSharePointerSupported,f.debug("[BaseCall]: Updated participant data for ",c.userId),c):(f.warning("[BaseCall]: The given participant is not part of the call"),null)},b.prototype.removeParticipant=function(a){delete this.participantsHashTable[a];for(var b=0;b<this.participants.length;b++)if(this.participants[b].userId===a){var c=this.participants.splice(b,1)[0];return c.videoUrl="",c.mediaType={audio:!1,video:!1,desktop:!1},f.debug("[BaseCall]: Removed participant from call: ",c.userId),c}return null},b.prototype.setParticipantState=function(a,b){b&&this.participants.some(function(c){if(c.userId===a)return c.pcState=b,f.debug("[BaseCall]: Set participant state to "+b.name+", userId =",c.userId),!0})},b.prototype.hasOtherParticipants=function(){return this.participants.length>0||this.attendeeCount>0},b.prototype.updateMediaType=function(){var a={audio:this.localMediaType.audio,video:this.localMediaType.video,desktop:this.localMediaType.desktop};this.participants.forEach(function(b){b.mediaType&&(b.mediaType.audio&&(a.audio=!0),b.mediaType.video&&(a.video=!0),b.mediaType.desktop&&(a.desktop=!0))}),f.debug("[BaseCall]: Updating call media type to ",a),this.mediaType=a},b.prototype.callTypeCss=function(){if(this.isDirect)return this.hasVideo()?"webrtc-video":"webrtc-audio";if(this.isRemote)return"remote";switch(this.state.css){case"outgoing":return"ongoing";case"incoming":return"incoming";case"answering":return"answering";case"active-call":return"active";default:return""}},b.prototype.callHeaderType=function(){return this.isDirect?"Direct":this.isGuestInvite?"Guest":this.isLarge?"Large":"Group"},b.prototype.toString=function(){return JSON.stringify(this,null,3)},b.prototype.getCstaState=function(){return this.atcCallInfo?this.atcCallInfo.cstaState:null},b.prototype.setCstaState=function(a){this.atcCallInfo&&(this.atcCallInfo.cstaState=a,this.avatar=this.isHolding()?e.TELEPHONY_HOLD:e.TELEPHONY,this.consultation=this.consultation&&!this.isHolding())},b.prototype.checkCstaState=function(a){if(!this.atcCallInfo)return!1;if(!Array.isArray(a))return a===this.atcCallInfo.cstaState;var b=this;return a.some(function(a){return a===b.atcCallInfo.cstaState})},b.prototype.isHolding=function(){return!!this.atcCallInfo&&this.checkCstaState([d.Holding,d.HoldOnHold,d.ConferenceHolding])},b.prototype.isHoldAllowed=function(){return!!this.atcCallInfo&&this.atcCallInfo.isHoldAllowed()},b.prototype.isConsultAllowed=function(){return!!this.atcCallInfo&&this.atcCallInfo.isConsultAllowed()},b.prototype.isConferenceCallAllowed=function(){return!!this.atcCallInfo&&this.atcCallInfo.isConferenceCallAllowed()},b.prototype.isRetrieveAllowed=function(){return!!this.atcCallInfo&&this.atcCallInfo.isRetrieveAllowed()},b.prototype.isTransferCallAllowed=function(){return!!this.atcCallInfo&&this.atcCallInfo.isTransferCallAllowed()},b.prototype.isTransferAllowed=function(){return!!this.atcCallInfo&&this.atcCallInfo.isTransferAllowed()},b.prototype.getPosition=function(){return this.atcCallInfo?this.atcCallInfo.getPosition():null},b.prototype.setAtcHandoverInProgress=function(){this.atcCallInfo&&this.atcCallInfo.setHandoverInProgress()},b.prototype.clearAtcHandoverInProgress=function(){this.atcCallInfo&&this.atcCallInfo.clearHandoverInProgress()},b.prototype.isHoldInProgress=function(){return!!this.atcCallInfo&&this.atcCallInfo.isHoldInProgress()},b.prototype.setHoldInProgress=function(){this.atcCallInfo&&this.atcCallInfo.setHoldInProgress()},b.prototype.clearHoldInProgress=function(){this.atcCallInfo&&this.atcCallInfo.clearHoldInProgress()},b.prototype.isRetrieveInProgress=function(){return!!this.atcCallInfo&&this.atcCallInfo.isRetrieveInProgress()},b.prototype.setRetrieveInProgress=function(){this.atcCallInfo&&this.atcCallInfo.setRetrieveInProgress()},b.prototype.clearRetrieveInProgress=function(){this.atcCallInfo&&this.atcCallInfo.clearRetrieveInProgress()},b.prototype.isDtmfAllowed=function(){return!1},b.prototype.isAtcConferenceCall=function(){return!!this.atcCallInfo&&this.atcCallInfo.isConferenceCall()},b.prototype.setRedirectingUser=function(a,b,c,d,e){this.atcCallInfo&&this.atcCallInfo.setRedirectingUser(a,b,c,d,e)},b.prototype.getRedirectingUser=function(){return this.atcCallInfo?this.atcCallInfo.getRedirectingUser():null},b.prototype.setRedirectionType=function(a){if(this.atcCallInfo)return this.atcCallInfo.setRedirectionType(a)},b.prototype.getRedirectionType=function(){return this.atcCallInfo?this.atcCallInfo.getRedirectionType():null},b.prototype.isForwarded=function(){return!!this.atcCallInfo&&this.atcCallInfo.isForwarded()},b.prototype.setDisconnectCause=function(a,b){this._disconnectCause||(this.disconnectCause={cause:a,reason:b})},a.BaseCall=b,a.Enums=a.Enums||{},a.Enums.CallDirection=k,a.Enums.CallState=l,a}(Circuit||{}),Circuit=function(a){"use strict";function b(a){var c=Circuit.logger;if(!a||!a.rtcSessionId)throw new Error("Cannot create RemoteCall object without a valid conversation");b.parent.constructor.call(this,a,!0),Object.defineProperties(this,{isPullAllowed:{get:function(){return!this.pullNotAllowed&&this.state===d.ActiveRemote},enumerable:!0,configurable:!1}}),this.activeClient=null,a=null,c.info("[RemoteCall]: Created new remote call with callID = ",this.callId)}var c=a.BaseCall,d=a.Enums.CallState,e=a.Proto,f=a.Utils;return f.inherit(b,c),b.prototype.setActiveClient=function(a){a&&(a.userId?(this.activeClient={clientId:a.clientId,clientDisplayName:a.clientDisplayName,mediaType:e.getMediaType(a.mediaTypes)},this.pullNotAllowed=a.pullCall===!1):this.activeClient=a)},a.RemoteCall=b,a}(Circuit||{}),Circuit=function(a){"use strict";var b=Object.freeze({Disconnected:"Disconnected",Unregistered:"Unregistered",Registering:"Registering",Registered:"Registered"});return a.Enums=a.Enums||{},a.Enums.AtcRegistrationState=b,a}(Circuit||{}),Circuit=function(a){"use strict";function b(c,e){function g(){s||(s=new q({callId:r.callId,isDirectCall:r.isDirect,isTelephonyCall:r.isTelephonyCall,isLargeConference:r.isLarge,isAtcPullCall:e.isAtcPullCall,reuseDesktopStreamFrom:e.reuseDesktopStreamFrom}),s.onMediaUpdate=l,s.onLocalVideoURL=m,s.onRemoteObjectURL=o,s.onScreenSharePointerStatus=n,r.isDirect||s.setExtraVideoChannelsForParticipants(r.numConvParticipants))}function k(){s&&(s.onMediaUpdate=null,s.onLocalVideoURL=null,s.onRemoteObjectURL=null,s.onScreenSharePointerStatus=null)}function l(){d.debug("[LocalCall]: RtcSessionController - onMediaUpdate: callId =",r.callId),r.activeMediaType=s.getActiveMediaType(),d.debug("[LocalCall]: Set active media type to ",r.activeMediaType),r.localMediaType=s.getMediaConstraints(),d.debug("[LocalCall]: Set local media type to ",r.localMediaType),r.updateMediaType(),r.updateCallState()}function m(a){d.debug("[LocalCall]: RtcSessionController - onLocalVideoURL: callId =",r.callId),r.localVideoUrl=a.url,d.debug("[LocalCall]: Set local video URL to",a.url||"<empty>")}function n(a){d.debug("[LocalCall]: RtcSessionController - onScreenSharePointerStatus",a),r.pointer={isSupported:a.isSupported,isEnabled:a.isEnabled}}function o(a){d.debug("[LocalCall]: RtcSessionController - onRemoteObjectURL: callId =",r.callId),r.remoteAudioUrl=a.audioUrl&&a.audioUrl.url||"",d.debug("[LocalCall]: Set remote audio URL to",r.remoteAudioUrl||"<empty>"),r.remoteVideoUrlStreams=a.videoUrl||[],d.debug("[LocalCall]: Set remote video URL streams to",a.videoUrl||"<empty>"),r.participants.forEach(function(a){r.setParticipantRemoteVideoURL(a)}),r.checkForActiveRemoteVideo()}function p(a){a&&a.curtainState&&(B&&(a.lastCurtainState=B.curtainState),B=a,B.curtainClosed=a.curtainState!==i.CurtainState.OPEN)}e=e||{};var q=a.RtcSessionController;if(!c||!c.rtcSessionId)throw new Error("Cannot create LocalCall object without a valid conversation");b.parent.constructor.call(this,c,!1);var r=this,s=null,t=!1,u=null,v=!1,w=!1,x=!1,y=!1,z=!1,A=!1,B=null,C=null,D=null,E=null,F=!1,G=[],H=[],I=[],J=!1,K=15e3,L=9;Object.defineProperties(this,{sessionCtrl:{get:function(){return s},enumerable:!0,configurable:!1},isVdi:{get:function(){return!!s.isRemoteController},enumerable:!0,configurable:!1},locallyMuted:{get:function(){return s.isMuted()},enumerable:!0,configurable:!1},remoteVideoDisabled:{get:function(){return w},enumerable:!0,configurable:!1},remoteAudioDisabled:{get:function(){return x},enumerable:!0,configurable:!1},isMocked:{get:function(){return z},enumerable:!0,configurable:!1},isMeetingPointInvited:{get:function(){return A},enumerable:!0,configurable:!1},ringAllAllowed:{get:function(){return!!(this.peerUsers&&this.peerUsers.length>0&&this.peerUsers.length<=L)},enumerable:!0,configurable:!1},ringAllMaxNumber:{get:function(){return L},enumerable:!0,configurable:!1},conversationFeedView:{get:function(){return J||this.state===f.Ringing},set:function(a){J=a},enumerable:!0,configurable:!1},curtain:{get:function(){return B||{}},set:function(a){p(a)},enumerable:!0,configurable:!1},playbackDevice:{get:function(){return C},enumerable:!0,configurable:!1},recordingDevice:{get:function(){return D},enumerable:!0,configurable:!1},videoDevice:{get:function(){return E},enumerable:!0,configurable:!1},playbackDeviceList:{get:function(){return G},enumerable:!0,configurable:!1},recordingDeviceList:{get:function(){return H},enumerable:!0,configurable:!1},videoDeviceList:{get:function(){return I},enumerable:!0,configurable:!1},atcAdvancing:{get:function(){return F},set:function(a){F=!!a},enumerable:!0,configurable:!1},savedRTPStats:{get:function(){if(this.sessionCtrl)return this.sessionCtrl.getLastSavedStats()},enumerable:!0,configurable:!1}}),this.localVideoUrl="",this.remoteAudioUrl="",this.remoteVideoUrlStreams=[],this.activeMediaType={audio:!1,video:!1,desktop:!1},this.ringingTimeout=K,this.pointer={isSupported:!1,isEnabled:!1},this.terminate=function(){t||(d.debug("[LocalCall]: Terminating call with callId =",this.callId),k(),s.terminate(),this.localVideoUrl="",this.remoteAudioUrl="",this.remoteVideoUrlStreams=[],b.prototype.terminate.call(this),this.stopRingingTimer(),t=!0)},this.setMockedCall=function(){d.debug("[LocalCall]: Setting call as mocked"),z=!0,s.setMockedCall();var a=0===s.getNumberOfExtraVideoChannels();if(a){var b;this.participants.forEach(function(a){a.streamId="",(a.mediaType.desktop||!b&&a.mediaType.video)&&(b=a)}),b&&(b.streamId="mock")}else this.participants.forEach(function(a){a.streamId=a.mediaType.video||a.mediaType.desktop?"mock":""});window.setTimeout(function(){this.state!==f.Terminated&&(d.debug("[LocalCall]: Initialize remote mocked streams"),o({audioUrl:"",videoUrl:[{streamId:"mock",url:"content/images/mock/trailer.mp4"}]}),s.onRemoteObjectURL=null)},100)},this.startRingingTimer=function(a){"function"==typeof a&&(d.info("[LocalCall]: Starting ringing timer for callId =",r.callId),u=window.setTimeout(function(){d.info("[LocalCall]: Ringing timeout for callId =",r.callId),u=null,a()},this.ringingTimeout))},this.stopRingingTimer=function(){u&&(d.info("[LocalCall]: Cancelling ringing timer for callId =",r.callId),window.clearTimeout(u),u=null)},this.hasRemoteVideo=function(){return v},this.checkForActiveRemoteVideo=function(){v=!w&&this.participants.some(function(a){return!!a.videoUrl}),d.debug("[LocalCall]: Set hasActiveRemoteVideo to ",v)},this.enableRemoteVideo=function(){w&&(w=!1,this.checkForActiveRemoteVideo(),this.sessionCtrl.enableRemoteVideo(),d.debug("[LocalCall]: Enabled remote video"))},this.disableRemoteVideo=function(){w||(w=!0,v=!1,this.participants.forEach(function(a){a.videoUrl="",r.isDirect&&(a.streamId="")}),this.sessionCtrl.disableRemoteVideo(),d.debug("[LocalCall]: Disabled remote video"))},this.enableRemoteAudio=function(){x&&(x=!1,d.debug("[LocalCall]: Enabled remote audio."))},this.disableRemoteAudio=function(){x||(x=!0,d.debug("[LocalCall]: Disabled remote audio."))},this.setMeetingPointInviteState=function(a){A=!!a,d.debug("[LocalCall]: Set Circuit Meeting Point state to ",a)},this.setHasUnmutedParticipants=function(){y=this.participants.some(function(a){return!a.muted})},this.hasUnmutedParticipants=function(){return y},this.getUnmutedParticipantIds=function(){var a=[];return this.participants.forEach(function(b){b.muted||a.push(b.userId)}),a},this.getMediaNode=function(){return this.isTestCall?q.mediaNode:null},this.updateMediaDevices=function(){var a=function(a){return a?a.filter(function(a){return"default"!==a.id&&"communications"!==a.id&&a.label}).map(function(a){return a.label}):[]};j.getMediaSources(function(b,c,e){if(j.getMediaSourcesSupported){var f=h.selectMediaDevice(e,q.playbackDevices);C=f&&f.label,G=a(e),f=h.selectMediaDevice(b,q.recordingDevices),D=f&&f.label,H=a(b),f=h.selectMediaDevice(c,q.videoDevices),E=f&&f.label,I=a(c)}else C=Audio.getPlaybackDevice&&Audio.getPlaybackDevice(),D=Audio.getRecordingDevice&&Audio.getRecordingDevice(),E=Audio.getVideoDevice&&Audio.getVideoDevice();d.debug("[LocalCall]: Updated media devices: recording="+D+" playback="+C+" video="+E+" callId="+r.callId)})},g(),c=null,r.updateMediaDevices(),d.info("[LocalCall]: Created new WebRTC call with callID = ",this.callId)}function c(a,b){if(!b.mediaType.video&&!b.mediaType.desktop)return void(b.streamId="");var c=0===a.sessionCtrl.getNumberOfExtraVideoChannels();if(c){var d;a.participants.some(function(a){if(a.streamId)return d=a,!0}),b.streamId=d&&d.userId!==b.userId?"":"mock"}else b.streamId="mock"}var d=a.logger,e=a.BaseCall,f=a.Enums.CallState,g=a.Enums.ParticipantState,h=a.Utils,i=a.Constants,j=a.WebRTCAdapter,k="SERVER_ENDED:",l=Object.freeze({SERVER_ENDED_PRFX:k}),m="CLIENT_ENDED:",n=Object.freeze({CLIENT_ENDED_PRFX:m,ANOTHER_CLIENT_ANSWERED:m+"ANOTHER_CLIENT_ANSWERED",ANOTHER_CLIENT_REJECTED:m+"ANOTHER_CLIENT_REJECTED",ANOTHER_CLIENT_PULLED_CALL:m+"ANOTHER_CLIENT_PULLED_CALL",CALL_MOVED_TO_ANOTHER_CONV:m+"CALL_MOVED_TO_ANOTHER_CONV",CALLER_LEFT_CONFERENCE:m+"CALLER_LEFT_CONFERENCE",ENDED_BY_ANOTHER_USER:m+"ENDED_BY_ANOTHER_USER",LOST_WEBSOCKET_CONNECTION:m+"LOST_WEBSOCKET_CONNECTION",NO_USERS_LEFT:m+"NO_USERS_LEFT",REQUEST_TO_SERVER_FAILED:m+"REQUEST_TO_SERVER_FAILED",RTC_SESSION_START_FAILED:m+"RTC_SESSION_START_FAILED",SET_REMOTE_SDP_FAILED:m+"SET_REMOTE_SDP_FAILED",USER_ENDED:m+"USER_ENDED",LOST_MEDIA_STREAM:m+"LOST_MEDIA_STREAM",ICE_TIMED_OUT:m+"ICE_TIMED_OUT",USER_LOGGED_OUT:m+"USER_LOGGED_OUT",PAGE_UNLOADED:m+"PAGE_UNLOADED",DISCONNECTED:m+"WS_DISCONNECTED",FAILED_TO_SEND:m+"WS_FAILED_TO_SEND",REQUEST_TIMEOUT:m+"WS_REQUEST_TIMEOUT",MEDIA_RENEGOTIATION:m+"MEDIA_RENEGOTIATION"});return h.inherit(b,e),b.prototype.hasRemoteMedia=function(){return!(!this.remoteAudioUrl&&!this.remoteVideoUrlStreams.length)},b.prototype.hasRemoteScreenShare=function(){return this.mediaType.desktop&&!this.remoteVideoDisabled&&(!this.localMediaType.desktop||this.isDirect&&this.participants[0].mediaType.desktop)},b.prototype.addParticipant=function(a){this.isMocked&&a&&a.mediaType&&c(this,a);var d=b.parent.addParticipant.apply(this,arguments);return d&&(this.setParticipantRemoteVideoURL(d),this.checkForActiveRemoteVideo(),this.setHasUnmutedParticipants()),d},b.prototype.updateParticipant=function(a){this.isMocked&&a&&a.mediaType&&c(this,a);var d=b.parent.updateParticipant.apply(this,arguments);return d&&(this.setParticipantRemoteVideoURL(d),this.checkForActiveRemoteVideo(),this.setHasUnmutedParticipants()),d},b.prototype.removeParticipant=function(){var a=b.parent.removeParticipant.apply(this,arguments);return a&&this.setHasUnmutedParticipants(),a},b.prototype.setParticipantRemoteVideoURL=function(a){if(a.videoUrl="",this.isDirect&&(a.streamId=""),!this.remoteVideoDisabled){if(a.mediaType&&!a.mediaType.video&&!a.mediaType.desktop)return void d.debug("[LocalCall]: The participant does not have video or screen-share. Do not set video URL. userId = ",a.userId);if(this.isDirect){if(this.remoteVideoUrlStreams&&this.remoteVideoUrlStreams.length){var b=this.remoteVideoUrlStreams[this.remoteVideoUrlStreams.length-1];a.streamId=b.streamId,a.videoUrl=b.url,a.pcState=a.muted?g.Muted:g.Active}}else{if(!a.streamId&&!a.screenStreamId)return void d.info("[LocalCall]: The participant does not have a video streamId. userId = ",a.userId);this.remoteVideoUrlStreams&&this.remoteVideoUrlStreams.length&&this.remoteVideoUrlStreams.some(function(b){if(b.streamId===a.streamId||b.streamId===a.screenStreamId)return a.videoUrl=b.url,a.pcState=a.muted?g.Muted:g.Active,d.debug("[LocalCall]: Set remote video URL for participant: ",a),!0})}a.videoUrl||d.debug("[LocalCall]: We still do not have a video URL for the participant. ",a)}},b.prototype.hasLocalScreenShare=function(){return this.sessionCtrl.hasScreenShare()},b.prototype.isMuted=function(){return this.remotelyMuted||this.locallyMuted},b.prototype.mute=function(a){return this.checkState(f.Terminated)?(d.error("[LocalCall]: Cannot mute a call that has already been terminated"),!1):(d.debug("[LocalCall]: Mute call with callId =",this.callId),this.sessionCtrl.mute(a))},b.prototype.unmute=function(a){return this.checkState(f.Terminated)?(d.error("[LocalCall]: Cannot mute a call that has already been terminated"),!1):(d.debug("[LocalCall]: Unmute call with callId =",this.callId),this.sessionCtrl.unmute(a))},b.prototype.isLocalMuteAllowed=function(){return this.sessionCtrl.isLocalMuteAllowed()},b.prototype.toggleMute=function(){return this.sessionCtrl.isMuted()?this.unmute():this.mute()},b.prototype.setActiveSpeakers=function(a){if(!a)return!1;a instanceof Array||(a=[a]);var b=!1;return this.participants.forEach(function(c){var d=a.indexOf(c.userId)!==-1;c.activeSpeaker!==d&&(c.activeSpeaker=d,b=!0)}),b},b.prototype.updateCallState=function(){if(this.state.established){var a;a=!this.sessionCtrl.isConnected()||!this.isDirect&&!this.hasOtherParticipants()||this.isATCCall&&!this.getCstaState().established?f.Waiting:this.sessionCtrl.isHolding()?f.Holding:this.sessionCtrl.isHeld()?f.Held:f.Active,this.setState(a)}},b.prototype.isDtmfAllowed=function(){return!!this.checkState([f.Active,f.Delivered])&&(!!this.sessionCtrl.canSendDTMFDigits()||!!this.checkState(f.Active)&&!!this.atcCallInfo)},a.LocalCall=b,a.Enums.CallServerTerminatedReason=l,a.Enums.CallClientTerminatedReason=n,a}(Circuit||{}),Circuit=function(a){"use strict";var b=a.AppMessagingHandlerSingleton,c=a.ChromeExtension,d=a.Constants,e=a.logger,f=a.Utils,g=a.TemasysAdapter,h=function(){var h=b?b.getInstance():null,i={getScreen:function(a,b){b&&b("NOT_SUPPORTED")},unregEvtHandlers:function(){},isScreensharingAvailable:function(){return!1},installExtension:function(){},injectExtensionSvc:function(){},injectTemasysSvc:function(){}};if("iOS"===window.navigator.platform)return i;var j,k=f.getBrowserInfo();if(a.isElectron)i.getScreen=function(a,b,c){var f=require("electron").ipcRenderer;f.once("screenshare-chooser",function(f,g,h){"share"===g?(e.info("[ScreenSharingController]: Got screen share stream. Stream id: ",h.streamId),c(a,b,h.streamId,null,h.pointer)):"cancel"===g&&(e.info("[ScreenSharingController]: User canceled screen share"),b&&b(d.ReturnCode.CHOOSE_DESKTOP_MEDIA_CANCELLED))}),e.info("[ScreenSharingController]: Request screen in Electron"),f.send("screenshare-chooser","open")},i.isScreensharingAvailable=function(){return!0};else if(a.isVdiApp)i.getScreen=function(a,b,c){h.sendInternalMessage({method:"showwindow"}),window.setTimeout(function(){chrome.desktopCapture.chooseDesktopMedia(["screen"],null,function(d){h.sendInternalMessage({method:"minimizewindow"}),c(a,b,d)})},0)},i.isScreensharingAvailable=function(){return!0};else if(k.chrome||k.phantomjs){var l,m,n,o=function(a,b,f){var g=f.data;switch(f.suppressLog||e.info("[ScreenSharingController]: Received screenshare event from extension - ",g.type),g.type){case c.BgScreenShareMsgType.CHOOSE_DESKTOP_MEDIA_DONE:e.info("[ScreenSharingController]: CHOOSE_DESKTOP_MEDIA done. Stream Id:",g.streamId),q(m),j&&j(a,b,g.streamId);break;case c.BgScreenShareMsgType.CHOOSE_DESKTOP_MEDIA_CANCELLED:e.info("[ScreenSharingController]: CHOOSE_DESKTOP_MEDIA cancelled"),q(m),b(d.ReturnCode.CHOOSE_DESKTOP_MEDIA_CANCELLED)}},p=function(a,b){if(l)return q(m),m=o.bind(null,a,b),l.addEventListener(c.BgTarget.SCREEN_SHARE,m),m},q=function(a){a&&a===m&&l&&m&&(l.removeEventListener(c.BgTarget.SCREEN_SHARE,m),m=null)};i.getScreen=function(a,b,c){var d=null;return n&&n.isExtensionRunning()?(j=c,d=p(a,b),l.getScreenShareUserMedia(function(a){a&&(e.warn("[ScreenSharingController]: Error starting screen share using chrome extension: ",a),q(d),b("res_AccessToExtensionFailed"))})):b("res_AccessToExtensionFailed"),d},i.isScreensharingAvailable=function(){return!!n&&n.isExtensionRunning()},i.installExtension=function(){n&&(e.debug("[ScreenSharingController]: Install Chrome extension"),n.installExtension(!0).then(function(){e.info("[ScreenSharingController]: Chrome extension was successfully installed")}).catch(function(a){e.warn("[ScreenSharingController]: Failed to install Chrome extension. ",a)}))},i.injectExtensionSvc=function(a,b){n=a,l=b},i.unregEvtHandlers=q}else if(k.msie){var r;i.getScreen=function(a,b,c){g&&g.isScreensharingAvailable()?c(a,b):b("NOT_AVAILABLE")},i.isScreensharingAvailable=function(){return!!g&&g.isScreensharingAvailable()},i.installExtension=function(){r&&r.showPopup()},i.injectTemasysSvc=function(a){r=a}}else if(k.firefox){var s=33;i.getScreen=function(a,b,c,d){c(a,b,null,d)},i.isScreensharingAvailable=function(){return parseInt(k.version,10)>=s}}else"Android"===window.navigator.platform&&(i.getScreen=function(a,b,c,d){c(a,b,null,d)},i.isScreensharingAvailable=function(){return!0});return i}();return a.ScreenSharingController=h,a}(Circuit||{}),Circuit=function(a){"use strict";function b(b,c,d,e,f){if(!c||!d)return null;var h,i,j={startTime:b,pcType:e,audio:{},video:{}},k=c.result?c.result():c;if(!Array.isArray(k))return null;if(k.forEach(function(a){if(a){var b=null;if("googCandidatePair"===a.type&&"true"===a.stat("googActiveConnection"))"Channel-audio-1"===a.stat("googChannelId")?(j.audio.rtt=parseInt(a.stat("googRtt"),10),f&&(h=a.stat("localCandidateId"),j.audio.channelInfo=g.getChannelInfo(a))):(j.video.rtt=parseInt(a.stat("googRtt"),10),f&&(i=a.stat("localCandidateId"),j.video.channelInfo=g.getChannelInfo(a,a.stat("localCandidateId"))));else if("ssrc"===a.type){var c={id:a.id,ssrc:a.stat("ssrc"),timestamp:a.timestamp};a.stat("audioInputLevel")?(j.audio.transmit||(j.audio.transmit=c),b=j.audio.transmit):a.stat("audioOutputLevel")?(j.audio.receive||(j.audio.receive=c),b=j.audio.receive):a.stat("googFrameHeightSent")?(j.video.transmit||(j.video.transmit=c),b=j.video.transmit):a.stat("googFrameHeightReceived")&&(j.video.receive||(j.video.receive=c),b=j.video.receive)}else"VideoBwe"===a.type&&(j.video.bw||(j.video.bw={id:a.id}),b=j.video.bw);if(a.names&&b){var d=a.names()||[];d.forEach(function(c){m[c]&&(b[m[c]]=parseInt(a.stat(c),10))})}f&&b&&a.stat&&(b.en=a.stat("googCodecName"))}}),f){var l=j.audio.channelInfo?1:0;j.video.channelInfo&&l++;var n;k.some(function(b){if(b&&"localcandidate"===b.type){if(h===b.id&&j.audio.channelInfo)return j.audio.channelInfo.ni=b.stat("networkType"),n=n||a.sdpParser.parse(d.localDescription&&d.localDescription.sdp),j.audio.channelInfo.candidate=g.getIceCandidateInfo(b,n,"audio",b.stat("portNumber")),--l<=0;if(i===b.id&&j.video.channelInfo)return j.video.channelInfo.ni=b.stat("networkType"),n=n||a.sdpParser.parse(d.localDescription&&d.localDescription.sdp),j.video.channelInfo.candidate=g.getIceCandidateInfo(b,n,"video",b.stat("portNumber")),--l<=0}})}return j}function c(a,c,d,g){return new e(function(e){return a.getStats?void a.getStats(function(h){h?h=b(d,h,a,c,g):f.warn("[CallStatsHandler]: getStats["+c+"] did not return a response"),e(h)},function(a){f.warn("[CallStatsHandler]: getStats["+c+"] failed with err = ",a),e()}):void e()})}function d(b){function d(a){var b=[],d=!E;return E=E||d,y.forEach(function(e){if(e)return a||"completed"===e.iceConnectionState||"connected"===e.iceConnectionState?void(e.mainPeerConnection?(b.push(c(e.mainPeerConnection,"AUDIO/VIDEO",e.startTime,d)),e.groupPeerConnections.forEach(function(a){b.push(c(a,"AUX_VIDEO",e.startTime,d))})):b.push(c(e,"SCREEN_SHARE",e.startTime,d))):void f.warn("[CallStatsHandler]: Do not collect stats. pc.iceConnectionState = ",e.iceConnectionState);
}),new e(function(a){e.all(b).then(function(b){b=b&&b.filter(function(a,b){return a&&(a.audio&&!a.audio.channelInfo&&K[b]&&(a.audio.channelInfo=K[b]),a.video&&!a.video.channelInfo&&L[b]&&(a.video.channelInfo=L[b])),a}),b&&b.length?a(b):a()})})}function g(){G||H?(f.debug("[CallStatsHandler]: Restart collecting RTPStats"),z=null,A=null,B=null,C=!1):(f.debug("[CallStatsHandler]: Waiting to start collecting RTPstats"),G=window.setTimeout(function(){f.info("[CallStatsHandler]: Start collecting RTPStats"),G=null,I=0,r(),H=window.setInterval(function(){r()},k.COLLECTION_INTERVAL)},k.DELAY_UPON_ANSWER))}function h(a,b){var c=0,d=0;return b&&(c=b.pl||0,d=b.ps||0),(a.pl-c)/(a.ps-d||-1)}function m(a,b){var c=0,d=0;return b&&(c=b.pl||0,d=b.pr||0),(a.pl-c)/(a.pr-d+a.pl-c||-1)}function n(a,b,c){var d=c+"Sum",e=c+"Count",f=c+"Max";b?(void 0!==b[d]?(a[d]=b[d]+(a[c]||0),a[e]=++b[e]):(a[d]=a[c]||0,a[e]=1),void 0!==b[f]?a[f]=Math.max(b[f],a[c]||0):a[f]=a[c]||0):(a[d]=a[f]=a[c]||0,a[e]=1)}function o(a,b){var c;if(a&&(a.audio||a.video)){c="[CallStatsHandler]: statsReport: audioRtt="+(a.audio&&a.audio.rtt||"n/a")+" videoRtt="+((a.video.receive||a.video.transmit)&&a.video&&a.video.rtt||"n/a");var d;a.audio&&(d=a.audio.receive,d&&(c+="\n audioReceive:  id="+d.id+" pl="+d.pl+" pr="+d.pr+" jr="+d.jr),d=a.audio.transmit,d&&(c+="\n audioTransmit: id="+d.id+" pl="+d.pl+" ps="+d.ps+" os="+d.os)),a.video&&(d=a.video.receive,d&&(c+="\n videoReceive:  id="+d.id+" pl="+d.pl+" pr="+d.pr+" fwr="+d.fwr+" fhr="+d.fhr+" frd="+d.frd),d=a.video.transmit,d&&(c+="\n videoTransmit: id="+d.id+" pl="+d.pl+" ps="+d.ps+" frs="+d.frs+" os="+d.os+" fws="+d.fws+" fhs="+d.fhs)),f.debug(c)}if(b&&b.length){var e;c="[CallStatsHandler]: statsReport:\n",b.forEach(function(a,b){c+=0===b?" Audio issues=":"\n Video issues=";var d=Object.keys(a);d.length?(e=!0,d.forEach(function(b){c+=" "+b+"="+a[b].value+" count="+a[b].counter})):c+=" none"}),e&&f.info(c)}}function p(a,b,c,d,e,g){var h=a[b.StatText]||{},i=b.StatText+"LastViStart",j=b.StatText+"Violations",k=b.StatText+"ViCounter";if(e[i]=g&&g[i],e[j]=g&&g[j],e[k]=g&&g[k]||0,c===-1){if(e[i]){var l=e[j];l=l?l+",":"",e[j]=l+"("+e[i]+","+parseInt((Date.now()-d)/1e3,10)+")",e[k]++,delete e[i]}h.reported?h.counter=++h.counter:h.counter&&(delete a[b.StatText],f.debug("[CallStatsHandler]: issueCounter cleared=",b.StatText))}else h.reported?(h.counter=0,h.value=c):h.counter?(h.counter=++h.counter,h.value=c):(a[b.StatText]={statObj:b,counter:1,value:c},e[k]<x&&(e[i]=parseInt((Date.now()-d)/1e3,10)))}function q(a){if(a&&a.length){var b=!1;a.forEach(function(a,c){var d,e=a.audio&&a.audio.transmit,g=a.audio&&a.audio.receive,l=M[c]||{},o=N[c]||{},q=J[c]||{};g&&q.audio&&q.audio.receive&&!F.sendOnlyStream&&p(l,i.NO_PACKETS_RECV,!(g.pr>q.audio.receive.pr)||-1,a.startTime,a.audio,q.audio);var r=i.GOOG_JITTER_RECEIVED;if(g){n(g,q.audio&&q.audio.receive,i.GOOG_JITTER_RECEIVED.StatName);var s=g[r.StatName];p(l,r,s&&s>=r.Threshold?s:-1,a.startTime,a.audio,q.audio)}r=i.PACKET_LOSS_SEND,e&&e.pl&&e.ps&&(d=h(e,q.audio&&q.audio.transmit),p(l,r,d>=r.Threshold?d:-1,a.startTime,a.audio,q.audio)),r=i.PACKET_LOSS_RECV,g&&g.pl&&g.pr&&(d=m(g,q.audio&&q.audio.receive),p(l,r,d>=r.Threshold?d:-1,a.startTime,a.audio,q.audio)),a.audio&&I>k.DELAY_RTT_PROCESSING&&(n(a.audio,q.audio,i.GOOG_RTT.StatName),r=i.GOOG_RTT,p(l,r,a.audio.rtt>=r.Threshold?a.audio.rtt:-1,a.startTime,a.audio,q.audio)),e=a.video&&a.video.transmit,g=a.video&&a.video.receive,r=j.PACKET_LOSS_SEND,e&&e.pl&&e.ps&&(d=h(e,q.video&&q.video.transmit),p(o,r,d>=r.Threshold?d:-1,a.startTime,a.video,q.video)),r=j.PACKET_LOSS_RECV,g&&g.pl&&g.pr&&(d=m(g,q.video&&q.video.receive),p(o,r,d>=r.Threshold?d:-1,a.startTime,a.video,q.video)),(e||g)&&I>k.DELAY_RTT_PROCESSING&&(n(a.video,q.video,i.GOOG_RTT.StatName),r=j.GOOG_RTT,p(o,r,a.video&&a.video.rtt>=r.Threshold?a.video.rtt:-1,a.startTime,a.video,q.video)),a.audio&&a.audio.channelInfo&&(K[c]=a.audio.channelInfo),a.video&&a.video.channelInfo&&(L[c]=a.video.channelInfo),J[c]=a,M[c]=l,N[c]=o;var u=t(l),v=t(o);(u||v)&&(b=!0,D||(u=u||"none",v=v||"none",D=!0,u.noPacketsReceived?(f.warn("[CallStatsHandler]: processRTPStats - No packets received from remote peer"),O.onNoIncomingPackets&&O.onNoIncomingPackets()):(f.warn("[CallStatsHandler]: processRTPStats - Quality issues detected",[{audio:u},{video:v}]),O.onThresholdExceeded&&O.onThresholdExceeded())))}),!b&&D&&(f.debug("[CallStatsHandler]: processRTPStats - No quality issues detected. Clear threshold exceeded error."),D=!1,O.onThresholdExceeded&&O.onThresholdExceeded(!0)),(D||I%w===0)&&J.forEach(function(a,b){o(a,[M[b],N[b]])}),I++}}function r(){a.isElectron&&f.debug("[CallStatsHandler]: Get RTP stats for local call(s)"),d().then(function(b){b?(a.isElectron&&f.debug("[CallStatsHandler]: Process RTP stats for local call(s)"),q(b),u(b)):a.isElectron&&f.debug("[CallStatsHandler]: No RTP stats collected")})}function s(){return new e(function(a){d(!0).then(function(b){a(b)}),G?(f.debug("[CallStatsHandler]: cancel collecting RTPStats "),window.clearTimeout(G),G=null):H&&(f.debug("[CallStatsHandler]: stop collecting RTPStats"),window.clearInterval(H),H=null,z=null,A=null,B=null,C=!1,J&&f.debug("[CallStatsHandler]: savedRTPStats =",J),O.onThresholdExceeded&&O.onThresholdExceeded(!0),D=!1)})}function t(a){var b=null,c=Object.keys(a);return c.forEach(function(c){var d=a[c];d.counter>=d.statObj.RecurrenceThreshold?d.reported?(delete a[c],f.debug("[CallStatsHandler]: issueCounter cleared=",c)):(d.reported=!0,d.counter=0,b=b||{},b[c]=!0):d.reported&&(b=b||{},b[c]=!0)}),b}function u(a){return a&&a.length?(B||(B=[],A=l.RTP_QUALITY_HIGH,z={noPacketsSeq:0,qualityLevelSeq:0},C=!1),void a.forEach(function(a,b){var c=0,d=0,e=a.audio&&a.audio.transmit,g=a.audio&&a.audio.receive,i=!0,j=!0,k=B[b]||{};!e||isNaN(e.pl)||isNaN(e.ps)||(c=h(e,k.audio&&k.audio.transmit)||0,k.audio&&k.audio.transmit&&k.audio.transmit.ps&&(i=e.ps!==k.audio.transmit.ps),i||f.warn("[CallStatsHandler]: processNetworkIndication - No packets sent to remote peer")),!g||isNaN(g.pl)||isNaN(g.pr)||(d=m(g,k.audio&&k.audio.receive)||0,k.audio&&k.audio.receive&&k.audio.receive.pr&&(j=g.pr!==k.audio.receive.pr),j||F.sendOnlyStream||f.warn("[CallStatsHandler]: processNetworkIndication - No packets received from remote peer"));var n={currentPlSend:c,currentPlReceive:d};i&&(j||F.sendOnlyStream)?(z.noPacketsSeq=0,n.qualityLevel=l.getLevel(Math.max(c,d))):(z.noPacketsSeq++,z.noPacketsSeq>1?(n.qualityLevel=l.RTP_QUALITY_LOW,O.onNoIncomingPackets&&O.onNoIncomingPackets()):n.qualityLevel=l.RTP_QUALITY_HIGH),v(n),B[b]=a})):void f.debug("[CallStatsHandler]: processNetworkIndication - No stats for network indication.")}function v(a){var b=z;b.qualityLevel=a.qualityLevel,b.currentPlSend=a.currentPlSend,b.currentPlReceive=a.currentPlReceive;var c=A;if(c!==b.qualityLevel.value&&f.debug("[CallStatsHandler]: setQualityEstimation - estimation="+b.qualityLevel.value+" seq="+b.qualityLevelSeq+" current="+c),c<b.qualityLevel.value?(b.qualityLevelSeq++,b.qualityLevelSeq>1&&(A=b.qualityLevel.value,b.qualityLevelSeq=0)):(A=b.qualityLevel.value,b.qualityLevelSeq=0),c!==A){var d=1===c&&!C;d&&(b.firstTimeLowQuality=d,C=d),O.onNetworkQuality&&O.onNetworkQuality(b)}}if(!Array.isArray(b))throw new Error("peerConnections must be an array");var w=6,x=20,y=b.filter(function(a){return a});if(!b.length)throw new Error("Cannot create CallStatsHandler object without at least one peer connection");var z,A,B,C,D,E,F={},G=null,H=null,I=0,J=[],K=[],L=[],M=[],N=[],O=this;this.start=function(){g()},this.stop=function(){return s()},this.onThresholdExceeded=null,this.onNoIncomingPackets=null,this.onNetworkQuality=null,this.setOptions=function(a){a&&(F=a)},this.getLastSavedStats=function(){return J}}var e,f=Circuit.logger,g=a.Utils,h=g.isMobile(),i=Object.freeze({GOOG_JITTER_RECEIVED:{StatName:"jr",StatText:"googJitterReceived",Threshold:50,RecurrenceThreshold:h?2:3},GOOG_RTT:{StatName:"rtt",StatText:"googRtt",Threshold:300,RecurrenceThreshold:h?2:3},PACKET_LOSS_RECV:{StatName:"",StatText:"packetLossRecv",Threshold:.05,RecurrenceThreshold:h?2:3},PACKET_LOSS_SEND:{StatName:"",StatText:"packetLossSend",Threshold:.05,RecurrenceThreshold:h?0:3},NO_PACKETS_RECV:{StatName:"",StatText:"noPacketsReceived",Threshold:0,RecurrenceThreshold:h?2:3}}),j=Object.freeze({GOOG_RTT:{StatName:"rtt",StatText:"googRtt",Threshold:300,RecurrenceThreshold:h?2:3},PACKET_LOSS_RECV:{StatName:"",StatText:"packetLossRecv",Threshold:.05,RecurrenceThreshold:h?2:3},PACKET_LOSS_SEND:{StatName:"",StatText:"packetLossSend",Threshold:.05,RecurrenceThreshold:h?0:3}}),k={COLLECTION_INTERVAL:5e3,DELAY_UPON_ANSWER:h?0:5e3,DELAY_RTT_PROCESSING:3},l=Object.freeze({RTP_QUALITY_LOW:{levelName:"low",value:1,threshold:.1},RTP_QUALITY_MEDIUM:{levelName:"medium",value:2,threshold:.03},RTP_QUALITY_HIGH:{levelName:"high",value:3,threshold:0},getLevel:function(a){return a>this.RTP_QUALITY_LOW.threshold?this.RTP_QUALITY_LOW:a>this.RTP_QUALITY_MEDIUM.threshold?this.RTP_QUALITY_MEDIUM:this.RTP_QUALITY_HIGH}}),m=Object.freeze({audioOutputLevel:"aol",bytesReceived:"or",bytesSent:"os",googAvailableSendBandwidth:"abw",googFrameHeightReceived:"fhr",googFrameHeightSent:"fhs",googFrameWidthReceived:"fwr",googFrameWidthSent:"fws",googFrameRateDecoded:"frd",googFrameRateSent:"frs",googJitterReceived:"jr",googRtt:"rtt",googTransmitBitrate:"tbr",packetsLost:"pl",packetsReceived:"pr",packetsSent:"ps"});return"undefined"!=typeof window.Promise&&(e=window.Promise),d.overridePromise=function(a){e=a},a.CallStats=m,a.CallStatsHandler=d,a.RtpStatsConfig=k,a}(Circuit),Circuit=function(a){"use strict";function b(n){function o(a,b){if(!Vb){var c=b&&!ib?nb:mb,d=c?c.getLocalStreams():[];d.indexOf(a)>=0&&(e.warn("[RtcSessionController]: Local "+(b?"Desktop":"Audio/Video")+" Media Stream has ended unexpectedly"),Y(b))}}function s(a,b,c){if(c&&c.mediaStream){var d=c.mediaStream;d.oninactive=o.bind(null,d,!0),ra(d,db),a()}else bc=f.getScreen(a,b,v,c)}function t(a,b,c){e.debug("[RtcSessionController]: Get User Media for ",Mb),Mb.audio||Mb.video?u(function(){Mb.desktop&&!h.isMobile()&&"dotnet"!==window.navigator.platform?lb[db]?(c=c||{},c.mediaStream=lb[db],s(a,b,c)):sb&&Nb.desktop&&!ub?(ra(wb[db],db),a()):(s(a,b,c),ub=!1):(ra(null,db),a())},b):Mb.desktop?(ra(null,db),s(a,b,c)):window.setTimeout(a,0)}function u(a,c){var d=function(){var a=!tb||"msie"===i.browser||"firefox"===i.browser&&!Mb.desktop&&Nb.desktop;return sb&&a&&"android"!==i.browser&&Mb.audio===Nb.audio&&Mb.video===Nb.video&&Mb.hdVideo===Nb.hdVideo};e.debug("[RtcSessionController]: getUserMediaAudioVideo()");var f=null;try{var g={audio:!1,video:!1};i.getMediaSources(function(j,k,l){if(Mb.audio){var m=h.selectMediaDevice(j,b.recordingDevices),n=h.selectMediaDevice(l,b.playbackDevices);g.audio=i.getAudioOptions({enableAudioAGC:b.enableAudioAGC,sourceId:m&&m.id,playbackDeviceId:n&&n.id})}var r,s=!1;if(Mb.video?(s=Mb.hdVideo,r=h.selectMediaDevice(k,b.videoDevices),g.video=i.getVideoOptions({sourceId:r&&r.id,hdVideo:s?"1080p":""})):Mb.desktop&&h.isMobile()&&(g.video=i.getDesktopOptions()),d())ra(wb[cb],cb),a();else{f=window.setTimeout(function(){f=null,e.warn("[RtcSessionController]: Failed to access local media: device unresponsive"),c("res_MediaInputDevicesUnresponsive")},Za),sb&&Mb.video&&Nb.video&&Mb.hdVideo!==Nb.hdVideo&&i.stopLocalVideoTrack(wb[cb]);var t=function(){e.info("[RtcSessionController]: Calling getUserMedia - constraints = ",g),i.getUserMedia(g,function(b){if(e.info("[RtcSessionController]: User has granted access to local media"),e.debug("[RtcSessionController]: Local MediaStream: ",b.id),!f)return e.info("[RtcSessionController]: GUM time out already fired"),void oa(b);if(window.clearTimeout(f),f=null,ac)return e.info("[RtcSessionController]: Session already terminated. Stop audio/video MediaStream: ",b.id),void oa(b);if(b.oninactive=o.bind(null,b,!1),Mb.video&&!b.getVideoTracks().length){if(sb&&!Nb.video)return void c("res_CameraAccessRestricted");Mb.video=!1,e.info("[RtcSessionController]: Failed to get access to video stream. Fallback to audio-only."),U("res_AddVideoFailed"),e.info("[RtcSessionController]: New getUserMedia - constraints = ",Mb)}ra(b,cb),a()},function(a){var b=a&&a.name||"Unspecified";if(s&&b===p)return e.warn("[RtcSessionController]: Failed to access local media with Full HD constraints: ",g.video),s=!1,g.video=i.getVideoOptions({sourceId:r&&r.id,hdVideo:"720p"}),void t();e.warn("[RtcSessionController]: Failed to access local media: ",b),f&&(window.clearTimeout(f),f=null);var d;d=b.indexOf(q)!==-1?Mb.video?"res_AccessToMediaInputDevicesFailedPermissionDenied":"res_AccessToAudioInputDeviceFailedPermissionDenied":Mb.video?"res_AccessToMediaInputDevicesFailed":"res_AccessToAudioInputDeviceFailed",c(d)})};t(),e.debug("[RtcSessionController]: Requested access to Local Media")}})}catch(a){e.error("[RtcSessionController]: Exception while handling getUserMedia: ",a),f&&(window.clearTimeout(f),f=null),c(Mb.video?"res_AccessToMediaInputDevicesFailed":"res_AccessToAudioInputDeviceFailed")}}function v(a,d,f,g,j){e.debug("[RtcSessionController]: getUserMediaDesktop()");try{var k={audio:!1},l={mediaSource:g,frameRate:{min:b.sdpParameters.screenShare.minFrameRate,max:b.sdpParameters.screenShare.maxFrameRate}};k.video=i.getDesktopOptions(f,l),e.info("[RtcSessionController]: Calling getUserMedia - constraints = ",k),i.getUserMedia(k,function(b){return e.info("[RtcSessionController]: User has granted access for screen capture. Stream Id:",b.id),ac?(e.info("[RtcSessionController]: Session already terminated. Stop desktop MediaStream: ",b.id),void oa(b)):(Z(j),b.oninactive=o.bind(null,b,!0),ra(b,db),void a())},function(a){var b=a&&a.name||"Unspecified";e.warn("[RtcSessionController]: Failed to access local media: ",b);var f=h.getBrowserInfo();d(f.msie&&"PermissionDeniedError"===b||f.firefox&&("SecurityError"===b||"NotAllowedError"===b)?c.ReturnCode.CHOOSE_DESKTOP_MEDIA_CANCELLED:"res_AccessToDesktopFailed")}),e.debug("[RtcSessionController]: Requested access for screen capture")}catch(a){e.error("[RtcSessionController]: Exception while handling getUserMedia: ",a),d("res_AccessToDesktopFailed")}}function w(){if(mb)return!0;var c={};jb&&(c.rtcpMuxPolicy=b.sdpParameters.rtcpMuxPolicy),qb.length&&!Zb?("firefox"===i.browser&&(qb=qb.filter(function(a){return!/turns:\d{1,3}(\.\d{1,3}){3}/.test(a)})),c.iceServers=[{urls:qb,credential:rb.password,username:rb.username}],b.allowOnlyRelayCandidates&&(c.iceTransportPolicy="relay")):c.iceServers=[],Zb=!1,e.debug("[RtcSessionController]: Creating RtcPeerConnections. config: ",c);var d={optional:[{DtlsSrtpKeyAgreement:!0},{googImprovedWifiBwe:!0},{googHighBitrate:!0},{googVeryHighBitrate:!0},{googDscp:!0}]};e.debug("[RtcSessionController]: Creating peer connections. constraints:",d);var f={extraVideoChannels:Wb?0:kb};e.debug("[RtcSessionController]: Creating peer connections. options:",f);try{Xb=[],mb=new a.RtcPeerConnections(c,d,f),e.debug("[RtcSessionController]: Created audio/video peer connections"),b.disableDesktopPc||h.isMobile()||"dotnet"===window.navigator.platform||ib||(c.iceCandidatePoolSize=1,nb=new i.PeerConnection(c,d),e.debug("[RtcSessionController]: Created screenshare peer connection"))}catch(a){return mb=null,nb=null,e.error("[RtcSessionController]: Failed to create peer connections.",a),!1}return ob=new j([mb,nb]),x(mb,ob),x(nb),!0}function x(a,b){a&&(a.onicecandidate=z.bind(null,a),a.oniceconnectionstatechange=A.bind(null,a),a.onaddstream=B.bind(null,a),a.onremovestream=C.bind(null,a)),b&&(b.onThresholdExceeded=function(a){E(gb.onStatsThresholdExceeded,{cleared:a})},b.onNoIncomingPackets=function(){E(gb.onStatsNoIncomingPackets,{})},b.onNetworkQuality=function(a){E(gb.onNetworkQuality,{quality:a})})}function y(a,b){a&&(a.onicecandidate=null,a.oniceconnectionstatechange=null,a.onaddstream=null,a.onremovestream=null),b&&(b.onThresholdExceeded=null,b.onNoIncomingPackets=null,b.onNetworkQuality=null)}function z(a,b){if(a!==mb&&a!==nb)return void aa("Received icecandidate event for old PC");var c;if(b.candidate){var e=new d(b.candidate.candidate);if("udp"!==e.transport)return void _("Ignore non UDP candidate");if(_("New ICE candidate: ",b.candidate),da()){if(c=a.localDescription,!da(c.type))return;var f={candidate:b.candidate.candidate,sdpMid:b.candidate.sdpMid,sdpMLineIndex:b.candidate.sdpMLineIndex};ja(f)&&(Eb!==k.None&&Eb!==k.OfferPending&&Eb!==k.AnswerPending?ia(f):_("Ignore ICE candidate in state ",Eb))}}else if(_("End of candidates. Audio/video PC:",a===mb),a.endOfCandidates=!0,ga()){if(c=a.localDescription,!c)return void ba("End of candidates, but cannot access pc.localDescription");da(c.type)&&Eb!==k.None&&Eb!==k.OfferPending&&Eb!==k.AnswerPending?I():J(c)}Qb&&da()&&(Eb===k.OfferPending||Eb===k.AnswerPending)&&(c=a.localDescription,J(c))}function A(a){if(a!==mb&&a!==nb)return void aa("Received iceconnectionstatechange event for old PC");var b=a===mb?"audio/video":"desktop";if(_("Connection state change ("+b+"): ",a.iceConnectionState),Eb===k.Connected)switch(a.iceConnectionState){case"connected":case"completed":G();break;case"disconnected":H();break;case"failed":Da(k.Disconnected),ba("[RtcSessionController]: ICE connection has failed"),Ba("res_CallMediaDisconnected")}else if(Eb===k.AnswerReceived||Eb===k.PrAnswerReceived||Eb===k.AnswerApplied||Eb===k.AnswerSent)switch(a.iceConnectionState){case"connected":case"completed":a.connected=!0,fa()&&(Rb&&(window.clearTimeout(Rb),Rb=null),Da(k.Connected));break;case"failed":Rb&&(window.clearTimeout(Rb),Rb=null),Ba("res_CallMediaFailed")}}function B(a,b){return _("Added Remote Stream"),sb?void _("Renegotiation is in progress. Ignore AddStream event."):(ua([b.stream]),void O())}function C(a,b){aa("Removed Remote Stream"),va(b.stream),O()}function D(a,b){_("RTCDTMFSender - ontonechange: tone =",b.tone),P(b.tone)}function E(a,b){if("function"==typeof a)try{a(b||{})}catch(a){e.error(a)}}function F(a){if(a){var b=ha();e.debug("[RtcSessionController]: Send IceCandidate event"),E(gb.onIceCandidate,{origin:b,candidates:a}),ka()}}function G(){e.debug("[RtcSessionController]: send IceConnected event"),E(gb.onIceConnected)}function H(){e.debug("[RtcSessionController]: send IceDisconnected event"),E(gb.onIceDisconnected)}function I(){var a=mb||nb,b=[];a.pendingCandidates&&(e.info("[RtcSessionController]: Send all pending candidates."),b=a.pendingCandidates,delete a.pendingCandidates),a.collectCandidatesTimeout&&(window.clearTimeout(a.collectCandidatesTimeout),delete a.collectCandidatesTimeout),a.queuedCandidates&&(e.info("[RtcSessionController]: There was no relay candidate for TURN over TCP/TLS. Send all queued candidates."),Array.prototype.push.apply(b,a.queuedCandidates),delete a.queuedCandidates),a.relayRtpCandidateTimeout&&(window.clearTimeout(a.relayRtpCandidateTimeout),delete a.relayRtpCandidateTimeout),b.push({candidate:"a=end-of-candidates\r\n"}),b.isEnd=!0,F(b)}function J(a){Qb&&(window.clearTimeout(Qb),Qb=null),"offer"===a.type?Eb===k.OfferPending&&K(k.OfferSent):Eb===k.AnswerPending&&K(k.AnswerSent)}function K(a){var b=Va();"iOS"===window.navigator.platform&&b&&(e.debug("[RtcSessionController]: For iOS we need to convert the SDP to an actual JSON object"),b={type:b.type,parsedSdp:b.parsedSdp});var c=da(b.type),d=b.parsedSdp;if(d=g.removeAudioLevelAttr(d),d=g.fixTrickleIceOption(d,c),c?ga()&&(d=g.addEndOfCandidatesLine(d)):d=g.removeEndOfCandidatesLine(d),d=g.removeEmptyAttributeLines(d,["ice-ufrag","ice-pwd","ice-options"]),d=g.removeNotNeededSsrc(d),0!==g.iceTotalCandidatesCount(d)||cc)if(g.validateIceCandidates(d)||c&&!ga()||cc){var f={type:b.type,sdp:g.stringify(d)};nb&&(f.screen=eb,mb&&lb[cb]&&(f.video=Ua(cb))),e.debug("[RtcSessionController]: send SessionDescription event"),cc=!1,E(gb.onSessionDescription,{sdp:f}),Da(a)}else e.error("[RtcSessionController]: Failure: SDP contains at least one m line without IceCandidates"),Ba();else if(c){var h=Ga();e.debug("[RtcSessionController]: No ICE candidates collected yet. Waiting "+h+" more milliseconds."),Qb=window.setTimeout(Ba.bind(null,"res_RestartBrowser"),h)}else Ba("res_RestartBrowser")}function L(){e.debug("[RtcSessionController]: send SdpConnected event"),E(gb.onSdpConnected,{})}function M(){e.debug("[RtcSessionController]: send RemoteVideoAdded event"),E(gb.onRemoteVideoAdded,{})}function N(){e.debug("[RtcSessionController]: send RemoteVideoRemoved event"),E(gb.onRemoteVideoRemoved,{})}function O(){e.debug("[RtcSessionController]: send RemoteStreamUpdated event"),E(gb.onRemoteStreamUpdated,{})}function P(a){e.debug("[RtcSessionController]: send DTMFToneChanged event"),E(gb.onDTMFToneChange,{tone:a})}function Q(){e.debug("[RtcSessionController]: send Closed event"),E(gb.onClosed,{})}function R(a){e.debug("[RtcSessionController]: send Error event"),E(gb.onRtcError,{error:a})}function S(a){"function"==typeof gb.onRtcError&&window.setTimeout(function(){R(a)},0)}function T(a){e.debug("[RtcSessionController]: send Warning event"),E(gb.onRtcWarning,{warning:a})}function U(a){"function"==typeof gb.onRtcWarning&&window.setTimeout(function(){T(a)},0)}function V(){e.debug("[RtcSessionController]: send MediaUpdate event"),E(gb.onMediaUpdate,{})}function W(){e.debug("[RtcSessionController]: send LocalVideoURL event"),E(gb.onLocalVideoURL,{url:Bb||Ab}),V()}function X(){e.debug("[RtcSessionController]: send RemoteObjectURL event"),E(gb.onRemoteObjectURL,{audioUrl:Db,videoUrl:Cb})}function Y(a){e.debug("[RtcSessionController]: send LocalStreamEnded event"),E(gb.onLocalStreamEnded,{isDesktop:a})}function Z(a){e.debug("[RtcSessionController]: send ScreenSharePointerStatus event"),E(gb.onScreenSharePointerStatus,{isSupported:!(!a||!a.isSupported),isEnabled:!(!a||!a.isEnabled)})}function $(a,b,c){e.debug("[RtcSessionController]: send QosAvailable event"),E(gb.onQosAvailable,{qos:a,renegotiationInProgress:b,lastSavedStats:c})}function _(a,b){e.debug("[RtcSessionController]["+hb+"]: "+a,b)}function aa(a,b){e.warn("[RtcSessionController]["+hb+"]: "+a,b)}function ba(a,b){e.error("[RtcSessionController]["+hb+"]: "+a,b)}function ca(a){return a?{audio:!!a.audio,video:!!a.video,hdVideo:!!a.hdVideo,desktop:!!a.desktop}:{audio:!0,video:!1,hdVideo:!1,desktop:!1}}function da(a){return a?"offer"===a&&Ob||"answer"===a&&Pb:Ob||Pb}function ea(a,b){if(!ib)return!0;var c=b&&g.isTrickleIceOption(b);return c&&e.debug("[RtcSessionController]: SDP "+a+" indicates support for Trickle-ICE."),!!c}function fa(){return(!mb||mb.connected)&&(!nb||nb.connected)}function ga(){return(!mb||mb.endOfCandidates)&&(!nb||nb.endOfCandidates)}function ha(){var a=mb||nb;return a?(a.sdpOrigin||(a.sdpOrigin=g.getOrigin(a.localDescription.sdp)),a.sdpOrigin):""}function ia(a){var b=mb||nb;b.pendingCandidates||(b.pendingCandidates=[],e.debug("[RtcSessionController]: Start timer to collect candidates before send."),b.collectCandidatesTimeout=window.setTimeout(function(){e.debug("[RtcSessionController]: Timer expired. Send all pending candidates."),delete b.collectCandidatesTimeout,b.pendingCandidates&&(F(b.pendingCandidates),delete b.pendingCandidates)},m)),b.pendingCandidates.push(a)}function ja(a){var c=mb||nb;if(b.allowAllIceCandidatesScreenShare||a.sdpMid!==eb||c.hasRelayRtpCandidate||c.sendAllCandidates)return!0;var f=new d(a.candidate);return f.isTcpTlsRelay()?(f.isRtp()&&(e.info("[RtcSessionController]: Found local relay candidate for TURN over TCP/TLS. Remove queued candidates."),c.hasRelayRtpCandidate=!0,delete c.queuedCandidates,c.relayRtpCandidateTimeout&&(window.clearTimeout(c.relayRtpCandidateTimeout),delete c.relayRtpCandidateTimeout)),!0):("udp"===f.transport&&(c.queuedCandidates||(c.queuedCandidates=[],e.debug("[RtcSessionController]: Start timer to wait for relay candidate for TURN over TCP/TLS."),c.relayRtpCandidateTimeout=window.setTimeout(function(){e.info("[RtcSessionController]: Timer expired. Stop waiting for relay candidate for TURN over TCP/TLS and send all pending candidates."),delete c.relayRtpCandidateTimeout,c.queuedCandidates&&(F(c.queuedCandidates),delete c.queuedCandidates),c.sendAllCandidates=!0},r)),c.queuedCandidates.push(a),e.debug("[RtcSessionController]: Queue candidate in case there is no TURN over TCP/TLS relay candidate")),!1)}function ka(){if(Rb&&(window.clearTimeout(Rb),Rb=null),fa())return void Da(k.Connected);var a=Vb?_a:$a;Rb=window.setTimeout(function(){Rb=null,Eb!==k.AnswerSent&&Eb!==k.AnswerReceived&&Eb!==k.AnswerApplied||fa()||(Vb?Da(k.Connected):(e.warn("[RtcSessionController]: Timed out waiting for connected state."),Ba("res_CallMediaFailed")))},a)}function la(a,b){a&&(y(a,b),i.closePc(a))}function ma(){e.debug("[RtcSessionController]: Add local streams to existing peer connection");try{var a=mb?mb.getLocalStreams():[];a.isEmpty()&&(lb[cb]&&mb.addStream(lb[cb]),e.debug("[RtcSessionController]: Added local audio/video stream"),!nb&&lb[db]&&(mb.addStream(lb[db]),e.debug("[RtcSessionController]: Added local screenshare stream"))),nb&&(a=nb.getLocalStreams(),a.isEmpty()&&lb[db]&&(nb.addStream(lb[db]),e.debug("[RtcSessionController]: Added local screenshare stream")))}catch(a){return e.error("[RtcSessionController]: Failed to add Local Streams ",a),!1}return!0}function na(){e.debug("[RtcSessionController]: Remove local streams from existing PeerConnections");try{var a=[mb,nb];a.forEach(function(a){a&&a.getLocalStreams().forEach(function(b,c){b&&(a.removeStream(b),e.debug("[RtcSessionController]: Removed PeerConnection Stream  #",c))})})}catch(a){return e.error("[RtcSessionController]: Failed to remove Local Streams ",a),!1}return!0}function oa(a){a&&(a.oninactive=null,i.stopMediaStream(a))}function pa(a){var b=a===wb?lb:wb;a&&a.forEach(function(a){b&&b.indexOf(a)!==-1||oa(a)})}function qa(a){var b=["",""];a&&a.forEach(function(a,c){a&&a.getVideoTracks().length>0&&(b[c]=i.createObjectURL(a))}),Ab===b[0]&&Bb===b[1]||(Ab=b[0],e.debug("[RtcSessionController]: Set local video URL to ",Ab||"<empty>"),Bb=b[1],e.debug("[RtcSessionController]: Set local desktop URL to ",Bb||"<empty>"),W())}function ra(a,b){return b!==cb&&b!==db?void e.error("[RtcSessionController]: setLocalStream invoked with invalid index:",b):void(lb[b]!==a&&(lb[b]&&oa(lb[b]),lb[b]=a,qa(lb)))}function sa(){(Db||Cb.length)&&(Db=null,Cb=[],X())}function ta(a){var b=!1;if(!a)return!1;if(a.getVideoTracks().length>0){var c=i.createObjectURL(a,void 0,!0),d=i.getVideoStreamTrackId(a),f=Cb.some(function(a){if(a.streamId===d)return a.url!==c&&(a.url=c,b=!0),!0});f||(Cb.push({url:c,streamId:d}),b=!0),b&&e.debug("[RtcSessionController]: Updated Remote Video URLs:",Cb)}if(a.getAudioTracks().length>0){var g=i.createObjectURL(a),h=i.getAudioStreamTrackId(a);Db&&Db.streamId===h?Db!==g&&(Db.url=g,b=!0):(Db={url:g,streamId:h},b=!0),b&&e.debug("[RtcSessionController]: Updated Remote Audio URL:",Db)}return b}function ua(a,b){if(a){a instanceof Array||(a=[a]);var c=!1;b&&(Db||Cb.length)&&(c=!0,Db=null,Cb=[]),a.forEach(function(a){Xb.push(a),ta(a)&&(c=!0)}),c&&X()}}function va(a){if(a){var b=!1,c=i.getVideoStreamTrackId(a);c&&Cb.some(function(a,d){if(a.streamId===c)return Cb.splice(d,1),b=!0,!0});var d=i.getAudioStreamTrackId(a);Db&&Db.streamId===d&&(Db=null,b=!0),b&&X()}}function wa(a){var b=!1;lb[cb]&&(b=i.toggleAudio(lb[cb],a)),Lb=!b||!a,wb&&wb[cb]&&i.toggleAudio(wb[cb],a)}function xa(a,b){sb&&(e.debug("[RtcSessionController]: There's a renegotiation in progress, fail or succeed it based on current SdpStatus:",Eb),Eb===k.AnswerReceived||Eb===k.AnswerApplied||Eb===k.AnswerSent?za():Aa()),sb=!0,tb=!!a,vb=b||null,xb=mb,yb=nb,zb=ob,y(xb,zb),y(yb),mb=null,nb=null,wb=lb,lb=[null,null],Nb=h.shallowCopy(Mb),Gb=h.shallowCopy(Fb),Eb=k.None,$b=null,_b=null}function ya(a){if(vb){try{vb(a)}catch(a){e.error(a)}vb=null}}function za(){e.info("[RtcSessionController]: The media renegotiation was successful"),e.info("[RtcSessionController]: Closing the old RTCPeerConnection"),Xa(zb,!0),la(xb,zb),la(yb),xb=null,yb=null,zb=null,e.info("[RtcSessionController]: Stopping the old MediaStream"),Jb?Ib=!0:Kb&&(Ib=!1),Ib||Hb||ma(),pa(wb),wb=null,Nb=null,Gb=null,qa(lb);var a=mb.getRemoteStreams();nb&&(a=a.concat(nb.getRemoteStreams())),ua(a,!0),wa(!Lb),Jb=!1,Kb=!1,sb=!1,Sb=null,V(),ya()}function Aa(a){e.info("[RtcSessionController]: The media renegotiation has failed: ",a),la(mb,ob),la(nb),Eb=k.Connected,mb=xb,nb=yb,ob=zb,x(xb),x(yb),xb=null,yb=null,zb=null,pa(lb),lb=wb,wb=null,qa(lb),Mb=h.shallowCopy(Nb),Fb=h.shallowCopy(Gb),Nb=null,Gb=null,Jb?Ib=!1:Kb&&(Ib=!0),Jb=!1,Kb=!1,sb=!1,V(),ya(a)}function Ba(a,b){return sb?void Aa(a):(a===c.ReturnCode.CHOOSE_DESKTOP_MEDIA_CANCELLED?e.info("[RtcSessionController]: User cancelled the screen share request"):"res_RestartBrowser"===a?e.error("[RtcSessionController]: Failure: No ICE candidates collected. Browser needs to be restarted"):(a=a||"res_RTCError",e.warn("[RtcSessionController]: There was an internal failure. Send error event: ",a)),void(b?b(a):R(a)))}function Ca(){_b?(e.info("[RtcSessionController]: Process the pending changeMedia"),Na(_b.mediaType,_b.cb,_b.screenConstraint),_b=null):$b&&(e.info("[RtcSessionController]: Process the pending remote description"),gb.setRemoteDescription($b.sdp,$b.cb),$b=null)}function Da(a){if(Eb===k.PrAnswerReceived&&a===k.Connected)return void e.debug("[RtcSessionController]: Cannot change SDP status to "+a+" without final SDP answer.");if(Eb!==a&&(e.debug("[RtcSessionController]: Changed SDP status from "+Eb+" to "+a),Eb=a,mb))switch(a){case k.AnswerApplied:Ca();break;case k.Connected:sb&&za(),L(),Ca(),ob.start();break;case k.AnswerSent:ka()}}function Ea(a,c){e.debug("[RtcSessionController]: updateLocalDescription with mediaConstraints=",Mb);var d=!1,f=g.parse(c.sdp);g.disableMultiplex(f),jb&&g.removeAudioMediaProtocols(f,["UDP","TLS"]),Ib?(g.setConnectionMode(f,"both","inactive"),e.info("[RtcSessionController]: updateLocalDescription with Connection Mode Inactive")):Mb.video||Mb.desktop?d=g.hasVideo(f):"answer"===c.type&&(d=g.hasVideo(f),d&&Wb&&(g.removeVideo(f),d=!1)),a===nb?(g.setMediaIdAttribute(f,0,eb,!0),g.setXGoogle(f,b.xGoogle.screenShare)):d&&g.setXGoogle(f,Mb.desktop&&!nb?b.xGoogle.screenShare:Mb.hdVideo?b.xGoogle.hdVideo:b.xGoogle.video),g.setOpusParameters(f,b.sdpParameters.audio),ib&&b.sdpParameters.preferVp9&&"offer"===c.type&&g.preferVideoVp9(f),"answer"!==c.type&&(Fb={audio:!0,video:d});var h=new i.SessionDescription({type:c.type,sdp:g.stringify(f)});return e.debug("[RtcSessionController]: Modified local SDP: ",h),h}function Fa(a,c,d){e.debug("[RtcSessionController]: updateRemoteDescription with mediaConstraints=",Mb);var f=!1,h=g.hasVideo(c);if(h){var i=g.getVideoConnectionModes(c);e.info("[RtcSessionController]: Remote description has video modes set to ",i),f=i.every(function(a){return"recvonly"===a}),h=!f;var j;j=a===nb||Mb.desktop&&!nb?"screenShare":Mb.hdVideo?"hdVideo":"video";var l=b.sdpParameters[j].maxBw,m=b.xGoogle[j];c=g.setVideoBandwidth(c,l,!0),g.setXGoogle(c,m),ib&&"offer"===d&&f&&!Mb.video&&!Mb.desktop&&(c=g.removeVideo(c))}g.setOpusParameters(c,b.sdpParameters.audio);var n=Hb;return Hb=!!g.isHold(c)&&("offer"===d||!Ib&&Mb.audio),n!==Hb&&(Hb?e.info("[RtcSessionController]: The client has been held"):e.info("[RtcSessionController]: The client has been retrieved")),"offer"!==d||Eb!==k.Connected||Ib||Hb||(Cb.length&&!h?N():!Cb.length&&h&&M()),Ib||"answer"===d&&f||(Fb={audio:!0,video:h}),c}function Ga(){var a=b.candidatesTimeout||l;return kb>0&&(a+=a*(i.iceTimeoutSafetyFactor||0)),a}function Ha(){return b.trickleIceTimeout||m}function Ia(a,b){e.debug("[RtcSessionController]: Successfully created local audio/video description:",a),b&&e.debug("[RtcSessionController]: Successfully created local screenshare description:",b),sb&&na(),Qb&&(window.clearTimeout(Qb),Qb=null);var c,d=a&&a.type||b&&b.type,f=2,g=!1,h=function(a,b){if(f--,b?(e.error("[RtcSessionController]: Failed to apply Local "+a+" description:",b.message||b),g||(g=!0,Ba())):e.debug("[RtcSessionController]: Local description was successfully applied. PC=",a),!g&&f<=0){if(cc)return K(k.Connected),
mb&&(mb.connectionBypassed=!0,y(mb,ob)),void(nb&&(nb.connectionBypassed=!0,y(nb)));sb||V(),"offer"===d?(Da(k.OfferPending),Ob&&(c=Ha(),c>0?(e.debug("[RtcSessionController]: Trickle ICE is enabled. Start a short timer before sending SDP Offer ("+c+"ms)."),window.setTimeout(function(){Eb===k.OfferPending&&(e.debug("[RtcSessionController]: Trickle ICE timer expired. Send SDP Offer."),K(k.OfferSent))},c)):(e.debug("[RtcSessionController]: Trickle ICE is enabled. Send the SDP Offer."),K(k.OfferSent)))):(Da(k.AnswerPending),Pb&&(c=Ha(),c>0?(e.debug("[RtcSessionController]: Trickle ICE is enabled. Start a short timer before sending SDP Answer ("+c+"ms)."),window.setTimeout(function(){Eb===k.AnswerPending&&(e.debug("[RtcSessionController]: Trickle ICE timer expired. Send SDP Answer."),K(k.AnswerSent))},c)):(e.debug("[RtcSessionController]: Trickle ICE is enabled. Send the SDP Answer."),K(k.AnswerSent)))),(Eb===k.OfferPending&&!Ob||Eb===k.AnswerPending&&!Pb)&&(c=Ga(),e.debug("[RtcSessionController]: Waiting for ICE candidates ("+c+"ms)."),Qb=window.setTimeout(function(){return Qb=null,e.warn("[RtcSessionController]: Timed out waiting for candidates. Send session description."),mb?void("offer"===d?Eb===k.OfferPending&&K(k.OfferSent):Eb===k.AnswerPending&&K(k.AnswerSent)):void e.warn("[RtcSessionController]: RTCPeerConnection instance no longer exists.")},c))}};try{if(mb&&a){var i=h.bind(null,"audio/video");a=Ea(mb,a),mb.setLocalDescription(a,i,i),mb.startTime=Date.now()}else f--;if(nb&&b){var j=h.bind(null,"screenshare");b=Ea(nb,b),nb.setLocalDescription(b,j,j),nb.startTime=Date.now()}else f--}catch(a){h("unknown",a||"error")}}function Ja(){Jb||Ib&&!Kb?(mb.oniceconnectionstatechange=null,e.debug("[RtcSessionController]: Call is already held or is being put on hold. Stop monitoring iceConnectionState changes"),Da(k.Connected)):Eb===k.AnswerReceived&&Da(k.AnswerApplied)}function Ka(a){return(!Wb||!(!a||!a.video))&&(h.isMobile()||!Yb)}function La(a){e.debug("[RtcSessionController]: setRemoteDescription()");try{if(!w())return void Ba();var c,d=mb.getLocalStreams(),f=g.parse(a.sdp);if(a.screen){var h=g.findMediaLineIndex(f,a.screen);h!==-1&&(c=f.m[h],f.m.splice(h,1))}switch(a.type){case"offer":Pb=!b.disableTrickleIce&&ea(a.type,f),Pb&&e.info("[RtcSessionController]: Enabled Trickle-ICE for answer.");break;case"pranswer":case"answer":Da("pranswer"===a.type?k.PrAnswerReceived:k.AnswerReceived),Ob&&(Ob=ea(a.type,f),Ob||e.warn("[RtcSessionController]: Disabled Trickle-ICE for offer."))}var j=2,l=!1,m=function(b,f){if(j--,f?(e.error("[RtcSessionController]: Failed to apply Remote "+b+" description:",f.message||f),l||(l=!0,Ba())):e.debug("[RtcSessionController]: Remote description was successfully applied. PC=",b),!l&&j<=0)switch(e.debug("[RtcSessionController]: Remote Descriptions were successfully applied."),sb||V(),a.type){case"offer":Ib||Hb?d.length>0?(na(),e.debug("[RtcSessionController]: Removed Local Stream (hold)")):e.debug("[RtcSessionController]: Local Stream has not been set (hold)"):ma(),e.debug("[RtcSessionController]: Creating Local Description Answer...");var g={mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:Ka()}},h={audio:Mb.audio,video:Mb.video||Mb.desktop};mb.createAnswer(function(a){if(nb&&c){var b={mandatory:{OfferToReceiveAudio:!1,OfferToReceiveVideo:!Wb}};nb.createAnswer(function(b){Ia(a,b)},function(a){a=a||"Unspecified",e.error("[RtcSessionController]: Failed to create screenshare Local Description: ",a.message||a),Ba()},b)}else Ia(a)},function(a){a=a||"Unspecified",e.error("[RtcSessionController]: Failed to create Local Description: ",a.message||a),Ba()},g,h);break;case"pranswer":e.debug("[RtcSessionController]: Received pranswer, applying early media SDP"),Ja(),ka();break;case"answer":Ja(),ka();break;default:e.error("[RtcSessionController]: Invalid SDP Type = ",a.type),Ba()}};if(mb){ib&&!nb&&c&&(pb=f.m[fb.video],pb.port=0,g.setConnectionMode({m:[pb]},"video","inactive"),f.m[fb.video]=c,e.debug("[RtcSessionController]: Disabled and replaced video m-line with screenshare m-line")),f=Fa(mb,f,a.type);var n=new i.SessionDescription({type:a.type,sdp:g.stringify(f)});e.debug("[RtcSessionController]: Modified remote audio/video SDP:",n);var o=m.bind(null,"audio/video");mb.setRemoteDescription(n,o,o),mb.remoteOrigin=g.getOrigin(f).trim(),mb.startTime=Date.now()}else j--;if(nb&&c){f.m=[c],f=Fa(nb,f,a.type);var p=new i.SessionDescription({type:a.type,sdp:g.stringify(f)});e.debug("[RtcSessionController]: Modified remote screenshare SDP:",p),nb.startTime=Date.now();var q=m.bind(null,"screenshare");nb.setRemoteDescription(p,q,q),nb.remoteOrigin=g.getOrigin(f).trim()}else la(nb),nb=null,j--}catch(a){e.error(a),Ba()}}function Ma(){if(e.debug("[RtcSessionController]: renegotiateMedia()"),!w())return void Ba();Ib?e.debug("[RtcSessionController]: Local Stream has not been set (holding)"):ma(),e.debug("[RtcSessionController]: Creating Local Descriptions...");var a={mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:Ka(Mb)}};try{mb.createOffer(function(b){!nb||Wb&&!Mb.desktop?(nb&&(la(nb),nb=null),Ia(b)):(a.mandatory.OfferToReceiveVideo=!0,a.mandatory.OfferToReceiveAudio=!1,nb.createOffer(function(a){Ia(b,a)},function(a){a=a||"Unspecified",e.error("[RtcSessionController]: Failed to create screenshare Local Description: ",a.message||a),Ba()},a))},function(a){a=a||"Unspecified",e.error("[RtcSessionController]: Failed to create audio/video Local Description: ",a.message||a),Ba()},a)}catch(a){e.error(a),Ba()}}function Na(a,b,c){return Eb===k.AnswerReceived?(e.warn("[RtcSessionController]: Still processing the previous answer remote description. Queue the changeMedia"),void(_b={mediaType:a,cb:b,screenConstraint:c})):Ra()?(xa(!0,b),"boolean"==typeof a.audio&&(Mb.audio=a.audio),"boolean"==typeof a.video&&(Mb.video=a.video),"boolean"==typeof a.hdVideo&&(Mb.hdVideo=a.hdVideo),"boolean"==typeof a.desktop&&(Mb.desktop=a.desktop),void t(Ma,Ba,c)):void Sa(b,"Connection not stable")}function Oa(){e.debug("[RtcSessionController]: Closing the RTC session controller"),Da(k.None),Fb={audio:!1,video:!1},bc&&f.unregEvtHandlers(bc),Qb&&(window.clearTimeout(Qb),Qb=null),Rb&&(window.clearTimeout(Rb),Rb=null),Xa(zb||ob),xb&&(e.debug("[RtcSessionController]: Closing the old audio/video RTCPeerConnection"),la(xb,zb),xb=null),yb&&(e.debug("[RtcSessionController]: Closing the old screenshare RTCPeerConnection"),la(yb),yb=null),mb&&(e.debug("[RtcSessionController]: Closing the RTCPeerConnection"),la(mb,ob),mb=null),nb&&(e.debug("[RtcSessionController]: Closing the Desktop peer connection"),la(nb),nb=null),wb&&(e.debug("[RtcSessionController]: Stopping the old MediaStream"),pa(wb),wb=null),sb=!1,Jb=!1,Kb=!1,Ib=!1,Hb=!1,Lb=!1,Sb=null,ra(null,cb),ra(null,db),sa(),Q(),ac=!0,Ya(["onQosAvailable"])}function Pa(){if(!mb)return e.error("[RtcSessionController]: PeerConnection not setup"),!1;if(Sb)return e.debug("[RtcSessionController]: DTMF Sender already enabled"),!0;var a=mb.getLocalStreams();if(!(a.length>0))return e.error("[RtcSessionController]: No Local Stream to create DTMF Sender"),!1;var b=a[cb].getAudioTracks();return b.length>0?!!(Sb=mb.createDTMFSender(b[0]))&&(Sb.ontonechange=D.bind(null,mb),e.info("[RtcSessionController]: Created DTMF Sender using remote audio track: "+b[0].label),!0):(e.error("[RtcSessionController]: No Audio Track to create DTMF Sender"),!1)}function Qa(a){if(e.debug("[RtcSessionController]: startConn()"),a)La(a);else{ma(),e.debug("[RtcSessionController]: Creating Local Description...");var b={mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:Ka(Mb)}};mb.createOffer(function(a){if(!nb||Wb&&!Mb.desktop)Ia(a);else{var b={mandatory:{OfferToReceiveAudio:!1,OfferToReceiveVideo:!0}};nb.createOffer(function(b){Ia(a,b)},function(a){a=a||"Unspecified",e.error("[RtcSessionController]: Failed to create screenshare Local Description: ",a.message||a),Ba()},b)}},function(a){a=a||"Unspecified",e.error("[RtcSessionController]: Failed to create Local Description: ",a.message||a),Ba()},b)}}function Ra(){return mb?Eb===k.AnswerReceived||Eb===k.AnswerApplied?(e.debug("[RtcSessionController]: isConnStable: Processing remote answer SDP, the connection is considered stable"),!0):Eb===k.AnswerSent?(e.debug("[RtcSessionController]: isConnStable: Answer SDP sent, the connection is considered stable"),!0):sb?(e.warn("[RtcSessionController]: isConnStable: There is a pending media renegotiation"),!1):!("stable"!==mb.signalingState&&!mb.connectionBypassed&&(e.warn("[RtcSessionController]: isConnStable: The connection is not established. signalingState =",mb.signalingState),!Vb)):(e.debug("[RtcSessionController]: isConnStable: There is no connection"),!1)}function Sa(a,b){"function"==typeof a&&window.setTimeout(function(){a(b)},0)}function Ta(a){return h.isMobile()?(e.debug("[RtcSessionController]: Number of extra video channels for mobile clients is 0 (zero)"),!1):Yb?(e.debug("[RtcSessionController]: Number of extra video channels for large conference is 0 (zero)"),!1):kb!==a&&(e.info("[RtcSessionController]: Set number of extra video channels to",a),kb=a,!0)}function Ua(a){var b,c=lb[a];if(c){var d=c.id+" ",e=c.getVideoTracks()[0];e&&(d+=e.id,b=d)}return b}function Va(){var a,c;if(mb){var d=mb.localDescription;c=d.type,a=g.parse(d.sdp),!nb&&pb&&(a.m.splice(fb.video,0,pb),pb=null)}if(nb){var f=nb.localDescription.sdp;if(f){c||(c=nb.localDescription.type),f=g.parse(f),f=g.verifyFingerprintInMLines(f);var h=!ib&&!b.allowAllIceCandidatesScreenShare;e.info("[RtcSessionController]: Remove UDP video candidates for screenshare: ",h);var i=da(c)&&!nb.endOfCandidates;g.validateIceCandidates(f,h,i),a?a.m=a.m.concat(f.m):a=f}}return{type:c,parsedSdp:a}}function Wa(a){return!dc&&(a||Eb===k.AnswerReceived||Eb===k.PrAnswerReceived||Eb===k.AnswerApplied||Eb===k.AnswerSent||Eb===k.Connected||Eb===k.None)}function Xa(a,b){a?a.stop().then(function(c){Wa(b)&&c&&$(c,b,a.getLastSavedStats()),b||(gb.onQosAvailable=null),dc=!1}):b||(gb.onQosAvailable=null)}function Ya(a){a=a||[],ec.forEach(function(b){a.includes(b)||(gb[b]=null)})}n=n||{};var Za=12e4,$a=15e3,_a=1e3,ab=2,bb=2,cb=0,db=1,eb="video_screen_main",fb={audio:0,video:1,screen:2},gb=this,hb=n.callId||"",ib=!!n.isDirectCall,jb=!!n.isTelephonyCall,kb=0,lb=[null,null],mb=null,nb=null,ob=null,pb=null,qb=[],rb={},sb=!1,tb=!1,ub=!1,vb=null,wb=null,xb=null,yb=null,zb=null,Ab=null,Bb=null,Cb=[],Db=null,Eb=k.None,Fb={audio:!1,video:!1},Gb=null,Hb=!1,Ib=!1,Jb=!1,Kb=!1,Lb=!!n.isLargeConference,Mb={audio:!0,video:!1,hdVideo:!1,desktop:!1},Nb=null,Ob=!jb&&!b.disableTrickleIce,Pb=!1,Qb=null,Rb=null,Sb=null,Tb=!1,Ub=null,Vb=!1,Wb=!1,Xb=[],Yb=!!n.isLargeConference,Zb=!!n.isAtcPullCall,$b=null,_b=null,ac=!1,bc=null,cc=!1,dc=!1,ec=["onIceCandidate","onSessionDescription","onSdpConnected","onIceConnected","onIceDisconnected","onRemoteVideoAdded","onRemoteVideoRemoved","onRemoteStreamUpdated","onDTMFToneChange","onClosed","onRtcError","onRtcWarning","onLocalStreamEnded","onScreenSharePointerStatus","onMediaUpdate","onLocalVideoURL","onRemoteObjectURL","onQosAvailable","onStatsNoIncomingPackets","onStatsThresholdExceeded","onNetworkQuality"];ec.forEach(function(a){gb[a]=null}),this.setTurnCredentials=function(a){rb=a||{}},this.setTurnUris=function(a){a&&a.length&&(qb=a)},this.getLocalVideoUrl=function(){return Bb||Ab},this.getLocalDesktopUrl=function(){return Bb},this.getRemoteAudioUrl=function(){return Db},this.getRemoteVideoUrls=function(){return Cb},this.getSdpStatus=function(){return Eb},this.getWarmedUpSdp=function(){return Ub},this.isHolding=function(){return Ib&&!Jb||Kb},this.isHoldInProgress=function(){return Jb},this.isRetrieveInProgress=function(){return Kb},this.isHeld=function(){return Hb},this.getActiveMediaType=function(){return h.shallowCopy(Fb)},this.getMediaConstraints=function(){return h.shallowCopy(Mb)},this.getLocalMediaType=function(){return{audio:Mb.audio&&Fb.audio,video:Mb.video&&Fb.video,desktop:Mb.desktop&&Fb.video}},this.hasScreenShare=function(){return!!Bb},this.warmup=function(a,b,c,d,f){return c=c||function(){},d=d||function(){},ac?(e.error("[RtcSessionController]: Warmup Connection failed: Session already terminated"),void Sa(d,"res_UnexpectedError")):(g.isNoOfferSdp(b)&&(b=null),a=ca(a),e.info("[RtcSessionController]: Warming up the connection - mediaType = ",a),i.enabled?Eb!==k.None?(e.error("[RtcSessionController]: The connection has already been started"),void Sa(d,"res_UnexpectedError")):(Mb=a,Mb.audio||(Lb=!0),void t(function(){b&&(Ub=b),Tb=!0,w(),c()},function(a){Ba(a,d)},f)):(e.warn("[RtcSessionController]: WebRTC not supported by browser"),void Sa(d,"res_NoWebRTC")))},this.start=function(a,b){if(ac)return e.error("[RtcSessionController]: Start Connection failed: Session already terminated"),!1;if(a=ca(a),e.info("[RtcSessionController]: Start Connection - mediaType =",a),!i.enabled)return e.warn("[RtcSessionController]: WebRTC not supported by browser"),S("res_NoWebRTC"),!1;if(Eb!==k.None)return e.error("[RtcSessionController]: The connection has already been started"),S("res_UnexpectedError"),!1;if(e.debug("[RtcSessionController]: Creating Peer Connection..."),Tb){if(b=Ub,Ub=null,Lb=!a.audio||Yb,!w())return S("res_RTCError"),!1;if(a.audio===Mb.audio&&a.video===Mb.video&&a.hdVideo===Mb.hdVideo&&a.desktop===Mb.desktop)return Qa(b),!0}return w()?(Mb=a,t(function(){Qa(b)},Ba),!0):(S("res_RTCError"),!1)},this.addIceCandidates=function(a,b){e.info("[RtcSessionController]: Add remote ICE candidates");var c=mb||nb;if(c){var d=c.remoteOrigin;a&&a!==d?(e.warn("[RtcSessionController]: Ignoring remote ICE candidate - origin does not match."),e.debug("[RtcSessionController]: ICE candidate origin: ",a),e.debug("[RtcSessionController]: SDP origin: ",d)):(b.forEach(function(a){a=JSON.parse(a),a.candidate&&(a.candidate=a.candidate.replace(/(a=)*([^\r]+)(\r\n)*/i,"$2")),e.debug("[RtcSessionController]: Remote ICE candidate",a),a.candidate&&"end-of-candidates"!==a.candidate?mb.addIceCandidate(a):e.debug("[RtcSessionController]: Ignoring end-of-remote-candidates indication.")}),ka())}else e.warn("[RtcSessionController]: Ignoring remote ICE candidate - no peer connection found.")},this.setRemoteDescription=function(a,b){if(e.info("[RtcSessionController]: Set Remote Description - type: ",a.type),Ub=null,Eb===k.AnswerReceived)return e.info("[RtcSessionController]: Still processing the previous answer remote description. Queue the new one"),void($b={sdp:a,cb:b});if(Eb===k.PrAnswerReceived)return"answer"===a.type&&(Da(k.AnswerReceived),ka()),e.info("[RtcSessionController]: SDP already applied. Ignoring any later remote SDPs"),void Sa(b);if("offer"===a.type){if(!Ra())return void Sa(b,"Connection not stable");xa(!1,b),t(function(){La(a)},Ba)}else"sdp"===a.sdp||"data"===a.sdp?(Da(k.AnswerReceived),sb&&za(),ka()):La(a),Sa(b)},this.renegotiateMedia=function(a){e.info("[RtcSessionController]: Start Media Renegotiation from client"),Ra()||Sa(a,"Connection not stable"),xa(!0,a),t(Ma,Ba)},this.enableRemoteVideo=function(){Wb&&(e.info("[RtcSessionController]: Enable receiving remote video"),Wb=!1)},this.disableRemoteVideo=function(){Wb||(e.info("[RtcSessionController]: Disable receiving remote video"),Wb=!0)},this.addAudio=function(a){e.info("[RtcSessionController]: Add Audio"),Na({audio:!0},a)},this.removeAudio=function(a){e.info("[RtcSessionController]: Remove Audio"),Na({audio:!1},a)},this.addVideo=function(a){e.info("[RtcSessionController]: Add Video"),Na({video:!0},a)},this.removeVideo=function(a){e.info("[RtcSessionController]: Remove Video"),Na({video:!1},a)},this.addDesktop=function(a){e.info("[RtcSessionController]: Add Desktop (screen sharing)"),Na({desktop:!0},a)},this.removeDesktop=function(a){e.info("[RtcSessionController]: Remove Desktop (screen sharing)"),Na({desktop:!1},a)},this.changeMediaType=function(a,b,c,d){return e.info("[RtcSessionController]: Change media type: ",a),a?(ub=!!b,void Na(a,c,d)):(e.warn("[RtcSessionController]: Invalid media type"),void Sa(c,"Invalid media type"))},this.holdCall=function(a){return e.info("[RtcSessionController]: Hold Call"),Ra()?Ib?(e.warn("[RtcSessionController]: The call is already held"),void Sa(a)):(Ib=!0,Jb=!0,xa(!0,a),void t(Ma,Ba)):void Sa(a,"Connection not stable")},this.retrieveCall=function(a){return e.info("[RtcSessionController]: Retrieve Call"),Ra()?Ib?(Ib=!1,Kb=!0,xa(!0,a),void t(Ma,Ba)):(e.warn("[RtcSessionController]: The call is not held"),void Sa(a)):void Sa(a,"Connection not stable")},this.renegotiationFailed=function(){sb&&(vb||R("res_RTCError"),Aa())},this.mute=function(a){e.info("[RtcSessionController]: Mute Call"),wa(!1),Sa(a)},this.unmute=function(a){e.info("[RtcSessionController]: Unmute Call"),wa(!0),Sa(a)},this.isMuted=function(){return Lb},this.isLocalMuteAllowed=function(){return Lb||lb[cb]&&lb[cb].getAudioTracks().length},this.setCallStatsOptions=function(a){ob&&a&&(e.debug("[RtcSessionController]: Setting call stats options: ",a),ob.setOptions(a))},this.terminate=function(){e.info("[RtcSessionController]: Terminate the RTC session controller"),Oa()},this.canSendDTMFDigits=function(){return!(!Sb&&!Pa())&&(Sb&&Sb.canInsertDTMF)},this.sendDTMFDigits=function(a){return e.info("[RtcSessionController]: Send DTMF Digits - digits=",a),!!Ra()&&(!(!Sb&&!Pa())&&(Sb.canInsertDTMF?(Sb.insertDTMF(a,200,50),!0):(e.error("[RtcSessionController]: DTMF Sender cannot insert DTMF digits: "+a),!1)))},this.setMockedCall=function(){Vb=!0},this.getCurrentPeerConnection=function(){return mb.mainPeerConnection},this.setExtraVideoChannelsForParticipants=function(a){var b=0;return a&&a>2&&(b=a-2,b=Math.max(b,ab),b=Math.min(b,bb)),Ta(b)},this.setExtraVideoChannels=function(a){return a=a||0,a>0&&(a=Math.max(a,ab),a=Math.min(a,bb)),Ta(a)},this.useMaxNumberOfExtraVideoChannels=function(){return Ta(bb)},this.getNumberOfExtraVideoChannels=function(){return kb},this.hasMaxExtraVideoChannels=function(){return!!h.isMobile()||kb===bb},this.isConnStable=function(){return Ra()},this.isConnected=function(){return Eb===k.Connected||sb},this.disableIncomingVideo=function(){Xb.forEach(function(a){a.getVideoTracks().length>0&&(a.getVideoTracks()[0].enabled=!1)})},this.enableIncomingVideo=function(){Xb.forEach(function(a){a.getVideoTracks().length>0&&(a.getVideoTracks()[0].enabled=!0)})},this.getLocalStream=function(a){return lb[a]},this.setLocalStream=function(a,b){lb[a]=b},this.getRemoteStreams=function(){return Xb},this.setIgnoreTurnOnNextPC=function(){Zb=!0},this.setIgnoreNextConnection=function(){dc=cc=!0},this.getLastSavedStats=function(){var a=zb||ob;if(a)return a.getLastSavedStats()},e.debug("[RtcSessionController]: Created new RtcSessionController instance")}var c=a.Constants,d=a.IceCandidate,e=a.logger,f=a.ScreenSharingController,g=a.sdpParser,h=a.Utils,i=a.WebRTCAdapter,j=a.CallStatsHandler,k=Object.freeze({None:"None",AnswerPending:"Answer-Pending",AnswerSent:"Answer-Sent",AnswerApplied:"Answer-Applied",OfferPending:"Offer-Pending",OfferSent:"Offer-Sent",OfferReceived:"Offer-Received",Connected:"Connected",PrAnswerReceived:"PrAnswer-Received",AnswerReceived:"Answer-Received",Disconnected:"Disconnected"}),l=2e3,m=200,n=!0,o=1.5,p="ConstraintNotSatisfiedError",q="PermissionDeniedError",r=5e3,s={audio:{maxplaybackrate:24e3,"sprop-maxcapturerate":24e3,maxaveragebitrate:16e3,usedtx:1},video:{maxBw:512},hdVideo:{maxBw:2e3},screenShare:{maxBw:300,maxFrameRate:5,minFrameRate:3},rtcpMuxPolicy:"negotiate",preferVp9:!1},t={video:{minBitRate:60},hdVideo:{startBitRate:500,minBitRate:1e3,maxBitRate:2e3,maxQuantization:56},screenShare:{}},u={AUDIO_VIDEO:0,DESKTOP:1};return b.DEFAULT_CANDIDATES_TIMEOUT=l,b.DEFAULT_TRICKLE_ICE_TIMEOUT=m,b.DEFAULT_ENABLE_AUDIO_AGC=n,b.DEFAULT_UPSCALE_FACTOR=o,b.DEFAULT_SDP_PARAMS=s,b.DEFAULT_XGOOGLE=t,b.LOCAL_STREAMS=u,b.candidatesTimeout=l,b.trickleIceTimeout=m,b.enableAudioAGC=n,b.screenshareUpscaleFactor=o,b.cmrScreenshareUpscaleFactor=o,b.allowAllIceCandidatesScreenShare=!0,b.disableTrickleIce=!1,b.allowOnlyRelayCandidates=!1,b.mediaNode=null,b.playbackDevices=[],b.recordingDevices=[],b.ringingDevices=[],b.videoDevices=[],b.sdpParameters=h.shallowCopy(s),b.xGoogle=h.shallowCopy(t),b.disableDesktopPc=!1,b.processClientSettings=function(a){a=a||{},void 0!==a.allowAllIceCandidatesScreenShare&&(b.allowAllIceCandidatesScreenShare=!!a.allowAllIceCandidatesScreenShare),void 0!==a.disableTrickleIce&&(b.disableTrickleIce=!!a.disableTrickleIce),b.screenshareUpscaleFactor=parseFloat(a.screenshareUpscaleFactor,10)||b.DEFAULT_UPSCALE_FACTOR,b.cmrScreenshareUpscaleFactor=parseFloat(a.cmrScreenshareUpscaleFactor,10)||b.DEFAULT_UPSCALE_FACTOR;var c=a.xGoogle||{};["video","hdVideo","screenShare"].forEach(function(a){b.xGoogle[a]=void 0!==c[a]?c[a]:b.DEFAULT_XGOOGLE[a]}),e.info("[RtcSessionController]: Updated RtcSessionController values: ",{allowAllIceCandidatesScreenShare:b.allowAllIceCandidatesScreenShare,disableTrickleIce:b.disableTrickleIce,screenshareUpscaleFactor:b.screenshareUpscaleFactor,cmrScreenshareUpscaleFactor:b.cmrScreenshareUpscaleFactor,xGoogle:b.xGoogle})},a.RtcSessionController=b,a.Enums=a.Enums||{},a.Enums.SdpStatus=k,a}(Circuit||{}),Circuit=function(a){"use strict";function b(a){if(!a||!a.rtcSessionId)throw new Error("Cannot create AtcRemoteCall object without a valid conversation");b.parent.constructor.call(this,a,!0),Object.defineProperties(this,{isPullAllowed:{get:function(){return this.atcCallInfo.isHandoverAllowed()&&this.atcCallInfo.cstaState!==f.Ringing},enumerable:!0,configurable:!1}}),this.isAtcRemote=!0,this.atcCallInfo=new c,a=null,g.info("[AtcRemoteCall]: Created new ATC remote call with callID = ",this.callId)}var c=a.AtcCallInfo,d=a.BaseCall,e=a.Enums.CallState,f=a.Enums.CstaCallState,g=a.logger,h=a.Utils;return h.inherit(b,d),b.prototype.isPresent=function(){return!this.checkState([e.Idle,e.Terminated])||!this.checkCstaState([f.Idle,f.Failed,f.TransferFailed,f.Terminated])},b.prototype.isDtmfAllowed=function(){return this.checkState(e.ActiveRemote)&&this.checkCstaState(f.Active)},a.AtcRemoteCall=b,a}(Circuit||{}),Circuit=function(a){"use strict";function b(a){var b,c;c=a.height,b=a.width,c/b>j/k?a.height>j&&(b=b*j/c,c=j):b>k&&(c=c*k/b,b=k);var d=document.createElement("canvas"),e=d.getContext("2d");return d.width=b,d.height=c,e.fillStyle=h,e.fillRect(0,0,d.width,d.height),e.drawImage(a,0,0,a.width,a.height,0,0,b,c),d.toDataURL("image/jpeg")}function c(a){for(var b=atob(a.split(",")[1]),c=[],d=0;d<b.length;d++)c.push(b.charCodeAt(d));return new Blob([new Uint8Array(c)],{type:"image/jpeg"})}function d(a){return new f(function(d){var e=new FileReader;e.onload=function(e){var f=new Image;f.onload=function(){var e=b(this),f=c(e);f.name=l+(a.modifiedName||a.name),f.lastModified=Math.round(Date.now()/1e3),d(f)},f.src=e.target.result},e.readAsDataURL(a)})}function e(a){function b(a){a&&a.forEach(function(a){var b=new XMLHttpRequest;b.withCredentials=!0,b.open("DELETE",a),b.send()})}function c(a,b,c,d,e){var g=function(){j[a]&&(j[a].xhr=null)};return new f(function(f,h){var i=b.modifiedName||b.name,k=new XMLHttpRequest;k.withCredentials=!0,k.open("POST",d+"/fileapi?itemid="+(c||"NULL"),!0),k.setRequestHeader("Content-Type",b.type),k.setRequestHeader("Content-Disposition",'attachment; filename="'+encodeURIComponent(i)+'"'),"function"==typeof e&&(k.upload.onprogress=function(a){a.total>0&&e(a.loaded,a.total,i)}),k.onload=function(){g(),200===k.status?f(k.response):h({filename:i,status:k.status,statusText:k.statusText,response:k.response,responseText:k.responseText})},k.onerror=function(){g(),h({filename:i,status:500,statusText:"Connection Failed"})},k.onabort=function(){g(),h({filename:i,status:0,statusText:"abort"})},j[a].xhr=k,k.send(b)})}var e=a?a.domain:null,h=1,j={};this.uploadFiles=function(a,b,k,l){if(!f)throw new Error("Promise support is required to use FileUpload");if(a.length>i)return f.reject("Exceeded maximum of 10 files per message");b=b||e;var m=b?"https://"+b:"",n=[],o=h++;j[o]={xhr:null,deleteUrls:[]};var p=[];a.forEach(function(a){g.isSupportedImage&&g.isSupportedImage(a.type)&&p.push(d(a))});var q=f.all(p).then(function(b){return Array.prototype.push.apply(a,b),k=k||null,a.reduce(function(a,b){return a.then(function(){return c(o,b,k,m,l).then(function(a){var c=JSON.parse(a)[0];k=k||c.id;var d=c.fileid[c.fileid.length-1],e=b.modifiedName||b.name,f={fileId:d,fileName:e,itemId:k,mimeType:c.mimeType||b.type,size:b.size,url:m+"/fileapi?fileid="+d+"&itemid="+k,deleteUrl:m+"/fileapi?fileid="+d+"&itemid="+k};return n.push(f),j[o].deleteUrls.push(f.deleteUrl),n})})},f.resolve())}).then(function(a){return delete j[o],f.resolve(a)},function(a){return delete j[o],f.reject(a)});return q.__uploadId=o,q},this.abort=function(a){if(a&&a.__uploadId&&j[a.__uploadId]){var c=j[a.__uploadId];delete j[a.__uploadId],c.xhr&&c.xhr.abort(),b(c.deleteUrls)}}}var f,g=a.Utils,h="#f0f0f0",i=10,j=312,k=484,l="tHuMbNaIl___";return"undefined"!=typeof Promise&&(f=Promise),e.COMPRESSED_IMG_PREFIX=l,e.overridePromise=function(a){f=a},a.FileUpload=e,a}(Circuit||{}),Circuit=function(a){"use strict";function b(a){var b={};this.dispatch=function(c){var d=c&&c.type;return d?void(b[d]?b[d].forEach(function(b){try{b(c)}catch(b){a&&a.error(b)}}):a&&a.debug("[EventTarget]: There is no listener for "+d)):void(a&&a.error("[EventTarget]: Attempted to dispatch a bad event"))},this.addEventListener=function(c,d){return c&&"function"==typeof d?(b[c]||(b[c]=[]),b[c].indexOf(d)>=0?void(a&&a.warning("[EventTarget]: Attempted to add duplicate event listener")):(b[c].push(d),void(a&&a.debug("[EventTarget]: Added event listener for "+this.name+", type = "+c+", count = "+b[c].length)))):void(a&&a.error("[EventTarget]: addEventListener invoked with invalid arguments"))},this.removeEventListener=function(c,d){if(b[c]){var e=b[c].indexOf(d);e>=0&&b[c].splice(e,1),a&&a.debug("[EventTarget]: Removed event listener for "+this.name+", type = "+c+", count = "+b[c].length)}},this.hasEventListener=function(a){return!!b[a]&&b[a].length>0},this.removeAllListeners=function(){b={}}}return b.prototype.constructor=b,b.prototype.createEvent=function(a){return{type:a}},b.prototype.dispatchEvent=function(a){var b=this.createEvent(a);this.dispatch(b)},a.BaseEventTarget=b,a}(Circuit||{}),Circuit=function(a){"use strict";function b(c){function h(){var a={};return B&&(a.accessToken=B),C&&Object.assign(a,C),"wss://"+A+z+(Object.keys(a).length?"?"+g.toQS(a):"")}function i(a,b,c){if(b){var d=window.setTimeout(function(a){if(p.error("[ConnectionHandler]: Timeout waiting for response. RequestId:",a),x[a]){delete x[a],b(e.ReturnCode.REQUEST_TIMEOUT);var c=Object.keys(x).length;p.debug("[ConnectionHandler]: Remaining callbacks pending: ",c),0===c&&l(),v.pingServer()}},q,a);Array.isArray(c)||(c=null),x[a]={cb:b,timer:d,keysToOmitFromResponse:c}}}function j(a){var b;switch(a.msgType){case e.WSMessageType.RESPONSE:if(!a.response||!a.response.code)return null;if(a.response.user){var c;"GET_STUFF"===a.response.user.type?c=a.response.user.getStuff.user:"GET_LOGGED_ON"===a.response.user.type&&(c=a.response.user.getLoggedOn.user),c&&(c.clientId=a.clientId,c.apiVersion=a.apiVersion)}if(x[a.response.requestId])return b=x[a.response.requestId],delete x[a.response.requestId],b.timer&&window.clearTimeout(b.timer),b.keysToOmitFromResponse&&(a.keysToOmitFromLogging=b.keysToOmitFromResponse),{type:"ack",cb:b.cb,data:a.response};p.debug("[ConnectionHandler]: No callback for response with requestId=",a.response.requestId);break;case e.WSMessageType.EVENT:var d=f.ParseEvent(a.event);if(d&&d.name){if(w[d.name])return b=w[d.name],p.debug("[ConnectionHandler]: Parsed event: ",d.name),v.ommitKeysFromLog&&b.keysToOmitFromEvent&&(a.keysToOmitFromLogging=b.keysToOmitFromEvent),{type:"evt",cbList:b.cbList,name:d.name,data:d.data,suppressLog:b.suppressLog}}else p.error("[ConnectionHandler]: Failed to parse event: ",a.event);p.debug("[ConnectionHandler]: No registered callback for event ",d.name);break;default:p.error("[ConnectionHandler]: Unexpected message type: ",a.msgType)}return null}function k(a){p.debug("[ConnectionHandler]: Raising event",a.name),a.cbList.forEach(function(b){try{b(a.data)}catch(a){p.error("[ConnectionHandler]: Error raising event. ",a)}})}function l(){y.length>0&&(p.debug("[ConnectionHandler]: Raise all delayed events"),y.forEach(function(a){window.clearTimeout(a.timeoutId),k(a)}),y=[])}function m(a){if(p.debug("[ConnectionHandler]: WebSocket connection state changed to ",a.newState),p.debug("[ConnectionHandler]: Raising connectionStateChange event"),a.newState===d.Connected)F=0,!H&&G>0&&(H=window.setInterval(function(){v.pingServer()},G));else if(H&&(window.clearInterval(H),H=null),Object.keys(x).length){var b=x;x={},window.setTimeout(function(){Object.keys(b).forEach(function(a){var c=b[a];c.timer&&window.clearTimeout(c.timer),c.cb(e.ReturnCode.DISCONNECTED)}),l()},0)}var c=v.createEvent("connectionStateChange");c.newState=a.newState,c.oldState=a.oldState,v.dispatch(c)}function n(){p.debug("[ConnectionHandler]: WebSocket failed to reconnect. Raising reconnectFailed event");var a=v.createEvent("reconnectFailed");v.dispatch(a)}function o(a){!F&&a.apiVersion&&(F=g.convertVersionToNumber(a.apiVersion));var b=j(a);if(b)if(b.suppressLog||p.msgRcvd("[ConnectionHandler]: ",a),"evt"===b.type)Object.keys(x).length>0&&/^(?:User|Conversation|Search)\./.test(b.name)?(p.debug("[ConnectionHandler]: Delay event:",b.name),b.timeoutId=window.setTimeout(function(){k(b);var a=y.indexOf(b);a!==-1&&y.splice(a,1)},u),y.push(b)):k(b);else{var c=Object.keys(x).length;p.debug("[ConnectionHandler]: Remaining callbacks pending: ",c),b.cb(null,b.data),0===c&&l()}}var p=a.logger;c=c||{},b.parent.constructor.call(this,p);var q=6e4,r=1e4,s=3e5,t=3e4,u=500,v=this,w={},x={},y=[],z="/api",A=window.location.host,B=null,C=null,D=Object.keys(e.DeviceType),E={deviceType:!0,deviceSubtype:!0,manufacturer:!0,osVersion:!0,clientVersion:!0,hardwareModel:!0,capabilities:!0},F=0,G=c.disablePing||g.isMobile()?-1:s,H=null,I=!1,J=new a.ConnectionController(c);J.onStateChange=m,J.onReconnectFailed=n,J.onMessage=o,this.ommitKeysFromLog=!0,this.onMessage=o,this.setRelativeUrl=function(a){z=a,p.debug("[ConnectionHandler]: Set relative URL to ",z)},this.setTarget=function(a){A=a||window.location.host,p.debug("[ConnectionHandler]: Set target to ",A)},this.setClientInfo=function(a){if(a){if(!a.deviceSubtype||D.indexOf(a.deviceType)===-1)return void p.warn("[ConnectionHandler]: Attempted to set invalid clientInfo: ",a);C={},Object.keys(a).forEach(function(b){E[b]&&(C[b]=a[b])}),p.debug("[ConnectionHandler]: Set clientInfo to ",C)}else p.debug("[ConnectionHandler]: Clear clientInfo"),C=null},this.setToken=function(a){B=a},this.getUrl=h,this.getState=function(){return J.getState()},this.connect=function(a,b){p.debug("[ConnectionHandler]: Connect WebSocket to Access Server"),J.connect(h(),a,b)},this.disconnect=function(){p.debug("[ConnectionHandler]: Disconnect WebSocket from Access Server"),J.disconnect()},this.reconnect=function(a){p.debug("[ConnectionHandler]: Reconnect WebSocket to Access Server."),J.reconnect(h(),a)},this.sendMessage=function(a,b,c){return a&&a.request&&a.request.requestId?(p.debug("[ConnectionHandler]: Sending "+a.request.type+" request"),J.sendMessage(a)?(b&&i(a.request.requestId,b,c),!0):(p.error("[ConnectionHandler]: Failed to send message"),b&&window.setTimeout(function(){b(e.ReturnCode.FAILED_TO_SEND)},0),!1)):(p.error("[ConnectionHandler]: Cannot send message. Invalid message: ",a),b&&window.setTimeout(function(){b(e.ReturnCode.INVALID_MESSAGE)},0),!1)},this.pingServer=function(){if(J.isConnected()&&!I){var a,b="PING";if(g.isMobile()||(a=++f.requestNr,b+="|"+a),J.sendMessage(b),a){I=!0;var c=window.setTimeout(function(){I=!1,p.error("[ConnectionHandler]: Timed out waiting for ping response. RequestId:",a),delete x[a],J.reconnect(h())},r);x[a]={cb:function(){I=!1},timer:c}}}},this.setPingInterval=function(a){"number"==typeof a&&(a=a<0?-1:Math.max(Math.floor(a),t),G!==a&&(G=a,H&&(window.clearInterval(H),H=null),G<0?p.info("[ConnectionHandler]: Disable ping"):(p.info("[ConnectionHandler]: Set ping interval time to ",G),
J.isConnected()&&(p.info("[ConnectionHandler]: Restart ping interval"),H=window.setInterval(function(){v.pingServer()},G)))))},this.on=function(a,b,c){if(a&&b){var d=w[a]||{cbList:[]};d.cbList.push(b),c&&(Array.isArray(c)?d.keysToOmitFromEvent=c:"*"===c&&(d.suppressLog=!0)),w[a]=d}}}var c=a.BaseEventTarget,d=a.Enums.ConnectionState,e=a.Constants,f=a.Proto,g=a.Utils;return g.inherit(b,c),b.prototype.name="ConnectionHandler",a.ConnectionHandler=b,a}(Circuit),Circuit=function(a){"use strict";function b(b){function h(a,b,c,d,e){var g=f.Request(a,b);return E?e=null:d&&(g.keysToOmitFromLogging=d),D.sendMessage(g,function(a,b){try{c(a,b)}catch(a){x.error("[ClientApiHandler]: Exception: ",a)}},e),g.request.requestId}function i(a,b){Circuit.Error&&(t=new Circuit.Error(a),b&&(t.errObj=b,t.message=b.info))}function j(a,b,c,e){if(t=null,a)return i(a),c(a),!1;if(b.code===d.ReturnCode.NO_RESULT)return e?c(null,[]):(i(d.ReturnCode.NO_RESULT),c(d.ReturnCode.NO_RESULT)),!1;var f,g=b.code;switch(b.code){case d.ReturnCode.OK:case d.ReturnCode.ENTITY_ALREADY_EXISTS:return!0;case d.ReturnCode.SERVICE_EXCEPTION:b.errorInfo&&b.errorInfo.errorCode&&(g=b.errorInfo.errorCode,g===d.ErrorCode.THIRDPARTY_ERROR&&b.errorInfo.thirdpartyError&&(g=b.errorInfo.thirdpartyError.type),f=b.errorInfo)}return g=g||d.ReturnCode.UNEXPECTED_RESPONSE,i(g,f),c(g),!1}function k(a,b,c){b&&i(b),a&&a!==C&&window.setTimeout(function(){a(b,c)},0)}function l(a){var b=[];return a?(a.audio&&b.push(d.RealtimeMediaType.AUDIO),a.video&&b.push(d.RealtimeMediaType.VIDEO),a.desktop&&b.push(d.RealtimeMediaType.DESKTOP_SHARING)):b.push(d.RealtimeMediaType.AUDIO),b}function m(a){return a&&{fileId:a.fileId,fileName:a.fileName,mimeType:a.mimeType,size:a.size,itemId:a.itemId}}function n(a){return a&&a.map(m)}function o(a){return a&&{attachment:m(a.attachment),type:a.type,downloadLocation:a.downloadLocation,previewLocation:a.previewLocation,shareLinkToken:a.shareLinkToken}}function p(a){return a&&a.map(o)}function q(a){var b={convId:a.convId,rtcSessionId:a.rtcSessionId,ownerId:a.ownerId,sdp:a.sdp,mediaType:l(a.mediaType),callOut:!!a.callOut,handover:!!a.handover,sendInviteCancel:!!a.sendInviteCancel,peerUserId:a.peerUserId||void 0,replaces:a.replaces,from:a.fromDn||a.fromName?{phoneNumber:a.fromDn,displayName:a.fromName,resolvedUserId:a.fromUserId}:void 0,to:a.dialedDn?{phoneNumber:a.dialedDn,displayName:a.toName,resolvedUserId:a.toUserId}:void 0,isTelephonyConversation:!!a.isTelephonyConversation,displayName:a.displayName,transactionId:a.transactionId,screenSharePointerSupported:a.screenSharePointerSupported,asyncSupported:!0,noCallLog:a.noCallLog||void 0};return b}function r(a){a=a||C,x.debug("[ClientApiHandler]: getApiVersion...");var b={type:d.VersionActionType.GET_VERSION};h(d.ContentType.VERSION,b,function(b,c){if(b||c.code!==d.ReturnCode.OK)F=0;else{var e=c.version.getVersion.version;x.info("[ClientApiHandler]: Setting client API version to ",e),F=g.convertVersionToNumber(e)}a()})}function s(a,b){b=b||C,x.debug("[ClientApiHandler]: getStuff..."),a&&a.length||(a=[d.GetStuffType.USER,d.GetStuffType.ACCOUNTS,d.GetStuffType.FIRST_WEB_LOGIN,d.GetStuffType.PRESENCE_STATE,d.GetStuffType.RECENT_SEARCHES,d.GetStuffType.SETTINGS,d.GetStuffType.SUPPORT_CONVERSATION_ID,d.GetStuffType.TELEPHONY_CONVERSATION_ID,d.GetStuffType.GLOBAL_PROPERTIES,d.GetStuffType.TENANT,d.GetStuffType.NOTIFICATION_SUBSCRIPTIONS]);var c={type:d.UserActionType.GET_STUFF,getStuff:{types:a}},e=["response.user.getStuff.accounts.[].telephonyConfiguration.onsSipAuthenticationHash","response.user.getStuff.accounts.[].telephonyConfiguration.ondSipAuthenticationHash","response.user.getStuff.userPresenceState.longitude","response.user.getStuff.userPresenceState.latitude","response.user.getStuff.userPresenceState.locationText","response.user.getStuff.userPresenceState.statusMessage"];h(d.ContentType.USER,c,function(c,e){if(j(c,e,b)){var f=e.user.getStuff;a.includes(d.GetStuffType.USER)&&(f.user.userPresenceState=f.userPresenceState,f.user.accounts=f.accounts||[],F=g.convertVersionToNumber(f.user.apiVersion),u=f.user.clientId,v=f.user.userId),b(null,f)}},null,e)}var t,u,v,w,x=a.logger,y=2090035,z=2090040,A=2090043,B=2090045,C=function(){},D=new c(b),E=!1,F=0;Object.defineProperties(this,{clientId:{enumerable:!0,get:function(){return u},set:function(a){"simulatedDirect"===a&&(u=a)}},clientApiVersion:{enumerable:!0,get:function(){return F}}}),this.getLastError=function(){return t},this.connect=function(a,b,c){c&&D.setTarget(c),D.connect(a,b)},this.disconnect=D.disconnect.bind(D),this.reconnect=D.reconnect.bind(D),this.pingServer=D.pingServer.bind(D),this.setPingInterval=D.setPingInterval.bind(D),this.setTarget=D.setTarget.bind(D),this.setClientInfo=D.setClientInfo.bind(D),this.setToken=D.setToken.bind(D),this.setRelativeUrl=D.setRelativeUrl.bind(D),this.addEventListener=D.addEventListener.bind(D),this.removeEventListener=D.removeEventListener.bind(D),this.setDevelopmentMode=function(a){E=!!a,D.ommitKeysFromLog=!a},this.on=function(a,b){var c;switch(a){case"Account.TELEPHONY_CONFIGURATION_UPDATED":c=["event.account.telephonyConfigurationUpdated.configuration.onsSipAuthenticationHash","event.account.telephonyConfigurationUpdated.configuration.ondSipAuthenticationHash"];break;case"Conversation.ADD_ITEM":c=["event.conversation.addItem.item.text","event.conversation.addItem.item.system.renamedConversation"];break;case"Conversation.UPDATE_ITEM":c=["event.conversation.updateItem.item.text"];break;case"Conversation.CREATE":c=["event.conversation.create.conversation.topic","event.conversation.create.conversation.description"];break;case"Conversation.UPDATE":c=["event.conversation.update.conversation","event.conversation.update.topic","event.conversation.update.description"];break;case"RTCSession.QUESTION_EVENT":c=["event.rtcSession.questionEvent.question.questionText"];break;case"User.USER_PRESENCE_CHANGE":c="*";break;case"Search.BASIC_SEARCH_RESULT":c=["event.search.basicSearchResult.searchResults"];break;case"ThirdParty.CONNECTED_TO_THIRDPARTY":c=["event.thirdParty.oAuthData"]}D.on(a,b,c)},this.isSkype4BAdminSupported=function(){return F>y},this.isSennheiserSupported=function(){return F>z},this.isBridgeNumberSelectionSupported=function(){return F>A},this.isImprovedNotificationsSupported=function(){return F>A},this.isDeviceDiagnosticsSupported=function(){return F>B},this.isUpdateOpenScapeSiteSupported=function(){return F>B},this.logout=function(a){a=a||C,x.debug("[ClientApiHandler]: logout...");var b={type:d.UserActionType.LOGOUT,logoff:{invalidate:!0}};h(d.ContentType.USER,b,function(b,c){j(b,c,a)&&a(null)})},this.getUser=function(a,b){b=b||C,x.debug("[ClientApiHandler]: getUser...");var c={type:d.UserActionType.GET_USER_BY_ID,getById:{userId:a}};h(d.ContentType.USER,c,function(a,c){j(a,c,b)&&b(null,c.user.getById.user)})},this.updateUser=function(a,b){b=b||C,x.debug("[ClientApiHandler]: updateUser...");var c={type:d.UserActionType.UPDATE,update:a};h(d.ContentType.USER,c,function(a,c){j(a,c,b)&&b(null,c.user.updateResult.user)})},this.getLoggedOnUser=function(a){a=a||C,x.debug("[ClientApiHandler]: getLoggedOnUser...");var b={type:d.UserActionType.GET_LOGGED_ON},c=["response.user.getLoggedOn.user.userPresenceState.longitude","response.user.getLoggedOn.user.userPresenceState.latitude","response.user.getLoggedOn.user.userPresenceState.locationText","response.user.getLoggedOn.user.userPresenceState.statusMessage","response.user.getLoggedOn.userPresenceState.longitude","response.user.getLoggedOn.userPresenceState.latitude","response.user.getLoggedOn.userPresenceState.locationText","response.user.getLoggedOn.userPresenceState.statusMessage"];h(d.ContentType.USER,b,function(b,c){var d,e;j(b,c,a)&&(e=c.user.getLoggedOn,d=e.user,e.userPresenceState=e.userPresenceState||d.userPresenceState,d.userPresenceState=e.userPresenceState,d.accounts=e.accounts||[],F=g.convertVersionToNumber(d.apiVersion),u=d.clientId,v=d.userId,a(null,e))},null,c)},this.getStuff=function(a,b){r(s.bind(this,a,b))},this.setPresence=function(a,b){b=b||C,x.debug("[ClientApiHandler]: setPresence...");var c={type:d.UserActionType.SET_PRESENCE,presence:{state:a.state,inTransit:a.inTransit,longitude:a.longitude,latitude:a.latitude,locationText:a.locationText,isAccurate:a.isAccurate,timeZoneOffset:a.timeZoneOffset,mobile:a.mobile,dndUntil:a.dndUntil,statusMessage:a.statusMessage||""}},e=["request.user.presence.longitude","request.user.presence.latitude","request.user.presence.locationText","request.user.presence.statusMessage"],f=["response.user.setPresence.state.longitude","response.user.setPresence.state.latitude","response.user.setPresence.state.locationText","response.user.setPresence.state.statusMessage"];h(d.ContentType.USER,c,function(a,c){j(a,c,b)&&b(null,c.user.setPresence.state)},e,f)},this.getPresence=function(a,b,c){c=c||C,x.debug("[ClientApiHandler]: getPresence...");var e=["response.user.getPresence.states.[].longitude","response.user.getPresence.states.[].latitude","response.user.getPresence.states.[].locationText","response.user.getPresence.states.[].statusMessage"],f={type:d.UserActionType.GET_PRESENCE,getPresence:{userIds:a,full:!!b}};h(d.ContentType.USER,f,function(a,b){j(a,b,c)&&c(null,b.user.getPresence.states)},null,e)},this.subscribePresence=function(a,b){b=b||C,x.debug("[ClientApiHandler]: subscribePresence...");var c=["response.user.subscribePresence.states.[].longitude","response.user.subscribePresence.states.[].latitude","response.user.subscribePresence.states.[].locationText","response.user.subscribePresence.states.[].statusMessage"],e={type:d.UserActionType.SUBSCRIBE_PRESENCE,subscribePresence:{userIds:a}};h(d.ContentType.USER,e,function(a,c){if(j(a,c,b)){var d=c.user&&c.user.subscribePresence&&c.user.subscribePresence.states;b(null,d)}},null,c)},this.unsubscribePresence=function(a,b){b=b||C,x.debug("[ClientApiHandler]: unsubscribePresence...");var c={type:d.UserActionType.UNSUBSCRIBE_PRESENCE,unsubscribePresence:{userIds:a}};h(d.ContentType.USER,c,function(a,c){j(a,c,b)&&b(null)})},this.updateStatusSubscription=function(a,b,c){c=c||C,x.debug("[ClientApiHandler]: updateStatusSubscription - subscribe = ",b);var e;e=b?{type:d.UserActionType.SUBSCRIBE_PRESENCE,subscribePresence:{userIds:a,notificationSubscriptionType:d.NotificationSubscriptionType.ONLINE_STATUS}}:{type:d.UserActionType.UNSUBSCRIBE_PRESENCE,unsubscribePresence:{userIds:a,notificationSubscriptionType:d.NotificationSubscriptionType.ONLINE_STATUS}},h(d.ContentType.USER,e,function(a,b){j(a,b,c)&&c(null)})},this.changePassword=function(a,b,c){c=c||C,x.debug("[ClientApiHandler]: changePassword...");var e={type:d.UserActionType.CHANGE_PASSWORD,changePassword:{oldPassword:a,newPassword:b}},f=["request.user.changePassword.oldPassword","request.user.changePassword.newPassword"];h(d.ContentType.USER,e,function(a,b){j(a,b,c)&&c(null,b.user.changePasswordResult.changeResult)},f)},this.setPassword=function(a,b){b=b||C,x.debug("[ClientApiHandler]: setPassword...");var c={type:d.UserActionType.SET_PASSWORD,setPassword:{password:a}},e=["request.user.setPassword.password"];h(d.ContentType.USER,c,function(a,c){j(a,c,b)&&b(null,c.user.setPasswordResult.resultSetPassword)},e)},this.getLdapTechnicalUserPresence=function(a){a=a||C,x.debug("[ClientApiHandler]: getLdapTechnicalUserPresence...");var b={type:d.UserActionType.GET_LDAP_TECHNICAL_USER_PRESENCE};h(d.ContentType.USER,b,function(b,c){j(b,c,a)&&a(null,c.user.getLdapTechnicalUserPresenceResult.state)})},this.subscribeDevices=function(a){a=a||C,x.debug("[ClientApiHandler]: subscribeDevices...");var b={type:d.UserActionType.SUBSCRIBE_DEVICES};h(d.ContentType.USER,b,function(b,c){if(j(b,c,a)){var d=c.user&&c.user.subscribeDevices&&c.user.subscribeDevices.devices;a(null,d)}})},this.unsubscribeDevices=function(a){a=a||C,x.debug("[ClientApiHandler]: unsubscribeDevices...");var b={type:d.UserActionType.UNSUBSCRIBE_DEVICES};h(d.ContentType.USER,b,function(b,c){j(b,c,a)&&a(null)})},this.requestEmailChange=function(a,b,c){x.debug("[ClientApiHandler]: requestEmailChange");var e={type:d.UserActionType.GENERATE_EMAIL_UPDATE_TOKEN,generateEmailUpdateToken:{userId:a,emailAddress:b}};h(d.ContentType.USER,e,function(a,b){j(a,b,c)&&c(null)})},this.getUsersByIds=function(a,b){b=b||C,x.debug("[ClientApiHandler]: getUsersByIds...");var c={type:d.UserActionType.GET_USERS_BY_IDS,usersByIds:{userIds:a,complete:!0}};h(d.ContentType.USER,c,function(a,c){j(a,c,b)&&b(null,c.user.usersByIds.user)})},this.getPartialUsersByIds=function(a,b){b=b||C,x.debug("[ClientApiHandler]: getPartialUsersByIds...");var c={type:d.UserActionType.GET_USERS_BY_IDS,usersByIds:{userIds:a,complete:!1}};h(d.ContentType.USER,c,function(a,c){j(a,c,b)&&b(null,c.user.usersByIds.user)})},this.renewToken=function(a,b){b=b||function(a){a?x.error("[ClientApiHandler]: Error renewing token. This client will be automatically logged out",a):x.debug("[ClientApiHandler]: Successfully renewed token.")},x.debug("[ClientApiHandler]: renewToken");var c={type:d.UserActionType.RENEW_TOKEN};h(d.ContentType.USER,c,function(a,c){j(a,c,b)&&b(null,c.user.renewToken)})},this.getUserSettings=function(a,b){b=b||C,a=a||d.UserSettingArea.ALL,x.debug("[ClientApiHandler]: getUserSettings...");var c={type:d.UserActionType.GET_USER_SETTINGS,getUserSettings:{areas:a}};h(d.ContentType.USER,c,function(a,c){j(a,c,b)&&b(null,c.user.getUserSettings.settings)})},this.setUserSettings=function(a,b){if(b=b||C,x.debug("[ClientApiHandler]: setUserSettings..."),!a||Array.isArray(a)&&!a.length)return x.warn("[ClientApiHandler]: No settings were provided"),void k(b,d.ReturnCode.INVALID_MESSAGE);if(Array.isArray(a)||(a=[a]),!this.isImprovedNotificationsSupported()&&(a=a.filter(function(a){switch(a.key){case d.UserSettingKey.DESKTOP_MESSAGE_NOTIFICATIONS_SETTING:case d.UserSettingKey.MOBILE_MESSAGE_NOTIFICATIONS_SETTING:case d.UserSettingKey.PLAY_SOUND_MESSAGE_NOTIFICATIONS:case d.UserSettingKey.PLAY_SOUND_RTC:case d.UserSettingKey.PLAY_SYSTEM_SOUNDS:return x.warn("[ClientApiHandler]: Requested setting is not supported by backend: ",a),!1;default:return!0}}),!a.length))return void k(b,d.ReturnCode.OPERATION_NOT_SUPPORTED);var c={type:d.UserActionType.SET_USER_SETTINGS,setUserSettings:{settings:a}};h(d.ContentType.USER,c,function(a,c){j(a,c,b)&&b(null)})},this.getUserByEmail=function(a,b){b=b||C;var c={type:d.UserActionType.GET_USER_BY_MAIL,getUserByMail:{emailAddress:a,excludeRoles:[d.UserRole.SUPPORT,d.UserRole.SYSTEM_ADMIN]}};h(d.ContentType.USER,c,function(a,c){j(a,c,b)&&b(null,c.user.getUserByMail.user)})},this.getUsersByEmails=function(a,b){b=b||C,x.debug("[ClientApiHandler]: getUsersByEmails...");var c={type:d.UserActionType.GET_USERS_BY_MAILS,getUsersByMails:{emailAddresses:a.emailAddresses,xmppLookup:!!a.xmppLookup,excludeRoles:[d.UserRole.SUPPORT,d.UserRole.SYSTEM_ADMIN]}};h(d.ContentType.USER,c,function(a,c){j(a,c,b,!0)&&b(null,c.user.getUsersByMails.users)})},this.changeUserEmail=function(a,b,c){c=c||C;var e={type:d.UserActionType.EMAIL_UPDATE,emailUpdate:{userId:a,emailAddress:b}};h(d.ContentType.USER,e,function(a,b){j(a,b,c)&&c(null,b.user.emailUpdate)})},this.goToSleep=function(a,b){b=b||C,x.debug("[ClientApiHandler]: goToSleep...");var c={type:d.UserActionType.GO_TO_SLEEP,userId:a};h(d.ContentType.USER,c,function(a,c){j(a,c,b)&&b(null)})},this.wakeUp=function(a){a=a||C,x.debug("[ClientApiHandler]: wakeUp...");var b={type:d.UserActionType.WAKE_UP};h(d.ContentType.USER,b,function(b,c){j(b,c,a)&&a(null)})},this.getDevices=function(a){a=a||C,x.debug("[ClientApiHandler]: getDevices...");var b={type:d.UserActionType.GET_DEVICES};h(d.ContentType.USER,b,function(b,c){j(b,c,a)&&a(null,c.user.getDevices.devices)})},this.getTelephonyData=function(a){a=a||C,x.debug("[ClientApiHandler]: getTelephonyData...");var b={type:d.UserActionType.GET_TELEPHONY_DATA};h(d.ContentType.USER,b,function(b,c){j(b,c,a)&&a(null,c.user.getTelephonyData.data)})},this.getConnectedApps=function(a){a=a||C,x.debug("[ClientApiHandler]: getConnectedApps...");var b={type:d.UserActionType.OAUTH_GET_GRANTED_ACCESS_TOKENS};h(d.ContentType.USER,b,function(b,c){j(b,c,a,!0)&&a(null,c.user.oAuthGetGrantedAccessTokens.oAuthGrantedAccess)})},this.revokeAccessToken=function(a,b){b=b||C,x.debug("[ClientApiHandler]: revokeAccessToken...");var c={type:d.UserActionType.OAUTH_REVOKE_ACCESS_TOKEN,oAuthRevokeGrantedAccessToken:{tokenId:a}};h(d.ContentType.USER,c,function(a,c){j(a,c,b)&&b(null)})},this.revokeAllManagedDevices=function(a){a=a||C,x.debug("[ClientApiHandler]: revokeAllManagedDevices...");var b={type:d.UserActionType.REVOKE_MANAGED_DEVICES};h(d.ContentType.USER,b,function(b,c){j(b,c,a)&&a(null)})},this.getSecurityTokenInfo=function(a){a=a||C,x.debug("[ClientApiHandler]: getSecurityTokenInfo...");var b={type:d.UserActionType.GET_SECURITY_TOKEN_INFO};h(d.ContentType.USER,b,function(b,c){j(b,c,a,!0)&&a(null,c.user.getSecurityTokenInfoResult.securityTokenInfo)})},this.revokeSecurityToken=function(a,b){b=b||C,x.debug("[ClientApiHandler]: revokeSecurityToken...");var c={type:d.UserActionType.REVOKE_SECURITY_TOKEN,revokeSecurityToken:{tokenIdHash:a}};h(d.ContentType.USER,c,function(a,c){j(a,c,b)&&b(null)})},this.getUserTenantSettings=function(a){a=a||C,x.debug("[ClientApiHandler]: getUserTenantSettings...");var b={type:d.UserActionType.GET_TENANT_SETTINGS};h(d.ContentType.USER,b,function(b,c){j(b,c,a,!0)&&a(null,c.user.getTenantSettings.tenantSettings)})},this.startBasicSearch=function(a,b,c){c=c||C,x.debug("[ClientApiHandler]: startBasicSearch...");var e={type:d.SearchActionType.START_BASIC_SEARCH,startBasicSearch:{searchTerm:a,priorizedConvs:b||void 0,newSearch:!0}};h(d.ContentType.SEARCH,e,function(a,b){j(a,b,c)&&c(null,b.search.startSearchResult.searchId)})},this.startDetailSearch=function(a,b,c,e,f){f=f||C,x.debug("[ClientApiHandler]: startDetailSearch...");var g={type:d.SearchActionType.START_DETAIL_SEARCH,startDetailSearch:{searchTerm:a,convId:b,searchId:c||void 0,resultSetLimit:e||0}};h(d.ContentType.SEARCH,g,function(a,b){j(a,b,f)&&f(null,b.search.startSearchResult.searchId)})},this.cancelSearch=function(a,b){b=b||C,x.debug("[ClientApiHandler]: cancelSearch...");var c={type:d.SearchActionType.CANCEL_SEARCH,cancelSearch:{searchId:a}};h(d.ContentType.SEARCH,c,function(a,c){j(a,c,b)&&b(null)})},this.getRecentSearches=function(a){a=a||C;var b={type:d.SearchActionType.GET_RECENT_SEARCHES};h(d.ContentType.SEARCH,b,function(b,c){j(b,c,a,!0)&&a(null,c.search.getRecentSearch.recentSearches)})},this.addRecentSearch=function(a,b){b=b||C;var c={type:d.SearchActionType.ADD_RECENT_SEARCH,addRecentSearch:{searchTerm:a}};h(d.ContentType.SEARCH,c,function(a,c){j(a,c,b)&&b(null)})},this.startUserSearch=function(a,b){b=b||C;var c={type:d.SearchActionType.START_USER_SEARCH,startUserSearch:{query:a.query,reversePhoneNumberLookup:!!a.reversePhoneNumberLookup}};h(d.ContentType.SEARCH,c,function(a,c){j(a,c,b)&&b(null,c.search.startSearchResult.searchId)})},this.searchConversationParticipants=function(a,b,c){c=c||C;var e={type:d.SearchActionType.SEARCH_CONVERSATION_PARTICIPANTS,searchConversationParticipants:{displayName:a,convId:b}};h(d.ContentType.SEARCH,e,function(a,b){j(a,b,c,!0)&&c(null,b.search.searchConversationParticipantsResult.participants||[])})},this.createConversation=function(a,b){b=b||C,x.debug("[ClientApiHandler]: createConversation...");var c=a.type;c||(c=a.participants.length>2?d.ConversationType.GROUP:d.ConversationType.DIRECT);var e={type:d.ConversationActionType.CREATE,create:{type:c,topic:a.topic,description:a.description||void 0,participants:a.participants,invitations:a.emailAddresses,locale:a.locale}},f=["request.conversation.create.topic","request.conversation.create.description"],g=["response.conversation.create.conversation.topic","response.conversation.create.conversation.description","response.conversation.create.conversation.topLevelItem"];h(d.ContentType.CONVERSATION,e,function(a,c){j(a,c,b)&&b(null,c.conversation.create.conversation,c.code===d.ReturnCode.ENTITY_ALREADY_EXISTS)},f,g)},this.updateConversation=function(a,b){b=b||C,x.debug("[ClientApiHandler]: updateConversation...");var c={type:d.ConversationActionType.UPDATE,update:{convId:a.conversationId,topic:a.topic,description:a.description}},e=["request.conversation.update.topic","request.conversation.update.description"],f=["response.conversation.update.conversation.participants","response.conversation.update.conversation.topic","response.conversation.update.conversation.description","response.conversation.update.conversation.topLevelItem"];h(d.ContentType.CONVERSATION,c,function(a,c){j(a,c,b)&&b(null,c.conversation.update.conversation)},e,f)},this.addTextItem=function(a,b){b=b||C,x.debug("[ClientApiHandler]: addTextItem...");var c=a.content&&g.sanitize(a.content)&&g.sanitizeSymbols(a.content)||"";c=e.convertPrivateDataToContent(a)+c;var f={type:d.ConversationActionType.ADD_TEXT_ITEM,addTextItem:{convId:a.convId,parentId:a.parentId,contentType:a.contentType,subject:a.subject,content:c,attachmentMetaData:n(a.attachmentMetaData),externalAttachmentMetaData:p(a.externalAttachmentMetaData),preview:a.preview,mentionedUsers:a.mentionedUsers}};f.addTextItem.preview&&f.addTextItem.preview.description&&(f.addTextItem.preview.description=f.addTextItem.preview.description.substr(0,255));var i=["request.conversation.addTextItem.subject","request.conversation.addTextItem.content"],k=["response.conversation.addTextItem.item.text"];h(d.ContentType.CONVERSATION,f,function(a,c){j(a,c,b)&&b(null,c.conversation.addTextItem.item)},i,k)},this.updateTextItem=function(a,b){b=b||C,x.debug("[ClientApiHandler]: updateTextItem...");var c=a.content&&g.sanitize(a.content)&&g.sanitizeSymbols(a.content)||"";c=e.convertPrivateDataToContent(a)+c;var f={itemId:a.itemId,convId:a.convId,parentId:a.parentId,contentType:d.TextItemContentType.RICH,subject:a.subject,content:c,attachmentMetaData:n(a.attachmentMetaData),preview:a.preview||{},clustered:a.clustered,externalAttachmentMetaData:p(a.externalAttachmentMetaData),mentionedUsers:a.mentionedUsers};f.preview.description&&(f.preview.description=f.preview.description.substr(0,255)),f.externalAttachmentMetaData&&0!==f.externalAttachmentMetaData.length||(f.externalAttachmentMetaData=[{type:"BOX",downloadLocation:"",previewLocation:"",attachment:{}}]),f.attachmentMetaData&&0!==f.attachmentMetaData.length||(f.attachmentMetaData=[{}]);var i={type:d.ConversationActionType.UPDATE_TEXT_ITEM,updateTextItem:f},k=["request.conversation.updateTextItem.subject","request.conversation.updateTextItem.content"],l=["response.conversation.updateTextItem.item.text"];h(d.ContentType.CONVERSATION,i,function(a,c){j(a,c,b)&&b(null,c.conversation.updateTextItem.item)},k,l)},this.deleteTextItem=function(a,b){if(b=b||C,!a||!a.itemId)return x.warn("[ClientApiHandler]: No request parameters were provided"),void k(b,d.ReturnCode.INVALID_MESSAGE);x.debug("[ClientApiHandler]: deleteTextItem...");var c={type:d.ConversationActionType.DELETE_TEXT_ITEM,deleteTextItem:{itemId:a.itemId}};h(d.ContentType.CONVERSATION,c,function(a,c){j(a,c,b)&&b(null,c.conversation.deleteTextItem.item)})},this.deleteRecording=function(a,b){b=b||C,x.debug("[ClientApiHandler]: deleteRecording...");var c={type:d.ConversationActionType.DELETE_RECORDING,deleteRecording:{itemId:a}};h(d.ContentType.CONVERSATION,c,function(a,c){j(a,c,b)&&b(null,c.conversation.deleteRecording.item)})},this.updateRtcItemAttachments=function(a,b,c){c=c||C,x.debug("[ClientApiHandler]: updateRtcItemAttachments...");var e={type:d.ConversationActionType.UPDATE_RTC_ITEM_ATTACHMENTS,updateRtcItemAttachments:{itemId:a,attachments:n(b)}};h(d.ContentType.CONVERSATION,e,function(a,b){j(a,b,c)&&c(null,b.conversation.updateRtcItemAttachmentsResult.item)})},this.getOpenConversations=function(a,b,c){c=c||C,x.debug("[ClientApiHandler]: getOpenConversations...");var e={type:d.ConversationActionType.GET_OPEN_CONVERSATIONS,getOpenConversations:{startIndex:a,numberOfItems:b}},f=["response.conversation.getOpenConversations.conversations"];h(d.ContentType.CONVERSATION,e,function(a,b){if(j(a,b,c,!0)){var d=b.conversation.getOpenConversations;c(null,d.conversations,d.lastItemIndex)}},null,f)},this.getAllOpenConversations=function(a,b,c,e){e=e||C,x.debug("[ClientApiHandler]: getAllOpenConversations...");var f={type:d.ConversationActionType.GET_OPEN_CONVERSATIONS,getOpenConversations:{startIndex:a,numberOfItems:b,ownIncluded:!0,sorting:c}},g=["response.conversation.getOpenConversations.conversations"];h(d.ContentType.CONVERSATION,f,function(a,b){if(j(a,b,e,!0)){var c=b.conversation.getOpenConversations;e(null,c.conversations,c.lastItemIndex)}},null,g)},this.joinOpenConversation=function(a,b){b=b||C,x.debug("[ClientApiHandler]: JoinOpenConversation...");var c={type:d.ConversationActionType.JOIN_OPEN_CONVERSATION,joinOpenConversation:{convId:a}};h(d.ContentType.CONVERSATION,c,function(a,c){j(a,c,b)&&b(null,c.conversation.joinOpenConversation.conv)})},this.getConversationFeed=function(a,b,c,e,f,g,i){i=i||C,x.debug("[ClientApiHandler]: getConversationFeed...");var k={type:d.ConversationActionType.GET_CONVERSATION_FEED,getConversationFeed:{convId:a,timestamp:b||void 0,minTotalItems:c||void 0,maxTotalUnread:e||void 0,commentsPerThread:f||void 0,maxUnreadPerThread:g||void 0}},l=["response.conversation.getConversationFeedResult.conversationThreads.[].parentItem.attachments","response.conversation.getConversationFeedResult.conversationThreads.[].parentItem.externalAttachments","response.conversation.getConversationFeedResult.conversationThreads.[].parentItem.rtc","response.conversation.getConversationFeedResult.conversationThreads.[].parentItem.text","response.conversation.getConversationFeedResult.conversationThreads.[].parentItem.system","response.conversation.getConversationFeedResult.conversationThreads.[].comments.[].attachments","response.conversation.getConversationFeedResult.conversationThreads.[].comments.[].externalAttachments","response.conversation.getConversationFeedResult.conversationThreads.[].comments.[].text"];h(d.ContentType.CONVERSATION,k,function(a,b){if(j(a,b,i,!0)){var c=b.conversation.getConversationFeedResult;i(null,c.conversationThreads,c.hasOlderThreads)}},null,l)},this.getThreadComments=function(a,b,c,e,f,g,i){i=i||C,x.debug("[ClientApiHandler]: getThreadComments...");var k={type:d.ConversationActionType.GET_THREAD_COMMENTS,getThreadComments:{convId:a,threadId:b,timestamp:c||void 0,timestampFilter:e||d.TimestampFilter.CREATION,direction:f||void 0,totalComments:g||void 0}},l=["response.conversation.getThreadCommentsResult.comments.[].attachments","response.conversation.getThreadCommentsResult.comments.[].externalAttachments","response.conversation.getThreadCommentsResult.comments.[].text"];h(d.ContentType.CONVERSATION,k,function(a,b){if(j(a,b,i,!0)){var c=b.conversation.getThreadCommentsResult;i(null,c.comments,c.hasMoreComments)}},null,l)},this.getThreadsByItemIds=function(a,b){if(x.debug("[ClientApiHandler]: getThreadsByItemIds..."),b=b||C,!a)return x.warn("[ClientApiHandler]: No request parameters were provided"),void k(b,d.ReturnCode.INVALID_MESSAGE);if(!a.convId)return x.warn("[ClientApiHandler]: No conversation id was provided"),void k(b,d.ReturnCode.INVALID_MESSAGE);if(!a.threadParams)return x.warn("[ClientApiHandler]: No thread parameters were provided (item ids were not provided)"),void k(b,d.ReturnCode.INVALID_MESSAGE);var c=["response.conversation.getThreadsByItemIdsResult.conversationThreadContext.[].parentItem.attachments","response.conversation.getThreadsByItemIdsResult.conversationThreadContext.[].parentItem.externalAttachments","response.conversation.getThreadsByItemIdsResult.conversationThreadContext.[].parentItem.rtc","response.conversation.getThreadsByItemIdsResult.conversationThreadContext.[].parentItem.text","response.conversation.getThreadsByItemIdsResult.conversationThreadContext.[].parentItem.system","response.conversation.getThreadsByItemIdsResult.conversationThreadContext.[].comments.[].item.attachments","response.conversation.getThreadsByItemIdsResult.conversationThreadContext.[].comments.[].item.externalAttachments","response.conversation.getThreadsByItemIdsResult.conversationThreadContext.[].comments.[].item.text","response.conversation.getThreadsByItemIdsResult.conversationThreadContext.[].lastComments.[].attachments","response.conversation.getThreadsByItemIdsResult.conversationThreadContext.[].lastComments.[].externalAttachments","response.conversation.getThreadsByItemIdsResult.conversationThreadContext.[].lastComments.[].text"],e={type:d.ConversationActionType.GET_THREADS_BY_ITEM_IDS,getThreadsByItemIds:{convId:a.convId,threadParams:a.threadParams,timestampFilter:a.timestampFilter||void 0,orderBy:a.orderBy||void 0}};h(d.ContentType.CONVERSATION,e,function(a,c){if(j(a,c,b,!0)){var d=c.conversation.getThreadsByItemIdsResult;b(null,d&&d.conversationThreadContext)}},null,c)},this.getThreadsByIds=function(a,b){if(x.debug("[ClientApiHandler]: getThreadsByIds..."),b=b||C,!a)return x.warn("[ClientApiHandler]: No request parameters were provided"),void k(b,d.ReturnCode.INVALID_MESSAGE);if(!a.convId)return x.warn("[ClientApiHandler]: No conversation id was provided"),void k(b,d.ReturnCode.INVALID_MESSAGE);if(!(a.threadIds instanceof Array&&a.threadIds.length>0))return x.warn("[ClientApiHandler]: No thread parameters were provided (thread ids were not provided)"),void k(b,d.ReturnCode.INVALID_MESSAGE);var c=["response.conversation.getThreadsByIdsResult.conversationThreads.[].parentItem.attachments","response.conversation.getThreadsByIdsResult.conversationThreads.[].parentItem.externalAttachments","response.conversation.getThreadsByIdsResult.conversationThreads.[].parentItem.rtc","response.conversation.getThreadsByIdsResult.conversationThreads.[].parentItem.text","response.conversation.getThreadsByIdsResult.conversationThreads.[].parentItem.system","response.conversation.getThreadsByIdsResult.conversationThreads.[].comments.[].attachments","response.conversation.getThreadsByIdsResult.conversationThreads.[].comments.[].externalAttachments","response.conversation.getThreadsByIdsResult.conversationThreads.[].comments.[].text"],e={type:d.ConversationActionType.GET_THREADS_BY_IDS,getThreadsByIds:{convId:a.convId,threadIds:a.threadIds,orderBy:a.orderBy||d.SortingType.TIMESTAMP_ASC,commentsPerThread:a.commentsPerThread||void 0}};h(d.ContentType.CONVERSATION,e,function(a,c){if(j(a,c,b,!0)){var d=c.conversation.getThreadsByIdsResult;b(null,d&&d.conversationThreads)}},null,c)},this.getConversations=function(a,b,c,e,f,g){g=g||C,x.debug("[ClientApiHandler]: getConversations...");var i=c?d.SearchDirection.BEFORE:d.SearchDirection.AFTER,k={type:d.ConversationActionType.GET_CONVERSATIONS,getConversations:{userId:a,modificationDate:b||void 0,direction:i,number:e||void 0,filter:f||d.ConversationFilter.ALL,sortByLastItem:!!c}},l=["response.conversation.getConversations.conversations"];h(d.ContentType.CONVERSATION,k,function(a,b){j(a,b,g,!0)&&g(null,b.conversation.getConversations.conversations)},null,l)},this.getSupportConversation=function(a){a=a||C,x.debug("[ClientApiHandler]: getSupportConversation...");var b={type:d.ConversationActionType.GET_SUPPORT_CONVERSATION};h(d.ContentType.CONVERSATION,b,function(b,c){j(b,c,a)&&a(null,c.conversation.getSupportConversation.conversation)})},this.getSupportConversationId=function(a){a=a||C,x.debug("[ClientApiHandler]: getSupportConversationId...");var b={type:d.ConversationActionType.GET_SUPPORT_CONVERSATION_ID};h(d.ContentType.CONVERSATION,b,function(b,c){j(b,c,a)&&a(null,c.conversation.getSupportConversationId.conversationId)})},this.getTelephonyConversationId=function(a){a=a||C,x.debug("[ClientApiHandler]: getTelephonyConversationId...");var b={type:d.ConversationActionType.GET_TELEPHONY_CONVERSATION_ID};h(d.ContentType.CONVERSATION,b,function(b,c){j(b,c,a)&&a(null,c.conversation.getTelephonyConversationId.conversationId)})},this.getMarkedConversationsList=function(a){a=a||C,x.debug("[ClientApiHandler]: getMarkedConversationsList...");
var b={type:d.ConversationActionType.GET_MARKED_CONVERSATIONS_LIST};h(d.ContentType.CONVERSATION,b,function(b,c){j(b,c,a)&&a(null,c.conversation.getMarkedConversationsList)})},this.getFavoriteConversationIds=function(a){a=a||C,x.debug("[ClientApiHandler]: getFavoriteConversationIds...");var b={type:d.ConversationActionType.GET_FAVORITE_CONVERSATION_IDS};h(d.ContentType.CONVERSATION,b,function(b,c){j(b,c,a,!0)&&a(null,c.conversation.getFavoriteConversationIdResult.favoriteConversationIds)})},this.markConversation=function(a,b){b=b||C;var c={type:d.ConversationActionType.MARK_CONVERSATION,markConversation:{convId:a.convId,filter:a.markType}};h(d.ContentType.CONVERSATION,c,function(a,c){j(a,c,b)&&b(null)})},this.unmarkConversation=function(a,b){b=b||C;var c={type:d.ConversationActionType.UNMARK_CONVERSATION,unmarkConversation:{convId:a.convId,filter:a.markType}};h(d.ContentType.CONVERSATION,c,function(a,c){j(a,c,b)&&b(null)})},this.getConversationUserData=function(a,b,c){c=c||C,x.debug("[ClientApiHandler]: getConversationUserData..."),a instanceof Array||(a=[a]);var e={type:d.ConversationActionType.GET_CONVERSATION_USER_DATA,getConversationUserData:{conversationId:a,userDataToInclude:b||void 0}};h(d.ContentType.CONVERSATION,e,function(a,b){j(a,b,c)&&c(null,b.conversation.getConversationUserData.userData)})},this.getConversationItems=function(a,b,c,e,f,g){g=g||C,x.debug("[ClientApiHandler]: getConversationItems...");var i={type:d.ConversationActionType.GET_ITEMS_BY_CONVERSATION,getItemsByConversation:{convId:a,modificationDate:b||void 0,creationDate:c||void 0,direction:e||void 0,number:f||void 0}},k=["response.conversation.getItemsByConversation.items.[].attachments","response.conversation.getItemsByConversation.items.[].externalAttachments","response.conversation.getItemsByConversation.items.[].rtc","response.conversation.getItemsByConversation.items.[].text","response.conversation.getItemsByConversation.items.[].system"];h(d.ContentType.CONVERSATION,i,function(a,b){j(a,b,g,!0)&&g(null,b.conversation.getItemsByConversation.items)},null,k)},this.getConversationAttachments=function(a,b,c){c=c||C,x.debug("[ClientApiHandler]: getConversationAttachments...");var e={type:d.ConversationActionType.GET_ATTACHMENTS,getAttachments:{conversationId:a,startPage:b.page||void 0,pageSize:b.size||void 0,orderType:b.type||void 0,orderDirection:b.direction||void 0}};h(d.ContentType.CONVERSATION,e,function(a,b){if(j(a,b,c)){var d=b.conversation.getAttachments.attachments||[],e=b.conversation.getAttachments.nextPage.hasMoreAttachments?b.conversation.getAttachments.nextPage.lastIndex:null;c(null,d,e)}})},this.getItemsByConversationItemId=function(a,b,c,e,f,g){g=g||C,x.debug("[ClientApiHandler]: getItemsByConversationItemId...");var i={type:d.ConversationActionType.GET_ITEMS_BY_CONVERSATION_ITEM_ID,getItemsByConversationItemId:{convId:a,itemId:b,direction:c||void 0,number:e||void 0,orderType:f||void 0}},k=["response.conversation.getItemsByConversationItemId.items.[].attachments","response.conversation.getItemsByConversationItemId.items.[].externalAttachments","response.conversation.getItemsByConversationItemId.items.[].rtc","response.conversation.getItemsByConversationItemId.items.[].text","response.conversation.getItemsByConversationItemId.items.[].system"];h(d.ContentType.CONVERSATION,i,function(a,b){j(a,b,g,!0)&&g(null,b.conversation.getItemsByConversationItemId.items)},null,k)},this.getConversationById=function(a,b){b=b||C,x.debug("[ClientApiHandler]: getConversationById...");var c={type:d.ConversationActionType.GET_CONVERSATION_BY_ID,getConversationById:{convId:a}},e=["response.conversation.getConversationById.conversation.participants","response.conversation.getConversationById.conversation.topic","response.conversation.getConversationById.conversation.description","response.conversation.getConversationById.conversation.topLevelItem"];h(d.ContentType.CONVERSATION,c,function(a,c){if(j(a,c,b)){var d=c.conversation.getConversationById.conversation;d&&d.participants&&x.info("[ClientApiHandler]: Retrieved conversation has "+d.participants.length+" participant(s)"),b(null,d)}},null,e)},this.getConversationsByIds=function(a,b){b=b||C,x.debug("[ClientApiHandler]: getConversationsByIds...");var c={type:d.ConversationActionType.GET_CONVERSATIONS_BY_IDS,getConversationsByIds:{conversationId:a}},e=["response.conversation.getConversationsByIdsResult.conversations"];h(d.ContentType.CONVERSATION,c,function(a,c){j(a,c,b,!0)&&b(null,c.conversation.getConversationsByIdsResult.conversations)},null,e)},this.getItemById=function(a,b){b=b||C,x.debug("[ClientApiHandler]: getItemById...");var c={type:d.ConversationActionType.GET_ITEM_BY_ID,getItemById:{itemId:a}},e=["response.conversation.getItemById.item.attachments","response.conversation.getItemById.item.externalAttachments","response.conversation.getItemById.item.rtc","response.conversation.getItemById.item.text","response.conversation.getItemById.item.system"];h(d.ContentType.CONVERSATION,c,function(a,c){j(a,c,b)&&b(null,c.conversation.getItemById.item)},null,e)},this.getItemsByIds=function(a,b){b=b||C,x.debug("[ClientApiHandler]: getItemsByIds...");var c={type:d.ConversationActionType.GET_ITEMS_BY_IDS,getItemsByIds:{itemIds:a}},e=["response.conversation.getItemsByIds.items.[].attachments","response.conversation.getItemsByIds.items.[].externalAttachments","response.conversation.getItemsByIds.items.[].rtc","response.conversation.getItemsByIds.items.[].text","response.conversation.getItemsByIds.items.[].system"];h(d.ContentType.CONVERSATION,c,function(a,c){j(a,c,b,!0)&&b(null,c.conversation.getItemsByIds.items)},null,e)},this.setReadPointer=function(a,b,c){c=c||C,x.debug("[ClientApiHandler]: setReadPointer...");var e={type:d.ConversationActionType.SET_READ_POINTER,setReadPointer:{convId:a,lastReadTimestamp:b}};h(d.ContentType.CONVERSATION,e,function(a,b){j(a,b,c)&&c(null)})},this.getConversationByUser=function(a,b){b=b||C,x.debug("[ClientApiHandler]: getConversationByUser...");var c={type:d.ConversationActionType.GET_CONVERSATION_BY_USER,getConversationByUser:{userId:a}},e=["response.conversation.getConversationByUser.conversation.topic","response.conversation.getConversationByUser.conversation.description","response.conversation.getConversationByUser.conversation.topLevelItem"];h(d.ContentType.CONVERSATION,c,function(a,c){j(a,c,b)&&b(null,c.conversation.getConversationByUser.conversation)},null,e)},this.getConversationsByFilter=function(a,b){b=b||C,x.debug("[ClientApiHandler]: getConversationsByFilter...");var c={type:d.ConversationActionType.GET_CONVERSATIONS_BY_FILTER,getConversationsByFilter:{conversationsFilter:a.filterConnector,timestamp:a.timestamp||void 0,number:a.number,numberOfParticipants:a.numberOfParticipants,retrieveAction:a.retrieveAction||void 0}},e=["response.conversation.getConversationsByFilterResult.conversations"];h(d.ContentType.CONVERSATION,c,function(a,c){j(a,c,b)&&b(null,c.conversation.getConversationsByFilterResult||{})},null,e)},this.subscribe=function(a,b){b=b||C,x.debug("[ClientApiHandler]: subscribe...");var c={type:d.ConversationActionType.SUBSCRIBE,subscribe:{conversationId:a}};h(d.ContentType.CONVERSATION,c,function(a,c){j(a,c,b)&&b(null)})},this.unsubscribe=function(a,b){b=b||C,x.debug("[ClientApiHandler]: unsubscribe...");var c={type:d.ConversationActionType.UNSUBSCRIBE,unsubscribe:{conversationId:a}};h(d.ContentType.CONVERSATION,c,function(a,c){j(a,c,b)&&b(null)})},this.typing=function(a,b,c,e){e=e||C,x.debug("[ClientApiHandler]: typing...");var f={type:d.ConversationActionType.TYPING,typing:{conversationId:a,isTyping:b,parentItemId:c}};h(d.ContentType.CONVERSATION,f,function(a,b){j(a,b,e)&&e(null)})},this.addParticipant=function(a,b){b=b||C,x.debug("[ClientApiHandler]: addParticipant...");var c={type:d.ConversationActionType.ADD_PARTICIPANT,addParticipant:{convId:a.convId,userId:a.userId,invitations:a.emailAddresses,locale:a.locale}};h(d.ContentType.CONVERSATION,c,function(a,c){j(a,c,b)&&b(null,c.conversation.addParticipant)})},this.removeParticipant=function(a,b,c){c=c||C,x.debug("[ClientApiHandler]: removeParticipant..."),!b||b instanceof Array||(b=[b]);var e={type:d.ConversationActionType.REMOVE_PARTICIPANT,removeParticipant:{convId:a,userId:b}};h(d.ContentType.CONVERSATION,e,function(a,b){j(a,b,c)&&c(null,b.conversation.removeParticipant.conversation)})},this.getConversationParticipants=function(a,b,c){c=c||C,x.debug("[ClientApiHandler]: getConversationParticipants..."),b=b||{};var e={type:d.ConversationActionType.GET_CONVERSATION_PARTICIPANTS,getConversationParticipants:{convId:a,searchCriterias:b.searchCriterias||void 0,searchPointer:b.searchPointer||void 0,pageSize:b.pageSize||25,includePresence:!!b.includePresence}};h(d.ContentType.CONVERSATION,e,function(a,b){j(a,b,c)&&c(null,b.conversation.getConversationParticipantsResult)})},this.getJoinDetails=function(a,b,c){c=c||C,x.debug("[ClientApiHandler]: getJoinDetails...");var e={type:d.ConversationActionType.GET_JOIN_DETAILS,getJoinDetails:{conversationId:a,recreate:!!b}},f=["response.conversation.getJoinDetails.tenantPIN","response.conversation.getJoinDetails.sessionPIN"];h(d.ContentType.CONVERSATION,e,function(a,b){j(a,b,c)&&c(null,b.conversation.getJoinDetails)},null,f)},this.setFlagItem=function(a,b){if(b=b||C,x.debug("[ClientApiHandler]: setFlagItem..."),!a)return x.warn("[ClientApiHandler]: No request parameters were provided"),void k(b,d.ReturnCode.INVALID_MESSAGE);var c={type:d.ConversationActionType.SET_FLAG_ITEM,setFlagItem:{conversationId:a.convId,conversationItemId:a.itemId,conversationItemCreationTime:a.creationTime,conversationParentId:a.parentId}};h(d.ContentType.CONVERSATION,c,function(a,c){j(a,c,b)&&b(null)})},this.clearFlagItem=function(a,b,c){c=c||C,x.debug("[ClientApiHandler]: clearFlagItem...");var e={type:d.ConversationActionType.CLEAR_FLAG_ITEM,clearFlagItem:{conversationId:a,conversationItemId:b}};h(d.ContentType.CONVERSATION,e,function(a,b){j(a,b,c)&&c(null)})},this.getFlaggedItems=function(a){a=a||C,x.debug("[ClientApiHandler]: getFlaggedItems...");var b={type:d.ConversationActionType.GET_FLAGGED_ITEMS};h(d.ContentType.CONVERSATION,b,function(b,c){j(b,c,a,!0)&&a(null,c.conversation.getFlaggedItem.flaggedItems)})},this.likeTextItem=function(a,b,c){c=c||C,x.debug("[ClientApiHandler]: likeTextItem...");var e={type:d.ConversationActionType.LIKE_TEXT_ITEM,likeTextItem:{conversationItemId:a,userId:b}};h(d.ContentType.CONVERSATION,e,function(a,b){j(a,b,c)&&c(null)})},this.unlikeTextItem=function(a,b,c){c=c||C,x.debug("[ClientApiHandler]: unlikeTextItem...");var e={type:d.ConversationActionType.UNLIKE_TEXT_ITEM,unlikeTextItem:{conversationItemId:a,userId:b}};h(d.ContentType.CONVERSATION,e,function(a,b){j(a,b,c)&&c(null)})},this.setConvAvatar=function(a,b,c){c=c||C,x.debug("[ClientApiHandler]: setConvAvatar...");var e={type:d.ConversationActionType.SET_CONVERSATION_AVATAR,setConversationAvatar:{convId:a,imageS:b.s,imageL:b.b}};h(d.ContentType.CONVERSATION,e,function(a,b){j(a,b,c)&&c(null,b.conversation.setConversationAvatar.conversation)})},this.deleteConvAvatar=function(a,b){b=b||C,x.debug("[ClientApiHandler]: deleteConvAvatar...");var c={type:d.ConversationActionType.SET_CONVERSATION_AVATAR,setConversationAvatar:{convId:a,imageS:"",imageL:""}};h(d.ContentType.CONVERSATION,c,function(a,c){j(a,c,b)&&b(null,c.conversation.setConversationAvatar.conversation)})},this.moderateConversation=function(a,b){b=b||C,x.debug("[ClientApiHandler]: moderateConversation...");var c={type:d.ConversationActionType.MODERATE_CONVERSATION,moderateConversation:{convId:a}};h(d.ContentType.CONVERSATION,c,function(a,c){j(a,c,b)&&b(null,c.conversation.moderateResult)})},this.unmoderateConversation=function(a,b){b=b||C,x.debug("[ClientApiHandler]: unmoderateConversation...");var c={type:d.ConversationActionType.UNMODERATE_CONVERSATION,unmoderateConversation:{convId:a}};h(d.ContentType.CONVERSATION,c,function(a,c){j(a,c,b)&&b(null,c.conversation.moderateResult)})},this.updateGuestAccess=function(a,b,c){c=c||C,x.debug("[ClientApiHandler]: updateGuestAccess...");var e={type:d.ConversationActionType.UPDATE_GUEST_ACCESS,updateGuestAccess:{convId:a,guestAccessDisabled:!!b}};h(d.ContentType.CONVERSATION,e,function(a,b){j(a,b,c)&&c(null,b.conversation.updateGuestAccessResult)})},this.getConversationSummary=function(a,b){b=b||C,x.debug("[ClientApiHandler]: getConversationSummary...");var c={type:d.ConversationActionType.GET_CONVERSATION_SUMMARY,getConversationSummary:{convId:a}};h(d.ContentType.CONVERSATION,c,function(a,c){j(a,c,b)&&b(null,c.conversation.getConversationSummary.conversationSummary)})},this.grantModeratorRights=function(a,b,c){c=c||C,b instanceof Array||(b=[b]),x.debug("[ClientApiHandler]: grantModeratorRights...");var e={type:d.ConversationActionType.GRANT_MODERATOR_RIGHTS,grantModeratorRights:{convId:a,userId:b}};h(d.ContentType.CONVERSATION,e,function(a,b){j(a,b,c)&&c(null,b.conversation.grantModeratorRightsResult)})},this.dropModeratorRights=function(a,b,c){c=c||C,b instanceof Array||(b=[b]),x.debug("[ClientApiHandler]: dropModeratorRights...");var e={type:d.ConversationActionType.DROP_MODERATOR_RIGHTS,dropModeratorRights:{convId:a,userId:b}};h(d.ContentType.CONVERSATION,e,function(a,b){j(a,b,c)&&c(null,b.conversation.dropModeratorRightsResult)})},this.addJournalEntry=function(a,b){b=b||C,x.debug("[ClientApiHandler]: addJournalEntry...");var c={type:d.ConversationActionType.ADD_JOURNAL_ENTRY,addJournalEntry:{convId:a.convId,starter:a.starter,source:a.source,destination:a.destination,startTime:a.startTime,duration:a.duration,type:a.type,participants:a.participants,missedReason:a.missedReason}};h(d.ContentType.CONVERSATION,c,function(a,c){j(a,c,b)&&b(null)})},this.setFavoritePosition=function(a,b,c){c=c||C,x.debug("[ClientApiHandler]: setFavoritePosition...");var e={type:d.ConversationActionType.SET_FAVORITE_POSITION,setFavoritePosition:{convId:a,position:b}};h(d.ContentType.CONVERSATION,e,function(a,b){j(a,b,c)&&c(null,b)})},this.addLabels=function(a,b){b=b||C,x.debug("[ClientApiHandler]: addLabels...");var c={type:d.ConversationActionType.ADD_LABELS,addLabels:{labels:a}};h(d.ContentType.CONVERSATION,c,function(a,c){j(a,c,b)&&b(null,c.conversation.addLabelsResult.labels)})},this.assignLabels=function(a,b,c){c=c||C,x.debug("[ClientApiHandler]: assignLabels...");var e={type:d.ConversationActionType.ASSIGN_LABELS,assignLabels:{convId:a,labelIds:b}};h(d.ContentType.CONVERSATION,e,function(a,b){j(a,b,c)&&c(null,b.conversation.assignLabelsResult.labelIds)})},this.unassignLabels=function(a,b,c){c=c||C,x.debug("[ClientApiHandler]: unassignLabels...");var e={type:d.ConversationActionType.UNASSIGN_LABELS,unassignLabels:{convId:a,labelIds:b}};h(d.ContentType.CONVERSATION,e,function(a,b){j(a,b,c,!0)&&c(null,b.conversation.unassignLabelsResult.labelIds)})},this.getAllLabels=function(a){a=a||C,x.debug("[ClientApiHandler]: getAllLabels...");var b={type:d.ConversationActionType.GET_LABELS};h(d.ContentType.CONVERSATION,b,function(b,c){j(b,c,a,!0)&&a(null,c.conversation.getLabelsResult.labels)})},this.removeLabels=function(a,b){b=b||C,x.debug("[ClientApiHandler]: removeLabels...");var c={type:d.ConversationActionType.REMOVE_LABELS,removeLabels:{labelIds:a}};h(d.ContentType.CONVERSATION,c,function(a,c){j(a,c,b,!0)&&b(null,c.conversation.removeLabelsResult.labelIds)})},this.editLabel=function(a,b){b=b||C,x.debug("[ClientApiHandler]: editLabel...");var c={type:d.ConversationActionType.EDIT_LABEL,editLabel:{label:a}};h(d.ContentType.CONVERSATION,c,function(a,c){j(a,c,b)&&b(null,c.conversation.editLabelResult.label)})},this.addFilter=function(a,b,c){c=c||C,x.debug("[ClientApiHandler]: addFilter...");var e={type:d.ConversationActionType.ADD_FILTER,addFilter:{filterName:a,root:b}};h(d.ContentType.CONVERSATION,e,function(a,b){j(a,b,c)&&c(null,b.conversation.addFilterResult)})},this.removeFilter=function(a,b){b=b||C,x.debug("[ClientApiHandler]: removeFilters...");var c={type:d.ConversationActionType.REMOVE_FILTERS,removeFilters:{filterIds:a}};h(d.ContentType.CONVERSATION,c,function(a,c){j(a,c,b,!0)&&b(null,c.conversation.removeFiltersResult.filterIds)})},this.getAllFilters=function(a){a=a||C,x.debug("[ClientApiHandler]: getAllFilters...");var b={type:d.ConversationActionType.GET_FILTERS,getFilters:{}};h(d.ContentType.CONVERSATION,b,function(b,c){j(b,c,a,!0)&&a(null,c.conversation.getFiltersResult.filters)})},this.editFilter=function(a,b){b=b||C,x.debug("[ClientApiHandler]: editFilter...");var c={type:d.ConversationActionType.EDIT_FILTER,editFilter:{filter:a}};h(d.ContentType.CONVERSATION,c,function(a,c){j(a,c,b)&&b(null,c.conversation.editFilterResult)})},this.getUserDataSince=function(a,b){b=b||C,x.debug("[ClientApiHandler]: getUserDataSince...");var c={type:d.ConversationActionType.GET_USER_DATA_SINCE,getUserDataSince:{sinceTime:a}};h(d.ContentType.CONVERSATION,c,function(a,c){if(j(a,c,b,!0)){var d=c.conversation.getUserDataSinceResult&&c.conversation.getUserDataSinceResult.changedUserData||[];b(null,d)}})},this.getConferenceInvitationText=function(a,b,c){if(c=c||C,x.debug("[ClientApiHandler]: getConferenceInvitationText..."),!this.isBridgeNumberSelectionSupported())return x.warn("[ClientApiHandler]: The getConferenceInvitationText operation is not supported by the backend"),void k(c,d.ReturnCode.OPERATION_NOT_SUPPORTED);var e={type:d.ConversationActionType.GET_CONFERENCE_INVITATION_TEXT,getConferenceInvitationText:{conversationId:b,language:a}},f=["response.conversation.getConferenceInvitationResult.invitationMessage"];h(d.ContentType.CONVERSATION,e,function(a,b){j(a,b,c)&&c(null,b.conversation.getConferenceInvitationResult.invitationMessage)},null,f)},this.getConferenceInvitationExample=function(a,b){if(b=b||C,x.debug("[ClientApiHandler]: getConferenceInvitationExample..."),!this.isBridgeNumberSelectionSupported())return x.warn("[ClientApiHandler]: The getConferenceInvitationExample operation is not supported by the backend"),void k(b,d.ReturnCode.OPERATION_NOT_SUPPORTED);var c={type:d.ConversationActionType.GET_CONFERENCE_INVITATION_EXAMPLE,getConferenceInvitationExample:{language:a}};h(d.ContentType.CONVERSATION,c,function(a,c){j(a,c,b)&&b(null,c.conversation.getConferenceInvitationResult.invitationMessage)})},this.joinRtcCall=function(a,b){b=b||C,x.debug("[ClientApiHandler]: joinRtcCall...");var c={type:d.RTCCallActionType.JOIN,join:q(a)};h(d.ContentType.RTC_CALL,c,function(a,c){j(a,c,b)&&b(null)})},this.answerRtcCall=function(a,b){b=b||C,x.debug("[ClientApiHandler]: answerRtcCall...");var c={type:d.RTCCallActionType.ANSWER,answer:q(a)};h(d.ContentType.RTC_CALL,c,function(a,c){j(a,c,b)&&b(null)})},this.sendIceCandidates=function(a,b){b=b||C,x.debug("[ClientApiHandler]: sendIceCandidates...");var c={type:d.RTCCallActionType.ICE_CANDIDATES,iceCandidates:{rtcSessionId:a.rtcSessionId,userId:a.userId,origin:a.origin,candidates:a.candidates}};h(d.ContentType.RTC_CALL,c,function(a,c){j(a,c,b)&&b(null)})},this.leaveRtcCall=function(a,b,c){b=b||{},c=c||C,x.debug("[ClientApiHandler]: leaveRtcCall...");var e={type:d.RTCCallActionType.LEAVE,leave:{rtcSessionId:a,disconnectCause:b.cause,disconnectReason:b.reason}};h(d.ContentType.RTC_CALL,e,function(a,b){j(a,b,c)&&c(null)})},this.terminateRtcCall=function(a,b,c){b=b||{},c=c||C,x.debug("[ClientApiHandler]: terminateRtcCall...");var e={type:d.RTCCallActionType.TERMINATE,terminate:{rtcSessionId:a,disconnectCause:b.cause,disconnectReason:b.reason}};h(d.ContentType.RTC_CALL,e,function(a,b){j(a,b,c)&&c(null)})},this.declineRtcCall=function(a,b){b=b||C,x.debug("[ClientApiHandler]: declineRtcCall...");var c={type:d.RTCCallActionType.INVITE_REJECT,inviteReject:{convId:a.convId,rtcSessionId:a.rtcSessionId,cause:a.cause,transactionId:a.transactionId}};h(d.ContentType.RTC_CALL,c,function(a,c){j(a,c,b)&&b(null)})},this.changeMediaType=function(a,b){b=b||C,x.debug("[ClientApiHandler]: changeMediaType...");var c={type:d.RTCCallActionType.CHANGE_MEDIA_TYPE,changeMediaType:{rtcSessionId:a.rtcSessionId,sdp:a.sdp,mediaTypes:l(a.mediaType),transactionId:a.transactionId,screenSharePointerSupported:a.screenSharePointerSupported}};h(d.ContentType.RTC_CALL,c,function(a,c){j(a,c,b)&&b(null)})},this.changeMediaAccept=function(a,b){b=b||C,x.debug("[ClientApiHandler]: changeMediaAccept...");var c={type:d.RTCCallActionType.CHANGE_MEDIA_ACCEPT,changeMediaAccept:{rtcSessionId:a.rtcSessionId,sdp:a.sdp,transactionId:a.transactionId}};h(d.ContentType.RTC_CALL,c,function(a,c){j(a,c,b)&&b(null)})},this.changeMediaReject=function(a,b){b=b||C,x.debug("[ClientApiHandler]: changeMediaReject...");var c={type:d.RTCCallActionType.CHANGE_MEDIA_REJECT,changeMediaReject:{rtcSessionId:a.rtcSessionId,transactionId:a.transactionId}};h(d.ContentType.RTC_CALL,c,function(a,c){j(a,c,b)&&b(null)})},this.prepareSession=function(a,b){b=b||C,x.debug("[ClientApiHandler]: prepareSession... ");var c={type:d.RTCCallActionType.PREPARE,prepare:{convId:a.convId,rtcSessionId:a.rtcSessionId,ownerId:a.ownerId,mediaNode:a.mediaNode,isTelephonyConversation:a.isTelephonyConversation,replaces:a.replaces}},e=["response.rtcCall.prepare.servers.[].password"];h(d.ContentType.RTC_CALL,c,function(a,c){j(a,c,b)&&b(null,c.rtcCall.prepare.servers,c.rtcCall.prepare.newRtcSessionId)},null,e)},this.renewTurnCredentials=function(a,b){b=b||C,x.debug("[ClientApiHandler]: renewTurnCredentials... ");var c={type:d.RTCCallActionType.RENEW_TURN_CREDENTIALS,renewTurnCredentials:{rtcSessionId:a}},e=["response.rtcCall.renewTurnCredentials.servers.[].password"];h(d.ContentType.RTC_CALL,c,function(a,c){j(a,c,b)&&b(null,c.rtcCall.renewTurnCredentials.servers)},null,e)},this.sendProgress=function(a,b,c,e){e=e||C,x.debug("[ClientApiHandler]: sendProgress... ");var f={type:d.RTCCallActionType.SEND_PROGRESS,sendProgress:{rtcSessionId:a,userId:c,invitingUser:b||"",type:d.RTCProgressType.ALERTING}};h(d.ContentType.RTC_CALL,f,function(a,b){j(a,b,e)&&e(null)})},this.submitCallQualityRating=function(a,b){if(b=b||C,x.debug("[ClientApiHandler]: submitCallQualityRating..."),F<=B)return x.warn("[ClientApiHandler]: The submitCallQualityRating operation is not supported by the backend"),void k(b,d.ThirdPartyError.OPERATION_NOT_SUPPORTED);var c={type:d.RTCCallActionType.SUBMIT_RTC_QUALITY_RATING,submitRtcQualityRating:{rating:a}};h(d.ContentType.RTC_CALL,c,function(a,c){j(a,c,b)&&b(null)})},this.lockRtcSession=function(a,b,c){c=c||C,x.debug("[ClientApiHandler]: lockRtcSession...");var e={type:d.RTCSessionActionType.LOCK,lock:{rtcSessionId:a,locked:!!b}};h(d.ContentType.RTC_SESSION,e,function(a,b){j(a,b,c)&&c(null)})},this.muteRtcSession=function(a,b){b=b||C,x.debug("[ClientApiHandler]: muteRtcSession...");var c={type:d.RTCSessionActionType.MUTE_SESSION,muteSession:{rtcSessionId:a.rtcSessionId,muted:!!a.muted,excludedUserIds:a.excludedUserIds||void 0}};h(d.ContentType.RTC_SESSION,c,function(a,c){j(a,c,b)&&b(null)})},this.muteParticipant=function(a,b){b=b||C,x.debug("[ClientApiHandler]: muteParticipant...");var c={type:d.RTCSessionActionType.MUTE,mute:{rtcSessionId:a.rtcSessionId,muted:!!a.muted,userIds:a.usersIds||void 0}};h(d.ContentType.RTC_SESSION,c,function(a,c){j(a,c,b)&&b(null)})},this.addParticipantToRtcSession=function(a,b){b=b||C,x.debug("[ClientApiHandler]: addParticipantToRtcCall...");var c={type:d.RTCSessionActionType.ADD_PARTICIPANT,addParticipant:{rtcSessionId:a.rtcSessionId,userId:a.userId,from:a.from,to:a.to,mediaType:l(a.mediaType)}};h(d.ContentType.RTC_SESSION,c,function(a,c){j(a,c,b)&&b(null)})},this.removeSessionParticipant=function(a,b){b=b||C,x.debug("[ClientApiHandler]: removeSessionParticipant...");var c={type:d.RTCSessionActionType.REMOVE_PARTICIPANT,removeParticipant:{rtcSessionId:a.rtcSessionId,userId:a.userId}};h(d.ContentType.RTC_SESSION,c,function(a,c){j(a,c,b)&&b(null)})},this.getActiveSessions=function(a){a=a||C,x.debug("[ClientApiHandler]: getActiveSessions...");var b={type:d.RTCSessionActionType.GET_ACTIVE_SESSIONS};h(d.ContentType.RTC_SESSION,b,function(b,c){j(b,c,a,!0)&&a(null,c.rtcSession.activeSessions.session)})},this.getSession=function(a,b){b=b||C,x.debug("[ClientApiHandler]: getSession...");var c={type:d.RTCSessionActionType.GET_SESSION,getSession:{rtcSessionId:a}};h(d.ContentType.RTC_SESSION,c,function(a,c){j(a,c,b)&&b(null,c.rtcSession.getSession.session)})},this.moveRtcSession=function(a,b){b=b||C,x.debug("[ClientApiHandler]: moveRtcSession...");var c={type:d.RTCSessionActionType.MOVE,move:{oldRtcSessionId:a.sessionId,oldConversationId:a.conversationId,newConversationId:a.newConversationId,newRtcSessionId:a.newSessionId}};h(d.ContentType.RTC_SESSION,c,function(a,c){j(a,c,b)&&b(null)})},this.startRecording=function(a,b){b=b||C,x.debug("[ClientApiHandler]: startRecording...");var c={type:d.RTCSessionActionType.START_RECORDING,startRecording:{convId:a.convId,rtcSessionId:a.rtcSessionId,mediaTypes:l(a.mediaTypes)}};h(d.ContentType.RTC_SESSION,c,function(a,c){j(a,c,b)&&b(null)})},this.stopRecording=function(a,b){b=b||C,x.debug("[ClientApiHandler]: stopRecording...");var c={type:d.RTCSessionActionType.STOP_RECORDING,stopRecording:{convId:a.convId,rtcSessionId:a.rtcSessionId}};h(d.ContentType.RTC_SESSION,c,function(a,c){j(a,c,b)&&b(null)})},this.raiseQuestion=function(a,b){b=b||C,x.debug("[ClientApiHandler]: raiseQuestion...");var c={type:d.RTCSessionActionType.RAISE_QUESTION,raiseQuestion:a},e=["request.rtcSession.raiseQuestion.question"];h(d.ContentType.RTC_SESSION,c,function(a,c){j(a,c,b)&&b(null,c.rtcSession.raiseQuestion.questionNumber)},e)},this.inviteToStage=function(a,b){b=b||C,x.debug("[ClientApiHandler]: inviteToStage..."),a.allowedMediaTypes=l();var c={type:d.RTCSessionActionType.INVITE_TO_STAGE,inviteToStage:a};h(d.ContentType.RTC_SESSION,c,function(a,c){j(a,c,b)&&b(null)})},this.inviteToStageAnswer=function(a,b){b=b||C,x.debug("[ClientApiHandler]: inviteToStageAnswer...");var c={type:d.RTCSessionActionType.INVITE_TO_STAGE_ANSWER,inviteToStageAnswer:a};h(d.ContentType.RTC_SESSION,c,function(a,c){j(a,c,b)&&b(null)})},this.inviteToStageCancel=function(a,b){b=b||C,x.debug("[ClientApiHandler]: inviteToStageCancel...");var c={type:d.RTCSessionActionType.INVITE_TO_STAGE_CANCEL,inviteToStageCancel:a};h(d.ContentType.RTC_SESSION,c,function(a,c){j(a,c,b)&&b(null)})},this.removeFromStage=function(a,b){b=b||C,x.debug("[ClientApiHandler]: removeFromStage...");var c={type:d.RTCSessionActionType.REMOVE_FROM_STAGE,removeFromStage:a};h(d.ContentType.RTC_SESSION,c,function(a,c){j(a,c,b)&&b(null)})},this.getQuestions=function(a,b){b=b||C,x.debug("[ClientApiHandler]: getQuestions...");var c={type:d.RTCSessionActionType.GET_QUESTIONS,getQuestions:a};h(d.ContentType.RTC_SESSION,c,function(a,c){j(a,c,b)&&b(null,c.rtcSession.getQuestions.questions)})},this.updateQuestionState=function(a,b){b=b||C,x.debug("[ClientApiHandler]: updateQuestionState...");var c={type:d.RTCSessionActionType.UPDATE_QUESTION_STATE,updateQuestionState:a};h(d.ContentType.RTC_SESSION,c,function(a,c){j(a,c,b)&&b(null)})},this.openCurtain=function(a,b){b=b||C,x.debug("[ClientApiHandler]: openCurtain...");var c={type:d.RTCSessionActionType.OPEN_CURTAIN,openCurtain:a};h(d.ContentType.RTC_SESSION,c,function(a,c){j(a,c,b)&&b(null)})},this.closeCurtain=function(a,b){b=b||C,x.debug("[ClientApiHandler]: closeCurtain...");var c={type:d.RTCSessionActionType.CLOSE_CURTAIN,closeCurtain:a};h(d.ContentType.RTC_SESSION,c,function(a,c){j(a,c,b)&&b(null)})},this.getNodeState=function(a,b){b=b||C,x.debug("[ClientApiHandler]: getNodeState...");var c={type:d.RTCSessionActionType.GET_NODE_STATE,getNodeState:a};h(d.ContentType.RTC_SESSION,c,function(a,c){j(a,c,b,!0)&&b(null,c.rtcSession.getNodeState.nodeData)})},this.enableWhiteboard=function(a,b){b=b||C,x.debug("[ClientApiHandler]: enableWhiteboard...");var c={type:d.RTCSessionActionType.ENABLE_WHITEBOARD,enableWhiteboard:{rtcSessionId:a.rtcSessionId,viewbox:a.viewbox}};h(d.ContentType.RTC_SESSION,c,function(a,c){j(a,c,b,!0)&&b(null)})},this.disableWhiteboard=function(a,b){b=b||C,x.debug("[ClientApiHandler]: disableWhiteboard...");var c={type:d.RTCSessionActionType.DISABLE_WHITEBOARD,disableWhiteboard:a};h(d.ContentType.RTC_SESSION,c,function(a,c){j(a,c,b,!0)&&b(null)})},this.addWhiteboardElement=function(a,b){b=b||C,x.debug("[ClientApiHandler]: addWhiteboardElement...");var c={type:d.RTCSessionActionType.ADD_WHITEBOARD_ELEMENT,addWhiteboardElement:a};h(d.ContentType.RTC_SESSION,c,function(a,c){j(a,c,b,!0)&&b(null)})},this.removeWhiteboardElement=function(a,b){b=b||C,x.debug("[ClientApiHandler]: removeWhiteboardElement...");var c={type:d.RTCSessionActionType.REMOVE_WHITEBOARD_ELEMENT,removeWhiteboardElement:a};h(d.ContentType.RTC_SESSION,c,function(a,c){j(a,c,b,!0)&&b(null)})},this.updateWhiteboardElement=function(a,b){b=b||C,x.debug("[ClientApiHandler]: updateWhiteboardElement...");var c={type:d.RTCSessionActionType.UPDATE_WHITEBOARD_ELEMENT,updateWhiteboardElement:a};h(d.ContentType.RTC_SESSION,c,function(a,c){j(a,c,b,!0)&&b(null)})},this.clearWhiteboard=function(a,b){b=b||C,x.debug("[ClientApiHandler]: clearWhiteboard...");var c={type:d.RTCSessionActionType.CLEAR_WHITEBOARD,clearWhiteboard:a};h(d.ContentType.RTC_SESSION,c,function(a,c){j(a,c,b,!0)&&b(null)})},this.getWhiteboard=function(a,b){b=b||C,x.debug("[ClientApiHandler]: getWhiteboard...");var c={type:d.RTCSessionActionType.GET_WHITEBOARD,getWhiteboard:a};h(d.ContentType.RTC_SESSION,c,function(a,c){if(j(a,c,b)){var d=c.rtcSession.getWhiteboard.whiteboard;b(null,d)}})},this.submitClientData=function(a,b){b=b||C,x.debug("[ClientApiHandler]: submitClientData...");var c={type:d.InstrumentationActionType.SUBMIT_CLIENT_DATA,submitClientData:{instrumentationData:a}};h(d.ContentType.INSTRUMENTATION,c,function(a,c){if(j(a,c,b)){var e=c.instrumentation&&c.instrumentation.submitClientData&&c.instrumentation.submitClientData.submitDataResult;b(null,e||d.SubmitDataResult.OK)}})},this.submitQOSData=function(a,b){b=b||C,x.debug("[ClientApiHandler]: submitQOSData...");var c={type:d.InstrumentationActionType.SUBMIT_QOS_DATA,submitQOSData:{clientTime:Date.now(),dataSets:a}};h(d.ContentType.INSTRUMENTATION,c,function(a,c){j(a,c,b)&&b(null)})},this.getNotifications=function(a,b,c){c=c||C,x.debug("[ClientApiHandler]: getNotifications...");var e={type:d.ActivityStreamActionType.GET_ACTIVITIES_BY_USER,getActivitiesByUser:{timestamp:a,numberOfItems:b}};h(d.ContentType.ACTIVITYSTREAM,e,function(a,b){if(j(a,b,c,!0)){var d=b.activityStream.getActivitiesByUserResult;c(null,d)}})},this.toggleReadUnread=function(a,b,c){c=c||C,x.debug("[ClientApiHandler]: toggleReadUnread...");var e={type:d.ActivityStreamActionType.UPDATE_ACTIVITY_READ,updateActivityReadState:{activityId:a,read:b}};h(d.ContentType.ACTIVITYSTREAM,e,function(a,b){if(j(a,b,c)){var d=b.activityStream.updateResult;c(null,d.updatedItem)}})},this.markAllNotificationsAsRead=function(a){a=a||C,x.debug("[ClientApiHandler]: markAllNotificationsAsRead...");var b={type:d.ActivityStreamActionType.MARK_ALL_READ};h(d.ContentType.ACTIVITYSTREAM,b,function(b,c){if(j(b,c,a)){var d=c.activityStream.markAllReadResult;a(null,d)}})},this.getTenant=function(a){a=a||C,x.debug("[ClientApiHandler]: getTenant...");var b={type:d.AdministrationActionType.GET_TENANT};h(d.ContentType.ADMINISTRATION,b,function(b,c){j(b,c,a)&&a(null,c.administration.getTenant.tenant)})},this.addUser=function(a,b){b=b||C,x.debug("[ClientApiHandler]: addUser...");var c={type:d.AdministrationActionType.ADD_USER,addUser:{userAttributes:{emailAddress:a.emailAddress,lastName:a.lastName,firstName:a.firstName,locale:a.locale},password:a.password,packageId:a.packageId,accountTemplateId:a.accountTemplateId}},e=["request.administration.addUser.password"];h(d.ContentType.ADMINISTRATION,c,function(a,c){j(a,c,b)&&b(null,c.administration.addUserResult.user)},e)},this.addMeetingPointV2=function(a,b){b=b||C,x.debug("[ClientApiHandler]: addMeetingPointV2...");var c={type:d.AdministrationActionType.ADD_MEETING_POINT_V2,addMeetingPoint:{userAttributes:{emailAddress:a.emailAddress,lastName:a.lastName,firstName:a.firstName,locale:a.locale,
location:a.location,registrationCodeTtl:a.timeout},packageId:a.packageId}},e=["response.administration.addMeetingPointV2Result.registrationCode"];h(d.ContentType.ADMINISTRATION,c,function(a,c){j(a,c,b)&&b(null,c.administration.addMeetingPointV2Result)},null,e)},this.updateMeetingPointV2=function(a,b){b=b||C,x.debug("[ClientApiHandler]: updateMeetingPointV2...");var c={type:d.AdministrationActionType.UPDATE_MEETING_POINT_V2,updateMeetingPoint:{userId:a.id,registrationCodeTtl:a.timeout}},e=["response.administration.updateMeetingPointV2Result.registrationCode"];h(d.ContentType.ADMINISTRATION,c,function(a,c){j(a,c,b)&&b(null,c.administration.updateMeetingPointV2Result.registrationCode)},null,e)},this.regenerateApiKey=function(a,b){b=b||C,x.debug("[ClientApiHandler]: regenerateApiKey...");var c={type:d.AdministrationActionType.REGENERATE_API_KEY,regenerateApiKey:{userId:a}},e=["response.administration.regenerateApiKey.apiKey"];h(d.ContentType.ADMINISTRATION,c,function(a,c){j(a,c,b)&&b(null,c.administration.regenerateApiKey.apiKey)},null,e)},this.deleteUser=function(a,b){b=b||C,x.debug("[ClientApiHandler]: deleteUser...");var c={type:d.AdministrationActionType.DELETE_USER,deleteUser:{userId:a}};h(d.ContentType.ADMINISTRATION,c,function(a,c){j(a,c,b)&&b(null)})},this.inviteUser=function(a,b){b=b||C,x.debug("[ClientApiHandler]: inviteUser...");var c={type:d.AdministrationActionType.INVITE_USER,inviteUser:{userAttributes:{emailAddress:a.userAttributes.emailAddress,lastName:a.userAttributes.lastName,firstName:a.userAttributes.firstName},packageId:a.packageId,accountTemplateId:a.accountTemplateId}};h(d.ContentType.ADMINISTRATION,c,function(a,c){j(a,c,b)&&b(null,c.administration.inviteUser.resultType)})},this.inviteMultipleUsers=function(a,b){b=b||C,x.debug("[ClientApiHandler]: inviteMultipleUsers...");var c={type:d.AdministrationActionType.INVITE_MULTIPLE_USERS,inviteMultipleUsers:a};h(d.ContentType.ADMINISTRATION,c,function(a,c){j(a,c,b)&&b(null)})},this.invitePartnerUsers=function(a,b){b=b||C,x.debug("[ClientApiHandler]: invitePartnerUsers...");var c={type:d.AdministrationActionType.INVITE_MULTIPLE_PARTNER_USERS,inviteMultiplePartnerUsers:{userAttributes:a}};h(d.ContentType.ADMINISTRATION,c,function(a,c){j(a,c,b)&&b(null)})},this.resendInvite=function(a,b){b=b||C,x.debug("[ClientApiHandler]: resendInvite...");var c={type:d.AdministrationActionType.RESEND_USER_INVITATION,resendUserInvitation:{userId:a}};h(d.ContentType.ADMINISTRATION,c,function(a,c){j(a,c,b)&&b(null,c.administration.resendUserInvitation.resultType)})},this.checkInvalidTenant=function(a,b){b=b||C,x.debug("[ClientApiHandler]: checkInvalidTenant...");var c={type:d.AdministrationActionType.CHECK_INVALID_TENANTS,checkInvalidTenants:{tenantIds:a}};h(d.ContentType.ADMINISTRATION,c,function(a,c){j(a,c,b)&&b(null,c.administration.checkInvalidTenants.tenantIds)})},this.setTelephonyTrunkData=function(a,b){b=b||C,x.debug("[ClientApiHandler]: setTelephonyTrunkData...");var c={type:d.AdministrationActionType.SET_TELEPHONY_TRUNK_DATA,setTelephonyTrunkData:{defaultCallerId:a}};h(d.ContentType.ADMINISTRATION,c,function(a,c){j(a,c,b)&&b()})},this.getTelephonyTrunkStatus=function(a){a=a||C,x.debug("[ClientApiHandler]: getTelephonyTrunkStatus...");var b={type:d.AdministrationActionType.GET_TELEPHONY_TRUNK_STATUS};h(d.ContentType.ADMINISTRATION,b,function(b,c){j(b,c,a)&&a(null,c.administration.getTelephonyTrunkStatus)})},this.getTelephonyTrunkGroups=function(a,b){if(b=b||C,x.debug("[ClientApiHandler]: getTelephonyTrunkGroups..."),!a)return x.warn("[ClientApiHandler]: No query data provided"),void k(b,d.ReturnCode.INVALID_MESSAGE);var c={type:d.AdministrationActionType.GET_TELEPHONY_TRUNK_GROUPS,getTelephonyTrunkGroups:{pageSize:a.pageSize,pagePointer:a.pagePointer||void 0}};h(d.ContentType.ADMINISTRATION,c,function(a,c){j(a,c,b)&&b(null,c.administration.getTelephonyTrunkGroupsResult)})},this.getTelephonyTrunkGroup=function(a,b){if(b=b||C,x.debug("[ClientApiHandler]: getTelephonyTrunkGroup..."),!a)return x.warn("[ClientApiHandler]: No trunk group id provided"),void k(b,d.ReturnCode.INVALID_MESSAGE);var c={type:d.AdministrationActionType.GET_TELEPHONY_TRUNK_GROUP,getTelephonyTrunkGroup:{telephonyTrunkGroupId:a}};h(d.ContentType.ADMINISTRATION,c,function(a,c){j(a,c,b)&&b(null,c.administration.getTelephonyTrunkGroupResult)})},this.addTelephonyTrunkGroup=function(a,b){if(b=b||C,x.debug("[ClientApiHandler]: addTelephonyTrunkGroup..."),!a)return x.warn("[ClientApiHandler]: No trunk group data provided"),void k(b,d.ReturnCode.INVALID_MESSAGE);var c={type:d.AdministrationActionType.ADD_TELEPHONY_TRUNK_GROUP,addTelephonyTrunkGroup:{telephonyTrunkGroupName:a.telephonyTrunkGroupName,telephonyTrunkId:a.telephonyTrunkIds}};h(d.ContentType.ADMINISTRATION,c,function(a,c){j(a,c,b)&&b(null,c.administration.addTelephonyTrunkGroupResult)})},this.removeTelephonyTrunkGroup=function(a,b){if(b=b||C,x.debug("[ClientApiHandler]: removeTelephonyTrunkGroup..."),!a)return x.warn("[ClientApiHandler]: No trunk group id provided"),void k(b,d.ReturnCode.INVALID_MESSAGE);var c={type:d.AdministrationActionType.REMOVE_TELEPHONY_TRUNK_GROUP,removeTelephonyTrunkGroup:{telephonyTrunkGroupId:a}};h(d.ContentType.ADMINISTRATION,c,function(a,c){j(a,c,b)&&b(null,c.administration.removeTelephonyTrunkGroupResult.responseCode)})},this.updateTelephonyTrunkGroup=function(a,b){if(b=b||C,x.debug("[ClientApiHandler]: updateTelephonyTrunkGroup..."),!a)return x.warn("[ClientApiHandler]: No trunk group data provided"),void k(b,d.ReturnCode.INVALID_MESSAGE);var c={type:d.AdministrationActionType.UPDATE_TELEPHONY_TRUNK_GROUP,updateTelephonyTrunkGroup:{telephonyTrunkGroupId:a.telephonyTrunkGroupId,telephonyTrunkGroupName:a.telephonyTrunkGroupName,telephonyTrunkId:a.telephonyTrunkIds}};h(d.ContentType.ADMINISTRATION,c,function(a,c){j(a,c,b)&&b(null,c.administration.updateTelephonyTrunkGroupResult)})},this.getTenantBridgeNumbers=function(a){a=a||C,x.debug("[ClientApiHandler]: getTenantBridgeNumbers...");var b={type:d.AdministrationActionType.GET_TENANT_BRIDGE_NUMBERS};h(d.ContentType.ADMINISTRATION,b,function(b,c){if(j(b,c,a)){var d=c.administration.getTenantBridgeNumbers;a(null,d&&d.bridgeNumbers||[])}})},this.setTenantBridgeNumbers=function(a,b){b=b||C,x.debug("[ClientApiHandler]: setTenantBridgeNumbers...");var c={type:d.AdministrationActionType.SET_TENANT_BRIDGE_NUMBERS,setTenantBridgeNumbers:{bridgeNumbers:a}};h(d.ContentType.ADMINISTRATION,c,function(a,c){j(a,c,b)&&b()})},this.exportUserList=function(a,b){b=b||C,x.debug("[ClientApiHandler]: exportUserList..."),a&&!Array.isArray(a)&&(a=[a]);var c={type:d.AdministrationActionType.EXPORT_TENANT,exportTenant:{exportFormats:a}};h(d.ContentType.ADMINISTRATION,c,function(a,c){j(a,c,b)&&b(null)})},this.addAutoConfigurableTrunk=function(a){a=a||C,x.debug("[ClientApiHandler]: addAutoConfigurableTrunk...");var b={type:d.AdministrationActionType.ADD_TRUNK_WITHOUT_PARAMETERS};h(d.ContentType.ADMINISTRATION,b,function(b,c){j(b,c,a)&&a(null,c.administration.addTrunk.configuration)})},this.getTenantTelephonyConfiguration=function(a){a=a||C,x.debug("[ClientApiHandler]: getTenantTelephonyConfiguration...");var b={type:d.AdministrationActionType.GET_TENANT_TELEPHONY_CONFIGURATION};h(d.ContentType.ADMINISTRATION,b,function(b,c){j(b,c,a)&&a(null,c.administration.getTenantTelephonyConfiguration.configuration)})},this.getTelephonyRoutingRules=function(a,b){b=b||C,x.debug("[ClientApiHandler]: getTelephonyRoutingRules...");var c={type:d.AdministrationActionType.GET_TELEPHONY_ROUTING_RULES,getTelephonyRoutingRules:{pageSize:a.pageSize,pagePointer:a.pagePointer}};h(d.ContentType.ADMINISTRATION,c,function(a,c){j(a,c,b)&&b(null,c.administration.getTelephonyRoutingRulesResult)})},this.addTelephonyRoutingRule=function(a,b){b=b||C,x.debug("[ClientApiHandler]: addTelephonyRoutingRule...");var c={type:d.AdministrationActionType.ADD_TELEPHONY_ROUTING_RULE,addTelephonyRoutingRule:{telephonyRoutingRule:{routePosition:a.routePosition,condition1:a.condition1,gtcUserId:a.gtcUserId,gtcUserGroupId:a.gtcUserGroupId,operator:a.operator||void 0,condition2:a.condition2||void 0,application:a.application||void 0}}};h(d.ContentType.ADMINISTRATION,c,function(a,c){j(a,c,b)&&b(null)})};this.updateTelephonyRoutingRule=function(a,b){b=b||C,x.debug("[ClientApiHandler]: updateTelephonyRoutingRule...");var c={type:d.AdministrationActionType.UPDATE_TELEPHONY_ROUTING_RULE,updateTelephonyRoutingRule:{telephonyRoutingRule:{routePosition:a.routePosition,condition1:a.condition1,gtcUserId:a.gtcUserId,gtcUserGroupId:a.gtcUserGroupId,routeId:a.routeId||void 0,operator:a.operator||void 0,condition2:a.condition2||void 0,application:a.application||void 0}}};h(d.ContentType.ADMINISTRATION,c,function(a,c){j(a,c,b)&&b(null)})};this.removeTelephonyRoutingRule=function(a,b){b=b||C,x.debug("[ClientApiHandler]: removeTelephonyRoutingRule...");var c={type:d.AdministrationActionType.REMOVE_TELEPHONY_ROUTING_RULE,removeTelephonyRoutingRule:{telephonyRoutingRuleId:a}};h(d.ContentType.ADMINISTRATION,c,function(a,c){j(a,c,b)&&b(null)})},this.testTelephonyRoutingRules=function(a,b){b=b||C,x.debug("[ClientApiHandler]: testTelephonyRoutingRule...");var c={type:d.AdministrationActionType.TEST_TELEPHONY_ROUTING_RULES,testTelephonyRoutingRules:{destination:a.destination,origin:a.origin||void 0,application:a.application||void 0,considerTelephonyConnectorsStates:!!a.considerTelephonyConnectorsStates}};h(d.ContentType.ADMINISTRATION,c,function(a,c){j(a,c,b)&&b(null,c.administration.testTelephonyRoutingRulesResult)})},this.updateTenantTelephonyConfiguration=function(a,b){b=b||C,x.debug("[ClientApiHandler]: updateTenantTelephonyConfiguration...");var c={type:d.AdministrationActionType.UPDATE_TENANT_TELEPHONY_CONFIGURATION,updateTenantTelephonyConfiguration:{defaultRouting:a}};h(d.ContentType.ADMINISTRATION,c,function(a,c){j(a,c,b)&&b(null)})},this.setTrunkPassword=function(a,b,c){c=c||C,x.debug("[ClientApiHandler]: setTrunkPassword...");var e={type:d.AdministrationActionType.SET_TRUNK_PASSWORD,setTrunkPassword:{trunkId:a,password:b}},f=["request.administration.setTrunkPassword.password"];h(d.ContentType.ADMINISTRATION,e,function(a,b){j(a,b,c)&&c(null)},f)},this.setTenantSettings=function(a,b){b=b||C,x.debug("[ClientApiHandler]: setTenantSettings...");var c={type:d.AdministrationActionType.SET_TENANT_SETTINGS,setTenantSettings:{tenantSettings:a}};h(d.ContentType.ADMINISTRATION,c,function(a,c){j(a,c,b)&&b(null)})},this.updateTenantName=function(a,b){b=b||C,x.debug("[ClientApiHandler]: updateTenantName...");var c={type:d.AdministrationActionType.UPDATE_TENANT,updateTenant:{companyName:a}};h(d.ContentType.ADMINISTRATION,c,function(a,c){j(a,c,b)&&b(null)})},this.getTenantLoginProviders=function(a,b){b=b||C,x.debug("[ClientApiHandler]: getTenantLoginProviders...");var c={type:d.AdministrationActionType.GET_ALL_TENANT_LOGIN_PROVIDERS,getAllTenantLoginProviders:{tenantId:a}};h(d.ContentType.ADMINISTRATION,c,function(a,c){j(a,c,b,!0)&&b(null,c.administration.getAllTenantLoginProvidersResult.tenantLoginProvidersList||[])})},this.addTenantLoginProvider=function(a,b){b=b||C,x.debug("[ClientApiHandler]: addTenantLoginProvider...");var c={type:d.AdministrationActionType.SAVE_TENANT_LOGIN_PROVIDER,saveTenantLoginProvider:{loginProvider:a}};h(d.ContentType.ADMINISTRATION,c,function(a,c){j(a,c,b)&&b(null,c.administration.saveTenantLoginProviderResult.storedProvider)})},this.updateTenantLoginProvider=function(a,b){b=b||C,x.debug("[ClientApiHandler]: updateTenantLoginProvider...");var c={type:d.AdministrationActionType.UPDATE_TENANT_LOGIN_PROVIDER,updateTenantLoginProvider:{loginProvider:a}};h(d.ContentType.ADMINISTRATION,c,function(a,c){j(a,c,b)&&b(null,c.administration.updateTenantLoginProviderResult.updatedLoginProvider)})},this.deleteTenantLoginProvider=function(a,b){b=b||C,x.debug("[ClientApiHandler]: deleteTenantLoginProvider...");var c={type:d.AdministrationActionType.DELETE_TENANT_LOGIN_PROVIDER,deleteTenantLoginProvider:{providerId:a.providerId,tenantId:a.tenantId}};h(d.ContentType.ADMINISTRATION,c,function(a,c){j(a,c,b)&&b(null,c.administration.deleteTenantLoginProviderResult)})},this.getOpenScapeUser=function(a,b){if(b=b||C,x.debug("[ClientApiHandler]: getOpenScapeUser..."),!a)return x.warn("[ClientApiHandler]: No dn was provided"),void k(b,d.ReturnCode.INVALID_MESSAGE);var c={type:d.AdministrationActionType.GET_OPENSCAPE_USER,getOpenScapeUser:{directoryNumber:a}};h(d.ContentType.ADMINISTRATION,c,function(a,c){j(a,c,b)&&b(null,c.administration.getOpenScapeUserResult)})},this.getVacantHomeDirectoryNumbers=function(a){a=a||C,x.debug("[ClientApiHandler]: getVacantHomeDirectoryNumbers...");var b={type:d.AdministrationActionType.GET_VACANT_HOME_DIRECTORY_NUMBERS,getVacantHomeDirectoryNumbers:{}};h(d.ContentType.ADMINISTRATION,b,function(b,c){j(b,c,a)&&a(null,c.administration.getVacantHomeDirectoryNumbersResult.directoryNumbers)})},this.createOpenScapeUser=function(a,b){if(b=b||C,x.debug("[ClientApiHandler]: createOpenScapeUser..."),!a)return x.warn("[ClientApiHandler]: No user data were provided"),void k(b,d.ReturnCode.INVALID_MESSAGE);var c={type:d.AdministrationActionType.CREATE_OPENSCAPE_USER,createOpenScapeUser:{circuitUserId:a.circuitUserId,directoryNumber:a.directoryNumber,extension:a.extension,dialingPermission:a.dialingPermission,announcementsLanguage:a.announcementsLanguage,deviceDisplayLanguage:a.deviceDisplayLanguage,timeZone:a.timeZone}};h(d.ContentType.ADMINISTRATION,c,function(a,c){j(a,c,b)&&b(null,c.administration.createOpenScapeUserResult)})},this.updateOpenScapeUser=function(a,b){if(b=b||C,x.debug("[ClientApiHandler]: updateOpenScapeUser..."),!a)return x.warn("[ClientApiHandler]: No user data were provided"),void k(b,d.ReturnCode.INVALID_MESSAGE);var c={type:d.AdministrationActionType.UPDATE_OPENSCAPE_USER,updateOpenScapeUser:{directoryNumber:a.directoryNumber,extension:a.extension,dialingPermission:a.dialingPermission,announcementsLanguage:a.announcementsLanguage,deviceDisplayLanguage:a.deviceDisplayLanguage,timeZone:a.timeZone}};h(d.ContentType.ADMINISTRATION,c,function(a,c){j(a,c,b)&&b(null,c.administration.updateOpenScapeUserResult)})},this.deleteOpenScapeUser=function(a,b){if(b=b||C,x.debug("[ClientApiHandler]: deleteOpenScapeUser..."),!a||!a.userId||!a.dn)return x.warn("[ClientApiHandler]: User id or dn was not provided"),void k(b,d.ReturnCode.INVALID_MESSAGE);var c={type:d.AdministrationActionType.DELETE_OPENSCAPE_USER,deleteOpenScapeUser:{userId:a.userId,directoryNumber:a.dn}};h(d.ContentType.ADMINISTRATION,c,function(a,c){j(a,c,b)&&b(null,c.administration.deleteOpenScapeUserResult)})},this.createOpenScapeSite=function(a,b){if(b=b||C,x.debug("[ClientApiHandler]: createOpenScapeSite..."),!a)return x.warn("[ClientApiHandler]: No site data were provided"),void k(b,d.ReturnCode.INVALID_MESSAGE);var c={type:d.AdministrationActionType.CREATE_OPENSCAPE_SITE,createOpenScapeSite:{site:a}};h(d.ContentType.ADMINISTRATION,c,function(a,c){j(a,c,b)&&b(null,c.administration.createOpenScapeSiteResult.site)})},this.getOpenScapeSite=function(a,b){if(b=b||C,x.debug("[ClientApiHandler]: getOpenScapeSite..."),!a)return x.warn("[ClientApiHandler]: No siteId was provided"),void k(b,d.ReturnCode.INVALID_MESSAGE);var c={type:d.AdministrationActionType.GET_OPENSCAPE_SITE,getOpenScapeSite:{siteId:a}};h(d.ContentType.ADMINISTRATION,c,function(a,c){j(a,c,b)&&b(null,c.administration.getOpenScapeSiteResult.site)})},this.updateOpenScapeSite=function(a,b){if(b=b||C,x.debug("[ClientApiHandler]: updateOpenScapeSite..."),F<=B)return x.warn("[ClientApiHandler]: The updateOpenScapeSite operation is not supported by the backend"),void k(b,d.ThirdPartyError.OPERATION_NOT_SUPPORTED);if(!a)return x.warn("[ClientApiHandler]: No site data were provided"),void k(b,d.ReturnCode.INVALID_MESSAGE);var c={type:d.AdministrationActionType.UPDATE_OPENSCAPE_SITE,updateOpenScapeSite:{site:a}};h(d.ContentType.ADMINISTRATION,c,function(a,c){j(a,c,b)&&b(null,c.administration.updateOpenScapeSiteResult.site)})},this.deleteOpenScapeSites=function(a,b){b=b||C,x.debug("[ClientApiHandler]: deleteOpenScapeSites...");var c={type:d.AdministrationActionType.DELETE_OPENSCAPE_SITES,deleteOpenScapeSites:{sites:a}};h(d.ContentType.ADMINISTRATION,c,function(a,c){j(a,c,b)&&b(null)})},this.deleteOpenScapePublicRange=function(a,b,c){c=c||C,x.debug("[ClientApiHandler]: deleteOpenScapePublicRange...");var e={type:d.AdministrationActionType.DELETE_PUBLIC_NUMBER_RANGE,deletePublicNumberRange:{siteId:a,rangeId:b}};h(d.ContentType.ADMINISTRATION,e,function(a,b){j(a,b,c)&&c(null)})},this.deleteOpenScapePrivateRange=function(a,b,c){c=c||C,x.debug("[ClientApiHandler]: deleteOpenScapePrivateRange...");var e={type:d.AdministrationActionType.DELETE_PRIVATE_NUMBER_RANGE,deletePrivateNumberRange:{siteId:a,rangeId:b}};h(d.ContentType.ADMINISTRATION,e,function(a,b){j(a,b,c)&&c(null)})},this.getOpenScapeTenant=function(a){a=a||C,x.debug("[ClientApiHandler]: getOpenScapeTenant...");var b={type:d.AdministrationActionType.GET_OPENSCAPE_TENANT,getOpenScapeTenant:{}};h(d.ContentType.ADMINISTRATION,b,function(b,c){j(b,c,a)&&a(null,c.administration.getOpenScapeTenantResult.tenant)})},this.getAutomatedAttendantConfiguration=function(a){a=a||C,x.debug("[ClientApiHandler]: getAutomatedAttendantConfiguration...");var b={type:d.AdministrationActionType.GET_AUTOMATEDATTENDANT_CONFIGURATION};h(d.ContentType.ADMINISTRATION,b,function(b,c){if(j(b,c,a,!0)){var d=c.administration.getAutomatedAttendantConfigurationResult;a(null,d.configuration||[])}})},this.setAutomatedAttendantConfiguration=function(a,b){if(b=b||C,x.debug("[ClientApiHandler]: setAutomatedAttendantConfiguration..."),!a)return x.warn("[ClientApiHandler]: No configuration were provided"),void k(b,d.ReturnCode.INVALID_MESSAGE);var c={type:d.AdministrationActionType.SET_AUTOMATEDATTENDANT_CONFIGURATION,setAutomatedAttendantConfiguration:{configuration:a}};h(d.ContentType.ADMINISTRATION,c,function(a,c){j(a,c,b)&&b(null)})},this.getApplicationsList=function(a,b){b=b||C,x.debug("[ClientApiHandler]: getApplicationsList...");var c={type:d.AdministrationActionType.GET_CUSTOM_APPS,getCustomApps:{tenantId:a}};h(d.ContentType.ADMINISTRATION,c,function(a,c){j(a,c,b,!0)&&b(null,c.administration.getCustomApps.customApps)})},this.createApplication=function(a,b,c,e){if(e=e||C,x.debug("[ClientApiHandler]: createApplication..."),!a)return x.warn("[ClientApiHandler]: No application data were provided"),void k(e,d.ReturnCode.INVALID_MESSAGE);if(F<=y)return x.warn("[ClientApiHandler]: The createApplication operation is not supported by the backend"),void k(e,d.ReturnCode.OPERATION_NOT_SUPPORTED);var f={type:d.AdministrationActionType.ADD_CUSTOM_APP,addCustomApp:{customApp:a,smallLogo:b,largeLogo:c}};h(d.ContentType.ADMINISTRATION,f,function(a,b){j(a,b,e)&&e(null,b.administration.addCustomAppResult)})},this.getExchangeSettings=function(a){a=a||C,x.debug("[ClientApiHandler]: getExchangeSettings...");var b={type:d.ThirdPartyConnectorsActionType.GET_SETTINGS,getSettings:{type:d.ThirdPartyConnectorType.EXCHANGE_CONNECTOR}},c=["response.thirdpartyconnectors.getSettings.exchange"];h(d.ContentType.THIRDPARTYCONNECTORS,b,function(b,c){j(b,c,a)&&a(null,c.thirdpartyconnectors.getSettings.exchange)},null,c)},this.saveExchangeSettings=function(a,b){b=b||C,x.debug("[ClientApiHandler]: saveExchangeSettings..."),E&&(a.encryptionKey=String(Date.now()));var c={type:d.ThirdPartyConnectorsActionType.SAVE_SETTINGS,saveSettings:{type:d.ThirdPartyConnectorType.EXCHANGE_CONNECTOR,exchange:a}},e=["request.thirdpartyconnectors.saveSettings.exchange"],f=["response.thirdpartyconnectors.saveSettings.exchange"];h(d.ContentType.THIRDPARTYCONNECTORS,c,function(a,c){j(a,c,b)&&b(null,c.thirdpartyconnectors.saveSettings.exchange)},e,f)},this.saveOpenXchangeSettings=function(a,b){b=b||C,x.debug("[ClientApiHandler]: saveOpenXchangeSettings...");var c={type:d.ThirdPartyConnectorsActionType.SAVE_SETTINGS,saveSettings:{type:d.ThirdPartyConnectorType.OPEN_XCHANGE,openXchange:a}},e=["request.thirdpartyconnectors.saveSettings.openXchange"],f=["response.thirdpartyconnectors.saveSettings.openXchange"];h(d.ContentType.THIRDPARTYCONNECTORS,c,function(a,c){j(a,c,b)&&b(null,c.thirdpartyconnectors.saveSettings.openXchange)},e,f)},this.getThirdpartyProviderSettings=function(a,b){if(b=b||C,a=a||{},x.debug("[ClientApiHandler]: getThirdpartyProviderSettings..."),E||F<=z)return void k(b,null,{encryptionKey:a.emailAddress});var c={type:d.ThirdPartyConnectorsActionType.GET_SETTINGS,getSettings:{type:d.ThirdPartyConnectorType.CLIENT_THIRDPARTY}},e=["response.thirdpartyconnectors.getSettings.clientThirdparty"];h(d.ContentType.THIRDPARTYCONNECTORS,c,function(a,c){j(a,c,b)&&b(null,c.thirdpartyconnectors.getSettings.clientThirdparty)},null,e)},this.saveThirdpartyProviderSettings=function(a,b){if(b=b||C,a=a||{},x.debug("[ClientApiHandler]: saveThirdpartyProviderSettings..."),E||F<=z)return void k(b,null,{encryptionKey:a.emailAddress});var c={type:d.ThirdPartyConnectorsActionType.SAVE_SETTINGS,saveSettings:{type:d.ThirdPartyConnectorType.CLIENT_THIRDPARTY,clientThirdparty:{encryptionKey:""}}},e=["request.thirdpartyconnectors.saveSettings.clientThirdparty.encryptionKey"],f=["response.thirdpartyconnectors.saveSettings.clientThirdparty.encryptionKey"];h(d.ContentType.THIRDPARTYCONNECTORS,c,function(a,c){j(a,c,b)&&b(null,c.thirdpartyconnectors.saveSettings.clientThirdparty)},e,f)},this.connectToThirdParty=function(a,b){b=b||C,x.debug("[ClientApiHandler]: connectToThirdParty "+a+"...");var c;switch(a){case d.ThirdPartyConnectorType.BOX:case d.ThirdPartyConnectorType.SYNCPLICITY:case d.ThirdPartyConnectorType.GOOGLE_DRIVE:case d.ThirdPartyConnectorType.ONE_DRIVE:c={type:d.ThirdPartyConnectorsActionType.CONNECT,connect:{type:a}};break;default:return void k(b,d.ThirdPartyError.UNSUPPORTED_PROVIDER)}var e=["response.thirdpartyconnectors.connect.authorizeUrl"];h(d.ContentType.THIRDPARTYCONNECTORS,c,function(a,c){j(a,c,b)&&(c.thirdpartyconnectors.connect?b(null,c.thirdpartyconnectors.connect.authorizeUrl):b(d.ThirdPartyError.UNSUPPORTED_PROVIDER))},null,e)},this.refreshConnectionToThirdParty=function(a,b,c){c=c||C,x.debug("[ClientApiHandler]: refreshConnectionToThirdParty "+a+"...");var e;switch(a){case d.ThirdPartyConnectorType.SYNCPLICITY:e={type:d.ThirdPartyConnectorsActionType.REFRESH_CONNECTION,refreshConnection:{type:a,refreshToken:b}};break;default:return void k(c,d.ThirdPartyError.UNSUPPORTED_PROVIDER)}var f=["request.thirdpartyconnectors.refreshConnection.refreshToken"],g=["response.thirdpartyconnectors.refreshConnection.accessToken","response.thirdpartyconnectors.refreshConnection.refreshToken"];h(d.ContentType.THIRDPARTYCONNECTORS,e,function(a,b){j(a,b,c)&&(b.thirdpartyconnectors.refreshConnectionResult?c(null,b.thirdpartyconnectors.refreshConnectionResult):c(d.ThirdPartyError.UNSUPPORTED_PROVIDER))},f,g)},this.getFolderItems=function(a,b){b=b||C,x.debug("[ClientApiHandler]: getFolderItems for ",a.provider);var c;switch(a.provider){case d.ThirdPartyConnectorType.BOX:case d.ThirdPartyConnectorType.OPEN_XCHANGE:c={type:d.ThirdPartyConnectorsActionType.GET_FOLDER_ITEMS,getFolderItems:{type:a.provider,id:a.folderId,index:a.indexCursor,pageSize:a.pageSize}};break;case d.ThirdPartyConnectorType.GOOGLE_DRIVE:case d.ThirdPartyConnectorType.ONE_DRIVE:case d.ThirdPartyConnectorType.SYNCPLICITY:c={type:d.ThirdPartyConnectorsActionType.GET_FOLDER_ITEMS_WITH_CURSOR,getFolderItemsWithCursor:{type:a.provider,syncpointId:a.syncpointId||void 0,id:a.folderId,cursor:a.indexCursor,pageSize:a.pageSize,accessToken:a.accessToken||void 0}};break;default:return void k(b,d.ThirdPartyError.UNSUPPORTED_PROVIDER)}var e=["request.thirdpartyconnectors.getFolderItemsWithCursor.accessToken"];h(d.ContentType.THIRDPARTYCONNECTORS,c,function(c,d){j(c,d,b)&&b(null,{folder:a.folderId,items:d.thirdpartyconnectors.getFolderItemsResult})},e)},this.getConnectionStatus=function(a,b){b=b||C,x.debug("[ClientApiHandler]: getConnectionStatus "+a+"...");var c={type:d.ThirdPartyConnectorsActionType.GET_CONNECTION_STATUS,getConnectionStatus:{type:a}};h(d.ContentType.THIRDPARTYCONNECTORS,c,function(a,c){j(a,c,b)&&b(null,c.thirdpartyconnectors.getConnectionStatus.connected)})},this.disconnectFromThirdParty=function(a,b,c){c=c||C,x.debug("[ClientApiHandler]: disconnectFromThirdParty "+a+"...");var e;switch(a){case d.ThirdPartyConnectorType.BOX:case d.ThirdPartyConnectorType.OPEN_XCHANGE:case d.ThirdPartyConnectorType.SYNCPLICITY:case d.ThirdPartyConnectorType.GOOGLE_DRIVE:case d.ThirdPartyConnectorType.ONE_DRIVE:e={type:d.ThirdPartyConnectorsActionType.DISCONNECT,disconnect:{type:a,accessToken:b||void 0}};break;default:return void k(c,d.ThirdPartyError.UNSUPPORTED_PROVIDER)}var f=["request.thirdpartyconnectors.disconnect.accessToken"];h(d.ContentType.THIRDPARTYCONNECTORS,e,function(a,b){j(a,b,c)&&c(null)},f)},this.shareFolderItems=function(a,b){if(b=b||C,!a)return void k(b,d.ReturnCode.MISSING_REQUIRED_PARAMETER);var c=a.provider,e=a.itemsData;x.debug("[ClientApiHandler]: shareFolderItems "+c+"...");var f;switch(c){case d.ThirdPartyConnectorType.BOX:case d.ThirdPartyConnectorType.OPEN_XCHANGE:case d.ThirdPartyConnectorType.GOOGLE_DRIVE:case d.ThirdPartyConnectorType.ONE_DRIVE:case d.ThirdPartyConnectorType.SYNCPLICITY:f={type:d.ThirdPartyConnectorsActionType.SHARE_FOLDER_ITEMS,shareFolderItems:{type:c,shareItems:e,conversationId:a.convId,accessToken:a.accessToken||void 0}};break;default:return void k(b,d.ThirdPartyError.UNSUPPORTED_PROVIDER)}var g=["request.thirdpartyconnectors.shareFolderItems.accessToken"],i=["response.thirdpartyconnectors.shareFolderItems.items.[].shareLinkPassword","response.thirdpartyconnectors.shareFolderItems.items.[].downloadUrl","response.thirdpartyconnectors.shareFolderItems.items.[].previewUrl","response.thirdpartyconnectors.shareFolderItems.appKey","response.thirdpartyconnectors.shareFolderItems.accessToken"];h(d.ContentType.THIRDPARTYCONNECTORS,f,function(a,c){j(a,c,b)&&b(null,c.thirdpartyconnectors.shareFolderItems)},g,i)},this.unshareItems=function(a,b){b=b||C,x.debug("[ClientApiHandler]: ushareItems "+a.provider+"...");var c;switch(a.provider){case d.ThirdPartyConnectorType.OPEN_XCHANGE:case d.ThirdPartyConnectorType.SYNCPLICITY:c={type:d.ThirdPartyConnectorsActionType.UNSHARE_FOLDER_ITEMS,unshareFolderItems:{type:a.provider,fileId:a.itemIds,accessToken:a.accessToken||void 0}};break;default:return void k(b,d.ThirdPartyError.UNSUPPORTED_PROVIDER)}var e=["request.thirdpartyconnectors.unshareFolderItems.accessToken"];h(d.ContentType.THIRDPARTYCONNECTORS,c,function(a,c){j(a,c,b)&&b(null)},e)},this.getEditUrl=function(a,b){x.debug("[ClientApiHandler]: getEditUrl "+a.provider);var c;switch(a.provider){case d.ThirdPartyConnectorType.OPEN_XCHANGE:c={type:d.ThirdPartyConnectorsActionType.GET_EDIT_URL,getEditUrl:{externalAttachment:{type:a.provider,downloadLocation:a.uri,previewLocation:a.uri,attachment:{fileId:a.fileId,fileName:a.fileName,size:a.size,mimeType:a.mimeType}}}};break;default:return void k(b,d.ThirdPartyError.UNSUPPORTED_PROVIDER)}h(d.ContentType.THIRDPARTYCONNECTORS,c,function(a,c){j(a,c,b)&&b(null,c.thirdpartyconnectors.getEditUrlResult.url)})},this.getStorageAuthenticationData=function(a,b,c){if(c=c||C,x.debug("[ClientApiHandler]: getStorageAuthenticationData..."),a!==d.ThirdPartyConnectorType.SYNCPLICITY)return void k(c,d.ThirdPartyError.UNSUPPORTED_PROVIDER);var e={type:d.ThirdPartyConnectorsActionType.CONNECT_STORAGE,connectStorage:{type:d.ThirdPartyConnectorType.SYNCPLICITY,endpointUrls:b}};h(d.ContentType.THIRDPARTYCONNECTORS,e,function(a,b){j(a,b,c)&&c(null,b.thirdpartyconnectors.connectStorageResult.storageAuthenticationData)})},this.getGlobalProperty=function(a,b){b=b||C,x.debug("[ClientApiHandler]: getGlobalProperty...");var c={type:d.SystemActionType.GET_GLOBAL_PROPERTY,getGlobalProperty:{globalPropertyName:a}};h(d.ContentType.SYSTEM,c,function(a,c){j(a,c,b)&&b(null,c.system.getGlobalPropertyResult.property)})},this.getGlobalProperties=function(a,b){b=b||C,a instanceof Array||(a=[a]),x.debug("[ClientApiHandler]: getGlobalProperties...");var c={type:d.SystemActionType.GET_GLOBAL_PROPERTIES,getGlobalProperties:{globalPropertyNames:a}};h(d.ContentType.SYSTEM,c,function(a,c){j(a,c,b)&&b(null,c.system.getGlobalPropertiesResult.property)})},this.validateSessionInvite=function(a,b,c){c=c||C,x.debug("[ClientApiHandler]: validateSessionInvite...");var e={type:d.GuestActionType.VALIDATE_SESSION_INVITE_TOKEN,validateSessionInviteToken:{token:{token:a},configurableTextsLanguage:b||void 0}},f=["response.guest.validateSessionInviteToken.convTopic"];h(d.ContentType.GUEST,e,function(a,b){j(a,b,c)&&c(null,b.guest.validateSessionInviteToken)},null,f)},this.registerSessionGuest=function(a,b){b=b||C,x.debug("[ClientApiHandler]: registerSessionGuest...");var c={type:d.GuestActionType.REGISTER_SESSION_GUEST,registerSessionGuest:{token:{token:a.token},firstName:a.firstName,lastName:a.lastName,forTestCall:a.testCall,locale:a.locale,userId:v||void 0,oldClientId:u||void 0,previousServer:w||void 0}},e=["response.guest.registerSessionGuestResult.guestContext"];h(d.ContentType.GUEST,c,function(a,c){if(j(a,c,b)){var d=c.guest.registerSessionGuestResult;F=g.convertVersionToNumber(d.apiVersion),w=d.connectedBackend,u=d.clientId,v=d.userId,b(null,d)}},null,e)},this.sendUserToUserRequest=function(a,b,c){c=c||C,x.debug("[ClientApiHandler]: sendUserToUserRequest, type: "+a+", data: ",b);var e={type:d.ContentType.USER_TO_USER,userToUser:{type:a,routing:{destUserId:b.destUserId,srcUserId:v,destClientId:b.destClientId,srcClientId:u},data:JSON.stringify(b.content)}},f=["request.userToUser.userToUser.data"];h(d.ContentType.USER_TO_USER,e,function(a,b){j(a,b,c)&&c(null,b.userToUser)},f)},this.getPackages=function(a){a=a||C,x.debug("[ClientApiHandler]: getPackages...");var b={type:d.AccountActionType.GET_ASSIGNED_PACKAGES};h(d.ContentType.ACCOUNT,b,function(b,c){j(b,c,a)&&a(null,c.account.getAssignedPackages.packages||[])})},this.getAccounts=function(a,b){b=b||C,x.debug("[ClientApiHandler]: getAccounts...");var c={type:d.AccountActionType.GET_ACCOUNTS,getAccounts:{searchCriterias:a.searchCriterias,sorting:a.sorting,ordering:a.ordering,searchPointer:a.searchPointer,pageSize:a.pageSize,excludedTags:a.excludedTags}},e=["response.administration.getAccounts.accounts"];h(d.ContentType.ACCOUNT,c,function(a,c){j(a,c,b)&&b(null,c.account.getAccounts)},null,e)},this.getAccountByUserId=function(a,b){b=b||C,x.debug("[ClientApiHandler]: getAccountByUserId...");var c={type:d.AccountActionType.GET_ACCOUNT_BY_USER_ID,getAccountByUserId:{userId:a}};h(d.ContentType.ACCOUNT,c,function(a,c){j(a,c,b)&&b(null,c.account.getAccountByUserId.account)})},this.migrateAccount=function(a,b){b=b||C,x.debug("[ClientApiHandler]: migrateAccount...");var c={type:d.AccountActionType.MIGRATE_ACCOUNT,migrateAccount:{accountId:a.accountId,accountTemplateId:a.accountTemplateId}};h(d.ContentType.ACCOUNT,c,function(a,c){j(a,c,b)&&b(null,c.account.migrateAccount)})},this.migrateMultipleUsers=function(a,b){b=b||C,x.debug("[ClientApiHandler]: migrateMultipleUsers...");var c={type:d.AccountActionType.MIGRATE_MULTIPLE_USERS,migrateMultipleUsers:{accountIds:a.accountIds,accountTemplateId:a.accountTemplateId}};h(d.ContentType.ACCOUNT,c,function(a,c){j(a,c,b)&&b(null,c)})},this.suspendAccount=function(a,b){b=b||C,x.debug("[ClientApiHandler]: suspendAccount...");var c={type:d.AccountActionType.SUSPEND_ACCOUNT,suspendAccount:{accountId:a}};h(d.ContentType.ACCOUNT,c,function(a,c){j(a,c,b)&&b(null)})},this.unsuspendAccount=function(a,b){b=b||C,x.debug("[ClientApiHandler]: unsuspendAccount...");var c={type:d.AccountActionType.UNSUSPEND_ACCOUNT,unsuspendAccount:{accountId:a}};h(d.ContentType.ACCOUNT,c,function(a,c){j(a,c,b)&&b(null)})},this.suspendUser=function(a,b){b=b||C,x.debug("[ClientApiHandler]: suspendUser...");var c={type:d.AdministrationActionType.SUSPEND_USER,suspendUser:{userId:a}};h(d.ContentType.ADMINISTRATION,c,function(a,c){j(a,c,b)&&b(null);
})},this.unsuspendUser=function(a,b){b=b||C,x.debug("[ClientApiHandler]: unsuspendUser...");var c={type:d.AdministrationActionType.UNSUSPEND_USER,unsuspendUser:{userId:a}};h(d.ContentType.ADMINISTRATION,c,function(a,c){j(a,c,b)&&b(null)})},this.assignTelephonyConfiguration=function(a,b,c){c=c||C,x.debug("[ClientApiHandler]: assignTelephonyConfiguration...");var e={type:d.AccountActionType.ASSIGN_TELEPHONY_CONFIGURATION,assignTelephonyConfiguration:{accountId:a,configuration:{phoneNumber:g.cleanPhoneNumber(b.phoneNumber),callerId:g.cleanPhoneNumber(b.callerId),reroutingPhoneNumber:g.cleanPhoneNumber(b.reroutingPhoneNumber),onsSipAuthenticationHash:b.onsSipAuthenticationHash||"",ondSipAuthenticationHash:b.ondSipAuthenticationHash||"",associatedTelephonyUserID:b.associatedTelephonyUserID||"",associatedTelephonyTrunkGroupId:b.associatedTelephonyTrunkGroupId||"",associatedTelephonyUserType:b.associatedTelephonyUserType||void 0}}},f=["request.account.assignTelephonyConfiguration.configuration.onsSipAuthenticationHash","request.account.assignTelephonyConfiguration.configuration.ondSipAuthenticationHash"];h(d.ContentType.ACCOUNT,e,function(a,b){j(a,b,c)&&c(null)},f)},this.renewAssociatedTelephonyUser=function(a,b){b=b||C,x.debug("[ClientApiHandler]: renewAssociatedTelephonyUser...");var c={type:d.AccountActionType.RENEW_ASSOCIATED_TELEPHONY_USER,renewAssociatedTelephonyUser:{currentAssociatedTelephonyUserId:a}};h(d.ContentType.ACCOUNT,c,function(a,c){j(a,c,b)&&b(null)})},this.getTechnicalAdminUserId=function(a){a=a||C,x.debug("[ClientApiHandler]: getTechnicalAdminUserId...");var b={type:d.AccountActionType.GET_TECHNICAL_ADMIN_USER_ID};h(d.ContentType.ACCOUNT,b,function(b,c){j(b,c,a)&&a(null,c.account.getTechnicalAdminUserIdResult.technicalAdminUserId)})},this.sendClientInfo=function(a,b){b=b||C,x.debug("[ClientApiHandler]: sendClientInfo...");var c={type:d.RTCSessionActionType.SEND_CLIENT_INFO,sendClientInfo:{clientInfo:a}};h(d.ContentType.RTC_SESSION,c,function(a,c){j(a,c,b)&&b(null)})},this.getUserData=function(a){a=a||C,x.debug("[ClientApiHandler]: getUserData...");var b={type:d.UserDataActionType.GET_USER_DATA};h(d.ContentType.USER_DATA,b,function(b,c){j(b,c,a)&&a(null,c.userData.getUserData)})}}var c=a.ConnectionHandler,d=a.Constants,e=a.PrivateData,f=a.Proto,g=a.Utils;return b.prototype.constructor=b,b.prototype.name="ClientApiHandler",a.ClientApiHandler=b,a}(Circuit),Circuit=function(a){"use strict";return a.ClientApiHandlerSingleton=function(){var b;return{getInstance:function(){return b||(b=new a.ClientApiHandler),b}}}(),a}(Circuit),Circuit=function(a){"use strict";function b(a){function b(a,b){if(b){var c=window.setTimeout(function(a){e.error("[UserToUserHandler]: Timeout waiting for response. RequestId:",a),k[a]&&(delete k[a],b(d.ReturnCode.REQUEST_TIMEOUT),e.debug("[UserToUserHandler]: Remaining callbacks pending:",Object.keys(k).length))},j,a);k[a]={cb:b,timer:c}}}function g(a){a&&window.setTimeout(function(){a(d.ReturnCode.INVALID_MESSAGE)},0)}function h(a,c,h){return c&&c.content&&c.content.type?(e.debug("[UserToUserHandler]: Sending request "+a+"."+c.content.type),c.content.requestId=c.content.requestId||f.createTransactionId(),k[c.content.requestId]?(e.error("[UserToUserHandler]: UserToUser request has duplicate requestId"),void g(h)):void m.sendUserToUserRequest(a,c,function(f){return f?(e.error("[UserToUserHandler]: Failed to send request: ",f),void(h&&h(f))):void(a===d.UserRoutingMessageType.SDK?h&&h():b(c.content.requestId,h))})):(e.error("[UserToUserHandler]: Invalid UserToUser request data - ",c),void g(h))}function i(a,b){try{if(b.routing&&b.routing.srcClientId===m.clientId)return void e.info("[UserToUserHandler]: Ignore own UserToUser event");var c;try{c=JSON.parse(b.data)}catch(a){return void e.error("[UserToUserHandler]: Event discarded (Cannot Parse)")}if(c.requestId){var f=k[c.requestId];if(f)return f.timer&&window.clearTimeout(f.timer),delete k[c.requestId],f.cb&&f.cb(null,c),void e.debug("[UserToUserHandler]: Remaining callbacks pending:",Object.keys(k).length)}var g=a+"."+c.type,h=l[g];h&&0!==h.length?(a===d.UserRoutingMessageType.SDK&&(c=c.message),h.forEach(function(a){a.cb(c,b.routing)})):e.info("[UserToUserHandler]: There is no registered event handler for ",g)}catch(a){e.error("[UserToUserHandler]: Exception handling UserToUser event. ",a)}}var j=2e4,k={},l={},m=a||c.getInstance();m.on("UserToUser.ATC",function(a){e.debug("[UserToUserHandler]: Received UserToUser.ATC event: ",a.data),i(d.UserRoutingMessageType.ATC,a)}),m.on("UserToUser.DESKTOP_APP",function(a){e.debug("[UserToUserHandler]: Received UserToUser.DESKTOP_APP event: ",a.data),i(d.UserRoutingMessageType.DESKTOP_APP,a)}),m.on("UserToUser.CONTACT_CARD",function(a){e.debug("[UserToUserHandler]: Received UserToUser.CONTACT_CARD event: ",a.data),i(d.UserRoutingMessageType.CONTACT_CARD,a)}),m.on("UserToUser.CMP",function(a){e.debug("[UserToUserHandler]: Received UserToUser.CMP event: ",a.data),i(d.UserRoutingMessageType.CMP,a)}),m.on("UserToUser.MOBILE_BREAKOUT",function(a){e.debug("[UserToUserHandler]: Received UserToUser.MOBILE_BREAKOUT event: ",a.data),i(d.UserRoutingMessageType.MOBILE_BREAKOUT,a)}),m.on("UserToUser.SDK",function(a){e.debug("[UserToUserHandler]: Received UserToUser.SDK event: ",a.data),i(d.UserRoutingMessageType.SDK,a)}),this.cancelReqCallback=function(a){var b=k[a];b&&(b.cb=null)},this.sendAtcRequest=function(a,b){h(d.UserRoutingMessageType.ATC,a,b)},this.sendContactCardRequest=function(a,b){h(d.UserRoutingMessageType.CONTACT_CARD,a,b)},this.sendDesktopAppRequest=function(a,b){h(d.UserRoutingMessageType.DESKTOP_APP,a,b)},this.sendMeetingPointRequest=function(a,b){h(d.UserRoutingMessageType.CMP,a,b)},this.sendMobileBreakoutEvent=function(a,b){h(d.UserRoutingMessageType.MOBILE_BREAKOUT,a,b)},this.sendSdkRequest=function(a,b){a&&a.content&&delete a.content.requestId,h(d.UserRoutingMessageType.SDK,a,b)},this.on=function(a,b){if(a&&"function"==typeof b){l[a]=l[a]||[];var c=l[a].some(function(a){return a.cb===b});c||l[a].push({cb:b})}},this.off=function(a,b){if(a||b)if(b){if(a&&"function"==typeof b){var c=l[a];c&&c.some(function(a,d){if(a.cb===b)return c.splice(d,1),!0})}}else delete l[a];else l={}}}var c=a.ClientApiHandlerSingleton,d=a.Constants,e=a.logger,f=a.Utils,g=Object.freeze({CSTA:"CSTA",PRIMARYCLIENT:"PRIMARYCLIENT",INFO:"INFO",SETTINGS:"SETTINGS"}),h=Object.freeze({GET_GTC_VERSION_REQUEST:"GET_GTC_VERSION_REQUEST",GET_GTC_VERSION_RESPONSE:"GET_GTC_VERSION_RESPONSE",SET_ROUTE_TO_DESK:"SET_ROUTE_TO_DESK",ENABLE_PBX_CALL_LOG:"ENABLE_PBX_CALL_LOG"}),i=Object.freeze({CLICK_TO_CALL_REQUEST:"CLICK_TO_CALL_REQUEST",CLICK_TO_CALL_RESPONSE:"CLICK_TO_CALL_RESPONSE",MUTE_DEVICE_REQUEST:"MUTE_DEVICE_REQUEST",MUTE_DEVICE_RESPONSE:"MUTE_DEVICE_RESPONSE",JOIN_CONFERENCE_REQUEST:"JOIN_CONFERENCE_REQUEST",JOIN_CONFERENCE_RESPONSE:"JOIN_CONFERENCE_RESPONSE",CLICK_TO_ANSWER_REQUEST:"CLICK_TO_ANSWER_REQUEST",CLICK_TO_ANSWER_RESPONSE:"CLICK_TO_ANSWER_RESPONSE"}),j=Object.freeze({OK:"OK",BUSY:"BUSY",TELEPHONY_NOT_AVAILABLE:"TELEPHONY_NOT_AVAILABLE",USER_NOT_FOUND:"USER_NOT_FOUND",CONVERSATION_NOT_FOUND:"CONVERSATION_NOT_FOUND",CALL_DECLINED:"CALL_DECLINED",CALL_FAILED:"CALL_FAILED",CALL_NOT_FOUND:"CALL_NOT_FOUND",MUTE_DEVICE_FAILED:"MUTE_DEVICE_FAILED",JOIN_CONFERENCE_FAILED:"JOIN_CONFERENCE_FAILED"}),k=Object.freeze({INVITE_REQUEST:"INVITE_REQUEST",INVITE_RESPONSE:"INVITE_RESPONSE",MUTE_REQUEST:"MUTE_REQUEST",MUTE_RESPONSE:"MUTE_RESPONSE",UNMUTE_REQUEST:"UNMUTE_REQUEST",UNMUTE_RESPONSE:"UNMUTE_RESPONSE",GET_MEETINGPOINT_INVITER_REQUEST:"GET_MEETINGPOINT_INVITER_REQUEST",GET_MEETINGPOINT_INVITER_RESPONSE:"GET_MEETINGPOINT_INVITER_RESPONSE",TOGGLE_VIDEO_REQUEST:"TOGGLE_VIDEO_REQUEST",TOGGLE_VIDEO_RESPONSE:"TOGGLE_VIDEO_RESPONSE",START_HD_VIDEO_REQUEST:"START_HD_VIDEO_REQUEST",START_HD_VIDEO_RESPONSE:"START_HD_VIDEO_RESPONSE"}),l=Object.freeze({OK:"OK",FAILED:"FAILED",MISSING_REQUIRED_PARAMETER:"MISSING_REQUIRED_PARAMETER",NOT_FOUND:"NOT_FOUND",NOT_CMP_USER:"NOT_CMP_USER",NOT_SUPPORTED:"NOT_SUPPORTED",INVITE_FAILED:"INVITE_FAILED",MUTE_FAILED:"MUTE_FAILED",UNMUTE_FAILED:"UNMUTE_FAILED",INVALID_PIN:"INVALID_PIN",MEETINGPOINT_BUSY:"MEETINGPOINT_BUSY",TOGGLE_VIDEO_FAILED:"START_VIDEO_FAILED"}),m=Object.freeze({DIAL:"DIAL"});return b.prototype.constructor=b,b.prototype.name="UserToUserHandler",a.UserToUserHandler=b,a.Enums=a.Enums||{},a.Enums.AtcInfoMessage=h,a.Enums.AtcMessage=g,a.Enums.ContactCardMessage=i,a.Enums.ContactCardResponseCode=j,a.Enums.MeetingPointMessage=k,a.Enums.MeetingPointResponseCode=l,a.Enums.MobileBreakoutMessage=m,a}(Circuit),Circuit=function(a){"use strict";return a.UserToUserHandlerSingleton=function(){var b;return{getInstance:function(){return b||(b=new a.UserToUserHandler),b}}}(),a}(Circuit),Circuit=function(a){"use strict";function b(){function a(a){return{connectionId:a.cIr,localCallState:a.lCS.cCSe&&a.lCS.cCSe.lCSe}}function b(a){return{deviceOnCall:a.dOC.dIr||"",callIdentifier:a.cI,localConnectionState:a.lCI,servicesPermitted:h(a)}}function d(a){if(!a.CSTAErrorCode)return c.error("[CstaParser]: The given response is not an error code: ",a),null;var b=null,d=Object.keys(a.CSTAErrorCode)[0];switch(d){case"oprt":case"operation":b="Operation Error";break;case"scrt":case"security":b="Security Error";break;case"sIy":case"stateIncompatibility":b="State Incompatibility Error";break;case"sRAy":case"systemResourceAvailability":b="System Resource Availability Error";break;case"sRA":case"subscribedResourceAvailability":b="Subscribed Resource Availability Error";break;case"pM":case"performanceManagement":b="Performance Management Error";break;case"pDa":case"privateDataInformation":b="Private Data Information Error"}return b?{error:!0,errorCategory:b,errorValue:a.CSTAErrorCode[d]}:(c.error("[CstaParser]: Unrecognized Error Category"),{error:!0,category:"Unknown",value:"Unknown"})}function e(a){if(!a.ISEC)return c.error("[CstaParser]: The given response is not an internal service error code: ",a),null;var b=null,d=Object.keys(a.ISEC)[0];switch(d){case"code":b="Code"}return b?{error:!0,errorCategory:b,errorValue:a.ISEC[d]}:(c.error("[CstaParser]: Unrecognized Internal Service Error Category"),{error:!0,category:"Unknown",value:"Unknown"})}function f(a){var b=null;return a&&a.extn&&a.extn.pDa&&a.extn.pDa.prvt&&(b=a.extn.pDa.prvt.zEpid),b}function g(a){a&&Object.keys(a).forEach(function(b){a[b]=""===a[b]||"true"===a[b]})}function h(a){if(!a)return{};var b={};return a.sP&&(b.rSP=a.sP,g(b.rSP.cCSs)),a.extn&&a.extn.pDa&&a.extn.pDa.prvt&&void 0!==a.extn.pDa.prvt.zxSP&&(b.eSP=a.extn.pDa.prvt.zxSP,g(b.eSP)),b}function i(a){return c.debug("[CstaParser]: Received CSTA Alternate Call response: ",a),a.ACRe}function j(a){return c.debug("[CstaParser]: Received CSTA Answer Call response: ",a),a.AnCR}function k(a){return c.debug("[CstaParser]: Received CSTA Accept Call response: ",a),a.ACR}function l(a){return c.debug("[CstaParser]: Received CSTA Clear Connection response: ",a),a.ClCR}function m(a){return c.debug("[CstaParser]: Received CSTA Deflect Call response: ",a),a.DCRe}function n(a){return c.debug("[CstaParser]: Received CSTA Generate Digits response: ",a),a.GDR}function o(a){c.debug("[CstaParser]: Received CSTA Get Do Not Disturb response: ",a);var b=a.GDNDe;return{doNotDisturbOn:"true"===b.dNDO}}function p(a){return{forwardingType:a.fTe,forwardStatus:"true"===a.fS,forwardDN:a.fDNN}}function q(a){if(c.debug("[CstaParser]: Received CSTA Get Forwarding response: ",a),a.GetForwardingResponse)return r(a.GetForwardingResponse);var b=a.GFR,d={forwardList:[]};return b.fL.fLI.fS?d.forwardList.push(p(b.fL.fLI)):b.fL.fLI.forEach(function(a){d.forwardList.push(p(a))}),b.extn&&b.extn.pDa&&b.extn.pDa.prvt&&(d.staticOndDN=b.extn.pDa.prvt.zsOD,d.staticOndActive="true"===b.extn.pDa.prvt.zsOA,d.voicemailActive="true"===b.extn.pDa.prvt.zvMA,b.extn.pDa.prvt.zoP&&(d.overrideProfile="true"===b.extn.pDa.prvt.zoP),b.extn.pDa.prvt.zvMRD&&(d.voicemailRingDuration=parseInt(b.extn.pDa.prvt.zvMRD,10)),b.extn.pDa.prvt.zmRD&&(d.mainRingDuration=parseInt(b.extn.pDa.prvt.zmRD,10)),b.extn.pDa.prvt.zcRD&&(d.clientRingDuration=parseInt(b.extn.pDa.prvt.zcRD,10)),b.extn.pDa.prvt.zcpRD&&(d.cellRingDuration=parseInt(b.extn.pDa.prvt.zcpRD,10)),b.extn.pDa.prvt.hasOwnProperty("zcPN")&&(d.alternativeNumber=b.extn.pDa.prvt.zcPN),b.extn.pDa.prvt.hasOwnProperty("zrTCN")&&(d.routeToCell="true"===b.extn.pDa.prvt.zrTCN)),d}function r(a){var b={forwardList:[]};return a.forwardingList.forwardListItem.forwardStatus?(a.forwardingList.forwardListItem.forwardStatus="true"===a.forwardingList.forwardListItem.forwardStatus,b.forwardList.push(a.forwardingList.forwardListItem)):a.forwardingList.forwardListItem.forEach(function(a){a.forwardStatus="true"===a.forwardStatus,b.forwardList.push(a)}),a.extensions&&a.extensions.privateData&&a.extensions.privateData.private&&(b.staticOndDN=a.extensions.privateData.private.staticOndDN,b.staticOndActive="true"===a.extensions.privateData.private.staticOndActive),b}function s(a){c.debug("[CstaParser]: Received CSTA Get Message Waiting response: ",a);var b=a.GMWIe;return{messageWaitingOn:"true"===b.mWO}}function t(a){return c.debug("[CstaParser]: Received CSTA Hold Call response: ",a),a.HCR}function u(a){return c.debug("[CstaParser]: Received CSTA Reconnect Call response: ",a),a.RCR}function v(a){return c.debug("[CstaParser]: Received CSTA Retrieve Call response: ",a),a.RCRe}function w(a){return c.debug("[CstaParser]: Received CSTA Set Do Not Disturb response: ",a),a.SDNDe}function x(a){return c.debug("[CstaParser]: Received CSTA Set Forwarding response: ",a),a.hasOwnProperty("SFR")?a.SFR:a.SetForwardingResponse}function y(a){return c.debug("[CstaParser]: Received CSTA Consultation Call response: ",a),a.CnCR}function z(a){return c.debug("[CstaParser]: Received CSTA Call Back call related response: ",a),a.CBR}function A(a){return c.debug("[CstaParser]: Received CSTA Call Back non call related response: ",a),a.CBNCe}function B(a){return c.debug("[CstaParser]: Received CSTA Cancel Call Back response: ",a),a.CCBR}function C(a){c.debug("[CstaParser]: Received CSTA Snapshot Call response: ",a);var d=a.SCR,e={endpoints:[],callingDevice:d.caD&&d.caD.dIR||"",calledDevice:d.cDe&&d.cDe.dIR||"",servicesPermitted:{}};return d.cRID.sDa.sCRIo&&(d.cRID.sDa.sCRIo.dOC?e.endpoints.push(b(d.cRID.sDa.sCRIo)):d.cRID.sDa.sCRIo.forEach(function(a){e.endpoints.push(b(a))})),e.servicesPermitted=h(d),e.epid=f(d),e}function D(b){c.debug("[CstaParser]: Received CSTA Snapshot Device response: ",b);var d=b.SnDR,e={activeCalls:[]};return d.cRID.sDa.sDRI&&(d.cRID.sDa.sDRI.cIr?e.activeCalls.push(a(d.cRID.sDa.sDRI)):d.cRID.sDa.sDRI.forEach(function(b){e.activeCalls.push(a(b))})),e}function E(a){c.debug("[CstaParser]: Received CSTA SST Call response: ",a);var b=a.SSTCe,d={transferredCall:b.trC};return b.extn&&b.extn.pDa&&b.extn.pDa.prvt&&(d.seamlessHandover="true"===b.extn.pDa.prvt.zseHo),d}function F(a){c.debug("[CstaParser]: Received CSTA Conference Call response: ",a);var b=a.CoCR;return{conferenceCall:b.coC}}function G(a){c.debug("[CstaParser]: Received CSTA TransferCall response: ",a);var b=a.TCR;return{transferredCall:b.trC}}function H(a){c.debug("[CstaParser]: Received CSTA SetMicrophoneMute response",a);var b=a.SMMR;return{mute:"true"===b.mML.mMI.mMO}}function I(a){c.debug("[CstaParser]: Received CSTA GetMicrophoneMute response",a);var b=a.GMMR;return{mute:"true"===b.mML.mMI.mMO}}function J(a){return c.debug("[CstaParser]: Received CSTA MakeCall response",a),a.MCR}function K(a){return c.debug("[CstaParser]: Received CSTA Call Log Snap Shot response: ",a),a.CLSR}function L(a){c.debug("[CstaParser]: Received CSTA GetAgentState response",a);var b=a.GASR;return{loggedOnState:b.aSL&&b.aSL.aSE&&"true"===b.aSL.aSE.lOS,agentState:b.aSL&&b.aSL.aSE&&b.aSL.aSE.aIo&&"agentReady"===b.aSL.aSE.aIo.aII.aS?"ready":"notReady"}}function M(a){return c.debug("[CstaParser]: Received CSTA SetAgentState response",a),a.SASR}function N(a){var b=a.CIE,c={category:"CallAssociatedFeature",name:"CallInformationEvent",connection:b.cnncn,device:b.dvc.dIr||"",callingDevice:b.caD&&b.caD.dIr||"",servicesPermitted:{}};return c.servicesPermitted=h(b),c.epid=f(b),c}function O(a){var b=a.CoE,c={category:"CallControl",name:"ConferencedEvent",primaryOldCall:b.pOC,secondaryOldCall:b.sOC,conferencingDevice:b.coD.dIr||"",addedParty:b.aPy.dIr||"",conferenceConnections:[],localConnectionInfo:b.lCI,cause:b.cs,servicesPermitted:{}};return b.cnC.cLI.forEach(function(a){var b={connection:a.nCn,endpoint:a.endp&&(a.endp.dID||a.endp.endp)};c.conferenceConnections.push(b)}),c.servicesPermitted=h(b),c.epid=f(b),c}function P(a){var b=a.CCEt,c={category:"CallControl",name:"ConnectionClearedEvent",droppedConnection:b.drC,releasingDevice:b.rD.dIr||"",localConnectionInfo:b.lCI,cause:b.cs,servicesPermitted:{}};return c.servicesPermitted=h(b),c.epid=f(b),c}function Q(a){var b=a.DE,c={category:"CallControl",name:"DeliveredEvent",connection:b.cnncn,alertingDevice:b.aDe.dIr||"",callingDevice:b.caD.dIr||"",calledDevice:b.cDe.dIr||"",localConnectionInfo:b.lCI,cause:b.cs};return c.servicesPermitted=h(b),c.epid=f(b),c}function R(a){var b=a.DGE;return{category:"CallAssociatedFeature",name:"DigitsGeneratedEvent",connection:b.cnncn,digitGeneratedList:b.dGL}}function S(a){var b=a.DEt,c={category:"CallControl",name:"DivertedEvent",connection:b.cnncn,divertingDevice:b.dvD.dIr||"",newDestination:b.nD.dIr||"",callingDevice:b.caD.dIr||"",localConnectionInfo:b.lCI,cause:b.cs};return c.servicesPermitted=h(b),c.epid=f(b),c}function T(a){var b=a.DNDE;return{category:"LogicalDeviceFeature",name:"DoNotDisturbEvent",device:b.dvc.dIr||"",doNotDisturbOn:"true"===b.dNDO}}function U(a){var b=a.EEt,c={category:"CallControl",name:"EstablishedEvent",establishedConnection:b.eCn,answeringDevice:b.anD.dIr||"",callingDevice:b.caD.dIr||"",calledDevice:b.cDe.dIr||"",localConnectionInfo:b.lCI,cause:b.cs,servicesPermitted:{}};return c.servicesPermitted=h(b),c.epid=f(b),c}function V(a){var b=a.FE,c={category:"CallControl",name:"FailedEvent",failedConnection:b.fC,failingDevice:b.fD.dIr||"",callingDevice:b.caD.dIr||"",localConnectionInfo:b.lCI,calledDevice:b.cDe.dIr,cause:b.cs,servicesPermitted:{}};return c.servicesPermitted=h(b),c.epid=f(b),c}function W(a){var b=a.FEt,c={category:"LogicalDeviceFeature",name:"ForwardingEvent",device:b.dvc.dIr||"",forwardingType:b.fTe,forwardStatus:"true"===b.fS,forwardTo:b.fTo};return b.extn&&b.extn.pDa&&b.extn.pDa.prvt&&(b.extn.pDa.prvt.zsOD&&(c.staticOndDN=b.extn.pDa.prvt.zsOD,c.staticOndActive="true"===b.extn.pDa.prvt.zsOA),b.extn.pDa.prvt.zvMA&&(c.voicemailActive="true"===b.extn.pDa.prvt.zvMA),b.extn.pDa.prvt.zoP&&(c.overrideProfile="true"===b.extn.pDa.prvt.zoP),b.extn.pDa.prvt.zvMRD&&(c.voicemailRingDuration=parseInt(b.extn.pDa.prvt.zvMRD,10)),b.extn.pDa.prvt.zmRD&&(c.mainRingDuration=parseInt(b.extn.pDa.prvt.zmRD,10)),b.extn.pDa.prvt.zcRD&&(c.clientRingDuration=parseInt(b.extn.pDa.prvt.zcRD,10)),b.extn.pDa.prvt.zcpRD&&(c.cellRingDuration=parseInt(b.extn.pDa.prvt.zcpRD,10)),b.extn.pDa.prvt.hasOwnProperty("zcPN")&&(c.alternativeNumber=b.extn.pDa.prvt.zcPN),b.extn.pDa.prvt.hasOwnProperty("zrTCN")&&(c.routeToCell="true"===b.extn.pDa.prvt.zrTCN)),c}function X(a){var b=a.HE,c={category:"CallControl",name:"HeldEvent",heldConnection:b.hCn,holdingDevice:b.hD.dIr||"",localConnectionInfo:b.lCI,servicesPermitted:{}};return c.servicesPermitted=h(b),c.epid=f(b),c}function Y(a){var b=a.MWE;return{category:"PhysicalDeviceFeature",name:"MessageWaitingEvent",device:b.tD.dIr||"",messageWaitingOn:"true"===b.mWO}}function Z(a){var b=a.OE,c={category:"CallControl",name:"OfferedEvent",offeredConnection:b.oCn,offeredDevice:b.oDe.dIr||"",callingDevice:b.caD.dIr||"",calledDevice:b.cDe.dIr||"",localConnectionInfo:b.lCI,lastRedirectionDevice:b.lRD?b.lRD.nDd||"":"",cause:b.cs};return c.servicesPermitted=h(b),c.epid=f(b),c}function $(a){var b=a.QE,c={category:"CallControl",name:"QueuedEvent",queuedConnection:b.qC,queue:b.q.dIr||"",callingDevice:b.caD.dIr||"",localConnectionInfo:b.lCI,cause:b.cs};return c.servicesPermitted=h(b),c.epid=f(b),c}function _(a){var b=a.ReE,c={category:"CallControl",name:"RetrievedEvent",retrievedConnection:b.rCn,retrievingDevice:b.reD.dIr||"",localConnectionInfo:b.lCI,servicesPermitted:{}};return c.servicesPermitted=h(b),c.epid=f(b),c}function aa(a){var b=a.SCFE,c={category:"CallAssociatedFeature",name:"ServiceCompletionFailureEvent",primaryCall:{connectionID:b.prC.cIDD,localConnectionState:b.prC.lCSe},cause:b.cs};return b.sC&&(c.secondaryCall={connectionID:b.sC.cIDD,localConnectionState:b.sC.lCSe}),c}function ba(a){var b=a.SIE,c={category:"CallControl",name:"ServiceInitiatedEvent",initiatedConnection:b.iCn,initiatingDevice:b.iD.dIr||"",cause:b.cs};return c.servicesPermitted=h(b),c.epid=f(b),c}function ca(a){var b=a.CBE;return{category:"LogicalDeviceFeature",name:"CallBackEvent",originatingDevice:b.orD.dIr,targetDevice:b.tD.dIr,callBackSetCanceled:b.cBSC}}function da(a){var b=a.TE,c={category:"CallControl",name:"TransferredEvent",primaryOldCall:b.pOC,secondaryOldCall:b.sOC,transferringDevice:b.tDe.dIr||"",transferredToDevice:b.tTDe.dIr||"",transferredConnections:[],localConnectionInfo:b.lCI,cause:b.cs,servicesPermitted:{}};return b.tCs.cLI.forEach(function(a){var b={connection:a.nCn,endpoint:a.endp&&(a.endp.dID||a.endp.endp)};c.transferredConnections.push(b)}),c.servicesPermitted=h(b),c.epid=f(b),c}function ea(a){return{recordId:a.rID,callID:a.cID,recordType:a.rTp,createdTime:a.cTm,result:a.res,callDuration:a.cDr,callingDevice:a.clDv||"",calledDevice:a.cldDv||"",answeringDevice:a.aDv||""}}function fa(a){var b=a.CLE,c={category:"LogicalDeviceFeature",name:"CallLogEvent",callLogList:[]};return b.cLL&&b.cLL.cLE&&(b.cLL.cLE.rID?c.callLogList.push(ea(b.cLL.cLE)):b.cLL.cLE.forEach(function(a){c.callLogList.push(ea(a))})),c}function ga(a){var b=a.BISE;return{category:"DeviceMaintenance",name:"BackInServiceEvent",backInService:!0,device:b.dvc}}function ha(a){var b=a.OOSE;return{category:"DeviceMaintenance",name:"OutOfServiceEvent",outOfService:!0,device:b.dvc}}function ia(){return{category:"LogicalDeviceFeature",name:"AgentReadyEvent",agentReady:!0}}function ja(){return{category:"LogicalDeviceFeature",name:"AgentNotReadyEvent",agentReady:!1}}function ka(){return{category:"LogicalDeviceFeature",name:"AgentBusyEvent",agentReady:!1}}function la(a){return{ACl:{hC:{cID:a.heldCall.cID,dID:a.heldCall.dID},atC:{cID:a.activeCall.cID,dID:a.activeCall.dID}}}}function ma(a){return{CoC:{hC:{cID:a.heldCall.cID,dID:a.heldCall.dID},atC:{cID:a.activeCall.cID,dID:a.activeCall.dID}}}}function na(a){return{AnC:{cTBAd:{cID:a.callToBeAnswered.cID,dID:a.callToBeAnswered.dID}}}}function oa(a){return{AC:{cTBA:{cID:a.callToBeAccepted.cID,dID:a.callToBeAccepted.dID}}}}function pa(a){return{MC:{caD:a.callingDevice,cDN:a.calledDirectoryNumber,aOe:a.autoOriginate}}}function qa(a){return{CCn:{coTBC:{cID:a.connectionToBeCleared.cID,dID:a.connectionToBeCleared.dID},rsn:a.reason}}}function ra(a){var b={cTBD:{cID:a.callToBeDiverted.cID,dID:a.callToBeDiverted.dID},nD:a.newDestination};return a.autoAnswer&&(b.extn={pDa:{prvt:{zdT:"Auto-Answer"}}}),{DCl:b}}function sa(a){return{GD:{cTSD:{cID:a.connectionToSendDigits.cID,dID:a.connectionToSendDigits.dID},cTS:a.charactersToSend}}}function ta(a){return{GDND:{dvc:a.device}}}function ua(a){return{GF:{dvc:a.device}}}function va(a){return{GMWI:{dvc:a.device}}}function wa(a){return{HC:{cTBH:{cID:a.callToBeHeld.cID,dID:a.callToBeHeld.dID}}}}function xa(a){return{RC:{hC:{cID:a.heldCall.cID,dID:a.heldCall.dID},atC:{cID:a.activeCall.cID,dID:a.activeCall.dID}}}}function ya(a){return{RCl:{cTBRd:{cID:a.callToBeRetrieved.cID,dID:a.callToBeRetrieved.dID}}}}function za(a){return{SDND:{dvc:a.device,dNDO:a.doNotDisturbOn}}}function Aa(a){var b={SF:{dvc:a.device,aF:a.activateForward,fDNN:a.forwardDN,fTe:a.forwardingType,riC:a.ringCount}},c={};return void 0!==a.staticOndActive?c={zsOA:a.staticOndActive===!0?"true":"false",zsOD:a.staticOndDN||""}:void 0!==a.voicemailActive||void 0!==a.voicemailRingDuration?c={zvMA:a.voicemailActive===!0?"true":a.voicemailActive===!1?"false":void 0,zvMRD:a.voicemailRingDuration?a.voicemailRingDuration.toString():void 0}:(void 0!==a.mainRingDuration&&(c.zmRD=a.mainRingDuration.toString()||""),void 0!==a.clientRingDuration&&(c.zcRD=a.clientRingDuration.toString()||""),void 0!==a.cellRingDuration&&(c.zcpRD=a.cellRingDuration.toString()||""),void 0!==a.alternativeNumber&&(c.zcPN=a.alternativeNumber),void 0!==a.routeToCell&&(c.zrTCN=a.routeToCell?"true":"false")),Object.keys(c).length>0&&(b.SF.extn={pDa:{prvt:c}}),b}function Ba(a){return{SMM:{dvc:a.device,mMO:a.mute}}}function Ca(a){return{GMM:{dvc:a.device}}}function Da(a){return{SC:{sO:{cID:a.snapshotObject.cID,dID:a.snapshotObject.dID}}}}function Ea(a){var b={sO:a.snapshotObject};return a.osmo&&(b.extn={pDa:{prvt:{zxsm:a.osmo}}}),{SDe:b}}function Fa(a){var b={atC:{cID:a.activeCall.cID,dID:a.activeCall.dID},tTo:a.transferredTo};if(a.autoAnswer||a.seamlessHandover){var c={};a.autoAnswer&&(c.ztTgt="Auto-Answer"),a.seamlessHandover&&(c.zseHo="true"),b.extn={pDa:{prvt:c}}}return{SSTC:b}}function Ga(a){return{CnC:{cnD:a.consultedDevice,eCl:{cID:a.existingCall.cID,dID:a.existingCall.dID}}}}function Ha(a){return{CB:{cC:{cID:a.callBackConnection.cID,dID:a.callBackConnection.dID}}}}function Ia(a){return{CBNC:{orD:a.orD,tD:a.tD}}}function Ja(a){return{CCB:{orD:a.orD,tD:a.tD}}}function Ka(a){return{TC:{hC:{cID:a.heldCall.cID,dID:a.heldCall.dID},atC:{cID:a.activeCall.cID,dID:a.activeCall.dID}}}}function La(){return{zGCD:{zcCA:"Internet",zdMO:"Chrome",zdOS:"WebRTC"}}}function Ma(a){return{CLS:{sub:a.device}}}function Na(a){return{GAS:{dvc:a.device}}}function Oa(a){return{SAS:{dvc:a.device,rAS:a.state}}}this.genCstaRequest=function(a){try{switch(a.request){case"AlternateCall":return la(a);case"ConferenceCall":return ma(a);case"AnswerCall":return na(a);case"CallBackCallRelated":return Ha(a);case"CallBackNonCallRelated":return Ia(a);case"CancelCallBack":return Ja(a);case"ClearConnection":return qa(a);case"ConsultationCall":return Ga(a);case"DeflectCall":return ra(a);case"GenerateDigits":return sa(a);case"GetDoNotDisturb":return ta(a);case"GetForwarding":return ua(a);case"GetMessageWaitingIndicator":return va(a);case"HoldCall":return wa(a);case"ReconnectCall":return xa(a);case"RetrieveCall":return ya(a);case"SetDoNotDisturb":return za(a);case"SetForwarding":return Aa(a);case"SingleStepTransferCall":return Fa(a);case"SnapshotCall":return Da(a);case"SnapshotDevice":return Ea(a);case"TransferCall":return Ka(a);case"GenGetConfiguration":return La();case"SetMicrophoneMute":return Ba(a);case"GetMicrophoneMute":return Ca(a);case"MakeCall":return pa(a);case"CallLogSnapShot":return Ma(a);case"AcceptCall":return oa(a);case"GetAgentState":return Na(a);case"SetAgentState":return Oa(a)}c.error("CSTA: Unsupported CSTA request: "+a.request)}catch(a){c.error(a)}return null},this.parseEvent=function(a){try{if(!a)return c.error("[CstaParser]: Invalid event"),null;var b=JSON.parse(a);if(!b||b.parsererror)return c.error("[CstaParser]: Error parsing CSTA event: ",a),b&&b.parsererror.div&&c.error("[CstaParser]: "+b.parsererror.div),null;var d=Object.keys(b)[0];switch(d){case"CBE":return ca(b);case"CIE":return N(b);case"CoE":return O(b);case"CCEt":return P(b);case"DE":return Q(b);case"DGE":return R(b);case"DEt":return S(b);case"DNDE":return T(b);case"EEt":return U(b);case"FE":return V(b);case"FEt":return W(b);case"HE":return X(b);case"MWE":return Y(b);case"OE":return Z(b);case"QE":return $(b);case"ReE":return _(b);case"SCFE":return aa(b);case"SIE":return ba(b);case"TE":return da(b);case"CLE":return fa(b);case"BISE":return ga(b);case"OOSE":return ha(b);case"ARE":return ia();case"ANRE":return ja();case"ABE":return ka()}c.info("[CstaParser]: Unsupported CSTA event: ",d)}catch(a){c.error("[CstaParser]: Error parsing CSTA event: ",a)}return null},this.parseResponse=function(a,b){try{if(!a||!b)return c.error("[CstaParser]: Invalid response"),null;var f=JSON.parse(b);if(!f||f.parsererror)return c.error("[CstaParser]: Error parsing CSTA response: ",b),f&&f.parsererror.div&&c.error("[CstaParser]: "+f.parsererror.div),null;if(f.CSTA&&(f.CSTAErrorCode=f.CSTA),f.CSTAErrorCode)return c.debug("[CstaParser]: Received error response for: ",a),d(f);if(f.ISEC)return c.debug("[CstaParser]: Received internal service error response for: ",a),e(f);switch(a){case"AlternateCall":return i(f);case"ConferenceCall":return F(f);case"AnswerCall":return j(f);case"CallBackCallRelated":return z(f);case"CallBackNonCallRelated":return A(f);case"CancelCallBack":return B(f);case"ClearConnection":return l(f);case"ConsultationCall":return y(f);case"DeflectCall":return m(f);case"GenerateDigits":return n(f);case"GetDoNotDisturb":return o(f);case"GetForwarding":return q(f);case"GetMessageWaitingIndicator":return s(f);case"HoldCall":return t(f);case"ReconnectCall":return u(f);case"RetrieveCall":return v(f);case"SetDoNotDisturb":return w(f);case"SetForwarding":return x(f);case"SingleStepTransferCall":return E(f);case"SnapshotCall":return C(f);case"SnapshotDevice":return D(f);case"TransferCall":return G(f);case"SetMicrophoneMute":return H(f);case"GetMicrophoneMute":return I(f);case"MakeCall":return J(f);case"CallLogSnapShot":return K(f);case"AcceptCall":return k(f);case"GetAgentState":return L(f);case"SetAgentState":return M(f)}c.error("CSTA: Unsupported CSTA response for request: ",a)}catch(a){c.error(a)}return null}}var c=Circuit.logger;return a.CstaParser=b,a}(Circuit),Circuit=function(a){"use strict";function b(){function c(a,b){a=a||function(){};var c=++w,f=window.setTimeout(function(){v[c]&&(e.error("[ExtensionConnHandler]: Timeout waiting for response. reqId:",c),delete v[c],a(d.ResponseError.TIMEOUT))},b||q);return v[c]={cb:a,timer:f},c}function g(a){return!(!a||!v[a])&&(delete v[a],!0)}function h(a){var b;if(a.target===d.BgTarget.INTERNAL)switch(a.data.type){case d.BgInternalMsgType.INIT_MSG:e.info("[ExtensionConnHandler]: Received INIT_MSG. Send an INIT_MSG_ACK to the extension."),x=!0,j({target:d.BgTarget.INTERNAL,data:{type:d.BgInternalMsgType.INIT_MSG_ACK}}),e.info("[ExtensionConnHandler]: Dispatching event: extensionInitialized"),b=u.createEvent("extensionInitialized"),b.data=a.data,u.dispatch(b);break;case d.BgInternalMsgType.EXTENSION_DISCONNECTED:e.warning("[ExtensionConnHandler]: Received EXTENSION_DISCONNECTED from ansible-content"),l();break;default:e.warning("[ExtensionConnHandler]: Received unknown INTERNAL msg type from ansible-content:",a.data.type)}else if(a.target===d.BgTarget.HEADSET_APP)switch(a.data.type){case d.BgHeadsetAppMsgType.HEADSET_APP_LAUNCHED:e.info("[ExtensionConnHandler]: Dispatching event: headsetAppLaunched"),b=u.createEvent("headsetAppLaunched"),b.data=a.data,u.dispatch(b);break;case d.BgHeadsetAppMsgType.HEADSET_APP_UNINSTALLED:e.info("[ExtensionConnHandler]: Dispatching event: headsetAppUninstalled"),b=u.createEvent("headsetAppUninstalled"),b.data=a.data,u.dispatch(b);break;default:e.warning("[ExtensionConnHandler]: Received unknown HEADSET_APP msg type from ansible-content:",a.data.type)}else a.suppressLog||e.info("[ExtensionConnHandler]: Dispatching event:",a.target),b=u.createEvent(a.target),b.data=a.data,b.suppressLog=a.suppressLog,a.reqId&&a.type===d.BgMsgType.REQUEST&&(b.reqId=a.reqId),u.dispatch(b)}function i(a){if(v[a.reqId]){var b=v[a.reqId];b.timer&&window.clearTimeout(b.timer),delete v[a.reqId],a.data&&a.data.error?(b.cb(a.data.error),a.data.error===d.ResponseError.UNREGISTERED&&l()):b.cb(null,a.data),a.suppressLog||e.debug("[ExtensionConnHandler]: Remaining callbacks pending:",Object.keys(v).length)}else e.info("[ExtensionConnHandler]: No registered callback for reqId =",a.reqId)}function j(a,b,c,d){return a?u.isExtensionRunning()?k(a,b,c,d):(e.info("[ExtensionConnHandler]: Chrome extension is not running"),b&&window.setTimeout(function(){b("Extension not running")},0),!1):(e.error("[ExtensionConnHandler]: Cannot send message. Invalid message."),b&&window.setTimeout(function(){
b("Invalid message")},0),!1)}function k(b,f,g,h){if(b.type===d.BgMsgType.REQUEST&&(b.reqId=c(f,g)),h||e.msgSend("[ExtensionConnHandler]: ",b),b.suppressLog=h,a.isElectron&&b.type===d.BgMsgType.REQUEST&&b.target===d.BgTarget.EXCHANGE_CONNECTOR)return window.setTimeout(function(){p.onWebClientMsg(o,b,a.__server)},0),b.reqId;var i=new CustomEvent(d.DOMEvent.TO_EXTENSION,{detail:JSON.stringify(b)});try{document&&document.dispatchEvent(i)}catch(a){return e.warning("[ExtensionConnHandler]: Error sending message: "+i,a),!1}return b.reqId}function l(){e.warning("[ExtensionConnHandler]: The content script has unregistered itself. Chrome extension is no longer running."),x=!1,e.info("[ExtensionConnHandler]: Dispatching event: extensionUnregistered");var a=u.createEvent("extensionUnregistered");u.dispatch(a)}function m(a){if(a.target===d.BgTarget.LOG)return void e.logMsg(a.data.log.level,a.data.log.messages);switch(a.suppressLog||e.msgRcvd("[ExtensionConnHandler]: ",a),a.type){case d.BgMsgType.REQUEST:case d.BgMsgType.EVENT:h(a);break;case d.BgMsgType.RESPONSE:i(a);break;default:e.msgRcvd("[ExtensionConnHandler]: Unexpected message type: ",a.type)}}function n(a){if(a&&a.detail)try{var b=JSON.parse(a.detail);m(b)}catch(a){return void e.error("[ExtensionConnHandler]: Error parsing JSON object. ",a)}}b.parent.constructor.call(this,e);var o,p,q=5e3,r=65e3,s=18e4,t=18e4,u=this,v={},w=0,x=!1;if(a.isElectron){p=BgExchangeConnectorHandler.getInstance();var y=function(a){a.data&&a.data.keysToOmitFromLogging&&(a.keysToOmitFromLogging=a.data.keysToOmitFromLogging.map(function(a){return"data."+a}),delete a.data.keysToOmitFromLogging),m(a)};o=Object.create(e,{sendResponse:{value:function(a,b,c){var e={type:d.BgMsgType.RESPONSE,reqId:a,suppressLog:!!c,data:b};y(e)}},sendInternalEvent:{value:function(a){e.error("[ExtensionConnHandler]: Unexpected internal event: ",a)}},sendExchangeConnEvent:{value:function(a,b){var c={type:d.BgMsgType.EVENT,target:d.BgTarget.EXCHANGE_CONNECTOR,suppressLog:!!b,data:a};y(c)}}});var z="exchange";window.chrome={storage:{local:{set:function(a,b){window.localStorage.setItem(z,JSON.stringify(a,function(a,b){var c=b;return"string"==typeof a&&"$"===a.charAt(0)&&(c=void 0),c})),b&&b()},get:function(a,b){b(JSON.parse(window.localStorage.getItem(z)))}}},runtime:{},windows:{create:function(){}},permissions:{contains:function(a,b){b(!0)}}},setTimeout(function(){e.info("[ExtensionConnHandler]: Raise extensionInitialized"),x=!0;var a=u.createEvent("extensionInitialized");a.data={version:"electron"},u.dispatch(a)},1e3)}this.isExtensionRunning=function(){return x},this.getScreenShareUserMedia=function(a){j({target:d.BgTarget.SCREEN_SHARE,type:d.BgMsgType.REQUEST,data:{type:d.BgScreenShareMsgType.CHOOSE_DESKTOP_MEDIA}},a)},this.exchangeConnect=function(a,b){j({target:d.BgTarget.EXCHANGE_CONNECTOR,type:d.BgMsgType.REQUEST,data:{method:d.BgExchangeMsgType.CONNECT,object:{settings:a}},keysToOmitFromLogging:["data.object.settings.exchInfo"]},b,s)},this.exchangeDisconnect=function(a){j({target:d.BgTarget.EXCHANGE_CONNECTOR,type:d.BgMsgType.REQUEST,data:{method:d.BgExchangeMsgType.DISCONNECT,object:{}}},a,r)},this.exchangeGetConnectionStatus=function(a,b){j({target:d.BgTarget.EXCHANGE_CONNECTOR,type:d.BgMsgType.REQUEST,data:{key:a,method:d.BgExchangeMsgType.GET_CONNECTION_STATUS},keysToOmitFromLogging:["data.key"]},b,r)},this.exchangeGetCapabilities=function(a){j({target:d.BgTarget.EXCHANGE_CONNECTOR,type:d.BgMsgType.REQUEST,data:{method:d.BgExchangeMsgType.GET_CAPABILITIES}},a,r)},this.exchangeCancelReqCallback=function(a){return e.debug("[ExtensionConnHandler]: Unregistering callback for reqId:",a),g(a)},this.exchangeSearchContacts=function(a,b,c,e){return j({target:d.BgTarget.EXCHANGE_CONNECTOR,type:d.BgMsgType.REQUEST,data:{key:a,method:d.BgExchangeMsgType.SEARCH_CONTACTS,object:{searchString:b,resultCount:c}},keysToOmitFromLogging:["data.key"]},e,r)},this.exchangeResolveContact=function(a,b,c){j({target:d.BgTarget.EXCHANGE_CONNECTOR,type:d.BgMsgType.REQUEST,data:{key:a,method:d.BgExchangeMsgType.RESOLVE_CONTACT,object:b},keysToOmitFromLogging:["data.key"]},c,r)},this.exchangeGetContact=function(a,b,c){j({target:d.BgTarget.EXCHANGE_CONNECTOR,type:d.BgMsgType.REQUEST,data:{key:a,method:d.BgExchangeMsgType.GET_CONTACT,object:{email:b}},keysToOmitFromLogging:["data.key"]},c,r)},this.exchangeOnRenewedToken=function(a,b,c,e){j({target:d.BgTarget.EXCHANGE_CONNECTOR,type:d.BgMsgType.RESPONSE,data:{key:a,method:d.BgExchangeMsgType.ON_RENEWED_TOKEN,object:{reqId:b,token:c}},keysToOmitFromLogging:["data.key","data.object.token"]},e,r)},this.exchangeStoreCredentials=function(a,b){j({target:d.BgTarget.EXCHANGE_CONNECTOR,type:d.BgMsgType.REQUEST,data:{method:d.BgExchangeMsgType.STORE_EXCH_CREDENTIALS,object:a},keysToOmitFromLogging:["data.object"]},b,r)},this.getAllPersonalContacts=function(a,b){j({target:d.BgTarget.EXCHANGE_CONNECTOR,type:d.BgMsgType.REQUEST,data:{key:a,method:d.BgExchangeMsgType.GET_ALL_PERSONAL_CONTACTS},keysToOmitFromLogging:["data.key"]},b,r)},this.getAppointments=function(a,b,c,e,f){j({target:d.BgTarget.EXCHANGE_CONNECTOR,type:d.BgMsgType.REQUEST,data:{key:a,method:d.BgExchangeMsgType.GET_APPOINTMENTS,startDate:b,endDate:c,resCount:e},keysToOmitFromLogging:["data.key"]},f,r)},this.syncAllPersonalContacts=function(a,b,c){j({target:d.BgTarget.EXCHANGE_CONNECTOR,type:d.BgMsgType.REQUEST,data:{key:a,method:d.BgExchangeMsgType.SYNC_ALL_PERSONAL_CONTACTS,syncState:b},keysToOmitFromLogging:["data.key","data.syncState"]},c,r)},this.getStoredCredentials=function(a,b){j({target:d.BgTarget.EXCHANGE_CONNECTOR,type:d.BgMsgType.REQUEST,data:{key:a,method:d.BgExchangeMsgType.GET_STORED_CREDENTIALS},keysToOmitFromLogging:["data.key"]},b,r)},this.getHeadsetIntegrationAppStatus=function(a,b){j({target:d.BgTarget.HEADSET_APP,type:d.BgMsgType.REQUEST,data:{type:d.BgHeadsetAppMsgType.GET_HEADSET_APP_STATUS,appId:a}},b,q)},this.launchHeadsetIntegrationApp=function(a,b,c){j({target:d.BgTarget.HEADSET_APP,type:d.BgMsgType.REQUEST,data:{type:d.BgHeadsetAppMsgType.LAUNCH_HEADSET_APP,appId:a,localizedStrings:b}},c,t)},this.bringToFront=function(a){j({target:d.BgTarget.INTERNAL,type:d.BgMsgType.REQUEST,data:{type:d.BgInternalMsgType.BRING_TO_FRONT}},a)},f.getBrowserInfo().chrome&&document&&document.addEventListener(d.DOMEvent.FROM_EXTENSION,n)}var c=a.BaseEventTarget,d=a.ChromeExtension,e=a.logger,f=a.Utils;return f.inherit(b,c),b.prototype.name="ExtensionConnHandler",a.ExtensionConnHandler=b,a}(Circuit),Circuit=function(a){"use strict";return a.ExtensionConnHandlerSingleton=function(){var b;return{getInstance:function(){return b||(b=new a.ExtensionConnHandler),b}}}(),a}(Circuit),Circuit=function(a){"use strict";return a.Enums.CallStateName={},Object.getOwnPropertyNames(a.Enums.CallState).forEach(function(b){a.Enums.CallStateName[b]=b}),a.Enums.ConversationItemType=a.Constants.ConversationItemType,a.Enums.ConversationType={DIRECT:"DIRECT",GROUP:"GROUP",LARGE:"LARGE",COMMUNITY:"COMMUNITY"},a.Enums.PresenceState=a.Constants.PresenceState,a.Enums.RTCItemType=a.Constants.RTCItemType,a.Enums.RTCParticipantType=a.Constants.RTCParticipantType,a.Enums.SystemItemType=a.Constants.SystemItemType,a.Enums.TextItemContentType=a.Constants.TextItemContentType,a.Enums.UserType=a.Constants.UserType,a.Enums.UserState=a.Constants.UserState,a.Enums.SearchDirection=a.Constants.SearchDirection,a.Enums.ParticipantCriteria=a.Constants.GetConversationParticipantCriteria,a.Enums.ConversationParticipantType=a.Constants.ConversationParticipantType,a.Enums.RetrieveAction=a.Constants.RetrieveAction,a.Enums.RecordingInfoState=a.Constants.RecordingInfoState,a.Enums.RecordingInfoState=a.Constants.RecordingInfoState,a}(Circuit||{}),Circuit=function(a){"use strict";function b(b,d,e,f){function g(){return null}function h(){if(!b.localUser||!b.localUser.accounts||!b.localUser.accounts[0])return!1;var a=b.localUser,c=b.localUser.accounts[0],d=a.callerId;return c.telephonyConfiguration?(a.phoneNumber=c.telephonyConfiguration.phoneNumber||null,c.telephonyConfiguration.associatedTelephonyUserType===l.GtcTrunkType.ATC_TRUNK_TYPE?(a.callerId=c.telephonyConfiguration.phoneNumber,a.cstaNumber=o.cleanPhoneNumber(c.telephonyConfiguration.phoneNumber)):(a.callerId=c.telephonyConfiguration.callerId||a.phoneNumber||r,a.cstaNumber=null)):(a.phoneNumber=null,a.callerId=r,a.cstaNumber=null),d!==a.callerId}function i(){return new Promise(function(a,b){t.getTelephonyData(function(c,d){c?b(c):(s=d,r=s.defaultCallerId||null,a(d))})})}function j(){return new Promise(function(a,b){t.getTelephonyConversationId(function(c,d){c||!d?b("Telephony conversation not found"):p.getConversationById(d,null,function(c,d){c||!d?b(c||"Error retrieving telephony conversation"):(k=d,d.isTelephonyConv=!0,a(d))})})})}var k,l=a.Constants,m=a.Conversation,n=a.UserProfile,o=a.Utils,p=this,q={},r=null,s={},t=a.ClientApiHandlerSingleton.getInstance();return f.subscribe("/telephony/data",function(a){var c=!1;r!==a.defaultCallerId&&(r=a.defaultCallerId,o.updateTelephonyNumbers(b.localUser,a.defaultCallerId)&&(c=!0)),b.localUser.telephonyAvailable!==a.telephonyAvailableForUser&&(b.localUser.telephonyAvailable=a.telephonyAvailableForUser,c=!0),c&&f.publish("/localUser/update",[b.localUser])}),t.on("Account.TELEPHONY_CONFIGURATION_UPDATED",function(a){if(a.configuration&&b.localUser){var c=b.localUser.accounts&&b.localUser.accounts[0];c&&(c.telephonyConfiguration=a.configuration,p.telephonyConfigChanged(),f.publish("/localUser/update",[b.localUser]))}}),this.addConversationToCache=function(a){a&&a.convId&&(q[a.convId]=m.extend(a))},this.setLocalUser=function(a){a&&(b.localUser=a,h(),n.syncTelephonyConfig(a))},this.telephonyConfigChanged=function(){h(),n.syncTelephonyConfig(b.localUser)},this.getConversationPromise=function(a){return new Promise(function(b,c){if(!a)return void c();var d=q[a];d?b(d):p.getConversationById(a,null,function(a,d){a||!d?c("Conversation not found"):b(d)})})},this.getConversationById=function(a,b,c){"function"==typeof c&&t.getConversationById(a,function(a,b){var d=m.extend(b);d&&(q[b.convId]=d),c(a,d)})},this.getConversationByRtcSession=function(a){e.debug("[SdkHelperSvc]: getConversationByRtcSession - rtcSessionId = ",a);for(var b in q)if(q.hasOwnProperty(b)&&q[b].rtcSessionId===a)return q[b];return null},this.getConversationFromCache=function(a){return e.debug("[SdkHelperSvc]: getConversationFromCache - convId = ",a),q[a]||null},this.getConversationAsGuestById=function(){return null},this.getTelephonyConversation=function(a){if("function"==typeof a){if(k)return void window.setTimeout(function(){a(null,k)});i().then(h).then(j).then(function(b){a(null,b)}).catch(a)}},this.getTelephonyData=i,this.getTelephonyConversationPromise=function(){return k?Promise.resolve(k):j()},this.isConversationsLoadComplete=function(){return!!b.localUser},this.updateLastCallTime=function(){},this.sendQOSData=function(a,b,c){e.debug("[SdkHelperSvc]: sendQOSData - call stats: ",c)},this.getSetting=function(){return null},this.getUserIdleState=function(){return c.Active},this.isAutoSnoozeOn=!1,this.setPresenceWithLocation=function(){},this.cancelAutoSnooze=function(){},this.getUserFromCache=g,this.getUser=g,this.getUserById=function(a,b){b&&b(l.ReturnCode.NO_RESULT)},this.addUsersToCache=function(){},this.startReverseLookUp=function(a,b){b&&b(null)},this}var c=Object.freeze({Idle:"Idle",Active:"Active"});return a.Enums=a.Enums||{},a.Enums.IdleState=c,a.SdkHelperSvcImpl=b,a}(Circuit),Circuit=function(a){"use strict";function b(a,b,d){return d.debug("New Service: UtilSvc"),this.promisify=function(a,c){return function(){var d=Array.prototype.slice.call(arguments);return new b(function(b,e){d.push(function(a){if(a)return e(a);var c=Array.prototype.slice.call(arguments);switch(c.shift(),c.length){case 0:b();break;case 1:b(c[0]);break;default:b(c)}}),a.apply(c,d)})}},this.getFaqUrl=function(b){if(a.localUser&&a.localUser.helpUrl&&c.DEFAULT_HELP_URL!==a.localUser.helpUrl)return a.localUser.helpUrl;var d="https://www.circuit.com/unifyportalfaqdetail"+(b?"?articleId="+b:"");return d},this}var c=a.Utils,d={AGC:"89415",DEVICE_ACCESS:"48742",JABRA:"112718",LOGIN:"37428",MODERATION:"93154",PLANTRONICS:"115017",TELEPHONY:"103733"};return a.UtilSvcImpl=b,a.Enums=a.Enums||{},a.Enums.FaqArticle=d,a}(Circuit),Circuit=function(a){"use strict";function b(a){function b(b,c){try{c=void 0!==c&&null!==c?Array.isArray(c)?c:[c]:[],b.apply(null,c)}catch(b){a.error(b)}}function e(a,c,d){a[c]&&a[c].slice(0).forEach(function(a){b(a,d)})}function f(a,e){m[a]&&(e=void 0!==e&&null!==e?Array.isArray(e)?e:[e]:[],e=e.map(function(a){if(a&&"object"==typeof a){if(a.isConversationObject)return d.trimConvForMobile(a);if(a instanceof c)return d.trimCallForMobile(a)}return a}),m[a].slice(0).forEach(function(a){b(a,e)}))}function g(a,c){c=c?Array.prototype.slice.call(c):[],c.unshift(a),o.slice(0).forEach(function(a){b(a,c)})}function h(a,b,c){a[b]?a[b].includes(c)||a[b].push(c):a[b]=[c]}function i(a,b,c){if(a[b]){var d=a[b].indexOf(c);d>=0&&a[b].splice(d,1)}}function j(a){o.includes(a)||o.push(a)}function k(a){var b=o.indexOf(a);b>=0&&o.splice(b,1)}a.debug("New Service: PubSubSvc");var l={},m={},n={},o=[];return this.publish=function(b,c){(l[b]||m[b]||n[b]||o.length)&&(a.debug("[PubSubSvc]: Publishing "+b+" event"),e(l,b,c),f(b,c),e(n,b,c),g(b,c),delete n[b])},this.subscribe=function(a,b){h(l,a,b)},this.unsubscribe=function(a,b){i(l,a,b)},this.subscribeOnce=function(a,b){h(n,a,b)},this.unsubscribeOnce=function(a,b){i(n,a,b)},this.subscribeMobile=function(a,b){h(m,a,b)},this.unsubscribeMobile=function(a,b){i(m,a,b)},this.subscribeAll=function(a){j(a)},this.unsubscribeAll=function(a){k(a)},this.resetSubscriptions=function(){l={},m={},n={},o=[]},this}var c=a.BaseCall,d=a.Utils;return a.PubSubSvcImpl=b,a}(Circuit),Circuit=function(a){"use strict";function b(b,f,g,h,i,j,k){function l(){if(b.browser&&b.browser.chrome){if(D="https://chrome.google.com/webstore/detail/",b.siemensAGUser)return E=!1,D+="siemens-circuit-by-unify/mnkbplodbhpkiphfeldjmaoickanlanc",void i.info("[ExtensionSvc]: Set URL to Siemens AG Circuit extension webstore link");E=!0;var a=g.location.hostname;switch(a){case r:D+="jafbhekoolndfieffjkikfbmekjppnec",i.info("[ExtensionSvc]: Set URL to Beta-Circuit extension. ",D);break;case q:D+="ogdfpjnhdggplglemglldmioiblhkadm",i.info("[ExtensionSvc]: Set URL to Sandbox-Circuit extension. ",D);break;case t:D+="gdgfgnopapmocggkadgfkjekdlcohmdl",i.info("[ExtensionSvc]: Set URL to T&I-Circuit extension. ",D);break;case s:D+="mdgbjijndgkkllljdaoohenhhaenilam",i.info("[ExtensionSvc]: Set URL to T-Systems extension. ",D);break;case u:return E=!1,D+="universit%C3%A4t-heidelberg-ci/nnlgegdgijgicheaipembfeaggifmalb",void i.info("[ExtensionSvc]: Set URL to Heidelberg Univerity extension webstore link ",D);default:D+="mhkbaognlahkdimlfcfhbeihldmjofgg",i.info("[ExtensionSvc]: Set URL to Circuit extension. ",D)}}}function m(){b.isChromeExtRunning=z.isExtensionRunning(),l()}function n(a,c,d){return i.debug("[ExtensionSvc]: Invoke ExtensionConnHandler API: ",a),A?A.isExtensionRunning()?(d&&(c=c||[],c.push(function(a,c){b.$apply(function(){d(a,c)})})),A[a].apply(A,c)):(i.debug("[ExtensionSvc]: Chrome extension is not running"),void(d&&f(function(){d("Extension not running")},0))):(i.debug("[ExtensionSvc]: ExtensionConnHandler is not loaded"),void(d&&f(function(){d("No ExtensionConnHandler")},0)))}function o(){i.info("[ExtensionSvc]: Validate the installed extension version: ",B),B!==x&&(C=e.convertVersionToNumber(B)>=w,C||i.warn("[ExtensionSvc]: The installed extension version ("+B+") is not supported. Minimum version is "+v))}function p(a){return b.browser&&b.browser.chrome?F||G?(i.warn("[ExtensionSvc]: The first extension installation attempt failed. Redirect the user to web store page. Url: ",D),a&&k&&k.error({message:"res_ExtensionCannotBeInstalled",messageParams:[D]}),F?y.INSTALL_ALREADY_IN_PROGRESS:y.INSTALL_FAILED):C?null:(i.warn("[ExtensionSvc]: We are running an outdated extension:",B),a&&k&&k.error({message:"res_UnsupportedExtensionVersion"}),y.UNSUPPORTED_EXT_VERSION):y.UNSUPPORTED_BROWSER}i.debug("New Service: ExtensionSvc");var q="circuitsandbox.net",r="beta.circuit.com",s="de.circuit.com",t="tandi.circuitsandbox.net",u="circuit.uni-heidelberg.de",v="1.1.9000",w=e.convertVersionToNumber(v),x="electron",y=Object.freeze({UNSUPPORTED_BROWSER:"UNSUPPORTED_BROWSER",INSTALL_ALREADY_IN_PROGRESS:"INSTALL_ALREADY_IN_PROGRESS",UNSUPPORTED_EXT_VERSION:"UNSUPPORTED_EXT_VERSION",USER_CANCELLED_INSTALL:"USER_CANCELLED_INSTALL",INSTALL_FAILED:"INSTALL_FAILED",INTERNAL_ERROR:"INTERNAL_ERROR"}),z=this,A="object"==typeof c?c.getInstance():null,B="",C=!0,D="",E=!1,F=!1,G=!1;return d.injectExtensionSvc(this,A),A&&A.addEventListener("extensionInitialized",function(a){b.$apply(function(){B=a.data.version,o(),C&&(F=!1,b.isChromeExtRunning=!0,i.setExtensionVersion(B),i.debug("[ExtensionSvc]: Publish /chromeExt/initialized event"),j.publish("/chromeExt/initialized"))})}),A&&A.addEventListener("extensionUnregistered",function(){b.$apply(function(){b.isChromeExtRunning=!1,i.debug("[ExtensionSvc]: Publish /chromeExt/unregistered event"),j.publish("/chromeExt/unregistered")})}),A&&A.addEventListener("headsetAppLaunched",function(a){b.$apply(function(){var b=a.data&&a.data.data;i.debug("[ExtensionSvc]: Publish /chromeExt/headsetAppLaunched event: ",b),j.publish("/chromeExt/headsetAppLaunched",[b])})}),A&&A.addEventListener("headsetAppUninstalled",function(a){b.$apply(function(){var b=a.data&&a.data.data;i.debug("[ExtensionSvc]: Publish /chromeExt/headsetAppUninstalled event: ",b),j.publish("/chromeExt/headsetAppUninstalled",[b])})}),this.isExtensionRunning=function(){return A&&A.isExtensionRunning()&&C},this.getExtensionVersion=function(){return B},this.isExtensionVersionSupported=function(){return C},this.installExtension=function(a){return new h(function(b,c){if(z.isExtensionRunning())return void b();if(!k)return i.error("[ExtensionSvc]: installExtension API requires PopupSvc"),void c(y.INTERNAL_ERROR);var d=p(a);if(d)return void c(d);var e={message:"res_ActionInstallExtensionText",controller:"ChromeExtensionInstallDialogCtrl",title:"res_ActionInstallExtensionTitle",yesLabel:"res_ActionInstall",noLabel:"res_Close",backdrop:!0};k.confirm(e).result.then(b).catch(function(b){a&&b===y.INSTALL_FAILED&&(i.warn("[ExtensionSvc]: The extension installation failed. Redirect the user to web store page. Url: ",D),k.error({message:"res_ExtensionCannotBeInstalled",messageParams:[D]})),c(b||y.USER_CANCELLED_INSTALL)})})},this.inlineInstallation=function(a){return new h(function(c,d){try{var e=p(a);if(e)return void d(e);if(i.debug("[ExtensionSvc]: Extension URL = ",D),!E)return i.debug("[ExtensionSvc]: Extension does not support inline installation. Open store link."),g.open(D),void c();chrome.webstore.install(D,function(){b.$apply(function(){i.debug("[ExtensionSvc]: Circuit extension was successfully installed"),F=!0,c()})},function(c){i.error("[ExtensionSvc]: There was an error installing the Circuit extension. ",c),b.$apply(function(){"User cancelled install"!==c?(G=!0,a&&(i.warn("[ExtensionSvc]: The extension installation failed. Redirect the user to web store page. Url: ",D),k.error({message:"res_ExtensionCannotBeInstalled",messageParams:[D]})),d(y.INSTALL_FAILED)):d(y.USER_CANCELLED_INSTALL)})})}catch(a){i.error("[ExtensionSvc]: There was an exception installing the Circuit extension. ",a),G=!0,d(y.INSTALL_FAILED)}})},this.addEventListener=function(a,b){A&&A.addEventListener(a,b)},this.exchangeGetConnectionStatus=function(a,b){return n("exchangeGetConnectionStatus",[a],b)},this.exchangeConnect=function(a,b){return n("exchangeConnect",[a],b)},this.exchangeSearchContacts=function(a,b,c,d){return n("exchangeSearchContacts",[a,b,c],d)},this.exchangeGetCapabilities=function(a){return n("exchangeGetCapabilities",[],a)},this.exchangeResolveContact=function(a,b,c){return n("exchangeResolveContact",[a,b],c)},this.exchangeGetContact=function(a,b,c){return n("exchangeGetContact",[a,b],c)},this.exchangeDisconnect=function(a){return n("exchangeDisconnect",[],a)},this.exchangeOnRenewedToken=function(a,b,c,d){return n("exchangeOnRenewedToken",[a,b,c],d)},this.storeExchCredentials=function(a,b){return n("exchangeStoreCredentials",[a],b)},this.getStoredCredentials=function(a,b){return n("getStoredCredentials",[a],b)},this.getAllPersonalContacts=function(a,b){return n("getAllPersonalContacts",[a],b)},this.syncAllPersonalContacts=function(a,b,c){return n("syncAllPersonalContacts",[a,b],c)},this.exchangeCancelReqCallback=function(a){return n("exchangeCancelReqCallback",[a])},this.getAppointments=function(a,b,c,d,e){return n("getAppointments",[a,b,c,d],e)},this.supportsGetAppointments=function(){return!!z.isExtensionRunning()||!(!b.browser||!b.browser.chrome)},this.supportsExchangeAutodiscover=function(){return z.isExtensionRunning()},this.supportsExchangeAutodiscoverSvc=function(){return z.isExtensionRunning()},this.launchHeadsetIntegrationApp=function(a,b,c){return n("launchHeadsetIntegrationApp",[a,b],c)},this.getHeadsetIntegrationAppStatus=function(a,b){return n("getHeadsetIntegrationAppStatus",[a],b)},this.bringToFront=function(b){if(!a.isElectron)return n("bringToFront",[],b);var c=require("electron").ipcRenderer;c.send("focus-window")},m(),this}var c=a.ExtensionConnHandlerSingleton,d=a.ScreenSharingController,e=a.Utils;return a.ExtensionSvcImpl=b,a}(Circuit),Circuit=function(a){"use strict";function b(b,m,n,o,p){function q(a){a!==H&&(H=a,n.info("[AtcRegistrationSvc]: Publish /atcRegistration/state event. State =",a),o.publish("/atcRegistration/state",[a]),b.localUser.isATC&&a!==e.Registering&&y(N))}function r(a){return a.state!==g.TrunkState.DOWN&&J!==g.TrunkState.DOWN}function s(){var a=!!b.localUser.telephonyAvailable,c=!!b.localUser.callerId||!!b.localUser.phoneNumber;return a!==c}function t(a){a!==g.ReturnCode.FAILED_TO_SEND&&a!==g.ReturnCode.REQUEST_TIMEOUT&&503!==a.code&&408!==a.code||(M=m(function(){M=null,u()},D)),q(e.Unregistered)}function u(){var a={content:{type:"REGISTER",phoneNumber:b.localUser.cstaNumber,reroutingPhoneNumber:l.cleanPhoneNumber(b.localUser.reroutingPhoneNumber),onsHash:b.localUser.onsSipAuthenticationHash||void 0,ondHash:b.localUser.ondSipAuthenticationHash||void 0,routeToDesk:b.localUser.selectedRoutingOption===j.DeskPhone.name,tcPool:b.localUser.associatedTelephonyTrunkGroupId,pbxCallLog:!0,deviceType:R},destUserId:b.localUser.associatedTelephonyUserID,keysToOmitFromLogging:["content.onsHash","content.ondHash"]};m.cancel(M),M=null,G.phoneNumber=b.localUser.cstaNumber,G.associatedTelephonyUserID=b.localUser.associatedTelephonyUserID,G.associatedTelephonyTrunkGroupId=b.localUser.associatedTelephonyTrunkGroupId,G.reroutingPhoneNumber=l.cleanPhoneNumber(b.localUser.reroutingPhoneNumber),G.onsSipAuthenticationHash=b.localUser.onsSipAuthenticationHash,G.ondSipAuthenticationHash=b.localUser.ondSipAuthenticationHash,Q=b.localUser.selectedRoutingOption,b.localUser.noCallLog=!1,q(e.Registering),n.info("[AtcRegistrationSvc]: Registering with ATC, phoneNumber: "+G.phoneNumber+", associatedTelephonyUserID: "+G.associatedTelephonyUserID),F.sendAtcRequest(a,function(a,c){b.$apply(function(){return I&&!O.call?(n.info("[AtcRegistrationSvc]: There was a configuration update while registering. Need to register again"),I=!1,void(a||!c||c.err?u():(P=!0,v()))):a||c&&c.err?(a=a||c.err,n.error("[AtcRegistrationSvc]: Register with ATC failed with error: ",a),void t(a)):void(c&&c.configurationData?(n.info("[AtcRegistrationSvc]: Received ATC configuration data: ",c.configurationData),G.configurationData=c.configurationData,G.reroutingPhoneNumber=c.configurationData.cell,G.capabilities=c.capabilities,b.localUser.reroutingPhoneNumber=i.format(c.configurationData.cell),b.localUser.vmNumber=c.configurationData.vm,b.localUser.isOSV=c.configurationData.pbx&&"OSV"===c.configurationData.pbx,b.localUser.PBXCallLogSupported=G.capabilities&&G.capabilities.includes(g.AtcCapabilities.PBX_CALL_LOG),q(e.Registered),b.localUser.PBXCallLogSupported&&!b.localUser.noCallLog&&C(!0),n.debug("[AtcRegistrationSvc]: Registration refresh will be handled by access server")):q(e.Unregistered))})})}function v(){if(n.info("[AtcRegistrationSvc]: Unregister with ATC"),H===e.Unregistered||H===e.Disconnected)return void n.debug("[AtcRegistrationSvc]: The client is not registered with ATC");var a={content:{type:"UNREGISTER",phoneNumber:G.phoneNumber},destUserId:G.associatedTelephonyUserID};q(e.Unregistered),G.associatedTelephonyUserID="",F.sendAtcRequest(a,function(a){b.$apply(function(){a?n.error("[AtcRegistrationSvc]: Unregister with ATC failed with: ",a):n.info("[AtcRegistrationSvc]: Unregistered successfully with ATC"),P&&(u(),P=!1)})})}function w(a){a!==J&&b.$apply(function(){J=a,n.debug("[AtcRegistrationSvc]: Set trunk state to ",J);var b=l.shallowCopy(N);b.state=a,x(b)})}function x(a){if(a){if(b.localUser.isATC)if(a.state===g.TrunkState.DOWN)v();else if(N.state===g.TrunkState.DOWN&&a.state===g.TrunkState.UP)return N=a,H===e.Registering?(n.debug("[AtcRegistrationSvc]: Client is registering and configuration has changed. Wait..."),void(I=!0)):void u();y(a)}}function y(a){a&&(N=a,b.localUser.isATC?(N.state=H===e.Registered?g.TrunkState.UP:g.TrunkState.DOWN,N.defaultCallerId=null,N.isGTCEnabled=!0):N.defaultCallerId=N.defaultCallerId||null,N.telephonyAvailableForTenant=!!a.isGTCEnabled,N.telephonyAvailableForUser=!(!a.isGTCEnabled||!b.localUser.callerId&&!N.defaultCallerId),N.conferenceDialOutAvailable=N.telephonyAvailableForTenant&&r(N),N.phoneCallsAvailable=N.telephonyAvailableForUser&&r(N),n.info("[AtcRegistrationSvc]: Publish /telephony/data event. data = ",N),o.publish("/telephony/data",[N]),N.state!==g.TrunkState.DOWN&&N.state!==g.TrunkState.UP||p.getTelephonyConversationPromise().then(function(a){a&&(r(N)?a.avatar=h.TELEPHONY:a.avatar=h.TELEPHONY_DISABLED,O=a)}).catch(function(){n.debug("[AtcRegistrationSvc]: No telephony conversation found")}))}function z(a){n.info("[AtcRegistrationSvc]: Getting telephony data"),b.telephonyEnabled?E.getTelephonyData(function(c,d){b.$apply(function(){c?c!==g.ReturnCode.NO_RESULT&&(n.error("[AtcRegistrationSvc]: Error getting telephony data: ",c),a&&a(c)):(x(d),a&&a(null,N))})}):(y({state:g.TrunkState.DOWN}),a&&a(null,N))}function A(a){if(K&&K!==b.localUser.associatedTelephonyUserID&&(L[K]||E.unsubscribePresence([K]),K=null),b.localUser.associatedTelephonyUserID&&K!==b.localUser.associatedTelephonyUserID&&(K=b.localUser.associatedTelephonyUserID,b.localUser.isATC&&L[K]||E.subscribePresence([b.localUser.associatedTelephonyUserID],function(a,c){if(a)return n.error("[AtcRegistrationSvc]: Unable to subscribe to associated TC presence"),void(K=null);if(c&&c.length>0&&!b.localUser.isATC){var d=c[0].state===g.PresenceState.AVAILABLE?g.TrunkState.UP:g.TrunkState.DOWN;w(d)}})),!b.localUser.isATC||!b.localUser.cstaNumber)return H===e.Registered?(n.debug("[AtcRegistrationSvc]: Cannot register without an associated ATC or assigned phoneNumber"),v(),z()):(a||s())&&z(),void q(e.Disconnected);if(b.localUser.associatedTelephonyUserID===G.associatedTelephonyUserID&&b.localUser.cstaNumber===G.phoneNumber&&l.cleanPhoneNumber(b.localUser.reroutingPhoneNumber)===G.reroutingPhoneNumber&&b.localUser.onsSipAuthenticationHash===G.onsSipAuthenticationHash&&b.localUser.ondSipAuthenticationHash===G.ondSipAuthenticationHash&&(H===e.Registered||H===e.Registering))return void n.debug("[AtcRegistrationSvc]: Client is already registered or registering with ATC and the associatedTelephonyUserID is the same");if(H===e.Registering)return n.debug("[AtcRegistrationSvc]: Client is registering and configuration has changed. Wait..."),void(I=!0);if(H===e.Registered){if(n.debug("[AtcRegistrationSvc]: Client is already registered and configuration has changed."),O.call)return n.debug("[AtcRegistrationSvc]: There is an active telephony call, wait..."),void(I=!0);P=!0,v()}if(!P){if(!O)return n.debug("[AtcRegistrationSvc]: Get telephony conversation before proceeding with ATC register"),p.getTelephonyConversationPromise().then(function(a){O=a,n.debug("[AtcRegistrationSvc]: Got telephony conversation. Proceed with ATC register."),A()}),void(!a&&s()&&z());u()}}function B(){if(H===e.Registered){var a=b.localUser.selectedRoutingOption===j.DeskPhone.name;n.debug("[AtcRegistrationSvc]: Send SET_ROUTE_TO_DESK event to ATC. status = ");var f={content:{type:d.INFO,phoneNumber:b.localUser.cstaNumber,info:{type:c.SET_ROUTE_TO_DESK,status:a}},destUserId:b.localUser.associatedTelephonyUserID};F.sendAtcRequest(f)}}function C(a){var e={content:{type:d.INFO,phoneNumber:b.localUser.cstaNumber,info:{type:c.ENABLE_PBX_CALL_LOG,status:a}},destUserId:b.localUser.associatedTelephonyUserID};F.sendAtcRequest(e)}n.debug("New Service: AtcRegistrationSvc");var D=1e4,E=f.getInstance(),F=k.getInstance(),G={},H=e.Disconnected,I=!1,J=null,K=null,L={},M=null,N={state:g.TrunkState.DOWN},O=null,P=!1,Q=null,R=l.isMobile()?g.DeviceType.MOBILE:a.isElectron?g.DeviceType.APPLICATION:g.DeviceType.WEB;return o.subscribe("/localUser/update",function(){p.isConversationsLoadComplete()&&(n.debug("[AtcRegistrationSvc]: Received /localUser/update event"),A())}),o.subscribe("/conversations/loadComplete",function(){n.debug("[AtcRegistrationSvc]: Received /conversations/loadComplete event"),A(!0)}),o.subscribe("/registration/state",function(a){p.isConversationsLoadComplete()&&(n.debug("[AtcRegistrationSvc]: Received /registration/state event"),a!==RegistrationState.LoggingOut&&a!==RegistrationState.Reconnecting&&a!==RegistrationState.Disconnected||(m.cancel(M),M=null,m(b.localUser.isATC?v:function(){N.state=g.TrunkState.DOWN,K=null,y(N)})))}),o.subscribe("/conversation/update",function(a){if(a.isTelephonyConv){if(n.debug("[AtcRegistrationSvc]: Received /conversation/update event"),O=a,!I)return;a.call?n.debug("[AtcRegistrationSvc]: There is still an active telephony call, wait..."):H!==e.Registering&&(I=!1,P=!0,v())}}),o.subscribe("/user/settings/update",function(){p.isConversationsLoadComplete()&&(n.debug("[AtcRegistrationSvc]: Received /user/settings/update event"),Q!==b.localUser.selectedRoutingOption&&(Q=b.localUser.selectedRoutingOption,B()))}),E.on("User.TELEPHONY_DATA",function(a){b.$apply(function(){try{n.debug("[AtcRegistrationSvc]: Received User.TELEPHONY_DATA with data: ",a.data),a.data&&(a.data.isGTCEnabled=!0,x(a.data))}catch(a){n.error("[AtcRegistrationSvc]: Exception handling User.TELEPHONY_DATA event.",a)}})}),E.on("User.USER_PRESENCE_CHANGE",function(a){if(a.userId){if(a.userId===K){n.debug("[AtcRegistrationSvc]: Received User.USER_PRESENCE_CHANGE for associated TC. newState = ",a.newState);var b=a.newState.state===g.PresenceState.AVAILABLE?g.TrunkState.UP:g.TrunkState.DOWN;w(b)}L[a.userId]&&(n.info("[AtcRegistrationSvc]: Publish /trunk/update event. newState = ",a.newState),o.publish("/trunk/update",[a.newState]))}}),E.on("User.ATC_REFRESH_FAILED",function(){n.error("[AtcRegistrationSvc]: Received User.ATC_REFRESH_FAILED event."),H===e.Registered?O.call&&!O.call.isRemote?n.info("[AtcRegistrationSvc]: There is an active telephony call, ignoring ATC re-register for now. If error persists on server another event will come later."):b.$apply(function(){n.info("[AtcRegistrationSvc]: New registration must be triggered."),P=!0,v()}):n.info("[AtcRegistrationSvc]: Client is not registered, ignoring failed refresh on server.")}),F.on("ATC.INFO",function(a){n.debug("[AtcRegistrationSvc]: Received ATC.INFO with data = ",a),a.hasOwnProperty("pbxCallLogStatus")&&(b.localUser.noCallLog=!!a.pbxCallLogStatus)}),F.on("ATC.START_REASSIGNMENT",function(){n.debug("[AtcRegistrationSvc]: Received ATC.START_REASSIGNMENT event"),E.renewAssociatedTelephonyUser(b.localUser.associatedTelephonyUserID,function(a){a&&n.error("[AtcRegistrationSvc]: Failed to reassign telephony user. ",a)})}),this.initAtcForSdk=function(){n.debug("[AtcRegistrationSvc]: initAtcForSdk"),R=g.DeviceType.SDK,
A(!0)},this.atcState=function(){return H},this.getAtcRegistrationData=function(){return G.configurationData},this.atcUnregister=v,this.getTelephonyData=function(a){return a=a||function(){},H===e.Registering?void a("ATC Registering"):l.isEmptyObject(N)?void z(a):void a(null,N)},this.isExtendedAlertingSupported=function(){return!(!G||!G.capabilities)&&G.capabilities.includes(g.AtcCapabilities.EXTENDED_ALERTING)},this.isClearConnectionBusySupported=function(){if(G&&G.capabilities)return G.capabilities.includes(g.AtcCapabilities.CLEAR_CONNECTION_BUSY)},this.subscribeConnectorPresence=function(a,b){a=a.filter(function(a){return!L[a]}),a.length&&(n.debug("[AtcRegistrationSvc]: Subscribe for connectors presence. ",a),E.subscribePresence(a,function(a,c){a?(n.error("[AtcRegistrationSvc]: Failed to subscribe to connectors presence. ",a),b&&b(a)):c&&(n.debug("[AtcRegistrationSvc]: Successfully subscribed for connectors presence"),c.forEach(function(a){L[a.userId]=!0}),b&&b(null,c))}))},this.unsubscribeConnectorPresence=function(a,b){a?a=a.filter(function(a){if(L[a])return delete L[a],a!==K}):(a=Object.keys(L).filter(function(a){return a!==K}),L={}),a.length&&(n.debug("[AtcRegistrationSvc]: Unsubscribe for connectors presence. ",a),E.unsubscribePresence(a,b))},this.isPBXCallLogSupported=function(){return!(!G||!G.capabilities)&&G.capabilities.includes(g.AtcCapabilities.PBX_CALL_LOG)},this}var c=a.Enums.AtcInfoMessage,d=a.Enums.AtcMessage,e=a.Enums.AtcRegistrationState,f=a.ClientApiHandlerSingleton,g=a.Constants,h=a.DefaultAvatars,i=a.PhoneNumberFormatter,j=a.RoutingOptions,k=a.UserToUserHandlerSingleton,l=a.Utils;return a.AtcRegistrationSvcImpl=b,a}(Circuit),Circuit=function(a){"use strict";function b(a,b,f,g,h){function i(a){a&&a.joinDelayTimer&&(b.cancel(a.joinDelayTimer),a.joinDelayTimer=null)}function j(a){if(a&&!a.isRemote){if(!v.isDeviceDiagnosticsSupported())return void f.debug("[DeviceDiagnosticSvc]: Cannot start diagnostics collection. Not supported by backend.");f.info("[DeviceDiagnosticSvc]: Start diagnostics collection for callId = ",a.callId),a.deviceDiagnostics=a.deviceDiagnostics||{data:{actionInfo:[]}}}}function k(a){if(a&&a.deviceDiagnostics){f.debug("[DeviceDiagnosticSvc]: Start join delay timer for callId = ",a.callId);var c=a.deviceDiagnostics;i(c),c.joinDelayTimer=b(function(){c.joinDelayTimer=null,p(a)},u),c.joinDelayed=!1,c.waitingToSend=!1,c.iceGatheringFinished=!1,a.deviceDiagnostics=c}}function l(a,b){if(f.debug("[DeviceDiagnosticSvc]: Create action info ",b),a&&a.deviceDiagnostics&&b){var c={actionType:b};switch(b){case d.RtcDiagnosticsAction.SDP_ANSWER:case d.RtcDiagnosticsAction.SDP_CONNECTED:case d.RtcDiagnosticsAction.REMOTE_ICE_CANDIDATES:c.type=d.RtcActionInfoType.EVENT,c.timestampEvent=Date.now();break;default:c.type=d.RtcActionInfoType.REQUEST_RESPONSE,c.timestampRequest=Date.now()}return a.deviceDiagnostics.data.actionInfo.push(c),c}}function m(a){if(!a||!a.deviceDiagnostics)return!1;var b=a.deviceDiagnostics.data.actionInfo.some(function(a){return!a.complete});return b||!a.deviceDiagnostics.iceGatheringFinished}function n(a,b){b&&(f.debug("[DeviceDiagnosticSvc]: Finish action info ",b.actionType),b.complete=!0,b.type===d.RtcActionInfoType.REQUEST_RESPONSE&&(b.timestampResponse=Date.now()),a&&a.deviceDiagnostics&&(b.isEndOfCandidates&&(a.deviceDiagnostics.iceGatheringFinished=!0,f.debug("[DeviceDiagnosticSvc]: Ice gathering finished")),a.deviceDiagnostics.waitingToSend&&!m(a)&&o(a)))}function o(a){if(a&&a.deviceDiagnostics){f.debug("[DeviceDiagnosticSvc]: Force finish device diagnostics");var b=a.deviceDiagnostics;i(b),b.joinDelayed&&s(a),r(a)}}function p(a){if(a&&a.deviceDiagnostics){var b=a.deviceDiagnostics;if(f.debug("[DeviceDiagnosticSvc]: Join action delayed, preparing device diagnostics"),i(b),b.joinDelayed=!0,"undefined"!=typeof DeviceStatistics){var c=DeviceStatistics.getStatistics();f.info("[DeviceDiagnosticSvc]: Received native device diagnostics: ",c),b.data.usedRAMApp=c.usedRAMApp,b.data.availableRAMApp=c.availableRAMApp,b.data.usedRAMDevice=c.usedRAMDevice,b.data.availableRAMDevice=c.availableRAMDevice,b.data.virtualMemory=c.virtualMemory,b.data.usagePerCore=c.usagePerCore,b.data.numberOfCores=c.numberOfCores,b.data.networkType=c.networkType}}}function q(a){if(a&&a.deviceDiagnostics){f.debug("[DeviceDiagnosticSvc]: Finish device diagnostics");var b=a.deviceDiagnostics;i(b),b.joinDelayed?m(a)?(b.waitingToSend=!0,f.debug("[DeviceDiagnosticSvc]: Send device diagnostic delayed")):s(a):r(a)}}function r(a){a&&a.deviceDiagnostics&&(f.debug("[DeviceDiagnosticSvc]: Clear device diagnostics"),i(a.deviceDiagnostics),delete a.deviceDiagnostics)}function s(b){if(!b||!b.deviceDiagnostics)return void f.debug("[DeviceDiagnosticSvc]: sendDeviceDiagnostics - Nothing to send");var c={userId:a.localUser.userId,convId:b.convId,clientInfoType:d.RtcClientInfoType.DEVICE_DIAGNOSTICS,reason:d.RtcClientInfoReason.JOIN_DELAY,timestamp:Date.now(),sessionId:b.callId,deviceDiagnostics:e.shallowCopy(b.deviceDiagnostics.data)};b&&b.instanceId&&(c.instanceId=b.instanceId),r(b),f.debug("[DeviceDiagnosticSvc]: Sending device diagnostics..."),v.sendClientInfo([c],function(a){a&&(f.debug("[DeviceDiagnosticSvc]: Failed to send device diagnostics. ",a),t(c))})}function t(b){if(h&&!a.isSessionGuest){var c=h.getObjectSync(h.keys.RTC_CLIENT_INFOS)||[];c.push(b),h.setObjectSync(h.keys.RTC_CLIENT_INFOS,c)}}f.debug("New Service: DeviceDiagnosticSvc");var u=3e3,v=c.getInstance();return this.startDiagnostics=j,this.startJoinDelayTimer=k,this.createActionInfo=l,this.finishActionInfo=n,this.finishDeviceDiagnostics=q,this.forceFinishDeviceDiagnostics=o,this}var c=a.ClientApiHandlerSingleton,d=a.Constants,e=a.Utils;return a.DeviceDiagnosticSvcImpl=b,a}(Circuit),Circuit=function(a){"use strict";function b(b,r,s,t,u,v,w,x,y,z,A,B,C){function D(a){return z.getConversationAsGuestById(a)||z.getConversationFromCache(a)}function E(){if(Kb){var a=1e3*(Kb.ttl||0);a=Math.max(a-qb,0),Kb.expirationTimestamp=Date.now()+a}}function F(a){return new u(function(c,d){var e=Kb&&Kb.expirationTimestamp||0;if(Date.now()<e){var g=new Date(e);return v.debug("[CircuitCallControlSvc]: Existing credentials are still valid. Expiration: "+g),void c(Kb)}v.debug("[CircuitCallControlSvc]: Get new TURN credentials");var h=C.createActionInfo(a,f.RtcDiagnosticsAction.RENEW_TURN_CREDENTIALS);ub.renewTurnCredentials(a.callId,function(e,f){b.$apply(function(){return h&&(h.data=JSON.stringify(f),C.finishActionInfo(a,h)),e?(v.error("[CircuitCallControlSvc]: Error renewing TURN credentials.",e),void d(e)):f&&f.length?(f=f[0],v.info("[CircuitCallControlSvc]: Received new TURN credentials=",f.turnServer),Kb=f,E(),void c(Kb)):(v.error("[CircuitCallControlSvc]: Error renewing TURN credentials. No server(s) available."),void d("No TURN server(s) available"))})})})}function G(a,c,d){return new u(function(e,g){var h={convId:a.convId,rtcSessionId:c.callId,ownerId:a.creatorId,mediaNode:c.getMediaNode(),isTelephonyConversation:a.isTelephonyConv,replaces:d.replaces&&d.replaces.callId};C.startDiagnostics(c),C.startJoinDelayTimer(c);var i=C.createActionInfo(c,f.RtcDiagnosticsAction.PREPARE);ub.prepareSession(h,function(a,d,h){b.$apply(function(){return i&&(i.data=a?a.toString():JSON.stringify(d),C.finishActionInfo(c,i)),a?(a===f.ErrorCode.RTC_CONCURRENT_INCOMING_CALL?v.debug("[CircuitCallControlSvc]: Concurrent incoming call, aborting own attempt."):a===f.ErrorCode.RTC_NO_MEDIA_NODES_AVAILABLE?v.error("[CircuitCallControlSvc]: No media nodes available, call not possible."):a===f.ErrorCode.RTC_MEDIA_NODE_UNREACHABLE?v.error("[CircuitCallControlSvc]: Specified media node is not reachable, call not possible."):v.error("[CircuitCallControlSvc]: Error retrieving start session data.",a),void g(a)):d&&d.length?(v.info("[CircuitCallControlSvc]: Received new TURN credentials"),d=d[0],Kb=d,E(),h&&c.setCallIdForTelephony(h),void e(Kb)):(v.error("[CircuitCallControlSvc]: Error getting TURN credentials. No server(s) available."),void g("No TURN server(s) available"))})})})}function H(a){if(a){if(a.startsWith("res_"))return a;if(a===f.ErrorCode.PERMISSION_DENIED)return"res_JoinRTCSessionFailedPermission";if(a===f.SdpFailedCause.JOIN_FORBIDDEN)return"res_JoinRTCSessionFailedForbidden";if(a===f.ErrorCode.RTC_NO_MEDIA_NODES_AVAILABLE)return"res_JoinRTCSessionFailedMissingResources";if(a===f.ReturnCode.CHOOSE_DESKTOP_MEDIA_CANCELLED)return a;if(a===f.ReturnCode.DISCONNECTED||a===f.ReturnCode.FAILED_TO_SEND)return"res_NotConnectedTryAgain"}return"res_JoinRTCSessionFailed"}function I(){if(p.randomBoolean()){var a=xb.participants.filter(function(a){return a.pcState===g.ParticipantState.Active});if(!(a.length<2)){a.push(b.localUser);var c={sessionId:xb.callId},d=["first","second","third"],e=p.randomNumber(0,3),f=a.randomCopy(e);f.indexOf(a[0])===-1&&p.randomBoolean()&&(f.unshift(a[0]),e<3&&e++);for(var h=0;h<e;h++)c[d[h]]=f[h].userId;if(v.debug("[CircuitCallControlSvc]: Firing mocked ACTIVE_SPEAKER event: ",c),Ra(c),!(xb.sessionCtrl.getNumberOfExtraVideoChannels()>0||xb.hasRemoteScreenShare())){var i=f[0];i&&i.userId!==b.localUser.userId&&i.mediaType.video&&!i.streamId&&Sa({sessionId:xb.callId,userId:i.userId,videoStreamId:"mock"})}}}}function J(){return xb&&xb.isMocked&&!xb.isDirect&&xb.participants.length>1}function K(){!Fb&&J()&&(Fb=s(function(){v.debug("[CircuitCallControlSvc]: Active speaker simulation interval has fired"),J()?xb.isEstablished()&&I():(v.debug("[CircuitCallControlSvc]: Active speaker simulation is no longer needed. Stop interval."),s.cancel(Fb),Fb=null)},2e3,0,!1))}function L(a,b){if(!a.checkState(g.CallState.Ringing)||(Eb.push(a),!b)){for(var c=0;c<wb.length;c++)if(a.sameAs(wb[c]))return v.debug("[CircuitCallControlSvc]: Updating call with callId = "+a.callId),void(wb[c]=a);wb.push(a),a===xb&&K(),Ab=null}}function M(a){var b;for(b=0;b<wb.length;b++)if(a.sameAs(wb[b])){wb.splice(b,1);break}for(b=0;b<Eb.length;b++)if(a.sameAs(Eb[b])&&!a.isHandoverInProgress){Eb.splice(b,1);break}for(b=0;b<zb.length;b++)if(a.sameAs(zb[b])){zb.splice(b,1);break}a.isRemote?Ab=null:(Ab=a,Bb=a.sessionCtrl&&a.sessionCtrl.isMuted())}function N(a){a&&(v.debug("[CircuitCallControlSvc]: Publish /conversation/update event. convId = ",a.convId),w.publish("/conversation/update",[a]))}function O(a){a&&a.state!==g.CallState.Terminated&&(v.debug("[CircuitCallControlSvc]: Publish /call/state event. callId = "+a.callId+", state = "+a.state.name),w.publish("/call/state",[a]))}function P(a){if(xb&&xb.sameAs(a)){var b=tb.getIncomingCall();return!!(b&&b.replaces&&b.replaces.sameAs(a))}return!!(xb&&xb.replaces&&xb.replaces.sameAs(a))}function Q(a){switch(a){case g.CallClientTerminatedReason.DISCONNECTED:case g.CallClientTerminatedReason.FAILED_TO_SEND:case g.CallClientTerminatedReason.REQUEST_TIMEOUT:return!0;default:return!1}}function R(a,c,d){v.info("[CircuitCallControlSvc]: Terminating call...");var e=P(a);db(a),a.isRemote||(c&&(a.terminateReason=c,Q(c)&&S(a)),C.forceFinishDeviceDiagnostics(a)),Ba(a),M(a),a.terminate(),b.closePopoutCallStage&&b.closePopoutCallStage(a),xb&&xb.sameAs(a)?(r.cancel(xb.terminateTimer),xb=yb,yb=null):yb&&yb.sameAs(a)&&(r.cancel(yb.terminateTimer),yb=null);var f=D(a.convId);if(f&&f.call&&f.call.sameAs(a)&&!a.isHandoverInProgress){if(a.isTelephonyCall){var g=X()||Y();f.call=g||null}else f.call=null;z.updateLastCallTime(f),N(f)}Fb&&!xb&&(s.cancel(Fb),Fb=null),d||(v.debug("[CircuitCallControlSvc]: Publish /call/ended event. Replaced=",e),w.publish("/call/ended",[a,e]))}function S(a){if(a&&x){var c="";switch(a.terminateReason){case g.CallClientTerminatedReason.DISCONNECTED:c=f.RtcClientInfoReason.DISCONNECTED;break;case g.CallClientTerminatedReason.FAILED_TO_SEND:c=f.RtcClientInfoReason.FAILED_TO_SEND;break;case g.CallClientTerminatedReason.REQUEST_TIMEOUT:c=f.RtcClientInfoReason.REQUEST_TIMEOUT;break;default:return}var d={userId:b.localUser.userId,convId:a.convId,clientInfoType:f.RtcClientInfoType.OFFLINE_JOIN_FAILURE,reason:c,timestamp:Date.now(),sessionId:a.callId},e=z.getConversationByRtcSession(a.callId);e&&e.call&&e.call.instanceId&&(d.instanceId=e.call.instanceId),v.info("[CircuitCallControlSvc]: Store new offline join failure. ",d);var h=x.getObjectSync(x.keys.RTC_CLIENT_INFOS)||[];h.push(d),x.setObjectSync(x.keys.RTC_CLIENT_INFOS,h)}}function T(){var a=x.getObjectSync(x.keys.RTC_CLIENT_INFOS)||[];a.length>0&&(v.debug("[CircuitCallControlSvc]: Send offline join failures to backend"),ub.sendClientInfo(a,function(a){return a?void v.debug("[CircuitCallControlSvc]: Failed to send offline join failures. ",a):(v.debug("[CircuitCallControlSvc]: Sent offline join failures"),void x.removeItem(x.keys.RTC_CLIENT_INFOS))}))}function U(a){return xb&&xb.callId===a?xb:yb&&yb.callId===a?yb:null}function V(a){var b;for(b=0;b<wb.length;b++)if(wb[b].callId===a)return wb[b];for(b=0;b<Eb.length;b++)if(Eb[b].callId===a)return Eb[b];var c=z.getConversationByRtcSession(a);return c&&c.call&&!c.call.isAtcRemote&&c.call.state.established&&c.call.callId===a?(wb.push(c.call),c.call):U(a)}function W(a,b){if(a.participantType===f.RTCParticipantType.TELEPHONY&&a.phoneNumber){var c=xb.getParticipant(a.userId);if(c&&c.phoneNumber&&c.phoneNumber===a.phoneNumber)return;y.startReverseLookUp(a.phoneNumber,function(c){if(b.isPresent()&&c){var d=xb.getParticipant(a.userId);d&&(d.firstName=c.firstName,d.lastName=c.lastName,d.resolvedUserId=c.userId,wa(b,d))}})}}function X(a){return wb.find(function(b){return b.isTelephonyCall&&b.state.established&&!b.isHolding()&&(!a||!b.isRemote)})||null}function Y(a){return wb.find(function(b){return b.isTelephonyCall&&b.state.established&&b.isHolding()&&(!a||!b.isRemote)})||null}function Z(){return!b.localUser.selectedBusyHandlingOption||b.localUser.selectedBusyHandlingOption===d.DefaultRouting.name}function $(a,b,c,d,e,f){if(f=f||function(){O(a)},c=c||b,a.setPeerUser(b,d,e),!e){var g=r(function(){g=null,a.isPresent()&&(f(),f=null)},sb,!1);y.startReverseLookUp(c,function(c){r.cancel(g),a.isPresent()&&(c?(a.setPeerUser(b,c.displayName,c.userId),f?f():O(a)):f&&f())})}}function _(a,c){var d,e=!(a.participantType&&a.participantType!==f.RTCParticipantType.USER&&a.participantType!==f.RTCParticipantType.MEETING_POINT||a.userId==="echo_"+b.localUser.userId||a.isExternal);if(a.userId===b.localUser.userId?d=b.localUser:e&&(d=y.getUserFromCache(a.userId)),!d){a.userDisplayName=a.userDisplayName||a.phoneNumber||b.i18n.map.res_Unknown;var h=a.userDisplayName.split(" ");a.participantType===f.RTCParticipantType.MEETING_POINT?(a.lastName=h[0],a.location=h.splice(1).join(" ").trim().slice(1,-1)):(a.firstName=h[0],a.lastName=h.splice(1).join(" ")),e?(d=mb.extend({userId:a.userId,firstName:a.firstName,lastName:a.lastName,displayName:a.displayName,location:a.location,userType:a.participantType===f.RTCParticipantType.MEETING_POINT?f.UserType.MEETING_POINT:f.UserType.REGULAR}),a.isSimulated?d.isSimulated=!0:(d.noData=!0,y.addUsersToCache(d,!0,!1))):(a.participantType===f.RTCParticipantType.SESSION_GUEST&&(a.userType=f.UserType.SESSION_GUEST),d=mb.extend(a),d.isSessionGuest&&(d.initials=((d.firstName[0]||"")+(d.lastName[0]||"")).toUpperCase()))}var j=l.createFromUser(d,g.ParticipantState.Active);return j.streamId=a.videoStreamId||"",j.screenStreamId=a.screenStreamId||"",j.mediaType=i.getMediaType(a.mediaTypes||c),j.muted=a.muted||!j.mediaType.audio,j.participantType=a.participantType||f.RTCParticipantType.USER,j.screenSharePointerSupported=!!a.screenSharePointerSupported,j}function aa(a,b){if(b&&b.length){var c=Db[a];c?c.turnServers=b:Db[a]={turnServers:b}}}function ba(a){var b=Db[a];return b&&b.turnServers&&b.turnServers.length?b.turnServers:null}function ca(a){switch(a){case f.ReturnCode.DISCONNECTED:return g.CallClientTerminatedReason.DISCONNECTED;case f.ReturnCode.FAILED_TO_SEND:return g.CallClientTerminatedReason.FAILED_TO_SEND;case f.ReturnCode.REQUEST_TIMEOUT:return g.CallClientTerminatedReason.REQUEST_TIMEOUT;default:return g.CallClientTerminatedReason.REQUEST_TO_SERVER_FAILED}}function da(a,c,d,e){if(d.callOut=!!d.callOut,d.handover=!!d.handover,!a)return v.warn("[CircuitCallControlSvc]: joinSession invoked without a valid conversation"),void e("Missing conversation");if(kb(a,d.replaces,e)){if(a.isTelephonyConv){if(!d.handover&&(d.dialedDn=d.dialedDn?d.dialedDn.trim():null,!d.dialedDn))return void e("Missing Dialed DN");if(!b.localUser.callerId)return void e("Missing Caller ID")}v.debug("[CircuitCallControlSvc]: joinSession - rtcSessionId=",d.callId||a.rtcSessionId);var i;d.replaces&&c.desktop&&(i={reuseDesktopStreamFrom:d.replaces.sessionCtrl});var j=new h(a,i);xb&&(yb=xb),xb=j,xb.setCallIdForTelephony(d.callId),xb.setTransactionId();var k=a.call,l=!1;if(k&&k.isRemote&&!k.isAtcRemote&&(v.debug("[CircuitCallControlSvc]: Terminate the remote call and add the new local call to the conversation"),d.handover&&(xb.activeClient=k.activeClient,k.isTelephonyCall&&(xb.atcCallInfo=k.atcCallInfo,$(xb,k.peerUser.phoneNumber,null,k.peerUser.displayName),xb.participants=k.participants),L(xb),a.call=xb,N(a)),l=!0,R(k)),(b.isSessionGuest||b.localUser.isCMP||a.isTemporary)&&!a.testCall&&xb.sessionCtrl.useMaxNumberOfExtraVideoChannels(),(Cb||a.isTelephonyConv)&&(v.info("[CircuitCallControlSvc] Disabling remote video for outgoing call"),xb.disableRemoteVideo()),xb.setState(g.CallState.Initiated),xb.direction=g.CallDirection.OUTGOING,xb.mediaType=c,d.replaces){xb.replaces=d.replaces;var n=d.replaces.sessionCtrl.getLocalStream(m.LOCAL_STREAMS.DESKTOP);n&&(v.debug("[CircuitCallControlSvc] Reusing desktop stream from call ID=",d.replaces.callId),xb.sessionCtrl.setLocalStream(m.LOCAL_STREAMS.DESKTOP,n),d.replaces.sessionCtrl.setLocalStream(m.LOCAL_STREAMS.DESKTOP,null))}if(d.joiningGroupCall&&(xb.isJoiningGroupCall=!0),d.callOut&&(xb.setPeerUsersAsParticipants(),xb.isCallOut=!0),xb.isTelephonyCall)if(d.handover){var o=pa(xb.callId);o&&!o.isAtcConferenceCall()&&(xb.atcCallInfo=o.atcCallInfo,$(xb,o.peerUser.phoneNumber,null,o.peerUser.displayName)),xb.handover=!0}else $(xb,d.dialedDn,null,d.toName,d.userId);var q,r=xb.sessionCtrl,s=function(c){r.onSessionDescription=null,r.onClosed=null,xb.mediaType=r.getMediaConstraints();var g={convId:a.convId,rtcSessionId:xb.callId||a.rtcSessionId,ownerId:a.creatorId,sdp:c.sdp,mediaType:xb.mediaType,callOut:d.callOut,handover:d.handover,sendInviteCancel:!d.callOut,replaces:d.replaces&&d.replaces.callId,isTelephonyConversation:xb.isTelephonyCall,displayName:b.localUser.displayName,transactionId:xb.transactionId,screenSharePointerSupported:!(!xb.pointer||!xb.pointer.isEnabled)};xb.isTelephonyCall&&(g.fromDn=p.cleanPhoneNumber(b.localUser.callerId),g.fromName=b.localUser.displayName,g.fromUserId=b.localUser.userId,g.dialedDn=p.cleanPhoneNumber(d.dialedDn),g.toName=d.toName,g.toUserId=d.userId,g.noCallLog=b.localUser.noCallLog),b.localUser.hasTelephonyRole&&(g.fromName="Gru",g.fromDn="+19998455246");var h=C.createActionInfo(xb,f.RtcDiagnosticsAction.JOIN);h&&(h.data=JSON.stringify(g.sdp)),ub.joinRtcCall(g,function(a){b.$apply(function(){if(C.finishActionInfo(xb,h),a){var b=xb.replaces,c=ca(a);l?tb.endCallWithCauseCode(xb.callId,c):R(xb,c),b&&(xb=b),e(H(a))}else v.debug("[CircuitCallControlSvc]: Join RTC session call was successful"),xb&&(O(xb),xb.conferenceCall&&(v.debug("[CircuitCallControlSvc]: Publish /conference/participant/joining event"),w.publish("/conference/participant/joining",[xb]))),e(null,d.warning,xb)})})},t=function(a){if(a=H(a),v.warn("[CircuitCallControlSvc]: Failed to initiate call. ",a),xb===j){if(!d.handover)if(xb.setDisconnectCause(f.DisconnectCause.CALL_SETUP_FAILED,a),l)tb.endCallWithCauseCode(xb.callId,g.CallClientTerminatedReason.REQUEST_TO_SERVER_FAILED);else{var b=xb.isDirect?"terminateRtcCall":"leaveRtcCall";ub[b](xb.callId,xb.disconnectCause,function(a){a&&v.warn("[CircuitCallControlSvc]: Error terminating RTC call. ",a)})}xb&&(xb.terminate(),xb=null)}e(a)},u=function(){r.onClosed=null,r.onSessionDescription=null,e&&e(H())};q=!a.call||a.call!==xb&&!d.handover?G(a,xb,d):F(xb),q.then(function(e){e&&(aa(a.rtcSessionId,e.turnServer),r.setTurnUris(e.turnServer),r.setTurnCredentials(e)),r.warmup(c,null,function(){return xb?void b.$apply(function(){v.debug("[CircuitCallControlSvc]: The connection warmup was successful. Start the call."),a.call&&a.call.isRemote&&d.handover||(L(xb),a.call=xb,N(a),xb.conferenceCall||(v.debug("[CircuitCallControlSvc]: Publish /call/outgoing event"),w.publish("/call/outgoing",[xb])),O(xb)),r.onSessionDescription=s,r.onClosed=u,Aa(xb),r.start(c,null)}):void v.debug("[CircuitCallControlSvc]: Call has already been terminated")},function(a){b.$apply(t.bind(null,a))},d.screenConstraint)}).catch(t)}}function ea(a,c,d,e,f,g,h){var i=V(a);if(!i)return v.warn("[CircuitCallControlSvc]: changeMediaType - There is no local call"),void g("No active call");if(a!==i.callId)return v.info("[CircuitCallControlSvc]: changeMediaType - The given call ID does not match the local call"),void g("Invalid callId");if(!i.isEstablished())return v.info("[CircuitCallControlSvc]: changeMediaType - The local call is not established"),void g("Call not established");var j=i.sessionCtrl;if(!j.isConnStable())return void g("Connection not stable");var k=function(a){j.onSessionDescription=null,i.setTransactionId(c);var e={rtcSessionId:i.callId,sdp:a.sdp,mediaType:d,transactionId:i.transactionId,screenSharePointerSupported:!(!i.pointer||!i.pointer.isEnabled)};ub.changeMediaType(e,function(a){b.$apply(function(){i.clearTransactionId(),a?(j.renegotiationFailed(),g(a)):v.debug("[CircuitCallControlSvc]: changeMediaType was successful. Wait for SDP_ANSWER event")})})},l=i.localMediaType.desktop;F(i).then(function(a){if(j.setTurnUris(a.turnServer),j.setTurnCredentials(a),j.onSessionDescription=k,"boolean"==typeof f){var c=f?j.holdCall:j.retrieveCall;c(function(a){a?(v.error("[CircuitCallControlSvc]: Error in hold/retrieve media"),j.onSessionDescription=null,j.renegotiationFailed(),g("Error in hold/retrieve media")):g()})}else j.changeMediaType(d,e,function(a){a?b.$apply(function(){v.warn("[CircuitCallControlSvc]: changeMediaType failed - reason: ",a),j.onSessionDescription=null,j.renegotiationFailed(),g(a||"Error changing media")}):(l&&!i.localMediaType.desktop&&(v.debug("[CircuitCallControlSvc]: Publish /screenshare/ended event"),w.publish("/screenshare/ended"),i.pointer.isSupported=i.pointer.isEnabled=!1),i.updateMediaDevices(),g())},h)}).catch(function(a){g(H(a))})}function fa(a,c,d,e){var f=xb.sessionCtrl;d=d||{};var h=function(g){function h(a){b.$apply(function(){xb.clearTransactionId(),a?(R(xb,ca(a)),e(H(a))):(v.debug("[CircuitCallControlSvc]: Join/Answer RTC session was successful."),e(null,d.warning))})}f.onSessionDescription=null;var i={convId:a.convId,rtcSessionId:xb.callId||a.rtcSessionId,ownerId:a.creatorId,sdp:g.sdp,mediaType:c,callOut:!1,handover:!1,sendInviteCancel:!0,isTelephonyConversation:a.isTelephonyConv,displayName:b.localUser.displayName,transactionId:xb.transactionId};i.sdp&&"offer"===i.sdp.type?ub.joinRtcCall(i,h):ub.answerRtcCall(i,h)};f.onSessionDescription=h,f.start(c,null)||(R(xb,g.CallClientTerminatedReason.RTC_SESSION_START_FAILED),e(H()))}function ga(a,b,c,d){if(!a)return null;if(a.isTemporary&&!b)return v.debug("[CircuitCallControlSvc]: Publish /conversation/temporary/ended event"),w.publish("/conversation/temporary/ended",[a]),null;var e=new j(a);return e.setState(b?g.CallState.ActiveRemote:g.CallState.Started),c&&c.instanceId&&e.setInstanceId(c.instanceId),L(e),b&&(e.setActiveClient(b),ra(e),c&&(1===c.participants.length&&c.callOut&&(e.pullNotAllowed=!0),e.mediaType=i.getMediaType(c.mediaTypes))),"function"==typeof d&&d(e),a.call=e,N(a),O(e),e}function ha(a){if(a.isGuestInvite){M(a);var b=D(a.convId);b&&b.isTemporary&&(v.debug("[CircuitCallControlSvc]: Publish /conversation/temporary/ended event"),w.publish("/conversation/temporary/ended",[b]))}else a.setState(g.CallState.Started),a.activeClient=null,O(a),zb.some(function(b,c){if(b.callId===a.callId)return zb.splice(c,1),!0})}function ia(a){ub.declineRtcCall({convId:a.convId,rtcSessionId:a.sessionId,cause:f.InviteRejectCause.BUSY,transactionId:a.transactionId})}function ja(a,b,c){var d=new h(a,b.sessionId);d.setInstanceId(b.instanceId),d.setTransactionId(b.transactionId),d.setState(g.CallState.Ringing),b.from&&$(d,b.from.phoneNumber,b.from.fullyQualifiedNumber,b.from.displayName,null,function(){v.debug("atccall/firstcall"),w.publish(c?"/atccall/firstcall":"/atccall/secondcall",[d])})}function ka(a,c,d,e){if(e=e||function(){},a=a||xb,M(a),!a||a.state!==g.CallState.Ringing&&a.state!==g.CallState.Answering)return v.debug("[CircuitCallControlSvc]: call invalid to be declined"),void e("Call Invalid");v.debug("[CircuitCallControlSvc]: decline - rtcSessionId: ",a.callId);var f={convId:a.convId,rtcSessionId:a.callId,cause:c.type,transactionId:a.transactionId},h=[a];if(c.err&&h.push(c.err),ub.declineRtcCall(f,function(a){b.$apply(function(){a?(v.warn("[CircuitCallControlSvc]: Error declining the RTC call. ",a),e(a)):e()})}),!a.isDirect){var i=D(a.convId);ga(i)}v.debug("[CircuitCallControlSvc]: Publish /call/declining event"),w.publish("/call/declining",h),R(a,g.CallClientTerminatedReason.CLIENT_ENDED_PRFX+c.type,d)}function la(a,c,d,e,h){if(h=h||function(){},a=a||xb,!a)return v.debug("[CircuitCallControlSvc]: There is no local call"),void(h&&r(h));if(a.terminateTimer)return v.debug("[CircuitCallControlSvc]: Local call is already being terminated. Ignore leave request."),void(h&&r(h));if(a.checkState([g.CallState.Ringing,g.CallState.Answering]))return void ka(a,{type:c||f.InviteRejectCause.DECLINE},!1,h);v.debug("[CircuitCallControlSvc]: leaveCall - rtcSessionId=",a.callId);var i;return a.clearAtcHandoverInProgress(),a.activeClient?(i=D(a.convId),ga(i,a.activeClient,null,function(a){xb.isTelephonyCall&&(a.atcCallInfo=xb.atcCallInfo,a.peerUser=xb.peerUser)}),void R(a,d)):(a.isDirect?ub.terminateRtcCall(a.callId,a.disconnectCause,function(a){b.$apply(function(){a&&v.warn("[CircuitCallControlSvc]: Error terminating RTC call. ",a),h&&h(a)})}):(i=D(a.convId),ga(i),ub.leaveRtcCall(a.callId,a.disconnectCause,function(a){b.$apply(function(){a&&v.warn("[CircuitCallControlSvc]: Error leaving the RTC call. ",a),h&&h(a)})})),d===g.CallClientTerminatedReason.PAGE_UNLOADED&&(a.terminateReason=d,a.qosSubmitted=!0,B.sendQOSData(a,a.mediaType,a.sessionCtrl.getLastSavedStats())),e||(a.directCall?(v.debug("[CircuitCallControlSvc]: Publish /call/terminating event"),w.publish("/call/terminating",[xb])):a.conferenceCall?(v.debug("[CircuitCallControlSvc]: Publish /conference/leaving event"),w.publish("/conference/leaving",[a])):(v.debug("[CircuitCallControlSvc]: Publish /group/leaving event"),w.publish("/group/leaving",[a]))),void(a.outgoingFailed()?(a.terminateTimer=r(function(){a.terminateTimer=null,R(a,d)},pb),a.terminateReason=d):R(a,d)))}function ma(a,c){return c=c||function(){},a.isDirect?(v.debug("[CircuitCallControlSvc]: Direct call. Ignore terminate conference request."),void r(c)):(v.debug("[CircuitCallControlSvc]: terminateConference - rtcSessionId=",a.callId),ub.terminateRtcCall(a.callId,a.disconnectCause,function(d){b.$apply(function(){if(d&&(v.warn("[CircuitCallControlSvc]: Error terminating the RTC call. ",d),a===xb)){var b=D(a.convId);b&&a.isEstablished()&&ga(b)}c&&c(d)})}),void(a===xb&&R(a,g.CallClientTerminatedReason.USER_ENDED)))}function na(a,c){v.debug("[CircuitCallControlSvc]: endRemoteCall - rtcSessionId=",a.callId),a.isDirect?ub.terminateRtcCall(a.callId,a.disconnectCause,function(a){b.$apply(function(){a&&v.warn("[CircuitCallControlSvc]: Error terminating remote RTC call. ",a),c(a)})}):ub.leaveRtcCall(a.callId,a.disconnectCause,function(a){b.$apply(function(){a&&v.warn("[CircuitCallControlSvc]: Error leaving remote RTC call. ",a),c(a)})})}function oa(a){if(!xb.isDirect){if(xb.sessionCtrl.hasMaxExtraVideoChannels())return void v.debug("[CircuitCallControlSvc]: We already have max number of extra video channels");var b=a&&a.participants.length;b||(b=xb.sessionCtrl.getNumberOfExtraVideoChannels()+2);var c=Math.max(xb.participants.length+1,b),d=xb.sessionCtrl.setExtraVideoChannelsForParticipants(c);d&&xb.isEstablished()&&(v.debug("[CircuitCallControlSvc]: The number of extra channels has increased. Trigger a media renegotiation."),ea(xb.callId,null,xb.localMediaType,!1,null,function(a){a&&v.warn("[CircuitCallControlSvc]: Failed to renegotiate the media. Error: ",a)}))}}function pa(a){var b=null;return zb.some(function(c){if(c.callId===a)return b=c,!0}),b}function qa(a){var b=Eb.find(function(b){return b.callId===a});return b||null}function ra(a){var b=zb.some(function(b,c){return b===a||b.callId===a.callId&&(zb[c]=a,!0)});b||zb.push(a)}function sa(a,c){if(c=c||function(){},xb){var d=xb.getParticipant(a);if(d)if(d.actions.includes(g.ParticipantAction.Drop)){var e={rtcSessionId:xb.callId,userId:a};ub.removeSessionParticipant(e,function(a){b.$apply(function(){a?(v.warn("[CircuitCallControlSvc]: Failed to remove participant"),c("res_RemoveParticipantFailed")):c()})})}else v.warn("[CircuitCallControlSvc]: remove call participant, unsupported pcState: ",d.pcState.name),c("Participant not active");else v.error("[CircuitCallControlSvc]: call participant not found: ",a),c("Participant not found")}else c("No active call")}function ta(a,b){if(b.streamId){var c=0===a.sessionCtrl.getNumberOfExtraVideoChannels();a.isMocked&&!c||a.participants.forEach(function(c){c.streamId===b.streamId&&c.userId!==b.userId&&(c.streamId="",v.debug("[CircuitCallControlSvc]: The video stream has been re-assigned. Clear the streamId for previous participant. [userId, streamId] = ",[c.userId,b.streamId]),xb.setParticipantRemoteVideoURL(c),v.debug("[CircuitCallControlSvc]: Publish /call/participant/updated event. userId =",c.userId),w.publish("/call/participant/updated",[a.callId,c]))})}}function ua(a,c){var d=D(a.convId);b.isSessionGuest||c.setActions(d,b.localUser)}function va(a,b,c,d){var e=a.addParticipant(b,c,d);return e&&(ta(a,e),ua(a,e),b.noData&&!b.reqPending&&(v.debug("[CircuitCallControlSvc]: Get user data for added participant. userId: ",b.userId),y.getUserById(b.userId,function(c,d){d&&(v.debug("[CircuitCallControlSvc]: Successfully retrieved participant data. userId: ",b.userId),a.isPresent()&&a.hasParticipant(b.userId)&&(b.firstName=d.firstName,b.lastName=d.lastName,v.debug("[CircuitCallControlSvc]: Publish /call/participant/updated event. userId =",b.userId),w.publish("/call/participant/updated",[a.callId,b])))}))),e}function wa(a,b,c){var d=a.updateParticipant(b,c);return d&&(ta(a,d),ua(a,d)),d}function xa(a,b,c){var d=g.ParticipantState.Terminated;switch(c){case f.RTCSessionParticipantLeftCause.CONNECTION_LOST:case f.RTCSessionParticipantLeftCause.STREAM_LOST:d=g.ParticipantState.ConnectionLost;break;case f.RTCSessionParticipantLeftCause.REMOVED:d=g.ParticipantState.Removed;break;case f.RTCSessionParticipantLeftCause.USER_LEFT_STAGE:d=g.ParticipantState.OffStage}a.setParticipantState(b,d);var e=a.removeParticipant(b);if(!a.hasOtherParticipants()){if(!a.conferenceCall)return v.debug("[CircuitCallControlSvc]: Publish /group/terminated event"),w.publish("/group/terminated",[a]),void la(a,null,g.CallClientTerminatedReason.NO_USERS_LEFT,!0);a.setState(g.CallState.Waiting)}if(e){a.updateMediaType(),!a.isRemote&&e.isCMP&&e.isMeetingPointInvitee&&(a.setMeetingPointInviteState(!1),tb.enableRemoteAudio(a.callId)),a.conferenceCall&&(v.debug("[CircuitCallControlSvc]: Publish /conference/participant/left event"),w.publish("/conference/participant/left",[a,c]));var h=c?{leftCause:c}:null;v.debug("[CircuitCallControlSvc]: Publish /call/participant/removed event"),w.publish("/call/participant/removed",[a.callId,e,h])}O(a)}function ya(a,c){if(!a||!c||!c.state)return null;var d=a.recording;return d.state!==c.state?(d.notifyByCurtain=c.state===f.RecordingInfoState.START_PENDING||c.state===f.RecordingInfoState.STARTED&&d.state===f.RecordingInfoState.START_PENDING,d.notifyByUser=!d.notifyByCurtain||c.state===f.RecordingInfoState.START_PENDING&&d.state!==f.RecordingInfoState.STARTED):(d.notifyByCurtain=!1,
d.notifyByUser=!1),d.state=c.state,d.duration=c.duration||d.duration,d.reason=c.reason,c.state===f.RecordingInfoState.STARTED&&(d.resumeTime=Date.now()),c.starter&&c.starter.userId&&c.starter.userId!==d.starter.userId&&(d.starter=c.starter,d.starter.userId===b.localUser.userId?d.starter.res="res_StartedRecording_You":(d.starter.name=d.starter.firstName||d.starter.displayName,d.starter.res=d.starter.name?"res_StartedRecording_Other":"res_StartedRecording")),d}function za(a){xb&&void 0!==a&&xb.attendeeCount!==a&&(xb.attendeeCount=a,xb.updateCallState(),v.debug("[CircuitCallControlSvc]: Publish /call/attendeeCountChanged"),w.publish("/call/attendeeCountChanged",[xb.callId,xb.attendeeCount]))}function Aa(a){var b=a&&a.sessionCtrl;return b?(b.onIceCandidate=Ca.bind(null,a),b.onSdpConnected=Da.bind(null,a),b.onIceConnected=Ea.bind(null,a),b.onIceDisconnected=Fa.bind(null,a),b.onRemoteVideoAdded=Ga.bind(null,a),b.onRemoteVideoRemoved=Ha.bind(null,a),b.onRemoteStreamUpdated=Ia.bind(null,a),b.onDTMFToneChange=Ja.bind(null,a),b.onRtcError=Ka.bind(null,a),b.onRtcWarning=La.bind(null,a),b.onLocalStreamEnded=Ma.bind(null,a),b.onQosAvailable=Na.bind(null,a),b.onStatsThresholdExceeded=Oa.bind(null,a),b.onStatsNoIncomingPackets=Pa.bind(null,a),void(b.onNetworkQuality=Qa.bind(null,a))):void v.error("[CircuitCallControlSvc]: Failed to get RtcSessionController for given call. ",a)}function Ba(a){var b=a&&a.sessionCtrl;b&&(b.onIceCandidate=null,b.onSessionDescription=null,b.sessionClosed=null,b.onSdpConnected=null,b.onIceConnected=null,b.onIceDisconnected=null,b.onRemoteVideoAdded=null,b.onRemoteVideoRemoved=null,b.onRemoteStreamUpdated=null,b.onDTMFToneChange=null,b.onRtcError=null,b.onRtcWarning=null,b.onLocalStreamEnded=null,b.onStatsThresholdExceeded=null,b.onStatsNoIncomingPackets=null,b.onNetworkQuality=null)}function Ca(a,c){v.debug("[CircuitCallControlSvc]: RtcSessionController - onIceCandidate");var d={rtcSessionId:a.callId,userId:b.localUser.userId,origin:c.origin,candidates:c.candidates.map(JSON.stringify.bind(JSON))},e=C.createActionInfo(a,f.RtcDiagnosticsAction.ICE_CANDIDATES);e&&(e.data=d.candidates,e.isEndOfCandidates=c.candidates.isEnd),ub.sendIceCandidates(d,function(b){C.finishActionInfo(a,e),b&&v.warn("Failed to send ICE candidate: ",b)})}function Da(a){v.debug("[CircuitCallControlSvc]: RtcSessionController - onSdpConnected"),b.$apply(function(){v.debug("[CircuitCallControlSvc]: Publish /call/sdpConnected event"),w.publish("/call/sdpConnected",[a]);var b=C.createActionInfo(a,f.RtcDiagnosticsAction.SDP_CONNECTED);C.finishActionInfo(a,b),a.isTelephonyCall?(a.state.established||a.setState(g.CallState.Waiting),a.updateCallState()):a.setState(a.isDirect||a.hasOtherParticipants()?g.CallState.Active:g.CallState.Waiting),O(a),C.finishDeviceDiagnostics(a)})}function Ea(a){v.debug("[CircuitCallControlSvc]: RtcSessionController - onIceConnected");var b=a.disconnectCause||{};a.isEstablished()&&b.cause===f.DisconnectCause.STREAM_LOST&&(a.disconnectCause=null)}function Fa(a){v.debug("[CircuitCallControlSvc]: RtcSessionController - onIceDisconnected"),a.isEstablished()&&a.setDisconnectCause(f.DisconnectCause.STREAM_LOST)}function Ga(){v.debug("[CircuitCallControlSvc]: RtcSessionController - onRemoteVideoAdded")}function Ha(){v.debug("[CircuitCallControlSvc]: RtcSessionController - onRemoteVideoRemoved")}function Ia(a){v.debug("[CircuitCallControlSvc]: RtcSessionController - onRemoteStreamUpdated"),b.$apply(function(){v.debug("[CircuitCallControlSvc]: Publish /call/remoteStreamUpdated event"),w.publish("/call/remoteStreamUpdated",[a])})}function Ja(a,b){v.debug("[CircuitCallControlSvc]: RtcSessionController - onDTMFToneChange"),b.tone?(v.debug("[CircuitCallControlSvc]: Sent DTMF Digit: "+b.tone),w.publish("/call/singleDigitSent",[a,b.tone])):""===b.tone&&(v.info("[CircuitCallControlSvc]: Digits played completely"),w.publish("/call/digitsSent",[a]))}function Ka(a,b){return v.debug("[CircuitCallControlSvc]: RtcSessionController - onRtcError"),w.publish("/call/rtcError",[a,b.error]),a.checkState([g.CallState.Ringing,g.CallState.Answering])?void ka(a,{type:f.InviteRejectCause.BUSY}):void(a.sameAs(xb)&&("res_CallMediaFailed"===b.error?(a.setDisconnectCause(f.DisconnectCause.NEGOTIATION_FAILED),tb.endCallWithCauseCode(a.callId,g.CallClientTerminatedReason.ICE_TIMED_OUT)):"res_CallMediaDisconnected"===b.error?(a.setDisconnectCause(f.DisconnectCause.STREAM_LOST),tb.endCallWithCauseCode(a.callId,g.CallClientTerminatedReason.LOST_MEDIA_STREAM),ub.pingServer()):a.isEstablished()||tb.endCall(a.callId)))}function La(a,b){v.debug("[CircuitCallControlSvc]: RtcSessionController - onRtcWarning"),w.publish("/call/rtcWarning",[a,b.warning])}function Ma(a,b){v.debug("[CircuitCallControlSvc]: RtcSessionController - onStreamEnded"),b.isDesktop&&xb.hasLocalScreenShare()?(v.debug("[CircuitCallControlSvc]: Screenshare stream ended, remove screenshare or terminate the call"),xb.isEstablished()?tb.removeScreenShare(xb.callId):tb.endCall(xb.callId)):tb.renegotiateMedia(a.callId,function(b){b&&(v.debug("[CircuitCallControlSvc]: Publish /call/localStreamEnded event"),w.publish("/call/localStreamEnded",[a]))})}function Na(a,b){if(v.debug("[CircuitCallControlSvc]: RtcSessionController - onQosAvailable"),b.renegotiationInProgress&&(a.terminateReason=g.CallClientTerminatedReason.MEDIA_RENEGOTIATION),a.sessionCtrl){if(a.qosSubmitted)return void v.info("[CircuitCallControlSvc]: QoS already submitted for call Id:",a.callId);B.sendQOSData(a,a.lastMediaType,b.qos,b.lastSavedStats)}b.renegotiationInProgress&&(a.terminateReason=null)}function Oa(a,b){Gb||(v.debug("[CircuitCallControlSvc]: RtcSessionController - onStatsThresholdExceeded. Cleared: ",!(!b||!b.cleared)),b&&b.cleared?w.publish("/call/rtp/threshholdExceeded/cleared",[a.callId]):w.publish("/call/rtp/threshholdExceeded/detected",[a.callId]))}function Pa(a){v.debug("[CircuitCallControlSvc]: RtcSessionController - onStatsNoIncomingPackets. Publish /call/rtp/noIncomingPackets event"),w.publish("/call/rtp/noIncomingPackets",[a.callId])}function Qa(a,c){if(c&&c.quality){var d=c.quality,e={userId:b.localUser.userId,audio:{qualityLevel:d.qualityLevel.value,currentPlSend:d.currentPlSend,currentPlReceive:d.currentPlReceive,firstTimeLowQuality:d.firstTimeLowQuality}};v.debug("[CircuitCallControlSvc]: Publish /call/network/quality event for quality=",e.audio.qualityLevel),w.publish("/call/network/quality",[e])}}function Ra(a){try{v.debug("[CircuitCallControlSvc]: Received RTCSession.ACTIVE_SPEAKER");var b=U(a.sessionId);if(!b)return void v.warn("[CircuitCallControlSvc]: Unexpected event. There is no local call");if(b.isDirect||b.participants.length<2)return void v.debug("[CircuitCallControlSvc]: Ignore RTC.ACTIVE_SPEAKER event for 1-2-1 calls");var c=[];a.first&&c.push(a.first),a.second&&c.push(a.second),a.third&&c.push(a.third);var d=b.setActiveSpeakers(c);if(!d)return;v.debug("[CircuitCallControlSvc]: Publish /call/participant/activeSpeakers event"),w.publish("/call/participants/activeSpeakers",[b.callId,c])}catch(a){v.error("[CircuitCallControlSvc]: Exception handling RTC.ACTIVE_SPEAKER event. ",a)}}function Sa(a){try{v.debug("[CircuitCallControlSvc]: Received RTCSession.VIDEO_ACTIVE_SPEAKER");var c=U(a.sessionId);if(!c)return void v.warn("[CircuitCallControlSvc]: Unexpected event. There is no local call");var d=c.getParticipant(a.userId);if(!d)return void v.debug("[CircuitCallControlSvc]: Participant info not available. Ignoring VIDEO_ACTIVE_SPEAKER. userId=",a.userId);if(d.streamId===a.videoStreamId)return void v.debug("[CircuitCallControlSvc]: Participant is already assigned to the received videoStreamId. Ignoring VIDEO_ACTIVE_SPEAKER");b.$apply(function(){d.streamId=a.videoStreamId,ta(c,d),c.setParticipantRemoteVideoURL(d),c.checkForActiveRemoteVideo(),v.debug("[CircuitCallControlSvc]: Publish /call/participant/updated event. userId =",d.userId),w.publish("/call/participant/updated",[c.callId,d])})}catch(a){v.error("[CircuitCallControlSvc]: Exception handling RTCSession.VIDEO_ACTIVE_SPEAKER event.",a)}}function Ta(a){if(v.debug("[CircuitCallControlSvc]: Processing active session for convId = ",a.convId),!a.participants||0===a.participants.length)return void v.warn("[CircuitCallControlSvc]: The active session does not have participants. rtcSessionId = ",a.rtcSessionId);var c=z.getConversationByRtcSession(a.rtcSessionId);if(c&&(c.hasJoined||c.isTemporary)){if(c.call)return void v.debug("[CircuitCallControlSvc]: Conversation already has an associated call");if(a.turnServers&&aa(a.rtcSessionId,a.turnServers),!qa(a.rtcSessionId)){var d,e=!1;if(a.participants.some(function(a){if(a.userId===b.localUser.userId)return d=a,a.clientId===ub.clientId&&(e=!0),!0}),c.type!==f.ConversationType.DIRECT||d){if(e){var g=function(b){b&&v.warn("[CircuitCallControlSvc] Lost session could not be terminated. Session Id=",a.rtcSessionId)},h={disconnectCause:f.DisconnectCause.CONNECTION_LOST,disconnectReason:f.DisconnectReason.CALL_LOST};if(c.type===f.ConversationType.DIRECT)return void ub.terminateRtcCall(a.rtcSessionId,h,g);ub.leaveRtcCall(a.rtcSessionId,h,g)}ga(c,d,a,function(b){b.setCallIdForTelephony(a.rtcSessionId),d&&Ua(b,a)})}}}}function Ua(a,b){a&&a.isTelephonyCall&&b&&b.participants&&b.participants.length<=2&&b.participants.some(function(b){if(b.participantType===f.RTCParticipantType.TELEPHONY)return $(a,b.phoneNumber,null,b.userDisplayName),!0})}function Va(a){var c=!1,d=U(a.rtcSessionId);return d&&a.participants&&(c=a.participants.some(function(a){return a.userId===b.localUser.userId&&a.clientId===ub.clientId})),c}function Wa(){return new u(function(a,c){return Hb||b.isSessionGuest?(v.debug("[CircuitCallControlSvc]: Initialize active RTC sessions"),void ub.getActiveSessions(function(c,d){b.$apply(function(){c&&v.error("[CircuitCallControlSvc]: Error getting active sessions: ",c),d=d||[];for(var e=wb.length-1;e>=0;e--)wb[e].isRemote&&R(wb[e]);zb.empty();var f=null,h=!1,i=!1,j=[];d.forEach(function(a){var c=U(a.rtcSessionId);if(c){if(Va(a))return h=h||c===xb,i=i||c===yb,v.info("[CircuitCallControlSvc]: Found localCall in active sessions. Trigger media renegotiation."),void tb.renegotiateMedia(c.callId);R(c,g.CallClientTerminatedReason.LOST_WEBSOCKET_CONNECTION)}return f=z.getConversationByRtcSession(a.rtcSessionId),f&&f.hasJoined?void Ta(a):void(a.invitedGuests&&a.invitedGuests.includes(b.localUser.userId)?(v.info("[CircuitCallControlSvc]: Local user is invited as guest to this session"),j.push(z.createConversationAsGuestFromSummary(a.convId))):f||(v.info("[CircuitCallControlSvc]: Conversation associated with session is not cached. Need to get it."),j.push(z.getConversationPromise(a.convId))))}),w.publish("/activeSessions/received"),yb&&!i&&R(yb,g.CallClientTerminatedReason.LOST_WEBSOCKET_CONNECTION),xb&&!h&&R(xb,g.CallClientTerminatedReason.LOST_WEBSOCKET_CONNECTION),j.length>0?(v.info("[CircuitCallControlSvc]: Wait for get conversation promises to be resolved."),u.all(j).then(function(c){var d=c.map(function(a){return a.convId});v.debug("[CircuitCallControlSvc]: Retrieved the missing conversation(s): ",d),v.debug("[CircuitCallControlSvc]: Now that we have all the conversations, check if they still have active RTC sessions."),ub.getActiveSessions(function(c,e){b.$apply(function(){c&&(v.error("[CircuitCallControlSvc]: Error getting active sessions: ",c),e=[]),e.forEach(function(a){d.indexOf(a.convId)!==-1&&(Va(a)||Ta(a))}),a()})})}).catch(function(a){v.error("[CircuitCallControlSvc]: Failed to retrieve the conversation(s). ",a)})):a()})})):void c("Not ready to initialize active sessions")})}function Xa(a,b,c){var d;d=c.isRemote?new j(b):new h(b),b.call=d,d.terminate(),v.debug("[CircuitCallControlSvc]: Publish /call/ended event"),w.publish("/call/ended",[d,!0]),b.call=null,N(b),c.updateCall(a),a.call=c,N(a),O(c),v.debug("[CircuitCallControlSvc]: Publish /call/moved event"),w.publish("/call/moved",[d.callId,c.callId])}function Ya(a,b){var c={rtcSessionId:a,transactionId:b};ub.changeMediaReject(c,function(a){a?v.error("[CircuitCallControlSvc]: changeMediaReject sending error"):v.debug("[CircuitCallControlSvc]: changeMediaReject sent")})}function Za(a,b){if(v.debug("[CircuitCallControlSvc]: Publish /call/incoming event"),w.publish("/call/incoming",[a.call]),!a.muted&&A){var c=a.call.isGuestInvite?g.NotificationType.INCOMING_INVITATION_AS_GUEST:a.call.mediaType.video?g.NotificationType.INCOMING_VIDEO_CALL:g.NotificationType.INCOMING_VOICE_CALL,d={type:c,userId:b,extras:{conversation:a,call:a.call}};a.isTelephonyConv&&(d.user=a.call.peerUser),A.show(d)}a.call.startRingingTimer(function(){ka(a.call,{type:f.InviteRejectCause.TIMEOUT},!1)})}function $a(a,e){if(!a||!e)return void v.error("[CircuitCallControlSvc]: processInvite called without evt or conversation");var f=null,j=!1,l=!1,n=!1;if(a.replaces&&pa(a.replaces))j=!0;else if(xb)if(xb.callId===a.replaces)l=xb.sessionCtrl&&xb.sessionCtrl.isMuted(),f=xb;else if(xb.terminateTimer){if(xb.callId===a.sessionId)return v.debug("[CircuitCallControlSvc]: Reject incoming call. Current call still not terminated"),void ia(a);R(xb)}else{if(xb.callId===a.sessionId)return void(xb.isDirect?(v.debug("[CircuitCallControlSvc]: INVITE for same local call. Reject it"),ia(a)):v.warn("[CircuitCallControlSvc]: INVITE for same conversation as local call. Ignore it."));if(!xb.isEstablished()&&(!e.isTelephonyConv||Z()))return v.debug("[CircuitCallControlSvc]: Reject incoming call. Current call still not established"),void ia(a)}e.isTelephonyConv?a.to&&a.to.displayName&&a.to.displayName.startsWith("handover-from")&&(v.debug("[CircuitCallControlSvc]: Received handover call"),Jb?(n=!0,r.cancel(Jb),Jb=null):(v.warn("[CircuitCallControlSvc]: INVITE for handover call from another client. Ignore it."),j=!0)):Ab&&Ab.callId===a.replaces&&(l=Bb,f=Ab);var o=qa(a.sessionId);if(o)return void v.warn("[CircuitCallControlSvc]: INVITE for existing ringing call. Ignore it.");if(!j&&!f&&Eb.length>=1&&!n&&(!e.isTelephonyConv||Z()))return v.debug("[CircuitCallControlSvc]: Reject second incoming call."),void ia(a);if(e.isTelephonyConv&&!n&&!j){if(b.localUser.selectedRoutingOption===k.DeskPhone.name)return void ja(e,a,!0);if(b.localUser.selectedBusyHandlingOption&&b.localUser.selectedBusyHandlingOption!==d.DefaultRouting.name){if(xb||Eb.length>=1||!zb.isEmpty()||e.call&&e.call.isAtcRemote)return void ja(e,a)}else if(xb&&xb.isPresent()&&yb&&yb.isPresent())return v.debug("[CircuitCallControlSvc]: Reject incoming call. We cannot handle more than 2 local phone calls"),void ia(a)}var p={isAtcPullCall:e.isTelephonyConv&&n&&"offer"===a.sdp.type};f&&f.localMediaType.desktop&&(p.reuseDesktopStreamFrom=f.sessionCtrl);var s=new h(e,p);if(s.setCallIdForTelephony(a.sessionId),s.setInstanceId(a.instanceId),s.setTransactionId(a.transactionId),f){s.replaces=f;var t=f.sessionCtrl.getLocalStream(m.LOCAL_STREAMS.DESKTOP);t&&(v.debug("[CircuitCallControlSvc] Reusing desktop stream from call ID=",f.callId),s.sessionCtrl.setLocalStream(m.LOCAL_STREAMS.DESKTOP,t),f.sessionCtrl.setLocalStream(m.LOCAL_STREAMS.DESKTOP,null))}Cb&&(v.info("[CircuitCallControlSvc] Disabling remote video for incoming call"),s.disableRemoteVideo()),s.setState(g.CallState.Ringing),s.direction=g.CallDirection.INCOMING,b.localUser.isATC&&s.isTelephonyCall&&(s.atcCallInfo=new c);var u=a.mediaType||["AUDIO"];va(s,_({userId:a.userId},u),g.ParticipantState.Calling),s.ringingTimeout=a.ringingTimeout||s.ringingTimeout;var x=i.getMediaType(u);if(s.mediaType=x,x.desktop&&v.debug("[CircuitCallControlSvc]: INVITE for a Screen Share"),j)return void L(s,!0);var y=function(){b.$apply(function(){if(s.state===g.CallState.Terminated)return void v.debug("[CircuitCallControlSvc]: New alerting call has been terminated already");Aa(s),v.debug("[CircuitCallControlSvc]: New alerting call: ",s.callId),e.call&&!e.isTelephonyConv&&(v.debug("[CircuitCallControlSvc]: Terminate the remote call and add the new local call to the conversation"),R(e.call));var c=null;return e.call&&e.call.isAtcRemote&&(c=e.call.callId),e.call=s,e.isTelephonyConv&&n?(v.debug("[CircuitCallControlSvc]: Publish /atccall/replace event"),w.publish("/atccall/replace",[s,c])):N(e),f?void tb.answerCall(s.callId,f.localMediaType,function(a){a||l&&xb.sessionCtrl&&xb.sessionCtrl.mute()}):(b.localUser.isCMP&&(n=!0,x.video=!0,x.hdVideo=!0,x.desktop=!1),n?(s.isTelephonyCall&&a.from&&$(s,a.from.phoneNumber,null,a.from.displayName),void tb.answerCall(s.callId,x)):(ub.sendProgress(s.callId,a.userId,b.localUser.userId,function(a){a&&v.error("[CircuitCallControlSvc]: sendProgress error",a)}),s.isTelephonyCall&&a.from?void $(s,a.from.phoneNumber,null,a.from.displayName,null,function(){e.call===s&&Za(e,a.userId)}):void Za(e,a.userId)))})},z=s.sessionCtrl,A=ba(e.rtcSessionId);b.localUser.isCMP&&z.useMaxNumberOfExtraVideoChannels(),F(s).then(function(b){L(s),A?(v.debug("[CircuitCallControlSvc]: Using TURN servers associated with session: ",A),z.setTurnUris(A)):(v.debug("[CircuitCallControlSvc]: Using retrieved TURN servers"),z.setTurnUris(b.turnServer)),z.setTurnCredentials(b),v.debug("[CircuitCallControlSvc]: Set TURN credentials");var c;if(s.replaces)c=s.replaces.localMediaType;else{var d="firefox"===q.browser,e="android"===q.browser;c={audio:!d&&!e,video:!1}}cb(c,function(b){z.warmup(b,a.sdp,y,function(a){v.warn("[CircuitCallControlSvc]: Warmup failed. Ignore the incoming call, ",a),w.publish("/call/warmupFailed",[a,s]),s.terminate()})})}).catch(function(a){v.warn("[CircuitCallControlSvc]: Warmup failed. Ignore the incoming call: ",a),s.terminate()})}function _a(a,c){if(a&&c)return a.hasJoined||a.isTemporary?void c.some(function(c){if(a.rtcSessionId===c.rtcSessionId){if(v.debug("[CircuitCallControlSvc]: Processing active session for convId = ",a.convId),!c.participants||0===c.participants.length)return v.warn("[CircuitCallControlSvc]: The active session does not have participants. rtcSessionId = ",c.rtcSessionId),!0;var d;return c.participants.some(function(a){if(a.userId===b.localUser.userId)return d=a,!0}),a.type===f.ConversationType.DIRECT&&!d||(a.call?(v.debug("[CircuitCallControlSvc]: Conversation already has an associated call"),!0):(ga(a,d,c,function(a){d?Ua(a,c):a.conferenceCall&&(v.debug("[CircuitCallControlSvc]: Publish /conference/started event"),w.publish("/conference/started",[a]))}),!0))}}):void v.debug("[CircuitCallControlSvc]: User is not a conversation participant. Ignore active session.")}function ab(a,b,c){var d=U(a);return d?(v.info("[CircuitCallControlSvc]: Sending DTMF Digits=",b),void(d.sessionCtrl.sendDTMFDigits(b)||(v.error("[CircuitCallControlSvc]: Cannot send DTMF digits"),c("res_CannotSendDTMF")))):(v.info("[CircuitCallControlSvc]: sendDTMFDigits - The given call ID does not match the local call"),void c("Invalid callId"))}function bb(a,c,d,e){a.type===f.ConversationType.LARGE&&b.isSessionGuest&&(c.audio=!1,v.debug("[CircuitCallControlSvc]: Set media type for large conference participant to ",c)),cb(c,function(b,c){return c&&a.isTelephonyConv?void e(c):(d.warning=c,void da(a,b,d,e))})}function cb(a,c){if(v.debug("[CircuitCallControlSvc]: Check media sources for mediaType = ",a),b.browser.msie&&!b.isSessionGuest&&!b.localUser.hasPermission(f.SystemPermission.IE_PLUGIN_SUPPORT))return v.debug("[CircuitCallControlSvc]: User does not have permission to use IE plugin. Publish /ieplugin/permissionDenied event."),void w.publish("/iePlugin/permissionDenied");var d;return a=a||{audio:!0,video:!1},nb||ob||!a.audio&&!a.video?(v.debug("[CircuitCallControlSvc]: Normalized mediaType = ",a),void c(a)):(v.debug("[CircuitCallControlSvc]: Get audio and video media sources"),void q.getMediaSources(function(b,e){a.video&&(!e||e.length<1)&&(a.video=!1,d="res_AnswerWarnNoCamera"),a.audio&&(!b||b.length<1)&&(a.audio=!1,d="res_AnswerWarnNoCamera"===d?"res_AccessToMediaInputDevicesFailed":"res_AccessToAudioInputDeviceFailed"),v.debug("[CircuitCallControlSvc]: Normalized mediaType = ",a),c(a,d)}))}function db(a){a&&a.activeNotification&&!a.isHandoverInProgress&&(A&&A.dismiss(a.activeNotification),a.activeNotification=null)}function eb(a,c,d){var e={content:{type:"PARTICIPANT_POINTER",x:c,y:d,userId:b.localUser.userId},destUserId:a};vb.sendDesktopAppRequest(e,function(a){a?v.error("[CircuitCallControlSvc]: Error sending participant pointer coordinates: ",a):v.info("[CircuitCallControlSvc]: Successfully sent participant pointer coordinates.")})}function fb(a,c,d){var e={content:{type:"PARTICIPANT_DRAWING",points:c,options:d||{},userId:b.localUser.userId},destUserId:a};vb.sendDesktopAppRequest(e,function(a){a?v.error("[CircuitCallControlSvc]: Error sending participant drawing coordinates: ",a):v.info("[CircuitCallControlSvc]: Successfully sent participant drawing coordinates.")})}function gb(a,c){if(a&&a.hasLocalScreenShare()&&a.checkState([g.CallState.Active,g.CallState.Waiting])){var d=c&&a.getParticipant(c),e=d&&d.displayName;v.debug("[CircuitCallControlSvc]: Publish /screenshare/forceStop/started event"),w.publish("/screenshare/forceStop/started",[c]),tb.removeScreenShare(a.callId,function(a){v.debug("[CircuitCallControlSvc]: Publish /screenshare/forceStop/ended event"),w.publish("/screenshare/forceStop/ended",[a])}),A&&A.show({type:g.NotificationType.HIGH_PRIORITY,user:b.localUser,extras:{title:b.i18n.map.res_ScreenShareRemotelyDisabledTitle,text:e?b.i18n.localize("res_ScreenShareRemotelyDisabledByUser",[e]):b.i18n.map.res_ScreenShareRemotelyDisabled}})}}function hb(a){tb.mute(a),tb.disableRemoteAudio(a)}function ib(a,c,d){if(d=d||function(){},!a||!c)return v.error("[CircuitCallControlSvc]: addParticipant - Invalid arguments"),void d("Invalid arguments");var e=c.dialOutPhoneNumber,h=e?{userId:"gtc-callout-"+e.replace(/[+ ]+/g,""),phoneNumber:p.cleanPhoneNumber(e),displayName:c.displayName,resolvedUserId:c.userId,isExternal:!0,participantType:f.RTCParticipantType.TELEPHONY,pstnDialIn:!1}:c;if(!h.userId)return v.warn("[CircuitCallControlSvc]: addParticipant - Participant missing userId"),void d("Missing userId");if(a.hasParticipant(h.userId)||h.resolvedUserId&&a.hasParticipant(h.resolvedUserId))return v.info("[CircuitCallControlSvc]: addParticipantTo - Participant is already in the call"),void d("Participant exists");v.debug("[CircuitCallControlSvc]: Adding participant to existing RTC session. userId =",h.userId);var i=p.shallowCopy(a.mediaType);i.audio=!0;var j={rtcSessionId:a.callId,userId:h.userId,mediaType:i};e&&(j.from={phoneNumber:p.cleanPhoneNumber(b.localUser.callerId),displayName:b.localUser.displayName},j.to={phoneNumber:h.phoneNumber,displayName:h.displayName,resolvedUserId:h.resolvedUserId}),ub.addParticipantToRtcSession(j,function(c){b.$apply(function(){if(c){if(c===f.ErrorCode.PERMISSION_DENIED)return v.info("[CircuitCallControlSvc]: Failed to add participant. Reached conference participants limit"),void d("res_MaxConversationParticipantsLimit");v.warn("[CircuitCallControlSvc]: Failed to add participant"),d("res_AddParticipantToRtcSessionFailed")}else{if(v.debug("[CircuitCallControlSvc]: Add participant request was successful"),a.direction=g.CallDirection.OUTGOING,!a.isRemote){var b=_(h,["AUDIO"]),e=g.ParticipantState.Initiated,i=va(a,b,e);i&&(i.isCMP&&(i.isMeetingPointInvitee=!0,a.setMeetingPointInviteState(!0),hb(a.callId)),v.debug("[CircuitCallControlSvc]: Publish /call/participant/added event"),w.publish("/call/participant/added",[a.callId,i]))}d()}})})}function jb(a){v.debug("[CircuitCallControlSvc]: Publish /call/localUser/muted event"),w.publish("/call/localUser/muted",[a.callId,a.remotelyMuted,a.locallyMuted])}function kb(a,c,d){if(d=d||function(){},Eb.length>=1)return d("res_CannotJoinMultipleSessions"),!1;var e=xb&&xb.isPresent();if(e)if(xb.isTelephonyCall){if(!a.isTelephonyConv||!b.localUser.isATC)return d("res_CannotJoinMultipleSessions"),!1;if(yb)return d("res_CannotInitiateThirdPhoneCall"),!1}else if(!c)return d("res_CannotJoinMultipleSessions"),!1;for(var f=0;f<wb.length;f++)if(!wb[f].state.established&&wb[f].isTelephonyCall)return v.error("[CircuitCallControlSvc]: Cannot initiate second phone call if existing call is not established"),d("res_JoinRTCSessionFailed"),!1;return!0}var lb=a.Conversation,mb=a.UserProfile;v.debug("New Service: CircuitCallControlSvc (NEW)");var nb=p.isMobile(),ob="dotnet"===t.navigator.platform,pb=3200,qb=6e4,rb=6e3,sb=2e3,tb=this,ub=e.getInstance(),vb=o.getInstance(),wb=[],xb=null,yb=null,zb=[],Ab=null,Bb=!1,Cb=!1,Db={},Eb=[],Fb=null,Gb=!1,Hb=!1,Ib={},Jb=null,Kb=null;return w.subscribe("/conversation/update",function(a,c){if(c){var d=U(a.rtcSessionId);d&&!d.isDirect&&(v.debug("[CircuitCallControlSvc]: Received /conversation/update event"),c.addedParticipants&&oa(a),void 0!==c.isModerated&&d.participants.forEach(function(c){c.setActions(a,b.localUser)}))}}),w.subscribe("/conversation/upgrade",function(a,b){if(v.debug("[CircuitCallControlSvc]: Received /conversation/upgrade event. Old convId = "+a.convId+". New convId = ",b.convId),a.call&&b.convId!==a.convId&&a.call.checkState(g.CallState.Active))if(v.debug("[CircuitCallControlSvc]: Move Session"),a.type===f.ConversationType.DIRECT&&b.type===f.ConversationType.GROUP)da(b,a.call.localMediaType,{callOut:!0,handover:!1,replaces:a.call},function(c){c||a.call.sessionCtrl&&a.call.sessionCtrl.isMuted()&&b.call.sessionCtrl&&b.call.sessionCtrl.mute()});else{var c={sessionId:a.rtcSessionId,conversationId:a.convId,newSessionId:b.rtcSessionId,newConversationId:b.convId};ub.moveRtcSession(c,function(a){a&&v.warn("[CircuitCallControlSvc]: Error moving RTC Session. ",a)})}}),w.subscribe("/conversation/left",function(a){v.debug("[CircuitCallControlSvc]: Received /conversation/left event. convId = "+a.convId),a&&a.call&&tb.hideRemoteCall(a.call.callId)}),w.subscribe("/conversation/participants/add",function(a,b){v.debug("[CircuitCallControlSvc]: Received /conversation/participants/add event."),a&&b&&b.forEach(function(b){ib(a,b)})}),w.subscribe("/csta/handover",function(){v.debug("[CircuitCallControlSvc]: Received /csta/handover event."),Jb=r(function(){Jb=null},rb)}),w.subscribe("/atccall/moveFailed",function(){v.debug("[CircuitCallControlSvc]: Received /atccall/moveFailed event."),Jb&&(r.cancel(Jb),Jb=null)}),w.subscribe("/conversations/loadComplete",function(){v.debug("[CircuitCallControlSvc]: Received /conversations/loadComplete event"),Hb=!0,Wa(),T()}),w.subscribe("/registration/state",function(a){v.debug("[CircuitCallControlSvc]: Received /registration/state event"),a!==RegistrationState.Registered?(xb&&xb.isTestCall&&R(xb,g.CallClientTerminatedReason.LOST_WEBSOCKET_CONNECTION),Eb.forEach(function(a){v.debug("[CircuitCallControlSvc]: Lost websocket connection, terminate local incoming call"),R(a,g.CallClientTerminatedReason.LOST_WEBSOCKET_CONNECTION)}),a!==RegistrationState.Disconnected&&a!==RegistrationState.Waiting||wb.forEach(function(a){R(a,g.CallClientTerminatedReason.LOST_WEBSOCKET_CONNECTION)})):b.isSessionGuest&&xb&&Wa()}),w.subscribe("/conversation/re-added",function(a){v.debug("[CircuitCallControlSvc]: Received /conversation/re-added event. convId = ",a.convId),ub.getSession(a.rtcSessionId,function(c,d){c?v.warn("[CircuitCallControlSvc] Error retrieving session. Err: ",c):d.participants&&d.participants.length>0&&b.$apply(function(){_a(a,[d])})})}),w.subscribe("/call/meetingPointInvitee",function(a){if(v.debug("[CircuitCallControlSvc]: Received /call/meetingPointInvitee event"),a){var b=U(a);b&&(b.setMeetingPointInviteState(!0),hb(a))}}),a.isElectron&&(vb.on("DESKTOP_APP.PARTICIPANT_POINTER",function(a,b){try{v.debug("[CircuitCallControlSvc]: Received UserToUser DESKTOP_APP.PARTICIPANT_POINTER"),a.userId=b.srcUserId,y.getUserById(a.userId,function(b,c){return b?void v.error("[CircuitCallControlSvc]: User not found.",a.userId):void(xb.hasLocalScreenShare()&&(a.name=c.displayName,require("electron").ipcRenderer.send("participant-pointer",a)))})}catch(a){v.error("[CircuitCallControlSvc]: Exception handling UserToUser DESKTOP_APP.PARTICIPANT_POINTER event.",a)}}),vb.on("DESKTOP_APP.PARTICIPANT_DRAWING",function(a,c){try{v.debug("[CircuitCallControlSvc]: Received UserToUser DESKTOP_APP.PARTICIPANT_DRAWING"),b.circuitLabs.PARTICIPANT_DRAWING&&(a.userId=c.srcUserId,y.getUserById(a.userId,function(b,c){return b?void v.error("[CircuitCallControlSvc]: User not found.",a.userId):void(xb.hasLocalScreenShare()&&(a.name=c.displayName,require("electron").ipcRenderer.send("participant-drawing",a)))}))}catch(a){v.error("[CircuitCallControlSvc]: Exception handling UserToUser DESKTOP_APP.PARTICIPANT_POINTER event.",a)}})),vb.on("ATC.ADVANCING",function(a){try{if("ADVANCING"===a.type){v.debug("[CircuitCallControlSvc]: Received UserToUser ATC.ADVANCING");var b=qa(a.rtcSessionId);b&&(b.atcAdvancing=!0,b.sessionCtrl.setIgnoreNextConnection(!0))}}catch(a){v.error("[CircuitCallControlSvc]: Exception handling UserToUser ATC.ADVANCING event. ",a)}}),ub.on("RTCCall.SDP_ANSWER",function(a){try{v.debug("[CircuitCallControlSvc]: Received RTCCall.SDP_ANSWER");var c=U(a.sessionId);if(!c)return void v.warn("[CircuitCallControlSvc]: Unexpected event. There is no local call");if(ub.clientId!==a.clientID)return void v.debug("[CircuitCallControlSvc]: Event is not for this client: ",ub.clientId);b.$apply(function(){var b=a.sdp;if(b){var d=C.createActionInfo(c,f.RtcDiagnosticsAction.SDP_ANSWER);b.sdp&&"sdp"!==b.sdp&&"data"!==b.sdp||(b.sdp="sdp",v.debug("[CircuitCallControlSvc]: This is a mocked call"),c.setMockedCall()),c.setInstanceId(a.instanceId),c.sessionCtrl.setRemoteDescription(b,function(a){c.clearTransactionId(),a&&(c.setDisconnectCause(f.DisconnectCause.REMOTE_SDP_FAILED,"type="+b.type+" origin="+n.getOrigin(b.sdp)),la(c,null,g.CallClientTerminatedReason.SET_REMOTE_SDP_FAILED),d&&(d.data=a)),C.finishActionInfo(c,d)})}})}catch(a){v.error("[CircuitCallControlSvc]: Exception handling RTCCall.SDP_ANSWER event. ",a)}}),ub.on("RTCCall.ICE_CANDIDATES",function(a){try{v.debug("[CircuitCallControlSvc]: Received RTCCall.ICE_CANDIDATES",a);var b=U(a.sessionId);if(!b)return void v.warn("[CircuitCallControlSvc]: Unexpected event. There is no local call");if(ub.clientId!==a.clientId)return void v.debug("[CircuitCallControlSvc]: Event is not for this client: ",ub.clientId);b.sessionCtrl.addIceCandidates(a.origin,a.candidates);var c=C.createActionInfo(b,f.RtcDiagnosticsAction.REMOTE_ICE_CANDIDATES);c&&(c.data=a.candidates,C.finishActionInfo(b,c))}catch(a){v.error("[CircuitCallControlSvc]: Exception handling RTCCall.ICE_CANDIDATES event. ",a)}}),ub.on("RTCSession.SESSION_UPDATED",function(a){b.$apply(function(){try{v.debug("[CircuitCallControlSvc]: Received RTCSession.SESSION_UPDATED");var c;a.session.participants.some(function(a){if(a.userId===b.localUser.userId)return c=a,!0});var d,e=U(a.sessionId);if(c){var h=pa(a.sessionId);if(h)return v.debug("[CircuitCallControlSvc]: Event is for an existing active remote call"),h.mediaType=i.getMediaType(a.session.mediaTypes),h.setActiveClient(c),void O(h);var j=qa(a.sessionId);if(j)return void v.debug("[CircuitCallControlSvc]: Event is for an existing active remote call");if(!e||e.callId!==a.sessionId&&!X(!0))return(d=z.getConversationByRtcSession(a.sessionId))?c.clientId===ub.clientId?void v.warn("[CircuitCallControlSvc]: Event is for a local call that has been terminated. Ignore event."):void ga(d,c,a.session,function(b){b.setCallIdForTelephony(a.sessionId),Ua(b,a.session)}):void v.warn("[CircuitCallControlSvc]: Could not find corresponding conversation");if(c.clientId!==ub.clientId){d=D(e.convId);var k=null,l=null,m=null;e.isTelephonyCall&&(k=e.peerUser.phoneNumber,l=e.peerUser.displayName,m=e.participants);var n=e.atcCallInfo;return R(e,g.CallClientTerminatedReason.ANOTHER_CLIENT_PULLED_CALL),void ga(d,c,a.session,function(b){b.setCallIdForTelephony(a.sessionId),b.atcCallInfo=n,b.isTelephonyCall&&($(b,k,null,l),b.participants=m)})}e.remotelyMuted!==c.muted&&(e.remotelyMuted=c.muted,jb(e))}else if(!e||!e.isLarge)return void v.info("[CircuitCallControlSvc]: Not a large conference and local user is not in the participants list. Ignore event. ");
e.instanceId||e.setInstanceId(a.session.instanceId),a.session.muted!==e.sessionMuted&&(e.sessionMuted=a.session.muted,v.debug("[CircuitCallControlSvc]: Publish /call/muted event"),w.publish("/call/muted",[e])),a.session.locked!==e.sessionLocked&&(e.sessionLocked=a.session.locked,v.debug("[CircuitCallControlSvc]: Publish /call/locked event"),w.publish("/call/locked",[e])),a.stageAction&&(v.debug("[CircuitCallControlSvc]: Publish /call/raiseHand/stageAction event"),w.publish("/call/raiseHand/stageAction",[a.stageAction])),a.session.curtain&&(e.curtain=a.session.curtain,v.debug("[CircuitCallControlSvc]: Publish /call/curtain event (session updated)"),w.publish("/call/curtain",[e.curtain])),e.whiteboardEnabled=!!a.session.whiteboardEnabled;var o=[],p=[],q=a.session.participants||[];b.localUser.isCMP||q.some(function(a,c){if(a.userId===b.localUser.userId)return q.splice(c,1),!0});var r;if(e.isDirect||e.isAtcConferenceCall()||(r=e.participants.filter(function(a){return a.pcState!==g.ParticipantState.Initiated}).map(function(a){return a.userId})),q.length>0||e.conferenceCall){var s=i.getMediaType(a.session.mediaTypes);if(s.audio=s.audio||e.localMediaType.audio,s.video=s.video||e.localMediaType.video,s.desktop=s.desktop||e.localMediaType.desktop,e.mediaType=s,e.activeClient=null,e.replaces){var t=V(e.replaces.callId);t&&la(t,null,g.CallClientTerminatedReason.CALL_MOVED_TO_ANOTHER_CONV),v.debug("[CircuitCallControlSvc]: Publish /call/moved event"),w.publish("/call/moved",[e.replaces.callId,e.callId]),e.replaces=null}e.isAtcConferenceCall()||q.forEach(function(a){var b=!1,c=_(a),d=c.muted?g.ParticipantState.Muted:g.ParticipantState.Active,f=e.getParticipant(a.userId);if(W(c,e),f){r&&r.remove(a.userId);var h=f.pcState,i=f.videoUrl;f.streamId===c.streamId&&f.hasSameMediaType(c)||(b=!0);var j=wa(e,c,d);j&&(b||j.pcState!==h||j.videoUrl!==i)&&p.push(j)}else{var k=va(e,c,d);k&&o.push(k)}})}var u=e.state;if(za(a.session.attendeeCount),(e.conferenceCall||e.checkState(g.CallState.Answering))&&(e.isEstablished()||e.setState(g.CallState.Waiting),e.updateCallState()),e.checkState(u)||O(e),d=b.isSessionGuest?null:D(e.convId),oa(d),e.conferenceCall&&!e.hasOtherParticipants()&&(v.debug("[CircuitCallControlSvc]: Publish /conference/starting event"),w.publish("/conference/starting",[e])),r&&r.length>0&&r.forEach(function(a){var b=e.removeParticipant(a);b&&(v.debug("[CircuitCallControlSvc]: Publish /call/participant/removed event. userId = ",a),w.publish("/call/participant/removed",[e.callId,b]))}),p.length>0&&(v.debug("[CircuitCallControlSvc]: Publish /call/participants/updated event"),w.publish("/call/participants/updated",[e.callId,p])),o.length>0&&(v.debug("[CircuitCallControlSvc]: Publish /call/participants/added event"),w.publish("/call/participants/added",[e.callId,o])),!e.isTestCall&&a.session.recordingInfo&&a.session.recordingInfo.state!==f.RecordingInfoState.INITIAL){var x=ya(e,a.session.recordingInfo);x&&(v.debug("[CircuitCallControlSvc]: Publish /call/recording/info event"),w.publish("/call/recording/info",[e]))}e.isJoiningGroupCall=!1,K()}catch(a){v.error("[CircuitCallControlSvc]: Exception handling RTCSession.SESSION_UPDATED event. ",a)}})}),ub.on("RTCSession.SESSION_STARTED",function(a){if(!Hb)return void v.info("[CircuitCallControlSvc]: Conversations are not loaded. Do not process the SESSION_STARTED event.");try{v.debug("[CircuitCallControlSvc]: Received RTCSession.SESSION_STARTED");var c=U(a.sessionId);if(c&&c.isTestCall)return void v.debug("[CircuitCallControlSvc]: Received SESSION_STARTED event for echo test call. Just ignore it.");a.session.turnServers&&aa(a.sessionId,a.session.turnServers);var d=D(a.convId);if(!d){if(v.info("[CircuitCallControlSvc]: Could not find corresponding conversation"),a.callOut)return;return v.info("[CircuitCallControlSvc]: Get the conversation from the server"),void z.getConversationById(a.convId,{randomLoaded:!0},function(a,c){a?v.warn("[CircuitCallControlSvc]: Could not retrieve corresponding conversation. Delete Pending Invite"):(v.info("[CircuitCallControlSvc]: Successfully retrieved the conversation. Check if there are any active sessions."),ub.getActiveSessions(function(a,d){b.$apply(function(){a&&(v.error("[CircuitCallControlSvc]: Error getting active sessions: ",a),d=[]),_a(c,d)})}))})}if(!d.hasJoined)return void v.info("[CircuitCallControlSvc]: User is not a conversation participant. Ignore event.");b.$apply(function(){if(c)v.debug("[CircuitCallControlSvc]: Found local call for SESSION_STARTED event"),v.info("[CircuitCallControlSvc]: Ignore SESSION_STARTED. State =",c.state.name);else if(a.callOut)a.session.participants.some(function(c){if(c.userId===b.localUser.userId&&c.clientId!==ub.clientId)return ga(d,c,a.rtcSession,function(b){b.setCallIdForTelephony(a.sessionId),b.pullNotAllowed=!0}),!0});else if(d.type===f.ConversationType.GROUP||d.type===f.ConversationType.LARGE){var e=a.session.participants.find(function(a){return a.userId===b.localUser.userId&&a.clientId!==ub.clientId});ga(d,e,a.rtcSession,function(b){b.setCallIdForTelephony(a.sessionId),e||(v.debug("[CircuitCallControlSvc]: Publish /conference/started event"),w.publish("/conference/started",[b]))})}za(a.session.attendeeCount)})}catch(a){v.error("[CircuitCallControlSvc]: Exception handling RTCSession.SESSION_STARTED event: ",a)}}),ub.on("RTCSession.PARTICIPANT_JOINED",function(a){try{v.debug("[CircuitCallControlSvc]: Received RTCSession.PARTICIPANT_JOINED");var c=a.participant.userId;if(b.localUser.userId===c)return void v.debug("[CircuitCallControlSvc]: Ignore JOINED event for own user");var d=pa(a.sessionId);if(d)return void b.$apply(function(){d.pullNotAllowed&&(d.pullNotAllowed=!1),d.isTelephonyCall&&!d.atcCallInfo&&$(d,a.participant.phoneNumber,null,a.participant.userDisplayName)});var e=U(a.sessionId);if(!e)return void v.info("[CircuitCallControlSvc]: Event is not for local call. Ignore it.");if(!e.isEstablished()&&e.direction===g.CallDirection.INCOMING)return void v.info("[CircuitCallControlSvc]: Ignore JOINED event for incoming alerting calls");b.$apply(function(){if(a.participant.userDisplayName&&a.participant.userDisplayName.startsWith("VoiceMail of")&&e.sessionCtrl.setCallStatsOptions({sendOnlyStream:!0}),e.isTelephonyCall&&!e.atcCallInfo&&$(e,a.participant.phoneNumber,null,a.participant.userDisplayName),e.checkState([g.CallState.Delivered,g.CallState.Waiting])&&(e.checkState(g.CallState.Delivered)?e.setState(g.CallState.Waiting):e.conferenceCall&&e.sessionCtrl.isConnected()&&e.setState(g.CallState.Active),e.activeClient=null,e.replaces)){var b=V(e.replaces.callId);b&&la(b,null,g.CallClientTerminatedReason.CALL_MOVED_TO_ANOTHER_CONV),v.debug("[CircuitCallControlSvc]: Publish /call/moved event"),w.publish("/call/moved",[e.replaces.callId,e.callId]),e.replaces=null}var d=_(a.participant),f=d.muted?g.ParticipantState.Muted:g.ParticipantState.Active;if(W(d,e),e.hasParticipant(c)){var h=wa(e,d,f);h&&(v.debug("[CircuitCallControlSvc]: Publish /call/participant/updated event"),w.publish("/call/participant/updated",[e.callId,h]))}else{var i=va(e,d,f);i&&(v.debug("[CircuitCallControlSvc]: Publish /call/participant/added event"),w.publish("/call/participant/added",[e.callId,i]))}var j=a.userEnteredStage?{userEnteredStage:a.userEnteredStage}:null;v.debug("[CircuitCallControlSvc]: Publish /call/participant/joined event"),w.publish("/call/participant/joined",[e,e.getParticipant(d.userId),j]),K(),e.updateMediaType(),O(e),oa()})}catch(a){v.error("[CircuitCallControlSvc]: Exception handling RTC.PARTICIPANT_JOINED event. ",a)}}),ub.on("RTCSession.SESSION_MOVED",function(a){try{if(v.debug("[CircuitCallControlSvc]: Received RTCSession.SESSION_MOVED"),Ib[a.oldRtcSessionId])return v.info("[CircuitCallControlSvc]: Event is for a pending INVITE. Ignore it."),void delete Ib[a.oldRtcSessionId];var c=V(a.oldRtcSessionId);if(!c)return void v.info("[CircuitCallControlSvc]: Event is not for local or remote call. Ignore it.");var d=D(a.oldConversationId),e=D(a.newConversationId);if(!d||!e)return void v.warn("[CircuitCallControlSvc]: Could not find corresponding conversations");b.$apply(function(){if(Xa(e,d,c),c.isRemote)return void v.debug("[CircuitCallControlSvc]: Session Moved for Remote Call");if("iOS"!==t.navigator.platform&&oa(e),e.creatorId===b.localUser.userId){var a={};d.participants.forEach(function(b){a[b.userId]=!0}),e.participants.forEach(function(b){a[b.userId]||ib(c,b)})}})}catch(a){v.error("[CircuitCallControlSvc]: Exception handling RTC.SESSION_MOVED event. ",a)}}),ub.on("RTCSession.WHITEBOARD_ENABLED",function(a){var c=V(a.sessionId);c&&b.$apply(function(){c.whiteboardEnabled=!0,w.publish("/call/whiteboard/enabled",[c,a.whiteboard]),v.debug("[CircuitCallControlSvc]: Publish /call/whiteboard/enabled event")})}),ub.on("RTCSession.WHITEBOARD_DISABLED",function(a){var c=V(a.sessionId);c&&b.$apply(function(){c.whiteboardEnabled=!1,w.publish("/call/whiteboard/disabled",[c]),v.debug("[CircuitCallControlSvc]: Publish /call/whiteboard/disabled event")})}),ub.on("RTCCall.INVITE",function(a){if(!Hb)return void v.info("[CircuitCallControlSvc]: Conversations are not loaded. Do not process the INVITE event.");if(b.localUser.isCMP){if(b.localUser.userPresenceState.state===f.PresenceState.BUSY)return v.info("[CircuitCallControlSvc]: CMP is updating its software. Reject the INVITE with cause BUSY."),void ia(a);if(!b.inviterUserId||b.inviterUserId!==a.userId)return v.info("[CircuitCallControlSvc]: Reject the INVITE with cause BUSY."),void ia(a)}try{v.debug("[CircuitCallControlSvc]: Received RTCCall.INVITE");var c=a.isGuestInvite&&!b.localUser.isCMP,d=D(a.convId);if(!d){v.info("[CircuitCallControlSvc]: Could not find corresponding conversation. Save pending INVITE and retrieve conversation.");var e=a.sessionId;return Ib[e]=a,void(c?z.createConversationAsGuestFromSummary(a.convId).then(function(a){Ib[e]&&(v.info("[CircuitCallControlSvc]: Successfully retrieved conversation. Process the pending INVITE message."),$a(Ib[e],a),delete Ib[e])}).catch(function(){v.warn("[CircuitCallControlSvc]: Could not create temporary conversation from summary."),delete Ib[e]}):z.getConversationById(a.convId,{randomLoaded:!0,sessionId:a.sessionId},function(a,c){a?v.warn("[CircuitCallControlSvc]: Could not retrieve corresponding conversation. Delete Pending Invite"):Ib[e]?(v.info("[CircuitCallControlSvc]: Successfully retrieved conversation. Process the pending INVITE message."),$a(Ib[e],c)):(v.info("[CircuitCallControlSvc]: Successfully retrieved conversation. Check if there are any active sessions."),ub.getActiveSessions(function(a,d){b.$apply(function(){a&&(v.error("[CircuitCallControlSvc]: Error getting active sessions: ",a),d=[]),_a(c,d)})})),delete Ib[e]}))}if(c&&(d=z.createConversationAsGuest(d)),!d.hasJoined&&!c)return void v.info("[CircuitCallControlSvc]: User is not a conversation participant. Ignore event.");b.$apply(function(){$a(a,d)})}catch(a){v.error("[CircuitCallControlSvc]: Exception handling RTCCall.INVITE event. ",a)}}),ub.on("RTCSession.PARTICIPANT_LEFT",function(a){b.$apply(function(){try{v.debug("[CircuitCallControlSvc]: Received RTCSession.PARTICIPANT_LEFT");var c=b.localUser.userId===a.userId,d=U(a.sessionId),e=[f.RTCSessionParticipantLeftCause.TRANSPORT_NEGOTIATION_FAILED,f.RTCSessionParticipantLeftCause.NEGOTIATION_FAILED,f.RTCSessionParticipantLeftCause.SECURITY_NEGOTIATION_FAILED];if(c){if(d&&!d.isDirect&&!d.isEstablished()&&!e.includes(a.cause))return void v.debug("[CircuitCallControlSvc]: Ignore PARTICIPANT_LEFT event for non-established group calls");v.debug("[CircuitCallControlSvc]: Publish /localUser/leftConference event"),w.publish("/localUser/leftConference",[a.sessionId])}var h=pa(a.sessionId);if(h)return v.info("[CircuitCallControlSvc]: Event is for active remote call."),void(c&&ha(h));if(!d){var i=qa(a.sessionId);if(i&&!i.isDirect&&i.hasParticipant(a.userId)){v.info("[CircuitCallControlSvc]: Event is for an incoming call. Caller has left the conversation."),xa(i,a.userId,a.cause);var j=D(i.convId);j&&(ga(j),R(i,g.CallClientTerminatedReason.CALLER_LEFT_CONFERENCE))}else v.info("[CircuitCallControlSvc]: Event is not for local call. Ignore it.");return}if(d.isTestCall)return void v.debug("[CircuitCallControlSvc]: Ignore PARTICIPANT_LEFT event for test calls");if(d.isDirect)return void(c||a.cause!==f.RTCSessionParticipantLeftCause.CONNECTION_LOST&&a.cause!==f.RTCSessionParticipantLeftCause.STREAM_LOST?v.debug("[CircuitCallControlSvc]: Ignore PARTICIPANT_LEFT event for direct calls"):d.setParticipantState(a.userId,g.ParticipantState.ConnectionLost));var k=a.userId,l=D(d.convId);if(c){if(ga(l),a.cause===f.RTCSessionParticipantLeftCause.REMOVED){var m=d.getParticipant(a.requesterId);w.publish("/call/droppedRemotely",[d,m])}else if(e.includes(a.cause))return void Ka(d,{error:"res_CallMediaFailed"});R(d,g.CallServerTerminatedReason.SERVER_ENDED_PRFX+a.cause)}else{if(a.cause===f.RTCSessionParticipantLeftCause.MAX_PARTICIPANTS_REACHED){var n=l.participants.some(function(a){return a.userId===k}),o=function(a,b){a||(v.debug("[CircuitCallControlSvc]: Publish /call/participant/rejected event"),w.publish("/call/participant/rejected",[d.callId,b]))};return void(n?y.getUserById(k,o):o())}xa(d,k,a.cause)}}catch(a){v.error("[CircuitCallControlSvc]: Exception handling RTCSession.PARTICIPANT_LEFT event. ",a)}})}),ub.on("RTCCall.SDP_FAILED",function(a){try{v.debug("[CircuitCallControlSvc]: Received RTCCall.SDP_FAILED with cause =",a.cause);var c=U(a.sessionId);if(!c)return void v.warn("[CircuitCallControlSvc]: Unexpected event. There is no local call");if(ub.clientId!==a.clientID)return void v.debug("[CircuitCallControlSvc]: Event is not for this client");if(c.instanceId||c.setInstanceId(a.instanceId),a.cause===f.SdpFailedCause.SESSION_TERMINATED)return void v.debug("[CircuitCallControlSvc]: SDP_FAILED due to session terminated. Ignore");b.$apply(function(){c.isEstablished()?c.sessionCtrl.renegotiationFailed():a.cause===f.SdpFailedCause.MAX_PARTICIPANTS_REACHED?Ka(c,{error:"res_JoinRTCSessionFailedPermission"}):c.isDirect&&c.isCallOut||(a.cause===f.SdpFailedCause.SESSION_STARTED_FAILED?R(c,g.CallServerTerminatedReason.SERVER_ENDED_PRFX+a.cause):la(c,null,g.CallClientTerminatedReason.REQUEST_TO_SERVER_FAILED))})}catch(a){v.error("[CircuitCallControlSvc]: Exception handling RTCCall.SDP_FAILED event. ",a)}}),ub.on("RTCSession.SESSION_TERMINATED",function(a){try{if(v.debug("[CircuitCallControlSvc]: Received RTCSession.SESSION_TERMINATED"),Db[a.sessionId]&&delete Db[a.sessionId],Ib[a.sessionId])return v.info("[CircuitCallControlSvc]: Event is for a pending INVITE. Ignore it."),void delete Ib[a.sessionId];var c=V(a.sessionId);if(!c)return void v.warn("[CircuitCallControlSvc]: Could not find call with rtcSessionId =",a.sessionId);if(c.terminateTimer)return void v.info("[CircuitCallControlSvc]: Call is already being terminated. Ignore event");c.isTelephonyCall&&Jb&&(v.debug("[CircuitCallControlSvc]: Call is being moved to another device, keep showing"),c.setAtcHandoverInProgress(),r.cancel(Jb),Jb=null),b.$apply(function(){var b=a.cause;v.info("[CircuitCallControlSvc]: Publish /call/terminated. cause = ",b),w.publish("/call/terminated",[c,b]),R(c,g.CallServerTerminatedReason.SERVER_ENDED_PRFX+b)})}catch(a){v.error("[CircuitCallControlSvc]: Exception handling RTCSession.SESSION_TERMINATED event. ",a)}}),ub.on("RTCCall.INVITE_CANCEL",function(a){try{if(ub.clientId===a.clientID)return void v.debug("[CircuitCallControlSvc]: Ignore own INVITE_CANCEL");if(Ib[a.sessionId])return v.info("[CircuitCallControlSvc]: Event is for a pending INVITE. Ignore it."),void delete Ib[a.sessionId];b.$apply(function(){v.debug("[CircuitCallControlSvc]: Received RTCCall.INVITE_CANCEL with cause: ",a.cause);var b=qa(a.sessionId);if(b){if(!b.isDirect||a.cause===f.InviteCancelCause.ACCEPT){var c=D(b.convId),d=a.cause===f.InviteCancelCause.ACCEPT?{clientId:a.clientID}:null;ga(c,d,null,function(c){c.setCallIdForTelephony(a.sessionId),d&&c.isTelephonyCall&&$(c,b.peerUser.phoneNumber,null,b.peerUser.displayName)})}var e=g.CallClientTerminatedReason.ANOTHER_CLIENT_REJECTED;a.cause===f.InviteCancelCause.ACCEPT?e=g.CallClientTerminatedReason.ANOTHER_CLIENT_ANSWERED:a.cause===f.InviteCancelCause.REVOKED&&(e=g.CallClientTerminatedReason.ENDED_BY_ANOTHER_USER),R(b,e)}else if(v.debug("[CircuitCallControlSvc]: There is no corresponding alerting call"),a.cause===f.InviteCancelCause.ACCEPT){var h=V(a.sessionId);h&&h.isRemote&&(v.debug("[CircuitCallControlSvc]: There is a remote call, probably ringing timeout or another client called in"),h.activeClient={clientId:a.clientID},h.setState(g.CallState.ActiveRemote),ra(h),O(h))}})}catch(a){v.error("[CircuitCallControlSvc]: Exception handling RTCCall.INVITE_CANCEL event. ",a)}}),ub.on("RTCCall.INVITE_FAILED",function(a){try{v.debug("[CircuitCallControlSvc]: Received RTCCall.INVITE_FAILED");var c=U(a.sessionId);if(!c)return void v.warn("[CircuitCallControlSvc]: Unexpected event. There is no local call");if(!c.isDirect){var d=c.getParticipant(a.userId);if(a.to){d.displayName=a.to.displayName;var e=wa(c,d);e&&(v.debug("[CircuitCallControlSvc]: Publish /call/participant/updated event"),w.publish("/call/participant/updated",[c.callId,e]))}if(d&&d.isActive())return void v.debug("[CircuitCallControlSvc]: Unexpected event. participant already connected: ",a.userId)}if(a.clientID&&ub.clientId!==a.clientID)return void v.debug("[CircuitCallControlSvc]: Event is not for this client: ",ub.clientId);c.isTelephonyCall&&a.to&&$(c,a.to.phoneNumber,a.to.fullyQualifiedNumber,a.to.displayName,a.to.userId),b.$apply(function(){var b,d=c,e=a.cause,h=a.userId;switch(e){case f.InviteFailedCause.NOT_REACHABLE:b=g.ParticipantState.Offline,d.isDirect&&d.setState(g.CallState.Failed);break;case f.InviteFailedCause.BUSY:b=g.ParticipantState.Busy,d.isDirect&&d.setState(g.CallState.Busy);break;case f.InviteFailedCause.DECLINE:b=g.ParticipantState.Declined,d.isDirect&&d.setState(g.CallState.Declined);break;case f.InviteFailedCause.TIMEOUT:b=g.ParticipantState.Timeout,d.isDirect&&d.setState(g.CallState.NotAnswered);break;case f.InviteFailedCause.TEMPORARILY_UNAVAILABLE:case f.InviteFailedCause.INVALID_NUMBER:b=g.ParticipantState.Busy,d.isDirect&&d.setState(g.CallState.Failed);break;case f.InviteFailedCause.REVOKED:b=g.ParticipantState.Removed,d.isDirect&&d.setState(g.CallState.Failed);break;default:v.warn("[CircuitCallControlSvc]: Unexpected RTCCall.INVITE_FAILED cause =",a.cause),b=g.ParticipantState.Busy,d.isDirect&&d.setState(g.CallState.Failed)}if(d.isDirect)d.setParticipantState(h,b),O(d),d.hasVideo()&&d.removeParticipant(h),la(d,null,g.CallServerTerminatedReason.SERVER_ENDED_PRFX+e,!0);else{d.setParticipantState(h,b);var i=d.removeParticipant(h);i&&(v.debug("[CircuitCallControlSvc]: Publish /call/participant/removed event"),w.publish("/call/participant/removed",[d.callId,i]),d.participants.isEmpty()&&(d.conferenceCall?d.checkState(g.CallState.Waiting)||(d.setState(g.CallState.Waiting),O(d)):(d.setState(g.CallState.NotAnswered),O(d),la(null,null,g.CallServerTerminatedReason.SERVER_ENDED_PRFX+e,!0))))}})}catch(a){v.error("[CircuitCallControlSvc]: Exception handling RTC.INVITE_FAILED event. ",a)}}),ub.on("RTCSession.ACTIVE_SPEAKER",Ra),ub.on("RTCSession.VIDEO_ACTIVE_SPEAKER",Sa),ub.on("RTCCall.CHANGE_MEDIA_TYPE_REQUESTED",function(a){try{v.debug("[CircuitCallControlSvc]: Received RTCSession.CHANGE_MEDIA_TYPE_REQUESTED");var c=qa(a.sessionId);if(c)return void Ya(a.sessionId,a.transactionId);var d=U(a.sessionId);if(!d||d.isRemote)return void v.info("[CircuitCallControlSvc]: Event is not for local call. Ignore it.");if(a.clientID&&ub.clientId!==a.clientID)return void v.debug("[CircuitCallControlSvc]: Event is not for this client: ",ub.clientId);if(d.activeClient)return void v.debug("[CircuitCallControlSvc]: Pull in progress. leave it for active client to handle");if(!d.isEstablished()&&d.direction===g.CallDirection.INCOMING||!d.isDirect)return void Ya(d.callId,a.transactionId);b.$apply(function(){if(a.sdp){var c=d.sessionCtrl;if(!c.isConnStable())return void Ya(d.callId,a.transactionId);d.setTransactionId(a.transactionId),d.isTelephonyCall&&d.atcAdvancing&&"nooffer"!==a.sdp.type&&d.sessionCtrl.setIgnoreTurnOnNextPC();var e=function(a){c.onSessionDescription=null;var e={rtcSessionId:d.callId,sdp:a.sdp,transactionId:d.transactionId};ub.changeMediaAccept(e,function(a){b.$apply(function(){d.clearTransactionId(),a?v.error("[CircuitCallControlSvc]: changeMediaAccept sdp answer sending error"):v.debug("[CircuitCallControlSvc]: changeMediaAccept sdp answer sent")})})};d.atcAdvancing=!1,F(d).then(function(b){c.setTurnCredentials(b),n.isNoOfferSdp(a.sdp)?ea(d.callId,d.transactionId,d.localMediaType,!1,null,function(a){a&&v.warn("[CircuitCallControlSvc]: Failed to renegotiate the media")}):(c.onSessionDescription=e,c.setRemoteDescription(a.sdp,function(b){b&&(c.onSessionDescription=null,d.transactionId===a.transactionId?Ya(d.callId,a.transactionId):v.warn("[CircuitCallControlSvc]: TransactionId: "+a.transactionId+" has already been completed."))}))}).catch(function(){Ya(d.callId,a.transactionId)})}else Ya(d.callId,a.transactionId)})}catch(a){v.error("[CircuitCallControlSvc]: Exception handling RTCSession.CHANGE_MEDIA_REQUESTED event. ",a)}}),ub.on("RTCCall.CHANGE_MEDIA_TYPE_FORCED",function(a){try{v.debug("[CircuitCallControlSvc]: Received RTCSession.CHANGE_MEDIA_TYPE_FORCED");var c=U(a.sessionId);if(!c)return void v.info("[CircuitCallControlSvc]: Event is not for local call. Ignore it.");if(c.isDirect)return void v.debug("[CircuitCallControlSvc]: Event is not applicable for direct calls. Ignore it.");if(a.clientID&&ub.clientId!==a.clientID)return void v.debug("[CircuitCallControlSvc]: Event is not for this client: ",ub.clientId);if(c.activeClient)return void v.debug("[CircuitCallControlSvc]: Pull in progress. leave it for active client to handle");a.removeMediaTypes&&(c.localMediaType.desktop&&a.removeMediaTypes.includes(f.RealtimeMediaType.DESKTOP_SHARING)&&b.$apply(function(){gb(c,a.userId)}),a.removeMediaTypes.includes(f.RealtimeMediaType.AUDIO)&&b.$apply(function(){tb.removeAudio(c.callId)}))}catch(a){v.error("[CircuitCallControlSvc]: Exception handling RTCSession.CHANGE_MEDIA_TYPE_FORCED event. ",a)}}),ub.on("RTCCall.RTC_QUALITY_RATING_EVENT",function(a){v.debug("[CircuitCallControlSvc]: Received RTCCall.RTC_QUALITY_RATING_EVENT"),b.$apply(function(){v.debug("[CircuitCallControlSvc]: Publish /call/showRatingDialog event"),w.publish("/call/showRatingDialog",[a])})}),ub.on("RTCSession.PARTICIPANT_UPDATED",function(a){try{v.debug("[CircuitCallControlSvc]: Received RTCSession.PARTICIPANT_UPDATED");var c=U(a.sessionId),d=pa(a.sessionId)||c;if(d&&d.callId===a.sessionId&&d.isTelephonyCall&&!d.atcCallInfo&&b.localUser.userId!==a.participant.userId&&$(d,a.participant.phoneNumber,null,a.participant.userDisplayName),!c)return void v.info("[CircuitCallControlSvc]: Event is not for local call. Ignore it.");b.$apply(function(){var d=a.participant.userId,e=a.participant.muted;if(b.localUser.userId===d)return void(c.remotelyMuted!==e&&(c.remotelyMuted=e,jb(c)));if(!c.isEstablished()&&c.direction===g.CallDirection.INCOMING)return void v.debug("[CircuitCallControlSvc]: Ignore UPDATED event for incoming alerting calls");var f=c.getParticipant(a.participant.userId);if(!f)return void v.debug("[CircuitCallControlSvc]: Ignore UPDATED event, can not find participant to update for userId: ",d);var h=_(a.participant),i=h.muted?g.ParticipantState.Muted:g.ParticipantState.Active,j=f.muted!==h.muted,k=!f.hasSameMediaType(h)||f.streamId!==h.streamId,l=wa(c,h,i);l&&(W(l,c),k&&c.updateMediaType(),(k||j)&&(v.debug("[CircuitCallControlSvc]: Publish /call/participant/updated event"),w.publish("/call/participant/updated",[c.callId,l]))),O(c)})}catch(a){v.error("[CircuitCallControlSvc]: Exception handling RTCSession.PARTICIPANT_UPDATED event. ",a)}}),ub.on("RTCSession.SESSION_RECORDING_INFO",function(a){v.debug("[CircuitCallControlSvc]: Received RTCSession.SESSION_RECORDING_INFO");var c=U(a.sessionId);return c?void b.$apply(function(){var b=ya(c,a.recordingInfo);b&&(v.debug("[CircuitCallControlSvc]: Publish /call/recording/info event"),w.publish("/call/recording/info",[c]))}):void v.warn("[CircuitCallControlSvc]: Unexpected event. There is no local call")}),ub.on("RTCSession.SESSION_TERMINATION_TIMER_STARTED",function(a){v.debug("[CircuitCallControlSvc]: Received RTCSession.SESSION_TERMINATION_TIMER_STARTED");var c=U(a.sessionId);return c?void b.$apply(function(){v.debug("[CircuitCallControlSvc]: Publish /call/sessionTerminateTimerChanged (started)"),w.publish("/call/sessionTerminateTimerChanged",[c.callId,a.endTime])}):void v.warn("[CircuitCallControlSvc]: Unexpected event. There is no local call")}),ub.on("RTCSession.SESSION_TERMINATION_TIMER_CANCELLED",function(a){v.debug("[CircuitCallControlSvc]: Received RTCSession.SESSION_TERMINATION_TIMER_CANCELLED");var c=U(a.sessionId);return c?void b.$apply(function(){v.debug("[CircuitCallControlSvc]: Publish /call/sessionTerminateTimerChanged (cancelled)"),w.publish("/call/sessionTerminateTimerChanged",[c.callId,null])}):void v.warn("[CircuitCallControlSvc]: Unexpected event. There is no local call")}),ub.on("RTCSession.SESSION_ATTRIBUTES_CHANGED_EVENT",function(a){v.debug("[CircuitCallControlSvc]: Received RTCSession.SESSION_ATTRIBUTES_CHANGED_EVENT");var c=U(a.sessionId);return c?void 0===a.attendeeCount||c.attendeeCount===a.attendeeCount?void v.debug("[CircuitCallControlSvc]: No changes"):void b.$apply(function(){za(a.attendeeCount)}):void v.warn("[CircuitCallControlSvc]: Unexpected event. There is no local call")}),ub.on("RTCCall.PROGRESS",function(a){v.debug("[CircuitCallControlSvc]: Received RTCCall.PROGRESS");var c=U(a.sessionId);if(!c)return void v.info("[CircuitCallControlSvc]: Event is not for local or remote call. Ignore it.");if(c.isDirect&&(a.sdp||a.progressType!==f.RTCProgressType.ALERTING?a.sdp&&c.receivedAlerting&&(v.debug("[CircuitCallControlSvc]: Publish /sound/call/alerting/stopped, call ID: ",c.callId),w.publish("/sound/call/alerting/stopped",[c])):(c.receivedAlerting=!0,v.debug("[CircuitCallControlSvc]: Publish /sound/call/alerting/started, call ID: ",c.callId),w.publish("/sound/call/alerting/started",[c]))),!c.checkState([g.CallState.Initiated,g.CallState.Delivered]))return void v.info("[CircuitCallControlSvc]: Ignore PROGRESS. Call state =",c.state.name);a.to&&c.isTelephonyCall&&$(c,a.to.phoneNumber,a.to.fullyQualifiedNumber,a.to.displayName,a.to.userId);try{b.$apply(function(){!a.sdp||"answer"!==a.sdp.type&&"pranswer"!==a.sdp.type||(a.sdp.type="pranswer",c.isPranswer=!0,c.sessionCtrl.setRemoteDescription(a.sdp,function(b){b&&(c.setDisconnectCause(f.DisconnectCause.REMOTE_SDP_FAILED,"type="+a.sdp.type+" origin="+n.getOrigin(a.sdp.sdp)),la(c,null,g.CallClientTerminatedReason.SET_REMOTE_SDP_FAILED))})),c.setState(g.CallState.Delivered),O(c)})}catch(a){v.error("[CircuitCallControlSvc]: Exception handling RTCCall.PROGRESS event.",a)}}),ub.on("RTCSession.INVITE_TO_STAGE_EVENT",function(a){return v.debug("[CircuitCallControlSvc]: Received RTCSession.INVITE_TO_STAGE_EVENT"),U(a.sessionId)?void b.$apply(function(){var b={invitedByUserId:a.invitedByUserId,allowedMediaTypes:a.allowedMediaTypes,expirationTime:p.delayOrTimestamp(a.expirationDelay,a.expirationTime)};v.debug("[CircuitCallControlSvc]: Publish /call/raiseHand/invite, questionNumber: ",a.questionNumber),w.publish("/call/raiseHand/invite",[a.questionNumber,b])}):void v.warn("[CircuitCallControlSvc]: Unexpected event. There is no local call")}),ub.on("RTCSession.INVITE_TO_STAGE_CANCEL_EVENT",function(a){return v.debug("[CircuitCallControlSvc]: Received RTCSession.INVITE_TO_STAGE_CANCEL_EVENT"),U(a.sessionId)?void b.$apply(function(){v.debug("[CircuitCallControlSvc]: Publish /call/raiseHand/invite (cancel), questionNumber: ",a.questionNumber),w.publish("/call/raiseHand/invite",[a.questionNumber,null])}):void v.warn("[CircuitCallControlSvc]: Unexpected event. There is no local call")}),ub.on("RTCSession.QUESTION_EVENT",function(a){return v.debug("[CircuitCallControlSvc]: Received RTCSession.QUESTION_EVENT"),U(a.sessionId)?void b.$apply(function(){v.debug("[CircuitCallControlSvc]: Publish /call/raiseHand/question, questionNumber: ",a.question.questionNumber),w.publish("/call/raiseHand/question",[a.question,a.subType])}):void v.warn("[CircuitCallControlSvc]: Unexpected event. There is no local call")}),ub.on("RTCSession.CURTAIN_EVENT",function(a){return v.debug("[CircuitCallControlSvc]: Received RTCSession.CURTAIN_EVENT"),U(a.sessionId)?void b.$apply(function(){xb.curtain=a.curtain,v.debug("[CircuitCallControlSvc]: Publish /call/curtain event"),w.publish("/call/curtain",[xb.curtain])}):void v.warn("[CircuitCallControlSvc]: Unexpected event. There is no local call")}),this.initActiveSessionsForSdk=function(){return Hb=!0,Wa()},this.initForUnitTests=function(){Hb=!0},this.setDisableRemoteVideoByDefault=function(a){v.info("[CircuitCallControlSvc] Setting _disableRemoteVideoByDefault to ",!!a),Cb=!!a},this.getDisableRemoteVideoByDefault=function(){return Cb},this.setClientDiagnosticsDisabled=function(a){Gb=a},this.getCalls=function(){return wb},this.getPhoneCalls=function(a){return wb.filter(function(b){return b.isTelephonyCall&&(!a||!b.isRemote)})},this.getEstablishedLocalPhoneCalls=function(){return wb.filter(function(a){return a.isTelephonyCall&&a.state.established&&!a.isRemote})},this.getActiveCall=function(a){return a?U(a):xb&&xb.replaces?xb.replaces:xb||null},this.getIncomingCall=function(){return Eb[0]||null},this.getActiveRemoteCall=function(){return zb},this.joinGroupCall=function(a,b,c){if(c=c||function(){},!a)return v.warn("[CircuitCallControlSvc]: joinGroupCall - Invalid Call Id"),void c("Missing callId");var d=V(a);if(!d||!d.isRemote||d.state.name!==g.CallState.Started.name||d.activeClient)return v.warn("[CircuitCallControlSvc]: joinGroupCall invoked without a valid call"),void c("Invalid call");var e=D(d.convId);if(!e||!e.call||e.call.callId!==d.callId)return v.warn("[CircuitCallControlSvc]: joinGroupCall - Cannot find valid conversation"),void c("Invalid conversation");var f={callOut:!1,handover:!1,joiningGroupCall:!0};bb(e,b,f,c)},this.makeCall=function(a,b,c){if(c=c||function(){},!a)return v.warn("[CircuitCallControlSvc]: makeCall - Invalid Conversation Id"),void c("Missing convId");var d=D(a);return d?void bb(d,b,{callOut:!0,handover:!1},c):(v.warn("[CircuitCallControlSvc]: makeCall - Cannot find conversation with id ",a),void c("Conversation not found"))},this.makeEchoTestCall=function(a,c,d){c=c||function(){},d=d||function(){};var e=b.isSessionGuest&&b.localUser.conversationId||"echo_"+b.localUser.clientId,f={creatorId:b.localUser.userId,convId:e,rtcSessionId:"echo_"+b.localUser.clientId,participants:[{userId:b.localUser.userId}],testCall:!0};f=lb.extend(f),c(f.rtcSessionId),r(function(){da(f,a,{callOut:!1,handover:!1},d)},200)},this.dialNumber=function(a,b,c,d){d=d||function(){},z.getTelephonyConversation(function(e,f){e||!f?d(e):bb(f,c,{callOut:!0,handover:!1,dialedDn:a,toName:b},d)})},this.dialPhoneNumber=function(a,b){b=b||function(){},a=a||{},z.getTelephonyConversation(function(c,d){if(c||!d)b(c);else{if(!kb(d,!1,b))return;if(xb&&xb.isTelephonyCall&&!xb.isHolding())return void tb.holdCall(xb.callId,function(c){c?b&&b(c):bb(d,a.mediaType,{callOut:!0,handover:!1,dialedDn:a.dialedDn,toName:a.toName,userId:a.userId},b)});bb(d,a.mediaType,{callOut:!0,handover:!1,dialedDn:a.dialedDn,toName:a.toName,userId:a.userId},b)}})},this.startConference=function(a,b,c){if(b=b||{audio:!0,video:!1},c=c||function(){},!a)return v.warn("[CircuitCallControlSvc]: startConference - Invalid Conversation Id"),void c("Missing convId");var d=D(a);return d?d.type!==f.ConversationType.GROUP&&d.type!==f.ConversationType.LARGE?(v.warn("[CircuitCallControlSvc]: startConference - Invalid conversation type"),void c("Invalid conversation type")):void bb(d,b,{callOut:!1,handover:!1},c):(v.warn("[CircuitCallControlSvc]: startConference - Cannot find conversation with id ",a),
void c("Conversation not found"))},this.answerCall=function(a,c,d){function e(){yb=xb,xb=i,K(),Eb.splice(h,1),db(xb),xb.stopRingingTimer(),xb.setState(xb.isATCCall?g.CallState.Waiting:g.CallState.Answering);var a=D(xb.convId);return a&&a.call&&a.call.callId===xb.callId?(O(xb),void cb(c,function(b,c){fa(a,b,{warning:c},d)})):(v.warn("[CircuitCallControlSvc]: joinCall - Cannot find valid conversation"),ka(xb,{type:f.InviteRejectCause.BUSY},!1),void d("Conversation not found"))}d=d||function(){};var h,i=null;if(Eb.some(function(b,c){if(a===b.callId)return i=b,h=c,!0}),!i)return v.warn("[CircuitCallControlSvc]: answerCall - There is no alerting call"),void d("No alerting call");if(xb&&xb.isPresent()&&(!xb.isTelephonyCall||!i.isTelephonyCall||nb&&!b.circuitLabs.SECOND_TELEPHONY_CALL_SUPPORT)&&!i.replaces||!b.localUser.isATC)la(xb,null,g.CallClientTerminatedReason.USER_ENDED),yb&&la(yb,null,g.CallClientTerminatedReason.USER_ENDED);else if(xb&&xb.isTelephonyCall&&b.localUser.isATC&&!xb.isHolding())return void tb.holdCall(xb.callId,function(a){a?d&&d(a):e()});e()},this.endCall=function(a,b){var c=f.InviteRejectCause.DECLINE,d=tb.getActiveCall();d&&d.callId===a&&(d.isEstablished()||d.direction===g.CallDirection.OUTGOING)&&(c=null),tb.endCallWithCauseCode(a,c,b)},this.endCallWithCauseCode=function(a,b,c){var d;d=b?"string"==typeof b&&b.startsWith(g.CallClientTerminatedReason.CLIENT_ENDED_PRFX)?b:g.CallClientTerminatedReason.CLIENT_ENDED_PRFX+b:g.CallClientTerminatedReason.USER_ENDED;var e=U(a);if(e)e.replaces&&e.checkState(g.CallState.Answering)?c("Auto answer in progress"):e.terminateTimer?(R(e,d),c&&r(c)):la(e,b,d,!1,c);else if(xb&&xb.replaces&&xb.replaces.callId===a)la(xb.replaces,b,d,!1,c);else{var h=V(a);if(h)return void(h.terminateTimer?(R(h),c&&r(c)):la(h,b,d,!1,c));var i=qa(a);if(i)ka(i,{type:b||f.InviteRejectCause.DECLINE},!1,c);else{v.warn("[CircuitCallControlSvc]: endCall - There is no local or alerting call");var j=z.getConversationByRtcSession(a);j&&j.call&&(j.call=null,N(j)),c&&c("Call not found")}}},this.endConference=function(a,c){var d=V(a);d?b.isSessionGuest||d.isGuestInvite?c&&c("Not allowed"):ma(d,c):c&&c("Call not found")},this.startScreenShare=function(a,b,c){if(c=c||function(){},!a)return v.warn("[CircuitCallControlSvc]: startScreenShare - Invalid Conversation Id"),void c("Invalid convId");var d=D(a);if(!d)return v.warn("[CircuitCallControlSvc]: startScreenShare - Cannot find conversation with id ",a),void c("Conversation not found");var e={audio:!0,video:!1,desktop:!0},f={callOut:!0,handover:!1,screenConstraint:b};da(d,e,f,function(a){a||(v.debug("[CircuitCallControlSvc]: Publish /screenshare/started event"),w.publish("/screenshare/started")),c(a)})},this.addScreenShare=function(a,b,c){c=c||function(){};var d=U(a);if(!d)return v.warn("[CircuitCallControlSvc]: addScreenShare - There is no local call"),void c("No active call");var e={audio:d.localMediaType.audio,video:!1,desktop:!0};ea(a,null,e,!1,null,function(a){a||(v.debug("[CircuitCallControlSvc]: Publish /screenshare/started event"),w.publish("/screenshare/started")),c(a)},b)},this.addMediaStream=function(a,b,c){c=c||function(){};var d=U(a);if(!d)return v.warn("[CircuitCallControlSvc]: addMediaStream - There is no local call"),void c("No active call");var e={audio:d.localMediaType.audio,video:!1,desktop:!0};ea(a,null,e,!1,null,function(a){a?c("res_AddMediaStreamFailed"):c()},{mediaStream:b})},this.removeMediaStream=function(a,b){b=b||function(){};var c=U(a);if(!c)return v.warn("[CircuitCallControlSvc]: removeMediaStream - There is no local call"),void b("No active call");v.debug("[CircuitCallControlSvc]: removeMediaStream...");var d={audio:c.localMediaType.audio,video:c.localMediaType.video,desktop:!1};ea(a,null,d,!1,null,function(a){a?b("res_RemoveMediaStreamFailed"):b()})},this.selectMediaToShare=function(a,b,c){c=c||function(){};var d=U(a);if(!d)return v.warn("[CircuitCallControlSvc]: selectMediaToShare - There is no local call"),void c("No active call");v.debug("[CircuitCallControlSvc]: selectMediaToShare...");var e={audio:d.localMediaType.audio,video:!1,desktop:!0};ea(a,null,e,!0,null,c,b),w.publish("/screenshare/changed")},this.removeScreenShare=function(a,b){b=b||function(){};var c=U(a);if(!c)return v.warn("[CircuitCallControlSvc]: removeScreenShare - There is no local call"),void b("No active call");v.debug("[CircuitCallControlSvc]: removeScreenShare...");var d={audio:c.localMediaType.audio,video:c.localMediaType.video,desktop:!1};ea(a,null,d,!1,null,function(a){a?b("res_RemoveScreenShareFailed"):b()})},this.addAudio=function(a,b){b=b||function(){};var c=U(a);if(!c)return v.warn("[CircuitCallControlSvc]: addAudio - There is no local call"),void b("No active call");var d={audio:!0,video:c.localMediaType.video,desktop:c.localMediaType.desktop};ea(a,null,d,!1,null,function(a){a?(v.warn("[CircuitCallControlSvc]: addAudio -> Failed to renegotiate the media. ",a),b("Renegotiate for receive-only media failed")):(v.debug("[CircuitCallControlSvc]: addAudio -> Media renegotiation was successful"),b())})},this.removeAudio=function(a,b){b=b||function(){};var c=U(a);if(!c)return v.warn("[CircuitCallControlSvc]: removeAudio - There is no local call"),void b("No active call");v.debug("[CircuitCallControlSvc]: removeAudio...");var d={audio:!1,video:c.localMediaType.video,desktop:c.localMediaType.desktop};ea(a,null,d,!1,null,function(a){a?(v.warn("[CircuitCallControlSvc]: removeAudio -> Failed to renegotiate the media. ",a),b("Renegotiate for receive-only media failed")):(v.debug("[CircuitCallControlSvc]: removeAudio -> Media renegotiation was successful"),b())})},this.enableRemoteAudio=function(a){var b=U(a);return b?void(b.remoteAudioDisabled&&(b.enableRemoteAudio(),v.debug("[CircuitCallControlSvc]: Publish /call/remoteStreamUpdated event"),w.publish("/call/remoteStreamUpdated",[b]))):void v.warn("[CircuitCallControlSvc]: enableRemoteAudio - There is no local call")},this.disableRemoteAudio=function(a){var b=U(a);return b?void(b.remoteAudioDisabled||(b.disableRemoteAudio(),v.debug("[CircuitCallControlSvc]: Publish /call/remoteStreamUpdated event"),w.publish("/call/remoteStreamUpdated",[b]))):void v.warn("[CircuitCallControlSvc]: disableRemoteAudio - There is no local call")},this.addVideo=function(a,b){b=b||function(){};var c=U(a);if(!c)return v.warn("[CircuitCallControlSvc]: addVideo - There is no local call"),void b("No active call");var d={audio:c.localMediaType.audio,video:!0,desktop:!1};ea(a,null,d,!1,null,function(a){a?b("res_AddVideoFailed"):b()})},this.removeVideo=function(a,b){b=b||function(){};var c=U(a);if(!c)return v.warn("[CircuitCallControlSvc]: removeVideo - There is no local call"),void b("No active call");v.debug("[CircuitCallControlSvc]: removeVideo...");var d={audio:c.localMediaType.audio,video:!1,desktop:c.localMediaType.desktop};ea(a,null,d,!1,null,function(a){a?b("res_RemoveVideoFailed"):b()})},this.toggleRemoteVideo=function(a,b){b=b||function(){};var c=U(a);if(!c)return v.warn("[CircuitCallControlSvc]: toggleRemoteVideo - There is no local call"),void b("No active call");v.debug("[CircuitCallControlSvc]: toggleRemoteVideo...");var d=c.sessionCtrl;return d.isConnStable()?(c.remoteVideoDisabled?c.enableRemoteVideo():(c.disableRemoteVideo(),w.publish("/call/toggleRemoteVideo")),void ea(a,null,c.localMediaType,!1,null,function(a){a?(c.remoteVideoDisabled?c.enableRemoteVideo():c.disableRemoteVideo(),v.warn("[CircuitCallControlSvc]: Failed to renegotiate the media"),b("res_ToggleVideoFailed")):(b(),!c.remoteVideoDisabled&&w.publish("/call/toggleRemoteVideo"))})):void b("Connection not stable")},this.changeHDVideo=function(a,b,c){c=c||function(){};var d=U(a);if(!d)return v.warn("[CircuitCallControlSvc]: changeHDVideo - There is no local call"),void c("No active call");if(!d.mediaType.video)return v.warn("[CircuitCallControlSvc]: changeHDVideo - Local call has no video"),void c("No video");if(b=!!b,d.localMediaType.hdVideo===b)return void c();v.debug("[CircuitCallControlSvc]: changeHDVideo...");var e={audio:xb.localMediaType.audio,video:!0,hdVideo:b,desktop:!1};ea(a,null,e,!1,null,function(a){a?c("Error changing media"===a?"res_ToggleVideoFailed":a):c()})},this.toggleVideo=function(a,b){b=b||function(){};var c=U(a);if(!c)return v.warn("[CircuitCallControlSvc]: toggleVideo - There is no local call"),void b("No active call");v.debug("[CircuitCallControlSvc]: toggleVideo...");var d={audio:c.localMediaType.audio,video:!c.localMediaType.video,desktop:c.localMediaType.desktop};d.video&&(d.desktop=!1),ea(a,null,d,!1,null,function(a){a?b("Error changing media"===a?"res_ToggleVideoFailed":a):b()})},this.renegotiateMedia=function(a,b){b=b||function(){};var c=U(a);return c?(v.debug("[CircuitCallControlSvc]: renegotiateMedia..."),void ea(a,null,c.localMediaType,!1,null,function(a){a?(v.warn("[CircuitCallControlSvc]: Failed to renegotiate the media"),b("Renegotiate media failed")):b()})):(v.warn("[CircuitCallControlSvc]: renegotiateMedia - There is no local call"),void b("No active call"))},this.setMediaType=function(a,b,c){c=c||function(){};var d=U(a);return d?(v.debug("[CircuitCallControlSvc]: setMediaType..."),void ea(a,null,b,!1,null,function(a){a?(v.warn("[CircuitCallControlSvc]: Failed to renegotiate the media"),c("Renegotiate media failed")):c()})):(v.warn("[CircuitCallControlSvc]: setMediaType - There is no local call"),void c("No active call"))},this.holdCall=function(a,b){b=b||function(){};var c=U(a);return c?c.isHolding()||c.isHoldInProgress()?(v.debug("[CircuitCallControlSvc]: holdCall - The call is already held"),void b()):(v.debug("[CircuitCallControlSvc]: holdCall..."),c.setHoldInProgress(),void ea(a,null,c.localMediaType,!1,!0,function(a){c.clearHoldInProgress(),a?(v.warn("[CircuitCallControlSvc]: Failed to hold the call"),b("res_HoldCallFailed")):b()})):(v.warn("[CircuitCallControlSvc]: holdCall - There is no call"),void b("No active call"))},this.retrieveCall=function(a,b){b=b||function(){};var c=U(a);return c.isHolding()?(v.debug("[CircuitCallControlSvc]: retrieveCall..."),c.setRetrieveInProgress(),void ea(a,null,c.localMediaType,!1,!1,function(a){if(c.clearRetrieveInProgress(),a)v.warn("[CircuitCallControlSvc]: Failed to retrieve the call"),b("res_RetrieveCallFailed");else{c===yb&&(yb=xb,xb=c);var d=D(xb.convId);d.call=xb,N(d),b()}})):(v.debug("[CircuitCallControlSvc]: retrieveCall - There is no held local call"),void b())},this.swapCall=function(a,b){if(b=b||function(){},yb=tb.getPhoneCalls(!0).length>1?Y(!0):null,!yb||!xb)return v.warn("[CircuitCallControlSvc]: swapCall - There are no held and active local calls"),void b("No calls to swap");if(yb&&yb.callId!==a)return v.warn("[CircuitCallControlSvc]: swapCall - Wrong callId of the held call"),void b("Wrong callId");var c=yb.callId,d=xb.callId;tb.holdCall(d,function(a){a?b&&b(a):tb.retrieveCall(c,b)})},this.pullRemoteCall=function(a,b,c){function d(){var d=e.activeClient||{},g={audio:!0,video:!(!d.mediaType||!d.mediaType.video)};b&&(g.video=!1),bb(f,g,{callOut:!1,handover:!0,callId:a},c)}c=c||function(){};var e=pa(a);if(!e)return v.warn("[CircuitCallControlSvc]: pullRemoteCall invoked without a valid call"),void c("No active remote call");if(e.pullNotAllowed)return void c("res_PullCallNotAllowed");var f=D(e.convId);return f&&f.call.callId===a?xb&&xb.isTelephonyCall?void tb.holdCall(xb.callId,function(a){a?c&&c(a):d()}):void d():(v.warn("[CircuitCallControlSvc]: pullRemoteCall - Cannot find valid conversation"),void c("Conversation not found"))},this.endRemoteCall=function(a,b){b=b||function(){};var c=pa(a);if(!c)return v.warn("[CircuitCallControlSvc]: endRemoteCall invoked without a valid call"),void b("No active remote call");var d=D(c.convId);return d&&d.call.callId===a?void na(c,function(a){a?b("res_EndRemoteCallFailed"):(ha(c),b())}):(v.warn("[CircuitCallControlSvc]: endRemoteCall - Cannot find valid conversation"),void b("Conversation not found"))},this.hideRemoteCall=function(a){var b=V(a);return b?void R(b):void v.warn("[CircuitCallControlSvc]: hideRemoteCall invoked without a valid call")},this.dropParticipant=function(a,b,c){c=c||function(){};var d=U(a);return!d||d.isDirect?(v.warn("[CircuitCallControlSvc]: dropParticipant - invalid call"),void c("Call invalid")):b&&b.userId?(b.isCMP&&b.isMeetingPointInvitee&&(d.setMeetingPointInviteState(!1),tb.enableRemoteAudio(a)),v.debug("[CircuitCallControlSvc]: Dropping participant in existing RTC session. userId =",b.userId),void sa(b.userId,c)):(v.warn("[CircuitCallControlSvc]: dropParticipant - Invalid participant"),void c("Participant invalid"))},this.addParticipantToCall=function(a,b,c){var d=U(a);d?ib(d,b,c):(v.warn("[CircuitCallControlSvc]: addParticipantToCall - There is no local call"),c&&c("Invalid callId"))},this.addParticipantToRtcSession=function(a,b,c){var d=V(a);d?ib(d,b):(v.warn("[CircuitCallControlSvc]: addParticipantToRtcSession - Call not found"),c&&c("Invalid callId"))},this.mute=function(a,c){c=c||function(){};var d=U(a);return d&&a===d.callId?void(d.locallyMuted?c("Call already muted"):(v.debug("[CircuitCallControlSvc]: Mute the local call"),d.mute(function(){b.$apply(function(){v.debug("[CircuitCallControlSvc]: Publish /call/localUser/mutedSelf event"),w.publish("/call/localUser/mutedSelf",[a,!0]),c()})}))):(v.warn("[CircuitCallControlSvc]: mute - There is no local call"),void c("Call not valid"))},this.unmuteLocally=function(a){xb&&xb.locallyMuted&&(v.debug("[CircuitCallControlSvc]: Unmute the local call"),xb.unmute(function(){b.$apply(function(){v.debug("[CircuitCallControlSvc]: Publish /call/localUser/mutedSelf event"),w.publish("/call/localUser/mutedSelf",[xb.callId,!1]),a&&a()})}))},this.unmute=function(a,c){c=c||function(){};var d=U(a);if(!d)return void v.warn("[CircuitCallControlSvc]: unmute - There is no local call");if(!d.isMuted())return void c("Call not muted");var e=d.remotelyMuted;tb.unmuteLocally(e?null:c),e&&tb.unmuteParticipant(d.callId,b.localUser,c)},this.toggleMute=function(a,b){b=b||function(){};var c=U(a);return c?c.isLocalMuteAllowed()?void(c.isMuted()?tb.unmute(c.callId,b):tb.mute(c.callId,b)):(v.warn("[CircuitCallControlSvc]: toggleMute - Local Mute is not allowed"),void b()):(v.warn("[CircuitCallControlSvc]: toggleMute - There is no local call"),void b("Call not valid"))},this.muteParticipant=function(a,c,d){d=d||function(){};var e=U(a);if(!e)return v.warn("[CircuitCallControlSvc]: muteParticipant - There is no local call"),void d("Call invalid");var f=c&&c.userId;if(!f)return v.warn("[CircuitCallControlSvc]: muteParticipant - Invalid participant ID"),void d("Participant invalid");v.debug("[CircuitCallControlSvc]: Mute participant in existing RTC session. participantId =",f);var g={rtcSessionId:e.callId,usersIds:[f],muted:!0};ub.muteParticipant(g,function(a){b.$apply(function(){a?(v.warn("[CircuitCallControlSvc]: Failed to mute participant"),d("res_MuteParticipantFailed")):d()})})},this.hasUnmutedParticipants=function(a){var b=U(a);return b&&a===b.callId?b.hasUnmutedParticipants():(v.warn("[CircuitCallControlSvc]: hasUnmutedParticipants - There is no local call"),!1)},this.muteRtcSession=function(a,c){c=c||function(){};var d=U(a);if(!d||a!==d.callId)return v.warn("[CircuitCallControlSvc]: muteRtcSession - There is no local call"),void c("Call invalid");if(d.hasUnmutedParticipants()){v.debug("[CircuitCallControlSvc]: Mute RTC session (all other participants)");var e={rtcSessionId:d.callId,muted:!0,excludedUserIds:[b.localUser.userId]};ub.muteRtcSession(e,function(a){b.$apply(function(){a?(v.warn("[CircuitCallControlSvc]: Failed to mute RTC session"),c("res_MuteAllOtherParticipantsFailed")):c()})})}},this.unmuteParticipant=function(a,c,d){d=d||function(){};var e=U(a);if(!e)return v.warn("[CircuitCallControlSvc]: unmuteParticipant - There is no local call"),void d("Call invalid");var f=c&&c.userId;if(!f)return v.warn("[CircuitCallControlSvc]: unmuteParticipant - Invalid participant ID"),void d("Participant invalid");if(f!==b.localUser.userId)return v.warn("[CircuitCallControlSvc]: Cannot unmute remote participant"),void d("Cannot unmute others");v.debug("[CircuitCallControlSvc]: Unmute participant in existing RTC session. userId =",f);var g={rtcSessionId:e.callId,usersIds:[f],muted:!1};ub.muteParticipant(g,function(a){b.$apply(function(){a?(v.warn("[CircuitCallControlSvc]: Failed to unmute participant"),d("res_UnmuteParticipantFailed")):(e.remotelyMuted=!1,jb(e),d())})})},this.toggleMuteParticipant=function(a,b,c){c=c||function(){};var d=U(a);return d?b&&b.userId?b.muted?tb.unmuteParticipant(a,b,c):tb.muteParticipant(a,b,c):(v.warn("[CircuitCallControlSvc]: unmuteParticipant - Invalid participant ID"),void c("Participant invalid")):(v.warn("[CircuitCallControlSvc]: toggleMuteParticipant - There is no local call"),void c("Call invalid"))},this.stopRingingTone=function(a){var b=qa(a);return b?(b.ringToneStopped=!0,v.debug("[CircuitCallControlSvc]: stopRingingTone for call with callId = ",a),void w.publish("/call/ringingTone/stop",[a])):void v.warn("[CircuitCallControlSvc]: stopRingingTone - incoming call not found: ",a)},this.endActiveCall=function(a){a=a||function(){},xb?tb.endCall(xb.callId,a):a("No active call")},this.startRecording=function(a,c){if(!xb)return v.warn("[CircuitCallControlSvc]: startRecording - There is no local call"),void a("No active call");var d={audio:!0,video:!1,desktop:!!c},e={convId:xb.convId,rtcSessionId:xb.callId,mediaTypes:d};ub.startRecording(e,function(c){b.$apply(function(){a&&a(c)})})},this.stopRecording=function(a){if(!xb)return v.warn("[CircuitCallControlSvc]: stopRecording - There is no local event call"),void a("No active call");var c={convId:xb.convId,rtcSessionId:xb.callId};ub.stopRecording(c,function(c){b.$apply(function(){a&&a(c)})})},this.submitCallQualityRating=function(a,c,d){return a&&a.hasOwnProperty("rating")&&c?(Object.assign(a,c),void ub.submitCallQualityRating([a],function(a){b.$apply(function(){d&&d(a)})})):(v.warn("[CircuitCallControlSvc]: submitCallQualityRating - Missing rating or call data"),void(d&&d("No rating data")))},this.raiseQuestion=function(a,c,d){if(!xb||!xb.isLarge)return v.warn("[CircuitCallControlSvc]: raiseQuestion - There is no local event call"),void d("No active event");var e={convId:xb.convId,rtcSessionId:xb.callId,question:a,displayName:b.localUser.displayName,isAnonymous:!!c};ub.raiseQuestion(e,function(a,c){b.$apply(function(){d&&d(a,c)})})},this.inviteToStage=function(a,c){if(!xb||!xb.isLarge)return v.warn("[CircuitCallControlSvc]: inviteToStage - There is no local event call"),void c("No active event");var d={convId:xb.convId,rtcSessionId:xb.callId,questionNumber:a};ub.inviteToStage(d,function(a){b.$apply(function(){c&&c(a)})})},this.inviteToStageAnswer=function(a,c,d){if(!xb||!xb.isLarge)return v.warn("[CircuitCallControlSvc]: inviteToStageAnswer - There is no local event call"),void d("No active event");var e={convId:xb.convId,rtcSessionId:xb.callId,questionNumber:a,isAccepted:!!c};ub.inviteToStageAnswer(e,function(a){b.$apply(function(){!a&&c?tb.addAudio(xb.callId,function(a){a||tb.unmuteLocally(),d&&d(a)}):d&&d(a)})})},this.inviteToStageCancel=function(a,c){if(!xb||!xb.isLarge)return v.warn("[CircuitCallControlSvc]: inviteToStageCancel - There is no local event call"),void c("No active event");var d={convId:xb.convId,rtcSessionId:xb.callId,questionNumber:a};ub.inviteToStageCancel(d,function(a){b.$apply(function(){c&&c(a)})})},this.removeFromStage=function(a,c){if(!xb||!xb.isLarge)return v.warn("[CircuitCallControlSvc]: removeFromStage - There is no local event call"),void c("No active event");var d={convId:xb.convId,rtcSessionId:xb.callId,userToRemoveId:a||b.localUser.userId};ub.removeFromStage(d,function(a){b.$apply(function(){c&&c(a)})})},this.getQuestions=function(a,c,d){if(!xb||!xb.isLarge)return v.warn("[CircuitCallControlSvc]: getQuestions - There is no local event call"),void d("No active event");var e={convId:xb.convId,rtcSessionId:xb.callId,startQuestionNumber:a,numberOfQuestions:c};ub.getQuestions(e,function(a,c){b.$apply(function(){d&&d(a,c)})})},this.updateQuestionState=function(a,c,d){if(!xb||!xb.isLarge)return v.warn("[CircuitCallControlSvc]: updateQuestionState - There is no local event call"),void d("No active event");var e={convId:xb.convId,rtcSessionId:xb.callId,questionNumber:a,newQuestionState:c};ub.updateQuestionState(e,function(a,c){b.$apply(function(){d&&d(a,c)})})},this.openCurtain=function(a){if(!xb||!xb.isLarge)return v.warn("[CircuitCallControlSvc]: openCurtain - There is no local event call"),void a("No active event");var c={convId:xb.convId,rtcSessionId:xb.callId};ub.openCurtain(c,function(c){b.$apply(function(){a&&a(c)})})},this.closeCurtain=function(a,c,d,e){if(!xb||!xb.isLarge)return v.warn("[CircuitCallControlSvc]: closeCurtain - There is no local event call"),void e("No active event");var f={curtainState:a};c&&(f.message=c),d&&(f.pauseDuration=d);var g={convId:xb.convId,rtcSessionId:xb.callId,curtain:f};ub.closeCurtain(g,function(a){b.$apply(function(){e&&e(a)})})},this.getNodeState=function(a,c,d){var e={convId:"noCall",nodeType:a,tenantId:c||""};ub.getNodeState(e,function(a,c){b.$apply(function(){a&&v.error("[CircuitCallControlSvc]: Failed to get node(s). ",a),d&&d(a,c)})})},this.canSendWebRTCDigits=function(){return xb&&xb.sessionCtrl.canSendDTMFDigits()},this.sendDigits=function(a,b,c){c=c||function(){};var d=U(a);return d?b?/^[\d#\*,]+$/.exec(b)?void ab(a,b,c):(v.error("[CircuitCallControlSvc]: Digits cannot be sent: "+b+" (Allowed: 0-9,#,*)"),void c("res_InvalidDtmf")):void c("res_InvalidDtmf"):(v.warn("[CircuitCallControlSvc]: sendDigits - There is no local call"),void c("Call not valid"))},this.disableIncomingVideo=function(a){xb&&xb.sameAs(a)&&(v.debug("[CircuitCallControlSvc]: Disabling remote incoming video. Call ID=",xb.callId),xb.sessionCtrl.disableIncomingVideo())},this.enableIncomingVideo=function(a){xb&&xb.sameAs(a)&&(v.debug("[CircuitCallControlSvc]: Enabling remote incoming video. Call ID=",xb.callId),xb.sessionCtrl.enableIncomingVideo())},this.toggleParticipantPointer=function(a){var b=U(a);return b?b.pointer&&b.pointer.isSupported?(b.pointer.isEnabled=!b.pointer.isEnabled,void ea(b.callId,b.transactionId,b.localMediaType,!1,null,null,null)):void v.warn("[CircuitCallControlSvc]: toggleParticipantPointer - Local call does not support participant pointer"):void v.warn("[CircuitCallControlSvc]: toggleParticipantPointer - There is no local call")},this.findCall=V,this.findActivePhoneCall=X,this.findHeldPhoneCall=Y,this.sendParticipantPointer=eb,this.sendParticipantDrawing=fb,this.removeCallFromList=M,this.isSecondCall=function(){return xb||Eb.length>=1||!zb.isEmpty()},this.updateActiveCallMediaDevices=function(){xb&&xb.updateMediaDevices()},this.addSimulatedParticipants=function(){var a=20,b=5e4,c=2500,d=12e4,e=2500,h=tb.getActiveCall();if(h&&!h.isDirect&&h.isMocked&&!(h.participants.length>0)){var i=function(){h.isPresent()&&0!==h.participants.length&&(xa(h,h.participants[0].userId),h.participants.length>0&&r(i,e))},j=function(e){function k(){var a={isSimulated:!0,userId:(b+e).toString(),mediaTypes:[f.RealtimeMediaType.AUDIO],muted:!1};return e>0&&!(e%6)?(a.participantType=f.RTCParticipantType.MEETING_POINT,a.userDisplayName="CMR ("+e+")"):(a.participantType=f.RTCParticipantType.SESSION_GUEST,a.userDisplayName=[Math.floor(e/10),e%10].join(" ")),a}var l=_(k());!h.isMeetingPointInvited&&l.isCMP&&(l.isMeetingPointInvitee=!0,h.setMeetingPointInviteState(!0),hb(h.callId));var m=va(h,l,g.ParticipantState.Active);w.publish("/call/participant/added",[h.callId,m]),w.publish("/call/participant/joined",[h,m]),K(),e<a-1?r(function(){h.isPresent()&&j(e+1)},c):r(i,d)};j(0),h.setState(g.CallState.Active),O(h)}},this}var c=a.AtcCallInfo,d=a.BusyHandlingOptions,e=a.ClientApiHandlerSingleton,f=a.Constants,g=a.Enums,h=a.LocalCall,i=a.Proto,j=a.RemoteCall,k=a.RoutingOptions,l=a.RtcParticipant,m=a.RtcSessionController,n=a.sdpParser,o=a.UserToUserHandlerSingleton,p=a.Utils,q=a.WebRTCAdapter;return a.CircuitCallControlSvcImpl=b,a}(Circuit),Circuit=function(a){"use strict";function b(a,b,y,z,A,B,C,D){function E(a,c,d,e,f){a.setPeerUser(c,e);var g=b(function(){g=null,a.isPresent()&&(f&&f(),f=null)},Sa,!1);C.startReverseLookUp(d,function(d){b.cancel(g),a.isPresent()&&(d&&a.setPeerUser(c,d.displayName,d.userId),f&&f())})}function F(a,c,d,e,f,g){if(!a.redirectingUser||!a.redirectingUser.redirectionType){a.setRedirectingUser(c,d,e,null,f);var h=b(function(){h=null,a.isPresent()&&(g&&g(),g=null)},Sa,!1);C.startReverseLookUp(d,function(e){b.cancel(h),a.isPresent()&&(e&&a.setRedirectingUser(c,d,e.displayName,e.userId,f),g&&g())})}}function G(){if(!tb.length)return void(ub=!1);var a=tb.splice(0,1);C.startPhoneCallSearch(a[0].phoneNumber,function(){var c=C.getUserSearchList().slice(0),d=a[0].call;delete a[0].call;var e=null;e=1===c.length?d.addParticipant({userId:c[0].userId,phoneNumber:a[0].phoneNumber,displayName:c[0].displayName,participantId:a[0].participantId}):d.addParticipant(a[0]),e&&eb&&(y.debug("[CstaSvc]: Publish /atccall/participant/added"),z.publish("/atccall/participant/added",[d.callId,e])),b(G,0)})}function H(){a.localUser.isATC&&(eb||D.getTelephonyConversationPromise().then(function(a){eb=a}).catch(function(){y.debug("[CstaSvc]: No telephony conversation found")}),Object.assign(ab,B.getAtcRegistrationData()),fb=J(),gb=K(),hb=L(),jb=M(),kb.length>0&&(kb=kb.filter(function(a){return!a.checkState(j.Terminated)||(fb===a&&(fb=null),gb===a&&(gb=null),hb===a&&(hb=null),jb===a&&(jb=null),!1)})),fb||hb||gb||jb||kb.empty())}function I(a){for(var b=0;b<kb.length;b++)if(kb[b].callId===a.callId){var c=kb[b].atcCallInfo;return a.peerUser.phoneNumber!==kb[b].peerUser.phoneNumber&&c.clearServicesPermitted(),kb[b]=a,a.atcCallInfo&&a.atcCallInfo.cstaConn||(kb[b].atcCallInfo=c),kb[b]}return null}function J(){var a=A.getActiveCall();if(a&&a.isTelephonyCall){var b=I(a);if(b)return b;var c=Object.create(a);return c.atcCallInfo=a.atcCallInfo||new d,kb.push(c),c}}function K(){var a=A.findHeldPhoneCall();if(a){var b=I(a);if(b)return b;var c=Object.create(a);return c.atcCallInfo=a.atcCallInfo||new d,kb.push(c),c}}function L(){var a=A.getIncomingCall();if(a&&a.isTelephonyCall){var b=I(a);if(b)return b;var c=Object.create(a);return c.atcCallInfo=a.atcCallInfo||new d,kb.push(c),c}}function M(){var a=A.getActiveRemoteCall()[0];if(a&&a.isTelephonyCall){var b=I(a);return b?b:(a.atcCallInfo=a.atcCallInfo||new d,kb.push(a),a)}}function N(a){if(ib[a]){y.debug("[CstaSvc]: Remove remote call with Call Id = "+a);var b=ib[a];O(b),b.setCstaState(m.Idle),y.debug("[CstaSvc]: Publish /atccall/info event"),z.publish("/atccall/info",[b]),delete ib[a]}}function O(c){if(!a.localUser.noCallLog){if(!c)return void y.error("[CstaSvc]: No remoteCall");if(!c.atcCallInfo.getIgnoreCall()&&c.isAtcRemote){if(!eb)return void y.error("[CstaSvc]: No telephony conversation");if(!c.peerUser.phoneNumber&&c.peerUser.displayName===eb.peerUser.displayName)return void y.warn("[CstaSvc]: This call has no peer display information.");var d=c.atcCallInfo.originalPartnerDisplay&&c.atcCallInfo.originalPartnerDisplay.fqn&&c.atcCallInfo.originalPartnerDisplay.fqn!==c.atcCallInfo.peerFQN,e={phoneNumber:d?c.atcCallInfo.originalPartnerDisplay.dn:c.peerUser.phoneNumber,displayName:d?c.atcCallInfo.originalPartnerDisplay.name:c.peerUser.displayName,userId:d?eb.peerUser.userId:c.peerUser.userId||eb.peerUser.userId,resolvedUser:!!c.peerUser.userId&&!d,fqn:d?c.atcCallInfo.originalPartnerDisplay.fqn:c.atcCallInfo.peerFQN},f={convId:eb.convId,starter:c.direction===i.INCOMING?e.userId:a.localUser.userId,source:c.direction===i.INCOMING?e.fqn:a.localUser.phoneNumber,destination:c.direction===i.OUTGOING?e.fqn:a.localUser.phoneNumber,startTime:c.creationTime,duration:c.establishedTime?Date.now()-c.establishedTime:0,type:0===c.establishedTime?o.MISSED:o.REGULAR,participants:[{userId:a.localUser.userId,type:"USER",phoneNumber:a.localUser.phoneNumber,displayName:a.localUser.displayName},{userId:e.userId,type:"TELEPHONY",phoneNumber:e.phoneNumber,displayName:e.displayName,resolvedUser:e.resolvedUser}]};if(f.type===o.MISSED)switch(c.atcCallInfo.getMissedReason()){case p.DEST_OUT_OF_ORDER:f.missedReason=l.RTCItemMissed.UNREACHABLE;break;case p.REORDER_TONE:f.missedReason=l.RTCItemMissed.INVALID_NUMBER;break;case p.BUSY:f.missedReason=l.RTCItemMissed.USER_BUSY;break;case p.CANCELLED:f.missedReason=l.RTCItemMissed.CANCELED;break;case p.DECLINED:f.missedReason=l.RTCItemMissed.DECLINED;break;case p.TRANSFERRED:f.type=o.REGULAR;break;default:f.missedReason=l.RTCItemMissed.TEMPORARILY_UNAVAILABLE}if(pb)cb.addJournalEntry(f);else{var g=1e3+1e3*Math.random();b(function(){P(f)||cb.addJournalEntry(f)},g,!1)}}}}function P(a){var b=a&&a.participants&&a.participants[1];return!!b&&sb.some(function(a,c){if(v.cleanPhoneNumber(a.phoneNumber)===v.cleanPhoneNumber(b.phoneNumber)&&a.displayName===b.displayName)return y.debug("[CstaSvc]: Call log entry already sent by another client"),sb.splice(c,1),!0})}function Q(){for(var a in ib)ib.hasOwnProperty(a)&&N(a)}function R(a){for(var b in ib)if(ib.hasOwnProperty(b)&&ib[b].callId===a)return ib[b];return null}function S(a){if(!eb)return null;var b=Object.create(eb);return b.rtcSessionId=a,new g(b)}function T(b){var c=b.endpoints;if(c&&!(c.length<2)){var d=null,e=c[0].callIdentifier.cID,f=c.length>2?m.Conference:m.Active;return c.forEach(function(a){if(f)if(W(a.deviceOnCall)){if(Ua.indexOf(a.localConnectionState)===-1)return void(f=null);var g=Y(a.deviceOnCall,b.epid);g===t.WebRTC&&jb?(d=jb,g=t.Other):d=S(e),d.atcCallInfo.setPosition(g),d.atcCallInfo.setCstaConnection(a.callIdentifier),Object.assign(b.servicesPermitted,a.servicesPermitted),"queued"===a.localConnectionState?f=m.Parked:"hold"===a.localConnectionState&&(f=c.length>2?m.ConferenceHolding:f===m.Held?m.HoldOnHold:m.Holding)}else if(2===c.length){if(Va.indexOf(a.localConnectionState)===-1)return void(f=null);var h=Z(a.deviceOnCall);d.atcCallInfo.setPartnerDisplay(h),E(d,d.atcCallInfo.peerDn,d.atcCallInfo.peerFQN,d.atcCallInfo.peerName),"hold"===a.localConnectionState&&(f=f===m.Holding?m.HoldOnHold:m.Held)}}),b.callingDevice&&b.callingDevice.replace("+","")===a.localUser.phoneNumber.replace("+","")?d.direction=i.OUTGOING:d.direction=i.INCOMING,f?(d.atcCallInfo.setServicesPermitted(b.servicesPermitted),d.setCstaState(f),ib[e]=d,d.atcCallInfo.getPosition()===t.WebRTC?void U(d):(y.debug("[CstaSvc]: Created new Remote Call object: ",d),d)):void 0}}function U(a){y.info("[CstaSvc]: Found a hanging WebRTC call"),a.atcCallInfo.setPosition(t.Other),a.atcCallInfo.isSeamlessHandoverAllowed()?(y.info("[CstaSvc]: Attempt to recover the hanging call by initiating a Seamless Handover"),Ea(a,t[t.WebRTC.name],null,function(b){b?(y.warn("[CstaSvc]: Failed to move the hanging call. ",b),$a.hangupRemote(a)):y.info("[CstaSvc]: Hanging call has been successfully moved")})):(y.info("[CstaSvc]: Clear the hanging call"),$a.hangupRemote(a))}function V(a){return a.indexOf("keyId=")>0}function W(a){return!!a&&(!(a.indexOf(ab.onsFQN)<0)&&(!(a.indexOf("uid=")>0)&&!V(a)))}function X(a){return!!a&&Z(a).dn===ab.vm}function Y(a,b){if(y.debug("[CstaSvc]: Get call position for "+a),!W(a))return y.error("[CstaSvc]: Invalid device ID ("+a+"). Cannot determine position."),t.Other;var c=t.Other,d=/ond=(\+?\d+)/.exec(a);if(d&&d[1]){var e=d[1];e===ab.osmoFQN?c=b&&b!==ab.epid?t.Other:t.WebRTC:e===ab.cell?c=t.Cell:e===ab.parkingDn&&(c=t.Queue)}else c=t.Desk;return y.debug("[CstaSvc]: Call position is:",c.name),c}function Z(a){var b={fqn:"",dn:Wa,name:""};if(a){var c=/N<([^>]*)>([^;]*)((?:[^;]*;)*(?:displayNumber=(\d*)))?(?:;.*)*/,d=c.exec(a);d?(b.fqn=d[1]||"",b.name=d[2]||"",b.dn=d[4]||d[1]||"Number not available"):(c=/N([^;]*)/,d=c.exec(a),d?(b.fqn=d[1]||"",b.dn=d[1]||"Number not available"):(b.fqn=a,b.dn=a))}return y.debug("[CstaSvc]: Retrieved partner display: ",b),b}function $(a){H();for(var b=A.getPhoneCalls(),c=[],e=0;e<b.length;e++)if(b[e].atcCallInfo&&b[e].atcCallInfo.getCstaCallId()){if(b[e].atcCallInfo.getCstaCallId()===a)return fb=b[e];
}else b[e].atcCallInfo=new d,c.push(b[e]);return hb&&hb.atcCallInfo.getCstaCallId()===a?hb:(hb&&!hb.atcCallInfo.getCstaCallId()&&c.push(hb),c[0])}function _(){Q(),H(),$a.snapshotDevice(function(a,b){if(a)return void(a.indexOf("deviceOutOfService")>-1&&(ob=!0,z.publish("/csta/deviceChange")));if(ob=!1,z.publish("/csta/deviceChange"),nb=!0,b.activeCalls)try{b.activeCalls.forEach(function(a){a.localCallState.length<2||(2!==a.localCallState.length||Ua.indexOf(a.localCallState[0])!==-1&&Va.indexOf(a.localCallState[1])!==-1)&&$a.snapshotCall(a.connectionId,function(a,b){if(!a&&b){var c=T(b);c&&(y.debug("[CstaSvc]: Publish /atccall/info event"),z.publish("/atccall/info",[c]))}})})}catch(a){y.error(a)}})}function aa(a,b,c){var d=ab.onsFQN+";ond=";switch(a){case t.WebRTC:d+=c?ab.osmoFQN:ab.osmoFQN+";epid="+ab.epid;break;case t.Cell:if(!ab.cell)return y.error("[CstaSvc]: Cell phone is not configured"),null;d+=ab.cell;break;case t.Desk:d+=ab.onsFQN;break;case t.VM:d=ab.vm;break;case t.Other:b?d+=b:d=ab.vm;break;default:return y.error("[CstaSvc]: Invalid target: "+a),null}return d}function ba(a){var b,c=(parseInt(a.substring(0,2),16)+2).toString(16).toUpperCase(),d=a.substring(2);return b=c.length<2?"0"+c+d:c+d,y.debug("[CstaSvc]: FailedCallId to be tracked: "+b),b}function ca(b){return Object.assign(ab,B.getAtcRegistrationData()),_a={subscriber:a.localUser.cstaNumber},!(!_a.subscriber||!ab)||(b&&b("There is no registered user."),!1)}function da(b,c){var d=db.genCstaRequest(b);if(!d)return y.error("[CstaSvc]: Failed to build CSTA request: "+b.request),void(c&&c("Failed to send the request"));if(xb!==f.Registered)return void(c&&c("Client is not registered with ATC"));var g={content:{type:e.CSTA,phoneNumber:a.localUser.cstaNumber,CSTA:d},destUserId:a.localUser.associatedTelephonyUserID};bb.sendAtcRequest(g,function(d,e){a.$apply(function(){if(d)y.warn("[CstaSvc]: ",d),c&&c(d);else{var a=db.parseResponse(b.request,e.CSTA);a||""===a?a.error?("Operation Error"===a.errorCategory&&"invalidConnectionID"===a.errorValue&&"busy"!==b.reason&&"AcceptCall"!==b.request&&"DeflectCall"!==b.request&&_(),c&&c(a.errorCategory+" - "+a.errorValue)):c&&c(null,a):c&&c("Failed to parse response from server")}})})}function ea(a,c){c.transferredCall&&!c.seamlessHandover&&(mb[a]={newCallId:c.transferredCall.cID,failedCallId:ba(c.transferredCall.cID),timeout:b(function(){delete mb[a]},Qa)})}function fa(a,b){if(!a||!ca())return!1;if(b!==t.Other&&a.atcCallInfo.position===b)return!1;var c=La();return!!c.includes(b)||(y.error("[CstaSvc]: isTargetAllowed invoked with invalid target: "+b),!1)}function ga(){y.debug("[CstaSvc]: Synchronize the selected routing option"),$a.updateRoutingOption(a.localUser.selectedRoutingOption)}function ha(a){var b=db.parseEvent(a);if(b)switch(y.debug("[CstaSvc]: Parsed CSTA Event: ",b),b.category){case"CallControl":case"CallAssociatedFeature":$a.handleCallEvent(b);break;case"LogicalDeviceFeature":$a.handleLogicalDeviceEvent(b);break;case"PhysicalDeviceFeature":break;case"DeviceMaintenance":$a.handleDeviceEvent(b);break;default:y.debug("[CstaSvc]: Unsupported CSTA Event category: "+b.category)}}function ia(b){a.localUser.clientId!==b?(y.debug("[CstaSvc]: This is not the Primary ATC client"),pb=!1):(y.debug("[CstaSvc]: This is the primary ATC client"),pb=!0)}function ja(a){var b=a.connection.cID,c=Y(a.connection.dID,a.epid),d=c===t.WebRTC?$(b):ib[b];if(!d)return void y.warn("[CstaSvc]: Could not find call corresponding to CallInformation Event.");if(d.atcCallInfo.setCstaConnection(a.connection),a.callingDevice&&!W(a.callingDevice)){var e=Z(a.callingDevice);d.atcCallInfo.setPartnerDisplay(e),E(d,d.atcCallInfo.peerDn,d.atcCallInfo.peerFQN,d.atcCallInfo.peerName)}a.servicesPermitted&&(d.atcCallInfo.setServicesPermitted(a.servicesPermitted),a.servicesPermitted.eSP&&a.servicesPermitted.eSP.sST&&(d.checkCstaState(m.ConferenceHolding)?d.setCstaState(m.Holding):d.checkCstaState(m.Conference)&&d.setCstaState(m.Active))),d.checkCstaState([m.Offered,m.ExtendedRinging])?y.debug("[CstaSvc]: Do not publish /atccall/info event at Offered state"):(y.debug("[CstaSvc]: Publish /atccall/info event"),z.publish("/atccall/info",[d]))}function ka(a){a.secondaryOldCall&&N(a.secondaryOldCall.cID);var b=null,c=a.primaryOldCall.cID,d=Y(a.primaryOldCall.dID,a.epid);return(b=d===t.WebRTC?$(c):ib[c])?(a.conferenceConnections.forEach(function(a){if(a.endpoint&&W(a.endpoint)||a.connection&&W(a.connection.dID)){if(b.atcCallInfo.setCstaConnection(a.connection),b.isAtcRemote){var d=b.atcCallInfo,e=b.peerUser,f=b.participants,g=b.direction;b.setCstaState(m.Idle),y.debug("[CstaSvc]: Publish /atccall/info event"),z.publish("/atccall/info",[b]),delete ib[c],b=S(a.connection.cID),b.atcCallInfo=d,b.peerUser=e,b.participants=f,b.direction=g,ib[a.connection.cID]=b}y.info("[CstaSvc]: Updated the CSTA connection ID for the call: ",a.connection)}else{var h=a.endpoint&&Z(a.endpoint)||Z(a.connection.dID);tb.push({call:b,userId:a.connection.dID,participantId:a.connection.dID,phoneNumber:h.dn,displayName:h.name}),ub||(ub=!0,G())}}),"hold"===a.localConnectionInfo?b.setCstaState(m.ConferenceHolding):b.setCstaState(m.Conference),b.atcCallInfo.setServicesPermitted(a.servicesPermitted),y.debug("[CstaSvc]: Publish /atccall/info event"),void z.publish("/atccall/info",[b])):void y.debug("[CstaSvc]: Could not find a call with Call Id = "+c)}function la(a){var c=a.droppedConnection.cID,d=$(c)||ib[c];if(qb={},d){if("null"!==a.localConnectionInfo){if(y.info("[CstaSvc]: Local connection info is not null.Update services permitted."),d.atcCallInfo.setServicesPermitted(a.servicesPermitted),d.participants.length>1&&(d.participants.some(function(b){if(b.participantId===a.droppedConnection.dID)return d.removeParticipant(b.userId),!0}),1===d.participants.length&&d.isRemote||2===d.participants.length&&!d.isRemote)){var e=d.participants[d.isRemote?0:1];d.removeParticipant(e.userId),E(d,e.phoneNumber,e.phoneNumber,e.displayName),d.checkCstaState(m.Conference)?d.setCstaState(m.Active):d.checkCstaState(m.ConferenceHolding)&&d.setCstaState(m.Holding)}return d.atcCallInfo.getMissedReason()||d.establishedTime||(d.direction===i.INCOMING?d.atcCallInfo.setMissedReason(W(a.releasingDevice)?p.DECLINED:p.CANCELLED):d.atcCallInfo.setMissedReason(W(a.releasingDevice)?p.CANCELLED:p.DECLINED)),y.debug("[CstaSvc]: Publish /atccall/info event"),void z.publish("/atccall/info",[d])}if(y.info("[CstaSvc]: Local connection info is null."),d.atcCallInfo.getMissedReason()||d.establishedTime||d.atcCallInfo.setMissedReason(d.direction===i.INCOMING&&"normalClearing"===a.cause?p.DECLINED:p.CANCELLED),d.clearAtcHandoverInProgress(),d.checkCstaState(m.Busy)&&d.atcCallInfo.isCallBackAllowed())return void b(function(){y.debug("[CstaSvc]: Callback presenting timer expired - terminate call"),N(d.atcCallInfo.getCstaCallId())},Ra)}var f=lb[a.droppedConnection.cID]||lb[Ya];f&&(d=S(f),d.atcCallInfo.setCstaConnection(a.droppedConnection),"normalClearing"!==a.cause&&(d.setCstaState(m.TransferFailed),d.atcCallInfo.setTransferCallFailedCause(a.cause)),y.debug("[CstaSvc]: Publish /atccall/info event"),z.publish("/atccall/info",[d]),delete lb[a.droppedConnection.cID],delete lb[Ya]),N(a.droppedConnection.cID)}function ma(a){var b,c,d,e,f,g=null;if(qb={},W(a.callingDevice))e=m.Delivered,c=a.alertingDevice,d=a.calledDevice,b={cID:a.connection.cID,dID:a.callingDevice},f=i.OUTGOING;else{if(!W(a.alertingDevice))return void y.error("[CstaSvc]: ONS DN is neither in callingDevice nor in alertingDevice?!?");e=m.Ringing,c=a.callingDevice,b=a.connection,f=i.INCOMING}if("enteringDistribution"===a.cause||"distributed"===a.cause)return void y.debug("[CstaSvc]: Ignoring Delivered event with cause: ",a.cause);var h=Y(b.dID,a.epid),j=Z(c);if(h===t.WebRTC){if(g=$(b.cID)){if(g.atcCallInfo.setCstaConnection(b),g.atcCallInfo.setServicesPermitted(a.servicesPermitted),g.setCstaState(m.Ringing),h=g.isRemote?t.Other:h,g.atcCallInfo.setPosition(h),j){y.debug("[CstaSvc]: Update partner display to ",j),g.atcCallInfo.setPartnerDisplay(j),E(g,g.atcCallInfo.peerDn,g.atcCallInfo.peerFQN,g.atcCallInfo.peerName);var k=R(b.cID);k&&(k.forwarded&&F(g,k.redirectingUser.phoneNumber,k.redirectingUser.fqNumber,k.redirectingUser.displayName,k.redirectingUser.redirectionType),k.atcCallInfo.setIgnoreCall(!0),N(b.cID))}return y.debug("[CstaSvc]: Publish /atccall/info event"),void z.publish("/atccall/info",[g])}if(vb&&vb.atcCallInfo&&vb.atcCallInfo.getCstaCallId()===a.connection.cId)return void y.warn("[CstaSvc]: The Delivered event is for a local call that was just terminated. Ignore it");y.warn("[CstaSvc]: There is no local call associated with the Delivered Event")}var l=b.cID;if(g=ib[l],g||(g=S(l),ib[l]=g,y.debug("[CstaSvc]: Created new Remote Call object for callID= ",l)),g.setCstaState(e),g.atcCallInfo.setServicesPermitted(a.servicesPermitted),g.atcCallInfo.setPosition(h),g.atcCallInfo.setCstaConnection(b),g.clearAtcHandoverInProgress(),g.direction=f,g.receivedAlerting=!0,j){if(g.atcCallInfo.setPartnerDisplay(j),d){var n=Z(d);n.fqn!==j.fqn?g.atcCallInfo.setOriginalPartnerDisplay(n):g.atcCallInfo.setOriginalPartnerDisplay(j)}return void E(g,g.atcCallInfo.peerDn,g.atcCallInfo.peerFQN,g.atcCallInfo.peerName,function(){y.debug("[CstaSvc]: Publish /atccall/info event"),z.publish("/atccall/info",[g])})}y.debug("[CstaSvc]: Publish /atccall/info event"),z.publish("/atccall/info",[g])}function na(a){var b=a.connection.cID,c=$(b);c||(c=ib[b]),c&&W(a.connection.dID)&&(y.info("[CstaSvc]: Digits played",a.digitGeneratedList),z.publish("/call/singleDigitSent",[c]))}function oa(a){var b,c,d=$(a.connection.cID);if(d)return void(d.direction===i.OUTGOING&&Za.test(a.cause)&&(b=Z(a.divertingDevice),F(d,b.dn,b.fqn,b.name,r.CallForward),c=Z(a.newDestination),d.setPeerUser(c.dn,c.name)));if("distributed"===a.cause&&W(a.divertingDevice)&&Y(a.newDestination)===t.Desk)return void y.debug("[CstaSvc]: Ignore Diverted event with cause = distributed and newDestination = desk");if(d=ib[a.connection.cID],d||(d=S(a.connection.cID)),"null"===a.localConnectionInfo&&W(a.divertingDevice)){if(W(a.newDestination)){if(W(a.newDestination)){if("distributed"===a.cause)return;if(d){if(d.forwarded)return;if(d.checkCstaState(m.Ringing)&&Y(a.newDestination)===d.atcCallInfo.getPosition())return void y.debug("[CstaSvc]: new destination has the same position as the current alerting position. Ignore event");d.atcCallInfo.setIgnoreCall(!0),y.debug("[CstaSvc]: Publish /atccall/info event"),z.publish("/atccall/info",[d])}Y(a.newDestination)===t.WebRTC&&(qb={cID:a.connection.cID,dID:a.newDestination})}}else{if((X(a.newDestination)||Y(a.connection.dID)===t.WebRTC)&&d.atcCallInfo.setIgnoreCall(!0),d.setCstaState(m.Idle),d.direction=i.INCOMING,d.atcCallInfo.setMissedReason(p.CANCELLED),Za.test(a.cause)){ib[a.connection.cID]=d;var e=Z(a.callingDevice);y.debug("[CstaSvc]: Update partner display to ",e),d.atcCallInfo.setPartnerDisplay(e),E(d,d.atcCallInfo.peerDn,d.atcCallInfo.peerFQN,d.atcCallInfo.peerName)}y.debug("[CstaSvc]: Publish /atccall/info event"),z.publish("/atccall/info",[d])}d&&!d.isHandoverInProgress&&N(a.connection.cID)}else if(!W(a.divertingDevice)&&d){var f=Z(a.divertingDevice);if(f&&d.atcCallInfo.setOriginalPartnerDisplay(f),d.direction===i.OUTGOING&&Za.test(a.cause))return b=Z(a.divertingDevice),F(d,b.dn,b.fqn,b.name,r.CallForward),c=Z(a.newDestination),void d.setPeerUser(c.dn,c.name);d.atcCallInfo.setMissedReason(p.CANCELLED),y.debug("[CstaSvc]: Publish /atccall/info event"),z.publish("/atccall/info",[d])}}function pa(a,b){rb&&rb.newCallId===b&&(a.direction=rb.direction,F(a,rb.redirectingUser.phoneNumber,rb.redirectingUser.fqNumber,rb.redirectingUser.displayName,rb.redirectingUser.redirectionType),rb={})}function qa(a){var b,c,d,e,f;if(qb={},W(a.callingDevice))b={cID:a.establishedConnection.cID,dID:a.callingDevice},c=a.answeringDevice,d=i.OUTGOING,f=Z(a.calledDevice);else{if(!W(a.answeringDevice))return void y.error("[CstaSvc]: ONS DN is neither in callingDevice nor in answeringDevice?!?");b=a.establishedConnection,c=a.callingDevice,d=i.INCOMING,f=Z(a.callingDevice)}y.debug("[CstaSvc]: LocalConnection: ",b),y.debug("[CstaSvc]: Partner Device ID: ",c);var g=Z(c),h=Y(b.dID,a.epid);if(h===t.WebRTC){if(y.info("[CstaSvc]: The Established Event is for a local WebRTC call"),e=$(b.cID)){e.atcCallInfo.setCstaConnection(b),y.info("[CstaSvc]: Set the CSTA connection ID for the active call: ",b),e.isRemote&&(y.warn("[CstaSvc]: There is no local call associated with the Established Event"),h=t.Other),e.atcCallInfo.setServicesPermitted(a.servicesPermitted),"hold"===a.localConnectionInfo?e.setCstaState(m.Holding):e.setCstaState(m.Active),e.atcCallInfo.setPartnerDisplay(g),e.atcCallInfo.setPosition(h),e.clearAtcHandoverInProgress(),e.receivedAlerting=!0,E(e,e.atcCallInfo.peerDn,e.atcCallInfo.peerFQN,e.atcCallInfo.peerName),pa(e,b.cID);var j=R(b.cID);return j&&j.forwarded&&(F(e,j.redirectingUser.phoneNumber,j.redirectingUser.fqNumber,j.redirectingUser.displayName,j.redirectingUser.redirectionType),j.atcCallInfo.setIgnoreCall(!0),N(b.cID)),e.isRemote||e.updateCallState(),y.debug("[CstaSvc]: Publish /atccall/info event"),void z.publish("/atccall/info",[e])}if("recall"===a.cause)return e=A.findActivePhoneCall(),y.info("[CstaSvc]: Recalled call callId:",e.atcCallInfo.getCstaCallId()),e.atcCallInfo.setCstaConnection(b),y.debug("[CstaSvc]: Publish /atccall/info event"),void z.publish("/atccall/info",[e]);if(W(a.answeringDevice)&&!a.epid)return void y.debug("[CstaSvc]: This is a call answered by VM. Ignore it");if(vb&&vb.atcCallInfo&&vb.atcCallInfo.getCstaCallId()===b.cId)return void y.warn("[CstaSvc]: The Established event is for a local call that was just terminated. Ignore it")}var k=!1;e=ib[b.cID],e||(k=!0,e=S(b.cID),pa(e,b.cID)),e.atcCallInfo.setPosition(h),e.atcCallInfo.setPartnerDisplay(g),e.atcCallInfo.setOriginalPartnerDisplay(f),E(e,e.atcCallInfo.peerDn,e.atcCallInfo.peerFQN,e.atcCallInfo.peerName),e.atcCallInfo.setServicesPermitted(a.servicesPermitted),e.atcCallInfo.setCstaConnection(b),e.direction=d,e.clearAtcHandoverInProgress(),e.receivedAlerting=!0,"hold"===a.localConnectionInfo?e.setCstaState(m.Holding):e.setCstaState(m.Active),k&&(y.debug("[CstaSvc]: Created new Remote Call object: ",e),ib[b.cID]=e),y.debug("[CstaSvc]: Publish /atccall/info event"),z.publish("/atccall/info",[e])}function ra(a){var b=a.heldConnection.cID,c=$(b);if(!c&&(c=ib[b],!c))return void y.warn("[CstaSvc]: Could not find call corresponding to Held Event.");if(W(a.holdingDevice)){switch(c.atcCallInfo.setCstaConnection(a.heldConnection),c.getCstaState()){case m.Held:c.setCstaState(m.HoldOnHold);break;case m.Conference:c.setCstaState(m.ConferenceHolding);break;default:c.setCstaState(m.Holding)}c.clearHoldInProgress()}else"hold"===a.localConnectionInfo?c.checkCstaState(m.ConferenceHolding)||c.setCstaState(m.HoldOnHold):c.checkCstaState(m.Conference)||c.setCstaState(m.Held);c.atcCallInfo.setServicesPermitted(a.servicesPermitted),y.debug("[CstaSvc]: Publish /atccall/info event"),z.publish("/atccall/info",[c])}function sa(b){var c,d,e;if(!W(b.offeredDevice))return void y.debug("[CstaSvc]: ONS DN is not the offered device. Ignore Offered event.");if(c=b.offeredConnection,d=b.callingDevice,y.debug("[CstaSvc]: LocalConnection: ",c),y.debug("[CstaSvc]: Partner Device ID: ",d),a.localUser.callForwardingEnabled)return y.debug("[CstaSvc]: Immediate call forwarding is enabled. Accept call"),e={request:"AcceptCall",callToBeAccepted:c},void da(e);var f=Z(d),g=S(c.cID);if(g.atcCallInfo.setPosition(t.Desk),g.atcCallInfo.setPartnerDisplay(f),E(g,g.atcCallInfo.peerDn,g.atcCallInfo.peerFQN,g.atcCallInfo.peerName),g.atcCallInfo.setServicesPermitted(b.servicesPermitted),g.setCstaState(m.Offered),g.direction=i.INCOMING,g.atcCallInfo.setCstaConnection(c),Za.test(b.cause)){var h=Z(b.lastRedirectionDevice);F(g,h.dn,h.fqn,h.name,r.CallForward)}return y.debug("[CstaSvc]: Created new Remote Call object: ",g),ib[c.cID]=g,qb={cID:c.cID,dID:aa(t.WebRTC,null,!0)},a.localUser.selectedRoutingOption===s.DeskPhone.name?void Ma(g):void(A.isSecondCall()||eb.call&&eb.call.isAtcRemote?Na(g):(e={request:"AcceptCall",callToBeAccepted:g.atcCallInfo.getCstaConnection()},da(e),qb={}))}function ta(a){var b,c;if(!W(a.queue))return void y.debug("[CstaSvc]: ONS DN is not the queue device. Ignore Queued event.");b=a.queuedConnection,c=a.callingDevice,y.debug("[CstaSvc]: LocalConnection: ",b),y.debug("[CstaSvc]: Partner Device ID: ",c);var d=Y(b.dID,a.epid),e=Z(c),f=b.cID,g=ib[f];if(!g){if("noAvailableAgents"===a.cause)return void y.debug("[CstaSvc]: Cause=noAvailableAgents. Ignore Queued event");g=S(f),ib[f]=g,y.debug("[CstaSvc]: Created new Remote Call object for callID= ",f)}g.atcCallInfo.setPosition(d),g.atcCallInfo.setPartnerDisplay(e),E(g,g.atcCallInfo.peerDn,g.atcCallInfo.peerFQN,g.atcCallInfo.peerName),g.atcCallInfo.setServicesPermitted(a.servicesPermitted),g.setCstaState(m.Parked),g.atcCallInfo.setCstaConnection(b),y.debug("[CstaSvc]: Publish /atccall/info event"),z.publish("/atccall/info",[g])}function ua(a){var b=a.retrievedConnection.cID,c=$(b);if(!c&&(c=ib[b],!c))return void y.warn("[CstaSvc]: Could not find call corresponding to Retrieved Event.");if(W(a.retrievingDevice))c.atcCallInfo.setCstaConnection(a.retrievedConnection),c.checkCstaState(m.HoldOnHold)?(c.setCstaState(m.Held),a.servicesPermitted.eSP&&a.servicesPermitted.eSP.zsiHo&&c.setCstaState(m.Active)):c.checkCstaState(m.ConferenceHolding)?(c.setCstaState(m.Conference),a.servicesPermitted.eSP&&a.servicesPermitted.eSP.sST&&c.setCstaState(m.Active)):c.setCstaState(m.Active),c.clearRetrieveInProgress();else if(c.checkCstaState([m.ConferenceHolding,m.Conference]))"hold"===a.localConnectionInfo?c.setCstaState(m.ConferenceHolding):c.setCstaState(m.Conference);else if("hold"===a.localConnectionInfo?c.setCstaState(m.Holding):c.setCstaState(m.Active),c.isRemote){var d=Z(a.retrievingDevice);c.atcCallInfo.setPartnerDisplay(d),E(c,c.atcCallInfo.peerDn,c.atcCallInfo.peerFQN,c.atcCallInfo.peerName)}c.atcCallInfo.setServicesPermitted(a.servicesPermitted),y.debug("[CstaSvc]: Publish /atccall/info event"),z.publish("/atccall/info",[c])}function va(a){var b,c=Y(a.initiatingDevice,a.epid);if(c===t.WebRTC&&(b=$(a.initiatedConnection.cID)))if(b.atcCallInfo.setCstaConnection(a.initiatedConnection),b.atcCallInfo.setServicesPermitted(a.servicesPermitted),!b.isRemote&&b.checkState([j.Initiated,j.Ringing,j.Delivered]))y.info("[CstaSvc]: Set the CSTA connection ID for the call: ",a.initiatedConnection),b.setCstaState(m.Initiated),y.debug("[CstaSvc]: Publish /atccall/info event"),z.publish("/atccall/info",[b]);else{if(b.isRemote)return void y.info("[CstaSvc]: Set the CSTA connection ID for the remote call: ",a.initiatedConnection);y.error("[CstaSvc]: Call Initiated for WebRTC client has no active call or not in Initiated/Ringing state")}else b=ib[a.initiatedConnection.cID],b||(b=S(a.initiatedConnection.cID),b.setCstaState(m.Initiated)),b.atcCallInfo.setPosition(c),b.atcCallInfo.setServicesPermitted(a.servicesPermitted),b.direction=i.OUTGOING,b.atcCallInfo.setCstaConnection(a.initiatedConnection),ib[a.initiatedConnection.cID]=b,y.debug("[CstaSvc]: Created new Remote Call object: ",b)}function wa(a){if("null"!==a.localConnectionInfo){var c=null,d=a.primaryOldCall.cID,e=$(d)||ib[d];if(!e)return void y.debug("[CstaSvc]: Could not find a call with Call Id = "+d);if(a.transferredConnections.forEach(function(b){if(b.endpoint&&W(b.endpoint)||b.connection&&W(b.connection.dID))e.atcCallInfo.setCstaConnection(b.connection),y.info("[CstaSvc]: Updated the CSTA connection ID for the call: ",b.connection);else{if(e.isAtcRemote){var f=e.atcCallInfo;e.setCstaState(m.Idle);var g=e.peerUser,h=e.direction,i=e.establishedTime;y.debug("[CstaSvc]: Publish /atccall/info event"),z.publish("/atccall/info",[e]),delete ib[d],e=S(b.connection.cID),e.atcCallInfo=f,E(e,g.phoneNumber,g.phoneNumber,g.displayName),e.direction=h,e.establishedTime=i;var j=Z(a.transferringDevice);e.atcCallInfo.setOriginalPartnerDisplay(j),ib[e.callId]=e}c=b.endpoint&&Z(b.endpoint)||b.connection.dID&&Z(b.connection.dID)}}),!e.isRemote&&!e.isEstablished())return y.debug("[CstaSvc]: This is a WebRTC call that has not been answered. Update the display"),void(c&&(e.atcCallInfo.setPartnerDisplay(c),E(e,e.atcCallInfo.peerDn,e.atcCallInfo.peerFQN,e.atcCallInfo.peerName,function(){y.debug("[CstaSvc]: Publish /atccall/info event"),z.publish("/atccall/info",[e])})));switch(a.localConnectionInfo){case"hold":e.setCstaState(m.Holding);break;case"connected":e.setCstaState(m.Active);break;case"alerting":e.setCstaState(m.Ringing);break;default:y.debug("[CstaSvc]: Unexpected localConnectionInfo: ",a.localConnectionInfo)}e.atcCallInfo.setServicesPermitted(a.servicesPermitted),c&&(e.atcCallInfo.setPartnerDisplay(c),E(e,e.atcCallInfo.peerDn,e.atcCallInfo.peerFQN,e.atcCallInfo.peerName)),y.debug("[CstaSvc]: Publish /atccall/info event"),z.publish("/atccall/info",[e])}else{if(a.secondaryOldCall){N(a.primaryOldCall.cID);var f=ib[a.secondaryOldCall.cID];f&&f.atcCallInfo.setMissedReason(p.TRANSFERRED),b(function(){N(a.secondaryOldCall.cID)},1e3)}else{if(W(a.transferringDevice)&&W(a.transferredToDevice)){var g=ib[a.primaryOldCall.cID];g&&g.atcCallInfo.setIgnoreCall(!0)}N(a.primaryOldCall.cID)}if("singleStepTransfer"===a.cause){var h=$a.getTransferredCall(a.primaryOldCall.cID);h&&($a.clearTransferredCall(a.primaryOldCall.cID),lb[h.failedCallId]=a.primaryOldCall.cID)}else if("transfer"===a.cause){var i=S(a.secondaryOldCall.cID);y.debug("[CstaSvc]: Publish /atccall/info event"),z.publish("/atccall/info",[i])}}}function xa(b){var c,d,e,f;if("fail"===b.localConnectionInfo&&W(b.failingDevice))switch(c=ib[b.failedConnection.cID],W(b.callingDevice)&&(e=Z(b.calledDevice),e.dn!==Wa&&c&&e.fqn!==v.cleanPhoneNumber(c.atcCallInfo.peerFQN)&&(E(c,e.dn,e.fqn,e.name),c.atcCallInfo.setPartnerDisplay(e))),b.cause){case"blocked":lb[b.failedConnection.cID]&&y.debug("[CstaSvc]: Received Failed event for transfer, waiting for ConnectionCleared event"),a.localUser.isOSV||(d=b.failedConnection.cID,f=Y(b.failedConnection.dID),c=f===t.WebRTC?$(d):ib[d],c&&c.isHandoverInProgress&&(y.debug("[CstaSvc]: Received Failed event from non OSV PBX while handover is in progress"),c.clearAtcHandoverInProgress(),y.debug("[CstaSvc]: Publish /atccall/moveFailed event"),z.publish("/atccall/moveFailed")));break;case"doNotDisturb":c=ib[b.failedConnection.cID],c?(y.debug("[CstaSvc]: Publish /atccall/info event"),z.publish("/atccall/info",[c])):y.warn("[CstaSvc]: DND call does not exist. Ignore Failed event");break;case"reorderTone":c=ib[b.failedConnection.cID],c?(c.atcCallInfo.setMissedReason(p.REORDER_TONE),y.debug("[CstaSvc]: Publish /atccall/info event"),z.publish("/atccall/info",[c])):y.warn("[CstaSvc]: Outgoing call failed with reorder tone");break;case"busy":c=ib[b.failedConnection.cID],c?(c.atcCallInfo.setMissedReason(p.BUSY),c.checkCstaState(m.Offered)&&c.setCstaState(m.Failed),y.debug("[CstaSvc]: Publish /atccall/info event"),z.publish("/atccall/info",[c])):y.warn("[CstaSvc]: Busy call does not exist. Ignore Failed event")}else if("connected"===b.localConnectionInfo&&W(b.callingDevice)){if(d=b.failedConnection.cID,c=$(d),c&&c.atcCallInfo.getCstaCallId()===d||(c=ib[d]),!c)return void y.warn("[CstaSvc]: Could not find call corresponding to handle FailedEvent Event.");switch(c.atcCallInfo.setServicesPermitted(b.servicesPermitted),c.atcCallInfo.peerFQN||(e=Z(b.failingDevice||b.calledDevice),e&&(c.atcCallInfo.setPartnerDisplay(e),E(c,c.atcCallInfo.peerDn,c.atcCallInfo.peerFQN,c.atcCallInfo.peerName))),b.cause){case"busy":c.isRemote&&(c.setCstaState(m.Busy),c.atcCallInfo.setMissedReason(p.BUSY));break;case"reorderTone":c.atcCallInfo.setMissedReason(p.REORDER_TONE);break;case"blocked":c.atcCallInfo.setMissedReason(p.DECLINED);break;case"destOutOfOrder":c.atcCallInfo.setMissedReason(p.DEST_OUT_OF_ORDER);break;default:c.atcCallInfo.setMissedReason(p.DEFAULT)}y.debug("[CstaSvc]: Publish /atccall/info event"),z.publish("/atccall/info",[c])}}function ya(a){var b=a.primaryCall.connectionID.cID,c=Y(a.primaryCall.connectionID.dID,ab.epid),d=c===t.WebRTC?$(b):ib[b];if(!d)return y.debug("[CstaSvc]: Could not find a call with Call Id = "+b),y.debug("[CstaSvc]: Publish /atccall/hangingcall event"),void z.publish("/atccall/hangingcall",b);if(y.debug("[CstaSvc]: Publish /atccall/moveFailed event"),z.publish("/atccall/moveFailed"),d.checkState([j.Terminated,j.Idle])){var e=d.atcCallInfo,f=d.peerUser,g=d.establishedTime,h=d.direction;delete ib[b],d=S(b),d.atcCallInfo=e,d.peerUser=f,d.establishedTime=g,d.direction=h,ib[b]=d}d.clearAtcHandoverInProgress(),y.debug("[CstaSvc]: Publish /atccall/info event"),z.publish("/atccall/info",[d])}function za(){ob=!1,y.debug("[CstaSvc]: Publish /csta/deviceChange event"),z.publish("/csta/deviceChange")}function Aa(){ob=!0,y.debug("[CstaSvc]: Publish /csta/deviceChange event"),z.publish("/csta/deviceChange")}function Ba(b){if(b){var c=ab.forwardList.some(function(a){if(a.forwardingType===b.forwardingType)return a.forwardStatus=b.forwardStatus,a.forwardDN=b.forwardTo,!0});c||ab.forwardList.push({forwardDN:b.forwardTo,forwardStatus:b.forwardStatus,forwardType:b.forwardingType}),"forwardImmediate"===b.forwardingType&&(a.localUser.callForwardingAvailable=!0,b.forwardTo!==ab.vm?(a.localUser.callForwardingNumber=q.format(b.forwardTo),a.localUser.callForwardingEnabled=b.forwardStatus,a.localUser.callForwardingToVMEnabled=!1):(a.localUser.callForwardingToVMEnabled=b.forwardStatus,a.localUser.callForwardingEnabled=!1)),b.hasOwnProperty("staticOndActive")&&(b.staticOndActive?(yb=b.staticOndDN,b.staticOndDN===v.cleanPhoneNumber(a.localUser.reroutingPhoneNumber)?a.localUser.selectedRoutingOption=s.AlternativeNumber.name:(a.localUser.selectedRoutingOption=s.Other.name,a.localUser.otherRoutingNumber=q.format(b.staticOndDN))):(yb="",a.localUser.selectedRoutingOption!==s.AlternativeNumber.name&&a.localUser.selectedRoutingOption!==s.Other.name||(a.localUser.selectedRoutingOption=s.DefaultRouting.name))),b.hasOwnProperty("voicemailActive")&&(a.localUser.voicemailPBXEnabled=!0,a.localUser.voicemailActive=b.voicemailActive,a.localUser.voicemailRingDuration=b.voicemailRingDuration,zb=b.voicemailRingDuration),b.hasOwnProperty("mainRingDuration")&&(a.localUser.ringDurationEnabled=!0,a.localUser.mainRingDuration=b.mainRingDuration,a.localUser.clientRingDuration=b.clientRingDuration,a.localUser.cellRingDuration=b.cellRingDuration,Ab=b.mainRingDuration,Bb=b.clientRingDuration,Cb=b.cellRingDuration,a.localUser.alternativeNumber=b.alternativeNumber,a.localUser.routeToCell=b.routeToCell,b.hasOwnProperty("overrideProfile")&&(a.localUser.ringDurationConfigurable=b.overrideProfile)),y.debug("[CstaSvc]: Publish /localUser/update event"),z.publish("/localUser/update",[a.localUser]),y.debug("[CstaSvc]: Publish /csta/forwardingEvent"),z.publish("/csta/forwardingEvent")}}function Ca(){a.localUser.isAgent&&!a.localUser.agentStateReady&&(a.localUser.agentStateReady=!0,y.debug("[CstaSvc]: Publish /agent/state/ready event"),z.publish("/agent/state/ready",[a.localUser.agentStateReady]))}function Da(){a.localUser.isAgent&&a.localUser.agentStateReady&&(a.localUser.agentStateReady=!1,y.debug("[CstaSvc]: Publish /agent/state/ready event"),z.publish("/agent/state/ready",[a.localUser.agentStateReady]))}function Ea(b,c,d,e){if(ca(e)){if(!b.atcCallInfo||!b.checkCstaState([m.Active])&&!b.atcCallInfo.isHandoverAllowed()&&!b.atcCallInfo.isDeflectAllowed())return void(e&&e("res_MoveCallFailed"));if(!fa(b,c))return void(e&&e("The selected target is not available for this call."));var f=aa(c,d);if(!f)return void(e&&e("Failed to create new destination."));var g={autoAnswer:c===t.Desk||c===t.WebRTC};b.checkCstaState([m.Ringing,m.Parked])?(g.request="DeflectCall",g.callToBeDiverted=b.atcCallInfo.getCstaConnection(),g.newDestination=f,a.localUser.isOSV||(y.debug("[CstaSvc]: Publish /csta/handover event"),z.publish("/csta/handover",b.atcCallInfo.getCstaCallId())),b.setAtcHandoverInProgress(),da(g,function(d){d?(e&&e("res_MoveCallFailed"),b.clearAtcHandoverInProgress(),a.localUser.isOSV||(y.debug("[CstaSvc]: Publish /atccall/moveFailed event"),z.publish("/atccall/moveFailed"))):(a.localUser.isOSV&&(y.debug("[CstaSvc]: Publish /csta/handover event"),z.publish("/csta/handover",b.atcCallInfo.getCstaCallId())),c===t.WebRTC&&b.atcCallInfo.setIgnoreCall(!0),e&&e(null))})):(g.request="SingleStepTransferCall",g.activeCall=b.atcCallInfo.getCstaConnection(),g.transferredTo=f,g.seamlessHandover=b.atcCallInfo.isSeamlessHandoverAllowed(),a.localUser.isOSV||(y.debug("[CstaSvc]: Publish /csta/handover event"),z.publish("/csta/handover",b.atcCallInfo.getCstaCallId())),b.setAtcHandoverInProgress(),da(g,function(c,d){c||!d?(e&&e("res_MoveCallFailed"),b.clearAtcHandoverInProgress(),a.localUser.isOSV||(y.debug("[CstaSvc]: Publish /atccall/moveFailed event"),z.publish("/atccall/moveFailed"))):(ea(g.activeCall.cID,d),rb={primaryCallId:g.activeCall.cID,newCallId:d.transferredCall.cID,direction:b.direction,redirectingUser:b.redirectingUser},a.localUser.isOSV&&(y.debug("[CstaSvc]: Publish /csta/handover event"),z.publish("/csta/handover",b.atcCallInfo.getCstaCallId())),e&&e(null))}))}}function Fa(a,b){var c=S(a);E(c,a,a),c.setCstaState(m.Delivered),c.direction=i.OUTGOING,c.atcCallInfo.setPosition(b);var d={dn:a,fqn:a,name:""};c.atcCallInfo.setPartnerDisplay(d),c.atcCallInfo.setIgnoreCall(!0),ib[a]=c,y.debug("[CstaSvc]: Publish /atccall/info event"),z.publish("/atccall/info",[c]),y.debug("[CstaSvc]: Created new Remote Call object: ",c)}function Ga(a,b,c){var d=R(b);if(d)d.atcCallInfo.setCstaConnection(a),d.setCallIdForTelephony(a.cID),d.setCstaState(m.Delivered),d.atcCallInfo.setIgnoreCall(!1),delete ib[b];else{d=S(a.cID),E(d,b,b),d.setCstaState(m.Delivered),d.direction=i.OUTGOING,d.atcCallInfo.setCstaConnection(a),d.atcCallInfo.setPosition(c);var e={dn:b,fqn:b,name:""};d.atcCallInfo.setPartnerDisplay(e)}ib[a.cID]=d,y.debug("[CstaSvc]: Publish /atccall/info event"),z.publish("/atccall/info",[d]),y.debug("[CstaSvc]: Created new Remote Call object: ",d)}function Ha(a,b,c){var d=S(v.generateCallId());if(E(d,a,a),d.direction=i.OUTGOING,d.atcCallInfo.setPosition(b),c.endsWith("invalidCalledDeviceID"))d.atcCallInfo.setMissedReason(p.REORDER_TONE);else{if(c.endsWith("requestIncompatibleWithCallingDevice")||c.endsWith("invalidDeviceID"))return;d.atcCallInfo.setMissedReason(p.DEST_OUT_OF_ORDER)}O(d)}function Ia(){var a=[];return w.enabled&&a.push(t.WebRTC),ob||a.push(t.Desk),ab&&ab.cell&&a.push(t.Cell),a}function Ja(){var a=[];return ob||a.push(t.Desk),ab&&ab.cell&&a.push(t.Cell),a}function Ka(a){var b=[];return a&&(ob||b.push(t.Desk),ab&&ab.cell&&a.getPosition()!==t.Cell&&b.push(t.Cell),ab&&ab.vm&&b.push(t.VM)),b}function La(){var a=Ia();return ab&&ab.vm&&a.push(t.VM),a.push(t.Other),a}function Ma(a){var b=a.atcCallInfo&&a.atcCallInfo.getCstaConnection()||qb;if(pb){var c={request:"DeflectCall",callToBeDiverted:b,newDestination:aa(t.Desk)};da(c)}}function Na(b){var c=null;if(a.localUser.selectedBusyHandlingOption!==h.DefaultRouting.name){var d=b.atcCallInfo&&b.atcCallInfo.getCstaConnection()||qb;if(pb){switch(a.localUser.selectedBusyHandlingOption){case h.SendToAlternativeNumber.name:c={request:"DeflectCall",callToBeDiverted:d,newDestination:aa(t.Cell)};break;case h.BusySignal.name:c={request:"ClearConnection",connectionToBeCleared:d,reason:"busy"};break;case h.SendToVM.name:c={request:"DeflectCall",callToBeDiverted:d,newDestination:aa(t.VM)};break;default:return}da(c,function(a){if(!a&&"ClearConnection"===c.request)if(b.atcCallInfo)b.atcCallInfo.setMissedReason(p.BUSY),b.checkCstaState(m.Offered)&&b.setCstaState(m.Failed);else if(B.isClearConnectionBusySupported()){var e=ib[d.cID]||S(d.cID);e.peerUser=b.peerUser,e.direction=i.INCOMING,e.creationTime=b.creationTime,e.atcCallInfo.setMissedReason(p.BUSY),ib[d.cID]=e,N(d.cID)}}),qb={}}}else b.checkCstaState(m.Offered)&&(c={request:"AcceptCall",callToBeAccepted:b.atcCallInfo.getCstaConnection()
},da(c),qb={})}function Oa(b,c){!b&&c&&(a.localUser.callForwardingAvailable=!a.localUser.isOSV,c.forwardList&&c.forwardList.length>0&&c.forwardList.forEach(function(b){"forwardImmediate"===b.forwardingType&&(a.localUser.callForwardingAvailable=!0,b.forwardDN!==ab.vm?(a.localUser.callForwardingNumber=q.format(b.forwardDN),a.localUser.callForwardingEnabled=b.forwardStatus):a.localUser.callForwardingToVMEnabled=b.forwardStatus)}),ab.forwardList=c.forwardList||[],c.voicemailActive&&(a.localUser.voicemailPBXEnabled=!0,a.localUser.voicemailActive=c.voicemailActive,a.localUser.voicemailRingDuration=c.voicemailRingDuration,zb=c.voicemailRingDuration),c.mainRingDuration&&(a.localUser.ringDurationEnabled=!0,a.localUser.mainRingDuration=c.mainRingDuration,a.localUser.clientRingDuration=c.clientRingDuration,a.localUser.cellRingDuration=c.cellRingDuration,Ab=c.mainRingDuration,Bb=c.clientRingDuration,Cb=c.cellRingDuration,a.localUser.alternativeNumber=c.alternativeNumber||v.cleanPhoneNumber(a.localUser.reroutingPhoneNumber),a.localUser.routeToCell=c.routeToCell,c.hasOwnProperty("overrideProfile")&&(a.localUser.ringDurationConfigurable=c.overrideProfile)),y.debug("[CstaSvc]: Publish /localUser/update event"),z.publish("/localUser/update",[a.localUser]),y.debug("[CstaSvc]: Publish /csta/getForwardingResponse"),z.publish("/csta/getForwardingResponse"),ga())}function Pa(b,d){!b&&d&&(a.localUser.isAgent=d.loggedOnState,a.localUser.isAgent&&(a.localUser.agentStateReady=d.agentState===c.Ready,y.debug("[CstaSvc]: Publish /agent/state/ready event"),z.publish("/agent/state/ready",[a.localUser.agentStateReady])))}y.debug("New Service: CstaSvc (NEW)");var Qa=4e3,Ra=5e3,Sa=2e3,Ta=2e3,Ua=["connected","hold","queued"],Va=["connected","hold"],Wa="Number not available",Xa="00000000000000000000000000000000",Ya="02000000000000000000000000000000",Za=/Forward/,$a=this,_a=null,ab={forwardList:[]},bb=u.getInstance(),cb=k.getInstance(),db=new n,eb=null,fb=null,gb=null,hb=null,ib={},jb=null,kb=[],lb={},mb={},nb=!1,ob=!0,pb=!0,qb={},rb={},sb=[],tb=[],ub=!1,vb=null,wb=null,xb=null,yb=null,zb=null,Ab=null,Bb=null,Cb=null,Db=!1;return bb.on("ATC.CSTA",function(b){y.info("[CstaSvc]: Received CSTA event: ",b),b.type===e.CSTA&&b.CSTA&&a.$apply(function(){ha(b.CSTA)})}),bb.on("ATC.PRIMARYCLIENT",function(a){y.info("[CstaSvc]: Received PRIMARYCLIENT event:",a),a.type===e.PRIMARYCLIENT&&a.primaryClientId&&ia(a.primaryClientId)}),z.subscribe("/atcRegistration/state",function(b){y.debug("[CstaSvc]: Received /atcRegistration/state event."),xb=b,a.localUser.isATC&&(!nb&&b===f.Registered&&Db?(_(),$a.getForwarding(Oa),$a.getAgentState(Pa)):nb=!1)}),z.subscribe("/activeSessions/received",function(){y.debug("[CstaSvc]: Received /activeSessions/received event"),Db=!0,nb||xb===f.Registered&&(_(),$a.getForwarding(Oa))}),z.subscribe("/registration/state",function(a){y.debug("[CstaSvc]: Received /registration/state event"),a!==RegistrationState.Registered&&(Db=!1)}),z.subscribe("/call/incoming",function(a){a&&eb&&a.convId===eb.convId&&(y.debug("[CstaSvc]: Received /call/incoming event."),Object.keys(ib).some(function(a){var b=ib[a];if(b.checkCstaState(m.Ringing)&&b.atcCallInfo.getPosition()===t.WebRTC)return hb=L(),hb&&(y.debug("[CstaSvc]: Found a matching ATC remote call. Move call info to alerting call."),hb.atcCallInfo=b.atcCallInfo,b.atcCallInfo=new d,b.atcCallInfo.setIgnoreCall(!0),N(a)),!0}))}),z.subscribe("/atccall/firstcall",function(a){y.debug("[CstaSvc]: Received /atccall/firstcall event"),Ma(a)}),z.subscribe("/atccall/secondcall",function(a){y.debug("[CstaSvc]: Received /atccall/secondcall event."),Na(a)}),z.subscribe("/conversation/item/add",function(a){a&&eb&&a.convId===eb.convId&&a.rtc&&a.rtc.rtcParticipants&&2===a.rtc.rtcParticipants.length&&(sb.unshift("TELEPHONY"===a.rtc.rtcParticipants[0].type?a.rtc.rtcParticipants[0]:a.rtc.rtcParticipants[1]),sb.length>2&&sb.pop())}),z.subscribe("/call/ended",function(a){a&&a.isTelephonyCall&&!a.isRemote&&(vb=a,b.cancel(wb),wb=b(function(){vb=null,wb=null},Ta)),H()}),z.subscribe("/routing/alternativeNumber/changed",function(){y.debug("[CstaSvc]: Received /routing/alternativeNumber/changed event"),ga()}),z.subscribe("/localUser/update",function(){a.localUser.isATC&&(y.debug("[CstaSvc]: Received /localUser/update event"),ga())}),this.alternate=function(a,b,c){if(ca(c)){if(!a||!b)return void(c&&c("Invalid calls to alternate"));a.setRetrieveInProgress(),b.setHoldInProgress();var d={};d.request="AlternateCall",d.activeCall=b.atcCallInfo.getCstaConnection(),d.heldCall=a.atcCallInfo.getCstaConnection(),da(d,function(d){d?(a.clearRetrieveInProgress(),b.clearHoldInProgress(),c&&c("res_RetrieveCallFailed")):c&&c(null)})}},this.conference=function(a,b,c){if(ca(c)){if(!a||!b)return void(c&&c("Invalid calls to conference"));var d={};d.request="ConferenceCall",d.activeCall=b.atcCallInfo.getCstaConnection(),d.heldCall=a.atcCallInfo.getCstaConnection(),da(d,function(a,b){!a&&b||c&&c("res_MergeCallFailed")})}},this.answer=function(a,b){if(ca(b)){var c=R(a);if(!c)return void(b&&b("There is no call to be answered"));var d={request:"AnswerCall",callToBeAnswered:c.atcCallInfo.getCstaConnection()};da(d,b)}},this.clearTransferredCall=function(a){mb[a]&&(b.cancel(mb[a].timeout),delete mb[a])},this.consultationTransfer=function(a,b,c){if(ca(c)){var d={request:"TransferCall",heldCall:b.atcCallInfo.getCstaConnection(),activeCall:a.atcCallInfo.getCstaConnection()};da(d,function(a,b){a||!b?c&&c(x.Unreachable.ui):c&&c(null)})}},this.deflect=function(a,b,c,d){if(ca(d)){var e=$(a)||A.getIncomingCall()||R(a);if(!e)return void(d&&d("There is no call to be deflected"));if(!fa(e,b))return void(d&&d("The selected target is not available for this call."));var f=aa(b,c);if(!f)return void(d&&d("Failed to create new destination."));var g={request:"DeflectCall",callToBeDiverted:e.atcCallInfo.getCstaConnection(),newDestination:f,autoAnswer:b===t.Desk||b===t.WebRTC};da(g,d),b!==t.VM&&e.setAtcHandoverInProgress()}},this.generateDigits=function(a,b,c){if(ca(c)){var d={request:"GenerateDigits",connectionToSendDigits:a.atcCallInfo.getCstaConnection(),charactersToSend:b};da(d,c)}},this.getDoNotDisturb=function(a){if(ca(a)){var b={request:"GetDoNotDisturb",device:ab.ons};da(b,a)}},this.getForwarding=function(b){if(ca(b)){var c={request:"GetForwarding",device:a.localUser.isOSV?v.normalizeDn(ab.onsFQN):ab.onsFQN};da(c,b)}},this.getMessageWaiting=function(a){if(ca(a)){var b={request:"GetMessageWaitingIndicator",device:ab.ons};da(b,a)}},this.getTransferredCall=function(a){return mb[a]},this.pullRemoteCall=function(a,b,c){var d=R(a);d?Ea(d,t[t.WebRTC.name],null,c):(y.warn("[CstaSvc]: pullRemoteCall invoked without a valid call"),c("No active remote call"))},this.pushLocalCall=function(a,b,c){H();var d=fb&&fb.callId===a?fb:gb&&gb.callId===a?gb:null;d?Ea(d,t[b],null,c):(y.warn("[CstaSvc]: pushLocalCall invoked without a valid call"),c("No active local call"))},this.endRemoteCall=function(a,b){var c=R(a);c?this.hangupRemote(c,b):(y.warn("[CstaSvc]: endRemoteCall invoked without a valid call"),b("No active remote call"))},this.hangupRemote=function(a,b){if(a.isRemote&&ca(b)){var c={request:"ClearConnection",connectionToBeCleared:a.atcCallInfo.getCstaConnection()};da(c,function(c){c?b&&b(c):(a.atcCallInfo.getMissedReason()||(a.direction===i.INCOMING?a.atcCallInfo.setMissedReason(p.DECLINED):a.atcCallInfo.setMissedReason(p.CANCELLED)),N(a.atcCallInfo.getCstaCallId()),b&&b())})}},this.hold=function(a,b){if(ca(b)){var c={request:"HoldCall",callToBeHeld:a.atcCallInfo.getCstaConnection()};a.setHoldInProgress(),da(c,function(c){c?(a.clearHoldInProgress(),b&&b("res_HoldCallFailed")):b&&b(null)})}},this.reconnect=function(a,b,c){if(ca(c)){var d={request:"ReconnectCall",heldCall:b.atcCallInfo.getCstaConnection(),activeCall:a.atcCallInfo.getCstaConnection()};da(d,c)}},this.retrieve=function(a,b){if(ca(b)){var c={request:"RetrieveCall",callToBeRetrieved:a.atcCallInfo.getCstaConnection()};a.setRetrieveInProgress(),da(c,function(c){c?(a.clearRetrieveInProgress(),b&&b("res_RetrieveCallFailed")):b&&b(null)})}},this.setDoNotDisturb=function(a,b){if(ca(b)){var c={request:"SetDoNotDisturb",device:ab.ons,doNotDisturbOn:a};da(c,b)}},this.setForwarding=function(b,c){if(ca(c)){var d={request:"SetForwarding",device:a.localUser.isOSV?v.normalizeDn(ab.onsFQN):ab.onsFQN,activateForward:b.activateForward,forwardDN:b.forwardDN||"",forwardingType:b.forwardingType,ringCount:b.ringCount};da(d,c)}},this.snapshotCall=function(a,b){if(ca(b)){var c={request:"SnapshotCall",snapshotObject:a};da(c,b)}},this.snapshotDevice=function(a){if(ca(a)){var b={request:"SnapshotDevice",snapshotObject:ab.onsFQN,osmo:ab.osmo};da(b,a)}},this.transfer=function(a,b,c){if(ca(c)){var d={};a.checkCstaState([m.Ringing,m.Parked])?(d.request="DeflectCall",d.callToBeDiverted=a.atcCallInfo.getCstaConnection(),d.newDestination=b,da(d,c)):(d.request="SingleStepTransferCall",d.activeCall=a.atcCallInfo.getCstaConnection(),d.transferredTo=b,da(d,function(a,b){if(a||!b){if(a&&a.indexOf("internalResourceBusy")!==-1)return ea(d.activeCall.cID,{transferredCall:{cID:Xa}}),void(c&&c(null));c&&c(x.Unreachable.ui)}else ea(d.activeCall.cID,b),c&&c(null)}))}},this.consultationCall=function(a,b,c){if(ca(c)){var d={};d.request="ConsultationCall",d.consultedDevice=b,d.existingCall=a.atcCallInfo.getCstaConnection(),Fa(b,a.atcCallInfo.getPosition()),da(d,function(d,e){d||!e?(c&&c("res_MakeCallFailed"),N(b),Ha(b,null,d)):(Ga(e.iC,b,a.atcCallInfo.getPosition()),c&&c())})}},this.makeCall=function(a,b,c){if(ca(c)){var d={};d.request="MakeCall",d.calledDirectoryNumber=b,d.callingDevice=aa(a),d.autoOriginate=a===t.Desk||a===t.WebRTC?"doNotPrompt":"prompt",Fa(b,a),da(d,function(d,e){d||!e?(c&&c("res_MakeCallFailed"),N(b),Ha(b,a,d)):(Ga(e.caD,b,a),c&&c())})}},this.callBackCallRelated=function(a,b){if(ca(b)){var c={request:"CallBackCallRelated",callBackConnection:a.atcCallInfo.getCstaConnection()};da(c,b)}},this.callBackNonCallRelated=function(a,b){if(ca(b)){var c={request:"CallBackNonCallRelated",orD:ab.onsFQN,tD:a};da(c,b)}},this.cancelCallBack=function(a,b){if(ca(b)){var c={request:"CancelCallBack",orD:ab.onsFQN,td:a||void 0};da(c,b)}},this.setMicrophoneMute=function(a,b){if(ca(b)){var c={request:"SetMicrophoneMute",device:ab.ons,mute:a};da(c,b)}},this.getMicrophoneMute=function(a){if(ca(a)){var b={request:"GetMicrophoneMute",device:ab.ons};da(b,a)}},this.callLogSnapShot=function(a){if(ca(a)){var b={request:"CallLogSnapShot",device:ab.ons};da(b,a)}},this.snapshot=function(){_()},this.getAgentState=function(a){if(ca(a)){var b={request:"GetAgentState",device:ab.onsFQN};da(b,a)}},this.setAgentState=function(b,d){if(b=!!b,b!==a.localUser.agentStateReady&&ca(d)){var e={request:"SetAgentState",device:ab.onsFQN,state:b?c.Ready:c.NotReady};da(e,d)}},this.handleCallEvent=function(a){if(a){H();try{switch(a.name){case"CallInformationEvent":ja(a);break;case"ConferencedEvent":ka(a);break;case"ConnectionClearedEvent":la(a);break;case"DeliveredEvent":ma(a);break;case"DigitsGeneratedEvent":na(a);break;case"DivertedEvent":oa(a);break;case"EstablishedEvent":qa(a);break;case"FailedEvent":xa(a);break;case"HeldEvent":ra(a);break;case"OfferedEvent":sa(a);break;case"QueuedEvent":ta(a);break;case"RetrievedEvent":ua(a);break;case"ServiceCompletionFailureEvent":ya(a);break;case"ServiceInitiatedEvent":va(a);break;case"TransferredEvent":wa(a);break;default:y.debug("[CstaSvc]: Ignore CSTA Call Event ("+a.name+")")}}catch(a){y.error(a)}}},this.handleDeviceEvent=function(a){if(a)try{switch(a.name){case"BackInServiceEvent":za();break;case"OutOfServiceEvent":Aa();break;default:y.debug("[CstaSvc]: Ignore CSTA Device Event ("+a.name+")")}}catch(a){y.error(a)}},this.handleLogicalDeviceEvent=function(a){if(a)try{switch(a.name){case"ForwardingEvent":Ba(a);break;case"AgentReadyEvent":Ca();break;case"AgentNotReadyEvent":case"AgentBusyEvent":Da();break;default:y.debug("[CstaSvc]: Ignore CSTA Logical Device Event ("+a.name+")")}}catch(a){y.error(a)}},this.isPrimaryClient=function(){return pb},this.getDisplayInfo=Z,this.getCallDevices=Ia,this.getPushDevices=Ja,this.getAnswerDevices=Ka,this.updateStaticOnd=function(b,c){if(ca(c)){b=!!b,y.debug("[CstaSvc]: Update static OND status to ",b);var d={staticOndActive:b};if(b&&(d.staticOndDN=v.cleanPhoneNumber(a.localUser.reroutingPhoneNumber),!d.staticOndDN))return void(c&&c("Cannot activate static OND without the static OND DN"));var e=!!yb;if(b!==e||b&&d.staticOndDN!==yb){var f={request:"SetForwarding",device:v.normalizeDn(ab.onsFQN),staticOndActive:d.staticOndActive,staticOndDN:d.staticOndDN};da(f,function(a){a?c&&c(a):(yb=d.staticOndDN||"",c&&c(null))})}else c&&c(null)}},this.updateRoutingOption=function(a,b){switch(a){case s.AlternativeNumber.name:$a.updateStaticOnd(!0,function(a){a?b&&b(a):$a.setForwardingToVM(!1,b)});break;case s.VM.name:$a.setForwardingToVM(!0,function(a){a?b&&b(a):$a.updateStaticOnd(!1,b)});break;default:$a.setForwardingToVM(!1,function(a){a?b&&b(a):$a.updateStaticOnd(!1,b)})}},this.setForwardingImmediate=function(b,c,d){c=c||a.localUser.callForwardingNumber;var e={activateForward:!!b,forwardDN:v.cleanPhoneNumber(c),forwardingType:"forwardImmediate"};$a.setForwarding(e,d)},this.setForwardingToVM=function(a,b){if($a.getForwardingVMStatus()!==a){var c={activateForward:!!a,forwardDN:v.cleanPhoneNumber(ab.vm),forwardingType:"forwardImmediate"};$a.setForwarding(c,b)}else b&&b()},this.getForwardingData=function(){return ab.forwardList},this.getForwardingImmediate=function(){var a=ab.forwardList.find(function(a){return"forwardImmediate"===a.forwardingType&&a.forwardDN!==ab.vm});return{status:!(!a||!a.forwardStatus),forwardDN:a&&a.forwardDN}},this.getForwardingVMStatus=function(){return ab.forwardList.some(function(a){return"forwardImmediate"===a.forwardingType&&a.forwardDN===ab.vm&&a.forwardStatus})},this.setVoicemail=function(b,c,d){if(ca(d))if(c=c||zb,a.localUser.voicemailPBXEnabled)if(y.debug("[CstaSvc]: Set voice mail duration to: ",c),b!==a.localUser.voicemailActive||zb!==c){var e={request:"SetForwarding",device:v.normalizeDn(ab.onsFQN),voicemailActive:b!==a.localUser.voicemailActive?b:void 0,voicemailRingDuration:b?c:void 0};da(e,function(a){a?d&&d(a):(zb=c,d&&d(null))})}else d&&d(null);else d&&d("Cannot configure VM on PBX")},this.setRoutingTimers=function(b,c){if(ca(c))if(a.localUser.ringDurationEnabled){if(y.debug("[CstaSvc]: Set routing timers to: ",b),Ab!==b.mainRingDuration||Cb!==b.cellRingDuration||Bb!==b.clientRingDuration||!a.localUser.routeToCell){var d={request:"SetForwarding",device:v.normalizeDn(ab.onsFQN),mainRingDuration:b.mainRingDuration||void 0,clientRingDuration:b.clientRingDuration||void 0,cellRingDuration:b.cellRingDuration||void 0,routeToCell:!0};da(d,function(a){a?c&&c(a):(Ab=b.mainRingDuration||Ab,Bb=b.clientRingDuration||Bb,Cb=b.cellRingDuration||Cb,c&&c(null))})}}else y.debug("[CstaSvc]: Cannot set routing timers"),c&&c("Cannot configure routing timers on PBX")},this}var c=Circuit.Enums.AgentState,d=a.AtcCallInfo,e=a.Enums.AtcMessage,f=a.Enums.AtcRegistrationState,g=a.AtcRemoteCall,h=a.BusyHandlingOptions,i=a.Enums.CallDirection,j=a.Enums.CallState,k=a.ClientApiHandlerSingleton,l=a.Constants,m=a.Enums.CstaCallState,n=a.CstaParser,o=a.Enums.JournalEntryTypes,p=a.Enums.MissedReasonTypes,q=Circuit.PhoneNumberFormatter,r=Circuit.Enums.RedirectionTypes,s=a.RoutingOptions,t=a.Enums.Targets,u=a.UserToUserHandlerSingleton,v=a.Utils,w=a.WebRTCAdapter,x=a.Enums.TransferCallFailedCauses;return a.CstaSvcImpl=b,a}(Circuit),Circuit=function(a){"use strict";function b(a,b,j,k,l,m,n,o,p,q,r){function s(a){for(var b=0;b<K.length;b++)if(a.sameAs(K[b]))return j.debug("[CallControlSvc]: Updating call with callId = "+a.callId),void(K[b]=a);K.push(a)}function t(a){var b;for(b=0;b<K.length;b++)if(a.sameAs(K[b])){K.splice(b,1);break}}function u(a){for(var b=0;b<K.length;b++)if(K[b].callId===a)return K[b]}function v(a){var b=null;return K.some(function(c){if(c.atcCallInfo.getPosition()===a)return b=c,!0}),b}function w(){for(var a=null,b=0;b<K.length;b++){if(K[b].state===c.ActiveRemote)return K[b];K[b].checkCstaState(d.Conference)&&(a=K[b])}return a}function x(){for(var a=0;a<K.length;a++)if(K[a].state===c.Ringing)return K[a]}function y(a){j.debug("[CallControlSvc]: Publish /call/state event. callId = "+a.callId+", state = "+a.state.name),k.publish("/call/state",[a])}function z(a){a.terminate()}function A(a){var b=m.getConversationByRtcSession(a);if(b)return b;for(var c=0;c<K.length;c++)if(K[c].callId===a)return m.getConversationFromCache(K[c].convId);return null}function B(){for(var a=0;a<K.length;a++)if(K[a].isHandoverInProgress)return K[a];return null}function C(a){a&&(j.debug("[CallControlSvc]: Publish /conversation/update event. convId = ",a.convId),k.publish("/conversation/update",[a]))}function D(a){if(!a)return void j.warn("[CallControlSvc]: Invalid call object in /atccall/info event");if(!a.isAtcRemote)return void y(a);var b=m.getConversationFromCache(a.convId);if(!b||!b.isTelephonyConv)return void j.warn("[CallControlSvc]: Call in /atccall/info event is not for telephony conversation");if(!a.checkCstaState([d.Idle,d.Terminated])&&(s(a),!b.call||b.call.isHandoverInProgress&&!b.call.sameAs(a)||b.call.isAtcRemote&&b.call.isHolding())){if(b.call&&b.call.isHandoverInProgress){var f=b.call;f.clearAtcHandoverInProgress(),a.establishedTime=f.establishedTime,f.isAtcRemote?t(f):l.removeCallFromList(f),z(f),j.debug("[CallControlSvc]: Publish /call/ended event."),k.publish("/call/ended",[f,!1])}b.call=a}switch(a.getCstaState()){case d.Initiated:case d.Offered:case d.ExtendedRinging:a.setState(c.Started);break;case d.Delivered:a.setState(c.Delivered);break;case d.Busy:a.setState(c.Busy);break;case d.Ringing:a.checkState(c.Ringing)||(a.setState(c.Ringing),p&&p.show({type:Circuit.Enums.NotificationType.INCOMING_VOICE_CALL,user:a.peerUser,extras:{conversation:b,call:a}}));break;case d.Idle:case d.TransferFailed:case d.Failed:a.setState(c.Idle);break;case d.Terminated:a.setState(c.Terminated);break;default:a.setState(c.ActiveRemote)}a.state!==c.Idle&&a.state!==c.Terminated&&a.state!==c.Started?(C(b),y(a),a.state!==c.Ringing&&r.setPresenceWithLocation(e.PresenceState.BUSY)):a.state!==c.Idle&&a.state!==c.Terminated||(z(a),t(a),j.debug("[CallControlSvc]: Publish /call/ended event"),k.publish("/call/ended",[a,!1]),a.isHandoverInProgress||b.call&&b.call.sameAs(a)&&(b.call=w(),b.call||l.getActiveCall()||r.setPresenceWithLocation(e.PresenceState.AVAILABLE)),C(b))}function E(a){var b=B();if(b){var c=m.getConversationFromCache(a.convId);a.establishedTime=b.establishedTime,z(b),t(b),c&&c.call&&(c.call=a,C(c))}}function F(a){m.getTelephonyConversation(function(b,c){!b&&c&&c.call&&c.call.atcCallInfo.getCstaCallId()===a&&(c.call=null,C(c))})}function G(a){var b=l.getActiveCall();return!!b&&a===b.callId}function H(a){j.debug("[CallControlSvc]: Publish /call/nativeDial event"),k.publish("/call/nativeDial",[a])}function I(a){if(a&&a.phoneNumber){j.debug("[CallControlSvc]: Received MobileBreakout.DIAL event");var c={phoneNumber:a.phoneNumber,autoDial:a.autoDial,userName:a.userName},d=[];a.conversationId&&d.push(m.getConversationPromise(a.conversationId)),a.userId&&d.push(q.getUserPromise(a.userId)),d.length?b.all(d).then(function(a){a&&a.forEach(function(a){a.userId?c.user=a:c.conversation=a}),H(c)}):H(c)}}j.debug("New Service: CallControlSvc");var J,K=[],L=this,M=i.getInstance();return k.subscribe("/atccall/info",function(a){j.debug("[CallControlSvc]: Received /atccall/info event"),D(a)}),k.subscribe("/atccall/replace",function(a){j.debug("[CallControlSvc]: Received /atccall/replace event"),E(a)}),k.subscribe("/call/ended",function(a){if(j.debug("[CallControlSvc]: Received /call/ended event"),a.isAtcRemote)a.clearAtcHandoverInProgress(),t(a);else{var b=m.getConversationFromCache(a.convId);b&&b.isTelephonyConv&&!b.call&&(b.call=w()||x(),b.call&&C(b)),a.isRemote||l.getActiveCall()||(w()||r.setPresenceWithLocation(e.PresenceState.AVAILABLE),r.cancelAutoSnooze())}}),k.subscribe("/atccall/hangingcall",function(a){j.debug("[CallControlSvc]: Received /atccall/hangingcall event"),F(a)}),k.subscribe("/call/state",function(a){j.debug("[CallControlSvc]: Received /call/state event"),a&&a.state!==f.CallState.Terminated&&(a.isRemote||r.setPresenceWithLocation(e.PresenceState.BUSY))}),k.subscribe("/screenshare/started",function(){j.info("[CallControlSvc]: Received /screenshare/started event. Screenshare was started. Start Auto-Snooze."),r.startAutoSnooze()}),k.subscribe("/screenshare/ended",function(){j.info("[CallControlSvc]: Received /screenshare/ended event. Screenshare was ended. Resume from Auto-Snooze."),r.cancelAutoSnooze()}),h.isMobile()&&M.on("MOBILE_BREAKOUT.DIAL",function(b){j.info("[CallControlSvc]: Received UserToUser MOBILE_BREAKOUT.DIAL event."),a.$apply(function(){I(b)})}),this.initActiveSessionsForSdk=l.initActiveSessionsForSdk,this.setDisableRemoteVideoByDefault=l.setDisableRemoteVideoByDefault,this.getDisableRemoteVideoByDefault=l.getDisableRemoteVideoByDefault,this.setClientDiagnosticsDisabled=l.setClientDiagnosticsDisabled,this.getCalls=l.getCalls,this.getPhoneCalls=l.getPhoneCalls,this.getActiveCall=l.getActiveCall,this.getIncomingCall=l.getIncomingCall,this.getActiveRemoteCall=l.getActiveRemoteCall,this.joinGroupCall=l.joinGroupCall,this.makeCall=l.makeCall,this.makeAtcCall=function(a,b,c){b=h.cleanPhoneNumber(b);var d=v(a);d?n.consultationCall(d,b,c):n.makeCall(a,b,c)},this.makeEchoTestCall=l.makeEchoTestCall,this.dialNumber=l.dialNumber,this.dialPhoneNumber=l.dialPhoneNumber,this.dialUsingDefaultDevice=function(a,b){b=b||function(){};var c=a&&a.dialedDn;return c&&h.PHONE_DIAL_PATTERN.test(c)?(j.debug("[CallControlSvc]: Calling "+c+" with name: "+a.toName),void m.getTelephonyConversation(function(d,e){if(d||!e)return void j.debug("[CallControlSvc]: error on getTelephonyConversation ",d);if(e.call&&e.call.consultation){var f=e.call.getPosition()||J;if(f&&f!==g.WebRTC)return j.info("[CallControlSvc]: Start consultation from "+f.name+" to ",c),L.makeAtcCall(f,c,b),void(e.call.consultation=!1)}else if(J&&J!==g.WebRTC)return j.info("[CallControlSvc]: Make call from "+J.name+" to ",c),void L.makeAtcCall(J,c,b);a.mediaType=a.mediaType||{audio:!0,video:!1,desktop:!1},L.dialPhoneNumber(a,b)})):void b("Missing or wrong number")},this.setDefaultCallDevice=function(a){a&&a.name&&Object.keys(g).some(function(b){if(a.name===g[b].name)return J=g[b],j.debug("[CallControlSvc]: Set defaultCallDevice to ",J.name),!0})},this.startConference=l.startConference,this.answerCall=function(a,b,c){var d=l.getEstablishedLocalPhoneCalls();if(d.length>1)return j.warn("[CallControlSvc]: answerCall - There are already 2 local phone calls"),void(c&&c("Can not answer the call"));var f=l.findCall(a);if(f)return void l.answerCall(a,b,c);f=u(a);var g=l.getActiveCall(),h=l.getIncomingCall();f?g&&!g.isTelephonyCall?l.endActiveCall(function(){n.pullRemoteCall(a,null,c)}):h&&!h.isTelephonyCall?l.endCallWithCauseCode(h.callId,e.InviteRejectCause.BUSY,function(){n.pullRemoteCall(a,null,c)}):n.pullRemoteCall(a,null,c):(j.warn("[CallControlSvc]: answerCall - There is no alerting call"),c&&c("No alerting call"))},this.answerCallOnDevice=function(a,b,c,d){if(!c||c===g.WebRTC)return L.answerCall(a,b,d);var e=l.findCall(a);return e?void(e.isTelephonyCall?n.deflect(a,c,null,d):j.warn("[CallControlSvc]: answerCallOnDevice - The active call is not a telephony call")):(e=u(a),void(e?e.getPosition()!==c?n.deflect(a,c,null,d):n.answer(a,d):(j.warn("[CallControlSvc]: answerCallOnDevice - There is no alerting call"),d&&d("No alerting call"))))},this.endCall=function(a,b){L.endCallWithCauseCode(a,null,b)},this.endCallWithCauseCode=function(a,b,c){var d=l.findCall(a);return d?void(d.isRemote?l.endRemoteCall(a,c):b?l.endCallWithCauseCode(a,b,c):l.endCall(a,c)):(d=u(a),void(d&&K.length>1&&L.reconnectCall(a,c)||(d?n.endRemoteCall(a,c):(j.warn("[CallControlSvc]: endCall invoked without a valid call. callId = ",a),c&&c("Call not found")))))},this.endConference=l.endConference,this.startScreenShare=l.startScreenShare,this.addScreenShare=l.addScreenShare,this.selectMediaToShare=l.selectMediaToShare,this.removeScreenShare=l.removeScreenShare,this.addAudio=l.addAudio,this.removeAudio=l.removeAudio,this.enableRemoteAudio=l.enableRemoteAudio,this.disableRemoteAudio=l.disableRemoteAudio,this.addVideo=l.addVideo,this.removeVideo=l.removeVideo,this.toggleRemoteVideo=l.toggleRemoteVideo,this.toggleVideo=l.toggleVideo,this.changeHDVideo=l.changeHDVideo,this.renegotiateMedia=l.renegotiateMedia,this.setMediaType=l.setMediaType,this.addMediaStream=l.addMediaStream,this.removeMediaStream=l.removeMediaStream,this.pullRemoteCall=function(a,b,c){var d=l.findCall(a);if(d)return void l.pullRemoteCall(a,b,c);if(d=u(a)){var e=l.getActiveCall();if(e)return e.isTelephonyCall?void l.holdCall(e.callId,function(){n.pullRemoteCall(a,null,c)}):void l.endActiveCall(function(){n.pullRemoteCall(a,null,c)});n.pullRemoteCall(a,null,c)}else j.warn("[CallControlSvc]: pullRemoteCall invoked without a valid call"),c&&c("No active remote call")},this.pushLocalCall=function(a,b,c){n.pushLocalCall(a,b,c)},this.getAtcCalls=function(){return K},this.swapCall=function(a,b){var c=l.findCall(a);if(c&&c.isTelephonyCall&&!c.isRemote)return void l.swapCall(a,b);if(K.length<=1)return void j.warn("[CallControlSvc]: swapCall possible only with 2 calls");var e,f=null;for(e=0;e<K.length;e++)if(K[e].isHolding()&&K[e].callId===a){f=K[e];break}if(f){var g=f.atcCallInfo.getPosition();for(e=0;e<K.length;e++)if(K[e].checkCstaState([d.Active,d.Conference])&&K[e].atcCallInfo.getPosition()===g&&K[e].callId!==a){var h=K[e];return void n.alternate(f,h,b)}}},this.mergeCall=function(a,b){var c=l.getPhoneCalls(!0);if(K.length<=1&&c.length<=1)return void j.warn("[CallControlSvc]: mergeCall possible only with 2 calls");var e,f;if(c.length>1&&(e=l.findActivePhoneCall(!0),f=l.findHeldPhoneCall(!0),e&&f)){if(!f.isAtcConferenceCall())return void n.conference(f,e,b);L.swapCall(f.callId,function(a){return a?void b(a):void n.conference(e,f,b)})}var g;for(g=0;g<K.length;g++)if(K[g].checkCstaState([d.Active,d.Conference])&&K[g].callId===a){e=K[g];break}if(e){var h=e.atcCallInfo.getPosition();for(g=0;g<K.length;g++)if(K[g].isHolding()&&K[g].atcCallInfo.getPosition()===h&&K[g].callId!==a)return f=K[g],void n.conference(f,e,b)}},this.transferCall=function(a,b,c){var d,e=l.findCall(a),f=l.getPhoneCalls(!0);if(b=h.cleanPhoneNumber(b),e&&1===f.length)return void(e.isTelephonyCall?n.transfer(e,b,c):(j.warn("[CallControlSvc]: The active call is not a telephony call"),c&&c("The active call is not a telephony call")));if(e&&2===f.length)return void(e.isTelephonyCall?(d=l.findHeldPhoneCall(!0),n.consultationTransfer(e,d,c)):(j.warn("[CallControlSvc]: The active call is not a telephony call"),c&&c("The active call is not a telephony call")));if(K.length<1)return j.warn("[CallControlSvc]: transferCall possible only with 1 or 2 calls"),void(c&&c("Not enough calls for the transfer"));if(1===K.length&&!K[0].isHolding())return e=K[0],void n.transfer(e,b,c);var g;for(g=0;g<K.length;g++)if(!K[g].isHolding()&&K[g].callId===a){e=K[g];break}if(e){var i=e.atcCallInfo.getPosition();for(g=0;g<K.length;g++)if(K[g].isHolding()&&K[g].atcCallInfo.getPosition()===i&&K[g].callId!==a)return d=K[g],void n.consultationTransfer(e,d,c)}},this.holdCall=function(a,b){var c=l.findCall(a);return c?c.isHolding()?(j.warn("[CallControlSvc]: Call is not in valid state"),void(b&&b("Call is not in valid state"))):void l.holdCall(a,b):(c=u(a))?c.isHolding()?(j.warn("[CallControlSvc]: Call is not in valid state"),void(b&&b("Call is not in valid state"))):void n.hold(c,b):(j.warn("[CallControlSvc]: holdCall invoked without a valid call"),void(b&&b("No active remote call")))},this.retrieveCall=function(a,b){var c=l.findCall(a);return c?c.isHolding()?void l.retrieveCall(a,b):(j.warn("[CallControlSvc]: Call is not in valid state"),void(b&&b("Call is not in valid state"))):(c=u(a))?c.isHolding()?void n.retrieve(c,b):(j.warn("[CallControlSvc]: Call is not in valid state"),void(b&&b("Call is not in valid state"))):(j.warn("[CallControlSvc]: retrieveCall invoked without a valid call"),void(b&&b("No active remote call")))},this.reconnectCall=function(a,b){if(K.length<=1)return j.warn("[CallControlSvc]: reconnectCall possible only with 2 calls"),!1;var c,d=null;for(c=0;c<K.length;c++)if(!K[c].isHolding()&&K[c].callId===a){d=K[c];break}if(d){var e=d.atcCallInfo.getPosition();for(c=0;c<K.length;c++)if(K[c].isHolding()&&K[c].atcCallInfo.getPosition()===e&&K[c].callId!==a){var f=K[c];return n.reconnect(d,f,b),!0}}return!1},this.hideRemoteCall=l.hideRemoteCall,this.dropParticipant=l.dropParticipant,this.addParticipantToCall=l.addParticipantToCall,this.addParticipantToRtcSession=l.addParticipantToRtcSession,this.mute=l.mute,this.unmuteLocally=l.unmuteLocally,this.unmute=l.unmute,this.toggleMute=l.toggleMute,this.muteParticipant=function(a,b,c){if(a&&b){if(c=c||function(){},!G(a))return j.warn("[CallControlSvc]: muteParticipant - There is no local call"),void c("Call invalid");if(b.isMeetingPointInvitee){if(!o)return j.error("[CallControlSvc]: MeetingPointSvc is not initialized"),void c("res_MuteParticipantFailed");o.muteMeetingPoint(b.userId,function(d){d?(j.warn("[CircuitCallControlSvc]: Failed to mute Meeting Point locally"),c("res_MuteParticipantFailed")):l.muteParticipant(a,b,c)})}else l.muteParticipant(a,b,c)}},this.hasUnmutedParticipants=l.hasUnmutedParticipants,this.muteRtcSession=l.muteRtcSession,this.unmuteParticipant=function(a,b,c){if(a&&b){if(c=c||function(){},!G(a))return j.warn("[CallControlSvc]: unmuteParticipant - There is no local call"),void c("Call invalid");if(b.isMeetingPointInvitee){if(!o)return j.error("[CallControlSvc]: MeetingPointSvc is not initialized"),void c("res_UnmuteParticipantFailed");o.unmuteMeetingPoint(b.userId,function(a){a?(j.warn("[CircuitCallControlSvc]: Failed to unmute Meeting Point locally"),c("res_UnmuteParticipantFailed")):c()})}else l.unmuteParticipant(a,b,c)}},this.toggleMuteParticipant=function(a,b,c){if(a&&b)return b.muted?L.unmuteParticipant(a,b,c):L.muteParticipant(a,b,c)},this.toggleVideoParticipant=function(a,b,c){if(a&&b&&b.userId){if(c=c||function(){},!G(a))return j.warn("[CallControlSvc]: toggleVideoParticipant - There is no local call"),void c("Call invalid");if(b.isMeetingPointInvitee){if(!o)return j.error("[CallControlSvc]: MeetingPointSvc is not initialized"),void c("res_StartVideoParticipantFailed");o.toggleVideoMeetingPoint(b.userId,function(a){a?(j.warn("[CallControlSvc]: Failed to toggle video MeetingPoint participant"),c("res_StartVideoParticipantFailed")):c()})}else j.warn("[CallControlSvc]: Cannot toggle video MeetingPoint participant: ",b.userId),c("res_StartVideoParticipantFailed")}},this.stopRingingTone=l.stopRingingTone,this.endActiveCall=l.endActiveCall,this.startRecording=l.startRecording,this.stopRecording=l.stopRecording,this.submitCallQualityRating=l.submitCallQualityRating,this.raiseQuestion=l.raiseQuestion,this.inviteToStage=l.inviteToStage,this.inviteToStageAnswer=l.inviteToStageAnswer,this.inviteToStageCancel=l.inviteToStageCancel,this.removeFromStage=l.removeFromStage,this.getQuestions=l.getQuestions,this.updateQuestionState=l.updateQuestionState,this.openCurtain=l.openCurtain,this.closeCurtain=l.closeCurtain,this.getNodeState=l.getNodeState,this.canSendWebRTCDigits=l.canSendWebRTCDigits,this.sendDigits=function(a,b,c){var d=l.findCall(a);return d?void(d.sessionCtrl.canSendDTMFDigits()?l.sendDigits(a,b,c):d.atcCallInfo?n.generateDigits(d,b,function(a){a?c("res_SendDtmfFailed"):c()}):c("res_SendDtmfFailed")):(d=u(a),void(d?n.generateDigits(d,b,c):(j.warn("[CallControlSvc]: SendDigits invoked without a valid call"),c("Call not found"))))},this.disableIncomingVideo=l.disableIncomingVideo,this.enableIncomingVideo=l.enableIncomingVideo,this.toggleParticipantPointer=l.toggleParticipantPointer,this.findCall=l.findCall,this.findConversationByCallId=A,this.sendParticipantPointer=l.sendParticipantPointer,
this.sendParticipantDrawing=l.sendParticipantDrawing,this.getCallDevices=n.getCallDevices,this.getPushDevices=n.getPushDevices,this.getAnswerDevices=function(a){if(a&&"object"==typeof a)return n.getAnswerDevices(a);var b=l.findCall(a)||u(a);return n.getAnswerDevices(b)},this.updateActiveCallMediaDevices=l.updateActiveCallMediaDevices,this.addSimulatedParticipants=l.addSimulatedParticipants,this}var c=a.Enums.CallState,d=a.Enums.CstaCallState,e=a.Constants,f=a.Enums,g=a.Enums.Targets,h=a.Utils,i=a.UserToUserHandlerSingleton;return a.CallControlSvcImpl=b,a}(Circuit),Circuit=function(a){"use strict";function b(a,b){if(!a||!a.localUser)return g.warn("[sdk-services]: Cannot extend Conversation object without localUser"),null;if(!b||b.isExtended)return b;var c=Object.create(b);c.isExtended=!0,c.moderators=c.moderators||[];var d=b.participants.map(function(a){return"string"==typeof a?{userId:a}:a}).filter(function(b){return b.userId===a.localUser.userId&&(c.hasJoined=!0),b.userId!==a.localUser.userId});return c.peerUsers=d,b.type===f.ConversationType.DIRECT&&(c.peerUser=d[0]),c.userIsModerator=function(a){return!!a&&c.moderators.some(function(b){return b.userId===a.userId})},c}function c(a){if(!a||a.isExtended)return a;var b=Object.create(a);return b.isExtended=!0,b}function d(a){var b=a&&a.accounts&&a.accounts[0],c=b&&b.telephonyConfiguration;if(c){if(c.phoneNumber=h.format(c.phoneNumber)||"",c.callerId=h.format(c.callerId)||"",c.reroutingPhoneNumber=h.format(c.reroutingPhoneNumber)||"",a.reroutingPhoneNumber=c.reroutingPhoneNumber,a.ondSipAuthenticationHash=c.ondSipAuthenticationHash,a.onsSipAuthenticationHash=c.onsSipAuthenticationHash,a.associatedTelephonyUserID=c.associatedTelephonyUserID,a.associatedTelephonyUserType=c.associatedTelephonyUserType,a.previousAlternativeNumbers=(c.previousAlternativeDevice||[]).map(i.cleanPhoneNumber),a.reroutingPhoneNumber){var d=i.cleanPhoneNumber(a.reroutingPhoneNumber);a.previousAlternativeNumbers.includes(d)||a.previousAlternativeNumbers.unshift(d)}a.associatedTelephonyUserID&&a.associatedTelephonyUserType===f.GtcTrunkType.ATC_TRUNK_TYPE?(a.associatedGTCUserId=a.associatedTelephonyUserID,a.isATC=!0):a.isATC=!1}else delete a.associatedGTCUserId,delete a.reroutingPhoneNumber,delete a.ondSipAuthenticationHash,delete a.onsSipAuthenticationHash,delete a.associatedTelephonyUserID,delete a.associatedTelephonyUserType,delete a.isATC}function e(e,f){l=e,m=f,this.rootScope={localUser:null,clientVersion:"",browser:i.getBrowserInfo(),circuitLabs:{},$$phase:!0,$apply:function(a){a&&a()},$digest:function(){},i18n:{localize:function(a){return a},map:{res_Unknown:"Unknown"}},localize:function(a){return a}},a.Conversation={extend:b.bind(null,this.rootScope)},a.UserProfile={extend:c.bind(null),syncTelephonyConfig:d.bind(null)},this.PubSubSvc=new a.PubSubSvcImpl(g),this.ExtensionSvc=new a.ExtensionSvcImpl(this.rootScope,j,window,Promise,g,this.PubSubSvc,null),this.SdkHelperSvc=new a.SdkHelperSvcImpl(this.rootScope,Promise,g,this.PubSubSvc),this.AtcRegistrationSvc=new a.AtcRegistrationSvcImpl(this.rootScope,j,g,this.PubSubSvc,this.SdkHelperSvc),this.DeviceDiagnosticSvc=new a.DeviceDiagnosticSvcImpl(this.rootScope,j,g,this.PubSubSvc,null),this.CircuitCallControlSvc=new a.CircuitCallControlSvcImpl(this.rootScope,j,k,window,Promise,g,this.PubSubSvc,null,this.SdkHelperSvc,this.SdkHelperSvc,null,this.SdkHelperSvc,this.DeviceDiagnosticSvc),this.CstaSvc=new a.CstaSvcImpl(this.rootScope,j,g,this.PubSubSvc,this.CircuitCallControlSvc,this.AtcRegistrationSvc,this.SdkHelperSvc,this.SdkHelperSvc),this.CallControlSvc=new a.CallControlSvcImpl(this.rootScope,Promise,g,this.PubSubSvc,this.CircuitCallControlSvc,this.SdkHelperSvc,this.CstaSvc,null,null,this.SdkHelperSvc,this.SdkHelperSvc),a.Conversation=null,a.UserProfile=null,l=null,m=null}var f=a.Constants,g=a.logger,h=a.PhoneNumberFormatter,i=a.Utils,j=function(a,b){return window.setTimeout(a,b)};j.cancel=function(a){a&&window.clearTimeout(a)};var k=function(a,b,c){if(void 0===c)return window.setInterval(a,b);if(c<=0)return null;var d=0,e=null,f=function(){a(),d++,d>=c&&window.clearInterval(e)};return e=window.setInterval(f,b)};k.cancel=function(a){a&&window.clearInterval(a)};var l=null;a.ClientApiHandlerSingleton.getInstance=function(){return l};var m=null;return a.UserToUserHandlerSingleton.getInstance=function(){return m},a.SdkServices=e,a}(Circuit),Circuit=function(a){"use strict";var b={};return a.Injectors=b,a}(Circuit||{}),Circuit=function(a){"use strict";function b(){if(window.frameElement&&window.parent)window.parent.document.body.removeChild(window.frameElement);else try{window.close()}catch(a){}}function c(a,c){if(a.location.hash||a.location.search){var d=Object.assign({},j.parseQS(a.location.hash),j.parseQS(a.location.search));if(d.state)try{Object.assign(d,JSON.parse(d.state))}catch(a){g.error("Could not decode state parameter")}if(d.display&&"popup"===d.display&&d.redirect_uri===a.location.origin+a.location.pathname&&a.document.addEventListener("DOMContentLoaded",function(){a.document.body.innerHTML="Redirecting, please wait..."}),d.callback){var e=d.callback;if(e in c)try{delete d.callback,c[e](d)}catch(a){}}d.display&&"popup"===d.display&&b()}}var d=a.Enums.ConnectionState,e=a.Enums.ConversationType,f=a.Constants,g=a.logger,h=a.PrivateData,i=a.Enums.Targets,j=a.Utils;c(window,window.opener||window.parent);var k=j.getBrowserInfo();return a.ExtensionConnHandlerSingleton.getInstance(),a.Client=function(b){function c(a,b,c,d){if(a===f.ReturnCode.NO_RESULT&&c)return!1;if(a){var e=pc.getLastError();return d&&d(e),e&&delete e.errObj,b(e),!0}return!1}function k(a,b){return!!a&&(b(new Circuit.Error(f.ReturnCode.SDK_ERROR,a)),!0)}function l(){return"https://"+_b.domain+"/"}function m(a,b,c){var d,e={};return e.width=b,e.height=c,e.left=window.screenX+(window.outerWidth-b)/2,e.top=window.screenY+(window.outerHeight-c)/2,e.scrollbars="yes",d=Object.keys(e).map(function(a){return a+"="+e[a]}).join(", "),window.open(a,e.name,d)}function n(a){return bc.scope.split(",").indexOf(a)>=0||bc.scope.split(",").indexOf("ALL")>=0}function o(a){a=a||{},bc.client_id=a.client_id,bc.client_secret=a.client_secret,bc.redirect_uri=a.redirect_uri||window.location.origin+window.location.pathname,bc.scope=(a.scope?a.scope.replace(/\s+/g,""):"")||"ALL",n(f.OAuthScope.READ_USER_PROFILE)||(bc.scope=f.OAuthScope.READ_USER_PROFILE+","+a.scope),n(f.OAuthScope.ALL)&&(bc.scope=f.OAuthScope.ALL)}function p(a){return new Promise(function(b,c){var d=ic?new XMLHttpRequest(bc):new XMLHttpRequest;if(d.open(a.type||a.dataType||"GET",a.url,!0),d.withCredentials=a.xhrFields&&a.xhrFields.withCredentials,!cc||a.headers&&a.headers.Authorization||d.setRequestHeader("Authorization","Bearer "+cc),a.headers)for(var e in a.headers)a.headers.hasOwnProperty(e)&&d.setRequestHeader(e,a.headers[e]);d.onload=function(){if(200===d.status)a.success&&a.success(d.responseText),b(d.responseText);else{var e=new Circuit.Error(d.status,d.responseText||d.statusText);a.error&&a.error(e),c(e)}},d.onerror=function(){var b=new Circuit.Error(f.ErrorCode.AUTHORIZATION_FAILED,"Network error or incorrect credentials");a.error&&a.error(b),c(b)};var g;a.data&&(g=j.toQS(a.data),d.setRequestHeader("Content-type","application/x-www-form-urlencoded")),d.send(g)})}function q(a){return new Promise(function(b,c){var d="/sdklogin";p({type:"POST",url:"https://"+_b.domain+d,data:{token:a.token||void 0,accessToken:a.accessToken||void 0},xhrFields:{withCredentials:!0},crossDomain:!0}).then(function(){a.accessToken&&(cc=a.accessToken),b()}).catch(c)})}function r(){return p({url:"https://"+_b.domain+"/validateSession",xhrFields:{withCredentials:!0},crossDomain:!0})}function s(){return new Promise(function(a,b){oc&&(window.clearInterval(oc),oc=null,pc.disconnect()),pc.setToken(cc),pc.connect(function(){g.info("[SDK]: Successfully connected to access server."),oc=window.setInterval($b,50),a()},function(a){g.error("[SDK]: Failed to connect: ",a),pc.disconnect(),b(new Circuit.Error(f.ReturnCode.SDK_ERROR,a))},_b.domain)})}function t(){return new Promise(function(a,b){if(!bc.client_id)return void b(new Circuit.Error(f.ReturnCode.SDK_ERROR,"client_id missing in client object"));if(!window.localStorage)return void a();var c=window.localStorage.getItem("oauth");try{c=JSON.parse(c)}catch(a){return window.localStorage.removeItem("oauth"),void b(new Circuit.Error(f.ReturnCode.SDK_ERROR,"Error parsing OAuth app in localStorage"))}c&&"object"==typeof c||(c={}),c[bc.client_id]={access_token:cc,domain:_b.domain,expires_at:dc},window.localStorage.setItem("oauth",JSON.stringify(c)),g.debug("[SDK]: Stored access_token for client_id: "+bc.client_id),a()})}function u(){return new Promise(function(a,b){var c=window.localStorage.getItem("oauth");if(!c)return void b(new Circuit.Error(f.ReturnCode.SDK_ERROR,"OAuth access token not found in localStorage"));try{c=JSON.parse(c)}catch(a){return void b(new Circuit.Error(f.ReturnCode.SDK_ERROR,"Error parsing OAuth app in localStorage"))}if("object"!=typeof c)return void b(new Circuit.Error(f.ReturnCode.SDK_ERROR,"invalid data in localStorage"));var d=c[bc.client_id];d&&d.access_token?(cc=d.access_token,dc=d.expires_at,g.debug("[SDK]: Retrieved access_token for client_id: "+bc.client_id),a(cc)):b(new Circuit.Error(f.ReturnCode.SDK_ERROR,"client_id not found in localStorage"))})}function v(a){var b="_circuit_"+parseInt(1e12*Math.random(),10).toString(36);return window[b]=function(){try{a.apply(this,arguments)&&delete window[b]}catch(a){g.error(a)}},b}function w(){return new Promise(function(a,b){var c=null;if(!bc.client_id)return _b.oauthwin&&(_b.oauthwin.close(),_b.oauthwin=null),void b(new Circuit.Error(f.ReturnCode.SDK_ERROR,"client_id missing in client object"));cc=void 0;var d=v(function(d){if(c&&window.clearInterval(c),!d||d.error){cc=void 0;var e=d?d.error:"The authentication was not completed";b(new Circuit.Error(f.ReturnCode.SDK_ERROR,e))}else cc=d.access_token,dc=d.expires_in&&Date.now()+1e3*d.expires_in,t().catch(function(a){g.error("[SDK]: Failed to store the OAuth access token.",a)}).then(function(){a({username:d.username,accessToken:d.access_token})})}),e={client_id:bc.client_id,redirect_uri:bc.redirect_uri,response_type:"token",scope:bc.scope||""};e.state=JSON.stringify({callback:d,display:"popup",redirect_uri:e.redirect_uri});var h="https://"+bc.domain+"/oauth/authorize?"+j.toQS(e),i=_b.oauthwin||m(h,450,500);return i?(_b.oauthwin=null,i.location.href=h,void(c=window.setInterval(function(){i&&!i.closed||(c&&window.clearInterval(c),b(new Circuit.Error(f.ReturnCode.SDK_ERROR,"OAuth popup cancelled")))},500))):void b(new Circuit.Error(f.ErrorCode.SDK_ERROR,"OAuth popup blocked"))})}function x(){return new Promise(function(a,b){var c=null,d=v(function(d){if(c&&window.clearInterval(c),!d||d.error){var e=d?d.error:"The authentication was not completed";b(new Circuit.Error(f.ReturnCode.SDK_ERROR,e))}else a({username:d.username})}),e=JSON.stringify({callback:d,display:"popup",redirect_uri:bc.redirect_uri}),g={return_to:bc.redirect_uri+"#state="+e},h="https://"+bc.domain+"/oauth/login?"+j.toQS(g),i=_b.oauthwin||m(h,450,500);_b.oauthwin=null,i.location.href=h,c=window.setInterval(function(){i&&!i.closed||(c&&window.clearInterval(c),b(new Circuit.Error(f.ReturnCode.SDK_ERROR,"Auth popup cancelled")))},500)})}function y(a){return a=a||cc,p({type:"GET",url:"https://"+_b.domain+"/oauth/token/"+a,crossDomain:!0})}function z(){if(bc.autoRenewToken&&dc){ec&&window.clearTimeout(ec);var a=dc-Date.now()-6e4;a>0&&(ec=window.setTimeout(A,a))}}function A(){return new Promise(function(a,b){var c={type:"POST",url:"https://"+_b.domain+"/oauth/token",data:{scope:bc.scope,grant_type:"implicit"}};bc.client_secret&&(c.headers={Authorization:"Basic "+window.btoa(bc.client_id+":"+bc.client_secret)},c.data.grant_type="client_credentials"),p(c).then(function(c){var d=JSON.parse(c);if(d&&d.access_token&&"Bearer"===d.token_type)cc=d.access_token,pc.setToken(cc),dc=d.expires_in&&Date.now()+1e3*d.expires_in,z(),Zb({type:"accessTokenRenewed"}),a(cc);else{cc=null,dc=null;var e=new Circuit.Error(f.ReturnCode.SDK_ERROR,"Error renewing OAuth2 access token");Zb({type:"renewAccessTokenFailed",error:e}),b(e)}}).catch(b)})}function B(){return new Promise(function(a,b){var d=[f.GetStuffType.USER,f.GetStuffType.SUPPORT_CONVERSATION_ID,f.GetStuffType.TELEPHONY_CONVERSATION_ID,f.GetStuffType.ACCOUNTS,f.GetStuffType.PRESENCE_STATE];pc.getStuff(d,function(d,e){c(d,b,!0)||(_b.loggedOnUser=e.user,sc.SdkHelperSvc.setLocalUser(e.user),gc=e.telephonyConvId,hc=e.supportConvId,a())})})}function C(){return n(f.OAuthScope.CALLS)?sc.CallControlSvc.initActiveSessionsForSdk():Promise.resolve()}function D(){return n(f.OAuthScope.CALLS)&&bc.enableTelephony&&sc.AtcRegistrationSvc.initAtcForSdk(),Promise.resolve()}function E(){return s().then(J).then(B).then(C).then(D).then(function(){return _b.loggedOnUser})}function F(){return new Promise(function(a,b){p({type:"POST",url:"https://"+_b.domain+"/oauth/token",headers:{Authorization:"Basic "+window.btoa(bc.client_id+":"+bc.client_secret)},data:{grant_type:"client_credentials",scope:bc.scope}}).then(function(c){var d=JSON.parse(c);d&&d.access_token&&"Bearer"===d.token_type?(cc=d.access_token,dc=d.expires_in&&Date.now()+1e3*d.expires_in,z(),a({accessToken:cc})):(cc=null,dc=null,b(new Circuit.Error(f.ReturnCode.SDK_ERROR,"Internal error with Client Credentials Grant authentication")))}).catch(b)})}function G(a,b){return new Promise(function(c,d){p({type:"POST",url:"https://"+_b.domain+"/oauth/token",headers:{Authorization:"Basic "+window.btoa(bc.client_id)},data:{username:a,password:b,grant_type:"password",scope:bc.scope}}).then(function(a){var b=JSON.parse(a);b&&b.access_token&&"Bearer"===b.token_type?(cc=b.access_token,dc=b.expires_in&&Date.now()+1e3*b.expires_in,z(),c({accessToken:cc})):(cc=null,dc=null,d(new Circuit.Error(f.ReturnCode.SDK_ERROR,"Internal error with Client Credentials Grant authentication")))}).catch(d)})}function H(a){return a?new Promise(function(a){var b=function(){cc=null,dc=null,pc.disconnect(),window.clearInterval(oc),_b.dispatch({type:"connectionStateChanged",state:d.Disconnected}),a()},c=window.setTimeout(function(){c=null,b()},2e3);pc.logout(function(){c&&(window.clearTimeout(c),b())})}):(cc=null,dc=null,pc.disconnect(),Promise.resolve())}function I(a){return new Promise(function(b,d){a=a||cc,cc=null,dc=null,t(),pc.revokeAccessToken(a,function(a){c(a,d)||b()})})}function J(){return new Promise(function(a,b){pc.getUserData(function(d,e){c(d,b)||(rc.processClientSettings(e.clientSettings),a(e))})})}function K(){return new Promise(function(a,b){pc.getLoggedOnUser(function(d,e){c(d,b)||Tb(e.user).then(function(b){_b.loggedOnUser=b,sc.SdkHelperSvc.setLocalUser(b),a(b)})})})}function L(a){return new Promise(function(b,d){a=a||{},a.pageSize=a.pageSize||25,a.sorting=a.sorting||f.GetAccountsSorting.BY_FIRST_NAME,pc.getAccounts(a,function(a,e){c(a,d)||Promise.all(e.accounts.map(function(a){return Tb(a.user)})).then(b).catch(d)})})}function M(a){return new Promise(function(b,d){a=a||{},a.numberOfConversations=a.numberOfConversations||25,a.direction=a.direction||f.SearchDirection.BEFORE,pc.getConversations(_b.loggedOnUser.userId,a.timestamp,a.direction,a.numberOfConversations,f.ConversationFilter.ALL,function(a,e){c(a,d)||Promise.all(e.map(Xb)).then(b).catch(d)})})}function N(){return new Promise(function(a,b){pc.getMarkedConversationsList(function(d,e){c(d,b,!0)||a(e||[])})})}function O(){return new Promise(function(a,b){pc.getFavoriteConversationIds(function(d,e){c(d,b,!0)||a(e||[])})})}function P(a){return new Promise(function(b,d){return a?void pc.markConversation({convId:a,markType:f.ConversationMarkFilter.FAVORITE},function(a){c(a,d)||b()}):void d(new Circuit.Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"convId is required"))})}function Q(a){return new Promise(function(b,d){return a?void pc.unmarkConversation({convId:a,markType:f.ConversationMarkFilter.FAVORITE},function(a){c(a,d)||b()}):void d(new Circuit.Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"convId is required"))})}function R(a){return new Promise(function(b,d){return a?void pc.markConversation({convId:a,markType:f.ConversationMarkFilter.MUTE},function(a){c(a,d)||b()}):void d(new Circuit.Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"convId is required"))})}function S(a){return new Promise(function(b,d){return a?void pc.unmarkConversation({convId:a,markType:f.ConversationMarkFilter.MUTE},function(a){c(a,d)||b()}):void d(new Circuit.Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"convId is required"))})}function T(){return new Promise(function(a,b){pc.getAllLabels(function(d,e){c(d,b,!0)||a(e||[])})})}function U(a){return new Promise(function(b,d){return a&&a.filterConnector?(a.retrieveAction=a.retrieveAction||Circuit.Enums.RetrieveAction.CONVERSATIONS,a.retrieveAction!==Circuit.Enums.RetrieveAction.CONVERSATIONS&&a.retrieveAction!==Circuit.Enums.RetrieveAction.CONVERSATION_IDS&&d(new Circuit.Error(f.ReturnCode.SDK_ERROR,"Invalid retrieveAction")),void pc.getConversationsByFilter(a,function(e,f){if(!c(e,d,!0))if(a.retrieveAction===Circuit.Enums.RetrieveAction.CONVERSATIONS){var g=f.conversations||[];Promise.all(g.map(Xb)).then(b).catch(d)}else a.retrieveAction===Circuit.Enums.RetrieveAction.CONVERSATION_IDS&&b(f.conversationIds||[])})):void d(new Circuit.Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"options.filterConnector"))})}function V(a,b){return a?(b=b||{},b.filterConnector={conditions:[{filterTarget:f.FilterTarget.LABEL_ID,expectedValue:[a]}]},b.retrieveAction=Circuit.Enums.RetrieveAction.CONVERSATIONS,U(b)):Promise.reject(new Circuit.Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"labelId"))}function W(a){return a=a||{},a.filterConnector={conditions:[{filterTarget:f.FilterTarget.LABEL_ID,expectedValue:[f.SystemLabel.ARCHIVED]}]},a.retrieveAction=Circuit.Enums.RetrieveAction.CONVERSATIONS,U(a)}function X(a){return new Promise(function(b,d){pc.getConversationById(a,function(a,e){c(a,d)||Xb(e).then(b).catch(d)})})}function Y(a){return new Promise(function(b,d){pc.getConversationsByIds(a,function(a,e){c(a,d)||Promise.all(e.map(Xb)).then(b).catch(d)})})}function Z(a,b){return new Promise(function(d,e){b=b||{},pc.getConversationParticipants(a,b,function(a,b){c(a,e)||Promise.all(b.participants.map(Yb)).then(function(a){b.participants=a,d(b)}).catch(e)})})}function $(a){return new Promise(function(b,d){pc.getItemById(a,function(a,e){c(a,d)||Ub(e).then(b).catch(d)})})}function _(a,b){return new Promise(function(d,e){b=b||{},b.modificationDate=b.modificationDate||void 0,b.creationDate=b.creationDate||b.creationTime||void 0,b.direction=b.direction||f.SearchDirection.BEFORE,b.numberOfItems=b.numberOfItems||25,pc.getConversationItems(a,b.modificationDate,b.creationDate,b.direction,b.numberOfItems,function(a,b){c(a,e)||Promise.all(b.map(Ub)).then(d).catch(e)})})}function aa(a,b){return new Promise(function(d,e){b=b||{},pc.getConversationFeed(a,b.timestamp,b.minTotalItems,b.maxTotalUnread,b.commentsPerThread,b.maxUnreadPerThread,function(a,b,f){c(a,e)||Promise.all(b.map(Wb)).then(function(a){d({threads:a,hasOlderThreads:f})}).catch(e)})})}function ba(a,b,d){return new Promise(function(e,g){var h=d.modificationDate||d.creationDate,i=d.modificationDate?f.TimestampFilter.MODIFICATION:f.TimestampFilter.CREATION;pc.getThreadComments(a,b,h,i,d.direction,d.number||d.numberOfItems,function(a,b,d){c(a,g)||Promise.all(b.map(Ub)).then(function(a){e({items:a,hasMore:d})}).catch(g)})})}function ca(a){return new Promise(function(b,d){pc.getUserByEmail(a,function(a,e){c(a,d,null,function(a){a&&a.code===f.ReturnCode.NO_RESULT&&(a.info="User does not exist")})||Tb(e).then(b).catch(d)})})}function da(a){return new Promise(function(b,d){if(!a)return void d(new Circuit.Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"email is required"));if(!a.length)return b([]);var e={emailAddresses:a};pc.getUsersByEmails(e,function(a,e){c(a,d)||Promise.all(e.map(Tb)).then(b).catch(d)})})}function ea(a){return new Promise(function(b,d){return a?void pc.getUser(a,function(a,e){c(a,d)||Tb(e).then(b).catch(d)}):void d(new Circuit.Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"userId is required"))})}function fa(a,b){return new Promise(function(d,e){if(!a)return void e(new Circuit.Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"userIds is required"));if(!a.length)return d([]);var g=b?pc.getPartialUsersByIds:pc.getUsersByIds;g(a,function(a,b){c(a,e)||Promise.all(b.map(Tb)).then(d).catch(e)})})}function ga(){return new Promise(function(a,b){pc.getDevices(function(d,e){c(d,b,!0)||a(e||[])})})}function ha(){return new Promise(function(a,b){pc.getTelephonyConversationId(function(d,e){c(d,b)||a(e)})})}function ia(){return new Promise(function(a,b){pc.getSupportConversationId(function(d,e){c(d,b)||a(e)})})}function ja(a){return"string"==typeof a&&(a={userId:a,createIfNotExists:!1}),new Promise(function(b,d){return a.userId?void pc.getConversationByUser(a.userId,function(e,g){return e?void(e===f.ReturnCode.NO_RESULT?a.createIfNotExists?na(a.userId).then(function(a){b(a&&a.conversation)}):b():c(e,d)):void Xb(g).then(b).catch(d)}):void d(new Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"user ID is required"))})}function ka(a,b){return"string"!=typeof a?Promise.reject(new Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"email or user ID is required")):a.match(j.EMAIL_ADDRESS_PATTERN)?ca(a).then(function(a){return{userId:a.userId,createIfNotExists:b}}).then(ja):ja({userId:a,createIfNotExists:b})}function la(b,d){return new Promise(function(e,h){function i(a){a.mentionedUsers=j.createMentionedUsersArray(a.content),pc.addTextItem(a,function(a,b){c(a,h)||Ub(b).then(e).catch(h)})}if(!b)return void h(new Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"convId is required"));if(!d)return void h(new Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"content is required"));if("string"==typeof d)i({convId:b,content:d,contentType:"RICH"});else if("object"==typeof d){var k={convId:b,parentId:d.parentId,contentType:d.contentType||f.TextItemContentType.RICH,subject:d.subject,content:d.content,externalAttachmentMetaData:d.externalAttachments};if(d.attachments&&d.attachments.length>0){var l=new a.FileUpload(bc);l.uploadFiles(d.attachments,_b.domain).then(function(a){k.attachmentMetaData=[],a.forEach(function(a){k.attachmentMetaData.push(a)}),i(k)}).catch(function(a){g.error("[SDK]: Fileupload error.",a),h(new Circuit.Error(f.ReturnCode.SDK_ERROR,a))})}else i(k)}else h(new Circuit.Error(f.ReturnCode.SDK_ERROR,"Invalid content"))})}function ma(b){return new Promise(function(d,e){function h(a){a.mentionedUsers=j.createMentionedUsersArray(a.content),pc.updateTextItem(a,function(a,b){c(a,e)||Ub(b).then(d).catch(e)})}if(!b)return void e(new Circuit.Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"item is required"));if(!b.itemId)return void e(new Circuit.Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"item.itemId is required"));if("object"==typeof b)if(b.attachments&&b.attachments.length>0){var i=new a.FileUpload(bc);i.uploadFiles(b.attachments,_b.domain).then(function(a){b.attachmentMetaData=[],a.forEach(function(a){b.attachmentMetaData.push(a)}),h(b)}).catch(function(a){g.error("[SDK]: Fileupload error.",a),e(new Circuit.Error(f.ReturnCode.SDK_ERROR,a))})}else h(b);else e(new Circuit.Error(f.ReturnCode.SDK_ERROR,"Invalid content"))})}function na(a){return new Promise(function(b,d){if(_b.loggedOnUser.userId===a)return d(new Circuit.Error(f.ReturnCode.SDK_ERROR,"userId is of logged on user"));var e={type:f.ConversationType.DIRECT,participants:[{userId:a},{userId:_b.loggedOnUser.userId}]};pc.createConversation(e,function(a,e,f){c(a,d)||Xb(e).then(function(a){b({conversation:a,alreadyExists:f})})})})}function oa(a){return a&&"string"==typeof a?a.match(j.EMAIL_ADDRESS_PATTERN)?ca(a).then(function(a){return a.userId}).then(na):na(a):Promise.reject(new Circuit.Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"Participant email or user ID is required"))}function pa(a,b){return new Promise(function(d,e){if(!a)return void e(new Circuit.Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"Participants is required"));if(a.indexOf(_b.loggedOnUser.userId)===-1&&a.unshift(_b.loggedOnUser.userId),a.length<2)return void e(new Circuit.Error(f.ReturnCode.SDK_ERROR,"At least one participant (other than self) is required"));if(a.indexOf("")>-1||a.indexOf(null)>-1)return void e(new Circuit.Error(f.ReturnCode.SDK_ERROR,"Participant cannot be empty"));a=a.map(function(a){return{userId:a}});var g={type:f.ConversationType.GROUP,participants:a,topic:b};pc.createConversation(g,function(a,b){c(a,e)||Xb(b).then(d).catch(e)})})}function qa(a){return new Promise(function(b,d){if(!a)return void d(new Circuit.Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"Topic is required"));var e={type:f.ConversationType.GROUP,participants:[{userId:_b.loggedOnUser.userId}],topic:a};pc.createConversation(e,function(a,e){c(a,d)||Xb(e).then(b).catch(d)})})}function ra(a,b,d){return new Promise(function(e,g){a&&a.length||(a=[_b.loggedOnUser.userId]),a=a.map(function(a){return{userId:a}});var h={type:f.ConversationType.OPEN,participants:a,topic:b,description:d};pc.createConversation(h,function(a,b){c(a,g)||Xb(b).then(e).catch(g)})})}function sa(a,b){return new Promise(function(d,e){var f={convId:a,userId:b};pc.addParticipant(f,function(a){c(a,e)||d()})})}function ta(a,b){return new Promise(function(d,e){pc.removeParticipant(a,b,function(a){c(a,e)||d()})})}function ua(){return new Promise(function(a,b){pc.getFlaggedItems(function(d,e){c(d,b,!0)||a(e||[])})})}function va(a,b){return new Promise(function(d,e){pc.setFlagItem({convId:a,itemId:b},function(a){c(a,e)||d()})})}function wa(a,b){return new Promise(function(d,e){pc.clearFlagItem(a,b,function(a){c(a,e)||d()})})}function xa(a){return new Promise(function(b,d){pc.likeTextItem(a,_b.loggedOnUser.userId,function(a){c(a,d)||b()})})}function ya(a){return new Promise(function(b,d){pc.unlikeTextItem(a,_b.loggedOnUser.userId,function(a){c(a,d)||b()})})}function za(a,b){return new Promise(function(d,e){b=b||Date.now(),pc.setReadPointer(a,b,function(a){c(a,e)||d()})})}function Aa(a){return new Promise(function(b,d){return a?void pc.moderateConversation(a,function(a,e){if(!c(a,d))return e&&"LOCK_OK"===e.moderateResult?void b():void d(e)}):void d(new Circuit.Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"convId is required"))})}function Ba(a){return new Promise(function(b,d){return a?void pc.unmoderateConversation(a,function(a,e){if(!c(a,d))return e&&"UNLOCK_OK"===e.moderateResult?void b():void d(e)}):void d(new Circuit.Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"convId is required"))})}function Ca(a,b){return new Promise(function(d,e){return a&&b?void pc.grantModeratorRights(a,b,function(a,b){if(!c(a,e))return b&&"GRANT_OK"===b.grantModeratorResult?void d():void e(b)}):void e(new Circuit.Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"convId and userId are required"))})}function Da(a,b){return new Promise(function(d,e){return a&&b?void pc.dropModeratorRights(a,b,function(a,b){if(!c(a,e))return b&&"DROP_OK"===b.dropModeratorResult?void d():void e(b)}):void e(new Circuit.Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"convId and userId are required"))})}function Ea(a,b){return new Promise(function(d,e){return a?void pc.updateGuestAccess(a,b,function(a){c(a,e)||d()}):void e(new Circuit.Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"convId is required"))})}function Fa(a){return new Promise(function(b,d){pc.updateUser(a,function(a){c(a,d)||b()})})}function Ga(a,b){return new Promise(function(d,e){pc.changePassword(a,b,function(a){c(a,e)||d()})})}function Ha(a){var b={};return a&&a.forEach(function(a){switch(a.key){case f.UserSettingKey.OPT_OUT_PRESENCE:b.presenceOptOut=a.booleanValue;break;case f.UserSettingKey.SHARE_LOCATION:b.shareLocation=a.booleanValue}}),b}function Ia(a){return new Promise(function(b,d){if(!a)return void d(new Circuit.Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"userSettings is required"));var e=[];void 0!==a.presenceOptOut&&e.push({key:f.UserSettingKey.OPT_OUT_PRESENCE,dataType:f.UserSettingDataType.BOOLEAN,booleanValue:!!a.presenceOptOut}),void 0!==a.shareLocation&&e.push({key:f.UserSettingKey.SHARE_LOCATION,dataType:f.UserSettingDataType.BOOLEAN,booleanValue:!!a.shareLocation}),pc.setUserSettings(e,function(a){c(a,d)||b()})})}function Ja(){return new Promise(function(a,b){pc.getUserSettings([f.UserSettingArea.ALL],function(d,e){c(d,b)||a(Ha(e))})})}function Ka(a){return new Promise(function(b,d){a.userId=_b.loggedOnUser.userId,pc.setPresence(a,function(a){c(a,d)||b()})})}function La(a,b){return new Promise(function(d,e){pc.getPresence(a,b,function(a,b){c(a,e)||d(b)})})}function Ma(a){return new Promise(function(b,d){a=a||"",pc.setUserSettings({key:f.UserSettingKey.STATUS_MESSAGE_TEXT,dataType:f.UserSettingDataType.STRING,stringValue:a},function(e){c(e,d)||La([_b.loggedOnUser.userId]).then(function(b){return Ka({state:b.length&&b[0].state,statusMessage:a})}).then(b).catch(d)})})}function Na(){return new Promise(function(a,b){pc.getUserSettings([f.UserSettingArea.ALL],function(d,e){if(!c(d,b)){var g="";e&&e.some(function(a){if(a.key===f.UserSettingKey.STATUS_MESSAGE_TEXT)return g=a.stringValue,!0}),a(g)}})})}function Oa(a){return new Promise(function(b,d){pc.subscribePresence(a,function(a){c(a,d)||b()})})}function Pa(a){return new Promise(function(b,d){pc.unsubscribePresence(a,function(a){c(a,d)||b()})})}function Qa(){return new Promise(function(a,b){pc.renewToken(_b.loggedOnUser.userId,function(d){return c(d,b)?void Zb({type:"renewSessionTokenFailed",error:d}):(g.debug("[SDK]: Session token renewed"),Zb({type:"sessionTokenRenewed"}),void a())})})}function Ra(a){return"string"==typeof a&&(a={query:a}),new Promise(function(b,c){pc.startUserSearch(a,function(a,d){a?c(a):b(d)})})}function Sa(a){return ga().then(function(b){return b.some(function(b){return a?b.clientId===a:b.clientId!==_b.loggedOnUser.clientId&&(b.clientInfo.deviceType===f.DeviceType.WEB||b.clientInfo.deviceType===f.DeviceType.APPLICATION&&"DESKTOP_APP"===b.clientInfo.deviceSubtype)})})}function Ta(a){return ga().then(function(b){return b.some(function(b){return b.clientId===a})})}function Ua(a,b,c,d){return new Promise(function(e,g){function h(){var c=_b.domain.startsWith("sdk.")?_b.domain.substr(4):_b.domain,d="https://"+c+"/#/call?user="+a+"&media="+b,h=window.open(d,"_blank");return h?(h.focus(),void e({type:"CALL_VIA_URL",win:h})):void g(new Circuit.Error(f.ErrorCode.SDK_ERROR,"Popup blocker prevented opening Circuit in new window"))}function i(c){var d={content:{type:"CLICK_TO_CALL_REQUEST",mediaType:b,contact:{email:a},promptBeforeDial:!c,sdk:!0},destUserId:_b.loggedOnUser.userId};c&&(d.destClientId=c),qc.sendContactCardRequest(d,function(a){a?g(new Circuit.Error(f.ErrorCode.SDK_ERROR,a)):e({type:"CALL_VIA_OTHER_CLIENT"})})}b=b||"audio",c?Ta(c).then(function(a){a?i(c):g(new Circuit.Error(f.ErrorCode.SDK_ERROR,"No client found for clientId "+c))}):Sa().then(function(a){a?i():d?g(new Circuit.Error(f.ErrorCode.SDK_ERROR,"No clients found and launch parameter not set.")):h()})})}function Va(a,b,c){return new Promise(function(d,e){function g(c){var g={content:{type:"CLICK_TO_ANSWER_REQUEST",mediaType:b,callId:a,promptBeforeAnswer:!c,sdk:!0},destUserId:_b.loggedOnUser.userId};c&&(g.destClientId=c),qc.sendContactCardRequest(g,function(a){a?e(new Circuit.Error(f.ErrorCode.SDK_ERROR,a)):d({type:"ANSWER_VIA_OTHER_CLIENT"})})}b=b||"audio",c?Ta(c).then(function(a){a?g(c):e(new Circuit.Error(f.ErrorCode.SDK_ERROR,"No client found for clientId "+c))}):Sa().then(function(a){a?g():e(new Circuit.Error(f.ErrorCode.SDK_ERROR,"No clients found and launch parameter not set."))})})}function Wa(a,b,c){return new Promise(function(d,e){return a?(c=c||{},void 0===c.mic&&(c.mic=!0),void 0===c.speaker&&(c.speaker=!0),void Sa(b).then(function(g){if(g){var h={content:{type:"MUTE_DEVICE_REQUEST",callId:a,option:c},destUserId:_b.loggedOnUser.userId,destClientId:b,sdk:!0
};qc.sendContactCardRequest(h,function(a,b){return a?void e(new Circuit.Error(f.ErrorCode.SDK_ERROR,a)):b&&b.response?b.response.code&&"OK"!==b.response.code?void e(new Circuit.Error(f.ErrorCode.SDK_ERROR,b.response.code)):void d():void e(new Circuit.Error(f.ErrorCode.SDK_ERROR,"Invalid response for MUTE_DEVICE_REQUEST"))})}else e(new Circuit.Error(f.ErrorCode.SDK_ERROR,"Device not found"))})):void e(new Circuit.Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))})}function Xa(a,b){return new Promise(function(c,d){if(!a)return void d(new Circuit.Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"));if(!b)return void d(new Circuit.Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"to parameter is required"));if(!b.userId&&!b.email&&!b.number)return void d(new Circuit.Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"to.userId, to.email or to.number is required"));var e={userId:b.userId||void 0,dialOutPhoneNumber:b.number||void 0,displayName:b.displayName||void 0};!b.userId&&b.email&&b.email.match(j.EMAIL_ADDRESS_PATTERN)?ca(b.email).then(function(b){e.userId=b.userId,sc.CallControlSvc.addParticipantToCall(a,e,function(a){a?d(new Circuit.Error(f.ErrorCode.SDK_ERROR,a)):c()})}).catch(d):sc.CallControlSvc.addParticipantToCall(a,e,function(a){a?d(new Circuit.Error(f.ErrorCode.SDK_ERROR,a)):c()})})}function Ya(a,b){return new Promise(function(c,d){if(!a)return void d(new Circuit.Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"));if(!b)return void d(new Circuit.Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"to parameter is required"));if(!b.userId&&!b.email&&!b.number)return void d(new Circuit.Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"to.userId, to.email or to.number is required"));var e={userId:b.userId||void 0,dialOutPhoneNumber:b.number||void 0,displayName:b.displayName||void 0};!b.userId&&b.email&&b.email.match(j.EMAIL_ADDRESS_PATTERN)?ca(b.email).then(function(b){e.userId=b.userId,sc.CallControlSvc.addParticipantToRtcSession(a,e,function(a){a?d(new Circuit.Error(f.ErrorCode.SDK_ERROR,a)):c()})}).catch(d):sc.CallControlSvc.addParticipantToRtcSession(a,e,function(a){a?d(new Circuit.Error(f.ErrorCode.SDK_ERROR,a)):c()})})}function Za(a){var b=sc.CallControlSvc.findCall(a);return b?b:(b=sc.CallControlSvc.getActiveCall(a),b||null)}function $a(){return Promise.all(sc.CallControlSvc.getCalls().map(Sb))}function _a(){return Promise.resolve(Sb(sc.CallControlSvc.getActiveCall()))}function ab(){return Promise.all(sc.CallControlSvc.getActiveRemoteCall().map(Sb))}function bb(){return Promise.all(sc.CallControlSvc.getCalls().filter(function(a){return a.state.name===Circuit.Enums.CallState.Started.name}).map(Sb))}function cb(a,b){return X(a).then(function(a){return new Promise(function(c,d){return a?(sc.SdkHelperSvc.addConversationToCache(a),void sc.CallControlSvc.startConference(a.convId,b,function(a,b,e){k(a,d)||Sb(e).then(c).catch(d)})):void d(new Circuit.Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"Conversation does not exist"))})})}function db(a){return a.pin=a.tenantPIN+a.sessionPIN,a.link&&(a.link="https://"+_b.domain+a.link),delete a.tenantPIN,delete a.sessionPIN,delete a.conversationId,a}function eb(a){return new Promise(function(b,d){pc.getJoinDetails(a,!1,function(a,e){c(a,d)||b(db(e))})})}function fb(a){return new Promise(function(b,d){pc.getJoinDetails(a,!0,function(a,e){c(a,d)||b(db(e))})})}function gb(a,b,c){return new Promise(function(d,e){return a?void(c&&c!==_b.loggedOnUser.clientId?Ta(c).then(function(g){if(g){var h={content:{type:"JOIN_CONFERENCE_REQUEST",callId:a,mediaType:b},destUserId:_b.loggedOnUser.userId,destClientId:c};qc.sendContactCardRequest(h,function(a,b){return a?void e(new Circuit.Error(f.ErrorCode.SDK_ERROR,a)):b&&b.response?b.response.code&&"OK"!==b.response.code?void e(new Circuit.Error(f.ErrorCode.SDK_ERROR,b.response.code)):void d():void e(new Circuit.Error(f.ErrorCode.SDK_ERROR,"Invalid response for JOIN_CONFERENCE_REQUEST"))})}else e(new Circuit.Error(f.ErrorCode.SDK_ERROR,"No client found for clientId "+c))}):sc.CallControlSvc.joinGroupCall(a,b,function(a){k(a,e)||d()})):void e(new Circuit.Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))})}function hb(a,b){return new Promise(function(c,d){return a?void sc.CallControlSvc.pullRemoteCall(a,b,function(a){k(a,d)||c()}):void d(new Circuit.Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))})}function ib(a){return new Promise(function(b,c){return a?void sc.CallControlSvc.endRemoteCall(a,function(a){k(a,c)||b()}):void c(new Circuit.Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))})}function jb(a,b){return new Promise(function(c,d){return a?void sc.CallControlSvc.dropParticipant(a,{userId:b},function(a){k(a,d)||c()}):void d(new Circuit.Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))})}function kb(a,b){return new Promise(function(c,d){return a?void sc.CallControlSvc.muteParticipant(a,{userId:b},function(a){k(a,d)||c()}):void d(new Circuit.Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))})}function lb(a){return new Promise(function(b,c){return a?void sc.CallControlSvc.muteRtcSession(a,function(a){k(a,c)||b()}):void c(new Circuit.Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))})}function mb(a){return new Promise(function(b,c){if(!a)return void c(new Circuit.Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"devices is required"));if(!(a.playback||a.recording||a.video||a.ringing))return void c(new Circuit.Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"devices must contain playback, recording, video or ringing attributes"));a.playback&&(a.playback=Array.isArray(a.playback)?a.playback:[a.playback],rc.playbackDevices=a.playback.map(function(a){return{id:a}})),a.recording&&(a.recording=Array.isArray(a.recording)?a.recording:[a.recording],rc.recordingDevices=a.recording.map(function(a){return{id:a}})),a.video&&(a.video=Array.isArray(a.video)?a.video:[a.video],rc.videoDevices=a.video.map(function(a){return{id:a}})),a.ringing&&(a.ringing=Array.isArray(a.ringing)?a.ringing:[a.ringing],rc.ringingDevices=a.ringing.map(function(a){return{id:a}}));var d=sc.CallControlSvc.getActiveCall();d?sc.CallControlSvc.renegotiateMedia(d.callId,function(a){a&&g.warn("[SDK]: Unable to renegotiate media.",a),b()}):b()})}function nb(a,b,c){return ka(a,c).then(function(a){return new Promise(function(c,d){return a?(sc.SdkHelperSvc.addConversationToCache(a),void sc.CallControlSvc.makeCall(a.convId,b,function(a,b,e){k(a,d)||Sb(e).then(c).catch(d)})):void d(new Circuit.Error(f.ErrorCode.SDK_ERROR,"Conversation does not exist"))})})}function ob(a,b){return new Promise(function(c,d){return j.PHONE_PATTERN.test(a||null)?void sc.CallControlSvc.dialNumber(a,b,{audio:!0,video:!1},function(a,b,e){k(a||b,d)||Sb(e).then(c).catch(d)}):void d(new Circuit.Error(f.ReturnCode.SDK_ERROR,"Invalid number"))})}function pb(a,b){return new Promise(function(c,d){return/^[\d#\*,]+$/.exec(b)?void sc.CallControlSvc.sendDigits(a,b,function(a){k(a,d)||c()}):void d(new Circuit.Error(f.ReturnCode.SDK_ERROR,"Invalid DTMF digits (Allowed: 0-9,#,*)"))})}function qb(a,b,c){return new Promise(function(d,e){return a?void sc.CallControlSvc.answerCallOnDevice(a,b,c&&i[c],function(a){k(a,e)||d()}):void e(new Circuit.Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))})}function rb(a){return new Promise(function(b,c){return a?void sc.CallControlSvc.endCall(a,function(a){k(a,c)||b()}):void c(new Circuit.Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))})}function sb(a){return new Promise(function(b,c){return a?void sc.CallControlSvc.endConference(a,function(a){k(a,c)||b()}):void c(new Circuit.Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))})}function tb(a){return new Promise(function(b,c){return a?void sc.CallControlSvc.toggleVideo(a,function(a){k(a,c)||b()}):void c(new Circuit.Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))})}function ub(a,b){return new Promise(function(c,d){return a?(b=!!b,void sc.CallControlSvc.changeHDVideo(a,b,function(a){k(a,d)||c()})):void d(new Circuit.Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))})}function vb(a){return new Promise(function(b,c){if(!a)return void c(new Circuit.Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"));var d=Za(a);return d?(d.remoteAudioDisabled?sc.CallControlSvc.enableRemoteAudio(a):sc.CallControlSvc.disableRemoteAudio(a),void b(a)):void c(new Circuit.Error(f.ReturnCode.SDK_ERROR,"No call found"))})}function wb(a){return new Promise(function(b,c){return a?void sc.CallControlSvc.toggleRemoteVideo(a,function(a){k(a,c)||b()}):void c(new Circuit.Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))})}function xb(a){return new Promise(function(b,c){if(!a)return void c(new Circuit.Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"));var d=Za(a);return d?void(d.hasLocalScreenShare()?sc.CallControlSvc.removeScreenShare(a,function(a){k(a,c)||b()}):sc.CallControlSvc.addScreenShare(a,null,function(a){k(a,c)||b()})):void c(new Circuit.Error(f.ReturnCode.SDK_ERROR,"No call found"))})}function yb(a,b){return new Promise(function(c,d){if(!a)return void d(new Circuit.Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"));var e=Za(a);if(!e)return void d(new Circuit.Error(f.ReturnCode.SDK_ERROR,"No call found"));if(e.hasLocalScreenShare())sc.CallControlSvc.removeMediaStream(a,function(a){k(a,d)||c()});else{if(!b)return void d(new Circuit.Error(f.ReturnCode.SDK_ERROR,"Missing MediaStream"));sc.CallControlSvc.addMediaStream(a,b,function(a){k(a,d)||c()})}})}function zb(a,b){return new Promise(function(c,d){if(!a)return void d(new Circuit.Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"));if(!b)return void d(new Circuit.Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"stream is required"));var e=Za(a);if(!e)return void d(new Circuit.Error(f.ReturnCode.SDK_ERROR,"No call found"));if(Circuit.WebRTCAdapter.origGetUserMedia)return void d(new Circuit.Error(f.ReturnCode.SDK_ERROR,"Already setting another audio/video stream"));var g={audio:!!b.getAudioTracks().length,video:!!b.getVideoTracks().length};Circuit.WebRTCAdapter.origGetUserMedia=Circuit.WebRTCAdapter.getUserMedia,Circuit.WebRTCAdapter.getUserMedia=function(a,c){c&&c(b)},sc.CallControlSvc.setMediaType(a,g,function(a){Circuit.WebRTCAdapter.getUserMedia=Circuit.WebRTCAdapter.origGetUserMedia,delete Circuit.WebRTCAdapter.origGetUserMedia,k(a,d)||c()})})}function Ab(a,b){return new Promise(function(c,d){if(!a)return void d(new Circuit.Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"));var e=sc.CallControlSvc.getActiveCall();return e?a!==e.callId?void d(new Circuit.Error(f.ReturnCode.SDK_ERROR,"Call ID is not for active call")):void sc.CallControlSvc.startRecording(function(a){k(a,d)||c()},b):void d(new Circuit.Error(f.ReturnCode.SDK_ERROR,"No active call found"))})}function Bb(a){return new Promise(function(b,c){if(!a)return void c(new Circuit.Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"));var d=sc.CallControlSvc.getActiveCall();return d?a!==d.callId?void c(new Circuit.Error(f.ReturnCode.SDK_ERROR,"Call ID is not for active call")):void sc.CallControlSvc.stopRecording(function(a){k(a,c)||b()}):void c(new Circuit.Error(f.ReturnCode.SDK_ERROR,"No active call found"))})}function Cb(a){return new Promise(function(b,d){pc.deleteRecording(a,function(a){c(a,d)||b()})})}function Db(a){return new Promise(function(b,c){return a?void sc.CallControlSvc.mute(a,function(a){k(a,c)||b()}):void c(new Circuit.Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))})}function Eb(a){return new Promise(function(b,c){return a?void sc.CallControlSvc.unmute(a,function(a){k(a,c)||b()}):void c(new Circuit.Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))})}function Fb(a){if(!a)throw new Circuit.Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required");var b=Za(a);return b&&b.sessionCtrl?b.sessionCtrl.getLastSavedStats()||[]:null}function Gb(a){if(!a)throw new Circuit.Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required");var b=Za(a);return b&&b.sessionCtrl?b.sessionCtrl.getRemoteStreams()||[]:null}function Hb(a,b){return new Promise(function(d,e){if(!a)return void e(new Circuit.Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"));if(!b)return void e(new Circuit.Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"viewbox is required"));var g={rtcSessionId:a,viewbox:b};pc.enableWhiteboard(g,function(a){c(a,e)||d()})})}function Ib(a){return new Promise(function(b,d){if(!a)return void d(new Circuit.Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"));var e={rtcSessionId:a};pc.disableWhiteboard(e,function(a){c(a,d)||b()})})}function Jb(a,b){return new Promise(function(d,e){if(!a)return void e(new Circuit.Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"));if(!b)return void e(new Circuit.Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"xmlElement is required"));var g={rtcSessionId:a,xmlElement:b};pc.addWhiteboardElement(g,function(a){c(a,e)||d()})})}function Kb(a,b){return new Promise(function(d,e){if(!a)return void e(new Circuit.Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"));if(!b)return void e(new Circuit.Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"xmlId is required"));var g={rtcSessionId:a,xmlId:b};pc.removeWhiteboardElement(g,function(a){c(a,e)||d()})})}function Lb(a,b,d){return new Promise(function(e,g){if(!a)return void g(new Circuit.Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"));if(!b)return void g(new Circuit.Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"xmlId is required"));if(!d)return void g(new Circuit.Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"xmlElement is required"));var h={rtcSessionId:a,xmlId:b,xmlElement:d};pc.updateWhiteboardElement(h,function(a){c(a,g)||e()})})}function Mb(a,b){return new Promise(function(d,e){if(!a)return void e(new Circuit.Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"));var g={rtcSessionId:a,userId:b||void 0};pc.clearWhiteboard(g,function(a){c(a,e)||d()})})}function Nb(a){return new Promise(function(b,d){if(!a)return void d(new Circuit.Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"));var e={rtcSessionId:a};pc.getWhiteboard(e,function(a,e){c(a,d)||(e.callId=e.rtcSessionId,delete e.rtcSessionId,b(e))})})}function Ob(a,b,c){return new Promise(function(d,e){if(!a||"string"!=typeof a)return void e(new Circuit.Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"type [string] is required"));if(!b||"string"!=typeof b)return void e(new Circuit.Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"userId [string] is required"));if(!c||"object"!=typeof c)return void e(new Circuit.Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"content [object] is required"));var g={content:{type:a,message:c},destUserId:b};qc.sendSdkRequest(g,function(a){a?e(new Circuit.Error(f.ErrorCode.SDK_ERROR,a)):d()})})}function Pb(a,b,c){return new Promise(function(d,e){if(!a||"string"!=typeof a)return void e(new Circuit.Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"type [string] is required"));if(!b||"string"!=typeof b)return void e(new Circuit.Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"destClientId [string] is required"));if(!c||"object"!=typeof c)return void e(new Circuit.Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"content [object] is required"));var g={content:{type:a,message:c},destUserId:_b.loggedOnUser.userId,destClientId:b};qc.sendSdkRequest(g,function(a){a?e(new Circuit.Error(f.ErrorCode.SDK_ERROR,a)):d()})})}function Qb(a){var b=0;if(a)for(var c=0;c<a.length;c++)b+=a.charCodeAt(c);return xc[b%xc.length]}function Rb(a,b){if("function"==typeof a)try{var c=a(b);if(c&&"object"==typeof c)return"function"==typeof c.then?c:Promise.resolve(c)}catch(a){g.error("[SDK]: Error applying injector. ",a)}return Promise.resolve(b)}function Sb(a){if(!a)return Promise.resolve();var b={};return yc.forEach(function(c){b[c]=j.shallowCopy(a[c])}),b.state=a.state.name,b.isEstablished=a.state.established,Rb(Circuit.Injectors.callInjector,b)}function Tb(a){if(!a)return Promise.resolve();if(a.smallImageUri&&a.largeImageUri)a.avatar=l()+"fileapi/"+a.userId+"_s.jpg?fileid="+a.smallImageUri,a.avatarLarge=l()+"fileapi/"+a.userId+"_b.jpg?fileid="+a.largeImageUri,a.hasAvatar=!0;else{var b=Qb(a.userId);a.avatar="https://"+_b.domain+tc+b+".png",a.avatarLarge="https://"+_b.domain+tc+b+"-XL.png"}return delete a.smallImageUri,delete a.largeImageUri,delete a.tenantId,delete a.roles,delete a.accountTemplateType,delete a.associatedGTCUserId,delete a.reroutingPhoneNumber,delete a.assignedPhoneNumbers,a.hasPermission=function(a){if(!this.accounts||!a)return!1;var b=this.accounts[0],c=b&&b.permissions;return!!c&&c.some(function(b){return b.systemPermission===a})},Rb(Circuit.Injectors.userInjector,a)}function Ub(a){if(!a)return Promise.resolve();switch(a.type){case f.ConversationItemType.TEXT:a.text.state===f.TextItemState.DELETED?a.text.content="":(a.attachments=a.attachments||[],a.externalAttachments=a.externalAttachments||[],"standard"===bc.emoticonMode&&(a.text.content=j.standardizeEmoticon(a.text.content)),h.retrievePrivateDataFromContent(a),bc.removeMentionHtml&&(a.text.content=j.removeMentionHtml(a.text.content)));break;case f.ConversationItemType.SYSTEM:a.system.affectedParticipants&&(a.system.affectedParticipants=a.system.affectedParticipants.map(function(a){return a.userId}))}return a.attachments&&a.attachments.forEach(function(a){a.url=l()+"fileapi/"+encodeURIComponent(a.fileName)+"?fileid="+a.fileId+"&itemid="+a.itemId}),Rb(Circuit.Injectors.itemInjector,a)}function Vb(a){return new Promise(function(b){return a&&a.topLevelItem?(g.debug("[SDK]: Publicize the topLevelItem. convId = ",a.convId),void Ub(a.topLevelItem).then(function(){g.debug("[SDK]: Publicized topLevelItem. convId = ",a.convId),b(a)}).catch(function(c){g.error("[SDK]: Failed to publicize topLevelItem. ",c),b(a)})):void b(a)})}function Wb(a){return new Promise(function(b){if(!a||!a.parentItem)return void b(a);g.debug("[SDK]: Publicize the thread. itemId = ",a.parentItem.intemId),a.comments=a.comments||[];var c=a.comments.slice(0);c.unshift(a.parentItem),Promise.all(c.map(Ub)).then(function(){b(a)}).catch(function(c){g.error("[SDK]: Failed to publicize thread. ",c),b(a)})})}function Xb(a){if(!a)return Promise.resolve();if(g.debug("[SDK]: Publicize conversation. convId = ",a.convId),a.participants=a.participants.map(function(a){return a.userId}),a.moderators=a.moderators&&a.moderators.map(function(a){return a.userId}),a.isTelephonyConversation=a.convId===gc,a.isSupportConversation=a.convId===hc,a.type!==f.ConversationType.DIRECT){if(a.conversationAvatar&&a.conversationAvatar.smallPictureId&&a.conversationAvatar.largePictureId)a.avatar=l()+"avatar?convId="+a.convId+"&type=small&fileid="+a.conversationAvatar.smallPictureId,a.avatarLarge=l()+"avatar?convId="+a.convId+"&type=large&fileid="+a.conversationAvatar.largePictureId,a.hasConversationAvatar=!0;else if(a.type===f.ConversationType.OPEN){var b=a.isDraft?"-grey":Qb(a.convId);a.avatar="https://"+_b.domain+uc+b+".png",a.avatarLarge="https://"+_b.domain+uc+b+"-XL.png"}else a.type===f.ConversationType.LARGE?(a.avatar="https://"+_b.domain+vc+".png",a.avatarLarge="https://"+_b.domain+vc+"-XL.png"):(a.avatar="https://"+_b.domain+wc+".png",a.avatarLarge="https://"+_b.domain+wc+"-XL.png");a.type===f.ConversationType.OPEN&&(a.type=e.COMMUNITY)}var c=Rb(Circuit.Injectors.conversationInjector,a);return c.then(Vb)}function Yb(a){if(!a)return Promise.resolve();if(a.smallImageUri&&a.largeImageUri)a.avatar=l()+"fileapi/"+a.userId+"_s.jpg?fileid="+a.smallImageUri,a.avatarLarge=l()+"fileapi/"+a.userId+"_b.jpg?fileid="+a.largeImageUri,a.hasAvatar=!0;else{var b=Qb(a.userId);a.avatar="https://"+_b.domain+tc+b+".png",a.avatarLarge="https://"+_b.domain+tc+b+"-XL.png"}return delete a.smallImageUri,delete a.largeImageUri,Rb(Circuit.Injectors.participantInjector,a)}function Zb(a){g.debug("[SDK]: Enqueue "+a.type),mc.push(a)}function $b(){if(!nc&&mc.length){nc=!0;try{var a=mc.shift();if(g.debug("[SDK]: Dequeue "+a.type+". Events left in the queue: "+mc.length),!_b.hasEventListener(a.type))return void g.debug("[SDK]: There is no listener for this event");var b=[];b.push(a.user?Tb(a.user):void 0),b.push(a.item?Ub(a.item):void 0),b.push(a.conversation?Xb(a.conversation):void 0),b.push(a.call?Sb(a.call):void 0),Promise.all(b).then(function(b){b[0]&&(a.user=b[0]),b[1]&&(a.item=b[1]),b[2]&&(a.conversation=b[2]),b[3]&&(a.call=b[3]),g.debug("[SDK]: Dispatch ",a.type),_b.dispatch(a)})}catch(a){g.error("[SDK]: Error processing event queue. ",a)}finally{nc=!1}}}a.BaseEventTarget.call(this,a.logger);var _b=this,ac=a.Enums.ConnectionState.Disconnected,bc=j.shallowCopy(b)||{};bc.domain=bc.domain||"circuitsandbox.net",bc.emoticonMode=bc.emoticonMode||"standard",o(b);var cc,dc,ec,fc,gc,hc,ic="node"===window.navigator.platform,jc="dotnet"===window.navigator.platform,kc="Win32"===window.navigator.platform,lc="iOS"===window.navigator.platform||"Android"===window.navigator.platform,mc=[],nc=!1,oc=null,pc=new a.ClientApiHandler(bc),qc=new a.UserToUserHandler(pc),rc=a.RtcSessionController;_b._clientApiHandler=pc,_b._userToUserHandler=qc,_b._rtcSessionController=rc;var sc=new a.SdkServices(pc,qc),tc="/content/images/icon-general-default-avatar",uc="/content/images/icon-general-openconvo-avatar",vc="/content/images/icon-general-large-conference",wc="/content/images/icon-general-emptyconvo-avatar",xc=["-blue","-green","-orange","-yellow"],yc=["activeMediaType","callId","convId","convType","direction","isMeetingPointInvited","isRemote","isTelephonyCall","isTestCall","locallyMuted","localMediaType","localVideoUrl","mediaType","participants","remoteAudioDisabled","remoteAudioUrl","remotelyMuted","remoteVideoDisabled","recording","ringAllAllowed","ringAllMaxNumber","whiteboardEnabled"];return Object.defineProperty(_b,"domain",{get:function(){return bc.domain},set:function(a){bc.domain=a},enumerable:!0,configurable:!1}),Object.defineProperty(_b,"accessToken",{get:function(){return cc},set:function(a){cc=a},enumerable:!0,configurable:!0}),Object.defineProperty(_b,"expiresAt",{get:function(){return dc},enumerable:!0,configurable:!0}),Object.defineProperty(_b,"connectionState",{get:function(){return ac},enumerable:!0,configurable:!0}),_b.setOauthConfig=o,_b.logon=function(a){var b,c;if(a){if("object"!=typeof a)return b="OAuth2 is the only supported authentication menthod. Basic Auth is not supported anymore.",g.error(b),Promise.reject(new Circuit.Error(f.ErrorCode.SDK_ERROR,"Credentials mismatch. Details: "+b));if(bc.client_id&&bc.client_secret)return b="Circuit.Client is created with client_id and client_secret (Client Credentials Grant), so no token should be passed to the logon API.",g.error(b),Promise.reject(new Circuit.Error(f.ErrorCode.SDK_ERROR,"Credentials mismatch. Details: "+b));if(bc.client_id&&a.token)return b="Circuit.Client is created with client_id, so no API token should be passed to the logon API.",g.error(b),Promise.reject(new Circuit.Error(f.ErrorCode.SDK_ERROR,"Credentials mismatch. Details: "+b));if(!bc.client_id&&!a.token)return b="Circuit.Client was not created with client_id, so API token should be passed to the logon API.",g.error(b),Promise.reject(new Circuit.Error(f.ErrorCode.SDK_ERROR,"Credentials mismatch. Details: "+b))}else if(!bc.client_id)return b="Login with a session cookie has been disabled. OAuth2 or API token are the only supported authentication method.",g.error(b),Promise.reject(new Circuit.Error(f.ErrorCode.SDK_ERROR,"Credentials mismatch. Details: "+b));return bc.client_id&&bc.client_secret?F().then(q).then(E):bc.client_id&&a&&a.username&&a.password?G(a.username,a.password).then(q).then(E):bc.client_id&&a&&a.accessToken?ic||jc||kc||lc?q(a).then(E):(a.prompt&&(c="https://"+bc.domain+"/dist/oauthLoading.html",_b.oauthwin=m(c,450,500)),cc=a.accessToken,y().then(function(){return a.prompt?r().then(function(){_b.oauthwin.close(),_b.oauthwin=null}).catch(x).then(E):E()}).catch(function(a){return _b.oauthwin&&_b.oauthwin.close(),_b.oauthwin=null,Promise.reject(a)})):bc.client_id?_b.logonChecked?E():a&&a.logonChecked?u().then(y).then(r).then(E):(c="https://"+bc.domain+"/dist/oauthLoading.html",_b.oauthwin=m(c,450,500),u().then(y).then(r).then(function(){_b.oauthwin.close(),_b.oauthwin=null}).catch(w).then(E)):a&&a.token?q(a).then(E):Promise.reject(new Circuit.Error(f.ErrorCode.MISSING_REQUIRED_PARAMETER,"Missing credentials"))},_b.logonCheck=function(){return u().then(y).then(r).then(function(){_b.logonChecked=!0,fc&&window.clearTimeout(fc),fc=window.setTimeout(function(){fc=null,_b.logonChecked=!1},5e3)})},_b.logout=H,_b.revokeToken=I,_b.setCookie=function(a){bc.cookie=a},_b.getCookie=function(){return bc.cookie},_b.isAuthenticated=r,_b.validateToken=y,_b.getLoggedOnUser=K,_b.getTelephonyConversationId=ha,_b.getSupportConversationId=ia,_b.getTenantUsers=L,_b.subscribePresence=Oa,_b.unsubscribePresence=Pa,_b.renewSessionToken=Qa,_b.renewToken=A,_b.getUserById=ea,_b.getUsersById=fa,_b.getUserByEmail=ca,_b.getUsersByEmail=da,_b.updateUser=Fa,_b.changePassword=Ga,_b.getPresence=La,_b.setPresence=Ka,_b.setStatusMessage=Ma,_b.getStatusMessage=Na,_b.setUserSettings=Ia,_b.getUserSettings=Ja,_b.getDevices=ga,_b.getConversations=M,_b.getMarkedConversations=N,_b.getFavoriteConversationIds=O,_b.favoriteConversation=P,_b.unfavoriteConversation=Q,_b.archiveConversation=R,_b.unarchiveConversation=S,_b.getAllLabels=T,_b.getConversationsByFilter=U,_b.getConversationsByLabel=V,_b.getArchivedConversations=W,_b.getConversationById=X,_b.getConversationsByIds=Y,_b.getConversationParticipants=Z,_b.getItemById=$,_b.getConversationItems=_,_b.getConversationFeed=aa,_b.getItemsByThread=ba,_b.addTextItem=la,_b.updateTextItem=ma,_b.getDirectConversationWithUser=ka,_b.addParticipant=sa,_b.removeParticipant=ta,_b.getFlaggedItems=ua,_b.flagItem=va,_b.unflagItem=wa,_b.likeItem=xa,_b.unlikeItem=ya,_b.markItemsAsRead=za,_b.moderateConversation=Aa,_b.unmoderateConversation=Ba,_b.grantModeratorRights=Ca,_b.dropModeratorRights=Da,_b.enableGuestAccess=function(a){return Ea(a,!1)},_b.disableGuestAccess=function(a){return Ea(a,!0)},_b.createDirectConversation=oa,_b.createGroupConversation=pa,_b.createConferenceBridge=qa,_b.createCommunity=ra,_b.findCall=function(a){return Promise.resolve(Sb(Za(a)))},_b.getCalls=$a,_b.getActiveCall=_a,_b.getActiveRemoteCalls=ab,_b.getStartedCalls=bb,_b.startConference=cb,_b.getConversationDetails=eb,_b.changeConversationPin=fb,_b.joinConference=gb,_b.pullRemoteCall=hb,_b.leaveConference=rb,_b.endConference=sb,_b.setMediaDevices=mb,_b.makeCall=nb,_b.endRemoteCall=ib,_b.dropParticipant=jb,_b.muteParticipant=kb,_b.muteRtcSession=lb,_b.getCallDevices=function(){return sc.CallControlSvc.getCallDevices().map(function(a){return a.name})},_b.getPushDevices=function(){return sc.CallControlSvc.getPushDevices().map(function(a){return a.name})},_b.getAnswerDevices=function(a){return sc.CallControlSvc.getAnswerDevices(a).map(function(a){return a.name})},_b.getAtcCalls=sc.CallControlSvc.getAtcCalls,_b.dialNumber=ob,_b.getTelephonyData=sc.SdkHelperSvc.getTelephonyData,_b.sendDigits=pb,_b.sendClickToCallRequest=Ua,_b.sendClickToAnswerRequest=Va,_b.muteDevice=Wa,_b.addParticipantToCall=Xa,_b.addParticipantToRtcSession=Ya,_b.answerCall=qb,_b.endCall=rb,_b.toggleVideo=tb,_b.changeHDVideo=ub,_b.toggleRemoteAudio=vb,_b.toggleRemoteVideo=wb,_b.toggleScreenShare=xb,_b.setScreenshareStream=yb,_b.toggleMediaStream=yb,_b.setAudioVideoStream=zb,_b.startRecording=Ab,_b.stopRecording=Bb,_b.deleteRecording=Cb,_b.mute=Db,_b.unmute=Eb,_b.getLastRtpStats=Fb,_b.getRemoteStreams=Gb,_b.enableWhiteboard=Hb,_b.disableWhiteboard=Ib,_b.addWhiteboardElement=Jb,_b.removeWhiteboardElement=Kb,_b.updateWhiteboardElement=Lb,_b.clearWhiteboard=Mb,_b.getWhiteboard=Nb,_b.startUserSearch=Ra,_b.sendAppMessageToUser=Ob,_b.sendAppMessageToClient=Pb,_b.addAppMessageListener=function(a,b){qc.on("SDK."+a,b)},_b.removeAppMessageListener=qc.off,sc.PubSubSvc.subscribe("/localUser/update",function(){Zb({type:"loggedOnUserUpdated",user:_b.loggedOnUser})}),pc.on("Conversation.ADD_ITEM",function(a){Zb({type:"itemAdded",item:a.item})}),pc.on("Conversation.UPDATE_ITEM",function(a){Zb({type:"itemUpdated",item:a.item})}),pc.on("Conversation.CREATE",function(a){Zb({type:"conversationCreated",conversation:a.conversation})}),pc.on("Conversation.UPDATE",function(a){Zb({type:"conversationUpdated",conversation:a.conversation})}),pc.on("Conversation.CONVERSATION_MARKED",function(a){switch(a.filter){case f.ConversationMarkFilter.MUTE:Zb({type:"conversationArchived",convId:a.convId});break;case f.ConversationMarkFilter.FAVORITE:Zb({type:"conversationFavorited",convId:a.convId})}}),pc.on("Conversation.CONVERSATION_UNMARKED",function(a){switch(a.filter){case f.ConversationMarkFilter.MUTE:Zb({type:"conversationUnarchived",convId:a.convId});break;case f.ConversationMarkFilter.FAVORITE:Zb({type:"conversationUnfavorited",convId:a.convId})}}),pc.on("Conversation.USER_DATA_CHANGED",function(a){Zb({type:"conversationUserDataChanged",data:a})}),pc.on("Conversation.READ_ITEMS",function(a){Zb({type:"conversationReadItems",data:a})}),pc.on("User.USER_PRESENCE_CHANGE",function(a){Zb({type:"userPresenceChanged",presenceState:a.newState})}),pc.on("User.USER_UPDATED",function(a){Zb({type:"userUpdated",user:a.user})}),pc.addEventListener("connectionStateChange",function(a){ac=a.newState,Zb({type:"connectionStateChanged",state:a.newState})}),pc.addEventListener("reconnectFailed",function(){Zb({type:"reconnectFailed"}),bc.client_secret&&F().then(q).then(E)}),pc.on("User.SESSION_EXPIRES",function(){_b.loggedOnUser&&Qa()}),pc.on("User.USER_SETTING_UPDATED",function(a){var b=Ha(a.settings);Object.keys(b).length>0&&Zb({type:"userSettingsChanged",userSettings:b})}),pc.on("Search.BASIC_SEARCH_RESULT",function(a){Zb({type:"basicSearchResults",data:a})}),pc.on("System.MAINTENANCE",function(a){Zb({type:"systemMaintenance",data:a})}),pc.on("User.USER_DELETED",function(a){Zb({type:"userDeleted",data:a})}),pc.on("Conversation.DELETE",function(a){Zb({type:"conversationDeleted",convId:a.convId})}),pc.on("RTCSession.WHITEBOARD_ENABLED",function(a){Zb({type:"whiteboardEnabled",data:{enabled:!0,whiteboard:a.whiteboard}})}),pc.on("RTCSession.WHITEBOARD_DISABLED",function(){Zb({type:"whiteboardEnabled",data:{enabled:!1}})}),pc.on("RTCSession.WHITEBOARD_CLEARED",function(a){Zb({type:"whiteboardCleared",userId:a.userId})}),pc.on("RTCSession.WHITEBOARD_ELEMENT_ADDED",function(a){Zb({type:"whiteboardElement",action:"added",element:a.element})}),pc.on("RTCSession.WHITEBOARD_ELEMENT_REMOVED",function(a){Zb({type:"whiteboardElement",action:"removed",elementId:a.elementId})}),pc.on("RTCSession.WHITEBOARD_ELEMENT_UPDATED",function(a){Zb({type:"whiteboardElement",action:"updated",element:a.element})}),pc.on("ActivityStream.ACTIVITY_CREATED",function(a){a.navigableItem&&a.navigableItem.mention&&Zb({type:"mention",mention:a.navigableItem.mention})}),sc.PubSubSvc.subscribe("/call/incoming",function(a){Zb({type:"callIncoming",call:a})}),ic&&sc.PubSubSvc.subscribe("/call/warmupFailed",function(a,b){Zb({type:"callIncoming",call:b})}),sc.PubSubSvc.subscribe("/call/state",function(a){Zb({type:"callStatus",call:a,reason:"callStateChanged"})}),sc.PubSubSvc.subscribe("/call/remoteStreamUpdated",function(a){Zb({type:"callStatus",call:a,reason:"remoteStreamUpdated"})}),sc.PubSubSvc.subscribe("/call/localStreamEnded",function(a){Zb({type:"callStatus",call:a,reason:"localStreamEnded"})}),sc.PubSubSvc.subscribe("/call/muted",function(a){Zb({type:"callStatus",call:a,reason:"callMuted"})}),sc.PubSubSvc.subscribe("/call/localUser/muted",function(a){var b=Za(a);Zb({type:"callStatus",call:b,reason:"localUserMuted"})}),sc.PubSubSvc.subscribe("/call/localUser/unmuted",function(a){
var b=Za(a);Zb({type:"callStatus",call:b,reason:"localUserUnmuted"})}),sc.PubSubSvc.subscribe("/call/localUser/mutedSelf",function(a,b){var c=Za(a);Zb(b?{type:"callStatus",call:c,reason:"localUserSelfMuted"}:{type:"callStatus",call:c,reason:"localUserSelfUnmuted"})}),sc.PubSubSvc.subscribe("/call/locked",function(a){Zb({type:"callStatus",call:a,reason:"callLocked"})}),sc.PubSubSvc.subscribe("/call/moved",function(a,b){var c=Za(b);Zb({type:"callStatus",call:c,reason:"callMoved"})}),sc.PubSubSvc.subscribe("/call/participant/updated",function(a,b){var c=Za(a);Zb({type:"callStatus",call:c,participant:b,reason:"participantUpdated"})}),sc.PubSubSvc.subscribe("/call/participants/updated",function(a,b){var c=Za(a);Zb({type:"callStatus",call:c,participants:b,reason:"participantsUpdated"})}),sc.PubSubSvc.subscribe("/call/participant/added",function(a,b){var c=Za(a);Zb({type:"callStatus",call:c,participant:b,reason:"participantAdded"})}),sc.PubSubSvc.subscribe("/call/participants/added",function(a,b){var c=Za(a);Zb({type:"callStatus",call:c,participants:b,reason:"participantsAdded"})}),sc.PubSubSvc.subscribe("/call/participant/joined",function(a,b){Zb({type:"callStatus",call:a,participant:b,reason:"participantJoined"})}),sc.PubSubSvc.subscribe("/call/participant/removed",function(a){var b=Za(a);Zb({type:"callStatus",call:b,reason:"participantRemoved"})}),sc.PubSubSvc.subscribe("/call/recording/info",function(a){Zb({type:"callStatus",call:a,reason:"callRecording"})}),sc.PubSubSvc.subscribe("/call/droppedRemotely",function(a){Zb({type:"callStatus",call:a,reason:"droppedRemotely"})}),sc.PubSubSvc.subscribe("/call/sdpConnected",function(a){Zb({type:"callStatus",call:a,reason:"sdpConnected"})}),sc.PubSubSvc.subscribe("/call/network/quality",function(a){Zb({type:"callNetworkQualityChanged",data:a})}),sc.PubSubSvc.subscribe("/call/rtp/threshholdExceeded/detected",function(a){var b=Za(a);Zb({type:"callRtpThresholdReached",call:b})}),sc.PubSubSvc.subscribe("/call/rtp/threshholdExceeded/cleared",function(a){var b=Za(a);Zb({type:"callRtpThresholdCleared",call:b})}),sc.PubSubSvc.subscribe("/call/ended",function(a){Za(a.callId)||Zb({type:"callEnded",call:a})}),_b},a.Client.prototype.name="Client",a.isCompatible=function(){var a=parseInt(k.version,10);return k.chrome&&a>=44||k.firefox&&a>=42||k.edge},a.supportedFeatures=function(){return a.isCompatible()?{text:!0,rtc:k.chrome||k.firefox}:{text:!1,rtc:!1}},Object.defineProperty(a,"supportedEvents",{get:function(){return["accessTokenRenewed","renewAccessTokenFailed","loggedOnUserUpdated","itemAdded","itemUpdated","conversationCreated","conversationUpdated","conversationArchived","conversationFavorited","conversationUnarchived","conversationUnfavorited","conversationUserDataChanged","conversationReadItems","userPresenceChanged","userUpdated","connectionStateChanged","sessionTokenRenewed","reconnectFailed","userSettingsChanged","basicSearchResults","systemMaintenance","whiteboardEnabled","whiteboardElement","whiteboardCleared","mention","callIncoming","callStatus","callNetworkQualityChanged","callRtpThresholdReached","callRtpThresholdCleared","callEnded"]},enumerable:!0,configurable:!0}),a}(Circuit);